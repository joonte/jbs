//------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
//------------------------------------------------------------------------------
function OrderManage($ServiceOrderID,$OrderID,$ServiceID,$ServerID){
	//------------------------------------------------------------------------------
	var $HTTP = new HTTP();
	//------------------------------------------------------------------------------
	if(!$HTTP.Resource){
		//------------------------------------------------------------------------------
		alert('Не удалось создать HTTP соединение');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onLoaded = function(){
		//------------------------------------------------------------------------------
		HideProgress();
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onAnswer = function($Answer){
		//------------------------------------------------------------------------------
		switch($Answer.Status){
		case 'Error':
			//------------------------------------------------------------------------------
			ShowAlert($Answer.Error.String,'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Exception':
			//------------------------------------------------------------------------------
			ShowAlert(ExceptionsStack($Answer.Exception),'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Ok':
			//------------------------------------------------------------------------------
			var $Width  = screen.width  - 100;
			//------------------------------------------------------------------------------
			var $Height = screen.height - 100;
			//------------------------------------------------------------------------------
			//if($Answer.NewWindow == 1){
				//------------------------------------------------------------------------------
				//var $Window = window.open('','OrderManage',SPrintF('left=%u,top=%u,width=%u,height=%u,toolbar=0, scrollbars=1',(screen.width-$Width)/2,(screen.height-$Height)/2,$Width,$Height));
				//------------------------------------------------------------------------------
			//}else{
				//------------------------------------------------------------------------------
				var $Window = window.open('');
				//------------------------------------------------------------------------------
			//}
			//------------------------------------------------------------------------------
			$HTML = '<HTML><HEAD><LINK href="/styles/root/Css/Standard.css" rel="stylesheet" type="text/css" /><SCRIPT type="text/javascript" src="/styles/root/Js/Standard.js"></SCRIPT><TITLE>Управление заказом</TITLE></HEAD>';
			//------------------------------------------------------------------------------
			$HTML += '<BODY><P style="font-size:12px;">Осуществляется вход. Пожалуйста, подождите...</P>';
			//------------------------------------------------------------------------------
			$HTML += SPrintF('<FORM id="OrderManage" method="POST" action="%s">',$Answer.Url);
			//------------------------------------------------------------------------------
			var $Args = $Answer.Args;
			//------------------------------------------------------------------------------
			for(var $i in $Args){
				//------------------------------------------------------------------------------
				var $Arg = $Args[$i];
				//------------------------------------------------------------------------------
				if(typeof $Arg != 'string')
					continue;
				//------------------------------------------------------------------------------
				$HTML += SPrintF('<INPUT type="hidden" name="%s" value="%s" />',$i,$Arg);
				//------------------------------------------------------------------------------
			}
			//------------------------------------------------------------------------------
			//------------------------------------------------------------------------------
			$HTML += '</FORM>';
			$HTML += '<SCRIPT>document.getElementById("OrderManage").submit();</SCRIPT></BODY></HTML>';
			//------------------------------------------------------------------------------
			//alert($HTML);
			$Window.document.write($HTML);
			//------------------------------------------------------------------------------
			$Window.focus();
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		default:
			alert('Не известный ответ');
		}
		//------------------------------------------------------------------------------
	};
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	var $Args = {ServiceOrderID:$ServiceOrderID,OrderID:$OrderID,ServiceID:$ServiceID,ServerID:$ServerID};
	var $API  = ($ServerID)?'/Administrator/API/ServerManage':'/API/OrderManage';
	//------------------------------------------------------------------------------
	if(!$HTTP.Send($API,$Args)){
		//------------------------------------------------------------------------------
		alert('Не удалось отправить запрос на сервер');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	ShowProgress('Вход на сервер');
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
}
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------

