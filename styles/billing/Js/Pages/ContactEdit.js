//------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
// added by lissyara 2015-11-17 in 17:25 MSK
function Confirm($Method,$Value,$ContactID) {
	//------------------------------------------------------------------------------
	if (!$Method){
		//------------------------------------------------------------------------------
		ShowAlert('Не указан метод отправки кода подтвержения','Warning');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	if (!$Value){
		//------------------------------------------------------------------------------
		ShowAlert('Не указан адрес для отправки кода подтвержения','Warning');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	if (!$ContactID){
		//------------------------------------------------------------------------------
		ShowAlert('Внутренняя ошибка, отсутствует идентфикатор контакта','Warning');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	var $Form = document.forms['ContactEditForm'];
	//------------------------------------------------------------------------------
	$HTTP = new HTTP();
	//------------------------------------------------------------------------------
	if (!$HTTP.Resource) {
		//------------------------------------------------------------------------------
		alert('Не удалось создать HTTP соединение');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onLoaded = function() {
		//------------------------------------------------------------------------------
		HideProgress();
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onAnswer = function($Answer) {
		//------------------------------------------------------------------------------
		//alert($Answer.Status);
		switch ($Answer.Status) {
		//------------------------------------------------------------------------------
		case 'Error':
			//------------------------------------------------------------------------------
			ShowAlert($Answer.Error.String, 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Exception':
			//------------------------------------------------------------------------------
			// вайбер - он особенно особенный - даже по сравнению с телегой
			ShowAlert(ExceptionsStack($Answer.Exception), ($Method == 'Viber')?'/styles/' + window.location.hostname + '/Images/Viber.png':'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Ok':
			//------------------------------------------------------------------------------
			ShowAlert('Cообщение с кодом подтверждения успешно отправлено');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		default:
			alert('Не известный ответ');
		}
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	var $Args = { Method: $Method, Value: $Value, ContactID: $ContactID };
	//------------------------------------------------------------------------------
	if (!$HTTP.Send('/API/Confirm', $Args)) {
		//------------------------------------------------------------------------------
		alert('Не удалось отправить запрос на сервер');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	ShowProgress('Отправка сообщения');
	//------------------------------------------------------------------------------
}

//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
// added by lissyara, 2015-11-18 in 16:40 MSK
function ConfirmCheck($Method,$Value,$Reset) {
	//------------------------------------------------------------------------------
	if (!$Method){
		//------------------------------------------------------------------------------
		ShowAlert('Не указан метод отправки кода подтвержения','Warning');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	var $Form = document.forms['ContactEditForm'];
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	if ($Form.AddressCode.value == ''){
		//------------------------------------------------------------------------------
		ShowAlert('Код не введён','Warning');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	$HTTP = new HTTP();
	//------------------------------------------------------------------------------
	if (!$HTTP.Resource) {
		//------------------------------------------------------------------------------
		alert('Не удалось создать HTTP соединение');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onLoaded = function() {
		//------------------------------------------------------------------------------
		HideProgress();
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onAnswer = function($Answer) {
		//------------------------------------------------------------------------------
		switch ($Answer.Status) {
		case 'Error':
			//------------------------------------------------------------------------------
			ShowAlert($Answer.Error.String, 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Exception':
			//------------------------------------------------------------------------------
			ShowAlert(ExceptionsStack($Answer.Exception), 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Ok':
			//------------------------------------------------------------------------------
			$Message = 'Контактный адрес успешно подтвержден, и теперь вам доступны настройки ' + $Method + ' уведомлений во вкладке "Уведомления".';
			//------------------------------------------------------------------------------
			if($Reset)
				$Message = $Message + 'Все предыдущие настройки для ' + $Method + ' были сброшены';
			//------------------------------------------------------------------------------
			ShowAlert($Message);
			//------------------------------------------------------------------------------
			setTimeout(
				//------------------------------------------------------------------------------
				function (){
					//------------------------------------------------------------------------------
					ShowWindow('/UserPersonalDataChange');
					//------------------------------------------------------------------------------
				},
				//------------------------------------------------------------------------------
			5000);
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		default:
			alert('Неизвестный ответ');
		}
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	//$Confirm = eval('$Form.' + $Method + 'Code.value');
	//------------------------------------------------------------------------------
	var $Args = {Method: $Method, Value: $Value, Confirm: $Form.AddressCode.value, ContactID: $Form.ContactID.value};
	//------------------------------------------------------------------------------
	if (!$HTTP.Send('/API/Confirm', $Args)) {
		//------------------------------------------------------------------------------
		alert('Не удалось отправить запрос на сервер');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	ShowProgress('Проверка кода подтверждения');
	//------------------------------------------------------------------------------
}
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------

// added by lissyara, 2015-11-18 in 23:40 MSK
function ConfirmSubmit() {
	//------------------------------------------------------------------------------
	var $Form = document.forms['ContactEditForm'];
	//------------------------------------------------------------------------------
	//alert($Form.MethodID.value); alert($Form.Address.value);
	if(($Form.MethodID.value == 'SMS' && ($Form.Address.value.charAt(0) == 8 || $Form.Address.value.charAt(0) == 9)) /*|| 
		($Form.WhatsApp && ($Form.WhatsApp.value.charAt(0) == 8 || $Form.WhatsApp.value.charAt(0) == 9))*/){
		//------------------------------------------------------------------------------
		ShowConfirm('С цифры 8 начинаются коды таких стран как Китай, Бангладеш и т.п. С цифры 9 начинаются телефонов в Афганистане, Монголии, Турции ... Вы уверены что ваш мобильный телефон относится именно к этой стране? Например код РФ: 7, Беларуси: 375, Украины: 380. Соответственно, обычный номер Российского мобильного телефона выглядит так: 79262223344. Вы всё ещё хотите сохранить свой телефонный номер в таком виде?','UserPersonalDataChange();');
		//------------------------------------------------------------------------------
	}else{
		//------------------------------------------------------------------------------
		ContactChange();
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
}
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------

// added by lissyara, 2019-09-06 in 10:51 MSK
function ContactChange() {
	//------------------------------------------------------------------------------
	var $Form = document.forms['ContactEditForm'];
	//------------------------------------------------------------------------------
	$HTTP = new HTTP();
	//------------------------------------------------------------------------------
	if (!$HTTP.Resource) {
		//------------------------------------------------------------------------------
		alert('Не удалось создать HTTP соединение');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onLoaded = function() {
		//------------------------------------------------------------------------------
		HideProgress();
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	$HTTP.onAnswer = function($Answer) {
		//------------------------------------------------------------------------------
		switch ($Answer.Status) {
		case 'Error':
			//------------------------------------------------------------------------------
			ShowAlert($Answer.Error.String, 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Exception':
			//------------------------------------------------------------------------------
			ShowAlert(ExceptionsStack($Answer.Exception), 'Warning');
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		case 'Ok':
			//------------------------------------------------------------------------------
			ShowProgress('Изменение контактного адреса');
			setTimeout(
				//------------------------------------------------------------------------------
				function (){
					//------------------------------------------------------------------------------
					ShowWindow('/UserPersonalDataChange');
					//------------------------------------------------------------------------------
				},
				//------------------------------------------------------------------------------
			1000);
			//------------------------------------------------------------------------------
			//------------------------------------------------------------------------------
			break;
			//------------------------------------------------------------------------------
		default:
			//------------------------------------------------------------------------------
			alert('Не известный ответ');
			//------------------------------------------------------------------------------
		}
		//------------------------------------------------------------------------------
	};
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	var $Args = FormGet($Form);
	//------------------------------------------------------------------------------
	if (!$HTTP.Send('/API/ContactEdit', $Args)) {
		//------------------------------------------------------------------------------
		alert('Не удалось отправить запрос на сервер');
		//------------------------------------------------------------------------------
		return false;
		//------------------------------------------------------------------------------
	}
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
	ShowProgress('Отправка данных на сервер');
	//------------------------------------------------------------------------------
	//------------------------------------------------------------------------------
}
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------

