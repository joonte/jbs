import{k as j,o as u,c as N,b as c,a as l,n as oe,t as S,Z as R,ab as T,w as P,d as z,z as x,an as te,F,y as ne,_ as se,g as ae,e as re,r as f,U as le,i as ce,h as g}from"./index-aeb1df1e.js";import{I as ie}from"./IconSearch-4ea59048.js";import{H as K}from"./HostingItem-7d5741d0.js";import{_ as q}from"./ClausesKeeper-90c650cc.js";import{s as de}from"./multiselect-3fbc9d28.js";import{u as me}from"./hosting-5f2b5ff4.js";import{u as ue}from"./IconArrow-a6c91ada.js";import{B as Z}from"./BlockBalanceAgreement-906c1168.js";import{u as _e}from"./testTransforms-eec373ee.js";import{u as fe}from"./globalActions-3944bebb.js";import{_ as ge,B as G}from"./IconButtonBack-6ba1fbb0.js";import{E as ve}from"./EmptyStateBlock-b0a120e4.js";import{_ as pe}from"./FormInputSearch-9fb2a00d.js";import{f as ke}from"./bootstrap-vue-next.es-c6bcf011.js";import{_ as be}from"./ButtonDefault-11c4541b.js";import"./IconDots-76437be9.js";import"./IconCard-47752060.js";import"./StatusBadge-ca078fa4.js";import"./hostStatuses-94d00f20.js";import"./HelperComponent-470cfccf.js";import"./useTimeFunction-8602dd60.js";import"./OrderIDBadge-3a2e7e5e.js";import"./IconClose-c7c36336.js";import"./IconPlus-3baf194c.js";const he={class:"section"},Se={class:"container"},Ie={class:"title__icon"},Ce={class:"btn__group"},He={class:"group__several"},Be={class:"list-form"},we={class:"list-form_col list-form_col--sm"},ye={class:"list-form_select"},Oe={class:"multiselect-option"},De={key:0};function Pe(r,s,v,o,I,C){var y,b,O;const p=Z,k=ge,d=be,m=j("router-link"),H=G,B=ke,_=q,U=j("Multiselect"),V=pe,L=K,w=ve;return u(),N(F,null,[c(p),l("div",he,[l("div",Se,[l("div",{class:oe(["section-header",o.isSeveral?"column":""])},[l("div",Ie,[l("h1",{class:"section-title",onClick:s[0]||(s[0]=t=>o.reloadNow())},S(o.isSeveral?"Продление услуг Хостинга":"Хостинг"),1),R(c(k,{onClick:s[1]||(s[1]=t=>o.outSeveralOrders())},null,512),[[T,o.isSeveral]])]),R(l("div",Ce,[c(d,{class:"btn-several",label:"Продлить несколько заказов",onClick:s[2]||(s[2]=t=>o.prolongSeveralOrders())}),c(m,{class:"btn btn--blue btn-default",to:"/HostingSchemes"},{default:P(()=>[z("Заказать")]),_:1})],512),[[T,!o.isSeveral]]),R(l("div",He,[c(H,{class:"contr period",modelValue:o.selectPeriod,"onUpdate:modelValue":s[3]||(s[3]=t=>o.selectPeriod=t)},null,8,["modelValue"]),c(B,{id:"checkbox-balance",modelValue:o.useBalance,"onUpdate:modelValue":s[4]||(s[4]=t=>o.useBalance=t),name:"checkbox-balance"},{default:P(()=>[z("Использовать средства с баланса")]),_:1},8,["modelValue"]),c(d,{label:"Продлить",onClick:s[5]||(s[5]=t=>o.prolongOrders())})],512),[[T,o.isSeveral]])],2),(u(),x(te,null,[c(_)],1024)),l("div",Be,[l("div",we,[l("div",ye,[c(U,{modelValue:o.select,"onUpdate:modelValue":s[6]||(s[6]=t=>o.select=t),options:o.getUsers,disabled:((y=o.getUsers)==null?void 0:y.length)<=1,label:"name"},{singlelabel:P(({value:t})=>[l("span",null,"# "+S(t.value.padStart(5,"0"))+" / "+S(t.name),1)]),option:P(({option:t})=>[l("div",Oe,"# "+S(t.value.padStart(5,"0"))+" / "+S(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),c(V,{modelValue:o.search,"onUpdate:modelValue":s[7]||(s[7]=t=>o.search=t)},null,8,["modelValue"])]),o.getHostingList&&((b=o.getHostingList)==null?void 0:b.length)>0?(u(),N("div",De,[o.filterProducts&&((O=o.filterProducts)==null?void 0:O.length)>0?(u(!0),N(F,{key:0},ne(o.filterProducts,(t,M)=>{var i,h;return u(),x(L,{"item-data":t,"user-name":`${(i=o.getUser)==null?void 0:i.Name} - ${(h=o.getContracts[t==null?void 0:t.ContractID])==null?void 0:h.Customer}`,params:o.getHostingItemParam(t),"info-link":`/HostingOrders/${t==null?void 0:t.OrderID}`,"is-last":M===o.filterProducts.length-1,isSeveral:o.isSeveral,"selected-rows":o.selectedRows,onUpdateSelectedRows:o.handleSelectedRowsUpdate,onDelete:o.deleteItem,onTransfer:o.transferItem,onManage:o.orderManage},null,8,["item-data","user-name","params","info-link","is-last","isSeveral","selected-rows","onUpdateSelectedRows","onDelete","onTransfer","onManage"])}),256)):(u(),x(w,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(u(),x(w,{key:1,class:"no-margin",label:"У Вас нет заказов на хостинг"}))])])],64)}const xe={components:{IconSearch:ie,Multiselect:de,ClausesKeeper:q,HostingItem:K,BlockBalanceAgreement:Z,BlockSelectPeriod:G},async setup(){const r=me(),s=ae(),v=ue(),o=fe(),I=re(),{formDescriptionLine:C}=_e(),p=f("*"),k=f(null),d=f(!1),m=f([]),H=f(null),B=f(!1),_=le("emitter");_.on("updateHostingList",()=>{r.fetchHostingOrders()});const U=n=>{m.value=n};async function V(){console.log(m.value);const n=Object.keys(m.value).filter(a=>m.value[a]),e={ServiceID:"10000",ItemsPay:H.value,OrdersIDs:n,...B.value&&{UseBalance:"yes"}};await o.OrdersPay(e).then(a=>{a==="Basket"?(console.log("Success"),I.push("/Basket")):(a==null?void 0:a.Status)==="Ok"&&(d.value=!1,_.emit("open-modal",{component:"BalanceProlong",data:{Message:a==null?void 0:a.Message,Count:a==null?void 0:a.Count}}))})}function L(){d.value=!0}function w(){d.value=!1}ce(()=>{i.value.length<1&&b()});function y(){I.go(0)}function b(){I.push({path:"/HostingSchemes"})}function O(n,e){_.emit("open-modal",{component:"DeleteItem",data:{id:n,message:`Вы действительно хотите удалить хостинг #${e}?`,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function t(n){_.emit("open-modal",{component:"OrdersTransfer",data:n})}function M(n){o.OrderManageHosting(n)}const i=g(()=>{var n;return(n=Object.keys(r==null?void 0:r.hostingList).map(e=>r==null?void 0:r.hostingList[e]))==null?void 0:n.reverse()}),h=g(()=>r==null?void 0:r.hostingSchemes),A=g(()=>v==null?void 0:v.contractsList),J=g(()=>{let n=[{value:"*",name:"Все договора"}];return i.value!==null?(i.value.forEach(e=>{var a;n.find(D=>D.value===e.ContractID)||n.push({value:e.ContractID,name:(a=A.value[e==null?void 0:e.ContractID])==null?void 0:a.Customer})}),n):{value:"*",name:"Все договора"}}),Q=g(()=>s.userInfo),W=g(()=>Y(X(i.value)));function X(n){return p.value!=="*"?n.filter(e=>(e==null?void 0:e.ContractID)===p.value):n}function Y(n){return k.value!==null?n.filter(e=>e==null?void 0:e.Domain.toLowerCase().includes(k.value.toLowerCase())):n}function $(n){var a,D,E;const e=ee(n==null?void 0:n.SchemeID);return[{text:e==null?void 0:e.Name},{text:C((a=e==null?void 0:e.SchemeParams)==null?void 0:a.limit_webdomains)},{text:C((D=e==null?void 0:e.SchemeParams)==null?void 0:D.limit_quota)},{text:C((E=e==null?void 0:e.SchemeParams)==null?void 0:E.limit_emails)},{text:`${e==null?void 0:e.CostMonth} ₽ в месяц`,bold:!0}]}function ee(n){var e;return(e=h.value)==null?void 0:e[n]}return await r.fetchHostingOrders(),await r.fetchHostingSchemes(),await v.fetchContracts(),{getHostingList:i,getHostingSchemes:h,orderManage:M,filterProducts:W,getUsers:J,getUser:Q,select:p,search:k,getContracts:A,deleteItem:O,transferItem:t,getHostingItemParam:$,navigateToHostingSchemes:b,reloadNow:y,prolongSeveralOrders:L,isSeveral:d,selectedRows:m,selectPeriod:H,prolongOrders:V,outSeveralOrders:w,useBalance:B,handleSelectedRowsUpdate:U}}},to=se(xe,[["render",Pe],["__scopeId","data-v-ad6693ea"]]);export{to as default};
