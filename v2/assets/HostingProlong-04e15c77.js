import{E as ne}from"./EmptyStateBlock-a6b81e83.js";import{_ as ie}from"./BlockOrderPayBalance-dd07430a.js";import{_ as _e}from"./ClausesKeeper-d3875457.js";import{_ as re}from"./ButtonDefault-6a3a5e1e.js";import{_ as de,a7 as ue,e as me,S as ve,r as g,g as B,ag as w,o as _,c as r,b as d,a as e,t as c,F as D,x as pe,k as he,Z as se,ae as oe,p as ge,l as be}from"./index-145d9cde.js";import{u as ke}from"./hosting-57e879dc.js";import{u as fe}from"./contracts-009c925b.js";import{_ as ye}from"./paramsAccordionBlock-e97ef172.js";import{B as De}from"./BlockBalanceAgreement-650ad03e.js";import"./bootstrap-vue-next.es-759b1c9f.js";import"./IconHelp-663fe55e.js";import"./globalActions-de64efb8.js";import"./BasicInput-9e44931e.js";import"./component-adfdaade.js";import"./IconClose-f461656c.js";import"./IconArrow-f2b12a71.js";const ae=b=>(ge("data-v-a69f21e1"),b=b(),be(),b),Ie={key:0,class:"hosting-sheme"},Be={class:"section"},we={class:"container"},Se={class:"section-header"},Ce={class:"section-header__wrapper"},He={class:"section-title"},Pe={class:"section-label"},xe={class:"section"},Ee={class:"container"},Oe={class:"total-block"},Fe={class:"total-block__row divider-bottom"},Ne=ae(()=>e("div",{class:"total-block__col"},"Цена тарифа",-1)),Le={class:"total-block__col"},$e={class:"total-block__row no-divider"},Ae={class:"total-block__col"},Te={class:"total-block__col"},Ve={class:"total-block__row total-block__row--big economy-line"},je=ae(()=>e("div",{class:"total-block__col red"},"Выгода",-1)),Re={class:"total-block__col flex-col"},Ke={class:"red"},Ue={class:"total-block__row total-block__row--big"},Ze={class:"total-block__col"},qe={class:"total-block__col"},ze={key:1,class:"section"},Ge={class:"container"},Je={key:1,class:"section"},Me={class:"container"},Qe={__name:"HostingProlong",async setup(b){let m,v;const a=ke(),S=fe(),le=ue(),C=me();ve("emitter"),g(null),g(null),g("");const t=g(null),k=g(!1),n=B(()=>Object.keys(a==null?void 0:a.hostingList).map(s=>a==null?void 0:a.hostingList[s]).find(s=>s.OrderID===le.params.id));console.log("getHostingOrderData",n);const u=B(()=>{var s,o;return(o=a==null?void 0:a.hostingSchemes)==null?void 0:o[(s=n.value)==null?void 0:s.SchemeID]});console.log("getHostingScheme",u);const H=B(()=>S.contractsList);function f(s){return Number(s).toFixed(2)||0}function P(){var o,i;let s=0;return(i=(o=t.value)==null?void 0:o.discounts)==null||i.Bonuses.map(p=>{s+=+p.Economy}),s}function x(){var s,o,i;k.value=!0,a.HostingOrderPay({HostingOrderID:(s=n.value)==null?void 0:s.ID,DaysPayFromBallance:((o=t.value)==null?void 0:o.daysFromBalance)||0,DaysPay:(i=t.value)==null?void 0:i.actualDays,IsChange:!0}).then(p=>{var h;let{result:y,error:I}=p;y==="SUCCESS"?C.push(`/HostingOrders/${(h=n.value)==null?void 0:h.ID}`):y==="BASKET"&&C.push("/Basket"),k.value=!1})}function ce(s){t.value=s}return[m,v]=w(()=>a.fetchHostingOrders()),await m,v(),[m,v]=w(()=>a.fetchHostingSchemes()),await m,v(),[m,v]=w(()=>S.fetchContracts()),await m,v(),(s,o)=>{var h,E,O,F,N,L,$,A,T,V,j,R,K,U,Z,q,z,G,J,M,Q,W,X,Y,ee,te;const i=re,p=_e,y=ie,I=ne;return _(),r(D,null,[d(De),n.value?(_(),r("div",Ie,[e("div",Be,[e("div",we,[e("div",Se,[e("div",Ce,[e("h1",He,c((h=n.value)==null?void 0:h.Domain),1),d(i,{class:"btn--wide",label:((E=H.value[n.value.ContractID])==null?void 0:E.Balance)>((O=t.value)==null?void 0:O.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||((F=t.value)==null?void 0:F.price)===null,"is-loading":k.value,onClick:o[0]||(o[0]=l=>x())},null,8,["label","disabled","is-loading"])]),e("div",Pe,c((N=u.value)==null?void 0:N.Name),1)]),d(p)])]),d(ye,{"params-list":(L=u.value)==null?void 0:L.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),($=u.value)!=null&&$.IsPayed&&((A=u.value)!=null&&A.IsProlong)||!((T=u.value)!=null&&T.IsPayed)?(_(),r(D,{key:0},[d(y,{contractID:(V=n.value)==null?void 0:V.ContractID,scheme:u.value,isOrderID:!0,onSelect:ce},null,8,["contractID","scheme"]),e("div",xe,[e("div",Ee,[e("div",Oe,[((K=(R=(j=t.value)==null?void 0:j.discounts)==null?void 0:R.Bonuses)==null?void 0:K.length)>0?(_(),r(D,{key:0},[e("div",Fe,[Ne,e("div",Le,c(f((U=t.value)==null?void 0:U.price))+" ₽",1)]),(_(!0),r(D,null,pe((q=(Z=t.value)==null?void 0:Z.discounts)==null?void 0:q.Bonuses,l=>(_(),r("div",$e,[e("div",Ae,"Скидка "+c(l==null?void 0:l.Discount)+"% на "+c(l==null?void 0:l.Days)+" дней",1),e("div",Te,"-"+c(f(l==null?void 0:l.Economy))+" ₽",1)]))),256))],64)):he("",!0),se(e("div",Ve,[je,e("div",Re,[e("span",null,[e("s",null,c(f((z=t.value)==null?void 0:z.price))+" ₽",1)]),e("span",Ke,"-"+c(P())+" ₽",1)])],512),[[oe,((M=(J=(G=t.value)==null?void 0:G.discounts)==null?void 0:J.Bonuses)==null?void 0:M.length)>0]]),se(e("div",Ue,[e("div",Ze,"Итого за "+c((Q=t.value)==null?void 0:Q.label),1),e("div",qe,c(f(((W=t.value)==null?void 0:W.price)-P()))+" ₽",1)],512),[[oe,(X=t.value)==null?void 0:X.price]])]),d(i,{class:"btn--wide",label:((Y=H.value[n.value.ContractID])==null?void 0:Y.Balance)>((ee=t.value)==null?void 0:ee.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||((te=t.value)==null?void 0:te.price)===null,"is-loading":k.value,onClick:o[1]||(o[1]=l=>x())},null,8,["label","disabled","is-loading"])])])],64)):(_(),r("div",ze,[e("div",Ge,[d(I,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(_(),r("div",Je,[e("div",Me,[d(I,{label:"не удалось найти заказ хостинга"})])]))],64)}}},mt=de(Qe,[["__scopeId","data-v-a69f21e1"]]);export{mt as default};
