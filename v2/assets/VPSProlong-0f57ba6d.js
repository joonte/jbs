import{E as se}from"./EmptyStateBlock-1861cff5.js";import{_ as oe}from"./ButtonDefault-eb076df2.js";import{_ as ae}from"./BlockOrderPayBalance-74ae5c26.js";import{_ as ce}from"./ClausesKeeper-12bc5d50.js";import{_ as le,e as ne,a7 as re,r as y,g as k,ag as f,o as c,c as l,b as p,a as t,F as P,t as n,x as _e,k as ie,Z as Q,ae as W,p as de,l as ue}from"./index-642cdac5.js";import{u as pe}from"./vps-a0484b23.js";import{u as ve}from"./contracts-16ef7000.js";import{B as me}from"./BlockBalanceAgreement-ccba2ab2.js";import"./bootstrap-vue-next.es-9ff54498.js";import"./IconHelp-41d48e37.js";import"./globalActions-c9fc22a3.js";import"./BasicInput-e305f811.js";import"./component-faf9e0c1.js";import"./IconClose-f1b85910.js";import"./IconArrow-c0196cbe.js";const D=h=>(de("data-v-b1e9da89"),h=h(),ue(),h),he={key:0,class:"vps-scheme-page"},be={class:"section"},Se={class:"container"},ke=D(()=>t("div",{class:"section-header"},[t("h1",{class:"section-title"},"Оплата заказа VPS/VDS сервера")],-1)),ge={key:0,class:"section"},ye={class:"container"},fe={class:"total-block"},Pe={class:"total-block__row divider-bottom"},De=D(()=>t("div",{class:"total-block__col"},"Цена тарифа",-1)),Ve={class:"total-block__col"},Ie={class:"total-block__row no-divider"},Be={class:"total-block__col"},we={class:"total-block__col"},Ce={class:"total-block__row total-block__row--big economy-line"},xe=D(()=>t("div",{class:"total-block__col red"},"Выгода",-1)),Ee={class:"total-block__col flex-col"},Oe={class:"red"},Fe={class:"total-block__row total-block__row--big"},Le={class:"total-block__col"},Re={class:"total-block__col"},Ne={key:1,class:"section"},Ae={class:"container"},Te={key:1,class:"section"},$e={class:"container"},je={__name:"VPSProlong",async setup(h){let _,i;const r=pe(),V=ve(),I=ne(),X=re(),s=y(null),b=y(null),g=y(!1),Y=k(()=>Object.keys(r.vpsSchemes).map(e=>r.vpsSchemes[e])),v=k(()=>Object.keys(r.vpsList).map(e=>r.vpsList[e]).find(e=>e.OrderID===X.params.id)),B=k(()=>V.contractsList);console.log("getContracts",B);const m=k(()=>Y.value.find(e=>{var o;return(e==null?void 0:e.ID)===((o=v.value)==null?void 0:o.SchemeID)}));console.log("getSelectedPackage",m);function S(e){return Number(e).toFixed(2)||0}function w(){var o,d;let e=0;return(d=(o=s.value)==null?void 0:o.discounts)==null||d.Bonuses.map(u=>{e+=+u.Economy}),e}function ee(e){s.value=e}function te(){var e,o;g.value=!0,r.VPSOrderPay({VPSOrderID:(e=v.value)==null?void 0:e.ID,DaysPay:(o=s.value)==null?void 0:o.actualDays,IsChange:!0}).then(d=>{let{result:u,error:C}=d;u==="SUCCESS"?I.push("/VPSOrders"):u==="BASKET"&&I.push("/Basket"),g.value=!0})}return[_,i]=f(()=>r.fetchVPSSchemes()),await _,i(),[_,i]=f(()=>V.fetchContracts()),await _,i(),[_,i]=f(()=>r.fetchVPS().then(()=>{var e;b.value=(e=v.value)==null?void 0:e.ContractID})),await _,i(),(e,o)=>{var E,O,F,L,R,N,A,T,$,j,H,K,U,Z,q,z,G,J,M;const d=ce,u=ae,C=oe,x=se;return c(),l(P,null,[p(me),v.value?(c(),l("div",he,[t("div",be,[t("div",Se,[ke,p(d,{partition:"Header:/VPSSchemes"})])]),p(u,{contractID:b.value,scheme:m.value,serviceID:"30000",daysRemainded:(E=v.value)==null?void 0:E.DaysRemainded,isOrderID:!1,onSelect:ee},null,8,["contractID","scheme","daysRemainded"]),(O=m.value)!=null&&O.IsPayed&&((F=m.value)!=null&&F.IsProlong)||!((L=m.value)!=null&&L.IsPayed)?(c(),l("div",ge,[t("div",ye,[t("div",fe,[((A=(N=(R=s.value)==null?void 0:R.discounts)==null?void 0:N.Bonuses)==null?void 0:A.length)>0?(c(),l(P,{key:0},[t("div",Pe,[De,t("div",Ve,n(S((T=s.value)==null?void 0:T.price))+" ₽",1)]),(c(!0),l(P,null,_e((j=($=s.value)==null?void 0:$.discounts)==null?void 0:j.Bonuses,a=>(c(),l("div",Ie,[t("div",Be,"Скидка "+n(a==null?void 0:a.Discount)+"% на "+n(a==null?void 0:a.Days)+" дней",1),t("div",we,"-"+n(S(a==null?void 0:a.Economy))+" ₽",1)]))),256))],64)):ie("",!0),Q(t("div",Ce,[xe,t("div",Ee,[t("span",null,[t("s",null,n(S((H=s.value)==null?void 0:H.price))+" ₽",1)]),t("span",Oe,"-"+n(w())+" ₽",1)])],512),[[W,((Z=(U=(K=s.value)==null?void 0:K.discounts)==null?void 0:U.Bonuses)==null?void 0:Z.length)>0]]),Q(t("div",Fe,[t("div",Le,"Итого за "+n((q=s.value)==null?void 0:q.label),1),t("div",Re,n(S(((z=s.value)==null?void 0:z.price)-w()))+" ₽",1)],512),[[W,(G=s.value)==null?void 0:G.price]])]),p(C,{class:"btn--wide",label:((J=B.value[b.value])==null?void 0:J.Balance)>((M=s.value)==null?void 0:M.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||b.value===null,"is-loading":g.value,onClick:o[0]||(o[0]=a=>te())},null,8,["label","disabled","is-loading"])])])):(c(),l("div",Ne,[t("div",Ae,[p(x,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(c(),l("div",Te,[t("div",$e,[p(x,{label:"Заказ VPS/VDS сервера не найден"})])]))],64)}}},st=le(je,[["__scopeId","data-v-b1e9da89"]]);export{st as default};
