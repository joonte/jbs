import{_ as ne,r as x,i as K,o as C,c as R,a as d,b as I,w as p,t as P,M as Oe,p as re,l as ae,d as j,j as Y,n as $,Z as J,ae as Q,y as T,k as ee,F as te,e as le,f as ce,S as ie,g as A,x as he,a7 as Ce,C as we}from"./index-b5b5ce3d.js";import{u as de}from"./services-18148891.js";import{u as ue}from"./contracts-74f05bb7.js";import"./postings-ed3c9d0d.js";import{u as _e}from"./globalActions-6936f67f.js";import{u as Pe}from"./resetServer-841751d7.js";import{f as se}from"./useTimeFunction-8602dd60.js";import{_ as me}from"./IconCard-cef3f371.js";import{E as X}from"./EmptyStateBlock-cd0c2748.js";import{S as ve}from"./StatusBadge-0649a996.js";import{s as xe}from"./servicesStatuses-6293b6ac.js";import{_ as Be}from"./HelperComponent-fa301290.js";import{s as oe}from"./multiselect-4f7d14de.js";import{f as Ve,z as Le,k as Ne,d as Ee,C as je}from"./bootstrap-vue-next.es-37aa63ea.js";import{_ as Te}from"./IconDots-5eb3cb0a.js";import{_ as Ue}from"./ClausesKeeper-3a1c11ba.js";import{_ as Ae}from"./BlockSelectContract-03150afa.js";import{_ as He}from"./ButtonDefault-0006f72a.js";import{B as fe}from"./BlockBalanceAgreement-a016b94f.js";import{_ as Me}from"./IconArrow-fddabae2.js";import"./IconClose-cd6d3917.js";const Re=[{key:"Several",label:"",variant:"",sortable:!1},{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}];const We=u=>(re("data-v-4b382ed3"),u=u(),ae(),u),ze={class:"section"},Ge={class:"container"},Fe={class:"block--mobile_divider"},qe={class:"form-field form-field--basic"},Ke=We(()=>d("div",{class:"form-field__label"},[j("Выбрать период"),d("span",null,"*")],-1)),Xe={class:"form-field-input__wrapper"},Ze={__name:"BlockSelectPeriod",emits:["update:modelValue","buttonClicked"],setup(u,{emit:r}){const l=[{counts:"3 месяца",actualDays:91,value:91},{counts:"6 месяцев",actualDays:181,value:181},{counts:"12 месяцев",actualDays:365,value:365},{counts:"24 месяца",actualDays:730,value:730},{counts:"36 месяцев",actualDays:1095,value:1095}],e=x(null);function V(D){r("update:modelValue",D)}return K(()=>{console.log("Периоды:",l),e.value=l[0]}),(D,b)=>(C(),R("div",ze,[d("div",Ge,[d("div",Fe,[d("div",qe,[Ke,d("div",Xe,[I(Oe(oe),{class:"multiselect--white",placeholder:"Выбрать период",label:"counts",modelValue:e.value,"onUpdate:modelValue":b[0]||(b[0]=g=>e.value=g),options:l,disabled:l.length<=1,"track-by":"actualDays",onChange:V},{singlelabel:p(({value:g})=>[d("span",null,P(g?g.counts:""),1)]),_:1},8,["modelValue","disabled"])])])])])]))}},De=ne(Ze,[["__scopeId","data-v-4b382ed3"]]),H=u=>(re("data-v-303c9351"),u=u(),ae(),u),Je={class:"section-header"},Qe={class:"btn__group"},Ye={class:"group__several"},$e=H(()=>d("span",{class:"td-mobile"},"Заказ",-1)),et=["onClick"],tt=H(()=>d("span",{class:"td-mobile"},"Договор",-1)),nt=H(()=>d("span",{class:"td-mobile"},"Ключевые поля",-1)),ot={class:"key-field"},st={class:"hosting-status__date"},rt=H(()=>d("span",{class:"td-mobile"},"Статус",-1)),at=H(()=>d("span",{class:"td-mobile"},"Дата окончания",-1)),lt=H(()=>d("span",{class:"td-mobile"},"Комментарий",-1)),ct={class:"service__controls-wrapper"},it=["onClick"],dt={class:"btn btn--dots"};function ut(u,r,l,e,V,D){var M,W,z,G;const b=He,g=De,B=Ae,E=Ue,w=Ve,k=ve,S=Y("Helper"),L=me,h=Te,_=Y("router-link"),o=Le,m=Ne,N=Ee,c=je,U=X;return C(),R(te,null,[d("div",Je,[d("div",{class:$(["section-title__nowrap",e.isSeveral?"column":""])},[d("h1",{class:"section-title",onClick:r[0]||(r[0]=t=>e.reloadNow())},P(e.isSeveral?"Продление услуг "+((M=l.sectionData)==null?void 0:M.Item):(W=l.sectionData)==null?void 0:W.Item),1),J(d("div",Qe,[I(b,{class:"btn-several",label:"Продлить несколько заказов",onClick:r[1]||(r[1]=t=>e.prolongSeveralOrders())}),I(b,{label:"Заказать",onClick:r[2]||(r[2]=t=>e.navigateToOrder())})],512),[[Q,!e.isSeveral]]),J(d("div",Ye,[I(g,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":r[3]||(r[3]=t=>e.selectPeriod=t)},null,8,["modelValue"]),I(B,{class:"contr",modelValue:e._contract_select,"onUpdate:modelValue":r[4]||(r[4]=t=>e._contract_select=t)},null,8,["modelValue"]),I(b,{label:"Продлить",onClick:r[5]||(r[5]=t=>e.prolongOrders())})],512),[[Q,e.isSeveral]])],2),I(E,{class:"additional-clauses",partition:`Header:${((z=l.sectionData)==null?void 0:z.Code)==="Default"?l.sectionID:`/${(G=l.sectionData)==null?void 0:G.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(C(),T(c,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":r[6]||(r[6]=t=>e.sortBy=t),"sort-desc":e.sortDesc,"onUpdate:sortDesc":r[7]||(r[7]=t=>e.sortDesc=t),onRowClicked:e.navigateToOrderPage,"sort-direction":e.sortDirection},{"cell(Several)":p(t=>[J(I(w,{id:"checkbox-"+t.index,modelValue:e.selectedRows[t.index],"onUpdate:modelValue":v=>e.selectedRows[t.index]=v,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[Q,e.isSeveral]])]),"cell(ID)":p(t=>[$e,d("span",{class:"order-id",onClick:v=>e.toItem(t.value)},P(t.value),9,et)]),"cell(ContractID)":p(t=>{var v,y;return[tt,d("span",null,"#"+P((v=e.getContracts[t.value])==null?void 0:v.ID)+" / "+P((y=e.getContracts[t.value])==null?void 0:y.Customer),1)]}),"cell(Keys)":p(t=>{var v,y;return[nt,d("span",ot,[j(P(e.findDomainByOrderID((v=t.item)==null?void 0:v.ID)),1),d("pre",st,P(e.getTitleText((y=t.item)==null?void 0:y.ID)),1)])]}),"cell(StatusID)":p(t=>[rt,I(k,{class:"clickable-element",status:t.value,"status-table":"Orders",onClick:v=>{var y,F;return e.openHistoryStatuses((y=t.item)==null?void 0:y.ID,(F=t.item)==null?void 0:F.ServiceID)}},null,8,["status","onClick"])]),"cell(ExpirationDate)":p(t=>{var v,y;return[at,d("span",null,P(e.calculateExpirationDate((v=t.item)==null?void 0:v.DaysRemainded))+" | "+P(((y=t.item)==null?void 0:y.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":p(t=>{var v;return[lt,I(S,{class:"clickable-element","user-notice":t.value,id:(v=t.item)==null?void 0:v.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":p(t=>[d("div",ct,[d("div",{class:"btn btn--md btn--bold clickable-element",onClick:v=>e.handlePayment(t.item.ID,t.item.ServiceID,t.item.ContractID)},[I(L),j("Оплатить")],8,it),I(N,{class:"dropdown-dots",right:""},{"button-content":p(()=>[d("div",dt,[I(h)])]),default:p(()=>[I(o,null,{default:p(()=>[I(_,{to:`/AdditionalServices/${t.item.ID}`},{default:p(()=>[j("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),I(o,{onClick:v=>e.transferItem(t.item.ID,t.item.ServiceID)},{default:p(()=>[j("Передать на другой аккаунт")]),_:2},1032,["onClick"]),l.sectionID==="51000"||l.sectionID==="52000"?(C(),T(o,{key:0,onClick:v=>e.orderManage(t.item.ID,t.item.ServiceID)},{default:p(()=>[j("Управлять заказом")]),_:2},1032,["onClick"])):ee("",!0),l.sectionID==="52000"?(C(),T(o,{key:1,onClick:v=>e.openPasswordChange(t.item.ID,t.item.ServiceID)},{default:p(()=>[j("Сменить пароль")]),_:2},1032,["onClick"])):ee("",!0),I(m),I(o,{class:"color-red",onClick:v=>u.$emit("deleteItem",t.item)},{default:p(()=>[j("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","onRowClicked","sort-direction"])):(C(),T(U,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const _t={components:{BlockSelectPeriod:De,EmptyStateBlock:X,StatusBadge:ve,IconCard:me,Helper:Be,Multiselect:oe},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],async setup(u){const r=le(),l=ce(),e=ie("emitter"),V=x("ID"),D=x(!0),b=x("desc"),g=x(!1),B=x([]),E=x(null),w=x(null),k=ue(),S=de(),L=_e(),h=A(()=>S==null?void 0:S.DNSmanagerOrdersList),_=A(()=>S==null?void 0:S.ISPswOrdersList),o=A(()=>S==null?void 0:S.ExtraIPOrdersList);function m(){r.go(0)}async function N(){console.log(B.value);const a=q.value.filter((i,f)=>B.value[f]),s=a.map(i=>i.ID),n={ServiceID:u.sectionID,ItemsPay:w.value,RowsIDs:s};await L.OrdersPay(n).then(i=>{console.log(i==="SUCCESS"?"Success":"Error")}),console.log("Selected Orders:",a),console.log("_contract_select:",E.value),console.log("selectPeriod:",w.value)}function c(a){const s=h.value,n=String(a),i=Object.values(s).find(f=>String(f.OrderID)===n);return console.log(i),i}const U=A(()=>k==null?void 0:k.contractsList);function M(a,s,n){s==="50000"||s==="51000"||s==="52000"?y(a,s):r.push(`/ServiceOrderPay/${a}`)}function W(a,s){console.log(a);const n=c(a);e.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:n.ID,ServiceID:s,emitEvent:"updateServicesList",Login:n.Login}})}function z(a,s){let n=null,i="";switch(s){case"50000":n=Object.entries(o.value).find(([f,O])=>O),i="ExtraIPOrders";break;case"51000":n=Object.entries(_.value).find(([f,O])=>O),i="ISPswOrders";break;case"52000":n=Object.entries(h.value).find(([f,O])=>O),i="DNSmanagerOrders";break;default:n=Object.entries(q.value).find(([f,O])=>O),i="Orders"}n&&e.emit("open-modal",{component:"StatusHistory",data:{modeID:i,rowID:n[1].ID}})}const G=a=>{const s=t(a);if(s){const n=s.split(","),i=n.length,f=n.join(`
`);return`Всего: ${i}
${f}`}return"Нет данных"},t=a=>{const s=Object.entries(h.value).reduce((n,[i,f])=>(n[i]=f,n),{});for(const n in s)if(Object.hasOwnProperty.call(s,n)){const i=s[n];if(String(i.OrderID)===String(a))return i.Parked}return null};function v(){g.value=!0}function y(a,s,n){s==="51000"?r.push(`/ISPswOrderPay/${a}`):s==="52000"?r.push(`/DNSmanagerOrderPay/${a}`):s==="50000"&&r.push(`/ExtraIPOrderPay/${a}`)}function F(a,s,n){n.target.closest("button, a, .clickable-element")||r.push(`/AdditionalServices/${a.ID}`)}function Se(a){r.push(`/AdditionalServices/${a}`)}function pe(a,s){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:a,ServiceID:s}})}function ge(a,s){let n;s==="51000"?n=Object.entries(_.value).reduce((f,[O,Z])=>(f[O]=Z,f),{}):s==="52000"&&(n=Object.entries(h.value).reduce((f,[O,Z])=>(f[O]=Z,f),{}));let i;for(const f in n)if(Object.hasOwnProperty.call(n,f)){const O=n[f];if(String(O.OrderID)===String(a)){i=O;break}}i&&L.OrderManageHosting({ServiceOrderID:i.ID,OrderID:a,ServiceID:s,XMLHttpRequest:"yes"})}const be=a=>{const s=Object.entries(h.value).reduce((n,[i,f])=>(n[i]=f,n),{});for(const n in s)if(Object.hasOwnProperty.call(s,n)){const i=s[n];if(String(i.OrderID)===String(a))return i.Domain}return null},q=A(()=>{var a,s;return(s=(a=Object.keys(l==null?void 0:l.userOrders).map(n=>{var i;return{...l==null?void 0:l.userOrders[n],ID:Number((i=l==null?void 0:l.userOrders[n])==null?void 0:i.ID)}}))==null?void 0:a.reverse())==null?void 0:s.filter(n=>n.ServiceID===(u==null?void 0:u.sectionID))});function ke(){r.push(`/AdditionalServicesOrder?ServiceID=${u==null?void 0:u.sectionID}`)}function ye(a){if(!a)return se(new Date);const s=new Date,n=new Date(s.getTime()+a*24*60*60*1e3);return se(n)}return K(()=>{B.value=q.value.map(()=>!1)}),await S.fetchDNSmanagerOrders(),await S.fetchISPswOrders(),await S.fetchExtraIPOrders(),{authStore:l,getOrders:q,getContracts:U,sortBy:V,sortDesc:D,sortDirection:b,navigateToOrder:ke,servicesStatuses:xe,oneTimeWorksFields:Re,calculateExpirationDate:ye,getDNSmanagerOrders:h,findDomainByOrderID:be,findParkedByOrderID:t,getTitleText:G,transferItem:pe,orderManage:ge,servicePay:y,handlePayment:M,navigateToOrderPage:F,openHistoryStatuses:z,toItem:Se,openPasswordChange:W,reloadNow:m,prolongSeveralOrders:v,isSeveral:g,selectedRows:B,_contract_select:E,selectPeriod:w,prolongOrders:N}}},Ie=ne(_t,[["render",ut],["__scopeId","data-v-303c9351"]]),mt={class:"section"},vt={class:"container"},ft={class:"section-header"},Dt={class:"section-nav"},It=["title","onClick"],St={class:"multiselect-option"},pt={class:"section-body"};function gt(u,r,l,e,V,D){var k,S,L,h,_,o,m,N;const b=fe,g=Me,B=Y("Multiselect"),E=Ie,w=X;return C(),R(te,null,[I(b),d("div",mt,[d("div",vt,[d("div",ft,[d("div",Dt,[(C(!0),R(te,null,he((k=e.getServices)==null?void 0:k.slice(0,e.visibleItemsCount),c=>{var U;return C(),R("div",{class:$(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(c==null?void 0:c.ID)}]),title:(U=e.getServerGroup(c==null?void 0:c.ServersGroupID))==null?void 0:U.Comment,onClick:M=>e.switchToSection(c==null?void 0:c.ID)},P(c==null?void 0:c.Item),11,It)}),256)),((S=e.getServices)==null?void 0:S.length)>e.visibleItemsCount?(C(),T(B,{key:0,modelValue:e.section,"onUpdate:modelValue":r[0]||(r[0]=c=>e.section=c),class:$({"multiselect--white additional-service__select":!0,"additional-service__select_active":(h=e.getServices)==null?void 0:h.slice(e.visibleItemsCount,(L=e.getServices)==null?void 0:L.length).find(c=>(c==null?void 0:c.ID)===e.section)}),options:(o=e.getServices)==null?void 0:o.slice(e.visibleItemsCount,(_=e.getServices)==null?void 0:_.length),label:"ID",onSelect:r[1]||(r[1]=c=>e.switchToSection(c))},{option:p(({option:c})=>[d("div",St,P(c==null?void 0:c.Item),1)]),caret:p(()=>[I(g,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):ee("",!0)])]),d("div",pt,[(m=e.getServices)!=null&&m.find(c=>c.ID===e.section)?(C(),T(E,{key:0,sectionID:e.section,sectionData:(N=e.getServices)==null?void 0:N.find(c=>c.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(C(),T(w,{key:1,label:"Услуга не найдена"}))])])])],64)}const bt={components:{ServiceListSection:Ie,emptyStateBlock:X,Multiselect:oe,BlockBalanceAgreement:fe},async setup(){const u=x(3);let r=()=>{window.innerWidth>=1920?u.value=9:window.innerWidth>=1600?u.value=7:window.innerWidth>=1440?u.value=6:window.innerWidth>=1200?u.value=5:window.innerWidth>=992?u.value=4:u.value=3};const l=Ce(),e=le(),V=ie("emitter"),D=de(),b=Pe();_e();const g=ce(),B=ue(),E=x(null);V.on("updateUserOrdersList",()=>{g.fetchUserOrders()});const w=A(()=>{var _;return(_=Object.keys(D==null?void 0:D.ServicesList))==null?void 0:_.map(o=>{var m;return{...D==null?void 0:D.ServicesList[o],value:(m=D==null?void 0:D.ServicesList[o])==null?void 0:m.ID}}).filter(o=>(o==null?void 0:o.ServicesGroupID)!=="1000"&&(o==null?void 0:o.IsActive)&&!(o!=null&&o.IsHidden)).sort((o,m)=>Number(o==null?void 0:o.SortID)<Number(m==null?void 0:m.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(m==null?void 0:m.SortID)?1:0)}),k=x(null);V.on("updateServicesList",()=>{g.fetchUserOrders()});function S(_){e.replace(`/AdditionalServices?ServiceID=${_}`),k.value=_}function L(_){var o,m;return(m=(o=b==null?void 0:b.serverGroupsList)==null?void 0:o.ServersGroups)==null?void 0:m[_]}function h(_){V.emit("open-modal",{component:"DeleteItem",data:{id:_.ID,message:`Вы действительно хотите удалить заказ #${_.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}return K(()=>{var _,o;(_=w.value)!=null&&_.find(m=>{var N;return(m==null?void 0:m.ID)===((N=l==null?void 0:l.query)==null?void 0:N.ServiceID)})?k.value=(o=l==null?void 0:l.query)==null?void 0:o.ServiceID:e.replace(`/AdditionalServices?ServiceID=${k.value}`)}),K(()=>{window.addEventListener("resize",r),r()}),we(()=>{window.removeEventListener("resize",r)}),await D.fetchServices().then(()=>{var _,o;k.value=(o=(_=w.value)==null?void 0:_[0])==null?void 0:o.ID}),await B.fetchContracts(),await g.fetchUserOrders(),await D.fetchDNSmanagerOrders(),await D.fetchISPswOrders(),await D.fetchExtraIPOrders(),{section:k,deleteItem:h,getServices:w,additionalServicesValue:E,switchToSection:S,getServerGroup:L,visibleItemsCount:u}}},zt=ne(bt,[["render",gt],["__scopeId","data-v-84174b73"]]);export{zt as default};
