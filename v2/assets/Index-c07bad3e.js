import{a1 as P,r as L,a2 as B,a3 as F,_ as N,o as u,c as p,a as e,b as w,F as x,v as V,t as d,w as k,k as O,p as T,l as $,R as A,g as S}from"./index-1c309346.js";import{u as E}from"./contracts-7b919c67.js";import{u as G}from"./postings-da2063b0.js";import"./invoices-5c661be3.js";import{S as R}from"./ServerItem-89346373.js";import{C as q}from"./bootstrap-vue-next.es-b799f76d.js";import{_ as z}from"./ClausesKeeper-b9906182.js";import"./IconDots-391abd93.js";import"./IconCard-ee273855.js";import"./StatusBadge-a49537d5.js";import"./IconClose-7cf50ca7.js";const H=P("basket",()=>{const s=L(null);async function r(){let o="error";return await B.post(""+F.fetchBasket).then(n=>{s.value=n==null?void 0:n.data}).catch(()=>{o="error"}),o}async function _(o){let n="error";return await B.post(""+F.deleteFromBasket,{...o}).then(f=>{n="success"}).catch(()=>{n="error"}),n}return{basketList:s,fetchBasket:r,deleteFromBasket:_}}),J={},K={fill:"none",height:"32",viewBox:"0 0 32 32",width:"32",xmlns:"http://www.w3.org/2000/svg"},Q=e("rect",{fill:"#F7F9FF",height:"31",rx:"3.5",width:"31",x:".5",y:".5"},null,-1),U=e("path",{d:"M8.5 11h15m-1.665 0v11.667a1.667 1.667 0 0 1-1.667 1.666h-8.333a1.667 1.667 0 0 1-1.667-1.666V11m2.5 0V9.333a1.667 1.667 0 0 1 1.667-1.666h3.333a1.667 1.667 0 0 1 1.667 1.666V11m-5.003 4.167v5m3.336-5v5",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),W=e("rect",{height:"31",rx:"3.5",stroke:"#C7D1ED",width:"31",x:".5",y:".5"},null,-1),X=[Q,U,W];function Y(s,r){return u(),p("svg",K,X)}const M=N(J,[["render",Y]]),Z=[{key:"ServiceID",label:"Услуга",variant:"td-service"},{key:"OrderID",label:"Номер заказа",variant:"td-service"},{key:"Amount",label:"Период"},{key:"Summ",label:"Сумма"},{key:"controls",label:"Действия",variant:"td-controls"}],v=s=>(T("data-v-740c8363"),s=s(),$(),s),j={class:"section"},tt={class:"container"},et=v(()=>e("div",{class:"section-header"},[e("h1",{class:"section-title"},"Корзина")],-1)),st={key:0,class:"cart-list"},ot={key:0,class:"cart-item"},nt=v(()=>e("div",{class:"cart-item__title"},"Заказ",-1)),at={class:"cart-item__subtitle"},ct={class:"cart-item__subtitle-name"},it=v(()=>e("span",{class:"td-mobile"},"Услуга",-1)),lt={class:"d-block"},rt={class:"d-block table-td-blue"},dt=v(()=>e("span",{class:"td-mobile"},"Номер заказа",-1)),_t=v(()=>e("span",{class:"td-mobile"},"Период",-1)),mt=v(()=>e("span",{class:"td-mobile"},"Сумма",-1)),ht=["onClick"],ut={class:"total-block"},pt={class:"total-block__row"},vt=v(()=>e("div",{class:"total-block__col"},"Итого",-1)),kt={class:"total-block__col"},ft=["onClick"],It={key:1,class:"notification-field"};function bt(s,r,_,o,n,f){const I=z,y=M,g=q;return u(),p("div",j,[e("div",tt,[et,w(I),o.basketContent&&Object.keys(o.basketContent).length>0?(u(),p("div",st,[(u(!0),p(x,null,V(o.basketContent,(m,b)=>{var D,C;return u(),p(x,null,[m&&m.length>0?(u(),p("div",ot,[nt,e("div",at,[e("div",ct,d((C=(D=o.getContracts)==null?void 0:D[b])==null?void 0:C.Customer),1)]),w(g,{class:"basic-table table-cart",items:m,fields:o.basketTableFields},{"cell(ServiceID)":k(a=>{var t,c,l,i;return[it,e("span",lt,d((l=(c=o.getServices)==null?void 0:c[(t=a.item)==null?void 0:t.ServiceID])==null?void 0:l.Name),1),e("span",rt,d((i=a.item)==null?void 0:i.Comment),1)]}),"cell(OrderID)":k(a=>{var t;return[dt,e("span",null,"№ "+d((t=a.item)==null?void 0:t.OrderID),1)]}),"cell(Amount)":k(a=>{var t,c;return[_t,e("span",null,d((t=a.item)==null?void 0:t.Amount)+" "+d((c=a.item)==null?void 0:c.Measure),1)]}),"cell(Summ)":k(a=>{var t;return[mt,e("span",null,d((t=a.item)==null?void 0:t.Summ)+" ₽",1)]}),"cell(controls)":k(a=>[e("button",{class:"btn-delete btn",onClick:t=>o.deleteFromBasket(a.item)},[w(y)],8,ht)]),_:2},1032,["items","fields"]),e("div",ut,[e("div",pt,[vt,e("div",kt,d(o.totalPrice(m))+" ₽",1)]),e("button",{class:"btn btn--blue btn-default btn--wide",onClick:a=>o.choosePaymentSystem(m,b)},"Оплатить заказ",8,ft)])])):O("",!0)],64)}),256))])):(u(),p("div",It,"Корзина заказов пуста"))])])}const Dt={components:{IconDelete:M,ServerItem:R},async setup(){const s=H(),r=E(),_=G(),o=A("emitter"),n=L(null),f=S(()=>s==null?void 0:s.basketList),I=S(()=>r==null?void 0:r.contractsList),y=S(()=>_==null?void 0:_.servicesList);o.on("form-cart-invoice",t=>{a(t)}),await s.fetchBasket().then(()=>{n.value=f.value}),await r.fetchContracts(),await _.fetchServices();function g(t){var l;let c=0;for(let i=0;i<t.length;i++)c=c+Number((l=t[i])==null?void 0:l.Summ);return Math.round((c+Number.EPSILON)*100)/100}function m(t){s==null||s.deleteFromBasket({RowsIDs:[t==null?void 0:t.ID],TableID:"Basket"}).then(c=>{var l,i;c==="success"&&(((l=s.basketList)==null?void 0:l[t==null?void 0:t.ContractID].filter(h=>(h==null?void 0:h.ID)!==t.ID).length)>0?n.value[t==null?void 0:t.ContractID]=(i=s.basketList)==null?void 0:i[t==null?void 0:t.ContractID].filter(h=>(h==null?void 0:h.ID)!==t.ID):delete n.value[t==null?void 0:t.ContractID])})}function b(){}function D(){}function C(t,c){var l,i;o.emit("open-modal",{component:"InvoiceMake",data:{ItemID:c,TypeID:(i=(l=I.value)==null?void 0:l[c])==null?void 0:i.TypeID,...t}})}function a(t){delete n.value[t]}return window.FormGet=b.bind(this),window.Mobile=D.bind(this),{getBasket:f,getContracts:I,getServices:y,basketContent:n,totalPrice:g,deleteFromBasket:m,choosePaymentSystem:C,basketTableFields:Z}}},Pt=N(Dt,[["render",bt],["__scopeId","data-v-740c8363"]]);export{Pt as default};
