import{_ as se}from"./EmptyStateBlock-D6U_EDq6.js";import{m as je,r as Ee,Y as Ue,v as Ve,L as Ae}from"./bootstrap-vue-next-3DpAa4tb.js";import{_ as Te}from"./IconDots-BE2XsWZ6.js";import{_ as He}from"./IconCard-jY7IitfY.js";import{_ as Me}from"./Helper-BWCpStXX.js";import{_ as Re}from"./StatusBadge-B65ys1I-.js";import{_ as Ge}from"./ClausesKeeper-DVJgfLR3.js";import{_ as We,a as ze}from"./IconButtonBack-D0IRTKQ9.js";import{_ as Fe}from"./ButtonDefault-CghIUDY0.js";import{u as ne,r as y,f as A,H as oe,c as L,o as p,a,C as B,b as l,n as K,I as G,t as S,J as W,w as c,e as O,h as T,E as qe,F as z,v as re,d as ae,x as ie,g as le,D as V,U as Ke,i as Ye}from"./index-CipWZKo_.js";import{u as ce,_ as Je}from"./contracts-CILh9uSu.js";import{u as de}from"./services-Dmz4Qt8q.js";import{f as te}from"./time-DenPiOX5.js";import{u as Xe}from"./global-Fil99La8.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Qe}from"./BlockBalanceAgreement-2iQbaweR.js";import{u as Ze}from"./server-DA2BhLHe.js";import{s as et}from"./multiselect-DWCHRlfT.js";import"./IconClose-ChC2G6HM.js";const tt=[{key:"Several",label:"",variant:"",sortable:!1},{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"Scheme",label:"Тариф",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],st={class:"section-header"},nt={class:"title__icon"},ot={class:"btn__group"},rt={class:"group__several"},at=["onClick"],it={class:"key-field"},lt={class:"key-field"},ct={class:"key-field"},dt={class:"hosting-status__date"},ut={class:"service__controls-wrapper"},mt=["onClick"],vt={class:"btn btn--dots"},pt={__name:"ServiceListSection",props:{sectionID:{type:Number,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],setup(f,{emit:_}){const d=f,I=ae(),k=le(),v=ne(),P=ie("emitter"),w=y(!1),h=y("ID"),g=y(!0),Y=y("desc"),D=y(!1),j=y([]),b=y(null),H=ce(),E=de(),F=Xe(),x=A(()=>E?.DNSmanagerOrdersList),N=A(()=>E?.ISPswOrdersList),i=A(()=>E?.ExtraIPOrdersList);function C(){I.go(0)}async function J(){let n="";d.sectionID==5e4?n="IP адресов":d.sectionID==51e3?n="лицензии ISPsystem":d.sectionID==52e3&&(n="вторичного DNS");const s=U.value.filter((r,m)=>j.value[m]).map(r=>r.ID),o={ServiceID:d.sectionID,ItemsPay:b.value,OrdersIDs:s,...w.value&&{UseBalance:"yes"}};await F.OrdersPay(o).then(r=>{r==="Basket"?I.push("/Basket"):r?.Status==="Ok"&&(D.value=!1,P.emit("open-modal",{component:"BalanceProlong",data:{Service:n,Message:r?.Message,Count:r?.Count}}))})}function X(n){const e=x.value;return Object.values(e).find(o=>o.OrderID==n)}const q=A(()=>H?.contractsList);function Q(n,e,s){e==5e4||e==51e3||e==52e3?De(n,e):I.push(`/ServiceOrderPay/${n}`)}function u(n,e){const s=X(n);P.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:s.ID,ServiceID:e,emitEvent:"updateServicesList",Login:s.Login}})}function Z(n,e){let s=null,o="";switch(Number(e)){case 5e4:s=Object.entries(i.value).find(([r,m])=>m),o="ExtraIPOrders";break;case 51e3:s=Object.entries(N.value).find(([r,m])=>m),o="ISPswOrders";break;case 52e3:s=Object.entries(x.value).find(([r,m])=>m),o="DNSmanagerOrders";break;default:s=Object.entries(U.value).find(([r,m])=>m),o="Orders"}s&&P.emit("open-modal",{component:"StatusHistory",data:{modeID:o,rowID:s[1].ID}})}const me=n=>{const e=ve(n);if(e){const s=e.split(","),o=s.length,r=s.join(`
`);return`Всего: ${o}
${r}`}return"Нет данных"},ve=n=>{const e=Object.entries(x.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID==n)return o.Parked}return null},pe=n=>{const e=Object.entries(N.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID===n)return o.IP}},fe=n=>{const e=Object.entries(i.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID==n)return o.Login}};function _e(){D.value=!0}function Ie(){D.value=!1}function De(n,e,s){e==51e3?I.push(`/ISPswOrderPay/${n}`):e==52e3?I.push(`/DNSmanagerOrderPay/${n}`):e==5e4&&I.push(`/ExtraIPOrderPay/${n}`)}function be(n,e,s){s.target.closest("button, a, .clickable-element")||ee(n.ID)}function ee(n){k.meta?.ServiceID==51e3?I.push(`/ISPswOrders/${n}`):I.push(`/AdditionalServices/${n}`)}function Se(n,e){P.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:n,ServiceID:e}})}function ke(n,e){let s;e==51e3?s=Object.entries(N.value).reduce((r,[m,M])=>(r[m]=M,r),{}):e==52e3&&(s=Object.entries(x.value).reduce((r,[m,M])=>(r[m]=M,r),{}));let o;for(const r in s)if(Object.hasOwnProperty.call(s,r)){const m=s[r];if(m.OrderID==n){o=m;break}}o&&F.OrderManageHosting({ServiceOrderID:o.ID,OrderID:n,ServiceID:e,XMLHttpRequest:"yes"})}const Oe=n=>{const e=Object.entries(x.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID==n)return o.Domain}return null},U=A(()=>Object.keys(v.userOrders).map(n=>({...v?.userOrders[n],ID:Number(v?.userOrders[n]?.ID)}))?.reverse()?.filter(n=>n.ServiceID==d?.sectionID));function ye(){I.push(`/AdditionalServicesOrder?ServiceID=${d?.sectionID}`)}function ge(n){if(!n)return te(new Date);const e=new Date,s=new Date(e.getTime()+n*24*60*60*1e3);return te(s)}return oe(()=>{j.value=U.value.map(()=>!1)}),(n,e)=>{const s=We,o=Fe,r=ze,m=je,M=Ge,Ce=Re,$e=Me,Pe=He,we=Te,he=qe("router-link"),R=Ee,xe=Ue,Ne=Ve,Le=Ae,Be=se;return p(),L(z,null,[a("div",st,[a("div",{class:K(["section-title__nowrap",{column:D.value}])},[a("div",nt,[a("h1",{class:"section-title",onClick:e[0]||(e[0]=t=>C())},S(D.value?"Продление услуг "+f.sectionData?.Item:f.sectionData?.Item),1),G(l(s,{onClick:e[1]||(e[1]=t=>Ie())},null,512),[[W,D.value]])]),G(a("div",ot,[G(l(o,{class:"btn-several",label:"Продлить несколько заказов",onClick:e[2]||(e[2]=t=>_e())},null,512),[[W,(f.sectionID==5e4||f.sectionID==51e3||f.sectionID==52e3)&&U.value.length>1]]),l(o,{label:"Заказать",onClick:e[3]||(e[3]=t=>ye())})],512),[[W,!D.value]]),G(a("div",rt,[l(r,{class:"contr period",modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t)},null,8,["modelValue"]),l(m,{id:"checkbox-balance",modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=t=>w.value=t),name:"checkbox-balance"},{default:c(()=>e[9]||(e[9]=[O(" Использовать средства с баланса ",-1)])),_:1,__:[9]},8,["modelValue"]),l(o,{label:"Продлить",onClick:e[6]||(e[6]=t=>J())})],512),[[W,D.value]])],2),l(M,{class:"additional-clauses",partition:`Header:${f.sectionData?.Code==="Default"?f.sectionID:`/${f.sectionData?.Code}Orders`}`},null,8,["partition"])]),U.value.length?(p(),B(Le,{key:0,class:"basic-table",items:U.value,fields:re(tt),"sort-by":h.value,"onUpdate:sortBy":e[7]||(e[7]=t=>h.value=t),"sort-desc":g.value,"onUpdate:sortDesc":e[8]||(e[8]=t=>g.value=t),onRowClicked:be,"sort-direction":Y.value},{"cell(Several)":c(t=>[G(l(m,{id:"checkbox-"+t.index,modelValue:j.value[t.index],"onUpdate:modelValue":$=>j.value[t.index]=$,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[W,D.value]])]),"cell(ID)":c(t=>[e[10]||(e[10]=a("span",{class:"td-mobile"},"Заказ",-1)),a("span",{class:"order-id",onClick:$=>ee(t.value)},S(t.value),9,at)]),"cell(ContractID)":c(t=>[e[11]||(e[11]=a("span",{class:"td-mobile"},"Договор",-1)),a("span",null,"#"+S(q.value[t.value]?.ID)+" / "+S(q.value[t.value]?.Customer),1)]),"cell(Scheme)":c(t=>[e[12]||(e[12]=a("span",{class:"td-mobile"},"Тариф",-1)),a("span",null,S(t.item?.SchemeName),1)]),"cell(Keys)":c(t=>[e[13]||(e[13]=a("span",{class:"td-mobile"},"Ключевые поля",-1)),a("span",it,[t.item?.Code==="ISPsw"?(p(),L(z,{key:0},[O(S(pe(t.item?.ID)),1)],64)):T("",!0)]),a("span",lt,[t.item?.Code==="ExtraIP"?(p(),L(z,{key:0},[O(S(fe(t.item?.ID)),1)],64)):T("",!0)]),a("span",ct,[O(S(Oe(t.item?.ID))+" ",1),a("pre",dt,S(me(t.item?.ID)),1)])]),"cell(StatusID)":c(t=>[l(Ce,{class:"clickable-element",status:t.value,"status-table":"Orders",onClick:$=>Z(t.item?.ID,t.item?.ServiceID)},null,8,["status","onClick"])]),"cell(ExpirationDate)":c(t=>[e[14]||(e[14]=a("span",{class:"td-mobile"},"Дата окончания",-1)),a("span",{class:K({danger:Number(t.item?.DaysRemainded)<14})},S(ge(t.item?.DaysRemainded))+" | "+S(t.item?.DaysRemainded||0)+" дн. ",3)]),"cell(UserNotice)":c(t=>[e[15]||(e[15]=a("span",{class:"td-mobile"},"Комментарий",-1)),l($e,{class:"clickable-element","user-notice":t.value,id:t.item?.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]),"cell(controls)":c(t=>[a("div",ut,[a("div",{class:"btn btn--md btn--bold clickable-element",onClick:$=>Q(t.item.ID,t.item.ServiceID,t.item.ContractID)},[l(Pe),e[16]||(e[16]=O(" Оплатить ",-1))],8,mt),l(Ne,{class:"dropdown-dots",right:""},{"button-content":c(()=>[a("span",vt,[l(we)])]),default:c(()=>[l(R,null,{default:c(()=>[l(he,{to:`/AdditionalServices/${t.item.ID}`},{default:c(()=>e[17]||(e[17]=[O("Дополнительная информация",-1)])),_:2,__:[17]},1032,["to"])]),_:2},1024),l(R,{onClick:$=>Se(t.item.ID,t.item.ServiceID)},{default:c(()=>e[18]||(e[18]=[O("Передать на другой аккаунт",-1)])),_:2,__:[18]},1032,["onClick"]),f.sectionID==51e3||f.sectionID==52e3?(p(),B(R,{key:0,onClick:$=>ke(t.item.ID,t.item.ServiceID)},{default:c(()=>e[19]||(e[19]=[O("Управлять заказом",-1)])),_:2,__:[19]},1032,["onClick"])):T("",!0),f.sectionID==52e3?(p(),B(R,{key:1,onClick:$=>u(t.item.ID,t.item.ServiceID)},{default:c(()=>e[20]||(e[20]=[O("Сменить пароль",-1)])),_:2,__:[20]},1032,["onClick"])):T("",!0),l(xe),l(R,{class:"color-red",onClick:$=>n.$emit("deleteItem",t.item)},{default:c(()=>e[21]||(e[21]=[O("Удалить",-1)])),_:2,__:[21]},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","sort-direction"])):(p(),B(Be,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}}},ft=ue(pt,[["__scopeId","data-v-f4ffc894"]]),_t={class:"section"},It={class:"container"},Dt={class:"section-header"},bt={class:"section-nav"},St=["title","onClick"],kt={class:"multiselect-option"},Ot={key:0,class:"section-body"},yt={__name:"AdditionalServices",async setup(f){let _,d;const I=y(!1),k=y(3),v=y(null),P=le(),w=ae(),h=ie("emitter"),g=de(),Y=Ze(),D=ne(),j=ce();[_,d]=V(()=>j.fetchContracts()),await _,d(),[_,d]=V(()=>D.fetchUserOrders()),await _,d(),[_,d]=V(()=>g.fetchServices()),await _,d(),[_,d]=V(()=>g.fetchDNSmanagerOrders()),await _,d(),[_,d]=V(()=>g.fetchISPswOrders()),await _,d(),[_,d]=V(()=>g.fetchExtraIPOrders()),await _,d();const b=A(()=>Object.values(g.ServicesList).filter(i=>i.ServicesGroupID!=1e3&&i.IsActive&&!i.IsHidden).sort((i,C)=>Number(i.SortID)-Number(C.SortID)).map(i=>({...i,ID:Number(i.ID),value:Number(i.ID)}))),H=Number(P.query.ServiceID)||P.meta?.ServiceID||null;H&&b.value.find(i=>i.ID==H)?v.value=H:(v.value=b.value[0].ID,w.replace(`/AdditionalServices?ServiceID=${v.value}`));async function E(i){I.value=!0,v.value=i,i==51e3?await w.replace("/ISPswOrders"):await w.replace(`/AdditionalServices?ServiceID=${i}`),I.value=!1}function F(i){return Y.serverGroupsList.ServersGroups[i]}function x(i){h.emit("open-modal",{component:"DeleteItem",data:{id:i.ID,message:`Вы действительно хотите удалить заказ #${i.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}h.on("updateUserOrdersList",()=>{D.fetchUserOrders()}),h.on("updateServicesList",()=>{D.fetchUserOrders()}),h.on("updateDNSManagerPage",()=>{g.fetchDNSmanagerOrders()}),oe(async()=>{window.addEventListener("resize",N),N()}),Ke(()=>{window.removeEventListener("resize",N)});const N=()=>{window.innerWidth>=1536?k.value=b.length:window.innerWidth>=1280?k.value=7:window.innerWidth>=1024?k.value=5:window.innerWidth>=480?k.value=4:k.value=2};return(i,C)=>{const J=Qe,X=Je,q=ft,Q=se;return p(),L(z,null,[l(J),a("div",_t,[a("div",It,[a("div",Dt,[a("div",bt,[(p(!0),L(z,null,Ye(b.value.slice(0,k.value),u=>(p(),L("div",{key:u?.ID,class:K([{"section-link":!0,"section-link-active":v.value===u?.ID},"section-nav__item"]),title:F(u.ServersGroupID)?.Comment,onClick:Z=>E(u.ID)},S(u?.Item),11,St))),128)),b.value.length>k.value?(p(),B(re(et),{key:0,modelValue:v.value,"onUpdate:modelValue":C[0]||(C[0]=u=>v.value=u),class:K({"multiselect--white additional-service__select":!0,"additional-service__select_active":b.value.slice(k.value).find(u=>u?.ID===v.value)}),options:b.value.slice(k.value),label:"ID",onSelect:C[1]||(C[1]=u=>E(u))},{option:c(({option:u})=>[a("div",kt,S(u?.Item),1)]),caret:c(()=>[l(X,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):T("",!0)])]),I.value?T("",!0):(p(),L("div",Ot,[b.value.find(u=>u.ID==v.value)?(p(),B(q,{key:0,sectionID:v.value,sectionData:b.value.find(u=>u.ID==v.value),onDeleteItem:x},null,8,["sectionID","sectionData"])):(p(),B(Q,{key:1,label:"Услуга не найдена"}))]))])])],64)}}},Gt=ue(yt,[["__scopeId","data-v-22ee2781"]]);export{Gt as default};
