import{k as te,o as P,c as Q,a as u,n as Y,t as y,Z as W,ab as G,b as I,w as D,d as T,z as U,l as ne,F as oe,p as Ce,m as Pe,_ as ae,e as ie,g as ce,U as le,r as C,h as H,i as se,y as we,f as xe,D as Be}from"./index-aeb1df1e.js";import{u as de}from"./services-bb78f548.js";import{u as ue,_ as Ne}from"./IconArrow-a6c91ada.js";import"./postings-926be189.js";import{u as _e}from"./globalActions-3944bebb.js";import{u as Le}from"./resetServer-1c71747e.js";import{f as re}from"./useTimeFunction-8602dd60.js";import{_ as me}from"./IconCard-47752060.js";import{E as $}from"./EmptyStateBlock-b0a120e4.js";import{S as ve}from"./StatusBadge-ca078fa4.js";import{s as je}from"./servicesStatuses-6293b6ac.js";import{_ as Ee}from"./HelperComponent-470cfccf.js";import{s as fe}from"./multiselect-3fbc9d28.js";import{_ as Ve,B as Ie}from"./IconButtonBack-6ba1fbb0.js";import{f as Te,z as Ue,k as Ae,d as Me,C as He}from"./bootstrap-vue-next.es-c6bcf011.js";import{_ as Re}from"./IconDots-76437be9.js";import{_ as ze}from"./ClausesKeeper-90c650cc.js";import{_ as We}from"./ButtonDefault-11c4541b.js";import{B as De}from"./BlockBalanceAgreement-906c1168.js";import"./IconClose-c7c36336.js";const Ge=[{key:"Several",label:"",variant:"",sortable:!1},{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"Scheme",label:"Тариф",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],A=v=>(Ce("data-v-fab2c704"),v=v(),Pe(),v),Fe={class:"section-header"},qe={class:"title__icon"},Ke={class:"btn__group"},Xe={class:"group__several"},Ze=A(()=>u("span",{class:"td-mobile"},"Заказ",-1)),Je=["onClick"],Qe=A(()=>u("span",{class:"td-mobile"},"Договор",-1)),Ye=A(()=>u("span",{class:"td-mobile"},"Тариф",-1)),$e=A(()=>u("span",{class:"td-mobile"},"Ключевые поля",-1)),et={class:"key-field"},tt={class:"key-field"},nt={class:"key-field"},ot={class:"hosting-status__date"},st=A(()=>u("span",{class:"td-mobile"},"Статус",-1)),rt=A(()=>u("span",{class:"td-mobile"},"Дата окончания",-1)),at=A(()=>u("span",{class:"td-mobile"},"Комментарий",-1)),it={class:"service__controls-wrapper"},ct=["onClick"],lt={class:"btn btn--dots"};function dt(v,c,d,e,L,g){var R,F,q,K;const j=Ve,p=We,w=Ie,h=Te,x=ze,b=ve,B=te("Helper"),S=me,E=Re,_=te("router-link"),r=Ue,f=Ae,V=Me,l=He,M=$;return P(),Q(oe,null,[u("div",Fe,[u("div",{class:Y(["section-title__nowrap",e.isSeveral?"column":""])},[u("div",qe,[u("h1",{class:"section-title",onClick:c[0]||(c[0]=t=>e.reloadNow())},y(e.isSeveral?"Продление услуг "+((R=d.sectionData)==null?void 0:R.Item):(F=d.sectionData)==null?void 0:F.Item),1),W(I(j,{onClick:c[1]||(c[1]=t=>e.outSeveralOrders())},null,512),[[G,e.isSeveral]])]),W(u("div",Ke,[W(I(p,{class:"btn-several",label:"Продлить несколько заказов",onClick:c[2]||(c[2]=t=>e.prolongSeveralOrders())},null,512),[[G,d.sectionID==="50000"||d.sectionID==="51000"||d.sectionID==="52000"&&e.getOrders.length>1]]),I(p,{label:"Заказать",onClick:c[3]||(c[3]=t=>e.navigateToOrder())})],512),[[G,!e.isSeveral]]),W(u("div",Xe,[I(w,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":c[4]||(c[4]=t=>e.selectPeriod=t)},null,8,["modelValue"]),I(h,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":c[5]||(c[5]=t=>e.useBalance=t),name:"checkbox-balance"},{default:D(()=>[T("Использовать средства с баланса")]),_:1},8,["modelValue"]),I(p,{label:"Продлить",onClick:c[6]||(c[6]=t=>e.prolongOrders())})],512),[[G,e.isSeveral]])],2),I(x,{class:"additional-clauses",partition:`Header:${((q=d.sectionData)==null?void 0:q.Code)==="Default"?d.sectionID:`/${(K=d.sectionData)==null?void 0:K.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(P(),U(l,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":c[7]||(c[7]=t=>e.sortBy=t),"sort-desc":e.sortDesc,"onUpdate:sortDesc":c[8]||(c[8]=t=>e.sortDesc=t),onRowClicked:e.navigateToOrderPage,"sort-direction":e.sortDirection},{"cell(Several)":D(t=>[W(I(h,{id:"checkbox-"+t.index,modelValue:e.selectedRows[t.index],"onUpdate:modelValue":m=>e.selectedRows[t.index]=m,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[G,e.isSeveral]])]),"cell(ID)":D(t=>[Ze,u("span",{class:"order-id",onClick:m=>e.toItem(t.value)},y(t.value),9,Je)]),"cell(ContractID)":D(t=>{var m,k;return[Qe,u("span",null,"#"+y((m=e.getContracts[t.value])==null?void 0:m.ID)+" / "+y((k=e.getContracts[t.value])==null?void 0:k.Customer),1)]}),"cell(Scheme)":D(t=>{var m;return[Ye,u("span",null,y((m=t.item)==null?void 0:m.SchemeName),1)]}),"cell(Keys)":D(t=>{var m,k,N,X,Z,z;return[$e,u("span",et,y(((m=t.item)==null?void 0:m.Code)==="ISPsw"?e.findISPOrderIP((k=t.item)==null?void 0:k.ID):""),1),u("span",tt,y(((N=t.item)==null?void 0:N.Code)==="ExtraIP"?e.findExtraIPOrderIP((X=t.item)==null?void 0:X.ID):""),1),u("span",nt,[T(y(e.findDomainByOrderID((Z=t.item)==null?void 0:Z.ID)),1),u("pre",ot,y(e.getTitleText((z=t.item)==null?void 0:z.ID)),1)])]}),"cell(StatusID)":D(t=>[st,I(b,{class:"clickable-element",status:t.value,"status-table":"Orders",onClick:m=>{var k,N;return e.openHistoryStatuses((k=t.item)==null?void 0:k.ID,(N=t.item)==null?void 0:N.ServiceID)}},null,8,["status","onClick"])]),"cell(ExpirationDate)":D(t=>{var m,k,N;return[rt,u("span",{class:Y({danger:Number((m=t.item)==null?void 0:m.DaysRemainded)<14})},y(e.calculateExpirationDate((k=t.item)==null?void 0:k.DaysRemainded))+" | "+y(((N=t.item)==null?void 0:N.DaysRemainded)||0)+" дн.",3)]}),"cell(UserNotice)":D(t=>{var m;return[at,I(B,{class:"clickable-element","user-notice":t.value,id:(m=t.item)==null?void 0:m.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":D(t=>[u("div",it,[u("div",{class:"btn btn--md btn--bold clickable-element",onClick:m=>e.handlePayment(t.item.ID,t.item.ServiceID,t.item.ContractID)},[I(S),T("Оплатить")],8,ct),I(V,{class:"dropdown-dots",right:""},{"button-content":D(()=>[u("div",lt,[I(E)])]),default:D(()=>[I(r,null,{default:D(()=>[I(_,{to:`/AdditionalServices/${t.item.ID}`},{default:D(()=>[T("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),I(r,{onClick:m=>e.transferItem(t.item.ID,t.item.ServiceID)},{default:D(()=>[T("Передать на другой аккаунт")]),_:2},1032,["onClick"]),d.sectionID==="51000"||d.sectionID==="52000"?(P(),U(r,{key:0,onClick:m=>e.orderManage(t.item.ID,t.item.ServiceID)},{default:D(()=>[T("Управлять заказом")]),_:2},1032,["onClick"])):ne("",!0),d.sectionID==="52000"?(P(),U(r,{key:1,onClick:m=>e.openPasswordChange(t.item.ID,t.item.ServiceID)},{default:D(()=>[T("Сменить пароль")]),_:2},1032,["onClick"])):ne("",!0),I(f),I(r,{class:"color-red",onClick:m=>v.$emit("deleteItem",t.item)},{default:D(()=>[T("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","onRowClicked","sort-direction"])):(P(),U(M,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const ut={components:{BlockSelectPeriod:Ie,EmptyStateBlock:$,StatusBadge:ve,IconCard:me,Helper:Ee,Multiselect:fe},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],async setup(v){const c=ie(),d=ce(),e=le("emitter"),L=C(!1),g=C("ID"),j=C(!0),p=C("desc"),w=C(!1),h=C([]),x=C(null),b=C(null),B=ue(),S=de(),E=_e(),_=H(()=>S==null?void 0:S.DNSmanagerOrdersList),r=H(()=>S==null?void 0:S.ISPswOrdersList),f=H(()=>S==null?void 0:S.ExtraIPOrdersList);function V(){c.go(0)}async function l(){let s="";v.sectionID==="50000"?s="IP адресов":v.sectionID==="51000"?s="лицензии ISPsystem":v.sectionID==="52000"&&(s="вторичного DNS"),console.log(h.value);const o=J.value.filter((i,O)=>h.value[O]),n=o.map(i=>i.ID),a={ServiceID:v.sectionID,ItemsPay:b.value,OrdersIDs:n,...L.value&&{UseBalance:"yes"}};await E.OrdersPay(a).then(i=>{console.log(i),i==="Basket"?(console.log("Success"),c.push("/Basket")):(i==null?void 0:i.Status)==="Ok"&&(w.value=!1,e.emit("open-modal",{component:"BalanceProlong",data:{Service:s,Message:i==null?void 0:i.Message,Count:i==null?void 0:i.Count}}))}),console.log("Selected Orders:",o),console.log("_contract_select:",x.value),console.log("selectPeriod:",b.value)}function M(s){const o=_.value,n=String(s),a=Object.values(o).find(i=>String(i.OrderID)===n);return console.log(a),a}const R=H(()=>B==null?void 0:B.contractsList);function F(s,o,n){o==="50000"||o==="51000"||o==="52000"?z(s,o):c.push(`/ServiceOrderPay/${s}`)}function q(s,o){console.log(s);const n=M(s);e.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:n.ID,ServiceID:o,emitEvent:"updateServicesList",Login:n.Login}})}function K(s,o){let n=null,a="";switch(o){case"50000":n=Object.entries(f.value).find(([i,O])=>O),a="ExtraIPOrders";break;case"51000":n=Object.entries(r.value).find(([i,O])=>O),a="ISPswOrders";break;case"52000":n=Object.entries(_.value).find(([i,O])=>O),a="DNSmanagerOrders";break;default:n=Object.entries(J.value).find(([i,O])=>O),a="Orders"}n&&e.emit("open-modal",{component:"StatusHistory",data:{modeID:a,rowID:n[1].ID}})}const t=s=>{const o=m(s);if(o){const n=o.split(","),a=n.length,i=n.join(`
`);return`Всего: ${a}
${i}`}return"Нет данных"},m=s=>{const o=Object.entries(_.value).reduce((n,[a,i])=>(n[a]=i,n),{});for(const n in o)if(Object.hasOwnProperty.call(o,n)){const a=o[n];if(String(a.OrderID)===String(s))return a.Parked}return null},k=s=>{const o=Object.entries(r.value).reduce((n,[a,i])=>(n[a]=i,n),{});for(const n in o)if(Object.hasOwnProperty.call(o,n)){const a=o[n];if(String(a.OrderID)===String(s))return a.IP}},N=s=>{const o=Object.entries(f.value).reduce((n,[a,i])=>(n[a]=i,n),{});for(const n in o)if(Object.hasOwnProperty.call(o,n)){const a=o[n];if(String(a.OrderID)===String(s))return a.Login}};function X(){w.value=!0}function Z(){w.value=!1}function z(s,o,n){o==="51000"?c.push(`/ISPswOrderPay/${s}`):o==="52000"?c.push(`/DNSmanagerOrderPay/${s}`):o==="50000"&&c.push(`/ExtraIPOrderPay/${s}`)}function ge(s,o,n){n.target.closest("button, a, .clickable-element")||c.push(`/AdditionalServices/${s.ID}`)}function Oe(s){c.push(`/AdditionalServices/${s}`)}function be(s,o){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:s,ServiceID:o}})}function ke(s,o){let n;o==="51000"?n=Object.entries(r.value).reduce((i,[O,ee])=>(i[O]=ee,i),{}):o==="52000"&&(n=Object.entries(_.value).reduce((i,[O,ee])=>(i[O]=ee,i),{}));let a;for(const i in n)if(Object.hasOwnProperty.call(n,i)){const O=n[i];if(String(O.OrderID)===String(s)){a=O;break}}a&&E.OrderManageHosting({ServiceOrderID:a.ID,OrderID:s,ServiceID:o,XMLHttpRequest:"yes"})}const ye=s=>{const o=Object.entries(_.value).reduce((n,[a,i])=>(n[a]=i,n),{});for(const n in o)if(Object.hasOwnProperty.call(o,n)){const a=o[n];if(String(a.OrderID)===String(s))return a.Domain}return null},J=H(()=>{var s,o;return(o=(s=Object.keys(d==null?void 0:d.userOrders).map(n=>{var a;return{...d==null?void 0:d.userOrders[n],ID:Number((a=d==null?void 0:d.userOrders[n])==null?void 0:a.ID)}}))==null?void 0:s.reverse())==null?void 0:o.filter(n=>n.ServiceID===(v==null?void 0:v.sectionID))});function pe(){c.push(`/AdditionalServicesOrder?ServiceID=${v==null?void 0:v.sectionID}`)}function he(s){if(!s)return re(new Date);const o=new Date,n=new Date(o.getTime()+s*24*60*60*1e3);return re(n)}return se(()=>{h.value=J.value.map(()=>!1)}),await S.fetchDNSmanagerOrders(),await S.fetchISPswOrders(),await S.fetchExtraIPOrders(),{authStore:d,getOrders:J,getContracts:R,sortBy:g,sortDesc:j,sortDirection:p,navigateToOrder:pe,servicesStatuses:je,oneTimeWorksFields:Ge,calculateExpirationDate:he,getDNSmanagerOrders:_,findDomainByOrderID:ye,findParkedByOrderID:m,getTitleText:t,transferItem:be,orderManage:ke,servicePay:z,handlePayment:F,navigateToOrderPage:ge,openHistoryStatuses:K,toItem:Oe,openPasswordChange:q,reloadNow:V,prolongSeveralOrders:X,isSeveral:w,selectedRows:h,_contract_select:x,selectPeriod:b,prolongOrders:l,outSeveralOrders:Z,useBalance:L,findISPOrderIP:k,findExtraIPOrderIP:N}}},Se=ae(ut,[["render",dt],["__scopeId","data-v-fab2c704"]]),_t={class:"section"},mt={class:"container"},vt={class:"section-header"},ft={class:"section-nav"},It=["title","onClick"],Dt={class:"multiselect-option"},St={class:"section-body"};function gt(v,c,d,e,L,g){var b,B,S,E,_,r,f,V;const j=De,p=Ne,w=te("Multiselect"),h=Se,x=$;return P(),Q(oe,null,[I(j),u("div",_t,[u("div",mt,[u("div",vt,[u("div",ft,[(P(!0),Q(oe,null,we((b=e.getServices)==null?void 0:b.slice(0,e.visibleItemsCount),l=>{var M;return P(),Q("div",{class:Y(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(l==null?void 0:l.ID)}]),title:(M=e.getServerGroup(l==null?void 0:l.ServersGroupID))==null?void 0:M.Comment,onClick:R=>e.switchToSection(l==null?void 0:l.ID)},y(l==null?void 0:l.Item),11,It)}),256)),((B=e.getServices)==null?void 0:B.length)>e.visibleItemsCount?(P(),U(w,{key:0,modelValue:e.section,"onUpdate:modelValue":c[0]||(c[0]=l=>e.section=l),class:Y({"multiselect--white additional-service__select":!0,"additional-service__select_active":(E=e.getServices)==null?void 0:E.slice(e.visibleItemsCount,(S=e.getServices)==null?void 0:S.length).find(l=>(l==null?void 0:l.ID)===e.section)}),options:(r=e.getServices)==null?void 0:r.slice(e.visibleItemsCount,(_=e.getServices)==null?void 0:_.length),label:"ID",onSelect:c[1]||(c[1]=l=>e.switchToSection(l))},{option:D(({option:l})=>[u("div",Dt,y(l==null?void 0:l.Item),1)]),caret:D(()=>[I(p,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):ne("",!0)])]),u("div",St,[(f=e.getServices)!=null&&f.find(l=>l.ID===e.section)?(P(),U(h,{key:0,sectionID:e.section,sectionData:(V=e.getServices)==null?void 0:V.find(l=>l.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(P(),U(x,{key:1,label:"Услуга не найдена"}))])])])],64)}const Ot={components:{ServiceListSection:Se,emptyStateBlock:$,Multiselect:fe,BlockBalanceAgreement:De},async setup(){const v=C(3);let c=()=>{window.innerWidth>=1920?v.value=9:window.innerWidth>=1600?v.value=7:window.innerWidth>=1440?v.value=6:window.innerWidth>=1200?v.value=5:window.innerWidth>=992?v.value=4:v.value=3};const d=xe(),e=ie(),L=le("emitter"),g=de(),j=Le();_e();const p=ce(),w=ue(),h=C(null);L.on("updateUserOrdersList",()=>{p.fetchUserOrders()});const x=H(()=>{var _;return(_=Object.keys(g==null?void 0:g.ServicesList))==null?void 0:_.map(r=>{var f;return{...g==null?void 0:g.ServicesList[r],value:(f=g==null?void 0:g.ServicesList[r])==null?void 0:f.ID}}).filter(r=>(r==null?void 0:r.ServicesGroupID)!=="1000"&&(r==null?void 0:r.IsActive)&&!(r!=null&&r.IsHidden)).sort((r,f)=>Number(r==null?void 0:r.SortID)<Number(f==null?void 0:f.SortID)?-1:Number(r==null?void 0:r.SortID)>Number(f==null?void 0:f.SortID)?1:0)}),b=C(null);L.on("updateServicesList",()=>{p.fetchUserOrders()}),L.on("updateDNSManagerPage",()=>{g.fetchDNSmanagerOrders()});function B(_){e.replace(`/AdditionalServices?ServiceID=${_}`),b.value=_}function S(_){var r,f;return(f=(r=j==null?void 0:j.serverGroupsList)==null?void 0:r.ServersGroups)==null?void 0:f[_]}function E(_){L.emit("open-modal",{component:"DeleteItem",data:{id:_.ID,message:`Вы действительно хотите удалить заказ #${_.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}return se(()=>{var _,r;(_=x.value)!=null&&_.find(f=>{var V;return(f==null?void 0:f.ID)===((V=d==null?void 0:d.query)==null?void 0:V.ServiceID)})?b.value=(r=d==null?void 0:d.query)==null?void 0:r.ServiceID:e.replace(`/AdditionalServices?ServiceID=${b.value}`)}),se(()=>{window.addEventListener("resize",c),c()}),Be(()=>{window.removeEventListener("resize",c)}),await g.fetchServices().then(()=>{var _,r;b.value=(r=(_=x.value)==null?void 0:_[0])==null?void 0:r.ID}),await w.fetchContracts(),await p.fetchUserOrders(),await g.fetchDNSmanagerOrders(),await g.fetchISPswOrders(),await g.fetchExtraIPOrders(),{section:b,deleteItem:E,getServices:x,additionalServicesValue:h,switchToSection:B,getServerGroup:S,visibleItemsCount:v}}},Rt=ae(Ot,[["render",gt],["__scopeId","data-v-ba33f686"]]);export{Rt as default};
