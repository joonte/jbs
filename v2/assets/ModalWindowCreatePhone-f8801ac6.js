import{_ as b}from"./ButtonDefault-7c216fc6.js";import{_ as E}from"./BasicInput-be1c88a0.js";import{f as k,u as P,S as B,e as D,r as w,g as u,h as A,O as R,o as U,c as $,a as h,b as f,a2 as x}from"./index-5e313302.js";import"./component-6a5a025c.js";const V={class:"modal__body"},q=h("div",{class:"list-item__title"},"Добавление номера телефона",-1),N={class:"modal__input-row"},H={__name:"ModalWindowCreatePhone",emits:["modalClose","buttonClicked"],setup(L,{emit:C}){const c=k(),g=P(),v=B("emitter"),d=D(),l=w(""),S=u(()=>{var t,e;return(e=(t=g.ConfigList)==null?void 0:t.Messages)==null?void 0:e.Prompts}),i=u(()=>c.userInfo),M=u(()=>{var t;return Object.keys((t=i.value)==null?void 0:t.Contacts).map(e=>{var o,n,r,a,s;if(!((r=(n=(o=i.value)==null?void 0:o.Contacts)==null?void 0:n[e])!=null&&r.IsHidden))return(s=(a=i.value)==null?void 0:a.Contacts)==null?void 0:s[e]}).filter(Boolean)});function y(){const t=S.value.SMS,e=/<B>Например:<\/B>\s*([^<]+)/,o=t.match(e);return o&&o[1]?`${o[1]}`:t}const m=async(t,e)=>{try{return(await x.post(t,e)).data}catch(o){throw new Error(`Error sending confirm request: ${o.message}`)}};function p(){const t={MethodID:"SMS",Address:l.value,TimeBegin:"00",TimeEnd:"00",IsActive:"yes",ContactID:"0"};c.userEditContact(t).then(e=>{e.response==="SUCCESS"&&c.fetchUserData().then(async()=>{var r;((r=d.currentRoute.value)==null?void 0:r.fullPath)!=="/profile/UserProfile"&&d.push("profile/UserProfile");const o=M.value,n=o[o.length-1];if(n){const a={Method:n.MethodID,Value:n.Address,ContactID:n.ID};try{const s=await m("/API/Confirm",a);console.log("Response from server:",s),s.Status==="Ok"?v.emit("open-modal",{component:"AcceptContact",data:{contactId:n.ID,sendConfirmRequest:m}}):console.error(`Error confirming code. Status: ${s.Status}, Message: ${s.Message}`)}catch(s){console.error("Error accepting contact:",s.message)}}})})}function I(){C("modalClose")}const _=t=>{t.key==="Enter"&&p()};return A(()=>{document.addEventListener("keyup",_)}),R(()=>{document.removeEventListener("keyup",_)}),(t,e)=>{const o=E,n=b;return U(),$("div",V,[q,h("div",N,[f(o,{label:"Номер телефона",name:"phoneNumberSMS",placeholder:y(),vertical:"",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value=r)},null,8,["placeholder","modelValue"]),f(n,{class:"profile-info__add-button",label:"Добавить контакт",onClick:p,onButtonClicked:e[1]||(e[1]=r=>I())})])])}}};export{H as default};
