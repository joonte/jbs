import{k as re,o as F,c as H,b as f,a as e,w,t as u,Z as S,ab as x,ag as B,F as Z,y as de,d as me,p as _e,m as ue,_ as ve,e as he,f as fe,U as pe,r as g,h as v,i as X,P as De,j as Se}from"./index-aeb1df1e.js";import{u as Ne}from"./domain-0f1019af.js";import{u as be}from"./IconArrow-a6c91ada.js";import{u as ge}from"./hosting-5f2b5ff4.js";import{u as Ie}from"./resetServer-1c71747e.js";import{u as ke}from"./services-bb78f548.js";import{D as z}from"./DomainCheckBlock-b647d1f9.js";import{_ as J}from"./BlockSelectContract-9de95b8e.js";import{B as Q}from"./BlockBalanceAgreement-906c1168.js";import{B as Y}from"./BlockOrderServiceWrapper-cd89416d.js";import{B as $}from"./BlockAdditionalServices-3f8c8032.js";import{s as Ce}from"./multiselect-3fbc9d28.js";import{_ as Ee}from"./ClausesKeeper-90c650cc.js";import{_ as ye}from"./ButtonDefault-11c4541b.js";import"./EmptyStateBlock-b0a120e4.js";import"./bootstrap-vue-next.es-c6bcf011.js";import"./IconClose-c7c36336.js";import"./ServiceListOrderSelection-8635e3a9.js";import"./BasicInput-67b26a5e.js";import"./component-60ac2998.js";const i=n=>(_e("data-v-be5e1aff"),n=n(),ue(),n),Oe={class:"domain-scheme"},Re={class:"section"},we={class:"container"},Ve={class:"section-header __sb"},xe=i(()=>e("h1",{class:"section-title"},"Заказ доменного имени",-1)),Be={class:"section"},Le={class:"container"},Te=i(()=>e("div",{class:"section-header"},[e("h2",{class:"section-block_title"},"Заказ хостинга"),e("div",{class:"section-label"},"Если домен будет использоваться совместно с заказом хостинга, выберите нужный из существующего списка")],-1)),Pe={class:"form multy"},Ae={class:"multi-top"},Ue={class:"multiselect-option"},Fe={class:"section"},He={class:"container"},Me=i(()=>e("div",{class:"section-header"},[e("div",{class:"section-label"},"Для успешной регистрации, домен должен быть настроен на используемых именных серверах. Для этого в панели управления хостингом необходимо добавить домен, как дополнительный или паркованный.")],-1)),je={class:"form form-grid-columns"},Ke={class:"form-col"},Ge=i(()=>e("div",{class:"form-col__title"},"Первичный сервер имен",-1)),qe={class:"form-field"},We=i(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),Ze=i(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),Xe={class:"form-col"},ze=i(()=>e("div",{class:"form-col__title"},"Вторичный сервер имен",-1)),Je={class:"form-field"},Qe=i(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),Ye=i(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),$e={class:"form-col"},eo=i(()=>e("div",{class:"form-col__title"},"Дополнительный сервер имен",-1)),oo={class:"form-field"},so=i(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),to=i(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),ao={class:"form-col"},lo=i(()=>e("div",{class:"form-col__title"},"Расширенный сервер имен",-1)),no={class:"form-field"},co=i(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),io=i(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),ro={class:"section"},mo={class:"container"},_o={class:"total-block"},uo={class:"total-block__row"},vo=i(()=>e("div",{class:"total-block__col"},"Дополнительные услуги",-1)),ho={class:"total-block__col"},fo={class:"total-block__row no-divider"},po={class:"total-block__col"},Do={class:"total-block__col"},So={class:"total-block__row total-block__row--big"},No=i(()=>e("div",{class:"total-block__col"},"Итого за 12 месяцев",-1)),bo={class:"total-block__col"};function go(n,a,m,s,N,y){var C;const L=Q,O=ye,T=Ee,I=J,p=z,k=re("Multiselect"),R=$,P=Y;return F(),H(Z,null,[f(L),e("div",Oe,[e("div",Re,[e("div",we,[e("div",Ve,[xe,f(O,{label:"Перенести домен",onClick:a[0]||(a[0]=o=>s.openTransferModal())})]),f(T)])]),f(P,{basic_title:"Домен",modelValue:s._current_section,"onUpdate:modelValue":a[8]||(a[8]=o=>s._current_section=o)},{page:w(()=>[f(I,{title:"Договор",modelValue:s.contractSelect,"onUpdate:modelValue":a[1]||(a[1]=o=>s.contractSelect=o)},null,8,["modelValue"]),f(p,{"domain-list":s.getDomains,search:s.search,onSelect:s.selectDomain},null,8,["domain-list","search","onSelect"]),e("div",Be,[e("div",Le,[Te,e("div",Pe,[f(k,{class:"hosting-select multiselect--white",modelValue:s.hostingSelect,"onUpdate:modelValue":a[2]||(a[2]=o=>s.hostingSelect=o),options:s.FILTERED_ORDERS,label:"login",placeholder:"Выберите хостинг","track-by":"value"},{singlelabel:w(({value:o})=>{var c,D;return[e("div",Ae,u(o.login),1),S(e("span",{class:"server"},"/ "+u((c=s.getHostingSchemes[o.schemeID])==null?void 0:c.Name),513),[[x,(D=s.getHostingSchemes[o.schemeID])==null?void 0:D.Name]]),S(e("span",{class:"domain"},"/ "+u(o.domain),513),[[x,o.domain]])]}),option:w(({option:o})=>{var c,D;return[e("div",Ue,u(o.login),1),S(e("span",{class:"server"},"/ "+u((c=s.getHostingSchemes[o.schemeID])==null?void 0:c.Name),513),[[x,(D=s.getHostingSchemes[o.schemeID])==null?void 0:D.Name]]),S(e("span",{class:"domain"},"/ "+u(o.domain),513),[[x,o.domain]])]}),_:1},8,["modelValue","options"])])])]),e("div",Fe,[e("div",He,[Me,e("div",je,[e("div",Ke,[Ge,e("label",qe,[We,S(e("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":a[3]||(a[3]=o=>s.formData.Ns1Name=o)},null,512),[[B,s.formData.Ns1Name]])]),Ze]),e("div",Xe,[ze,e("label",Je,[Qe,S(e("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":a[4]||(a[4]=o=>s.formData.Ns2Name=o)},null,512),[[B,s.formData.Ns2Name]])]),Ye]),e("div",$e,[eo,e("label",oo,[so,S(e("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=o=>s.formData.Ns3Name=o)},null,512),[[B,s.formData.Ns3Name]])]),to]),e("div",ao,[lo,e("label",no,[co,S(e("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=o=>s.formData.Ns4Name=o)},null,512),[[B,s.formData.Ns4Name]])]),io])])])])]),services:w(()=>[f(R,{modelValue:s._additional_service,"onUpdate:modelValue":a[7]||(a[7]=o=>s._additional_service=o),serviceSearchParams:{ServiceID:"20000"}},null,8,["modelValue"])]),_:1},8,["modelValue"]),e("div",ro,[e("div",mo,[e("div",_o,[e("div",uo,[vo,e("div",ho,u(s.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(F(!0),H(Z,null,de(s._additional_service,o=>{var c;return F(),H("div",fo,[e("div",po,u((c=s.getServices[o==null?void 0:o.ServiceID])==null?void 0:c.Name),1),e("div",Do,u(s.setToFixedService(o==null?void 0:o.Price))+" ₽",1)])}),256)),e("div",So,[No,e("div",bo,u(s.domains.length?s.domains.reduce((o,c)=>o+parseFloat(c.CostOrder),0)+ +s.ADDITIONAL_SERVICES_PRICE:"0")+" ₽",1)])]),f(O,{class:"btn--wide",label:((C=s.getContracts[s.contractSelect])==null?void 0:C.Balance)>(s.domains.length?s.domains.reduce((o,c)=>o+parseFloat(c.CostOrder),0)+ +s.ADDITIONAL_SERVICES_PRICE:0)?"Оплатить c баланса договора":"Добавить в корзину",onClick:a[9]||(a[9]=o=>s.createDomain()),"is-loading":s.isLoading,disabled:s.domains.length===0},{default:w(()=>[me("Добавить в корзину")]),_:1},8,["label","is-loading","disabled"])])])])],64)}const Io={components:{BlockSelectContract:J,DomainCheckBlock:z,BlockBalanceAgreement:Q,BlockOrderServiceWrapper:Y,BlockAdditionalServices:$,Multiselect:Ce},async setup(){const n=Ne(),a=be(),m=ge(),s=Ie(),N=ke(),y=he(),L=fe(),O=pe("emitter");O.on("updateDomainsList",()=>{n.fetchDomains()});const T=L.query.DomainName||"",I=g(null),p=g([]),k=g(null),R=g([]),P=g(""),C=g(!1),o=g({Ns1Name:"dns0.host-food.ru",Ns2Name:"dns1.host-food.ru",Ns3Name:null,Ns4Name:null}),c=v(()=>a.contractsList),D=v(()=>N==null?void 0:N.ServicesList),ee=v(()=>{let t=0;return R.value.forEach(l=>{t+=l==null?void 0:l.Price}),G(t)||0}),M=t=>{t.key==="Enter"&&t.ctrlKey&&!j.value&&q()},j=v(()=>p.value.length===0);X(()=>{document.addEventListener("keyup",M),console.log(U)}),De(()=>{document.removeEventListener("keyup",M)});const oe=v(()=>{var t;return(t=Object.keys(n==null?void 0:n.domainSchemes))==null?void 0:t.map(l=>{var r;return{...n==null?void 0:n.domainSchemes[l],value:(r=n==null?void 0:n.domainSchemes[l])==null?void 0:r.ID}})}),se=v(()=>m==null?void 0:m.hostingSchemes),K=v(()=>Object.keys(m==null?void 0:m.hostingList).map(t=>m==null?void 0:m.hostingList[t])),A=v(()=>m==null?void 0:m.hostingList),U=v(()=>{const t=Object.keys(A.value).map(l=>{const r=A.value[l];return{value:r.ID,login:r.Login,customer:r.Customer,domain:r.Domain,schemeID:r.SchemeID}});return t.unshift({value:0,login:"Без хостинга",customer:"",domain:""}),t}),te=v(()=>{var t;return(t=s==null?void 0:s.serverGroupsList)==null?void 0:t.Servers});Se(()=>k.value,t=>{const l=K.value.find(r=>r.ID===t);l?(o.value.Ns1Name=l.Ns1Name,o.value.Ns2Name=l.Ns2Name,o.value.Ns3Name=l.Ns3Name,o.value.Ns4Name=l.Ns4Name):(o.value.Ns1Name="dns0.host-food.ru",o.value.Ns2Name="dns1.host-food.ru",o.value.Ns3Name=null,o.value.Ns4Name=null)});function ae(t){return Number(t).toFixed(2)||0}function G(t){return Number(t).toFixed(2)||0}async function le(t){var l;for(const r of R.value){let V="SUCCESS",E=(l=D.value[r.ServiceID])==null?void 0:l.Code;if(await N.ServiceOrder({Code:E,DependOrderID:t,...r,ContractID:I.value}).then(({result:_,info:d,error:h})=>{if(_==="SUCCESS"){let b={};E==="Default"?b.ServiceOrderID=d==null?void 0:d.ServiceOrderID:b[`${E}OrderID`]=d==null?void 0:d.ServiceOrderID,N.ServiceOrderPay(E,b,{XMLHttpRequest:"yes"}).then(ie=>{let{result:W,error:ko}=ie;W==="SUCCESS"?y.push("/AdditionalServices"):W==="BASKET"&&y.push("/Basket")})}else V="ERROR"}),V==="ERROR")break}}async function q(){C.value=!0;let t=0;const l=[],r=()=>{if(t<p.value.length){const _=p.value[t];n.DomainOrder({ContractID:I.value,Domain:`${_.line}${_.line&&_.Name?"."+_.Name:""}`,DomainName:_.line,DomainSchemeID:_.value,DomainZone:_.Name,IsPrivateWhoIs:"yes",HostingOrderID:k.value,...o.value}).then(({result:d,info:h,error:b})=>{if(d==="SUCCESS")return t===0&&le(h==null?void 0:h.OrderID),n.DomainOrderPay({DomainOrderID:h==null?void 0:h.DomainOrderID});throw new Error(b)}).then(d=>{let{result:h,error:b}=d;l.push({result:h,error:b})}).catch(d=>{console.error("An error occurred:",d),l.push({result:"ERROR",error:d})}).finally(()=>{t++,setTimeout(r,1e3)})}else C.value=!1};r(),await new Promise(_=>{const d=()=>{t===p.value.length?_():setTimeout(d,100)};d()});const V=l.some(_=>_.result==="BASKET"),E=l.every(_=>_.result==="SUCCESS");V?y.push("/Basket"):E&&y.push("/DomainOrders")}function ne(t){p.value=t}function ce(){O.emit("open-modal",{component:"DomainTransfer",data:{}})}return X(()=>{A.value&&(k.value=U.value[0].value)}),await n.fetchDomainSchemes(),await a.fetchContracts().then(()=>{var t;c.value&&(I.value=(t=Object.keys(c==null?void 0:c.value))==null?void 0:t[0])}),await m.fetchHostingOrders(),await m.fetchHostingSchemes(),await s.fetchServerGroups(),await N.fetchServices(),{contractSelect:I,selectDomain:ne,domains:p,hostingSelect:k,getDomains:oe,getContracts:c,getHostingOrders:K,getServerGroup:te,formData:o,isLoading:C,createDomain:q,buttonDisabled:j,FILTERED_ORDERS:U,getHostingSchemes:se,search:T,openTransferModal:ce,_additional_service:R,_current_section:P,getServices:D,ADDITIONAL_SERVICES_PRICE:ee,setToFixed:ae,setToFixedService:G}}},qo=ve(Io,[["render",go],["__scopeId","data-v-be5e1aff"]]);export{qo as default};
