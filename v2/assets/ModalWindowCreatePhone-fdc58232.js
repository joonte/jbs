import{_ as b}from"./ButtonDefault-5ca56e8e.js";import{_ as P}from"./BasicInput-94108c37.js";import{f as y,u as B,R as D,e as E,r as R,g as u,o as k,c as w,a as _,b as p,a2 as A}from"./index-d4c8f165.js";import"./component-4412f886.js";const $={class:"modal__body"},x=_("div",{class:"list-item__title"},"Добавление номера телефона",-1),U={class:"modal__input-row"},O={__name:"ModalWindowCreatePhone",emits:["modalClose","buttonClicked"],setup(V,{emit:f}){const c=y(),C=B(),g=D("emitter"),d=E(),l=R(""),h=u(()=>{var o,e;return(e=(o=C.ConfigList)==null?void 0:o.Messages)==null?void 0:e.Prompts}),i=u(()=>c.userInfo),v=u(()=>{var o;return Object.keys((o=i.value)==null?void 0:o.Contacts).map(e=>{var t,s,r,a,n;if(!((r=(s=(t=i.value)==null?void 0:t.Contacts)==null?void 0:s[e])!=null&&r.IsHidden))return(n=(a=i.value)==null?void 0:a.Contacts)==null?void 0:n[e]}).filter(Boolean)});function S(){const o=h.value.SMS,e=/<B>Например:<\/B>\s*([^<]+)/,t=o.match(e);return t&&t[1]?`${t[1]}`:o}const m=async(o,e)=>{try{return(await A.post(o,e)).data}catch(t){throw new Error(`Error sending confirm request: ${t.message}`)}};function M(){const o={MethodID:"SMS",Address:l.value,TimeBegin:"00",TimeEnd:"00",IsActive:"yes",ContactID:"0"};c.userEditContact(o).then(e=>{e.response==="SUCCESS"&&c.fetchUserData().then(async()=>{var r;((r=d.currentRoute.value)==null?void 0:r.fullPath)!=="/profile/UserProfile"&&d.push("profile/UserProfile");const t=v.value,s=t[t.length-1];if(s){const a={Method:s.MethodID,Value:s.Address,ContactID:s.ID};try{const n=await m("/API/Confirm",a);console.log("Response from server:",n),n.Status==="Ok"?g.emit("open-modal",{component:"AcceptContact",data:{contactId:s.ID,sendConfirmRequest:m}}):console.error(`Error confirming code. Status: ${n.Status}, Message: ${n.Message}`)}catch(n){console.error("Error accepting contact:",n.message)}}})})}function I(){f("modalClose")}return(o,e)=>{const t=P,s=b;return k(),w("div",$,[x,_("div",U,[p(t,{label:"Номер телефона",name:"phoneNumberSMS",placeholder:S(),vertical:"",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value=r)},null,8,["placeholder","modelValue"]),p(s,{class:"profile-info__add-button",label:"Добавить контакт",onClick:M,onButtonClicked:e[1]||(e[1]=r=>I())})])])}}};export{O as default};
