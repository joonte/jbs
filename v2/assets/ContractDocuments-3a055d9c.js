import{a1 as j,r as M,a2 as v,a3 as k,j as U,o as f,c as g,a as m,b as C,w as p,d as E,t as y,F as N,v as x,x as V,p as F,l as q,_ as z,u as A,a6 as G,g as I}from"./index-1c309346.js";import{u as H}from"./contracts-7b919c67.js";import{f as J,a as K}from"./useTimeFunction-8602dd60.js";import{_ as S}from"./ButtonDefault-cd183bf8.js";import{E as B}from"./EmptyStateBlock-5a6a4cd4.js";import{I as T}from"./IconDownload-6c45a612.js";const P=j("documents",()=>{const s=M(null),e=M(null);async function h(){let a="error";return await v.post(""+k.motionDocuments).then(o=>{s.value=o==null?void 0:o.data}).catch(()=>{a="error"}),a}async function n(){await v.post(""+k.contractsEnclosures).then(a=>{e.value=a.data})}async function w(a){await v.post(""+k.motionDocumentDownload,{...a}).then(o=>{var r,t;((r=o==null?void 0:o.data)==null?void 0:r.Status)==="Ok"&&D({url:(t=o==null?void 0:o.data)==null?void 0:t.Location,original_name:"Contract"})})}async function b(a){await v.post(""+k.contractEnclosureDownload,{...a}).then(o=>{var r,t;console.log(o==null?void 0:o.Status),((r=o==null?void 0:o.data)==null?void 0:r.Status)==="Ok"&&D({url:(t=o==null?void 0:o.data)==null?void 0:t.Location,original_name:"Contract"})})}function D({url:a,original_name:o}){v.get(a,{responseType:"blob"}).then(r=>{const t=new Blob([r.data],{type:"application/pdf"}),l=document.createElement("a");l.href=URL.createObjectURL(t),l.download=o,l.click(),URL.revokeObjectURL(l.href)}).catch(console.error)}return{motionDocumentsList:s,contractDocumentsList:e,motionDocumentDownload:w,contractEnclosureDownload:b,fetchMotionDocuments:h,fetchContractDocuments:n}}),Q=s=>(F("data-v-633fea9c"),s=s(),q(),s),W={class:"section"},X={class:"container"},Y={class:"section-header"},Z={class:"breadcrumb"},$=Q(()=>m("h1",{class:"section-title"},"Документы",-1)),tt={key:0,class:"grid-section"},ot={class:"list-item"},nt={class:"list-item__row"},ct={class:"list-item__row secondary-text"},at={class:"list-item"},et={class:"list-item__row"},st={class:"list-item__row secondary-text"};function rt(s,e,h,n,w,b){const D=U("router-link"),a=T,o=S,r=B;return f(),g("div",W,[m("div",X,[m("div",Y,[m("div",Z,[C(D,{class:"section-label",to:"/Contracts"},{default:p(()=>[E("Договор /")]),_:1}),C(D,{class:"section-label",to:`/ContractScheme/${s.$route.params.id}`},{default:p(()=>{var t;return[E(y((t=n.getContract)==null?void 0:t.Customer),1)]}),_:1},8,["to"])]),$,n.filterDocuments(n.getMotionDocuments)&&n.filterDocuments(n.getMotionDocuments).length>0||n.filterDocuments(n.getContractDocuments)&&n.filterDocuments(n.getContractDocuments).length>0?(f(),g("div",tt,[(f(!0),g(N,null,x(n.filterDocuments(n.getMotionDocuments),t=>(f(),g("div",ot,[m("div",nt,y(n.getMotionDocumentName(t==null?void 0:t.TypeID)),1),m("div",ct,y(n.getDocumentDate(t==null?void 0:t.CreateDate)),1),C(o,{class:"download-button",label:"Скачать",onClick:l=>n.downloadMotionDocument(t==null?void 0:t.ID)},{icon:p(()=>[C(a,{class:"download-icon"})]),_:2},1032,["onClick"])]))),256)),(f(!0),g(N,null,x(n.filterDocuments(n.getContractDocuments),t=>(f(),g("div",at,[m("div",et,y(n.getContractDocumentName(t==null?void 0:t.TypeID)),1),m("div",st,y(n.getDocumentDate(t==null?void 0:t.CreateDate)),1),C(o,{class:"download-button",label:"Скачать",onClick:l=>n.downloadContractDocument(t==null?void 0:t.ID)},{icon:p(()=>[C(a,{class:"download-icon"})]),_:2},1032,["onClick"])]))),256))])):(f(),V(r,{key:1,label:"У вас пока что нету документов"}))])])])}const lt={components:{IconDownload:T,ButtonDefault:S,EmptyStateBlock:B},async setup(){const s=H(),e=P(),h=A(),n=G(),w=I(()=>{var c;return(c=s==null?void 0:s.contractsList)==null?void 0:c[n.params.id]}),b=I(()=>e==null?void 0:e.motionDocumentsList),D=I(()=>e==null?void 0:e.contractDocumentsList),a=I(()=>h==null?void 0:h.ConfigList);function o(c){var i,u,d,_;return(_=(d=(u=(i=a.value)==null?void 0:i.MotionDocuments)==null?void 0:u.Types)==null?void 0:d[c])==null?void 0:_.Name}function r(c){var i,u,d,_,L;return(L=(_=(d=(u=(i=a.value)==null?void 0:i.Contracts)==null?void 0:u.Enclosures)==null?void 0:d.Types)==null?void 0:_[c])==null?void 0:L.Name}function t(c){return c?"от "+J(K(c)):""}function l(c){let i=[];return c&&Object.keys(c).forEach(u=>{var d,_;((d=c[u])==null?void 0:d.ContractID)===((_=w.value)==null?void 0:_.ID)&&i.push(c[u])}),i}function O(c){e.motionDocumentDownload({MotionDocumentID:c})}function R(c){e.contractEnclosureDownload({ContractEnclosureID:c})}return await s.fetchContracts(),await e.fetchMotionDocuments(),await e.fetchContractDocuments(),{getContract:w,getMotionDocuments:b,getContractDocuments:D,filterDocuments:l,getMotionDocumentName:o,getContractDocumentName:r,downloadMotionDocument:O,downloadContractDocument:R,getDocumentDate:t}}},ft=z(lt,[["render",rt],["__scopeId","data-v-633fea9c"]]);export{ft as default};
