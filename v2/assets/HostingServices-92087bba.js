import{k as Z,o as d,c as u,b as p,a as s,t as S,l as H,w as F,d as M,F as V,y as j,z as G,p as $,m as ee,_ as te,f as oe,e as se,g as re,U as ae,r as T,h as O,i as ne}from"./index-aeb1df1e.js";import{u as ce}from"./hosting-5f2b5ff4.js";import{u as le}from"./services-bb78f548.js";import{u as de}from"./resetServer-1c71747e.js";import{B as q}from"./BlockBalanceAgreement-906c1168.js";import{B as z}from"./BlockAdditionalServices-3f8c8032.js";import{E as K}from"./EmptyStateBlock-b0a120e4.js";import{_ as X}from"./ButtonDefault-11c4541b.js";import{S as J}from"./StatusBadge-ca078fa4.js";import{_ as ie}from"./ClausesKeeper-90c650cc.js";import"./IconArrow-a6c91ada.js";import"./bootstrap-vue-next.es-c6bcf011.js";import"./ServiceListOrderSelection-8635e3a9.js";import"./domain-0f1019af.js";import"./multiselect-3fbc9d28.js";import"./BasicInput-67b26a5e.js";import"./component-60ac2998.js";import"./BlockSelectContract-9de95b8e.js";import"./IconClose-c7c36336.js";const N=g=>($("data-v-f321b417"),g=g(),ee(),g),_e={class:"section"},ue={class:"container"},me={class:"section-header"},Se=N(()=>s("h1",{class:"section-title"},"Дополнительные услуги",-1)),fe={key:0,class:"section-label"},he={class:"section-nav"},ve={key:0,class:"section-body"},pe=N(()=>s("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),ge={class:"ordered-services-list"},De={class:"ordered-service-header"},Ie={class:"ordered-service-name"},ke={class:"ordered-service-status"},ye={class:"ordered-service-details"},Oe={class:"ordered-service-info"},be={key:0},Ce={class:"ordered-service-actions"},Ee={class:"section-body"},Re={key:2,class:"loading"},Ae={key:0,class:"section"},we={class:"container"},Be={class:"total-block"},He={class:"total-block__row"},Ne=N(()=>s("div",{class:"total-block__col"},"Дополнительные услуги",-1)),Pe={class:"total-block__col"},Le={class:"total-block__row no-divider"},xe={class:"total-block__col"},Ve={class:"total-block__col"},Te={class:"total-block__row total-block__row--big"},Ue=N(()=>s("div",{class:"total-block__col"},"Итого к оплате",-1)),Fe={class:"total-block__col"};function Me(g,_,c,t,f,D){var A,w,B;const l=q,b=Z("router-link"),C=ie,i=J,E=X,P=z,I=K;return d(),u(V,null,[p(l),s("div",_e,[s("div",ue,[s("div",me,[Se,t.getHostingData?(d(),u("div",fe,"Хостинг # "+S((A=t.getHostingData)==null?void 0:A.OrderID),1)):H("",!0),s("div",he,[p(b,{class:"section-nav__item",to:`/HostingOrders/${(w=t.getHostingData)==null?void 0:w.OrderID}`},{default:F(()=>[M("Хостинг")]),_:1},8,["to"]),p(b,{class:"section-nav__item active",to:`/HostingServices/${(B=t.getHostingData)==null?void 0:B.OrderID}`},{default:F(()=>[M("Услуги")]),_:1},8,["to"])])]),p(C),t.orderedServices&&t.orderedServices.length>0?(d(),u("div",ve,[pe,s("div",ge,[(d(!0),u(V,null,j(t.orderedServices,e=>{var h;return d(),u("div",{class:"ordered-service-item",key:e.ID},[s("div",De,[s("div",Ie,S(((h=t.getServices[e==null?void 0:e.ServiceID])==null?void 0:h.Name)||(e==null?void 0:e.ServiceName)||`Услуга #${e==null?void 0:e.ServiceID}`),1),s("div",ke,[p(i,{status:e==null?void 0:e.StatusID,"status-table":"Orders",onClick:L=>t.openHistoryStatuses(e==null?void 0:e.ID,e==null?void 0:e.ServiceID)},null,8,["status","onClick"])])]),s("div",ye,[s("div",Oe,[s("span",null,"Заказ # "+S(e==null?void 0:e.ID),1),e!=null&&e.DaysRemainded?(d(),u("span",be,"| Осталось дней: "+S(e==null?void 0:e.DaysRemainded),1)):H("",!0)])]),s("div",Ce,[p(E,{class:"btn--sm",label:"Перейти к заказу",onClick:L=>t.navigateToService(e==null?void 0:e.ID)},null,8,["onClick"])])])}),128))])])):H("",!0),s("div",Ee,[t.getHostingData&&t.serviceSearchParams?(d(),G(P,{key:0,modelValue:t.selectedServices,"onUpdate:modelValue":[_[0]||(_[0]=e=>t.selectedServices=e),t.handleServicesUpdate],"service-search-params":t.serviceSearchParams},null,8,["modelValue","service-search-params","onUpdate:modelValue"])):t.isLoading?(d(),u("div",Re,"Загрузка...")):(d(),G(I,{key:1,label:"Заказ не найден"}))])])]),t.selectedServices&&t.selectedServices.length>0?(d(),u("div",Ae,[s("div",we,[s("div",Be,[s("div",He,[Ne,s("div",Pe,S(t.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(d(!0),u(V,null,j(t.selectedServices,e=>{var h;return d(),u("div",Le,[s("div",xe,S((h=t.getServices[e==null?void 0:e.ServiceID])==null?void 0:h.Name),1),s("div",Ve,S(t.setToFixedService(e==null?void 0:e.Price))+" ₽",1)])}),256)),s("div",Te,[Ue,s("div",Fe,S(t.ADDITIONAL_SERVICES_PRICE)+" ₽",1)])]),p(E,{class:"btn--wide",disabled:!t.selectedServices||t.selectedServices.length===0||t.isOrderLoading,"is-loading":t.isOrderLoading,label:"Заказать дополнительные услуги",onClick:_[1]||(_[1]=e=>t.orderServices())},null,8,["disabled","is-loading"])])])):H("",!0)],64)}const je={components:{BlockBalanceAgreement:q,BlockAdditionalServices:z,emptyStateBlock:K,ButtonDefault:X,StatusBadge:J},async setup(){const g=oe(),_=se(),c=ce(),t=le(),f=re();de();const D=ae("emitter"),l=T([]),b=T(!0),C=T(!1),i=O(()=>c!=null&&c.hostingList?Object.keys(c.hostingList).map(r=>c.hostingList[r]).find(r=>r&&String(r.OrderID)===String(g.params.id)):null),E=O(()=>{var o;return!((o=i.value)!=null&&o.SchemeID)||!(c!=null&&c.hostingSchemes)?null:c.hostingSchemes[i.value.SchemeID]}),P=O(()=>!i.value||!E.value?null:{ServiceID:i.value.ServiceID,ServersGroupID:E.value.ServersGroupID}),I=O(()=>(t==null?void 0:t.ServicesList)||{}),A=O(()=>{var y;if(!((y=i.value)!=null&&y.OrderID)||!(f!=null&&f.userOrders))return[];const o=i.value.OrderID;return Object.keys(f.userOrders).map(a=>f.userOrders[a]).filter(a=>{const v=String(a==null?void 0:a.DependOrderID)===String(o),R=a==null?void 0:a.ServiceID,m=I.value[a.ServiceID];return v&&R&&m}).sort((a,v)=>Number(a==null?void 0:a.ID)-Number(v==null?void 0:v.ID))}),w=O(()=>{if(!l.value||!Array.isArray(l.value))return 0;let o=0;return l.value.forEach(n=>{n&&typeof n.Price=="number"&&(o+=n.Price)}),e(o)});function B(o){l.value=o||[]}function e(o){return o==null?"0.00":Number(o).toFixed(2)||"0.00"}async function h(){var o,n,r;if(!(!l.value||!Array.isArray(l.value)||l.value.length===0))for(const k of l.value){if(!k)continue;let y="SUCCESS",a=(o=I.value[k.ServiceID])==null?void 0:o.Code;const v={Code:a,DependOrderID:(n=i.value)==null?void 0:n.OrderID,...k,ContractID:(r=i.value)==null?void 0:r.ContractID};try{const{result:R,info:m,error:Ge}=await t.ServiceOrder(v);if(R==="SUCCESS"){let x={};a==="Default"?x.ServiceOrderID=m==null?void 0:m.ServiceOrderID:x[`${a}OrderID`]=m==null?void 0:m.ServiceOrderID;const Y=await t.ServiceOrderPay(a,x,{XMLHttpRequest:"yes"});let{result:U,error:qe}=Y;U==="SUCCESS"?(D.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),l.value=[],_.push("/AdditionalServices")):U==="BASKET"&&_.push("/Basket")}else y="ERROR",D.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(R){console.error("Ошибка при заказе услуги:",R),y="ERROR",D.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(y==="ERROR")break}}async function L(){C.value=!0;try{await h()}catch(o){console.error("Ошибка при заказе услуг:",o),D.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{C.value=!1}}function Q(o){const n=Object.values(I.value).find(k=>k.ID===o);if(!n){_.push(`/AdditionalServices/${o}`);return}const r=n.Code;r==="Default"||r==="DNSmanager"||r==="ISPsw"||r==="ExtraIP"?_.push(`/AdditionalServices/${o}`):_.push(`/${r}Orders/${o}`)}function W(o,n){let r="Orders";n==="50000"?r="ExtraIPOrders":n==="51000"?r="ISPswOrders":n==="52000"&&(r="DNSmanagerOrders"),D.emit("open-modal",{component:"StatusHistory",data:{modeID:r,rowID:o}})}return ne(async()=>{try{await c.fetchHostingOrders(),await c.fetchHostingSchemes(),await t.fetchServices(),await f.fetchUserOrders()}catch(o){console.error("Ошибка загрузки данных:",o)}finally{b.value=!1}}),{getHostingData:i,serviceSearchParams:P,selectedServices:l,getServices:I,orderedServices:A,ADDITIONAL_SERVICES_PRICE:w,handleServicesUpdate:B,setToFixedService:e,orderServices:L,isLoading:b,isOrderLoading:C,navigateToService:Q,openHistoryStatuses:W}}},it=te(je,[["render",Me],["__scopeId","data-v-f321b417"]]);export{it as default};
