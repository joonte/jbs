import{_ as K}from"./FormInputSearch-aa64849b.js";import{_ as Q}from"./ClausesKeeper-69d31679.js";import{_ as W}from"./ButtonDefault-34d9e627.js";import{_ as x,o as $,c as B,b as r,a as e,m as X,r as g,h as U,w as n,t as v,L as k,k as Y,p as R,l as O,e as A,g as L,j as Z,ao as G,d as P,u as ee,R as te,a7 as oe,ag as j,x as q,F as se}from"./index-33bd9cf4.js";import{u as M}from"./contracts-141debab.js";import{S as ae}from"./SlotPageTitle-738a0e82.js";import{F as ne}from"./FormTabs-c26dc2b9.js";import{F as le,z as re,d as ce,C as z}from"./bootstrap-vue-next.es-6bb0e5cd.js";import{_ as _e}from"./IconDots-463e8bba.js";import{f as ie,a as ue}from"./useTimeFunction-8602dd60.js";import{_ as pe}from"./IconCard-c2e605c3.js";import{s as de}from"./multiselect-acf9ef65.js";import{S as me}from"./StatusBadge-b80983a6.js";import{B as ve}from"./BlockBalanceAgreement-5028e9bc.js";import"./IconPlus-5f47af9a.js";import"./IconSearch-55746ee2.js";import"./IconClose-d9fbf580.js";import"./IconArrow-dadffb08.js";const fe=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"Customer",label:"Договор"},{key:"Orders",label:"Количество подключенных услуг",sortable:!0,variant:"td-gray td-order"},{key:"Balance",label:"Баланс",sortable:!0,variant:"td-gray td-order"},{key:"controls",label:"",variant:"td-controls"}];const be={class:"button-payment"},ge={class:"button-payment__text"},ye={__name:"FormButtonPayment",setup(_){return(d,u)=>($(),B("button",be,[r(pe,{class:"button-payment__icon"}),e("span",ge,[X(d.$slots,"default",{},void 0,!0)])]))}},he=x(ye,[["__scopeId","data-v-fcb8fa3c"]]);const H=_=>(R("data-v-64d83888"),_=_(),O(),_),Ce={key:0,class:"table-controls"},De=H(()=>e("span",{class:"text-success"},"First",-1)),Ie=H(()=>e("span",{class:"text-info"},"Last",-1)),ke={class:"multiselect-multiple-label"},$e={class:"multiselect-option"},Te={__name:"PaginationBlock",props:["modelValue","total_rows"],emits:["update:modelValue","updatePage"],setup(_,{emit:d}){const u=_,i=[10,25,50,100],c=g({current_page:1,per_page:10});return U(c.value,()=>{d("updatePage",c.value)}),(h,f)=>{const C=le;return u.total_rows>0?($(),B("div",Ce,[r(C,{modelValue:c.value.current_page,"onUpdate:modelValue":f[0]||(f[0]=a=>c.value.current_page=a),"total-rows":u.total_rows,"per-page":c.value.per_page,"first-number":"","last-number":""},{"first-text":n(()=>[De]),"last-text":n(()=>[Ie]),page:n(({page:a,active:y})=>[e("span",null,v((a-1)*c.value.per_page+1)+"-"+v(a*c.value.per_page),1)]),_:1},8,["modelValue","total-rows","per-page"]),r(k(de),{class:"multiselect--white",modelValue:c.value.per_page,"onUpdate:modelValue":f[1]||(f[1]=a=>c.value.per_page=a),options:i,label:"name",openDirection:"top",onInput:f[2]||(f[2]=a=>c.value.current_page=1)},{singlelabel:n(({value:a})=>[e("div",ke,[e("span",null,"Отображать "+v(a.value)+" строк",1)])]),option:n(({option:a})=>[e("div",$e,"Отображать "+v(a.name)+" строк",1)]),_:1},8,["modelValue"])])):Y("",!0)}}},J=x(Te,[["__scopeId","data-v-64d83888"]]);const S=_=>(R("data-v-3eda493e"),_=_(),O(),_),we={class:"contracts-list"},Le=S(()=>e("span",{class:"td-mobile"},"Номер",-1)),Pe={class:"td-column-heavy"},xe={class:"table-td-gray"},Be=S(()=>e("span",{class:"td-mobile"},"Дата Создания",-1)),Se={class:"d-block"},Ve=S(()=>e("span",{class:"td-mobile"},"Договор",-1)),Fe={class:"td-column-heavy"},Ne={class:"table-td-blue"},Ee=S(()=>e("span",{class:"td-mobile"},"Баланс",-1)),Ue=S(()=>e("span",{class:"td-mobile"},"Количество подключенных услуг",-1)),Re={class:"btn__group"},Oe={class:"dropdown-button"},Ae={class:"btn btn--dots"},Me={__name:"ContractsList",props:{search:{type:String,default:""}},setup(_){const d=_,u=A(),i=M(),c=g("CreateDate"),h=g(!0),f=g("desc"),C=g(10),a=g(1),y=L(()=>{var l,b;return(b=(l=Object.keys(i==null?void 0:i.contractsList))==null?void 0:l.map(s=>i==null?void 0:i.contractsList[s]))==null?void 0:b.reverse()}),T=L(()=>{var l;return(l=y.value.filter(b=>{var s;return b.Customer.toLowerCase().includes(((s=d.search)==null?void 0:s.toLowerCase())||"")}))==null?void 0:l.length});function I(l){u.push(`/Balance/${l}`)}function w(l={}){C.value=l==null?void 0:l.per_page,a.value=l==null?void 0:l.current_page}function F(l){i==null||i.contractDownload({ContractID:l})}return U(()=>d,()=>{console.log("123"),a.value=1}),(l,b)=>{const s=_e,p=Z("router-link"),m=re,N=ce,E=z;return $(),B("div",we,[r(E,{class:"basic-table",items:y.value,fields:k(fe),"show-empty":!0,filterable:[],filter:d.search,"per-page":C.value,"sort-desc":h.value,"onUpdate:sortDesc":b[0]||(b[0]=o=>h.value=o),"sort-by":c.value,"onUpdate:sortBy":b[1]||(b[1]=o=>c.value=o),"sort-direction":f.value,"current-page":a.value,"empty-text":"У вас пока нет договоров.","empty-filtered-text":"Договора не найдены."},{"cell(ID)":n(o=>{var t;return[Le,e("div",Pe,[e("div",xe,v(k(G).transformContractNumber((t=o.item)==null?void 0:t.ID)),1)])]}),"cell(CreateDate)":n(o=>{var t;return[Be,e("span",Se,v(k(ie)(k(ue)((t=o.item)==null?void 0:t.CreateDate))),1)]}),"cell(Customer)":n(o=>{var t;return[Ve,e("div",Fe,[e("div",Ne,v((t=o.item)==null?void 0:t.Customer),1)])]}),"cell(Balance)":n(o=>{var t;return[Ee,e("span",null,v((t=o.item)==null?void 0:t.Balance)+" ₽",1)]}),"cell(Orders)":n(o=>{var t;return[Ue,e("span",null,v((t=o.item)==null?void 0:t.Orders),1)]}),"cell(controls)":n(o=>[e("div",Re,[r(he,{onClick:t=>{var D;return I((D=o.item)==null?void 0:D.ID)}},{default:n(()=>[P("Пополнить баланс")]),_:2},1032,["onClick"]),e("div",Oe,[r(N,{class:"dropdown-dots",right:""},{"button-content":n(()=>[e("div",Ae,[r(s)])]),default:n(()=>[r(m,null,{default:n(()=>{var t;return[r(p,{to:`/ContractScheme/${(t=o.item)==null?void 0:t.ID}`},{default:n(()=>[P("Открыть")]),_:2},1032,["to"])]}),_:2},1024),r(m,null,{default:n(()=>{var t;return[r(p,{to:`/ContractSettings/${(t=o.item)==null?void 0:t.ID}`},{default:n(()=>[P("Изменить тип учёта")]),_:2},1032,["to"])]}),_:2},1024),r(m,{onClick:t=>{var D;return F((D=o.item)==null?void 0:D.ID)}},{default:n(()=>[P("Загрузить договор")]),_:2},1032,["onClick"])]),_:2},1024)])])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),r(J,{total_rows:T.value,onUpdatePage:w},null,8,["total_rows"])])}}},je=x(Me,[["__scopeId","data-v-3eda493e"]]),qe=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"Name",label:"Профиль",variant:"td-blue"},{key:"TemplateID",label:"Тип",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",sortable:!0,variant:"td-gray td-order"},{key:"StatusDate",label:"От статуса",sortable:!0,variant:"td-default td-order"}];const V=_=>(R("data-v-aab722c9"),_=_(),O(),_),Ge={class:"contracts-profile-list"},ze=V(()=>e("span",{class:"td-mobile"},"Номер",-1)),He={class:"d-block"},Je=V(()=>e("span",{class:"td-mobile"},"Номер",-1)),Ke=V(()=>e("span",{class:"td-mobile"},"От статуса",-1)),Qe={class:"d-block"},We=V(()=>e("span",{class:"td-mobile"},"Тип",-1)),Xe=V(()=>e("span",{class:"td-mobile"},"Статус",-1)),Ye={__name:"ContractsProfileList",props:["search"],setup(_){const d=_;A();const u=M(),i=ee(),c=te("emitter"),h=g("ID"),f=g(!0),C=g("desc"),a=g(10),y=g(1),T=L(()=>{var s,p;return(p=(s=Object==null?void 0:Object.keys(u==null?void 0:u.profileList))==null?void 0:s.map(m=>u==null?void 0:u.profileList[m]))==null?void 0:p.reverse()}),I=L(()=>{var s,p;return(p=(s=i.ConfigList)==null?void 0:s.Profiles)==null?void 0:p.Templates}),w=L(()=>{var s;return(s=T.value.filter(p=>{var m;return p.Name.toLowerCase().includes(((m=d.search)==null?void 0:m.toLowerCase())||"")}))==null?void 0:s.length});function F(s={}){a.value=s==null?void 0:s.per_page,y.value=s==null?void 0:s.current_page}function l(s){c.emit("open-modal",{component:"ProfileInfo",data:{data:s,template:I.value[s.TemplateID]}})}function b(s){return Math.floor((new Date().getTime()-s*1e3)/(1e3*60*60*24))}return(s,p)=>{const m=me,N=z,E=J;return $(),B("div",Ge,[r(N,{class:"basic-table",items:T.value,fields:k(qe),"show-empty":!0,filterable:[],filter:d.search,"per-page":a.value,"sort-desc":f.value,"onUpdate:sortDesc":p[0]||(p[0]=o=>f.value=o),"sort-by":h.value,"onUpdate:sortBy":p[1]||(p[1]=o=>h.value=o),"sort-direction":C.value,"current-page":y.value,"empty-text":"У вас пока нет профилей.","empty-filtered-text":"Профили не найдены.",onRowClicked:l},{"cell(ID)":n(o=>{var t;return[ze,e("span",He,v(k(G).transformContractNumber((t=o.item)==null?void 0:t.ID)),1)]}),"cell(Name)":n(o=>{var t;return[Je,e("span",null,v((t=o.item)==null?void 0:t.Name),1)]}),"cell(StatusDate)":n(o=>{var t;return[Ke,e("span",Qe,v(b((t=o.item)==null?void 0:t.StatusDate))+" дн.",1)]}),"cell(TemplateID)":n(o=>{var t,D;return[We,e("span",null,v((D=I.value[(t=o.item)==null?void 0:t.TemplateID])==null?void 0:D.Name),1)]}),"cell(StatusID)":n(o=>[Xe,r(m,{status:o.value,"status-table":"Profiles"},null,8,["status"])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),r(E,{total_rows:w.value,onUpdatePage:F},null,8,["total_rows"])])}}},Ze=x(Ye,[["__scopeId","data-v-aab722c9"]]);const et={class:"section"},tt={class:"container"},ot={class:"list-form"},st={class:"contracts__page"},at={__name:"Contracts",async setup(_){var I,w;let d,u;const i=oe(),c=A(),h=M(),f=[{value:"Contracts",name:"Договора"},{value:"Profiles",name:"Профили"}],C=L(()=>a.value==="Contracts"?"Договора":"Профили"),a=g("Contracts"),y=g("");function T(){a.value==="Contracts"?c.push({path:"/ContractMake"}):c.push({path:"/ProfileMake"})}return(I=i==null?void 0:i.query)!=null&&I.section?a.value=(w=i.query)==null?void 0:w.section:c.replace({query:{section:"Contracts"}}),U(a,()=>{c.replace({query:{section:a.value}})}),[d,u]=j(()=>h.fetchContracts()),await d,u(),[d,u]=j(()=>h.fetchProfiles()),await d,u(),(F,l)=>{const b=W,s=Q,p=K;return $(),B(se,null,[r(ve),e("div",et,[e("div",tt,[r(ne,{tabs:f,modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=m=>a.value=m)},null,8,["modelValue"]),r(ae,null,{title:n(()=>[P(v(C.value),1)]),buttons:n(()=>[r(b,{label:a.value==="Contracts"?"Создать договор":"Создать профиль",onClick:T},null,8,["label"])]),_:1}),r(s),e("div",ot,[r(p,{modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=m=>y.value=m)},null,8,["modelValue"])]),e("div",st,[a.value==="Contracts"?($(),q(je,{key:0,search:y.value},null,8,["search"])):($(),q(Ze,{key:1,search:y.value},null,8,["search"]))])])])],64)}}},It=x(at,[["__scopeId","data-v-2a04373f"]]);export{It as default};
