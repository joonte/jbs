import{_ as z}from"./EmptyStateBlock-D6U_EDq6.js";import{_ as J}from"./ButtonDefault-CghIUDY0.js";import{_ as Q}from"./TotalAmount.vue_vue_type_script_setup_true_lang-GfTe3s0M.js";import{_ as X}from"./BlockOrderServiceWrapper-PUSiskkx.js";import{_ as Y}from"./BlockAdditionalServices-CY_Vrm6d.js";import{_ as Z}from"./BlockOrderPayBalance-C1k6h3Ad.js";import{_ as ee}from"./BlockSelectContract-3ekz5W0S.js";import{_ as te}from"./ClausesKeeper-DVJgfLR3.js";import{g as se,_ as re}from"./BlockBalanceAgreement-2iQbaweR.js";import{O as oe,r as D,D as B,f as d,g as ae,H as le,s as ne,c as y,b as m,a as s,F as O,t as E,w as $,C as A,h as F,d as ce,o as v,i as ie}from"./index-CipWZKo_.js";import{u as ue}from"./contracts-CILh9uSu.js";import{u as de}from"./services-Dmz4Qt8q.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-3DpAa4tb.js";import"./ServiceListOrderSelection-CxiE4waM.js";import"./BasicInput-BYe5b9L8.js";import"./component-DWBAga-C.js";import"./multiselect-DWCHRlfT.js";import"./global-Fil99La8.js";import"./IconCross-C6IvNpdZ.js";import"./IconClose-ChC2G6HM.js";const ve={class:"tw-px-4 md:tw-px-8"},pe={class:"section"},_e={class:"tw-text-xl sm:tw-text-4xl"},Se={class:"tw-p-3 md:tw-p-6 tw-border tw-border-gray-200 tw-rounded tw-mt-8"},fe={class:"tw-flex tw-flex-wrap tw-gap-6 tw-mt-2"},De={class:"tw-text-gray-500 tw-text-xs"},ye={class:"tw-text-gray-800 tw-text-sm"},we={class:"tw-my-6"},Ie={key:1,class:"section"},be={__name:"DSSchemesId",async setup(he){let p,_;const U=ue(),l=oe(),w=de(),C=ae(),I=ce(),r=D(null),n=D([]),b=D(!1),c=D(null),L=D(!1);[p,_]=B(()=>l.fetchDSOrders()),await p,_(),[p,_]=B(()=>l.fetchDSSchemes()),await p,_(),[p,_]=B(()=>w.fetchServices()),await p,_();const T=d(()=>r.value===null||c.value===null),h=d(()=>U.contractsList[c.value]),K=d(()=>{const t=l.DSSchemes?.[C.params.id];return t?se(t):[]}),S=d(()=>l.DSSchemes?.[C.params.id]),G=d(()=>w?.ServicesList),M=d(()=>{let t=0;return n.value.forEach(e=>{t+=Number(e?.Price)}),t}),R=d(()=>Object.values(l.dsOrders).find(t=>t.SchemeID==C.params.id&&t.ContractId==h.ID));function j(){let t=0;return r.value?.discounts?.Bonuses.map(e=>{t+=Number(e.Economy)}),t}function H(t){const e=Number(S.value?.CostInstall)||0,a=Number(t)||0,i=(e+a).toFixed(2);return Number(i)}async function W(t){if(!(!n.value||n.value.length===0))for(const e of n.value){let a=G.value[e.ServiceID]?.Code;const{result:i,info:u,error:g}=await w.ServiceOrder({Code:a,DependOrderID:t,...e,ContractID:c.value});if(i==="SUCCESS"){let f={};a==="Default"?f.ServiceOrderID=u?.ServiceOrderID:f[`${a}OrderID`]=u?.ServiceOrderID;const k=await w.ServiceOrderPay(a,f);let{result:x,error:N}=k;x==="SUCCESS"?I.push("/AdditionalServices"):x==="BASKET"&&I.push("/Basket")}else break}}function P(){b.value=!0,l.DSOrder({ContractID:c.value,DSSchemeID:S.value.ID}).then(({result:t,info:e,error:a})=>{t==="SUCCESS"?(W(e?.OrderID),l.DSOrderPay({DSOrderID:e?.DSOrderID,DaysPayFromBallance:r.value?.daysFromBalance||0,DaysPay:r.value?.actualDays,IsChange:!0}).then(i=>{let{result:u,error:g}=i;u==="SUCCESS"?I.push("/DSOrders"):u==="BASKET"&&I.push("/Basket"),b.value=!1})):b.value=!1})}const V=t=>{t.key==="Enter"&&t.ctrlKey&&!T.value&&P()};return le(()=>{document.addEventListener("keyup",V)}),ne(()=>{document.removeEventListener("keyup",V)}),(t,e)=>{const a=re,i=te,u=ee,g=Z,f=Y,k=X,x=Q,N=J,q=z;return v(),y(O,null,[m(a),s("div",ve,[S.value?.ID?(v(),y(O,{key:0},[s("div",pe,[s("div",null,[s("h1",_e,E(S.value?.Name),1),e[4]||(e[4]=s("div",{class:"section-label"},"Выделенный сервер",-1))]),m(i)]),m(k,{basic_title:"Выделенный сервер"},{page:$(()=>[s("div",Se,[e[5]||(e[5]=s("div",{class:"tw-text-2xl"},"Конфигурация",-1)),s("div",fe,[(v(!0),y(O,null,ie(K.value,o=>(v(),y("div",{class:"tw-space-y-1",key:o.label},[s("div",De,E(o.label),1),s("div",ye,E(o.text),1)]))),128))])]),e[6]||(e[6]=s("div",{class:"section"},[s("div",{class:"section-subtitle"},"Что входит в стоимость"),s("div",{class:"text"},[s("p",null,"Для подключения дополнительных услуг"),s("ul",null,[s("li",null,"Размещение в РФ, Москва"),s("li",null,"IP адрес, с возможностью расширения"),s("li",null,"Бесплатная панель управления ISPManager Lite"),s("li",null,"Круглосуточная поддержка")])])],-1)),m(u,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),title:"Оформление услуги"},null,8,["modelValue"]),h.value?(v(),A(g,{key:0,modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value=o),contract:h.value,scheme:S.value,serviceID:4e4,order:R.value},null,8,["modelValue","contract","scheme","order"])):F("",!0)]),services:$(()=>[m(f,{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value=o),serviceSearchParams:{ServiceID:"40000",ServersGroupID:S.value?.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]),_:1}),s("div",we,[r.value?(v(),A(x,{key:0,tariff:r.value,"additional-services":n.value},null,8,["tariff","additional-services"])):F("",!0),m(N,{class:"btn--wide",label:L.value||h.value?.Balance>H(r.value?.price-j()+M.value)?"Оплатить c баланса договора":"Добавить в корзину",disabled:r.value===null||c.value===null,"is-loading":b.value,onClick:e[3]||(e[3]=o=>P())},null,8,["label","disabled","is-loading"])])],64)):(v(),y("div",Ie,[m(q,{label:"Сервер не найден"})]))])],64)}}},He=me(be,[["__scopeId","data-v-687ecce3"]]);export{He as default};
