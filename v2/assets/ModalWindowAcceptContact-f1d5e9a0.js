import{o as V,c as k,a as u,t as g,b as D,_ as A,f as w,g as m,r as d,i as x}from"./index-58c913f0.js";import{_ as B}from"./ButtonDefault-7a589010.js";import{_ as S}from"./BasicInput-b43a552c.js";import"./component-b499d283.js";const q={class:"modal__body"},O=u("div",{class:"list-item__title"},"Введите код подтверждения",-1),R={class:"list-item__subtitle"},U={class:"modal__accept-form"};function j(t,n,c,o,f,r){const l=S,i=B;return V(),k("div",q,[O,u("div",R,"Прислали "+g(o.mergedData.methodId)+" на «"+g(o.mergedData.address)+"»",1),u("div",U,[D(l,{label:"Код подтверждения",name:"mailCode",placeholder:"Введите код",modelValue:o.codeMail,"onUpdate:modelValue":n[0]||(n[0]=s=>o.codeMail=s)},null,8,["modelValue"]),D(i,{class:"modal__button",label:"Подтвердить",onClick:n[1]||(n[1]=s=>o.acceptCode())})])])}const N={props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(t,{emit:n}){const c=w(),o=m(()=>c.userInfo),f=m(()=>{var e,a;return(a=Object.keys((e=o.value)==null?void 0:e.Contacts))==null?void 0:a.map(C=>{var I,p,v,h,b;if(!((v=(p=(I=o.value)==null?void 0:I.Contacts)==null?void 0:p[C])!=null&&v.IsHidden))return(b=(h=o.value)==null?void 0:h.Contacts)==null?void 0:b[C]})}),r=d(""),l=d(t.data.contactId||""),i=d(t.data.methodId||""),s=d(t.data.address||""),y=t.data.sendConfirmRequest;x(()=>{});const M=e=>f.value.find(a=>a.ID===e),_=m(()=>{const e=M(t.data.contactId);return e?{...t.data,methodId:e.MethodID,address:e.Address}:(console.error("Контакт не найден по ID",t.data.contactId),t.data)});return{methodId:i,address:s,contactId:l,acceptCode:async()=>{const e={Method:_.value.methodId,Value:_.value.address,ContactID:t.data.contactId,Confirm:r.value};try{(await y("/API/Confirm",e)).Status==="Ok"?(n("modalClose"),await c.fetchUserData()):console.error("Ошибка подтверждения кода")}catch(a){console.error("Ошибка запроса подтверждения кода",a)}},codeMail:r,mergedData:_}}},z=A(N,[["render",j]]);export{z as default};
