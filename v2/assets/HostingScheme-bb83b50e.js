import{E as Be}from"./EmptyStateBlock-25904ff1.js";import{_ as Oe}from"./ButtonDefault-b95c906d.js";import{_ as we}from"./BasicInput-ee6974cd.js";import{f as Ee}from"./bootstrap-vue-next.es-79941670.js";import{_ as Ve}from"./BlockOrderPayBalance-b06eeb59.js";import{_ as pe,a7 as Se,e as he,r as S,i as De,o as I,c as C,a as t,n as de,t as u,b as v,Z as M,a9 as Z,m as ve,F as T,S as $e,g as R,O as Pe,ag as z,w as X,d as Ne,x as me,k as He,p as xe,l as Ue}from"./index-3af25d4c.js";import{u as Ae}from"./hosting-17cc04fb.js";import{u as Fe}from"./contracts-4f21f7b6.js";import{u as Re}from"./domain-4c41df09.js";import{u as Te}from"./services-b0ae5192.js";import{_ as Le}from"./paramsAccordionBlock-290bf0bf.js";import{D as Ke}from"./DomainCheckBlock-8d13e86c.js";import{_ as qe}from"./BlockSelectContract-bbfe1748.js";import{_ as We}from"./ClausesKeeper-1519f453.js";import je from"./BlockAdditionalServices-2c4dc605.js";import{B as Ge}from"./BlockBalanceAgreement-4b67da5f.js";import"./component-17343301.js";import"./IconHelp-f5d462d2.js";import"./globalActions-83829f94.js";import"./IconArrow-7b47b2f8.js";/* empty css                                                                             */import"./multiselect-eb4b0170.js";import"./IconClose-f49a70b0.js";import"./ServiceListOrderSelection-73ad9145.js";const ze={class:"section"},Me={class:"container"},Ze={class:"section-nav"},Je={__name:"BlockOrderServiceWrapper",props:{basic_title:{type:String,default:"basic_title"},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(H,{emit:h}){const D=H,m=Se(),E=he(),n=S("");function b(){return m.fullPath.includes("?section=Services")}function q(_=null){_?(n.value="Services",E.replace({query:{section:"Services"}})):(n.value="",E.replace({query:{}})),h("update:modelValue",_||"")}return De(()=>{m.query.section==="Services"&&(n.value="Services")}),(_,d)=>{const L=We;return I(),C(T,null,[t("div",ze,[t("div",Me,[t("div",Ze,[t("div",{class:de(["section-nav__item",[b()?"":"active"]]),onClick:d[0]||(d[0]=V=>q())},u(D.basic_title),3),t("div",{class:de(["section-nav__item",[b()?"active":""]]),onClick:d[1]||(d[1]=V=>q("Services"))},"Услуги",2)])])]),v(L),t("div",null,[M(t("div",null,[ve(_.$slots,"page",{},void 0,!0)],512),[[Z,n.value===""]]),M(t("div",null,[ve(_.$slots,"services",{},void 0,!0)],512),[[Z,n.value!==""]])])],64)}}},Qe=pe(Je,[["__scopeId","data-v-e8bb070c"]]);const J=H=>(xe("data-v-c5b5857e"),H=H(),Ue(),H),Xe={class:"hosting-sheme"},Ye={class:"section"},et={class:"container"},tt={class:"section-header"},lt={class:"section-title"},st=J(()=>t("div",{class:"section-label"},"Хостинг",-1)),ot={class:"container"},at={class:"section"},nt={class:"container"},ct={class:"total-block"},rt={class:"total-block__row divider-bottom"},it=J(()=>t("div",{class:"total-block__col"},"Цена тарифа",-1)),ut={class:"total-block__col"},_t={class:"total-block__row no-divider"},dt={class:"total-block__col"},vt={class:"total-block__col"},mt={class:"total-block__row"},pt=J(()=>t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),St={class:"total-block__col"},ht={class:"total-block__row no-divider"},Dt={class:"total-block__col"},bt={class:"total-block__col"},kt={class:"total-block__row total-block__row--big economy-line"},yt=J(()=>t("div",{class:"total-block__col red"},"Выгода",-1)),gt={class:"total-block__col flex-col"},ft={class:"red"},It={class:"total-block__row total-block__row--big"},Ct={class:"total-block__col"},Bt={class:"total-block__col"},Ot={key:1,class:"section"},wt={class:"container"},Et={__name:"HostingScheme",async setup(H){let h,D;const m=Ae(),E=Fe(),n=Re(),b=Te();$e("emitter");const q=Se(),_=he(),d=S(!1),L=S(""),V=S([]),Q=S(!1),o=S(null),K=S([]),x=S(!1),k=S(null),W=S(null),Y=S(""),ee=l=>{l.key==="Enter"&&l.ctrlKey&&!be.value&&ae()},be=R(()=>o.value===null||k.value===null),$=R(()=>{var l;return(l=m==null?void 0:m.hostingSchemes)==null?void 0:l[q.params.id]}),ke=R(()=>E==null?void 0:E.contractsList),te=R(()=>b==null?void 0:b.ServicesList),ye=R(()=>{var l;return(l=Object.keys(n==null?void 0:n.domainSchemes))==null?void 0:l.map(e=>{var i;return{...n==null?void 0:n.domainSchemes[e],value:(i=n==null?void 0:n.domainSchemes[e])==null?void 0:i.ID}})}),le=R(()=>{let l=0;return K.value.forEach(e=>{l+=e==null?void 0:e.Price}),P(l)||0});De(()=>{document.addEventListener("keyup",ee)}),Pe(()=>{document.removeEventListener("keyup",ee)});function se(){var e,i;let l=0;return(i=(e=o.value)==null?void 0:e.discounts)==null||i.Bonuses.map(y=>{l+=+y.Economy}),l}function P(l){return Number(l).toFixed(2)||0}function ge(l){V.value=l}function fe(){d.value=!1,console.log("Not")}function Ie(){d.value=!0,console.log("Own")}function Ce(l){o.value=l}async function oe(l){var e;for(const i of K.value){let y="SUCCESS",g=(e=te.value[i.ServiceID])==null?void 0:e.Code;if(await b.ServiceOrder({Code:g,DependOrderID:l,...i,ContractID:k.value}).then(({result:U,info:p,error:A})=>{if(U==="SUCCESS"){let f={};g==="Default"?f.ServiceOrderID=p==null?void 0:p.ServiceOrderID:f[`${g}OrderID`]=p==null?void 0:p.ServiceOrderID,b.ServiceOrderPay(g,f).then(N=>{let{result:c,error:a}=N;c==="SUCCESS"?_.push("/AdditionalServices}"):c==="BASKET"&&_.push("/Basket")})}else y="ERROR"}),y==="ERROR")break}}function ae(){var g,U,p,A,f,N;x.value=!0;let l=0,e,i,y;V.value.length>0&&(e=V.value[l],i=V.value.map(c=>`${c.line}${c.line&&c.Name?"."+c.Name:""}`),y=V.value.map(c=>`${c.ID}`)),d.value===!1?m.HostingOrder({ContractID:k.value,Domain:i||null,DomainName:(e==null?void 0:e.line)||null,HostingSchemeID:(g=$.value)==null?void 0:g.ID,DomainSchemeID:y||null,DomainTypeID:e!=null&&e.line?e!=null&&e.Name?"Order":"Nothing":"None"}).then(({result:c,info:a,error:j})=>{var B,O;c==="SUCCESS"?(l++,oe(a==null?void 0:a.OrderID),m.HostingOrderPay({HostingOrderID:a==null?void 0:a.HostingOrderID,DaysPayFromBallance:((B=o.value)==null?void 0:B.daysFromBalance)||0,DaysPay:(O=o.value)==null?void 0:O.actualDays}).then(F=>{let{result:w,error:G}=F;w==="SUCCESS"?_.push("/HostingOrders"):w==="BASKET"&&_.push("/Basket"),x.value=!1})):x.value=!1}):(console.log(!0),m.HostingOrder({ContractID:k.value,Domain:L.value,DomainName:(U=W.value)==null?void 0:U.line,HostingSchemeID:(p=$.value)==null?void 0:p.ID,DomainSchemeID:(A=W.value)!=null&&A.line&&((f=W.value)!=null&&f.ID)?(N=W.value)==null?void 0:N.ID:null,DomainTypeID:"Nothing"}).then(({result:c,info:a,error:j})=>{var B,O;c==="SUCCESS"?(oe(a==null?void 0:a.OrderID),m.HostingOrderPay({HostingOrderID:a==null?void 0:a.HostingOrderID,DaysPayFromBallance:((B=o.value)==null?void 0:B.daysFromBalance)||0,DaysPay:(O=o.value)==null?void 0:O.actualDays}).then(F=>{let{result:w,error:G}=F;w==="SUCCESS"?_.push("/HostingOrders"):w==="BASKET"&&_.push("/Basket"),x.value=!1})):x.value=!1}))}return[h,D]=z(()=>n.fetchDomainSchemes()),await h,D(),[h,D]=z(()=>m.fetchHostingSchemes()),await h,D(),[h,D]=z(()=>E.fetchContracts()),await h,D(),[h,D]=z(()=>b.fetchServices()),await h,D(),(l,e)=>{var A,f,N,c,a,j,B,O,F,w,G,ne,ce,re,ie,ue,_e;const i=Ve,y=Ee,g=we,U=Oe,p=Be;return I(),C(T,null,[v(Ge),t("div",Xe,[(A=$.value)!=null&&A.ID?(I(),C(T,{key:0},[t("div",Ye,[t("div",et,[t("div",tt,[t("h1",lt,u((f=$.value)==null?void 0:f.Name),1),st])])]),v(Qe,{basic_title:"Хостинг",modelValue:Y.value,"onUpdate:modelValue":e[7]||(e[7]=s=>Y.value=s)},{page:X(()=>{var s;return[v(Le,{"params-list":(s=$.value)==null?void 0:s.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),v(qe,{title:"Договор",modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=r=>k.value=r)},null,8,["modelValue"]),v(i,{contractID:k.value,scheme:$.value,serviceID:"10000",isOrderID:!1,onSelect:Ce,isBalancePay:Q.value,"onUpdate:isBalancePay":e[1]||(e[1]=r=>Q.value=r)},null,8,["contractID","scheme","isBalancePay"]),v(Ke,{disabled:d.value,"domain-list":ye.value,onClick:e[2]||(e[2]=r=>fe()),onSelect:ge},null,8,["disabled","domain-list"]),t("div",ot,[v(y,{id:"check-1",modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=r=>d.value=r),name:"checkbox-1"},{default:X(()=>[Ne("Использовать свой домен")]),_:1},8,["modelValue"]),v(g,{label:"Домен",name:"own-domain",onClick:e[4]||(e[4]=r=>Ie()),disabled:!d.value,modelValue:L.value,"onUpdate:modelValue":e[5]||(e[5]=r=>L.value=r)},null,8,["disabled","modelValue"])])]}),services:X(()=>{var s;return[v(je,{modelValue:K.value,"onUpdate:modelValue":e[6]||(e[6]=r=>K.value=r),serviceSearchParams:{ServiceID:"10000",ServersGroupID:(s=$.value)==null?void 0:s.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]}),_:1},8,["modelValue"]),t("div",at,[t("div",nt,[M(t("div",ct,[((a=(c=(N=o.value)==null?void 0:N.discounts)==null?void 0:c.Bonuses)==null?void 0:a.length)>0?(I(),C(T,{key:0},[t("div",rt,[it,t("div",ut,u(P((j=o.value)==null?void 0:j.price))+" ₽",1)]),(I(!0),C(T,null,me((O=(B=o.value)==null?void 0:B.discounts)==null?void 0:O.Bonuses,s=>(I(),C("div",_t,[t("div",dt,"Скидка "+u(s==null?void 0:s.Discount)+"% на "+u(s==null?void 0:s.Days)+" дней",1),t("div",vt,"-"+u(P(s==null?void 0:s.Economy))+" ₽",1)]))),256))],64)):He("",!0),t("div",mt,[pt,t("div",St,u(le.value)+" ₽",1)]),(I(!0),C(T,null,me(K.value,s=>{var r;return I(),C("div",ht,[t("div",Dt,u((r=te.value[s==null?void 0:s.ServiceID])==null?void 0:r.Name),1),t("div",bt,u(P(s==null?void 0:s.Price))+" ₽",1)])}),256)),M(t("div",kt,[yt,t("div",gt,[t("span",null,[t("s",null,u(P((F=o.value)==null?void 0:F.price))+" ₽",1)]),t("span",ft,"-"+u(P(se()))+" ₽",1)])],512),[[Z,((ne=(G=(w=o.value)==null?void 0:w.discounts)==null?void 0:G.Bonuses)==null?void 0:ne.length)>0]]),t("div",It,[t("div",Ct,"Итого за "+u((ce=o.value)==null?void 0:ce.label),1),t("div",Bt,u(P(((re=o.value)==null?void 0:re.price)-se()+ +le.value))+" ₽",1)])],512),[[Z,(ie=o.value)==null?void 0:ie.price]]),v(U,{class:"btn--wide",label:Q.value||((ue=ke.value[k.value])==null?void 0:ue.Balance)>((_e=o.value)==null?void 0:_e.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||k.value===null,"is-loading":x.value,onClick:e[8]||(e[8]=s=>ae())},null,8,["label","disabled","is-loading"])])])],64)):(I(),C("div",Ot,[t("div",wt,[v(p,{label:"Тариф не найден"})])]))])],64)}}},el=pe(Et,[["__scopeId","data-v-c5b5857e"]]);export{el as default};
