import{o as d,c as u,F as h,x as w,n as N,a as S,t as k,k as P,p as x,l as j,_ as $,u as b,S as F,r as y,e as L,a7 as O,g as A}from"./index-5e313302.js";import{_ as R}from"./ButtonDefault-7c216fc6.js";import{u as V}from"./invoices-5e70ed98.js";import{u as W}from"./postings-03760ecf.js";const z=e=>(x("data-v-0f4f5671"),e=e(),j(),e),E={class:"list-part"},q=z(()=>S("div",{class:"list-item__title"},"Выбрать платёжную систему",-1)),G={key:0,class:"list-row grid-net"},H=["onClick"],J=["src"],K={class:"list-item__image-title"},Q={class:"modal__error"};function T(e,p,g,o,D,C){return d(),u("div",E,[q,o.filterActiveSystems?(d(),u("div",G,[(d(!0),u(h,null,w(o.filterActiveSystems,t=>{var c;return d(),u(h,null,[t!=null&&t.IsActive?(d(),u("div",{key:0,class:N(["list-item",{"list-item_active":((c=o.paymentSystem)==null?void 0:c.id)===(t==null?void 0:t.ID)}]),onClick:_=>{o.paymentSystem={id:t==null?void 0:t.ID,type:t==null?void 0:t.Source},o.selectPaymentSystem()}},[S("img",{class:"list-item__image",src:t==null?void 0:t.Image},null,8,J),S("div",K,k(t==null?void 0:t.Description),1)],10,H)):P("",!0)],64)}),256))])):P("",!0),S("div",Q,k(o.errorMessage),1)])}const U={components:{ButtonDefault:R},props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(e,{emit:p}){const g=b(),o=V(),D=W(),C=F("emitter"),t=y(null);L(),O();const c=A(()=>g.ConfigList),_=y(null),B=A(()=>{var r;const n=c.value,l=(r=e.data)==null?void 0:r.ContractPaymentSystems;if(n!=null&&n.PaymentSystems&&l){const i=new Set(l),m=Object.keys(n.PaymentSystems).filter(a=>i.has(a)).map(a=>{const s=n.PaymentSystems[a];return String(s==null?void 0:s.IsActive)==="1"?s.Collations:null}).filter(a=>a!==null).flat().slice().sort((a,s)=>{const I=parseInt(a.SortID,10),v=parseInt(s.SortID,10);return console.log(`SortID a: ${a.SortID}, parsed: ${I}`),console.log(`SortID b: ${s.SortID}, parsed: ${v}`),isNaN(I)?1:isNaN(v)?-1:I-v});return console.log("filterActiveSystems:",m),m}else return console.log("filterActiveSystems: null"),null});function M(){var n,l,r;console.log("Props systems",(n=e.data)==null?void 0:n.ContractPaymentSystems),_.value!==null&&o.InvoiceMake({ContractID:(l=e.data)==null?void 0:l.ItemID,PaymentSystemID:(r=_.value)==null?void 0:r.type}).then(i=>{if(i.status==="success"&&i.data&&i.data.InvoiceID){p("modalClose");const f=i.data.InvoiceID;D.InvoiceDocument({InvoiceID:f}).then(m=>{C.emit("open-modal",{component:"InvoiceDocumentBasket",data:{html:m,ID:f}})})}else p("modalClose")})}return{getConfig:c,errorMessage:t,filterActiveSystems:B,selectPaymentSystem:M,paymentSystem:_}}},et=$(U,[["render",T],["__scopeId","data-v-0f4f5671"]]);export{et as default};
