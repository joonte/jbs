import{j as $,o as r,c as d,b as _,a as n,w as U,d as x,t as A,F as E,v as j,k as i,x as C,n as O,p as ee,l as le,_ as oe,u as ae,e as se,a7 as ne,r as v,g as z}from"./index-e8e4a28d.js";import{u as re}from"./contracts-f70de43e.js";import{s as ce}from"./SimpleCheckbox-fa5775bf.js";import{_ as G}from"./BasicInput-fc01a75b.js";import{P as J,T as K,S as Q}from"./PhoneInput-867b428f.js";import{u as te}from"./files-ddbaf4b8.js";import{I as W}from"./IconFile-32e4884a.js";import{I as X}from"./IconClose-c1bee414.js";import{B as Y}from"./BlockBalanceAgreement-00019440.js";import{E as ue}from"./EmptyStateBlock-b36abca5.js";import{_ as fe}from"./ButtonDefault-28022e42.js";import{f as de}from"./bootstrap-vue-next.es-6aab83a5.js";import{_ as pe}from"./IconClip-77909ead.js";import{_ as _e}from"./ClausesKeeper-cfc0f758.js";import"./component-2fc43b10.js";import"./multiselect-762d23c8.js";import"./IconArrow-0cda8946.js";const Z=h=>(ee("data-v-4afb0dbb"),h=h(),le(),h),ie={class:"section"},ve={class:"container"},he={class:"section-header"},ge={class:"breadcrumb"},be=Z(()=>n("h1",{class:"section-title"},"Редактировать договор",-1)),ke={class:"form"},ye={class:"form-row-wrapper"},Ce={class:"special-form-row"},Ve={key:0,class:"section-header inputs-block"},me={class:"section-block_title"},Ie={key:0,class:"form width-limit"},Ee={key:0,class:"form-field form-field--file form-field--basic"},Pe={class:"chat-files"},Te={class:"chat-files__item"},Se={key:1,class:"form-field form-field--file form-field--basic"},Fe={class:"chat-files"},we={class:"chat-files__item"},De=["onClick"],Le={class:"form-field form-field--file form-field--basic"},Ue={class:"form-field-input__file-wrapper"},xe={class:"form-field-input__file"},Ae=Z(()=>n("span",null,"Прикрепить документ подтверждающий личность",-1)),Oe=["innerHTML"];function Be(h,f,H,l,P,y){var L,m,a,s,c;const b=Y,t=$("router-link"),T=_e,k=G,S=J,V=K,F=Q,g=W,w=X,p=pe,D=de,B=fe,N=ue;return r(),d(E,null,[_(b),n("div",ie,[n("div",ve,[n("div",he,[n("div",ge,[_(t,{class:"section-label",to:"/Contracts"},{default:U(()=>[x("Договор /")]),_:1}),_(t,{class:"section-label",to:`/ContractScheme/${h.$route.params.id}`},{default:U(()=>{var e;return[x(A((e=l.getProfile)==null?void 0:e.Name),1)]}),_:1},8,["to"])]),be]),_(T),l.getProfile?(r(),d(E,{key:0},[n("div",ke,[(r(!0),d(E,null,j((c=(s=(a=(m=(L=l.getConfig)==null?void 0:L.Profiles)==null?void 0:m.Templates)==null?void 0:a[l.templateValue])==null?void 0:s.Template)==null?void 0:c.Attribs,(e,o)=>(r(),d("div",ye,[n("div",Ce,[e!=null&&e.Title?(r(),d("div",Ve,[n("h2",me,A(e==null?void 0:e.Title),1)])):i("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)!=="Phone"?(r(),C(k,{key:1,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":u=>l.form[o].value=u},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):i("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)==="Phone"?(r(),C(S,{key:2,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":u=>l.form[o].value=u},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):i("",!0),(e==null?void 0:e.Type)==="TextArea"?(r(),C(V,{key:3,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":u=>l.form[o].value=u},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):(e==null?void 0:e.Type)==="Select"?(r(),C(F,{key:4,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,options:e==null?void 0:e.Options,modelValue:l.form[o].value,"onUpdate:modelValue":u=>l.form[o].value=u},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):i("",!0)])]))),256))]),l.templateValue!==0?(r(),d("div",Ie,[l.fileListOld.length?(r(),d("div",Ee,[n("div",Pe,[(r(!0),d(E,null,j(l.fileListOld,(e,o)=>(r(),d("div",Te,[n("span",null,[_(g,{class:"file-icon"})]),n("span",null,A(e==null?void 0:e.name),1)]))),256))])])):i("",!0),l.fileList.length?(r(),d("div",Se,[n("div",Fe,[(r(!0),d(E,null,j(l.fileList,(e,o)=>(r(),d("div",we,[n("span",null,[_(g,{class:"file-icon"})]),n("span",null,A(e==null?void 0:e.name),1),n("button",{class:"close",onClick:u=>l.removeFile(o)},[_(w)],8,De)]))),256))])])):i("",!0),n("label",Le,[n("div",Ue,[n("input",{ref:"fileInput",type:"file",onChange:f[0]||(f[0]=(...e)=>l.fileUpload&&l.fileUpload(...e))},null,544),n("div",xe,[_(p),Ae])])]),_(D,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agree,"onUpdate:modelValue":f[1]||(f[1]=e=>l.agree=e)},{default:U(()=>[x("Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет")]),_:1},8,["modelValue"]),_(D,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agreeHandle,"onUpdate:modelValue":f[2]||(f[2]=e=>l.agreeHandle=e)},{default:U(()=>[x("Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменто и т.п.)")]),_:1},8,["modelValue"])])):i("",!0),l.createProfileErrorMessage?(r(),d("div",{key:1,class:"error-message width-limit",innerHTML:l.formErrorMessage(l.createProfileErrorMessage)},null,8,Oe)):i("",!0),l.templateValue!==0?(r(),C(B,{key:2,class:"width-limit","is-loading":l.createProfileResult==="pending",label:"Сохранить",onClick:f[3]||(f[3]=e=>l.checkForm())},null,8,["is-loading"])):i("",!0)],64)):(r(),C(N,{key:1,label:"Профиль договора не найден"}))])])],64)}const Ne={components:{TextAreaLine:K,simpleCheckbox:ce,basicInput:G,SelectLine:Q,PhoneInput:J,IconFile:W,IconClose:X,BlockBalanceAgreement:Y},async setup(){const h=ae(),f=re(),H=te(),l=se(),P=ne(),y=v(!1),b=v(!1),t=v({}),T=v(null),k=v([]),S=v([]),V=v(null),F=v(null),g=v(0),w=z(()=>h.ConfigList),p=z(()=>{var a;return(a=f.profileList)==null?void 0:a[P.params.id]});function D(){let a=!1;if(Object.keys(t.value).forEach(s=>{console.log(t.value[s].value),console.log(t.value[s]),t.value[s].value===""&&t.value[s].required?(t.value[s].error=!0,a=!0,console.log(a,"1")):(console.log(y.value),console.log(b.value),t.value[s].error=!1)}),!a&&y.value&&b.value){let s={};Object.keys(t.value).forEach(e=>{s[e]=t.value[e].value});let c=new FormData;Object.keys(t.value).forEach(e=>{var o;c.append(e,(o=t.value[e])==null?void 0:o.value)}),c.append("TemplateID",g.value),c.append("Agree",y.value),c.append("AgreeHandle",b.value),c.append("ProfileID",P.params.id),k.value.forEach((e,o)=>{c.append("Document[]",e==null?void 0:e.value)}),V.value="pending",f.createNewContract({ProfileID:P.params.id,TemplateID:g.value,Agree:y.value,AgreeHandle:b.value,...s}).then(e=>{var o;e.status==="success"?l.push("/Contracts?section=Profiles"):(console.log("Ошибка статуса",e),console.log("temp - ",s),V.value="error",F.value=(o=e.data)==null?void 0:o.Exception)})}}function B(a){k.value=k.value.filter((s,c)=>c!==a)}function N(a){return""+m(a)}function L(a){var c;let s=((c=a.target.files)==null?void 0:c[0])||null;s&&(T.value.value="",H.sendFile(s).then(e=>{k.value.push({name:s==null?void 0:s.name,value:e.slice(e.lastIndexOf("^")+1,e.length)})}))}function m(a){return a?"<div>"+(a==null?void 0:a.String)+"</div>"+m(a==null?void 0:a.Parent):""}return await f.fetchContracts().then(()=>{f.fetchProfiles().then(()=>{var a,s,c,e;g.value=(a=p.value)==null?void 0:a.TemplateID,(s=p.value)!=null&&s.Files&&(S.value=(e=Object.keys((c=p.value)==null?void 0:c.Files))==null?void 0:e.map(o=>{var u,I;return{name:(u=p.value)==null?void 0:u.Files[o].Name,value:(I=p.value)==null?void 0:I.Files[o].Name}})),Object.keys(p.value.Attribs).forEach(o=>{var u,I,M,R,q;t.value[o]={value:p.value.Attribs[o],required:((q=(R=(M=(I=(u=w.value)==null?void 0:u.Profiles)==null?void 0:I.Templates)==null?void 0:M[g.value])==null?void 0:R.Template)==null?void 0:q.Attribs[o].IsDuty)==="1",error:!1}})})}),await h.fetchConfig(),{getConfig:w,getProfile:p,templateValue:g,agreeHandle:b,fileInput:T,fileList:k,fileListOld:S,agree:y,createProfileResult:V,createProfileErrorMessage:F,checkForm:D,fileUpload:L,removeFile:B,formErrorMessage:N,form:t}}},ol=oe(Ne,[["render",Be],["__scopeId","data-v-4afb0dbb"]]);export{ol as default};
