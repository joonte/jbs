import{j as Q,o as w,c as X,a as _,n as Y,t as h,Z as R,a9 as W,b as I,w as D,d as E,y as T,k as $,F as ee,p as pe,l as he,_ as se,e as re,f as ae,S as ie,r as C,g as M,i as te,x as Ce,a7 as we,C as Pe}from"./index-3af25d4c.js";import{u as ce}from"./services-b0ae5192.js";import{u as le}from"./contracts-4f21f7b6.js";import"./postings-cc82980a.js";import{u as de}from"./globalActions-83829f94.js";import{u as xe}from"./resetServer-70a43a67.js";import{f as oe}from"./useTimeFunction-8602dd60.js";import{_ as ue}from"./IconCard-816972fe.js";import{E as Z}from"./EmptyStateBlock-25904ff1.js";import{S as _e}from"./StatusBadge-b26344fd.js";import{s as Be}from"./servicesStatuses-6293b6ac.js";import{_ as Ne}from"./HelperComponent-4ce50874.js";import{s as me}from"./multiselect-eb4b0170.js";import{_ as Le,B as ve}from"./IconButtonBack-13767f97.js";import{f as je,z as Ve,k as Ee,d as Te,C as Ue}from"./bootstrap-vue-next.es-79941670.js";import{_ as Ae}from"./IconDots-9d28e553.js";import{_ as Me}from"./ClausesKeeper-1519f453.js";import{_ as He}from"./ButtonDefault-b95c906d.js";import{B as fe}from"./BlockBalanceAgreement-4b67da5f.js";import{_ as Re}from"./IconArrow-7b47b2f8.js";import"./IconClose-f49a70b0.js";const We=[{key:"Several",label:"",variant:"",sortable:!1},{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"Scheme",label:"Тариф",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],U=v=>(pe("data-v-66c805dd"),v=v(),he(),v),ze={class:"section-header"},Ge={class:"title__icon"},Fe={class:"btn__group"},qe={class:"group__several"},Ke=U(()=>_("span",{class:"td-mobile"},"Заказ",-1)),Xe=["onClick"],Ze=U(()=>_("span",{class:"td-mobile"},"Договор",-1)),Je=U(()=>_("span",{class:"td-mobile"},"Тариф",-1)),Qe=U(()=>_("span",{class:"td-mobile"},"Ключевые поля",-1)),Ye={class:"key-field"},$e={class:"hosting-status__date"},et=U(()=>_("span",{class:"td-mobile"},"Статус",-1)),tt=U(()=>_("span",{class:"td-mobile"},"Дата окончания",-1)),nt=U(()=>_("span",{class:"td-mobile"},"Комментарий",-1)),ot={class:"service__controls-wrapper"},st=["onClick"],rt={class:"btn btn--dots"};function at(v,a,l,e,N,g){var H,z,G,F;const L=Le,y=He,P=ve,p=je,x=Me,b=_e,B=Q("Helper"),S=ue,j=Ae,u=Q("router-link"),o=Ve,f=Ee,V=Te,c=Ue,A=Z;return w(),X(ee,null,[_("div",ze,[_("div",{class:Y(["section-title__nowrap",e.isSeveral?"column":""])},[_("div",Ge,[_("h1",{class:"section-title",onClick:a[0]||(a[0]=t=>e.reloadNow())},h(e.isSeveral?"Продление услуг "+((H=l.sectionData)==null?void 0:H.Item):(z=l.sectionData)==null?void 0:z.Item),1),R(I(L,{onClick:a[1]||(a[1]=t=>e.outSeveralOrders())},null,512),[[W,e.isSeveral]])]),R(_("div",Fe,[R(I(y,{class:"btn-several",label:"Продлить несколько заказов",onClick:a[2]||(a[2]=t=>e.prolongSeveralOrders())},null,512),[[W,l.sectionID==="50000"||l.sectionID==="51000"||l.sectionID==="52000"&&e.getOrders.length>1]]),I(y,{label:"Заказать",onClick:a[3]||(a[3]=t=>e.navigateToOrder())})],512),[[W,!e.isSeveral]]),R(_("div",qe,[I(P,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":a[4]||(a[4]=t=>e.selectPeriod=t)},null,8,["modelValue"]),I(p,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":a[5]||(a[5]=t=>e.useBalance=t),name:"checkbox-balance"},{default:D(()=>[E("Использовать средства с баланса")]),_:1},8,["modelValue"]),I(y,{label:"Продлить",onClick:a[6]||(a[6]=t=>e.prolongOrders())})],512),[[W,e.isSeveral]])],2),I(x,{class:"additional-clauses",partition:`Header:${((G=l.sectionData)==null?void 0:G.Code)==="Default"?l.sectionID:`/${(F=l.sectionData)==null?void 0:F.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(w(),T(c,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":a[7]||(a[7]=t=>e.sortBy=t),"sort-desc":e.sortDesc,"onUpdate:sortDesc":a[8]||(a[8]=t=>e.sortDesc=t),onRowClicked:e.navigateToOrderPage,"sort-direction":e.sortDirection},{"cell(Several)":D(t=>[R(I(p,{id:"checkbox-"+t.index,modelValue:e.selectedRows[t.index],"onUpdate:modelValue":m=>e.selectedRows[t.index]=m,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[W,e.isSeveral]])]),"cell(ID)":D(t=>[Ke,_("span",{class:"order-id",onClick:m=>e.toItem(t.value)},h(t.value),9,Xe)]),"cell(ContractID)":D(t=>{var m,O;return[Ze,_("span",null,"#"+h((m=e.getContracts[t.value])==null?void 0:m.ID)+" / "+h((O=e.getContracts[t.value])==null?void 0:O.Customer),1)]}),"cell(Scheme)":D(t=>{var m;return[Je,_("span",null,h((m=t.item)==null?void 0:m.SchemeName),1)]}),"cell(Keys)":D(t=>{var m,O;return[Qe,_("span",Ye,[E(h(e.findDomainByOrderID((m=t.item)==null?void 0:m.ID)),1),_("pre",$e,h(e.getTitleText((O=t.item)==null?void 0:O.ID)),1)])]}),"cell(StatusID)":D(t=>[et,I(b,{class:"clickable-element",status:t.value,"status-table":"Orders",onClick:m=>{var O,q;return e.openHistoryStatuses((O=t.item)==null?void 0:O.ID,(q=t.item)==null?void 0:q.ServiceID)}},null,8,["status","onClick"])]),"cell(ExpirationDate)":D(t=>{var m,O;return[tt,_("span",null,h(e.calculateExpirationDate((m=t.item)==null?void 0:m.DaysRemainded))+" | "+h(((O=t.item)==null?void 0:O.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":D(t=>{var m;return[nt,I(B,{class:"clickable-element","user-notice":t.value,id:(m=t.item)==null?void 0:m.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":D(t=>[_("div",ot,[_("div",{class:"btn btn--md btn--bold clickable-element",onClick:m=>e.handlePayment(t.item.ID,t.item.ServiceID,t.item.ContractID)},[I(S),E("Оплатить")],8,st),I(V,{class:"dropdown-dots",right:""},{"button-content":D(()=>[_("div",rt,[I(j)])]),default:D(()=>[I(o,null,{default:D(()=>[I(u,{to:`/AdditionalServices/${t.item.ID}`},{default:D(()=>[E("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),I(o,{onClick:m=>e.transferItem(t.item.ID,t.item.ServiceID)},{default:D(()=>[E("Передать на другой аккаунт")]),_:2},1032,["onClick"]),l.sectionID==="51000"||l.sectionID==="52000"?(w(),T(o,{key:0,onClick:m=>e.orderManage(t.item.ID,t.item.ServiceID)},{default:D(()=>[E("Управлять заказом")]),_:2},1032,["onClick"])):$("",!0),l.sectionID==="52000"?(w(),T(o,{key:1,onClick:m=>e.openPasswordChange(t.item.ID,t.item.ServiceID)},{default:D(()=>[E("Сменить пароль")]),_:2},1032,["onClick"])):$("",!0),I(f),I(o,{class:"color-red",onClick:m=>v.$emit("deleteItem",t.item)},{default:D(()=>[E("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","onRowClicked","sort-direction"])):(w(),T(A,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const it={components:{BlockSelectPeriod:ve,EmptyStateBlock:Z,StatusBadge:_e,IconCard:ue,Helper:Ne,Multiselect:me},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],async setup(v){const a=re(),l=ae(),e=ie("emitter"),N=C(!1),g=C("ID"),L=C(!0),y=C("desc"),P=C(!1),p=C([]),x=C(null),b=C(null),B=le(),S=ce(),j=de(),u=M(()=>S==null?void 0:S.DNSmanagerOrdersList),o=M(()=>S==null?void 0:S.ISPswOrdersList),f=M(()=>S==null?void 0:S.ExtraIPOrdersList);function V(){a.go(0)}async function c(){let r="";v.sectionID==="50000"?r="IP адресов":v.sectionID==="51000"?r="лицензии ISPsystem":v.sectionID==="52000"&&(r="вторичного DNS"),console.log(p.value);const s=K.value.filter((i,k)=>p.value[k]),n=s.map(i=>i.ID),d={ServiceID:v.sectionID,ItemsPay:b.value,OrdersIDs:n,...N.value&&{UseBalance:"yes"}};await j.OrdersPay(d).then(i=>{console.log(i),i==="Basket"?(console.log("Success"),a.push("/Basket")):(i==null?void 0:i.Status)==="Ok"&&(P.value=!1,e.emit("open-modal",{component:"BalanceProlong",data:{Service:r,Message:i==null?void 0:i.Message,Count:i==null?void 0:i.Count}}))}),console.log("Selected Orders:",s),console.log("_contract_select:",x.value),console.log("selectPeriod:",b.value)}function A(r){const s=u.value,n=String(r),d=Object.values(s).find(i=>String(i.OrderID)===n);return console.log(d),d}const H=M(()=>B==null?void 0:B.contractsList);function z(r,s,n){s==="50000"||s==="51000"||s==="52000"?ne(r,s):a.push(`/ServiceOrderPay/${r}`)}function G(r,s){console.log(r);const n=A(r);e.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:n.ID,ServiceID:s,emitEvent:"updateServicesList",Login:n.Login}})}function F(r,s){let n=null,d="";switch(s){case"50000":n=Object.entries(f.value).find(([i,k])=>k),d="ExtraIPOrders";break;case"51000":n=Object.entries(o.value).find(([i,k])=>k),d="ISPswOrders";break;case"52000":n=Object.entries(u.value).find(([i,k])=>k),d="DNSmanagerOrders";break;default:n=Object.entries(K.value).find(([i,k])=>k),d="Orders"}n&&e.emit("open-modal",{component:"StatusHistory",data:{modeID:d,rowID:n[1].ID}})}const t=r=>{const s=m(r);if(s){const n=s.split(","),d=n.length,i=n.join(`
`);return`Всего: ${d}
${i}`}return"Нет данных"},m=r=>{const s=Object.entries(u.value).reduce((n,[d,i])=>(n[d]=i,n),{});for(const n in s)if(Object.hasOwnProperty.call(s,n)){const d=s[n];if(String(d.OrderID)===String(r))return d.Parked}return null};function O(){P.value=!0}function q(){P.value=!1}function ne(r,s,n){s==="51000"?a.push(`/ISPswOrderPay/${r}`):s==="52000"?a.push(`/DNSmanagerOrderPay/${r}`):s==="50000"&&a.push(`/ExtraIPOrderPay/${r}`)}function De(r,s,n){n.target.closest("button, a, .clickable-element")||a.push(`/AdditionalServices/${r.ID}`)}function Se(r){a.push(`/AdditionalServices/${r}`)}function ge(r,s){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:r,ServiceID:s}})}function ke(r,s){let n;s==="51000"?n=Object.entries(o.value).reduce((i,[k,J])=>(i[k]=J,i),{}):s==="52000"&&(n=Object.entries(u.value).reduce((i,[k,J])=>(i[k]=J,i),{}));let d;for(const i in n)if(Object.hasOwnProperty.call(n,i)){const k=n[i];if(String(k.OrderID)===String(r)){d=k;break}}d&&j.OrderManageHosting({ServiceOrderID:d.ID,OrderID:r,ServiceID:s,XMLHttpRequest:"yes"})}const be=r=>{const s=Object.entries(u.value).reduce((n,[d,i])=>(n[d]=i,n),{});for(const n in s)if(Object.hasOwnProperty.call(s,n)){const d=s[n];if(String(d.OrderID)===String(r))return d.Domain}return null},K=M(()=>{var r,s;return(s=(r=Object.keys(l==null?void 0:l.userOrders).map(n=>{var d;return{...l==null?void 0:l.userOrders[n],ID:Number((d=l==null?void 0:l.userOrders[n])==null?void 0:d.ID)}}))==null?void 0:r.reverse())==null?void 0:s.filter(n=>n.ServiceID===(v==null?void 0:v.sectionID))});function Oe(){a.push(`/AdditionalServicesOrder?ServiceID=${v==null?void 0:v.sectionID}`)}function ye(r){if(!r)return oe(new Date);const s=new Date,n=new Date(s.getTime()+r*24*60*60*1e3);return oe(n)}return te(()=>{p.value=K.value.map(()=>!1)}),await S.fetchDNSmanagerOrders(),await S.fetchISPswOrders(),await S.fetchExtraIPOrders(),{authStore:l,getOrders:K,getContracts:H,sortBy:g,sortDesc:L,sortDirection:y,navigateToOrder:Oe,servicesStatuses:Be,oneTimeWorksFields:We,calculateExpirationDate:ye,getDNSmanagerOrders:u,findDomainByOrderID:be,findParkedByOrderID:m,getTitleText:t,transferItem:ge,orderManage:ke,servicePay:ne,handlePayment:z,navigateToOrderPage:De,openHistoryStatuses:F,toItem:Se,openPasswordChange:G,reloadNow:V,prolongSeveralOrders:O,isSeveral:P,selectedRows:p,_contract_select:x,selectPeriod:b,prolongOrders:c,outSeveralOrders:q,useBalance:N}}},Ie=se(it,[["render",at],["__scopeId","data-v-66c805dd"]]),ct={class:"section"},lt={class:"container"},dt={class:"section-header"},ut={class:"section-nav"},_t=["title","onClick"],mt={class:"multiselect-option"},vt={class:"section-body"};function ft(v,a,l,e,N,g){var b,B,S,j,u,o,f,V;const L=fe,y=Re,P=Q("Multiselect"),p=Ie,x=Z;return w(),X(ee,null,[I(L),_("div",ct,[_("div",lt,[_("div",dt,[_("div",ut,[(w(!0),X(ee,null,Ce((b=e.getServices)==null?void 0:b.slice(0,e.visibleItemsCount),c=>{var A;return w(),X("div",{class:Y(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(c==null?void 0:c.ID)}]),title:(A=e.getServerGroup(c==null?void 0:c.ServersGroupID))==null?void 0:A.Comment,onClick:H=>e.switchToSection(c==null?void 0:c.ID)},h(c==null?void 0:c.Item),11,_t)}),256)),((B=e.getServices)==null?void 0:B.length)>e.visibleItemsCount?(w(),T(P,{key:0,modelValue:e.section,"onUpdate:modelValue":a[0]||(a[0]=c=>e.section=c),class:Y({"multiselect--white additional-service__select":!0,"additional-service__select_active":(j=e.getServices)==null?void 0:j.slice(e.visibleItemsCount,(S=e.getServices)==null?void 0:S.length).find(c=>(c==null?void 0:c.ID)===e.section)}),options:(o=e.getServices)==null?void 0:o.slice(e.visibleItemsCount,(u=e.getServices)==null?void 0:u.length),label:"ID",onSelect:a[1]||(a[1]=c=>e.switchToSection(c))},{option:D(({option:c})=>[_("div",mt,h(c==null?void 0:c.Item),1)]),caret:D(()=>[I(y,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):$("",!0)])]),_("div",vt,[(f=e.getServices)!=null&&f.find(c=>c.ID===e.section)?(w(),T(p,{key:0,sectionID:e.section,sectionData:(V=e.getServices)==null?void 0:V.find(c=>c.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(w(),T(x,{key:1,label:"Услуга не найдена"}))])])])],64)}const It={components:{ServiceListSection:Ie,emptyStateBlock:Z,Multiselect:me,BlockBalanceAgreement:fe},async setup(){const v=C(3);let a=()=>{window.innerWidth>=1920?v.value=9:window.innerWidth>=1600?v.value=7:window.innerWidth>=1440?v.value=6:window.innerWidth>=1200?v.value=5:window.innerWidth>=992?v.value=4:v.value=3};const l=we(),e=re(),N=ie("emitter"),g=ce(),L=xe();de();const y=ae(),P=le(),p=C(null);N.on("updateUserOrdersList",()=>{y.fetchUserOrders()});const x=M(()=>{var u;return(u=Object.keys(g==null?void 0:g.ServicesList))==null?void 0:u.map(o=>{var f;return{...g==null?void 0:g.ServicesList[o],value:(f=g==null?void 0:g.ServicesList[o])==null?void 0:f.ID}}).filter(o=>(o==null?void 0:o.ServicesGroupID)!=="1000"&&(o==null?void 0:o.IsActive)&&!(o!=null&&o.IsHidden)).sort((o,f)=>Number(o==null?void 0:o.SortID)<Number(f==null?void 0:f.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(f==null?void 0:f.SortID)?1:0)}),b=C(null);N.on("updateServicesList",()=>{y.fetchUserOrders()}),N.on("updateDNSManagerPage",()=>{g.fetchDNSmanagerOrders()});function B(u){e.replace(`/AdditionalServices?ServiceID=${u}`),b.value=u}function S(u){var o,f;return(f=(o=L==null?void 0:L.serverGroupsList)==null?void 0:o.ServersGroups)==null?void 0:f[u]}function j(u){N.emit("open-modal",{component:"DeleteItem",data:{id:u.ID,message:`Вы действительно хотите удалить заказ #${u.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}return te(()=>{var u,o;(u=x.value)!=null&&u.find(f=>{var V;return(f==null?void 0:f.ID)===((V=l==null?void 0:l.query)==null?void 0:V.ServiceID)})?b.value=(o=l==null?void 0:l.query)==null?void 0:o.ServiceID:e.replace(`/AdditionalServices?ServiceID=${b.value}`)}),te(()=>{window.addEventListener("resize",a),a()}),Pe(()=>{window.removeEventListener("resize",a)}),await g.fetchServices().then(()=>{var u,o;b.value=(o=(u=x.value)==null?void 0:u[0])==null?void 0:o.ID}),await P.fetchContracts(),await y.fetchUserOrders(),await g.fetchDNSmanagerOrders(),await g.fetchISPswOrders(),await g.fetchExtraIPOrders(),{section:b,deleteItem:j,getServices:x,additionalServicesValue:p,switchToSection:B,getServerGroup:S,visibleItemsCount:v}}},At=se(It,[["render",ft],["__scopeId","data-v-ba33f686"]]);export{At as default};
