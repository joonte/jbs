import{_ as K}from"./ButtonDefault-CMw2aBy6.js";import{_ as oe}from"./TotalAmount.vue_vue_type_script_setup_true_lang-Dg-09YER.js";import{_ as le}from"./BlockOrderServiceWrapper-CSOQwJHk.js";import{_ as ae}from"./BlockAdditionalServices-Dc0oR6v8.js";import{_ as ne}from"./DomainCheckBlock-X9fdH0N6.js";import{_ as ie}from"./BlockSelectContract-CsqQBTZj.js";import{_ as re}from"./ClausesKeeper-iUM0yapS.js";import{_ as me}from"./BlockBalanceAgreement-v_bWuiVT.js";import{S as de,r as N,f as c,I as F,s as ue,m as ce,E as y,o as C,c as k,b as d,a as t,w as E,F as fe,x as ve,i as pe,d as _e,v as h,t as D,h as B,K as V,Y as R}from"./index-Codq73aV.js";import{u as Se}from"./index-BO2gwtUe.js";import{u as Ne}from"./hosting-BhryHInW.js";import{u as he}from"./services-DyPBvbVy.js";import{s as De}from"./multiselect-DElL0Rlw.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./common-DyknwSqv.js";import"./EmptyStateBlock-DA3-0YDi.js";import"./bootstrap-vue-next-W16P-SAV.js";import"./InputServiceSelect-Dvi-CxI4.js";import"./InputSelect.vue_vue_type_script_setup_true_lang-D7E9_BoS.js";import"./IconChevronDown-DOsbTpSQ.js";import"./BasicInput-DeQAeyXe.js";import"./component-DqcwA9JN.js";import"./IconClose-Dia1noy8.js";const ge={class:"tw-px-4 md:tw-px-8"},Ie={class:"tw-flex tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},we={class:"tw-mt-8"},ye={class:"section"},Ce={class:"form tw-mt-8 lg:tw-w-1/2"},ke={class:"multi-top"},xe={key:0,class:"server"},Oe={key:1,class:"domain"},Ee={class:"multiselect-option"},Be={key:0,class:"server"},Ve={key:1,class:"domain"},Re={class:"section"},Le={class:"form form-grid-columns"},Ue={class:"form-col"},Ae={class:"form-field"},Pe={class:"form-col"},$e={class:"form-field"},Te={class:"form-col"},He={class:"form-field"},je={class:"form-col"},Ke={class:"form-field"},Fe={class:"tw-my-6"},Me={__name:"DomainSchemes",async setup(We){let r,m;const f=de(),A=Se(),u=Ne(),x=he(),O=_e(),M=pe(),P=ve("emitter");P.on("updateDomainsList",()=>{f.fetchDomainOrders()});const W=M.query.DomainName||"",b=N(null),S=N([]),g=N(null),I=N([]),L=N(!1),a=N({Ns1Name:"dns0.host-food.ru",Ns2Name:"dns1.host-food.ru",Ns3Name:null,Ns4Name:null}),q=c(()=>x?.ServicesList),Y=c(()=>{let s=0;return I.value.forEach(e=>{s+=Number(e.Price)}),s}),$=c(()=>S.value.reduce((s,e)=>s+e.CostOrder,0)),Z=c(()=>A.contractsList[b.value]?.Balance>=$.value+Y.value?"Оплатить c баланса договора":"Добавить в корзину"),T=s=>{s.key==="Enter"&&s.ctrlKey&&!z.value&&j()},z=c(()=>S.value.length===0);F(()=>{document.addEventListener("keyup",T)}),ue(()=>{document.removeEventListener("keyup",T)});const G=c(()=>Object.keys(f.domainSchemes).filter(s=>f.domainSchemes[s].IsActive).map(s=>({...f.domainSchemes[s],value:f.domainSchemes[s]?.ID}))),J=c(()=>Object.keys(u?.hostingList).map(s=>u?.hostingList[s])),U=c(()=>u?.hostingList),H=c(()=>{const s=Object.keys(U.value).map(e=>{const n=U.value[e];return{value:n.ID,login:n.Login,customer:n.Customer,domain:n.Domain,schemeID:n.SchemeID}});return s.unshift({value:0,login:"Без хостинга",customer:"",domain:""}),s});ce(()=>g.value,s=>{const e=J.value.find(n=>n.ID===s);e?(a.value.Ns1Name=e.Ns1Name,a.value.Ns2Name=e.Ns2Name,a.value.Ns3Name=e.Ns3Name,a.value.Ns4Name=e.Ns4Name):(a.value.Ns1Name="dns0.host-food.ru",a.value.Ns2Name="dns1.host-food.ru",a.value.Ns3Name=null,a.value.Ns4Name=null)});async function Q(s){for(const e of I.value){let n="SUCCESS",v=q.value[e.ServiceID]?.Code;if(await x.ServiceOrder({Code:v,DependOrderID:s,...e,ContractID:b.value}).then(({result:w,info:l})=>{if(w==="SUCCESS"){let i={};v==="Default"?i.ServiceOrderID=l?.ServiceOrderID:i[`${v}OrderID`]=l?.ServiceOrderID,x.ServiceOrderPay(v,i).then(p=>{let{result:_}=p;_==="SUCCESS"?O.push("/AdditionalServices"):_==="BASKET"&&O.push("/Basket")})}else n="ERROR"}),n==="ERROR")break}}async function j(){L.value=!0;let s=0;const e=[],n=()=>{if(s<S.value.length){const l=S.value[s];f.DomainOrder({ContractID:b.value,Domain:`${l.line}${l.line&&l.Name?"."+l.Name:""}`,DomainName:l.line,DomainSchemeID:l.value,DomainZone:l.Name,IsPrivateWhoIs:"yes",HostingOrderID:g.value,...a.value}).then(({result:i,info:p,error:_})=>{if(i==="SUCCESS")return s===0&&Q(p?.OrderID),f.DomainOrderPay({DomainOrderID:p?.DomainOrderID});throw new Error(_)}).then(i=>{let{result:p,error:_}=i;e.push({result:p,error:_})}).catch(i=>{console.error("An error occurred:",i),e.push({result:"ERROR",error:i})}).finally(()=>{s++,setTimeout(n,1e3)})}else L.value=!1};n(),await new Promise(l=>{const i=()=>{s===S.value.length?l():setTimeout(i,100)};i()});const v=e.some(l=>l.result==="BASKET"),w=e.every(l=>l.result==="SUCCESS");v?O.push("/Basket"):w&&O.push("/DomainOrders")}function X(s){S.value=s}function ee(){P.emit("open-modal",{component:"DomainTransfer",data:{}})}return F(()=>{U.value&&(g.value=H.value[0].value)}),[r,m]=y(()=>A.fetchContracts()),await r,m(),[r,m]=y(()=>f.fetchDomainSchemes()),await r,m(),[r,m]=y(()=>u.fetchHostingOrders()),await r,m(),[r,m]=y(()=>u.fetchHostingSchemes()),await r,m(),[r,m]=y(()=>x.fetchServices()),await r,m(),(s,e)=>{const n=me,v=K,w=re,l=ie,i=ne,p=ae,_=le,te=oe,se=K;return C(),k(fe,null,[d(n),t("div",ge,[t("div",Ie,[e[9]||(e[9]=t("h1",{class:"tw-text-xl sm:tw-text-4xl"},"Заказ доменного имени",-1)),d(v,{label:"Перенести домен",onClick:e[0]||(e[0]=o=>ee())})]),d(w),d(_,{basic_title:"Домен"},{page:E(()=>[t("div",we,[d(l,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=o=>b.value=o),title:"Договор"},null,8,["modelValue"]),d(i,{"domain-list":G.value,search:h(W),onSelect:X},null,8,["domain-list","search"]),t("div",ye,[e[10]||(e[10]=t("h2",{class:"tw-text-2xl"},"Заказ хостинга",-1)),e[11]||(e[11]=t("div",{class:"section-label"}," Если домен будет использоваться совместно с заказом хостинга, выберите нужный из существующего списка ",-1)),t("form",Ce,[d(h(De),{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=o=>g.value=o),class:"hosting-select multiselect--white",options:H.value,label:"login",placeholder:"Выберите хостинг","track-by":"value"},{singlelabel:E(({value:o})=>[t("div",ke,D(o.login),1),h(u).hostingSchemes[o.schemeID]?.Name?(C(),k("span",xe," / "+D(h(u).hostingSchemes[o.schemeID]?.Name),1)):B("",!0),o.domain?(C(),k("span",Oe," / "+D(o.domain),1)):B("",!0)]),option:E(({option:o})=>[t("div",Ee,D(o.login),1),h(u).hostingSchemes[o.schemeID]?.Name?(C(),k("span",Be," / "+D(h(u).hostingSchemes[o.schemeID]?.Name),1)):B("",!0),o.domain?(C(),k("span",Ve," / "+D(o.domain),1)):B("",!0)]),_:1},8,["modelValue","options"])])]),t("div",Re,[e[24]||(e[24]=t("div",{class:"section-header"},[t("div",{class:"section-label"}," Для успешной регистрации, домен должен быть настроен на используемых именных серверах. Для этого в панели управления хостингом необходимо добавить домен, как дополнительный или паркованный. ")],-1)),t("form",Le,[t("div",Ue,[e[13]||(e[13]=t("div",{class:"form-col__title"},"Первичный сервер имен",-1)),t("label",Ae,[e[12]||(e[12]=t("div",{class:"form-field__label"},"Доменный адрес",-1)),V(t("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":e[3]||(e[3]=o=>a.value.Ns1Name=o)},null,512),[[R,a.value.Ns1Name]])]),e[14]||(e[14]=t("label",{class:"form-field"},[t("div",{class:"form-field__label"},"IP адрес"),t("input",{type:"text",disabled:""})],-1))]),t("div",Pe,[e[16]||(e[16]=t("div",{class:"form-col__title"},"Вторичный сервер имен",-1)),t("label",$e,[e[15]||(e[15]=t("div",{class:"form-field__label"},"Доменный адрес",-1)),V(t("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":e[4]||(e[4]=o=>a.value.Ns2Name=o)},null,512),[[R,a.value.Ns2Name]])]),e[17]||(e[17]=t("label",{class:"form-field"},[t("div",{class:"form-field__label"},"IP адрес"),t("input",{type:"text",disabled:""})],-1))]),t("div",Te,[e[19]||(e[19]=t("div",{class:"form-col__title"},"Дополнительный сервер имен",-1)),t("label",He,[e[18]||(e[18]=t("div",{class:"form-field__label"},"Доменный адрес",-1)),V(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=o=>a.value.Ns3Name=o)},null,512),[[R,a.value.Ns3Name]])]),e[20]||(e[20]=t("label",{class:"form-field"},[t("div",{class:"form-field__label"},"IP адрес"),t("input",{type:"text",disabled:""})],-1))]),t("div",je,[e[22]||(e[22]=t("div",{class:"form-col__title"},"Расширенный сервер имен",-1)),t("label",Ke,[e[21]||(e[21]=t("div",{class:"form-field__label"},"Доменный адрес",-1)),V(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=o=>a.value.Ns4Name=o)},null,512),[[R,a.value.Ns4Name]])]),e[23]||(e[23]=t("label",{class:"form-field"},[t("div",{class:"form-field__label"},"IP адрес"),t("input",{type:"text",disabled:""})],-1))])])])])]),services:E(()=>[d(p,{modelValue:I.value,"onUpdate:modelValue":e[7]||(e[7]=o=>I.value=o),"service-search-params":{ServiceID:2e4}},null,8,["modelValue"])]),_:1}),t("div",Fe,[d(te,{tariff:{label:"12 месяцев",price:$.value},"additional-services":I.value},null,8,["tariff","additional-services"]),d(se,{class:"btn--wide",label:Z.value,"is-loading":L.value,disabled:S.value.length===0,onClick:e[8]||(e[8]=o=>j())},null,8,["label","is-loading","disabled"])])])],64)}}},pt=be(Me,[["__scopeId","data-v-20eba670"]]);export{pt as default};
