import{L as Z,a as ee}from"./bootstrap-vue-next-W16P-SAV.js";import{_ as te}from"./IconCard-C_8uFbeS.js";import{_ as se}from"./UserNote-9g0f9gxP.js";import{_ as ae}from"./StatusBadge-BmqDrHzy.js";import{_ as le}from"./OrderIDBadge-DCIAfa63.js";import{_ as oe}from"./ServerStatusBadge.vue_vue_type_script_setup_true_lang-CNB3-WyC.js";import{_ as ne}from"./FormInputSearch-B47bjFcn.js";import{_ as re}from"./ClausesKeeper-iUM0yapS.js";import{_ as ie}from"./BlockBalanceAgreement-v_bWuiVT.js";import{ao as ue,r as m,f as _,m as ce,I as me,E as de,o as $,c as U,b as r,a,w as l,v as u,h as pe,F as ve,x as _e,i as fe,d as Se,t as o,j as A,n as ge}from"./index-Codq73aV.js";import{u as be}from"./orders-wJq_IMsK.js";import{u as De}from"./index-BO2gwtUe.js";import{u as Ie}from"./services-DyPBvbVy.js";import{f as B}from"./time-DenPiOX5.js";import{g as ye}from"./common-DyknwSqv.js";import{s as I}from"./multiselect-DElL0Rlw.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-Bm8D3Wgq.js";import"./IconClose-Dia1noy8.js";import"./ButtonDefault-CMw2aBy6.js";const xe=[{key:"ID",label:"Заказ",variant:"td-blue",sortable:!0},{key:"ServiceID",label:"Услуга",variant:"td-gray td-order bold"},{key:"SchemeName",label:"Тариф",variant:"td-gray td-order"},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"td-gray td-order"},{key:"ContractID",label:"Договор",sortable:!0,variant:"td-blue"},{key:"UserNotice",label:"Примечание",variant:"td-gray td-limited"},{key:"controls",label:"",variant:"td-controls"}],Le={class:"tw-px-4 md:tw-px-8"},Ve={class:"list-form"},ke={class:"list-form_col list-form_col--sm"},he={class:"list-form_select"},we={class:"multiselect-option"},Oe={class:"list-form_col list-form_col--sm"},Ne={class:"list-form_select"},$e={class:"multiselect-option"},Ue={class:"list-form_col list-form_col--sm"},Ae={class:"list-form_select"},Be={class:"multiselect-option"},Re={class:"tw-flex tw-gap-2 tw-items-center"},Ee={class:"btn__group"},Fe=["onClick"],Pe={key:0,class:"table-controls"},Te={class:"multiselect-multiple-label"},je={class:"multiselect-option"},qe={__name:"Orders",async setup(He){let x,L;const f=Se(),V=fe(),i=be(),S=De(),c=Ie(),R=ue(),k=_e("emitter");k.on("updateOrdersList",()=>{i.fetchAllOrders()});const y=m(""),d=m(10),p=m(1),E=m([10,25,50,100]),v=m("*"),g=m("*"),b=m("*"),D=_(()=>{let s=i.ordersList.filter(e=>String(e.ID).includes(y.value));return g.value!=="*"&&s!==null&&(s=s.filter(e=>String(e.ServiceID).includes(g.value))),v.value!=="*"&&s!==null&&(s=s.filter(e=>String(e.ContractID).includes(v.value))),b.value!=="*"&&s!==null&&(s=s.filter(e=>String(e.StatusID).includes(b.value))),s});ce(D,()=>{p.value=1});function F(){f.go(0)}function P(s){if(!s)return B(new Date);const e=new Date,n=new Date(e.getTime()+s*24*60*60*1e3);return B(n)}function T(s,e){let n="";e==="Default"?n="Orders":n=e+"Orders",k.emit("open-modal",{component:"StatusHistory",data:{modeID:n,rowID:s}})}const h=_(()=>{let s=[{value:"*",name:"Все договора"}];return i.ordersList!==null?(i.ordersList.map(e=>{s.find(n=>n.value===e?.ContractID)||s.push({value:e?.ContractID,name:S.contractsList[e?.ContractID]?.Customer})}),s):{value:"*",name:"Все договора"}}),w=_(()=>{let s=[{value:"*",name:"Все услуги"}];return i.ordersList!==null?(i.ordersList.map(e=>{s.find(n=>n.value===e?.ServiceID)||s.push({value:e?.ServiceID,name:c.ServicesList[e?.ServiceID]?.NameShort})}),s):{value:"*",name:"Все услуги"}}),j=_(()=>R.data.Statuses?.Orders),O=_(()=>{let s=[{value:"*",name:"Все статусы"}];return i.ordersList!==null?(i.ordersList.map(e=>{s.find(n=>n.value===e?.StatusID)||s.push({value:e?.StatusID,name:j.value?.[e?.StatusID]?.Name||e?.StatusID})}),s):{value:"*",name:"Все статусы"}});function q(s){return c.ServicesList[s]?.Code!=="Default"?c.ServicesList[s]?.Code+"Orders":"Orders"}function H(s,e,n){let C=c.ServicesList[s.ServiceID]?.Code;f.push(ye(C,s.ID))}function M(s){let e=c.ServicesList[s.ServiceID]?.Code;e==="Default"?f.push(`/ServiceOrderPay/${s.ID}`):f.push(`/${e}OrderPay/${s.ID}`)}return me(()=>{V.query.contractID&&(v.value=V.query.contractID)}),[x,L]=de(()=>Promise.all([i.fetchAllOrders(),S.fetchContracts(),c.fetchServices()])),await x,L(),(s,e)=>{const n=ie,C=re,z=ne,G=oe,J=le,K=ae,Q=se,W=te,X=Z,Y=ee;return $(),U(ve,null,[r(n),a("div",Le,[a("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer tw-mb-4",onClick:e[0]||(e[0]=t=>F())}," Мои заказы "),r(C),a("div",Ve,[r(z,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t)},null,8,["modelValue"]),a("div",ke,[a("div",he,[r(u(I),{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),options:h.value,disabled:h.value?.length<=1,label:"name"},{singlelabel:l(({value:t})=>[a("span",null,"# "+o(String(t.value).padStart(5,"0"))+" / "+o(t.name),1)]),option:l(({option:t})=>[a("div",we," # "+o(String(t.value).padStart(5,"0"))+" / "+o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",Oe,[a("div",Ne,[r(u(I),{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=t=>b.value=t),options:O.value,disabled:O.value?.length<=1,label:"name"},{option:l(({option:t})=>[a("div",$e,o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",Ue,[a("div",Ae,[r(u(I),{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t),options:w.value,disabled:w.value?.length<=1,label:"name"},{option:l(({option:t})=>[a("div",Be,o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])])]),r(X,{class:"basic-table",fields:u(xe),items:D.value,"show-empty":!0,"per-page":d.value,responsive:"","current-page":p.value,"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onRowClicked:H},{"cell(ID)":l(t=>[a("div",Re,[r(G,{indicators:t.item.Stat?.Last},null,8,["indicators"]),r(J,{orderId:t.value},null,8,["orderId"])])]),"cell(ServiceID)":l(t=>[e[8]||(e[8]=a("span",{class:"td-mobile"},"Услуга",-1)),a("span",null,o(u(c).ServicesList[t.value]?.NameShort),1)]),"cell(SchemeName)":l(t=>[e[9]||(e[9]=a("span",{class:"td-mobile"},"Тариф",-1)),a("span",null,o(t.item?.SchemeName),1)]),"cell(ExpirationDate)":l(t=>[e[10]||(e[10]=a("span",{class:"td-mobile"},"Дата окончания",-1)),a("span",{class:ge({danger:Number(t.item?.DaysRemainded)<14})},o(P(t.item?.DaysRemainded))+" | "+o(t.item?.DaysRemainded||0)+" дн. ",3)]),"cell(StatusID)":l(t=>[r(K,{class:"clickable-element tw-cursor-pointer",status:t.value,"status-table":q(t.item?.ServiceID),onClick:A(N=>T(t.item?.ServiceOrderID,t.item?.Code),["stop"])},null,8,["status","status-table","onClick"])]),"cell(ContractID)":l(t=>[e[11]||(e[11]=a("span",{class:"td-mobile"},"Договор",-1)),a("span",null,"#"+o(u(S).contractsList[t.value]?.ID)+" / "+o(u(S).contractsList[t.value]?.Customer),1)]),"cell(UserNotice)":l(t=>[r(Q,{text:t.value,"order-id":t.item?.ID,emit:"updateOrdersList"},null,8,["text","order-id"])]),"cell(controls)":l(t=>[a("div",Ee,[a("button",{class:"btn btn-default btn--border",onClick:A(N=>M(t.item),["stop"])},[r(W),e[12]||(e[12]=a("p",null,"ОПЛАТИТЬ",-1))],8,Fe)])]),_:1},8,["fields","items","per-page","current-page"]),D.value?.length>0?($(),U("div",Pe,[r(Y,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value=t),"total-rows":D.value?.length,"per-page":d.value,"first-number":"","last-number":""},{"first-text":l(()=>e[13]||(e[13]=[a("span",{class:"text-success"},"First",-1)])),"last-text":l(()=>e[14]||(e[14]=[a("span",{class:"text-info"},"Last",-1)])),page:l(({page:t,active:N})=>[a("span",null,o((t-1)*d.value+1)+"-"+o(t*d.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),r(u(I),{class:"multiselect--white",modelValue:d.value,"onUpdate:modelValue":e[6]||(e[6]=t=>d.value=t),options:E.value,label:"name",openDirection:"top",onInput:e[7]||(e[7]=t=>p.value=1)},{singlelabel:l(({value:t})=>[a("div",Te,[a("span",null,"Отображать "+o(t.value)+" строк",1)])]),option:l(({option:t})=>[a("div",je,"Отображать "+o(t.name)+" строк",1)]),_:1},8,["modelValue","options"])])):pe("",!0)])],64)}}},ct=Ce(qe,[["__scopeId","data-v-41d704b5"]]);export{ct as default};
