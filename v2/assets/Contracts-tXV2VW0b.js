import{a as st,L as G,v as nt,r as at,m as lt}from"./bootstrap-vue-next-CxxkTytZ.js";import{s as rt}from"./multiselect-eqvbz1NV.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as f,m as R,c as O,i as J,o as D,b as l,w as s,a as e,t as m,v as T,am as Y,f as $,x as A,L as ct,D as U,e as E,G as it,d as z,g as ut,E as q,F as pt,I as dt,J as mt}from"./index-XtiBO-PZ.js";import{_ as K}from"./StatusBadge-DoJSzeeo.js";import{u as M}from"./contracts-BdlSA9YT.js";import{_ as _t}from"./IconDots-DWUcOOJk.js";import{_ as ft}from"./IconCard-cFowCC2T.js";import{f as vt,s as bt}from"./time-DenPiOX5.js";import{_ as gt}from"./FormInputSearch-DhLeThyA.js";import{_ as Ct}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as yt}from"./SlotPageTitle-CNp2tcrv.js";import{_ as It}from"./ButtonDefault-eJbeaBtE.js";import{_ as kt}from"./FormTabs-s3bsvxbp.js";import{_ as Dt}from"./BlockBalanceAgreement-DjWMZ940.js";import"./IconPlus-DYth91EZ.js";import"./IconClose-s_NQ_Q4c.js";const $t={key:0,class:"table-controls"},St={class:"multiselect-multiple-label"},Tt={class:"multiselect-option"},Lt={__name:"PaginationBlock",props:["modelValue","total_rows"],emits:["update:modelValue","updatePage"],setup(b,{emit:d}){const c=b,_=d,g=[10,25,50,100],i=f({current_page:1,per_page:10});return R(i.value,()=>{_("updatePage",i.value)}),(y,p)=>{const I=st;return c.total_rows>0?(D(),O("div",$t,[l(I,{modelValue:i.value.current_page,"onUpdate:modelValue":p[0]||(p[0]=n=>i.value.current_page=n),"total-rows":c.total_rows,"per-page":i.value.per_page,"first-number":"","last-number":""},{"first-text":s(()=>p[3]||(p[3]=[e("span",{class:"text-success"},"First",-1)])),"last-text":s(()=>p[4]||(p[4]=[e("span",{class:"text-info"},"Last",-1)])),page:s(({page:n,active:v})=>[e("span",null,m((n-1)*i.value.per_page+1)+"-"+m(n*i.value.per_page),1)]),_:1},8,["modelValue","total-rows","per-page"]),l(T(rt),{class:"multiselect--white",modelValue:i.value.per_page,"onUpdate:modelValue":p[1]||(p[1]=n=>i.value.per_page=n),options:g,label:"name",openDirection:"top",onInput:p[2]||(p[2]=n=>i.value.current_page=1)},{singlelabel:s(({value:n})=>[e("div",St,[e("span",null,"Отображать "+m(n.value)+" строк",1)])]),option:s(({option:n})=>[e("div",Tt,"Отображать "+m(n.name)+" строк",1)]),_:1},8,["modelValue"])])):J("",!0)}}},Q=F(Lt,[["__scopeId","data-v-f79dc347"]]),Pt=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"Name",label:"Профиль",variant:"td-blue"},{key:"TemplateID",label:"Тип",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",sortable:!0,variant:"td-gray td-order"},{key:"StatusDate",label:"От статуса",sortable:!0,variant:"td-default td-order"}];function W(b=null){const d=String(b)?.length;let c="";for(let _=0;_<5-d;_++)c="0"+c;return String(c)+String(b)}const wt={class:"contracts-profile-list"},xt={class:"d-block"},Vt={class:"d-block"},Bt={__name:"ContractsProfileList",props:["search"],setup(b){const d=b,c=M(),_=Y(),g=A("emitter"),i=f("ID"),y=f(!0),p=f("desc"),I=f(10),n=f(1),v=$(()=>Object?.keys(c?.profileList)?.map(u=>c?.profileList[u])?.reverse()),L=$(()=>_.data.Profiles?.Templates),P=$(()=>v.value.filter(u=>u.Name.toLowerCase().includes(d.search?.toLowerCase()||""))?.length);function x(u={}){I.value=u?.per_page,n.value=u?.current_page}function w(u,a){a.target.closest("button, a, .clickable-element")||g.emit("open-modal",{component:"ProfileInfo",data:{data:u,template:L.value[u.TemplateID]}})}function C(u){const a=Math.floor((new Date().getTime()-u*1e3)/864e5);return a<0?0:a}function V(u){g.emit("open-modal",{component:"StatusHistory",data:{modeID:"Profiles",rowID:u}})}return(u,a)=>{const B=K,N=G,r=Q;return D(),O("div",wt,[l(N,{class:"basic-table",items:v.value,fields:T(Pt),"show-empty":!0,filterable:[],filter:d.search,"per-page":I.value,"sort-desc":y.value,"onUpdate:sortDesc":a[0]||(a[0]=t=>y.value=t),"sort-by":i.value,"onUpdate:sortBy":a[1]||(a[1]=t=>i.value=t),"sort-direction":p.value,"current-page":n.value,"empty-text":"У вас пока нет профилей.","empty-filtered-text":"Профили не найдены.",onRowClicked:a[2]||(a[2]=(t,h,k)=>w(t,k))},{"cell(ID)":s(t=>[a[3]||(a[3]=e("span",{class:"td-mobile"},"Номер",-1)),e("span",xt,m(T(W)(t.item?.ID)),1)]),"cell(Name)":s(t=>[a[4]||(a[4]=e("span",{class:"td-mobile"},"Номер",-1)),e("span",null,m(t.item?.Name),1)]),"cell(StatusDate)":s(t=>[a[5]||(a[5]=e("span",{class:"td-mobile"},"От статуса",-1)),e("span",Vt,m(C(t.item?.StatusDate))+" дн.",1)]),"cell(TemplateID)":s(t=>[a[6]||(a[6]=e("span",{class:"td-mobile"},"Тип",-1)),e("span",null,m(L.value[t.item?.TemplateID]?.Name),1)]),"cell(StatusID)":s(t=>[a[7]||(a[7]=e("span",{class:"td-mobile"},"Статус",-1)),l(B,{class:"clickable-element",status:t.value,"status-table":"Profiles",onClick:h=>V(t.item?.ID)},null,8,["status","onClick"])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(r,{total_rows:P.value,onUpdatePage:x},null,8,["total_rows"])])}}},Nt=F(Bt,[["__scopeId","data-v-6dc826c7"]]),ht={},Et={class:"button-payment"},Ft={class:"button-payment__text"};function Ot(b,d){const c=ft;return D(),O("button",Et,[l(c,{class:"button-payment__icon"}),e("span",Ft,[ct(b.$slots,"default",{},void 0,!0)])])}const Ht=F(ht,[["render",Ot],["__scopeId","data-v-60aa5d21"]]),Ut=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"Customer",label:"Договор"},{key:"TypeID",label:"Тип",variant:"td-gray td-order"},{key:"Orders",label:"Количество подключенных услуг",sortable:!0,variant:"td-gray td-order"},{key:"Balance",label:"Баланс",sortable:!0,variant:"td-gray td-order"},{key:"IsHidden",label:"Скрыт ?",variant:"td-gray td-order"},{key:"Status",label:"Статус",variant:"td-gray td-order"},{key:"controls",label:"",variant:"td-controls"}],Rt={class:"contracts-list"},At={class:"td-column-heavy"},Mt=["onClick"],jt={class:"d-block"},qt={class:"td-column-heavy"},Gt={class:"table-td-blue"},Jt=["onClick"],Yt={class:"btn__group"},zt={class:"dropdown-button"},Kt={class:"btn btn--dots"},Qt={__name:"ContractsList",props:{search:{type:String,default:""}},setup(b){const d=z(),c=b,_=M(),g=Y(),i=A("emitter"),y=f("CreateDate"),p=f(!0),I=f("desc"),n=f(10),v=f(1);f(!1);const L=r=>{_.booleanEdit({TableID:"Contracts",ColumnID:"IsHidden",RowID:r.ID}).then(()=>{_.fetchContracts()})},P=$(()=>Object.keys(_?.contractsList)?.map(r=>_?.contractsList[r])?.reverse()),x=$(()=>g.data.Contracts?.Types),w=$(()=>P.value.filter(r=>r.Customer.toLowerCase().includes(c.search?.toLowerCase()||""))?.length);function C(r){i.emit("open-modal",{component:"StatusHistory",data:{modeID:"Contracts",rowID:r}})}function V(r){d.push(`/ContractScheme/${r}`)}function u(r){d.push(`/Balance/${r}`)}function a(r={}){n.value=r?.per_page,v.value=r?.current_page}function B(r){_?.contractDownload({ContractID:r})}function N(r){d.push(`/Orders?contractID=${r}`)}return R(()=>c,()=>{v.value=1}),(r,t)=>{const h=lt,k=K,X=Ht,Z=_t,j=it("router-link"),H=at,tt=nt,et=G,ot=Q;return D(),O("div",Rt,[l(et,{class:"basic-table",items:P.value,fields:T(Ut),"show-empty":!0,filterable:[],filter:c.search,"per-page":n.value,"sort-desc":p.value,"onUpdate:sortDesc":t[0]||(t[0]=o=>p.value=o),"sort-by":y.value,"onUpdate:sortBy":t[1]||(t[1]=o=>y.value=o),"sort-direction":I.value,"current-page":v.value,"empty-text":"У вас пока нет договоров.","empty-filtered-text":"Договора не найдены."},{"cell(ID)":s(o=>[t[2]||(t[2]=e("span",{class:"td-mobile"},"Номер",-1)),e("div",At,[e("span",{class:"table-td-gray order-id",onClick:S=>V(o.item?.ID)}," # "+m(T(W)(o.item?.ID)),9,Mt)])]),"cell(CreateDate)":s(o=>[t[3]||(t[3]=e("span",{class:"td-mobile"},"Дата Создания",-1)),e("span",jt,m(T(vt)(T(bt)(o.item?.CreateDate))),1)]),"cell(Customer)":s(o=>[t[4]||(t[4]=e("span",{class:"td-mobile"},"Договор",-1)),e("div",qt,[e("span",Gt,m(o.item?.Customer),1)])]),"cell(TypeID)":s(o=>[t[5]||(t[5]=e("span",{class:"td-mobile"},"Тип договора",-1)),e("span",null,m(x.value[o.item?.TypeID]?.Name),1)]),"cell(Balance)":s(o=>[t[6]||(t[6]=e("span",{class:"td-mobile"},"Баланс",-1)),e("span",null,m(o.item?.Balance)+" ₽",1)]),"cell(IsHidden)":s(o=>[t[7]||(t[7]=e("span",{class:"td-mobile"},"Скрыт ?",-1)),l(h,{class:"rule-checkbox",name:"checkbox",checked:o.item?.IsHidden,modelValue:o.item.IsChecked,"onUpdate:modelValue":S=>o.item.IsChecked=S,onChange:S=>L(o.item)},null,8,["checked","modelValue","onUpdate:modelValue","onChange"]),e("span",null,m(o.item?.IsHidden===!0?"Да":"Нет"),1)]),"cell(Status)":s(o=>[t[8]||(t[8]=e("span",{class:"td-mobile"},"Статус",-1)),l(k,{status:o.item?.StatusID,"status-table":"Contracts",onClick:S=>C(o.item?.ID)},null,8,["status","onClick"])]),"cell(Orders)":s(o=>[t[9]||(t[9]=e("span",{class:"td-mobile"},"Количество подключенных услуг",-1)),e("span",{class:"total-orders",onClick:S=>N(o.item?.ID)},m(o.item?.Orders),9,Jt)]),"cell(controls)":s(o=>[e("div",Yt,[o.item?.TypeID!="NaturalPartner"?(D(),U(X,{key:0,onClick:S=>u(o.item?.ID)},{default:s(()=>t[10]||(t[10]=[E(" Пополнить баланс ",-1)])),_:2,__:[10]},1032,["onClick"])):J("",!0),e("div",zt,[l(tt,{right:"",class:"dropdown-dots"},{"button-content":s(()=>[e("span",Kt,[l(Z)])]),default:s(()=>[l(H,null,{default:s(()=>[l(j,{to:`/ContractScheme/${o.item?.ID}`},{default:s(()=>t[11]||(t[11]=[E("Открыть",-1)])),_:2,__:[11]},1032,["to"])]),_:2},1024),l(H,null,{default:s(()=>[l(j,{to:`/ContractSettings/${o.item?.ID}`},{default:s(()=>t[12]||(t[12]=[E("Изменить тип учёта",-1)])),_:2,__:[12]},1032,["to"])]),_:2},1024),l(H,{onClick:S=>B(o.item?.ID)},{default:s(()=>t[13]||(t[13]=[E(" Загрузить договор ",-1)])),_:2,__:[13]},1032,["onClick"])]),_:2},1024)])])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(ot,{total_rows:w.value,onUpdatePage:a},null,8,["total_rows"])])}}},Wt=F(Qt,[["__scopeId","data-v-f9922aea"]]),Xt={class:"container"},Zt={class:"list-form"},te={class:"contracts__page"},ee={__name:"Contracts",async setup(b){let d,c;const _=ut(),g=z(),i=M(),y=A("emitter"),p=[{value:"Contracts",name:"Договора"},{value:"Profiles",name:"Профили"}],I=$(()=>n.value==="Contracts"?"Договора":"Профили"),n=f("Contracts"),v=f(""),L=$(()=>Object.keys(i?.contractsList)?.map(w=>i?.contractsList[w])?.reverse());function P(){n.value==="Contracts"?g.push({path:"/ContractMake"}):g.push({path:"/ProfileMake"})}function x(){y.emit("open-modal",{component:"FundsTransfer"})}return _?.query?.section?n.value=_.query?.section:g.replace({query:{section:"Contracts"}}),R(n,()=>{g.replace({query:{section:n.value}})}),[d,c]=q(()=>i.fetchContracts()),await d,c(),[d,c]=q(()=>i.fetchProfiles()),await d,c(),(w,C)=>{const V=Dt,u=kt,a=It,B=yt,N=Ct,r=gt,t=Wt,h=Nt;return D(),O(pt,null,[l(V),e("div",Xt,[l(u,{modelValue:n.value,"onUpdate:modelValue":C[0]||(C[0]=k=>n.value=k),tabs:p},null,8,["modelValue"]),l(B,null,{title:s(()=>[E(m(I.value),1)]),buttons:s(()=>[dt(l(a,{label:"Перевод средств",onClick:C[1]||(C[1]=k=>x())},null,512),[[mt,n.value==="Contracts"&&L.value.length>1]]),l(a,{label:n.value==="Contracts"?"Создать договор":"Создать профиль",onClick:P},null,8,["label"])]),_:1}),l(N),e("div",Zt,[l(r,{modelValue:v.value,"onUpdate:modelValue":C[2]||(C[2]=k=>v.value=k)},null,8,["modelValue"])]),e("div",te,[n.value==="Contracts"?(D(),U(t,{key:0,search:v.value},null,8,["search"])):(D(),U(h,{key:1,search:v.value},null,8,["search"]))])])],64)}}},Ce=F(ee,[["__scopeId","data-v-0f5caeaa"]]);export{Ce as default};
