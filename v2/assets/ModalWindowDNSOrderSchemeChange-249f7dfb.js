import{j as k,o as M,c as j,a as d,t as u,b,w as C,p as w,l as x,_ as E,r as O,S as L,g as f,h as y,O as V}from"./index-5e313302.js";import{u as B}from"./services-21abfb71.js";import{s as P}from"./multiselect-bfc29db8.js";import{_ as U}from"./ButtonDefault-7c216fc6.js";const g=c=>(w("data-v-6109ed49"),c=c(),x(),c),G={class:"modal__body"},H=g(()=>d("div",{class:"list-item__title"},"Смена тарифного плана",-1)),W=g(()=>d("div",{class:"list-item__subtitle"},"Текущий тарифный план ",-1)),A=g(()=>d("div",{class:"modal__input-row"},null,-1)),K=g(()=>d("div",{class:"modal__input-label"},"Новый тарифный план",-1)),q={class:"list-form_col list-form_col--xl"},z=g(()=>d("div",{class:"search-field form-field"},null,-1)),F={class:"multiselect-multiple-label"},J={class:"multiselect-option"};function Q(c,m,e,o,p,N){var _,D;const S=k("Multiselect"),h=U;return M(),j("div",G,[H,W,d("span",null,u((_=o.getDNSScheme[0])==null?void 0:_.name)+"/"+u((D=o.getDNSScheme[0])==null?void 0:D.cost),1),A,K,d("div",q,[z,b(S,{class:"multiselect--white",options:o.getDNSSchemes,type:"text",modelValue:o.selectedPackage,"onUpdate:modelValue":m[0]||(m[0]=l=>o.selectedPackage=l),placeholder:"Поиск"},{singlelabel:C(({value:l})=>[d("div",F,[d("span",null,u(l==null?void 0:l.Name)+"/"+u(l==null?void 0:l.CostMonth),1)])]),option:C(({option:l})=>[d("div",J,u(l==null?void 0:l.Name)+"/"+u(l==null?void 0:l.CostMonth),1)]),_:1},8,["options","modelValue"])]),b(h,{class:"modal__button",label:"Сменить","is-loading":o.isLoading,onClick:m[1]||(m[1]=l=>o.changeScheme())},null,8,["is-loading"])])}const R={components:{Multiselect:P},props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(c,{emit:m}){const e=B(),o=O(!1),p=O(null);L("emitter");const N=f(()=>e==null?void 0:e.DNSmanagerOrdersList),S=f(()=>{const a=N.value;if(!(!a||typeof a!="object"))return Object.keys(a).map(t=>a[t]).find(t=>{var s;return t.OrderID===((s=c.data)==null?void 0:s.DNSID)})}),h=f(()=>Object.keys(e==null?void 0:e.additionalServicesScheme.DNSmanager).map(a=>{var t,s,r;return{...e==null?void 0:e.additionalServicesScheme.DNSmanager[a],value:(t=e==null?void 0:e.additionalServicesScheme.DNSmanager[a])==null?void 0:t.ID,name:(s=e==null?void 0:e.additionalServicesScheme.DNSmanager[a])==null?void 0:s.Name,cost:(r=e==null?void 0:e.additionalServicesScheme.DNSmanager[a])==null?void 0:r.CostMonth}}).filter(a=>{var t;return(a==null?void 0:a.ID)==((t=S.value)==null?void 0:t.SchemeID)})),_=f(()=>{var r;const a=h.value[0],t=(r=Object.keys(e==null?void 0:e.additionalServicesScheme.DNSmanager).map(n=>{var i;return{...e==null?void 0:e.additionalServicesScheme.DNSmanager[n],value:(i=e==null?void 0:e.additionalServicesScheme.DNSmanager[n])==null?void 0:i.ID}}))==null?void 0:r.filter(n=>{var i,I,v;return((i=n==null?void 0:n.value)==null?void 0:i.HardServerID)===(a==null?void 0:a.HardServerID)&&(n==null?void 0:n.IsSchemeChangeable)&&(n==null?void 0:n.ID)!==((I=S.value)==null?void 0:I.SchemeID)&&(n==null?void 0:n.ServersGroupID)===((v=c.data)==null?void 0:v.ServerGroup)});return[a,...t].sort((n,i)=>n.SortID-i.SortID).map(n=>({...n,disabled:n.ID===a.ID}))});function D(){var a;o.value=!0,e.DNSmanagerOrderSchemeChange({NewSchemeID:p.value,DNSmanagerOrderID:(a=S.value)==null?void 0:a.ID}).then(t=>{let{result:s,error:r}=t;s==="SUCCESS"&&m("modalClose"),o.value=!1})}y(()=>{var a,t,s,r;e.fetchAdditionalServiceScheme((a=c.data)==null?void 0:a.Code),e.fetchDNSmanagerOrders(),p.value=(s=(t=_.value)==null?void 0:t[1])==null?void 0:s.value,console.log((r=c.data)==null?void 0:r.Code),console.log(h.value[0]),console.log(_.value)});const l=a=>{a.key==="Enter"&&D()};return y(()=>{document.addEventListener("keyup",l)}),V(()=>{document.removeEventListener("keyup",l)}),{isLoading:o,getDNSSchemes:_,changeScheme:D,selectedPackage:p,getDNSScheme:h}}},$=E(R,[["render",Q],["__scopeId","data-v-6109ed49"]]);export{$ as default};
