import{_ as K}from"./EmptyStateBlock-BaR9js3E.js";import{_ as q}from"./BlockAdditionalServices-BALrMbkE.js";import{_ as z}from"./ButtonDefault-BIBStZbJ.js";import{_ as J}from"./StatusBadge-CjHHKSUG.js";import{_ as Q}from"./ClausesKeeper-CTja-fCz.js";import{_ as W}from"./BlockBalanceAgreement-qtspRQ_B.js";import{u as X,r as x,f as S,g as Y,H as Z,c,b as p,a as r,h as y,t as u,w as H,E as ee,F as C,i as P,C as L,x as te,d as se,o as l,e as V}from"./index-CmCGXBst.js";import{u as re}from"./hosting-CzUiTaaD.js";import{u as oe}from"./services-C54cnl9l.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-DwS3lKQb.js";import"./ServiceListOrderSelection-DUe6fwsE.js";import"./TotalAmount.vue_vue_type_script_setup_true_lang-CXrtmBc-.js";import"./BasicInput-KlObNzdO.js";import"./component-0WedTVCo.js";import"./BlockSelectContract-uyQ-oMQe.js";import"./contracts-P7YPBhEI.js";import"./multiselect-DhoC9bwZ.js";import"./IconClose-B_k4TzXM.js";const ne={class:"tw-px-4 md:tw-px-8"},ie={key:0,class:"tw-text-gray-500 tw-text-sm tw-mt-2"},le={class:"tw-flex tw-items-center tw-gap-8 tw-border-b tw-border-gray-200 tw-mt-4 tw-whitespace-nowrap tw-mb-6"},ce={key:0,class:"section-body"},de={class:"ordered-services-list"},ue={class:"ordered-service-header"},ve={class:"ordered-service-name"},me={class:"ordered-service-status"},_e={class:"ordered-service-details"},pe={class:"ordered-service-info"},Se={key:0},fe={class:"ordered-service-actions"},De={class:"section-body"},ge={key:2,class:"loading"},Ie={key:0,class:"tw-px-4 md:tw-px-8 tw-mb-6"},we={class:"total-block"},he={class:"total-block__row"},be={class:"total-block__col"},ye={class:"total-block__col"},ke={class:"total-block__col"},Oe={class:"total-block__row total-block__row--big"},xe={class:"total-block__col"},Ce={__name:"HostingServices",setup(Ee){const U=Y(),f=se(),v=re(),w=oe(),h=X(),D=te("emitter"),a=x([]),E=x(!0),b=x(!1),n=S(()=>v?.hostingList?Object.keys(v.hostingList).map(s=>v.hostingList[s]).find(s=>s&&s.OrderID==U.params.id):null),R=S(()=>!n.value?.SchemeID||!v?.hostingSchemes?null:v.hostingSchemes[n.value.SchemeID]),$=S(()=>!n.value||!R.value?null:{ServiceID:n.value.ServiceID,ServersGroupID:R.value.ServersGroupID}),g=S(()=>w?.ServicesList||{}),k=S(()=>{if(!n.value?.OrderID||!h?.userOrders)return[];const t=n.value.OrderID;return Object.keys(h.userOrders).map(i=>h.userOrders[i]).filter(i=>{const d=String(i?.DependOrderID)===String(t),I=i?.ServiceID,_=g.value[i.ServiceID];return d&&I&&_}).sort((i,d)=>Number(i?.ID)-Number(d?.ID))}),A=S(()=>{if(!a.value||!Array.isArray(a.value))return 0;let t=0;return a.value.forEach(e=>{e&&typeof e.Price=="number"&&(t+=e.Price)}),N(t)});function F(t){a.value=t||[]}function N(t){return t==null?"0.00":Number(t).toFixed(2)||"0.00"}async function M(){if(!(!a.value||!Array.isArray(a.value)||a.value.length===0))for(const t of a.value){if(!t)continue;let e="SUCCESS",s=g.value[t.ServiceID]?.Code;const m={Code:s,DependOrderID:n.value?.OrderID,...t,ContractID:n.value?.ContractID};try{const{result:i,info:d,error:I}=await w.ServiceOrder(m);if(i==="SUCCESS"){let _={};s==="Default"?_.ServiceOrderID=d?.ServiceOrderID:_[`${s}OrderID`]=d?.ServiceOrderID;const O=await w.ServiceOrderPay(s,_);let{result:o,error:B}=O;o==="SUCCESS"?(D.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),a.value=[],f.push("/AdditionalServices")):o==="BASKET"&&f.push("/Basket")}else e="ERROR",D.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(i){console.error("Ошибка при заказе услуги:",i),e="ERROR",D.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(e==="ERROR")break}}async function T(){b.value=!0;try{await M()}catch(t){console.error("Ошибка при заказе услуг:",t),D.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{b.value=!1}}function j(t){const e=Object.values(g.value).find(m=>m.ID===t);if(!e){f.push(`/AdditionalServices/${t}`);return}const s=e.Code;s==="Default"||s==="DNSmanager"||s==="ISPsw"||s==="ExtraIP"?f.push(`/AdditionalServices/${t}`):f.push(`/${s}Orders/${t}`)}function G(t,e){let s="Orders";e==5e4?s="ExtraIPOrders":e==51e3?s="ISPswOrders":e==52e3&&(s="DNSmanagerOrders"),D.emit("open-modal",{component:"StatusHistory",data:{modeID:s,rowID:t}})}return Z(async()=>{try{await v.fetchHostingOrders(),await v.fetchHostingSchemes(),await w.fetchServices(),await h.fetchUserOrders()}catch(t){console.error("Ошибка загрузки данных:",t)}finally{E.value=!1}}),(t,e)=>{const s=W,m=ee("RouterLink"),i=Q,d=J,I=z,_=q,O=K;return l(),c(C,null,[p(s),r("div",ne,[r("div",null,[e[4]||(e[4]=r("h1",{class:"tw-text-xl sm:tw-text-4xl"},"Дополнительные услуги",-1)),n.value?(l(),c("div",ie," Хостинг # "+u(n.value?.OrderID),1)):y("",!0),r("div",le,[p(m,{class:"tw-py-2 tw-cursor-pointer -tw-mb-[1px]","active-class":"tw-text-sky-400 tw-border-b-2 tw-border-sky-400",to:`/HostingOrders/${n.value?.OrderID}`},{default:H(()=>e[2]||(e[2]=[V(" Хостинг ",-1)])),_:1,__:[2]},8,["to"]),p(m,{class:"tw-py-2 tw-cursor-pointer -tw-mb-[1px]","active-class":"tw-text-sky-400 tw-border-b-2 tw-border-sky-400",to:`/HostingServices/${n.value?.OrderID}`},{default:H(()=>e[3]||(e[3]=[V(" Услуги ",-1)])),_:1,__:[3]},8,["to"])])]),p(i),k.value&&k.value.length>0?(l(),c("div",ce,[e[5]||(e[5]=r("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),r("div",de,[(l(!0),c(C,null,P(k.value,o=>(l(),c("div",{class:"ordered-service-item",key:o.ID},[r("div",ue,[r("div",ve,u(g.value[o?.ServiceID]?.Name||o?.ServiceName||`Услуга #${o?.ServiceID}`),1),r("div",me,[p(d,{status:o?.StatusID,"status-table":"Orders",onClick:B=>G(o?.ID,o?.ServiceID),class:"tw-cursor-pointer"},null,8,["status","onClick"])])]),r("div",_e,[r("div",pe,[r("span",null,"Заказ # "+u(o?.ID),1),o?.DaysRemainded?(l(),c("span",Se," Осталось дней: "+u(o?.DaysRemainded),1)):y("",!0)])]),r("div",fe,[p(I,{class:"btn--sm",label:"Перейти к заказу",onClick:B=>j(o?.ID)},null,8,["onClick"])])]))),128))])])):y("",!0),r("div",De,[n.value&&$.value?(l(),L(_,{key:0,modelValue:a.value,"onUpdate:modelValue":[e[0]||(e[0]=o=>a.value=o),F],"service-search-params":$.value},null,8,["modelValue","service-search-params"])):E.value?(l(),c("div",ge,"Загрузка...")):(l(),L(O,{key:1,label:"Заказ не найден"}))])]),a.value&&a.value.length>0?(l(),c("div",Ie,[r("div",we,[r("div",he,[e[6]||(e[6]=r("div",{class:"total-block__col"},"Дополнительные услуги",-1)),r("div",be,u(A.value)+" ₽",1)]),(l(!0),c(C,null,P(a.value,o=>(l(),c("div",{class:"total-block__row no-divider",key:o.ServiceID},[r("div",ye,u(g.value[o?.ServiceID]?.Name),1),r("div",ke,u(N(o?.Price))+" ₽",1)]))),128)),r("div",Oe,[e[7]||(e[7]=r("div",{class:"total-block__col"},"Итого к оплате",-1)),r("div",xe,u(A.value)+" ₽",1)])]),p(I,{class:"btn--wide",disabled:!a.value||a.value.length===0||b.value,"is-loading":b.value,label:"Заказать дополнительные услуги",onClick:e[1]||(e[1]=o=>T())},null,8,["disabled","is-loading"])])):y("",!0)],64)}}},Qe=ae(Ce,[["__scopeId","data-v-55bd72dd"]]);export{Qe as default};
