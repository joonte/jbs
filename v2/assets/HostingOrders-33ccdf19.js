import{j,o as m,c as N,b as c,a as r,n as oe,t as h,Z as R,a9 as T,w as P,d as F,y as x,am as te,F as K,x as se,_ as ne,f as ae,e as re,r as f,S as le,i as ce,g}from"./index-90eb49f0.js";import{I as ie}from"./IconSearch-373a4f18.js";import{H as q}from"./HostingItem-bc0cff9f.js";import{_ as z}from"./ClausesKeeper-313482ce.js";import{s as de}from"./multiselect-e18abfd5.js";import{u as ue}from"./hosting-606725d4.js";import{u as me}from"./contracts-0cbe8270.js";import{B as Z}from"./BlockBalanceAgreement-267acfcf.js";import{u as _e}from"./testTransforms-eec373ee.js";import{u as fe}from"./globalActions-a5ec5102.js";import{_ as ge,B as G}from"./IconButtonBack-6d731b2a.js";import{E as ve}from"./EmptyStateBlock-2d70ce64.js";import{_ as pe}from"./FormInputSearch-e1779cda.js";import{f as be}from"./bootstrap-vue-next.es-788a757a.js";import{_ as Se}from"./ButtonDefault-5aebc1f7.js";import"./IconDots-9788fdcb.js";import"./IconCard-95aab40c.js";import"./StatusBadge-0d2c62ad.js";import"./hostStatuses-94d00f20.js";import"./HelperComponent-f1dd2245.js";import"./IconArrow-380053a0.js";import"./useTimeFunction-8602dd60.js";import"./OrderIDBadge-b66a7555.js";import"./IconClose-c838a5bc.js";import"./IconPlus-855c0bea.js";const ke={class:"section"},he={class:"container"},Ie={class:"title__icon"},Ce={class:"btn__group"},He={class:"group__several"},Be={class:"list-form"},we={class:"list-form_col list-form_col--sm"},ye={class:"list-form_select"},De={class:"multiselect-option"},Oe={key:0};function Pe(a,n,v,e,I,C){var y,S,D;const p=Z,b=ge,d=Se,u=j("router-link"),H=G,B=be,_=z,U=j("Multiselect"),V=pe,L=q,w=ve;return m(),N(K,null,[c(p),r("div",ke,[r("div",he,[r("div",{class:oe(["section-header",e.isSeveral?"column":""])},[r("div",Ie,[r("h1",{class:"section-title",onClick:n[0]||(n[0]=t=>e.reloadNow())},h(e.isSeveral?"Продление услуг Хостинга":"Хостинг"),1),R(c(b,{onClick:n[1]||(n[1]=t=>e.outSeveralOrders())},null,512),[[T,e.isSeveral]])]),R(r("div",Ce,[c(d,{class:"btn-several",label:"Продлить несколько заказов",onClick:n[2]||(n[2]=t=>e.prolongSeveralOrders())}),c(u,{class:"btn btn--blue btn-default",to:"/HostingSchemes"},{default:P(()=>[F("Заказать")]),_:1})],512),[[T,!e.isSeveral]]),R(r("div",He,[c(H,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":n[3]||(n[3]=t=>e.selectPeriod=t)},null,8,["modelValue"]),c(B,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":n[4]||(n[4]=t=>e.useBalance=t),name:"checkbox-balance"},{default:P(()=>[F("Использовать средства с баланса")]),_:1},8,["modelValue"]),c(d,{label:"Продлить",onClick:n[5]||(n[5]=t=>e.prolongOrders())})],512),[[T,e.isSeveral]])],2),(m(),x(te,null,[c(_)],1024)),r("div",Be,[r("div",we,[r("div",ye,[c(U,{modelValue:e.select,"onUpdate:modelValue":n[6]||(n[6]=t=>e.select=t),options:e.getUsers,disabled:((y=e.getUsers)==null?void 0:y.length)<=1,label:"name"},{singlelabel:P(({value:t})=>[r("span",null,"# "+h(t.value.padStart(5,"0"))+" / "+h(t.name),1)]),option:P(({option:t})=>[r("div",De,"# "+h(t.value.padStart(5,"0"))+" / "+h(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),c(V,{modelValue:e.search,"onUpdate:modelValue":n[7]||(n[7]=t=>e.search=t)},null,8,["modelValue"])]),e.getHostingList&&((S=e.getHostingList)==null?void 0:S.length)>0?(m(),N("div",Oe,[e.filterProducts&&((D=e.filterProducts)==null?void 0:D.length)>0?(m(!0),N(K,{key:0},se(e.filterProducts,(t,M)=>{var i,k;return m(),x(L,{"item-data":t,"user-name":`${(i=e.getUser)==null?void 0:i.Name} - ${(k=e.getContracts[t==null?void 0:t.ContractID])==null?void 0:k.Customer}`,params:e.getHostingItemParam(t),"info-link":`/HostingOrders/${t==null?void 0:t.OrderID}`,"is-last":M===e.filterProducts.length-1,isSeveral:e.isSeveral,"selected-rows":e.selectedRows,onUpdateSelectedRows:e.handleSelectedRowsUpdate,onDelete:e.deleteItem,onTransfer:e.transferItem,onManage:e.orderManage},null,8,["item-data","user-name","params","info-link","is-last","isSeveral","selected-rows","onUpdateSelectedRows","onDelete","onTransfer","onManage"])}),256)):(m(),x(w,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(m(),x(w,{key:1,class:"no-margin",label:"У Вас нет заказов на хостинг"}))])])],64)}const xe={components:{IconSearch:ie,Multiselect:de,ClausesKeeper:z,HostingItem:q,BlockBalanceAgreement:Z,BlockSelectPeriod:G},async setup(){const a=ue(),n=ae(),v=me(),e=fe(),I=re(),{formDescriptionLine:C}=_e(),p=f("*"),b=f(null),d=f(!1),u=f([]),H=f(null),B=f(!1),_=le("emitter");_.on("updateHostingList",()=>{a.fetchHostingOrders()});const U=s=>{u.value=s};async function V(){console.log(u.value);const s=Object.keys(u.value).filter(l=>u.value[l]),o={ServiceID:"10000",ItemsPay:H.value,OrdersIDs:s,...B.value&&{UseBalance:"yes"}};await e.OrdersPay(o).then(l=>{l==="Basket"?(console.log("Success"),I.push("/Basket")):l==="SUCCESS"&&(d.value=!1,_.emit("open-modal",{component:"BalanceProlong",data:{Service:"хостинга"}}))})}function L(){d.value=!0}function w(){d.value=!1}ce(()=>{i.value.length<1&&S()});function y(){I.go(0)}function S(){I.push({path:"/HostingSchemes"})}function D(s){_.emit("open-modal",{component:"DeleteItem",data:{id:s,message:"Вы действительно хотите удалить хостинг?",tableID:"HostingOrders",successEmit:"updateHostingList"}})}function t(s){_.emit("open-modal",{component:"OrdersTransfer",data:s})}function M(s){e.OrderManageHosting(s)}const i=g(()=>{var s;return(s=Object.keys(a==null?void 0:a.hostingList).map(o=>a==null?void 0:a.hostingList[o]))==null?void 0:s.reverse()}),k=g(()=>a==null?void 0:a.hostingSchemes),A=g(()=>v==null?void 0:v.contractsList),J=g(()=>{let s=[{value:"*",name:"Все договора"}];return i.value!==null?(i.value.forEach(o=>{var l;s.find(O=>O.value===o.ContractID)||s.push({value:o.ContractID,name:(l=A.value[o==null?void 0:o.ContractID])==null?void 0:l.Customer})}),s):{value:"*",name:"Все договора"}}),Q=g(()=>n.userInfo),W=g(()=>Y(X(i.value)));function X(s){return p.value!=="*"?s.filter(o=>(o==null?void 0:o.ContractID)===p.value):s}function Y(s){return b.value!==null?s.filter(o=>o==null?void 0:o.Domain.toLowerCase().includes(b.value.toLowerCase())):s}function $(s){var l,O,E;const o=ee(s==null?void 0:s.SchemeID);return[{text:o==null?void 0:o.Name},{text:C((l=o==null?void 0:o.SchemeParams)==null?void 0:l.limit_webdomains)},{text:C((O=o==null?void 0:o.SchemeParams)==null?void 0:O.limit_quota)},{text:C((E=o==null?void 0:o.SchemeParams)==null?void 0:E.limit_emails)},{text:`${o==null?void 0:o.CostMonth} ₽ в месяц`,bold:!0}]}function ee(s){var o;return(o=k.value)==null?void 0:o[s]}return await a.fetchHostingOrders(),await a.fetchHostingSchemes(),await v.fetchContracts(),{getHostingList:i,getHostingSchemes:k,orderManage:M,filterProducts:W,getUsers:J,getUser:Q,select:p,search:b,getContracts:A,deleteItem:D,transferItem:t,getHostingItemParam:$,navigateToHostingSchemes:S,reloadNow:y,prolongSeveralOrders:L,isSeveral:d,selectedRows:u,selectPeriod:H,prolongOrders:V,outSeveralOrders:w,useBalance:B,handleSelectedRowsUpdate:U}}},so=ne(xe,[["render",Pe],["__scopeId","data-v-d0fb215a"]]);export{so as default};
