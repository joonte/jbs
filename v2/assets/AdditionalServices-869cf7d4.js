import{j as Q,o as C,c as X,a as _,n as Y,t as B,Z as R,a9 as W,b as I,w as S,d as V,y as T,k as $,F as ee,p as pe,l as he,_ as se,e as re,f as ae,S as ie,r as h,g as A,i as te,x as Ce,a7 as we,C as Pe}from"./index-4466e2da.js";import{u as ce}from"./services-a9d98fb1.js";import{u as le}from"./contracts-44396072.js";import"./postings-8cf94dee.js";import{u as de}from"./globalActions-a65ed06f.js";import{u as xe}from"./resetServer-40ee621e.js";import{f as oe}from"./useTimeFunction-8602dd60.js";import{_ as ue}from"./IconCard-36c54c16.js";import{E as Z}from"./EmptyStateBlock-1f67284f.js";import{S as _e}from"./StatusBadge-b68990e4.js";import{s as Be}from"./servicesStatuses-6293b6ac.js";import{_ as Le}from"./HelperComponent-a9a57158.js";import{s as me}from"./multiselect-a1f1bb25.js";import{_ as Ne,B as ve}from"./IconButtonBack-a6494adb.js";import{f as je,z as Ee,k as Ve,d as Te,C as Ue}from"./bootstrap-vue-next.es-61f2820f.js";import{_ as Ae}from"./IconDots-1c53be05.js";import{_ as He}from"./ClausesKeeper-f5a8709e.js";import{_ as Me}from"./ButtonDefault-18fa1414.js";import{B as fe}from"./BlockBalanceAgreement-762408e5.js";import{_ as Re}from"./IconArrow-1085f1dc.js";import"./IconClose-96271d50.js";const We=[{key:"Several",label:"",variant:"",sortable:!1},{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],H=m=>(pe("data-v-d2017316"),m=m(),he(),m),ze={class:"section-header"},Ge={class:"title__icon"},Fe={class:"btn__group"},qe={class:"group__several"},Ke=H(()=>_("span",{class:"td-mobile"},"Заказ",-1)),Xe=["onClick"],Ze=H(()=>_("span",{class:"td-mobile"},"Договор",-1)),Je=H(()=>_("span",{class:"td-mobile"},"Ключевые поля",-1)),Qe={class:"key-field"},Ye={class:"hosting-status__date"},$e=H(()=>_("span",{class:"td-mobile"},"Статус",-1)),et=H(()=>_("span",{class:"td-mobile"},"Дата окончания",-1)),tt=H(()=>_("span",{class:"td-mobile"},"Комментарий",-1)),nt={class:"service__controls-wrapper"},ot=["onClick"],st={class:"btn btn--dots"};function rt(m,a,c,e,E,g){var M,z,G,F;const L=Ne,y=Me,w=ve,p=je,P=He,b=_e,x=Q("Helper"),D=ue,N=Ae,d=Q("router-link"),o=Ee,v=Ve,j=Te,i=Ue,U=Z;return C(),X(ee,null,[_("div",ze,[_("div",{class:Y(["section-title__nowrap",e.isSeveral?"column":""])},[_("div",Ge,[_("h1",{class:"section-title",onClick:a[0]||(a[0]=t=>e.reloadNow())},B(e.isSeveral?"Продление услуг "+((M=c.sectionData)==null?void 0:M.Item):(z=c.sectionData)==null?void 0:z.Item),1),R(I(L,{onClick:a[1]||(a[1]=t=>e.outSeveralOrders())},null,512),[[W,e.isSeveral]])]),R(_("div",Fe,[R(I(y,{class:"btn-several",label:"Продлить несколько заказов",onClick:a[2]||(a[2]=t=>e.prolongSeveralOrders())},null,512),[[W,c.sectionID==="50000"||c.sectionID==="51000"||c.sectionID==="52000"&&e.getOrders.length>1]]),I(y,{label:"Заказать",onClick:a[3]||(a[3]=t=>e.navigateToOrder())})],512),[[W,!e.isSeveral]]),R(_("div",qe,[I(w,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":a[4]||(a[4]=t=>e.selectPeriod=t)},null,8,["modelValue"]),I(p,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":a[5]||(a[5]=t=>e.useBalance=t),name:"checkbox-balance"},{default:S(()=>[V("Использовать средства с баланса")]),_:1},8,["modelValue"]),I(y,{label:"Продлить",onClick:a[6]||(a[6]=t=>e.prolongOrders())})],512),[[W,e.isSeveral]])],2),I(P,{class:"additional-clauses",partition:`Header:${((G=c.sectionData)==null?void 0:G.Code)==="Default"?c.sectionID:`/${(F=c.sectionData)==null?void 0:F.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(C(),T(i,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":a[7]||(a[7]=t=>e.sortBy=t),"sort-desc":e.sortDesc,"onUpdate:sortDesc":a[8]||(a[8]=t=>e.sortDesc=t),onRowClicked:e.navigateToOrderPage,"sort-direction":e.sortDirection},{"cell(Several)":S(t=>[R(I(p,{id:"checkbox-"+t.index,modelValue:e.selectedRows[t.index],"onUpdate:modelValue":f=>e.selectedRows[t.index]=f,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[W,e.isSeveral]])]),"cell(ID)":S(t=>[Ke,_("span",{class:"order-id",onClick:f=>e.toItem(t.value)},B(t.value),9,Xe)]),"cell(ContractID)":S(t=>{var f,O;return[Ze,_("span",null,"#"+B((f=e.getContracts[t.value])==null?void 0:f.ID)+" / "+B((O=e.getContracts[t.value])==null?void 0:O.Customer),1)]}),"cell(Keys)":S(t=>{var f,O;return[Je,_("span",Qe,[V(B(e.findDomainByOrderID((f=t.item)==null?void 0:f.ID)),1),_("pre",Ye,B(e.getTitleText((O=t.item)==null?void 0:O.ID)),1)])]}),"cell(StatusID)":S(t=>[$e,I(b,{class:"clickable-element",status:t.value,"status-table":"Orders",onClick:f=>{var O,q;return e.openHistoryStatuses((O=t.item)==null?void 0:O.ID,(q=t.item)==null?void 0:q.ServiceID)}},null,8,["status","onClick"])]),"cell(ExpirationDate)":S(t=>{var f,O;return[et,_("span",null,B(e.calculateExpirationDate((f=t.item)==null?void 0:f.DaysRemainded))+" | "+B(((O=t.item)==null?void 0:O.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":S(t=>{var f;return[tt,I(x,{class:"clickable-element","user-notice":t.value,id:(f=t.item)==null?void 0:f.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":S(t=>[_("div",nt,[_("div",{class:"btn btn--md btn--bold clickable-element",onClick:f=>e.handlePayment(t.item.ID,t.item.ServiceID,t.item.ContractID)},[I(D),V("Оплатить")],8,ot),I(j,{class:"dropdown-dots",right:""},{"button-content":S(()=>[_("div",st,[I(N)])]),default:S(()=>[I(o,null,{default:S(()=>[I(d,{to:`/AdditionalServices/${t.item.ID}`},{default:S(()=>[V("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),I(o,{onClick:f=>e.transferItem(t.item.ID,t.item.ServiceID)},{default:S(()=>[V("Передать на другой аккаунт")]),_:2},1032,["onClick"]),c.sectionID==="51000"||c.sectionID==="52000"?(C(),T(o,{key:0,onClick:f=>e.orderManage(t.item.ID,t.item.ServiceID)},{default:S(()=>[V("Управлять заказом")]),_:2},1032,["onClick"])):$("",!0),c.sectionID==="52000"?(C(),T(o,{key:1,onClick:f=>e.openPasswordChange(t.item.ID,t.item.ServiceID)},{default:S(()=>[V("Сменить пароль")]),_:2},1032,["onClick"])):$("",!0),I(v),I(o,{class:"color-red",onClick:f=>m.$emit("deleteItem",t.item)},{default:S(()=>[V("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","onRowClicked","sort-direction"])):(C(),T(U,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const at={components:{BlockSelectPeriod:ve,EmptyStateBlock:Z,StatusBadge:_e,IconCard:ue,Helper:Le,Multiselect:me},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],async setup(m){const a=re(),c=ae(),e=ie("emitter"),E=h(!1),g=h("ID"),L=h(!0),y=h("desc"),w=h(!1),p=h([]),P=h(null),b=h(null),x=le(),D=ce(),N=de(),d=A(()=>D==null?void 0:D.DNSmanagerOrdersList),o=A(()=>D==null?void 0:D.ISPswOrdersList),v=A(()=>D==null?void 0:D.ExtraIPOrdersList);function j(){a.go(0)}async function i(){let r="";m.sectionID==="50000"?r="IP адресов":m.sectionID==="51000"?r="лицензии ISPsystem":m.sectionID==="52000"&&(r="вторичного DNS"),console.log(p.value);const s=K.value.filter((u,k)=>p.value[k]),n=s.map(u=>u.ID),l={ServiceID:m.sectionID,ItemsPay:b.value,OrdersIDs:n,...E.value&&{UseBalance:"yes"}};await N.OrdersPay(l).then(u=>{u==="Basket"?(console.log("Success"),a.push("/Basket")):u==="SUCCESS"&&(w.value=!1,e.emit("open-modal",{component:"BalanceProlong",data:{Service:r}}))}),console.log("Selected Orders:",s),console.log("_contract_select:",P.value),console.log("selectPeriod:",b.value)}function U(r){const s=d.value,n=String(r),l=Object.values(s).find(u=>String(u.OrderID)===n);return console.log(l),l}const M=A(()=>x==null?void 0:x.contractsList);function z(r,s,n){s==="50000"||s==="51000"||s==="52000"?ne(r,s):a.push(`/ServiceOrderPay/${r}`)}function G(r,s){console.log(r);const n=U(r);e.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:n.ID,ServiceID:s,emitEvent:"updateServicesList",Login:n.Login}})}function F(r,s){let n=null,l="";switch(s){case"50000":n=Object.entries(v.value).find(([u,k])=>k),l="ExtraIPOrders";break;case"51000":n=Object.entries(o.value).find(([u,k])=>k),l="ISPswOrders";break;case"52000":n=Object.entries(d.value).find(([u,k])=>k),l="DNSmanagerOrders";break;default:n=Object.entries(K.value).find(([u,k])=>k),l="Orders"}n&&e.emit("open-modal",{component:"StatusHistory",data:{modeID:l,rowID:n[1].ID}})}const t=r=>{const s=f(r);if(s){const n=s.split(","),l=n.length,u=n.join(`
`);return`Всего: ${l}
${u}`}return"Нет данных"},f=r=>{const s=Object.entries(d.value).reduce((n,[l,u])=>(n[l]=u,n),{});for(const n in s)if(Object.hasOwnProperty.call(s,n)){const l=s[n];if(String(l.OrderID)===String(r))return l.Parked}return null};function O(){w.value=!0}function q(){w.value=!1}function ne(r,s,n){s==="51000"?a.push(`/ISPswOrderPay/${r}`):s==="52000"?a.push(`/DNSmanagerOrderPay/${r}`):s==="50000"&&a.push(`/ExtraIPOrderPay/${r}`)}function De(r,s,n){n.target.closest("button, a, .clickable-element")||a.push(`/AdditionalServices/${r.ID}`)}function Se(r){a.push(`/AdditionalServices/${r}`)}function ge(r,s){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:r,ServiceID:s}})}function ke(r,s){let n;s==="51000"?n=Object.entries(o.value).reduce((u,[k,J])=>(u[k]=J,u),{}):s==="52000"&&(n=Object.entries(d.value).reduce((u,[k,J])=>(u[k]=J,u),{}));let l;for(const u in n)if(Object.hasOwnProperty.call(n,u)){const k=n[u];if(String(k.OrderID)===String(r)){l=k;break}}l&&N.OrderManageHosting({ServiceOrderID:l.ID,OrderID:r,ServiceID:s,XMLHttpRequest:"yes"})}const be=r=>{const s=Object.entries(d.value).reduce((n,[l,u])=>(n[l]=u,n),{});for(const n in s)if(Object.hasOwnProperty.call(s,n)){const l=s[n];if(String(l.OrderID)===String(r))return l.Domain}return null},K=A(()=>{var r,s;return(s=(r=Object.keys(c==null?void 0:c.userOrders).map(n=>{var l;return{...c==null?void 0:c.userOrders[n],ID:Number((l=c==null?void 0:c.userOrders[n])==null?void 0:l.ID)}}))==null?void 0:r.reverse())==null?void 0:s.filter(n=>n.ServiceID===(m==null?void 0:m.sectionID))});function Oe(){a.push(`/AdditionalServicesOrder?ServiceID=${m==null?void 0:m.sectionID}`)}function ye(r){if(!r)return oe(new Date);const s=new Date,n=new Date(s.getTime()+r*24*60*60*1e3);return oe(n)}return te(()=>{p.value=K.value.map(()=>!1)}),await D.fetchDNSmanagerOrders(),await D.fetchISPswOrders(),await D.fetchExtraIPOrders(),{authStore:c,getOrders:K,getContracts:M,sortBy:g,sortDesc:L,sortDirection:y,navigateToOrder:Oe,servicesStatuses:Be,oneTimeWorksFields:We,calculateExpirationDate:ye,getDNSmanagerOrders:d,findDomainByOrderID:be,findParkedByOrderID:f,getTitleText:t,transferItem:ge,orderManage:ke,servicePay:ne,handlePayment:z,navigateToOrderPage:De,openHistoryStatuses:F,toItem:Se,openPasswordChange:G,reloadNow:j,prolongSeveralOrders:O,isSeveral:w,selectedRows:p,_contract_select:P,selectPeriod:b,prolongOrders:i,outSeveralOrders:q,useBalance:E}}},Ie=se(at,[["render",rt],["__scopeId","data-v-d2017316"]]),it={class:"section"},ct={class:"container"},lt={class:"section-header"},dt={class:"section-nav"},ut=["title","onClick"],_t={class:"multiselect-option"},mt={class:"section-body"};function vt(m,a,c,e,E,g){var b,x,D,N,d,o,v,j;const L=fe,y=Re,w=Q("Multiselect"),p=Ie,P=Z;return C(),X(ee,null,[I(L),_("div",it,[_("div",ct,[_("div",lt,[_("div",dt,[(C(!0),X(ee,null,Ce((b=e.getServices)==null?void 0:b.slice(0,e.visibleItemsCount),i=>{var U;return C(),X("div",{class:Y(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(i==null?void 0:i.ID)}]),title:(U=e.getServerGroup(i==null?void 0:i.ServersGroupID))==null?void 0:U.Comment,onClick:M=>e.switchToSection(i==null?void 0:i.ID)},B(i==null?void 0:i.Item),11,ut)}),256)),((x=e.getServices)==null?void 0:x.length)>e.visibleItemsCount?(C(),T(w,{key:0,modelValue:e.section,"onUpdate:modelValue":a[0]||(a[0]=i=>e.section=i),class:Y({"multiselect--white additional-service__select":!0,"additional-service__select_active":(N=e.getServices)==null?void 0:N.slice(e.visibleItemsCount,(D=e.getServices)==null?void 0:D.length).find(i=>(i==null?void 0:i.ID)===e.section)}),options:(o=e.getServices)==null?void 0:o.slice(e.visibleItemsCount,(d=e.getServices)==null?void 0:d.length),label:"ID",onSelect:a[1]||(a[1]=i=>e.switchToSection(i))},{option:S(({option:i})=>[_("div",_t,B(i==null?void 0:i.Item),1)]),caret:S(()=>[I(y,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):$("",!0)])]),_("div",mt,[(v=e.getServices)!=null&&v.find(i=>i.ID===e.section)?(C(),T(p,{key:0,sectionID:e.section,sectionData:(j=e.getServices)==null?void 0:j.find(i=>i.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(C(),T(P,{key:1,label:"Услуга не найдена"}))])])])],64)}const ft={components:{ServiceListSection:Ie,emptyStateBlock:Z,Multiselect:me,BlockBalanceAgreement:fe},async setup(){const m=h(3);let a=()=>{window.innerWidth>=1920?m.value=9:window.innerWidth>=1600?m.value=7:window.innerWidth>=1440?m.value=6:window.innerWidth>=1200?m.value=5:window.innerWidth>=992?m.value=4:m.value=3};const c=we(),e=re(),E=ie("emitter"),g=ce(),L=xe();de();const y=ae(),w=le(),p=h(null);E.on("updateUserOrdersList",()=>{y.fetchUserOrders()});const P=A(()=>{var d;return(d=Object.keys(g==null?void 0:g.ServicesList))==null?void 0:d.map(o=>{var v;return{...g==null?void 0:g.ServicesList[o],value:(v=g==null?void 0:g.ServicesList[o])==null?void 0:v.ID}}).filter(o=>(o==null?void 0:o.ServicesGroupID)!=="1000"&&(o==null?void 0:o.IsActive)&&!(o!=null&&o.IsHidden)).sort((o,v)=>Number(o==null?void 0:o.SortID)<Number(v==null?void 0:v.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(v==null?void 0:v.SortID)?1:0)}),b=h(null);E.on("updateServicesList",()=>{y.fetchUserOrders()});function x(d){e.replace(`/AdditionalServices?ServiceID=${d}`),b.value=d}function D(d){var o,v;return(v=(o=L==null?void 0:L.serverGroupsList)==null?void 0:o.ServersGroups)==null?void 0:v[d]}function N(d){E.emit("open-modal",{component:"DeleteItem",data:{id:d.ID,message:`Вы действительно хотите удалить заказ #${d.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}return te(()=>{var d,o;(d=P.value)!=null&&d.find(v=>{var j;return(v==null?void 0:v.ID)===((j=c==null?void 0:c.query)==null?void 0:j.ServiceID)})?b.value=(o=c==null?void 0:c.query)==null?void 0:o.ServiceID:e.replace(`/AdditionalServices?ServiceID=${b.value}`)}),te(()=>{window.addEventListener("resize",a),a()}),Pe(()=>{window.removeEventListener("resize",a)}),await g.fetchServices().then(()=>{var d,o;b.value=(o=(d=P.value)==null?void 0:d[0])==null?void 0:o.ID}),await w.fetchContracts(),await y.fetchUserOrders(),await g.fetchDNSmanagerOrders(),await g.fetchISPswOrders(),await g.fetchExtraIPOrders(),{section:b,deleteItem:N,getServices:P,additionalServicesValue:p,switchToSection:x,getServerGroup:D,visibleItemsCount:m}}},Ut=se(ft,[["render",vt],["__scopeId","data-v-84174b73"]]);export{Ut as default};
