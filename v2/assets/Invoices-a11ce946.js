import{j as w,o as k,c as B,b as l,a as s,w as c,t as m,F as Z,k as q,d as N,y as $,p as ee,l as te,_ as oe,u as ne,a7 as se,S as ae,r as b,g as h,h as ce}from"./index-83b4b7ba.js";import{u as ie}from"./postings-05f51b78.js";import{u as le}from"./contracts-623ec7a8.js";import{s as re}from"./multiselect-f2568231.js";import{S as J}from"./StatusBadge-0d170ac0.js";import{I as K}from"./IconDownload-7166d32f.js";import{I as Q}from"./IconFile-7147d816.js";import{B as W}from"./BlockBalanceAgreement-c5fad736.js";import{a as de,f as me}from"./useTimeFunction-8602dd60.js";import{E as _e}from"./EmptyStateBlock-68a1c33e.js";import{z as ue,d as pe,C as ve,F as fe}from"./bootstrap-vue-next.es-8f3ae81a.js";import{_ as Ie}from"./IconDots-a66f045d.js";import{_ as be}from"./IconCard-2cc17a6b.js";import{_ as ye}from"./FormInputSearch-48364fb5.js";import{_ as De}from"./ClausesKeeper-55c14b7f.js";import{_ as he}from"./ButtonDefault-dc248ec6.js";import"./IconArrow-80c72216.js";import"./IconPlus-07b0a078.js";import"./IconSearch-30270af1.js";import"./IconClose-86aafc4e.js";const Ce=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Files",variant:"td-controls",label:""}],_=p=>(ee("data-v-f941c7fc"),p=p(),te(),p),ge={class:"section"},ke={class:"container"},Se={class:"section-header"},Pe=_(()=>s("h1",{class:"section-title"},"Счета на оплату",-1)),Fe={class:"list-form"},Le={class:"list-form_col list-form_col--sm"},Be={class:"list-form_select"},Ne={class:"multiselect-option"},Ve=_(()=>s("span",{class:"td-mobile"},"Платежная система",-1)),xe={class:"d-block"},Te=_(()=>s("span",{class:"td-mobile"},"Дата Создания",-1)),Me={class:"d-block"},Oe=_(()=>s("span",{class:"td-mobile"},"Номер счета",-1)),Ue={class:"d-block"},je=_(()=>s("span",{class:"td-mobile"},"Договор",-1)),Ee={class:"d-block"},Re=_(()=>s("span",{class:"td-mobile"},"Статус",-1)),Ae=_(()=>s("span",{class:"td-mobile"},"Сумма",-1)),He={class:"d-block"},ze={class:"invoices__controls-wrapper"},Ge=["href"],Ze={class:"invoices__download-button-wrapper"},qe={class:"invoices__download-text"},Je={class:"btn__group"},Ke=["onClick"],Qe=_(()=>s("p",null,"ОПЛАТИТЬ",-1)),We={class:"dropdown-button"},Xe={class:"btn btn--dots"},Ye=["href"],we={key:0,class:"table-controls"},$e=_(()=>s("span",{class:"text-success"},"First",-1)),et=_(()=>s("span",{class:"text-info"},"Last",-1)),tt={class:"multiselect-multiple-label"},ot={class:"multiselect-option"};function nt(p,n,H,o,v,z){var P,F;const V=W,x=he,C=De,f=w("Multiselect"),S=ye,T=J,M=Q,y=K,O=be,U=Ie,u=ue,j=pe,E=ve,R=fe,A=_e;return k(),B(Z,null,[l(V),s("div",ge,[s("div",ke,[s("div",Se,[Pe,l(x,{onClick:n[0]||(n[0]=e=>o.createNewIncoice()),label:"Выписать новый счёт"})]),l(C),s("div",Fe,[s("div",Le,[s("div",Be,[l(f,{modelValue:o.select,"onUpdate:modelValue":n[1]||(n[1]=e=>o.select=e),options:o.getUsers,disabled:((P=o.getUsers)==null?void 0:P.length)<=1,label:"name"},{singlelabel:c(({value:e})=>[s("span",null,"# "+m(e.value.padStart(5,"0"))+" / "+m(e.name),1)]),option:c(({option:e})=>[s("div",Ne,"# "+m(e.value.padStart(5,"0"))+" / "+m(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l(S,{modelValue:o.search,"onUpdate:modelValue":n[2]||(n[2]=e=>o.search=e)},null,8,["modelValue"])]),((F=o.getFilteredOrders)==null?void 0:F.length)>0?(k(),B(Z,{key:0},[l(E,{class:"basic-table",items:o.getFilteredOrders,fields:o.worksCompleteFields,"show-empty":!0,filter:o.search,"per-page":o.perPage,"current-page":o.currentPage,responsive:"","sort-by":o.sortBy,"onUpdate:sortBy":n[3]||(n[3]=e=>o.sortBy=e),"sort-desc":o.sortDesc,"onUpdate:sortDesc":n[4]||(n[4]=e=>o.sortDesc=e),"sort-direction":o.sortDirection,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:o.setPageToZero},{"cell(PaymentSystemName)":c(e=>[Ve,s("span",xe,m(e.value),1)]),"cell(CreateDate)":c(e=>{var r;return[Te,s("span",Me,m(o.formNormalDate(o.secondToDate((r=e.item)==null?void 0:r.CreateDate))),1)]}),"cell(ID)":c(e=>[Oe,s("span",Ue,m(e.value),1)]),"cell(ContractID)":c(e=>{var r;return[je,s("span",Ee,m((r=e.item)==null?void 0:r.Customer),1)]}),"cell(StatusID)":c(e=>[Re,l(T,{status:e.value,"status-table":"Invoices",onClick:r=>{var I;return o.openHistoryStatuses((I=e.item)==null?void 0:I.ID)}},null,8,["status","onClick"])]),"cell(Summ)":c(e=>{var r;return[Ae,s("span",He,m((r=e.item)==null?void 0:r.Summ)+" ₽",1)]}),"cell(Files)":c(e=>{var r,I,L;return[s("div",ze,[e!=null&&e.value?(k(),B("a",{key:0,class:"invoices__download-button",href:o.getInvoicesPDFLink(e)},[s("div",Ze,[l(M,{class:"invoices__download-icon"}),s("div",qe,"Счет №"+m((L=(I=e==null?void 0:e.value)==null?void 0:I[(r=Object.keys(e==null?void 0:e.value))==null?void 0:r[0]])==null?void 0:L.RowID),1),l(y,{class:"invoices__download-icon"})])],8,Ge)):q("",!0),s("div",Je,[s("button",{class:"btn btn-default btn--border",onClick:D=>o.invoicePayment(e)},[l(O),Qe],8,Ke),s("div",We,[l(j,{class:"dropdown-dots",right:""},{"button-content":c(()=>[s("div",Xe,[l(U)])]),default:c(()=>[l(u,null,{default:c(()=>[s("a",{href:o.getInvoicesTTFLink(e)},"Скачать в формате tiff",8,Ye)]),_:2},1024),l(u,{onClick:D=>o.switchPaymentSystem(e)},{default:c(()=>[N("Изменить счёт")]),_:2},1032,["onClick"]),l(u,{onClick:D=>o.invoicePayment(e)},{default:c(()=>[N("Оплатить")]),_:2},1032,["onClick"]),l(u,{onClick:D=>o.invoicesReject(e)},{default:c(()=>[N("Отменить")]),_:2},1032,["onClick"]),l(u,{onClick:D=>o.invoiceSetConditionally(e)},{default:c(()=>[N("Провести условно")]),_:2},1032,["onClick"])]),_:2},1024)])])])]}),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),o.filteredContractsLength>0?(k(),B("div",we,[l(R,{modelValue:o.currentPage,"onUpdate:modelValue":n[5]||(n[5]=e=>o.currentPage=e),"total-rows":o.filteredContractsLength,"per-page":o.perPage,"first-number":"","last-number":""},{"first-text":c(()=>[$e]),"last-text":c(()=>[et]),page:c(({page:e,active:r})=>[s("span",null,m((e-1)*o.perPage+1)+"-"+m(e*o.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),l(f,{class:"multiselect--white",modelValue:o.perPage,"onUpdate:modelValue":n[6]||(n[6]=e=>o.perPage=e),options:o.pageOptions,label:"name",openDirection:"top",onInput:n[7]||(n[7]=e=>o.currentPage=1)},{singlelabel:c(({value:e})=>[s("div",tt,[s("span",null,"Отображать "+m(e.value)+" строк",1)])]),option:c(({option:e})=>[s("div",ot,"Отображать "+m(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):q("",!0)],64)):(k(),$(A,{key:1,label:"Заказов не найдено"}))])])],64)}const st={components:{Multiselect:re,StatusBadge:J,IconDownload:K,IconFile:Q,BlockBalanceAgreement:W},async setup(){const p=le(),n=ie(),H=ne(),o=se(),v=ae("emitter");v.on("updateInvoicesTable",()=>{n.fetchInvoices()});const z=b("CreateDate"),V=b(!0),x=b("desc"),C=b(""),f=b("*"),S=b(1),T=b(10),M=b([10,25,50,100]),y=h(()=>Object.keys(n==null?void 0:n.invoicesList).map(t=>{var a,i,d;return{...n==null?void 0:n.invoicesList[t],Customer:(i=(a=u.value)==null?void 0:a[n==null?void 0:n.invoicesList[t].ContractID])==null?void 0:i.Customer,Summ:Number((d=n==null?void 0:n.invoicesList[t])==null?void 0:d.Summ)}}).reverse()),O=h(()=>y.value.filter(a=>f.value!=="*"?Number(a.ContractID)===Number(f.value):!0)),U=h(()=>n==null?void 0:n.servicesList),u=h(()=>p.contractsList),j=h(()=>{let t=[];return y.value.map(a=>{if(!t.find(i=>i===a.Customer))return t.push(a.Customer),{value:a.ContractID,name:a.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),E=h(()=>y.value.filter(t=>{var a,i;return(t==null?void 0:t.PaymentSystemName.toLowerCase().includes((a=C.value)==null?void 0:a.toLowerCase()))||String(t==null?void 0:t.Summ).toLowerCase().includes((i=C.value)==null?void 0:i.toLowerCase())}).filter(t=>t.ContractID.includes(f.value!=="*"?f.value:"")).length);function R(){S.value=1}function A(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsStamp=yes`}function P(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsTIFF=yes&IsStamp=yes`}function F(t){var a,i,d;v.emit("open-modal",{component:"AcceptConditionally",data:{ContractID:(a=t==null?void 0:t.item)==null?void 0:a.ContractID,RowsIDs:(i=t==null?void 0:t.item)==null?void 0:i.ID,AllowConditionallyMessage:(d=t==null?void 0:t.item)==null?void 0:d.AllowConditionallyMessage}})}function e(t){v.emit("open-modal",{component:"StatusHistory",data:{modeID:"Invoices",rowID:t}})}function r(t){var a,i,d,g,G;v.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:(a=t==null?void 0:t.item)==null?void 0:a.ID,TypeID:(g=(d=u.value)==null?void 0:d[(i=t==null?void 0:t.item)==null?void 0:i.ContractID])==null?void 0:g.TypeID,Summ:(G=t==null?void 0:t.item)==null?void 0:G.Summ}})}function I(t){var a;n.InvoiceDocument({InvoiceID:(a=t.item)==null?void 0:a.ID}).then(i=>{var d;v.emit("open-modal",{component:"InvoiceDocument",data:{html:i,ID:(d=t.item)==null?void 0:d.ID}})})}function L(){v.emit("open-modal",{component:"NewInvoice"})}function D(){}function X(){}ce(()=>{console.log(o)});function Y(t){var i;let a=new FormData;a.append("ContractID","Default"),a.append("RowsIDs[]",(i=t.item)==null?void 0:i.ID),n.InvoicesReject(a).then(d=>{d==="SUCCESS"&&n.fetchInvoices()})}return window.FormGet=D.bind(this),window.Mobile=X.bind(this),await p.fetchContracts(),await p.fetchProfiles(),await H.fetchConfig(),await n.fetchInvoices().then(()=>{var t,a;(t=o.params)!=null&&t.id&&((a=y.value)!=null&&a.find(d=>{var g;return d.ID===((g=o.params)==null?void 0:g.id)}))&&I({item:{ID:o.params.id}}),o.query.Error==="yes"&&v.emit("open-modal",{component:"InvoiceError"})}),await n.fetchServices(),{search:C,select:f,getContracts:u,getUsers:j,getOrders:y,getServices:U,currentPage:S,perPage:T,sortBy:z,sortDesc:V,sortDirection:x,pageOptions:M,filteredContractsLength:E,worksCompleteFields:Ce,getFilteredOrders:O,invoicePayment:I,invoicesReject:Y,switchPaymentSystem:r,setPageToZero:R,secondToDate:de,formNormalDate:me,getInvoicesTTFLink:P,getInvoicesPDFLink:A,createNewIncoice:L,invoiceSetConditionally:F,openHistoryStatuses:e}}},St=oe(st,[["render",nt],["__scopeId","data-v-f941c7fc"]]);export{St as default};
