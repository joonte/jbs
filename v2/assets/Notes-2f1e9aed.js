import{o as _,c as y,a as u,b,_ as $,x as D,w as W,F as E,v as H,a8 as U,p as V,l as q,r as F,f as G,g as k,e as K,R as z,$ as J,N as Q,a2 as X}from"./index-87a66f57.js";import{_ as Y,u as Z,n as ee}from"./networkController-e791b7f3.js";import{u as te}from"./postings-4f14ba7d.js";import{u as oe}from"./contracts-63b183f3.js";import{I as ne}from"./IconClose-81d0053a.js";import{E as N}from"./EmptyStateBlock-f512ef0a.js";import{B as P}from"./BlockBalanceAgreement-f9b358ae.js";import{_ as se}from"./ClausesKeeper-068355e6.js";import"./bootstrap-vue-next.es-e0094127.js";import"./ButtonDefault-646e2a65.js";import"./IconArrow-8c8c28c1.js";const ce={class:"notes__note-container"},ae=["innerHTML"];function ie(o,r,m,c,d,f){const h=ne;return _(),y("div",ce,[u("div",{class:"notes__content",innerHTML:m.item},null,8,ae),u("div",{class:"notes__close-button",onClick:r[0]||(r[0]=w=>c.closeNote(m.index))},[b(h,{class:"notes__close-button-cross"})])])}const re={props:{item:{type:String,default:""},index:{type:[String,Number],default:""}},emits:["delete"],setup(o,{emit:r}){function m(c){let d=new Date;d.setDate(30+d.getDate()),document.cookie=`${c}=hidden; path=/; expires=${d}`,r("delete",c)}return{closeNote:m}}},B=$(re,[["render",ie],["__scopeId","data-v-8295fda7"]]),le=o=>(V("data-v-21baced2"),o=o(),q(),o),de={class:"section"},me={class:"container"},pe=le(()=>u("div",{class:"section-header"},[u("h1",{class:"section-title"},"Уведомления")],-1)),ue={class:"notes"};function _e(o,r,m,c,d,f){const h=P,w=se,p=B,i=N;return _(),y(E,null,[b(h),u("div",de,[u("div",me,[pe,b(w),u("div",ue,[c.notes&&Object.keys(c.notes).length>0?(_(),D(U,{key:0,class:"notes__transition-container",tag:"div",name:"list"},{default:W(()=>[(_(!0),y(E,null,H(c.notes,(v,I)=>(_(),D(p,{item:v,index:I,key:I,onDelete:c.deleteItem},null,8,["item","index","onDelete"]))),128))]),_:1})):(_(),D(i,{key:1,label:"Все уведомления прочитаны или они еще не пришли"}))])])])],64)}const fe={components:{IconCross:Y,Note:B,EmptyStateBlock:N,BlockBalanceAgreement:P},async setup(){const o=Z(),r=F(null),m=te(),c=oe(),d=G(),f=k(()=>d.userInfo),h=k(()=>{var e,t;return(t=Object.keys((e=f.value)==null?void 0:e.Contacts))==null?void 0:t.map(n=>{var a,s,g,l,x;if(!((g=(s=(a=f.value)==null?void 0:a.Contacts)==null?void 0:s[n])!=null&&g.IsHidden))return(x=(l=f.value)==null?void 0:l.Contacts)==null?void 0:x[n]})}),w=e=>h.value.find(t=>t.ID===e),p=K(),i=z("emitter"),v=k(()=>{let e={};return Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t]}),Object.keys(e).length>0?e:null});function I(){let e={};Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;M(t)&&(e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t])}),r.value=e}function M(e){return document.cookie.match(RegExp(`(?:^|;\\s*)${e}=([^;]*)`))===null}function j(e){delete r.value[e],i.emit("notes-reduce")}const S=async(e,t)=>{try{return(await X.post(e,t)).data}catch(n){throw new Error(`Error sending confirm request: ${n.message}`)}};async function C(e,t){if(console.log("Route: ",e,"Data: ",t),e.includes("OrderPay")){let n=t[Object.keys(t).find(a=>a.includes("OrderID"))];e!=="/ExtraIPOrderPay"&&e!=="/ISPswOrderPay"&&e!=="/DNSmanagerOrderPay"?p.push(`${e}/${n}`):p.push(`ServiceOrderPay/${n}`)}else if(e==="/InvoiceDocument")m.InvoiceDocument({InvoiceID:t.InvoiceID}).then(n=>{i.emit("open-modal",{component:"InvoiceDocument",data:{html:n,ID:t.InvoiceID}})});else if(e==="/API/OrdersTransfer")console.log(t),i.emit("open-modal",{component:"TakeOrder",data:{OrdersTransferID:t}});else if(e==="/ContractMake")p.push("ContractMake");else if(e==="/ISPswOrders")p.push("AdditionalServices");else if(e==="/ContactEdit?MethodID=VKontakte"||e==="/ContactEdit?MethodID=Telegram"||e==="/ContactEdit?MethodID=Viber")p.push("profile/UserProfile");else if(e.includes("/ContactEdit")){const n=e.match(/ContactID=(\d+)/),a=n?n[1]:null;if(console.log("contactId:",a),a){const s=w(a);if(s){const g={Method:s.MethodID,Value:s.Address,ContactID:s.ID};try{const l=await S("/API/Confirm",g);console.log("Response from server:",l),l.Status==="Ok"?i.emit("open-modal",{component:"AcceptContact",data:{contactId:a,sendConfirmRequest:S}}):console.error(`Error confirming code. Status: ${l.Status}, Message: ${l.Message}`)}catch(l){console.error("Error accepting contact:",l.message)}}}else console.error("ContactID is not present in the URL params.",e)}else console.log(e,t),i.emit("open-modal",{component:e.replace("/",""),data:t})}function L(){}function A(e,t,n,a){console.log(e,t,n,a),ee.post(e,t).then(s=>{console.log(s.data),s.data.Status==="Exception"?i.emit("open-modal",{component:"ExclusionWindow",data:s.data}):o.fetchNotes().then(()=>{I()})}).catch(s=>{console.error("Ошибка при выполнении запроса:",s)})}function R(e,t){i.emit("open-modal",{component:"DeleteItem",data:{id:null,callback:t,message:e,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function T(){}function O(){window.ShowWindow=C.bind(this)}return J(()=>{O()}),Q(()=>{window.ShowWindow=null}),i.on("close-modal",()=>{O()}),window.ShowProgress=T.bind(this),window.ShowWindow=C.bind(this),window.PromptShow=L.bind(this),window.AjaxCall=A.bind(this),window.ShowConfirm=R.bind(this),await o.fetchNotes().then(()=>{I()}),await c.fetchContracts(),await d.fetchUserData(),{getNotesList:v,notes:r,ShowWindow:C,deleteItem:j}}},Oe=$(fe,[["render",_e],["__scopeId","data-v-21baced2"]]);export{Oe as default};
