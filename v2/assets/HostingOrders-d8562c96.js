import{j as w,o as r,c as P,a,b as k,w as O,d as T,x as D,am as E,t as M,F as j,v as A,_ as F,f as K,r as B,R as q,g as i}from"./index-1c309346.js";import{I as R}from"./IconSearch-373e7b4f.js";import{H as U}from"./HostingItem-2e963346.js";import{_ as N}from"./ClausesKeeper-b9906182.js";import{s as S}from"./multiselect-b7ad6876.js";import{u as z}from"./hosting-fd5f9472.js";import{u as G}from"./contracts-7b919c67.js";import{u as J}from"./testTransforms-eec373ee.js";import{E as Q}from"./EmptyStateBlock-5a6a4cd4.js";import{_ as W}from"./FormInputSearch-de4e3004.js";import"./IconDots-391abd93.js";import"./IconCard-ee273855.js";import"./StatusBadge-a49537d5.js";import"./hostStatuses-94d00f20.js";import"./HelperComponent-3eb94393.js";import"./ButtonDefault-cd183bf8.js";import"./IconArrow-6927efe5.js";import"./bootstrap-vue-next.es-b799f76d.js";import"./OrderIDBadge-afd00b65.js";import"./IconClose-7cf50ca7.js";import"./IconPlus-ea6f8c21.js";const X={class:"section"},Y={class:"container"},Z={class:"section-header"},$=a("h1",{class:"section-title"},"Хостинг",-1),tt={class:"list-form"},et={class:"list-form_col list-form_col--sm"},ot={class:"list-form_select"},st={class:"multiselect-option"},nt={key:0};function rt(n,l,u,o,_,g){var h,v,H;const m=w("router-link"),y=N,x=w("Multiselect"),c=W,p=U,d=Q;return r(),P("div",X,[a("div",Y,[a("div",Z,[$,k(m,{class:"btn btn--blue btn-default",to:"/HostingSchemes"},{default:O(()=>[T("Заказать")]),_:1})]),(r(),D(E,null,[k(y)],1024)),a("div",tt,[a("div",et,[a("div",ot,[k(x,{modelValue:o.select,"onUpdate:modelValue":l[0]||(l[0]=s=>o.select=s),options:o.getUsers,disabled:((h=o.getUsers)==null?void 0:h.length)<=1,label:"name"},{option:O(({option:s})=>[a("div",st,M(s.name),1)]),_:1},8,["modelValue","options","disabled"])])]),k(c,{modelValue:o.search,"onUpdate:modelValue":l[1]||(l[1]=s=>o.search=s)},null,8,["modelValue"])]),o.getHostingList&&((v=o.getHostingList)==null?void 0:v.length)>0?(r(),P("div",nt,[o.filterProducts&&((H=o.filterProducts)==null?void 0:H.length)>0?(r(!0),P(j,{key:0},A(o.filterProducts,(s,L)=>{var I,C;return r(),D(p,{"item-data":s,"user-name":`${(I=o.getUser)==null?void 0:I.Name} - ${(C=o.getContracts[s==null?void 0:s.ContractID])==null?void 0:C.Customer}`,params:o.getHostingItemParam(s),"info-link":`/HostingOrders/${s==null?void 0:s.OrderID}`,"is-last":L===o.filterProducts.length-1,onDelete:o.deleteItem,onTransfer:o.transferItem},null,8,["item-data","user-name","params","info-link","is-last","onDelete","onTransfer"])}),256)):(r(),D(d,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(r(),D(d,{key:1,class:"no-margin",label:"У Вас нет заказов на хостинг"}))])])}const at={components:{IconSearch:R,Multiselect:S,ClausesKeeper:N,HostingItem:U},async setup(){const n=z(),l=K(),u=G(),{formDescriptionLine:o}=J(),_=B("*"),g=B(null),m=q("emitter");m.on("updateHostingList",()=>{n.fetchHostingOrders()});function y(e){m.emit("open-modal",{component:"DeleteItem",data:{id:e,message:"Вы действительно хотите удалить хостинг?",tableID:"HostingOrders",successEmit:"updateHostingList"}})}function x(e){m.emit("open-modal",{component:"OrdersTransfer",data:e})}const c=i(()=>{var e;return(e=Object.keys(n==null?void 0:n.hostingList).map(t=>n==null?void 0:n.hostingList[t]))==null?void 0:e.reverse()}),p=i(()=>n==null?void 0:n.hostingSchemes),d=i(()=>u==null?void 0:u.contractsList),h=i(()=>{let e=[{value:"*",name:"Все договора"}];return c.value!==null?(c.value.forEach(t=>{var f;e.find(b=>b.value===t.ContractID)||e.push({value:t.ContractID,name:(f=d.value[t==null?void 0:t.ContractID])==null?void 0:f.Customer})}),e):{value:"*",name:"Все договора"}}),v=i(()=>l.userInfo),H=i(()=>L(s(c.value)));function s(e){return _.value!=="*"?e.filter(t=>(t==null?void 0:t.ContractID)===_.value):e}function L(e){return g.value!==null?e.filter(t=>t==null?void 0:t.Domain.toLowerCase().includes(g.value.toLowerCase())):e}function I(e){var f,b,V;const t=C(e==null?void 0:e.SchemeID);return[{text:t==null?void 0:t.Name},{text:o((f=t==null?void 0:t.SchemeParams)==null?void 0:f.limit_webdomains)},{text:o((b=t==null?void 0:t.SchemeParams)==null?void 0:b.limit_quota)},{text:o((V=t==null?void 0:t.SchemeParams)==null?void 0:V.limit_emails)},{text:`${t==null?void 0:t.CostMonth} ₽ в месяц`,bold:!0}]}function C(e){var t;return(t=p.value)==null?void 0:t[e]}return await n.fetchHostingOrders(),await n.fetchHostingSchemes(),await u.fetchContracts(),{getHostingList:c,getHostingSchemes:p,filterProducts:H,getUsers:h,getUser:v,select:_,search:g,getContracts:d,deleteItem:y,transferItem:x,getHostingItemParam:I}}},Pt=F(at,[["render",rt]]);export{Pt as default};
