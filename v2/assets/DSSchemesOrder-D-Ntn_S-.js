import{_ as X}from"./EmptyStateBlock-DgFyy_gi.js";import{_ as z}from"./ButtonDefault-CgQ13ecW.js";import{_ as Q}from"./BlockOrderServiceWrapper-qOj7vMBg.js";import{_ as Y}from"./BlockAdditionalServices-DvmMNgnn.js";import{_ as Z}from"./BlockOrderPayBalance-BulK2jU0.js";import{_ as ee}from"./BlockSelectContract-B_ApKdUZ.js";import{_ as te}from"./ClausesKeeper-Cjjq7JUL.js";import{_ as oe}from"./BlockBalanceAgreement-BNU6bIWW.js";import{M as se,r as y,f as b,h as le,v as ae,g as re,E as O,c as n,b as _,a as e,F as h,t as a,w as G,I as F,J as V,i as ne,j as A,d as ce,o as c}from"./index-DakgQwZZ.js";import{u as ie}from"./contracts-C-xJvA56.js";import{u as ue}from"./services-De9u6bRn.js";import{g as de}from"./common-B12QeiN6.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-CDL_Y1-V.js";import"./ServiceListOrderSelection-BTjwinjd.js";import"./BasicInput-B071mWFB.js";import"./component-BXhtJwv0.js";import"./multiselect-BdMqqcHq.js";import"./globalActions-BG7EYttN.js";import"./IconHelp-DQ9vdhmP.js";import"./IconClose-Camrw-uN.js";const ve={class:"dedicated-server-order"},me={class:"section"},pe={class:"container"},Se={class:"section-header"},fe={class:"section-title"},De={class:"tw-p-3 md:tw-p-6 tw-border tw-border-gray-200 tw-rounded tw-mt-8"},be={class:"tw-flex tw-flex-wrap tw-gap-6 tw-mt-2"},he={class:"tw-text-gray-500 tw-text-xs"},ke={class:"tw-text-gray-800 tw-text-sm"},ye={class:"section"},we={class:"container"},Ie={class:"total-block"},ge={class:"total-block__row divider-bottom"},Ce={class:"total-block__col"},Be={class:"total-block__col"},Oe={class:"total-block__col"},Ee={class:"total-block__row"},xe={class:"total-block__col"},Pe={class:"total-block__col"},Ne={class:"total-block__col"},Re={class:"total-block__row total-block__row--big economy-line"},Fe={class:"total-block__col flex-col"},Ve={class:"red"},Ae={class:"total-block__row total-block__row--big"},Le={class:"total-block__col"},Ue={class:"total-block__col"},Te={key:1,class:"section"},$e={class:"container"},Ke={__name:"DSSchemesOrder",async setup(Me){let u,d;const L=ie(),p=se(),w=ue(),U=re(),I=ce(),l=y(null),v=y([]),g=y(!1),i=y(null),E=y(!1),T=o=>{o.key==="Enter"&&o.ctrlKey&&!q.value&&M()},q=b(()=>l.value===null||i.value===null);le(()=>{document.addEventListener("keyup",T)}),ae(()=>{document.removeEventListener("keyup",T)});const H=b(()=>{const o=p.DSSchemes?.[U.params.id];return o?de(o):[]}),x=b(()=>L.contractsList),S=b(()=>p.DSSchemes?.[U.params.id]),$=b(()=>w?.ServicesList),P=b(()=>{let o=0;return v.value.forEach(t=>{o+=t?.Price}),K(o)||0});function J(o){l.value=o}function N(){let o=0;return l.value?.discounts?.Bonuses.map(t=>{o+=+t.Economy}),o}function f(o){const t=Number(S.value?.CostInstall)||0,m=Number(o)||0,r=(t+m).toFixed(2);return Number(r)}function K(o){return Number(o).toFixed(2)||0}async function W(o){if(!(!v.value||v.value.length===0))for(const t of v.value){let m="SUCCESS",r=$.value[t.ServiceID]?.Code;const D={Code:r,DependOrderID:o,...t,ContractID:i.value};if(await w.ServiceOrder(D).then(({result:C,info:B,error:j})=>{if(C==="SUCCESS"){let k={};r==="Default"?k.ServiceOrderID=B?.ServiceOrderID:k[`${r}OrderID`]=B?.ServiceOrderID,w.ServiceOrderPay(r,k,{XMLHttpRequest:"yes"}).then(R=>{let{result:s,error:je}=R;s==="SUCCESS"?I.push("/AdditionalServices"):s==="BASKET"&&I.push("/Basket")})}else m="ERROR"}),m==="ERROR")break}}function M(){g.value=!0,p.DSOrder({ContractID:i.value,DSSchemeID:S.value.ID}).then(({result:o,info:t,error:m})=>{o==="SUCCESS"?(W(t?.OrderID),p.DSOrderPay({DSOrderID:t?.DSOrderID,DaysPayFromBallance:l.value?.daysFromBalance||0,DaysPay:l.value?.actualDays,IsChange:!0}).then(r=>{let{result:D,error:C}=r;D==="SUCCESS"?I.push("/DSOrders"):D==="BASKET"&&I.push("/Basket"),g.value=!1})):g.value=!1})}return[u,d]=O(()=>p.fetchDSOrders()),await u,d(),[u,d]=O(()=>p.fetchDSSchemes()),await u,d(),[u,d]=O(()=>L.fetchContracts().then(()=>{x.value&&(i.value=Object.keys(x?.value)?.[0])})),await u,d(),[u,d]=O(()=>w.fetchServices()),await u,d(),(o,t)=>{const m=oe,r=te,D=ee,C=Z,B=Y,j=Q,k=z,R=X;return c(),n(h,null,[_(m),e("div",ve,[S.value?.ID?(c(),n(h,{key:0},[e("div",me,[e("div",pe,[e("div",Se,[e("h1",fe,a(S.value?.Name),1),t[4]||(t[4]=e("div",{class:"section-label"},"Выделенный сервер",-1))]),_(r)])]),_(j,{basic_title:"Выделенный сервер"},{page:G(()=>[e("div",De,[t[5]||(t[5]=e("div",{class:"tw-text-2xl"},"Конфигурация",-1)),e("div",be,[(c(!0),n(h,null,A(H.value,s=>(c(),n("div",{class:"tw-space-y-1",key:s.label},[e("div",he,a(s.label),1),e("div",ke,a(s.text),1)]))),128))])]),t[6]||(t[6]=e("div",{class:"section"},[e("div",{class:"section-subtitle"},"Что входит в стоимость"),e("div",{class:"text"},[e("p",null,"Для подключения дополнительных услуг"),e("ul",null,[e("li",null,"Размещение в РФ, Москва"),e("li",null,"IP адрес, с возможностью расширения"),e("li",null,"Бесплатная панель управления ISPManager Lite"),e("li",null,"Круглосуточная поддержка")])])],-1)),_(D,{title:"Оформление услуги",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=s=>i.value=s)},null,8,["modelValue"]),_(C,{contractID:i.value,scheme:S.value,serviceID:"40000",isOrderID:!1,onSelect:J,isBalancePay:E.value,"onUpdate:isBalancePay":t[1]||(t[1]=s=>E.value=s)},null,8,["contractID","scheme","isBalancePay"])]),services:G(()=>[_(B,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),serviceSearchParams:{ServiceID:"40000",ServersGroupID:S.value?.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]),_:1}),e("div",ye,[e("div",we,[F(e("div",Ie,[l.value?.discounts?.Bonuses?.length>0?(c(),n(h,{key:0},[e("div",ge,[t[7]||(t[7]=e("div",{class:"total-block__col"},"Цена тарифа",-1)),e("div",Ce,a(f(l.value?.price))+" ₽",1)]),(c(!0),n(h,null,A(l.value?.discounts?.Bonuses,s=>(c(),n("div",{class:"total-block__row no-divider",key:s.Days},[e("div",Be,"Скидка "+a(s?.Discount)+"% на "+a(s?.Days)+" дней",1),e("div",Oe,"-"+a(f(s?.Economy))+" ₽",1)]))),128))],64)):ne("",!0),e("div",Ee,[t[8]||(t[8]=e("div",{class:"total-block__col"},"Дополнительные услуги",-1)),e("div",xe,a(P.value)+" ₽",1)]),(c(!0),n(h,null,A(v.value,s=>(c(),n("div",{class:"total-block__row no-divider",key:s.ServiceID},[e("div",Pe,a($.value[s?.ServiceID]?.Name),1),e("div",Ne,a(K(s?.Price))+" ₽",1)]))),128)),F(e("div",Re,[t[9]||(t[9]=e("div",{class:"total-block__col red"},"Выгода",-1)),e("div",Fe,[e("span",null,[e("s",null,a(f(l.value?.price))+" ₽",1)]),e("span",Ve,"-"+a(f(N()))+" ₽",1)])],512),[[V,l.value?.discounts?.Bonuses?.length>0]]),F(e("div",Ae,[e("div",Le,"Итого за "+a(l.value?.label),1),e("div",Ue,a(f(l.value?.price-N()+ +P.value))+" ₽ ",1)],512),[[V,l.value?.price]])],512),[[V,l.value?.price]]),_(k,{class:"btn--wide",label:E.value||x.value[i.value]?.Balance>f(l.value?.price-N()+ +P.value)?"Оплатить c баланса договора":"Добавить в корзину",disabled:l.value===null||i.value===null,"is-loading":g.value,onClick:t[3]||(t[3]=s=>M())},null,8,["label","disabled","is-loading"])])])],64)):(c(),n("div",Te,[e("div",$e,[_(R,{label:"Сервер не найден"})])]))])],64)}}},dt=_e(Ke,[["__scopeId","data-v-71df4dc4"]]);export{dt as default};
