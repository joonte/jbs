import{j as U,o as y,c as L,b as p,a as o,w as l,t as r,F as w,n as A,k as E,x as M,p as O,l as S,_ as T,r as d,g}from"./index-33bd9cf4.js";import{u as j}from"./postings-9b1c8c68.js";import{u as Z}from"./contracts-141debab.js";import{s as z}from"./multiselect-acf9ef65.js";import{a as q,f as G}from"./useTimeFunction-8602dd60.js";import{B as F}from"./BlockBalanceAgreement-5028e9bc.js";import{E as H}from"./EmptyStateBlock-98549fc8.js";import{C as J,F as K}from"./bootstrap-vue-next.es-6bb0e5cd.js";import{_ as Q}from"./FormInputSearch-aa64849b.js";import{_ as R}from"./ClausesKeeper-69d31679.js";import"./ButtonDefault-34d9e627.js";import"./IconArrow-dadffb08.js";import"./IconPlus-5f47af9a.js";import"./IconSearch-55746ee2.js";import"./IconClose-d9fbf580.js";const W=[{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"ServiceID",label:"Операция"},{key:"Comment",label:"Примечание"},{key:"Before",variant:"td-gray td-order",label:"До"},{key:"After",variant:"td-gray td-order",label:"После"},{key:"Change",variant:"td-gray td-order",label:"Сумма",sortable:!0}],i=m=>(O("data-v-bb114654"),m=m(),S(),m),X={class:"section"},Y={class:"container"},$=i(()=>o("div",{class:"section-header"},[o("h1",{class:"section-title"},"История операций")],-1)),ee={class:"list-form"},te={class:"list-form_col list-form_col--sm"},se={class:"list-form_select"},oe={class:"multiselect-option"},ae=i(()=>o("span",{class:"td-mobile"},"Дата Создания",-1)),ne={class:"d-block"},le=i(()=>o("span",{class:"td-mobile"},"Договор",-1)),re=i(()=>o("span",{class:"td-mobile"},"До",-1)),ce={class:"d-block"},ie=i(()=>o("span",{class:"td-mobile"},"После",-1)),de={class:"d-block"},me=i(()=>o("span",{class:"td-mobile"},"Операция",-1)),_e=i(()=>o("span",{class:"td-mobile"},"Сумма",-1)),pe={key:0,class:"table-controls"},ue=i(()=>o("span",{class:"text-success"},"First",-1)),ge=i(()=>o("span",{class:"text-info"},"Last",-1)),ve={class:"multiselect-multiple-label"},be={class:"multiselect-option"};function fe(m,s,v,t,D,V){var C,h;const k=F,P=R,b=U("Multiselect"),B=Q,u=J,I=K,f=H;return y(),L(w,null,[p(k),o("div",X,[o("div",Y,[$,p(P),o("div",ee,[o("div",te,[o("div",se,[p(b,{modelValue:t.select,"onUpdate:modelValue":s[0]||(s[0]=e=>t.select=e),options:t.getUsers,disabled:((C=t.getUsers)==null?void 0:C.length)<=1,label:"name"},{option:l(({option:e})=>[o("div",oe,r(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),p(B,{modelValue:t.search,"onUpdate:modelValue":s[1]||(s[1]=e=>t.search=e)},null,8,["modelValue"])]),t.getPostings&&((h=t.getPostings)==null?void 0:h.length)>0?(y(),L(w,{key:0},[p(u,{class:"basic-table",items:t.getPostings.filter(e=>e.ContractID.includes(t.select!=="*"?t.select:"")),fields:t.postingsFields,"show-empty":!0,filter:t.search,"per-page":t.perPage,"current-page":t.currentPage,filterable:["Customer","Comment"],"sort-by":t.sortBy,"onUpdate:sortBy":s[2]||(s[2]=e=>t.sortBy=e),"sort-desc":t.sortDesc,"onUpdate:sortDesc":s[3]||(s[3]=e=>t.sortDesc=e),"sort-direction":t.sortDirection,"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Операций пока нет.","empty-filtered-text":"Операции не найдены.",onFiltered:t.setPageToZero},{"cell(CreateDate)":l(e=>{var c;return[ae,o("span",ne,r(t.formNormalDate(t.secondToDate((c=e.item)==null?void 0:c.CreateDate))),1)]}),"cell(ContractID)":l(e=>{var c,a;return[le,o("span",null,r((c=e.item)==null?void 0:c.ContractID)+" - "+r((a=e.item)==null?void 0:a.Customer),1)]}),"cell(Before)":l(e=>[re,o("span",ce,r(e.value),1)]),"cell(After)":l(e=>[ie,o("span",de,r(e.value),1)]),"cell(ServiceID)":l(e=>{var c,a,n;return[me,o("span",null,r((n=(a=t.getServices)==null?void 0:a[(c=e.item)==null?void 0:c.ServiceID])==null?void 0:n.Name),1)]}),"cell(Change)":l(e=>[_e,o("span",{class:A(["d-block",{positive:e.value>0,negative:e.value<0}])},r(e.value>0?`+${e.value}`:e.value)+" ₽",3)]),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),t.filteredContractsLength>0?(y(),L("div",pe,[p(I,{modelValue:t.currentPage,"onUpdate:modelValue":s[4]||(s[4]=e=>t.currentPage=e),"total-rows":t.filteredContractsLength,"per-page":t.perPage,"first-number":"","last-number":""},{"first-text":l(()=>[ue]),"last-text":l(()=>[ge]),page:l(({page:e,active:c})=>[o("span",null,r((e-1)*t.perPage+1)+"-"+r(e*t.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),p(b,{class:"multiselect--white",modelValue:t.perPage,"onUpdate:modelValue":s[5]||(s[5]=e=>t.perPage=e),options:t.pageOptions,label:"name",openDirection:"top",onInput:s[6]||(s[6]=e=>t.currentPage=1)},{singlelabel:l(({value:e})=>[o("div",ve,[o("span",null,"Отображать "+r(e.value)+" строк",1)])]),option:l(({option:e})=>[o("div",be,"Отображать "+r(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):E("",!0)],64)):(y(),M(f,{key:1,label:"Ваша история операций пуста"}))])])],64)}const Ce={components:{Multiselect:z,BlockBalanceAgreement:F},async setup(){const m=Z(),s=j(),v=d(""),t=d("*"),D=d(1),V=d(10),k=d([10,25,50,100]),P=d("CreateDate"),b=d(!0),B=d("desc"),u=g(()=>Object.keys(s==null?void 0:s.postingsList).map(a=>{var n,_,x,N;return{...s==null?void 0:s.postingsList[a],Customer:(_=(n=f.value)==null?void 0:n[s==null?void 0:s.postingsList[a].ContractID])==null?void 0:_.Customer,Change:e((x=s==null?void 0:s.postingsList[a])==null?void 0:x.Before,(N=s==null?void 0:s.postingsList[a])==null?void 0:N.After)}})),I=g(()=>s==null?void 0:s.servicesList),f=g(()=>m.contractsList),C=g(()=>{let a=[];return u.value.map(n=>{if(!a.find(_=>_===n.Customer))return a.push(n.Customer),{value:n.ContractID,name:n.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),h=g(()=>u.value.filter(a=>{var n,_;return a.Comment.toLowerCase().includes((n=v.value)==null?void 0:n.toLowerCase())||a.Customer.toLowerCase().includes((_=v.value)==null?void 0:_.toLowerCase())}).filter(a=>a.ContractID.includes(t.value!=="*"?t.value:"")).length);function e(a,n){return n-a>0,Number(Math.round((n-a+Number.EPSILON)*100)/100)}function c(){D.value=1}return await m.fetchContracts(),await s.fetchPostings(),await s.fetchServices(),{search:v,select:t,getContracts:f,getUsers:C,getPostings:u,getServices:I,currentPage:D,perPage:V,sortBy:P,sortDesc:b,sortDirection:B,pageOptions:k,filteredContractsLength:h,postingsFields:W,setPageToZero:c,secondToDate:q,formNormalDate:G,calculateChange:e}}},Ee=T(Ce,[["render",fe],["__scopeId","data-v-bb114654"]]);export{Ee as default};
