import{a1 as P,r as L,a2 as B,a3 as F,_ as N,o as u,c as k,a as e,b as g,F as x,v as V,t as d,w as p,k as O,p as T,l as $,R as A,g as S}from"./index-ed1f28f8.js";import{u as E}from"./contracts-cedf6a91.js";import{u as G}from"./postings-71aa09ae.js";import"./invoices-81f5ce66.js";import{S as R}from"./ServerItem-f8611a19.js";import{C as q}from"./bootstrap-vue-next.es-79226723.js";import{_ as z}from"./ClausesKeeper-9aa8ead7.js";import"./IconDots-296f1d69.js";import"./IconCard-ec16e358.js";import"./StatusBadge-2304b071.js";import"./IconClose-a1e58263.js";const H=P("basket",()=>{const s=L(null);async function r(){let n="error";return await B.post(""+F.fetchBasket).then(o=>{s.value=o==null?void 0:o.data}).catch(()=>{n="error"}),n}async function _(n){let o="error";return await B.post(""+F.deleteFromBasket,{...n}).then(f=>{o="success"}).catch(()=>{o="error"}),o}return{basketList:s,fetchBasket:r,deleteFromBasket:_}}),J={},K={fill:"none",height:"32",viewBox:"0 0 32 32",width:"32",xmlns:"http://www.w3.org/2000/svg"},Q=e("rect",{fill:"#F7F9FF",height:"31",rx:"3.5",width:"31",x:".5",y:".5"},null,-1),U=e("path",{d:"M8.5 11h15m-1.665 0v11.667a1.667 1.667 0 0 1-1.667 1.666h-8.333a1.667 1.667 0 0 1-1.667-1.666V11m2.5 0V9.333a1.667 1.667 0 0 1 1.667-1.666h3.333a1.667 1.667 0 0 1 1.667 1.666V11m-5.003 4.167v5m3.336-5v5",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),W=e("rect",{height:"31",rx:"3.5",stroke:"#C7D1ED",width:"31",x:".5",y:".5"},null,-1),X=[Q,U,W];function Y(s,r){return u(),k("svg",K,X)}const M=N(J,[["render",Y]]),Z=[{key:"ServiceID",label:"Услуга",variant:"td-service"},{key:"OrderID",label:"Номер заказа",variant:"td-service"},{key:"Amount",label:"Период"},{key:"Summ",label:"Сумма"},{key:"controls",label:"Действия",variant:"td-controls"}],v=s=>(T("data-v-c603b37c"),s=s(),$(),s),j={class:"section"},tt={class:"container"},et=v(()=>e("div",{class:"section-header"},[e("h1",{class:"section-title"},"Корзина")],-1)),st={key:0,class:"cart-list"},nt={key:0,class:"cart-item"},ot=v(()=>e("div",{class:"cart-item__title"},"Заказ",-1)),at={class:"cart-item__subtitle"},ct={class:"cart-item__subtitle-name"},it=v(()=>e("span",{class:"td-mobile"},"Услуга",-1)),lt={class:"d-block"},rt={class:"d-block table-td-blue"},dt=v(()=>e("span",{class:"td-mobile"},"Номер заказа",-1)),_t=v(()=>e("span",{class:"td-mobile"},"Период",-1)),mt=v(()=>e("span",{class:"td-mobile"},"Сумма",-1)),ht=["onClick"],ut={class:"total-block"},kt={class:"total-block__row"},vt=v(()=>e("div",{class:"total-block__col"},"Итого",-1)),pt={class:"total-block__col"},ft=["onClick"],It={key:1,class:"notification-field"};function bt(s,r,_,n,o,f){const I=z,y=M,w=q;return u(),k("div",j,[e("div",tt,[et,g(I),n.basketContent&&Object.keys(n.basketContent).length>0?(u(),k("div",st,[(u(!0),k(x,null,V(n.basketContent,(m,b)=>{var D,C;return u(),k(x,null,[m&&m.length>0?(u(),k("div",nt,[ot,e("div",at,[e("div",ct,d((C=(D=n.getContracts)==null?void 0:D[b])==null?void 0:C.Customer),1)]),g(w,{class:"basic-table table-cart",items:m,fields:n.basketTableFields},{"cell(ServiceID)":p(a=>{var t,c,l,i;return[it,e("span",lt,d((l=(c=n.getServices)==null?void 0:c[(t=a.item)==null?void 0:t.ServiceID])==null?void 0:l.Name),1),e("span",rt,d((i=a.item)==null?void 0:i.Comment),1)]}),"cell(OrderID)":p(a=>{var t;return[dt,e("span",null,"№ "+d((t=a.item)==null?void 0:t.OrderID),1)]}),"cell(Amount)":p(a=>{var t,c;return[_t,e("span",null,d((t=a.item)==null?void 0:t.Amount)+" "+d((c=a.item)==null?void 0:c.Measure),1)]}),"cell(Summ)":p(a=>{var t;return[mt,e("span",null,d((t=a.item)==null?void 0:t.Summ)+" ₽",1)]}),"cell(controls)":p(a=>[e("button",{class:"btn-delete btn",onClick:t=>n.deleteFromBasket(a.item)},[g(y)],8,ht)]),_:2},1032,["items","fields"]),e("div",ut,[e("div",kt,[vt,e("div",pt,d(n.totalPrice(m))+" ₽",1)]),e("button",{class:"btn btn--blue btn-default btn--wide",onClick:a=>n.choosePaymentSystem(m,b)},"Оплатить заказ",8,ft)])])):O("",!0)],64)}),256))])):(u(),k("div",It,"Корзина заказов пуста"))])])}const Dt={components:{IconDelete:M,ServerItem:R},async setup(){const s=H(),r=E(),_=G(),n=A("emitter"),o=L(null),f=S(()=>s==null?void 0:s.basketList),I=S(()=>r==null?void 0:r.contractsList),y=S(()=>_==null?void 0:_.servicesList);n.on("form-cart-invoice",t=>{a(t)}),await s.fetchBasket().then(()=>{o.value=f.value}),await r.fetchContracts(),await _.fetchServices();function w(t){var l;let c=0;for(let i=0;i<t.length;i++)c=c+Number((l=t[i])==null?void 0:l.Summ);return Math.round((c+Number.EPSILON)*100)/100}function m(t){s==null||s.deleteFromBasket({RowsIDs:[t==null?void 0:t.ID],TableID:"Basket"}).then(c=>{var l,i;c==="success"&&(((l=s.basketList)==null?void 0:l[t==null?void 0:t.ContractID].filter(h=>(h==null?void 0:h.ID)!==t.ID).length)>0?o.value[t==null?void 0:t.ContractID]=(i=s.basketList)==null?void 0:i[t==null?void 0:t.ContractID].filter(h=>(h==null?void 0:h.ID)!==t.ID):delete o.value[t==null?void 0:t.ContractID])})}function b(){}function D(){}function C(t,c){var l,i;n.emit("open-modal",{component:"InvoiceMake",data:{ItemID:c,TypeID:(i=(l=I.value)==null?void 0:l[c])==null?void 0:i.TypeID,...t}})}function a(t){delete o.value[t]}return window.FormGet=b.bind(this),window.Mobile=D.bind(this),{getBasket:f,getContracts:I,getServices:y,basketContent:o,totalPrice:w,deleteFromBasket:m,choosePaymentSystem:C,basketTableFields:Z}}},Pt=N(Dt,[["render",bt],["__scopeId","data-v-c603b37c"]]);export{Pt as default};
