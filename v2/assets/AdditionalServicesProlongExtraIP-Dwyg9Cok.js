import{_ as R}from"./EmptyStateBlock-DgFyy_gi.js";import{_ as $}from"./BlockOrderPayBalance-BulK2jU0.js";import{_ as j}from"./ClausesKeeper-Cjjq7JUL.js";import{_ as M}from"./ButtonDefault-CgQ13ecW.js";import{_ as U}from"./BlockBalanceAgreement-BNU6bIWW.js";import{r as E,f as S,g as V,h as T,E as g,c as v,b as p,a as t,D as C,F as f,t as c,i as q,I as O,j as z,J as F,d as J,o as r}from"./index-DakgQwZZ.js";import{u as G}from"./contracts-C-xJvA56.js";import{u as H}from"./services-De9u6bRn.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-CDL_Y1-V.js";import"./component-BXhtJwv0.js";import"./globalActions-BG7EYttN.js";import"./IconHelp-DQ9vdhmP.js";import"./IconClose-Camrw-uN.js";const Q={class:"tw-px-4 md:tw-px-8"},W={class:"section-header"},X={class:"section-header__wrapper"},Y={class:"section-label"},Z={key:0,class:"section"},ee={class:"total-block"},te={class:"total-block__row divider-bottom"},oe={class:"total-block__col"},se={class:"total-block__col"},ae={class:"total-block__col"},le={class:"total-block__row total-block__row--big economy-line"},ce={class:"total-block__col flex-col"},ne={class:"red"},re={class:"total-block__row total-block__row--big"},ie={class:"total-block__col"},de={class:"total-block__col"},ue={__name:"AdditionalServicesProlongExtraIP",async setup(_e){let d,u;const P=G(),l=H(),N=V(),x=J(),o=E(null),m=E(!1),a=S(()=>Object.keys(l?.ExtraIPOrdersList).map(s=>l?.ExtraIPOrdersList[s]).find(s=>s.OrderID===N.params.id)),k=S(()=>l?.additionalServicesScheme?.ExtraIP?Object.keys(l.additionalServicesScheme.ExtraIP).map(s=>{const e=l.additionalServicesScheme.ExtraIP[s];return{...e,value:e?.ID,name:e?.Name,cost:e?.CostDay,month:e?.CostMonth}}).filter(s=>s?.ID==a.value?.SchemeID):[]),y=S(()=>P.contractsList);function A(){console.log(o.value)}function B(){m.value=!0;const s=parseFloat(y.value[a.value.ContractID]?.Balance)>=parseFloat(i(o.value?.price-b())??0),e=k.value[0]?.cost==="0.00"&&k.value[0]?.month==="0.00",h=s||e,I=!h,D={ExtraIPOrderID:a.value.ID,DaysPay:o.value?.actualDays,IsNoBasket:h,IsUseBasket:I,PayMessage:""};l.ExtraIPOrderPay(D).then(_=>{_==="UseBasket"?x.push("/Basket"):_==="NoBasket"?x.push("/AdditionalServices"):console.error("Ошибка оплаты заказа"),m.value=!1}).catch(_=>{console.error("ExtraIPOrderPay error:",_),m.value=!1})}function i(s){return Number(s).toFixed(2)||0}function b(){let s=0;return o.value?.discounts?.Bonuses.map(e=>{s+=+e.Economy}),s}function L(s){o.value=s}return T(()=>{l.fetchAdditionalServiceScheme("ExtraIP")}),[d,u]=g(()=>l.fetchExtraIPOrders()),await d,u(),[d,u]=g(()=>l.fetchAdditionalServiceScheme("ExtraIP")),await d,u(),[d,u]=g(()=>P.fetchContracts()),await d,u(),(s,e)=>{const h=U,I=M,D=j,_=$,w=R;return r(),v(f,null,[p(h),t("div",Q,[a.value?(r(),v(f,{key:0},[t("div",W,[t("div",X,[t("h1",{class:"section-title",onClick:e[0]||(e[0]=n=>A())},"Оплата заказа IP адреса"),p(I,{class:"btn--wide",label:parseFloat(y.value[a.value.ContractID]?.Balance)>=parseFloat(o.value?.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||o.value?.price===null,"is-loading":m.value,onClick:e[1]||(e[1]=n=>B())},null,8,["label","disabled","is-loading"])]),t("div",Y,c(k.value[0]?.Name),1)]),p(D),p(_,{contractID:a.value?.ContractID,daysRemainded:a.value?.DaysRemainded,serviceID:"50000",scheme:k.value[0],orderID:a.value?.OrderID,isOrderID:!0,onSelect:L},null,8,["contractID","daysRemainded","scheme","orderID"]),a.value?(r(),v("section",Z,[t("div",ee,[o.value?.discounts?.Bonuses?.length>0?(r(),v(f,{key:0},[t("div",te,[e[3]||(e[3]=t("div",{class:"total-block__col"},"Цена тарифа",-1)),t("div",oe,c(i(o.value?.price))+" ₽",1)]),(r(!0),v(f,null,z(o.value?.discounts?.Bonuses,n=>(r(),v("div",{class:"total-block__row no-divider",key:n?.Discount+"-"+n?.Days},[t("div",se,"Скидка "+c(n?.Discount)+"% на "+c(n?.Days)+" дней",1),t("div",ae,"-"+c(i(n?.Economy))+" ₽",1)]))),128)),O(t("div",le,[e[4]||(e[4]=t("div",{class:"total-block__col red"},"Выгода",-1)),t("div",ce,[t("span",null,[t("s",null,c(i(o.value?.price))+" ₽",1)]),t("span",ne,"-"+c(i(b()))+" ₽",1)])],512),[[F,o.value?.discounts?.Bonuses?.length>0]])],64)):q("",!0),O(t("div",re,[t("div",ie,"Итого за "+c(o.value?.label),1),t("div",de,c(i(o.value?.price-b()))+" ₽",1)],512),[[F,o.value?.price]]),p(I,{class:"btn--wide",label:parseFloat(y.value[a.value.ContractID]?.Balance)>=(i(o.value?.price-b())??0)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||o.value?.price===null,"is-loading":m.value,onClick:e[2]||(e[2]=n=>B())},null,8,["label","disabled","is-loading"])])])):(r(),C(w,{key:1,class:"no-margin",label:"Заказ нельзя продлить"}))],64)):(r(),C(w,{key:1,label:"не удалось найти заказ хостинга"}))])],64)}}},Be=K(ue,[["__scopeId","data-v-90ce5bd6"]]);export{Be as default};
