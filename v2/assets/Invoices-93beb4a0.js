import{j as Q,o as g,c as L,b as l,a as n,w as c,t as d,F as G,k as Z,d as M,x as W,p as X,l as Y,_ as w,R as $,r as u,g as I}from"./index-33bd9cf4.js";import{u as ee}from"./postings-9b1c8c68.js";import{u as te}from"./contracts-141debab.js";import{s as oe}from"./multiselect-acf9ef65.js";import{S as q}from"./StatusBadge-b80983a6.js";import{I as H}from"./IconDownload-f1f29946.js";import{I as J}from"./IconFile-1a41da20.js";import{B as K}from"./BlockBalanceAgreement-5028e9bc.js";import{a as se,f as ne}from"./useTimeFunction-8602dd60.js";import{E as ae}from"./EmptyStateBlock-98549fc8.js";import{z as ce,d as le,C as ie,F as re}from"./bootstrap-vue-next.es-6bb0e5cd.js";import{_ as de}from"./IconDots-463e8bba.js";import{_ as me}from"./IconCard-c2e605c3.js";import{_ as _e}from"./FormInputSearch-aa64849b.js";import{_ as ue}from"./ClausesKeeper-69d31679.js";import{_ as pe}from"./ButtonDefault-34d9e627.js";import"./IconArrow-dadffb08.js";import"./IconPlus-5f47af9a.js";import"./IconSearch-55746ee2.js";import"./IconClose-d9fbf580.js";const ve=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Files",variant:"td-controls",label:""}],_=p=>(X("data-v-91e60b9b"),p=p(),Y(),p),fe={class:"section"},be={class:"container"},Ie={class:"section-header"},he=_(()=>n("h1",{class:"section-title"},"Счета на оплату",-1)),De={class:"list-form"},ye={class:"list-form_col list-form_col--sm"},ge={class:"list-form_select"},Ce={class:"multiselect-option"},ke=_(()=>n("span",{class:"td-mobile"},"Платежная система",-1)),Se={class:"d-block"},Fe=_(()=>n("span",{class:"td-mobile"},"Дата Создания",-1)),Pe={class:"d-block"},Le=_(()=>n("span",{class:"td-mobile"},"Номер счета",-1)),Be={class:"d-block"},Ne=_(()=>n("span",{class:"td-mobile"},"Договор",-1)),Ve={class:"d-block"},xe=_(()=>n("span",{class:"td-mobile"},"Статус",-1)),Te=_(()=>n("span",{class:"td-mobile"},"Сумма",-1)),Oe={class:"d-block"},Ue={class:"invoices__controls-wrapper"},je=["href"],Me={class:"invoices__download-button-wrapper"},Ee={class:"invoices__download-text"},Re={class:"btn__group"},Ae=["onClick"],ze=_(()=>n("p",null,"ОПЛАТИТЬ",-1)),Ge={class:"dropdown-button"},Ze={class:"btn btn--dots"},qe=["href"],He={key:0,class:"table-controls"},Je=_(()=>n("span",{class:"text-success"},"First",-1)),Ke=_(()=>n("span",{class:"text-info"},"Last",-1)),Qe={class:"multiselect-multiple-label"},We={class:"multiselect-option"};function Xe(p,s,h,o,E,R){var S,F;const D=K,v=pe,C=ue,k=Q("Multiselect"),B=_e,f=q,N=J,V=H,y=me,x=de,b=ce,T=le,O=ie,U=re,j=ae;return g(),L(G,null,[l(D),n("div",fe,[n("div",be,[n("div",Ie,[he,l(v,{onClick:s[0]||(s[0]=e=>o.createNewIncoice()),label:"Выписать новый счёт"})]),l(C),n("div",De,[n("div",ye,[n("div",ge,[l(k,{modelValue:o.select,"onUpdate:modelValue":s[1]||(s[1]=e=>o.select=e),options:o.getUsers,disabled:((S=o.getUsers)==null?void 0:S.length)<=1,label:"name"},{option:c(({option:e})=>[n("div",Ce,d(e.value.padStart(5,"0"))+". "+d(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l(B,{modelValue:o.search,"onUpdate:modelValue":s[2]||(s[2]=e=>o.search=e)},null,8,["modelValue"])]),((F=o.getFilteredOrders)==null?void 0:F.length)>0?(g(),L(G,{key:0},[l(O,{class:"basic-table",items:o.getFilteredOrders,fields:o.worksCompleteFields,"show-empty":!0,filter:o.search,"per-page":o.perPage,"current-page":o.currentPage,responsive:"","sort-by":o.sortBy,"onUpdate:sortBy":s[3]||(s[3]=e=>o.sortBy=e),"sort-desc":o.sortDesc,"onUpdate:sortDesc":s[4]||(s[4]=e=>o.sortDesc=e),"sort-direction":o.sortDirection,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:o.setPageToZero},{"cell(PaymentSystemName)":c(e=>[ke,n("span",Se,d(e.value),1)]),"cell(CreateDate)":c(e=>{var r;return[Fe,n("span",Pe,d(o.formNormalDate(o.secondToDate((r=e.item)==null?void 0:r.CreateDate))),1)]}),"cell(ID)":c(e=>[Le,n("span",Be,d(e.value),1)]),"cell(ContractID)":c(e=>{var r;return[Ne,n("span",Ve,d((r=e.item)==null?void 0:r.Customer),1)]}),"cell(StatusID)":c(e=>[xe,l(f,{status:e.value,"status-table":"Invoices"},null,8,["status"])]),"cell(Summ)":c(e=>{var r;return[Te,n("span",Oe,d((r=e.item)==null?void 0:r.Summ)+" ₽",1)]}),"cell(Files)":c(e=>{var r,P,t;return[n("div",Ue,[e!=null&&e.value?(g(),L("a",{key:0,class:"invoices__download-button",href:o.getInvoicesPDFLink(e)},[n("div",Me,[l(N,{class:"invoices__download-icon"}),n("div",Ee,"Счет №"+d((t=(P=e==null?void 0:e.value)==null?void 0:P[(r=Object.keys(e==null?void 0:e.value))==null?void 0:r[0]])==null?void 0:t.ID),1),l(V,{class:"invoices__download-icon"})])],8,je)):Z("",!0),n("div",Re,[n("button",{class:"btn btn-default btn--border",onClick:a=>o.invoicePayment(e)},[l(y),ze],8,Ae),n("div",Ge,[l(T,{class:"dropdown-dots",right:""},{"button-content":c(()=>[n("div",Ze,[l(x)])]),default:c(()=>[l(b,null,{default:c(()=>[n("a",{href:o.getInvoicesTTFLink(e)},"Скачать в формате tiff",8,qe)]),_:2},1024),l(b,{onClick:a=>o.switchPaymentSystem(e)},{default:c(()=>[M("Изменить счёт")]),_:2},1032,["onClick"]),l(b,{onClick:a=>o.invoicePayment(e)},{default:c(()=>[M("Оплатить")]),_:2},1032,["onClick"]),l(b,{onClick:a=>o.invoicesReject(e)},{default:c(()=>[M("Отменить")]),_:2},1032,["onClick"])]),_:2},1024)])])])]}),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),o.filteredContractsLength>0?(g(),L("div",He,[l(U,{modelValue:o.currentPage,"onUpdate:modelValue":s[5]||(s[5]=e=>o.currentPage=e),"total-rows":o.filteredContractsLength,"per-page":o.perPage,"first-number":"","last-number":""},{"first-text":c(()=>[Je]),"last-text":c(()=>[Ke]),page:c(({page:e,active:r})=>[n("span",null,d((e-1)*o.perPage+1)+"-"+d(e*o.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),l(k,{class:"multiselect--white",modelValue:o.perPage,"onUpdate:modelValue":s[6]||(s[6]=e=>o.perPage=e),options:o.pageOptions,label:"name",openDirection:"top",onInput:s[7]||(s[7]=e=>o.currentPage=1)},{singlelabel:c(({value:e})=>[n("div",Qe,[n("span",null,"Отображать "+d(e.value)+" строк",1)])]),option:c(({option:e})=>[n("div",We,"Отображать "+d(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):Z("",!0)],64)):(g(),W(j,{key:1,label:"Заказов не найдено"}))])])],64)}const Ye={components:{Multiselect:oe,StatusBadge:q,IconDownload:H,IconFile:J,BlockBalanceAgreement:K},async setup(){const p=te(),s=ee(),h=$("emitter");h.on("updateInvoicesTable",()=>{s.fetchInvoices()});const o=u("CreateDate"),E=u(!0),R=u("desc"),D=u(""),v=u("*"),C=u(1),k=u(10),B=u([10,25,50,100]),f=I(()=>Object.keys(s==null?void 0:s.invoicesList).map(t=>{var a,i,m;return{...s==null?void 0:s.invoicesList[t],Customer:(i=(a=y.value)==null?void 0:a[s==null?void 0:s.invoicesList[t].ContractID])==null?void 0:i.Customer,Summ:Number((m=s==null?void 0:s.invoicesList[t])==null?void 0:m.Summ)}}).reverse()),N=I(()=>{const t=f.value.filter(a=>v.value!=="*"?Number(a.ContractID)===Number(v.value):!0);return console.log("Filtered Orders:",t),t}),V=I(()=>s==null?void 0:s.servicesList),y=I(()=>p.contractsList),x=I(()=>{let t=[];return f.value.map(a=>{if(!t.find(i=>i===a.Customer))return t.push(a.Customer),{value:a.ContractID,name:a.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),b=I(()=>f.value.filter(t=>{var a,i;return(t==null?void 0:t.PaymentSystemName.toLowerCase().includes((a=D.value)==null?void 0:a.toLowerCase()))||String(t==null?void 0:t.Summ).toLowerCase().includes((i=D.value)==null?void 0:i.toLowerCase())}).filter(t=>t.ContractID.includes(v.value!=="*"?v.value:"")).length);function T(){C.value=1}function O(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsStamp=yes`}function U(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsTIFF=yes&IsStamp=yes`}function j(t){var a,i,m,A,z;h.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:(a=t==null?void 0:t.item)==null?void 0:a.ID,TypeID:(A=(m=y.value)==null?void 0:m[(i=t==null?void 0:t.item)==null?void 0:i.ContractID])==null?void 0:A.TypeID,Summ:(z=t==null?void 0:t.item)==null?void 0:z.Summ}})}function S(t){var a;s.InvoiceDocument({InvoiceID:(a=t.item)==null?void 0:a.ID}).then(i=>{var m;h.emit("open-modal",{component:"InvoiceDocument",data:{html:i,ID:(m=t.item)==null?void 0:m.ID}})})}function F(){h.emit("open-modal",{component:"NewInvoice"})}function e(){}function r(){}function P(t){var i;let a=new FormData;a.append("ContractID","Default"),a.append("RowsIDs[]",(i=t.item)==null?void 0:i.ID),s.InvoicesReject(a).then(m=>{m==="SUCCESS"&&s.fetchInvoices()})}return window.FormGet=e.bind(this),window.Mobile=r.bind(this),await p.fetchContracts(),await s.fetchInvoices(),await s.fetchServices(),{search:D,select:v,getContracts:y,getUsers:x,getOrders:f,getServices:V,currentPage:C,perPage:k,sortBy:o,sortDesc:E,sortDirection:R,pageOptions:B,filteredContractsLength:b,worksCompleteFields:ve,getFilteredOrders:N,invoicePayment:S,invoicesReject:P,switchPaymentSystem:j,setPageToZero:T,secondToDate:se,formNormalDate:ne,getInvoicesTTFLink:U,getInvoicesPDFLink:O,createNewIncoice:F}}},It=w(Ye,[["render",Xe],["__scopeId","data-v-91e60b9b"]]);export{It as default};
