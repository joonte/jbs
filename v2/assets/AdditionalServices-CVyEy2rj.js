import{_ as ne}from"./EmptyStateBlock-CV1Zaaf7.js";import{m as Ve,r as Ue,Y as Ae,v as Te,L as He}from"./bootstrap-vue-next-CxxkTytZ.js";import{_ as Me}from"./IconDots-DWUcOOJk.js";import{_ as Re}from"./IconCard-cFowCC2T.js";import{_ as Ge}from"./Helper-yVNH7dvZ.js";import{_ as We}from"./StatusBadge-DoJSzeeo.js";import{_ as ze}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as Fe,a as qe}from"./IconButtonBack-BwlFfJZM.js";import{_ as Ke}from"./ButtonDefault-eJbeaBtE.js";import{u as se,r as y,f as U,h as oe,E as P,c as L,o as f,a,D as N,b as d,n as q,I as M,t as S,J as R,w as u,e as g,i as A,G as Ye,F as G,v as re,d as ae,x as ie,g as le,Q as Je,j as Qe}from"./index-XtiBO-PZ.js";import{u as ce,_ as Xe}from"./contracts-BdlSA9YT.js";import{u as de}from"./services-izfy4zss.js";import{f as te}from"./time-DenPiOX5.js";import{u as Ze}from"./globalActions-Tf2FwXht.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as et}from"./BlockBalanceAgreement-DjWMZ940.js";import{u as tt}from"./resetServer-CCXxJWyw.js";import{s as nt}from"./multiselect-eqvbz1NV.js";import"./IconClose-s_NQ_Q4c.js";const st=[{key:"Several",label:"",variant:"",sortable:!1},{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"Scheme",label:"Тариф",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],ot={class:"section-header"},rt={class:"title__icon"},at={class:"btn__group"},it={class:"group__several"},lt=["onClick"],ct={class:"key-field"},dt={class:"key-field"},ut={class:"key-field"},mt={class:"hosting-status__date"},vt={class:"service__controls-wrapper"},pt=["onClick"],_t={class:"btn btn--dots"},ft={__name:"ServiceListSection",props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],async setup(I,{emit:D}){let m,b;const _=I,l=ae(),W=le(),x=se(),C=ie("emitter"),k=y(!1),z=y("ID"),B=y(!0),K=y("desc"),p=y(!1),$=y([]),E=y(null),Y=ce(),w=de(),V=Ze(),i=U(()=>w?.DNSmanagerOrdersList),O=U(()=>w?.ISPswOrdersList),F=U(()=>w?.ExtraIPOrdersList);function J(){l.go(0)}async function Q(){let s="";_.sectionID==="50000"?s="IP адресов":_.sectionID==="51000"?s="лицензии ISPsystem":_.sectionID==="52000"&&(s="вторичного DNS");const n=j.value.filter((r,v)=>$.value[v]).map(r=>r.ID),o={ServiceID:_.sectionID,ItemsPay:E.value,OrdersIDs:n,...k.value&&{UseBalance:"yes"}};await V.OrdersPay(o).then(r=>{r==="Basket"?l.push("/Basket"):r?.Status==="Ok"&&(p.value=!1,C.emit("open-modal",{component:"BalanceProlong",data:{Service:s,Message:r?.Message,Count:r?.Count}}))})}function X(s){const e=i.value,n=String(s);return Object.values(e).find(r=>String(r.OrderID)===n)}const c=U(()=>Y?.contractsList);function Z(s,e,n){e==="50000"||e==="51000"||e==="52000"?be(s,e):l.push(`/ServiceOrderPay/${s}`)}function me(s,e){const n=X(s);C.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:n.ID,ServiceID:e,emitEvent:"updateServicesList",Login:n.Login}})}function ve(s,e){let n=null,o="";switch(e){case"50000":n=Object.entries(F.value).find(([r,v])=>v),o="ExtraIPOrders";break;case"51000":n=Object.entries(O.value).find(([r,v])=>v),o="ISPswOrders";break;case"52000":n=Object.entries(i.value).find(([r,v])=>v),o="DNSmanagerOrders";break;default:n=Object.entries(j.value).find(([r,v])=>v),o="Orders"}n&&C.emit("open-modal",{component:"StatusHistory",data:{modeID:o,rowID:n[1].ID}})}const pe=s=>{const e=_e(s);if(e){const n=e.split(","),o=n.length,r=n.join(`
`);return`Всего: ${o}
${r}`}return"Нет данных"},_e=s=>{const e=Object.entries(i.value).reduce((n,[o,r])=>(n[o]=r,n),{});for(const n in e)if(Object.hasOwnProperty.call(e,n)){const o=e[n];if(String(o.OrderID)===String(s))return o.Parked}return null},fe=s=>{const e=Object.entries(O.value).reduce((n,[o,r])=>(n[o]=r,n),{});for(const n in e)if(Object.hasOwnProperty.call(e,n)){const o=e[n];if(String(o.OrderID)===String(s))return o.IP}},Ie=s=>{const e=Object.entries(F.value).reduce((n,[o,r])=>(n[o]=r,n),{});for(const n in e)if(Object.hasOwnProperty.call(e,n)){const o=e[n];if(String(o.OrderID)===String(s))return o.Login}};function De(){p.value=!0}function Se(){p.value=!1}function be(s,e,n){e==="51000"?l.push(`/ISPswOrderPay/${s}`):e==="52000"?l.push(`/DNSmanagerOrderPay/${s}`):e==="50000"&&l.push(`/ExtraIPOrderPay/${s}`)}function ke(s,e,n){n.target.closest("button, a, .clickable-element")||ee(s.ID)}function ee(s){W.meta?.ServiceID==="51000"?l.push(`/ISPswOrders/${s}`):l.push(`/AdditionalServices/${s}`)}function Oe(s,e){C.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:s,ServiceID:e}})}function ge(s,e){let n;e==="51000"?n=Object.entries(O.value).reduce((r,[v,T])=>(r[v]=T,r),{}):e==="52000"&&(n=Object.entries(i.value).reduce((r,[v,T])=>(r[v]=T,r),{}));let o;for(const r in n)if(Object.hasOwnProperty.call(n,r)){const v=n[r];if(String(v.OrderID)===String(s)){o=v;break}}o&&V.OrderManageHosting({ServiceOrderID:o.ID,OrderID:s,ServiceID:e,XMLHttpRequest:"yes"})}const ye=s=>{const e=Object.entries(i.value).reduce((n,[o,r])=>(n[o]=r,n),{});for(const n in e)if(Object.hasOwnProperty.call(e,n)){const o=e[n];if(String(o.OrderID)===String(s))return o.Domain}return null},j=U(()=>Object.keys(x?.userOrders).map(s=>({...x?.userOrders[s],ID:Number(x?.userOrders[s]?.ID)}))?.reverse()?.filter(s=>s.ServiceID===_?.sectionID));function Ce(){l.push(`/AdditionalServicesOrder?ServiceID=${_?.sectionID}`)}function Pe(s){if(!s)return te(new Date);const e=new Date,n=new Date(e.getTime()+s*24*60*60*1e3);return te(n)}return oe(()=>{$.value=j.value.map(()=>!1)}),[m,b]=P(()=>w.fetchDNSmanagerOrders()),await m,b(),[m,b]=P(()=>w.fetchISPswOrders()),await m,b(),[m,b]=P(()=>w.fetchExtraIPOrders()),await m,b(),(s,e)=>{const n=Fe,o=Ke,r=qe,v=Ve,T=ze,$e=We,we=Ge,he=Re,xe=Me,je=Ye("router-link"),H=Ue,Le=Ae,Ne=Te,Be=He,Ee=ne;return f(),L(G,null,[a("div",ot,[a("div",{class:q(["section-title__nowrap",{column:p.value}])},[a("div",rt,[a("h1",{class:"section-title",onClick:e[0]||(e[0]=t=>J())},S(p.value?"Продление услуг "+I.sectionData?.Item:I.sectionData?.Item),1),M(d(n,{onClick:e[1]||(e[1]=t=>Se())},null,512),[[R,p.value]])]),M(a("div",at,[M(d(o,{class:"btn-several",label:"Продлить несколько заказов",onClick:e[2]||(e[2]=t=>De())},null,512),[[R,(I.sectionID==="50000"||I.sectionID==="51000"||I.sectionID==="52000")&&j.value.length>1]]),d(o,{label:"Заказать",onClick:e[3]||(e[3]=t=>Ce())})],512),[[R,!p.value]]),M(a("div",it,[d(r,{class:"contr period",modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=t=>E.value=t)},null,8,["modelValue"]),d(v,{id:"checkbox-balance",modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=t=>k.value=t),name:"checkbox-balance"},{default:u(()=>e[9]||(e[9]=[g(" Использовать средства с баланса ",-1)])),_:1,__:[9]},8,["modelValue"]),d(o,{label:"Продлить",onClick:e[6]||(e[6]=t=>Q())})],512),[[R,p.value]])],2),d(T,{class:"additional-clauses",partition:`Header:${I.sectionData?.Code==="Default"?I.sectionID:`/${I.sectionData?.Code}Orders`}`},null,8,["partition"])]),j.value&&j.value.length?(f(),N(Be,{key:0,class:"basic-table",items:j.value,fields:re(st),"sort-by":z.value,"onUpdate:sortBy":e[7]||(e[7]=t=>z.value=t),"sort-desc":B.value,"onUpdate:sortDesc":e[8]||(e[8]=t=>B.value=t),onRowClicked:ke,"sort-direction":K.value},{"cell(Several)":u(t=>[M(d(v,{id:"checkbox-"+t.index,modelValue:$.value[t.index],"onUpdate:modelValue":h=>$.value[t.index]=h,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[R,p.value]])]),"cell(ID)":u(t=>[e[10]||(e[10]=a("span",{class:"td-mobile"},"Заказ",-1)),a("span",{class:"order-id",onClick:h=>ee(t.value)},S(t.value),9,lt)]),"cell(ContractID)":u(t=>[e[11]||(e[11]=a("span",{class:"td-mobile"},"Договор",-1)),a("span",null,"#"+S(c.value[t.value]?.ID)+" / "+S(c.value[t.value]?.Customer),1)]),"cell(Scheme)":u(t=>[e[12]||(e[12]=a("span",{class:"td-mobile"},"Тариф",-1)),a("span",null,S(t.item?.SchemeName),1)]),"cell(Keys)":u(t=>[e[13]||(e[13]=a("span",{class:"td-mobile"},"Ключевые поля",-1)),a("span",ct,[t.item?.Code==="ISPsw"?(f(),L(G,{key:0},[g(S(fe(t.item?.ID)),1)],64)):A("",!0)]),a("span",dt,[t.item?.Code==="ExtraIP"?(f(),L(G,{key:0},[g(S(Ie(t.item?.ID)),1)],64)):A("",!0)]),a("span",ut,[g(S(ye(t.item?.ID))+" ",1),a("pre",mt,S(pe(t.item?.ID)),1)])]),"cell(StatusID)":u(t=>[e[14]||(e[14]=a("span",{class:"td-mobile"},"Статус",-1)),d($e,{class:"clickable-element",status:t.value,"status-table":"Orders",onClick:h=>ve(t.item?.ID,t.item?.ServiceID)},null,8,["status","onClick"])]),"cell(ExpirationDate)":u(t=>[e[15]||(e[15]=a("span",{class:"td-mobile"},"Дата окончания",-1)),a("span",{class:q({danger:Number(t.item?.DaysRemainded)<14})},S(Pe(t.item?.DaysRemainded))+" | "+S(t.item?.DaysRemainded||0)+" дн. ",3)]),"cell(UserNotice)":u(t=>[e[16]||(e[16]=a("span",{class:"td-mobile"},"Комментарий",-1)),d(we,{class:"clickable-element","user-notice":t.value,id:t.item?.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]),"cell(controls)":u(t=>[a("div",vt,[a("div",{class:"btn btn--md btn--bold clickable-element",onClick:h=>Z(t.item.ID,t.item.ServiceID,t.item.ContractID)},[d(he),e[17]||(e[17]=g(" Оплатить ",-1))],8,pt),d(Ne,{class:"dropdown-dots",right:""},{"button-content":u(()=>[a("span",_t,[d(xe)])]),default:u(()=>[d(H,null,{default:u(()=>[d(je,{to:`/AdditionalServices/${t.item.ID}`},{default:u(()=>e[18]||(e[18]=[g("Дополнительная информация",-1)])),_:2,__:[18]},1032,["to"])]),_:2},1024),d(H,{onClick:h=>Oe(t.item.ID,t.item.ServiceID)},{default:u(()=>e[19]||(e[19]=[g("Передать на другой аккаунт",-1)])),_:2,__:[19]},1032,["onClick"]),I.sectionID==="51000"||I.sectionID==="52000"?(f(),N(H,{key:0,onClick:h=>ge(t.item.ID,t.item.ServiceID)},{default:u(()=>e[20]||(e[20]=[g("Управлять заказом",-1)])),_:2,__:[20]},1032,["onClick"])):A("",!0),I.sectionID==="52000"?(f(),N(H,{key:1,onClick:h=>me(t.item.ID,t.item.ServiceID)},{default:u(()=>e[21]||(e[21]=[g("Сменить пароль",-1)])),_:2,__:[21]},1032,["onClick"])):A("",!0),d(Le),d(H,{class:"color-red",onClick:h=>s.$emit("deleteItem",t.item)},{default:u(()=>e[22]||(e[22]=[g("Удалить",-1)])),_:2,__:[22]},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","sort-direction"])):(f(),N(Ee,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}}},It=ue(ft,[["__scopeId","data-v-59181b00"]]),Dt={class:"section"},St={class:"container"},bt={class:"section-header"},kt={class:"section-nav"},Ot=["title","onClick"],gt={class:"multiselect-option"},yt={key:0,class:"section-body"},Ct={__name:"AdditionalServices",async setup(I){let D,m;const b=y(!1),_=y(3),l=y(null),W=le(),x=ae(),C=ie("emitter"),k=de(),z=tt(),B=se(),K=ce();[D,m]=P(()=>K.fetchContracts()),await D,m(),[D,m]=P(()=>B.fetchUserOrders()),await D,m(),[D,m]=P(()=>k.fetchServices()),await D,m(),[D,m]=P(()=>k.fetchDNSmanagerOrders()),await D,m(),[D,m]=P(()=>k.fetchISPswOrders()),await D,m(),[D,m]=P(()=>k.fetchExtraIPOrders()),await D,m();const p=U(()=>Object.values(k?.ServicesList||{}).filter(i=>i?.ServicesGroupID!=="1000"&&i?.IsActive&&!i?.IsHidden).sort((i,O)=>Number(i?.SortID)-Number(O?.SortID)).map(i=>({...i,value:i?.ID}))),$=W.query.ServiceID||W.meta?.ServiceID||null;$&&p.value?.find(i=>i?.ID===$)?l.value=$:(l.value=p.value?.[0]?.ID,x.replace(`/AdditionalServices?ServiceID=${l.value}`));async function E(i){b.value=!0,l.value=i,i==="51000"?await x.replace("/ISPswOrders"):await x.replace(`/AdditionalServices?ServiceID=${i}`),b.value=!1}function Y(i){return z?.serverGroupsList?.ServersGroups?.[i]}function w(i){C.emit("open-modal",{component:"DeleteItem",data:{id:i.ID,message:`Вы действительно хотите удалить заказ #${i.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}C.on("updateUserOrdersList",()=>{B.fetchUserOrders()}),C.on("updateServicesList",()=>{B.fetchUserOrders()}),C.on("updateDNSManagerPage",()=>{k.fetchDNSmanagerOrders()}),oe(async()=>{window.addEventListener("resize",V),V()}),Je(()=>{window.removeEventListener("resize",V)});const V=()=>{window.innerWidth>=1920?_.value=9:window.innerWidth>=1600?_.value=7:window.innerWidth>=1440?_.value=6:window.innerWidth>=1200?_.value=5:window.innerWidth>=992?_.value=4:_.value=3};return(i,O)=>{const F=et,J=Xe,Q=It,X=ne;return f(),L(G,null,[d(F),a("div",Dt,[a("div",St,[a("div",bt,[a("div",kt,[(f(!0),L(G,null,Qe(p.value.slice(0,_.value),c=>(f(),L("div",{key:c?.ID,class:q([{"section-link":!0,"section-link-active":l.value===c?.ID},"section-nav__item"]),title:Y(c?.ServersGroupID)?.Comment,onClick:Z=>E(c?.ID)},S(c?.Item),11,Ot))),128)),p.value.length>_.value?(f(),N(re(nt),{key:0,modelValue:l.value,"onUpdate:modelValue":O[0]||(O[0]=c=>l.value=c),class:q({"multiselect--white additional-service__select":!0,"additional-service__select_active":p.value.slice(_.value).find(c=>c?.ID===l.value)}),options:p.value.slice(_.value),label:"ID",onSelect:O[1]||(O[1]=c=>E(c))},{option:u(({option:c})=>[a("div",gt,S(c?.Item),1)]),caret:u(()=>[d(J,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):A("",!0)])]),b.value?A("",!0):(f(),L("div",yt,[p.value.find(c=>c.ID===l.value)?(f(),N(Q,{key:0,sectionID:l.value,sectionData:p.value.find(c=>c.ID===l.value),onDeleteItem:w},null,8,["sectionID","sectionData"])):(f(),N(X,{key:1,label:"Услуга не найдена"}))]))])])],64)}}},zt=ue(Ct,[["__scopeId","data-v-8c039f15"]]);export{zt as default};
