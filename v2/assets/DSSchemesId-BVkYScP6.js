import{_ as H}from"./EmptyStateBlock-DA3-0YDi.js";import{_ as J}from"./ButtonDefault-CMw2aBy6.js";import{_ as Q}from"./TotalAmount.vue_vue_type_script_setup_true_lang-Dg-09YER.js";import{_ as X}from"./BlockOrderServiceWrapper-CSOQwJHk.js";import{_ as Y}from"./BlockAdditionalServices-Dc0oR6v8.js";import{_ as Z}from"./BlockOrderPayBalance-DG_N_8bZ.js";import{_ as ee}from"./BlockSelectContract-CsqQBTZj.js";import{_ as te}from"./ClausesKeeper-iUM0yapS.js";import{_ as se}from"./BlockBalanceAgreement-v_bWuiVT.js";import{P as oe,r as f,E as k,f as i,I as ae,s as re,o as u,c as D,b as d,a as s,F as B,t as O,w as V,C as N,h as $,d as le,i as ne,g as ce}from"./index-Codq73aV.js";import{u as ie}from"./index-BO2gwtUe.js";import{u as ue}from"./services-DyPBvbVy.js";import{a as de}from"./common-DyknwSqv.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-W16P-SAV.js";import"./InputServiceSelect-Dvi-CxI4.js";import"./InputSelect.vue_vue_type_script_setup_true_lang-D7E9_BoS.js";import"./IconChevronDown-DOsbTpSQ.js";import"./BasicInput-DeQAeyXe.js";import"./component-DqcwA9JN.js";import"./global-CdY51QQZ.js";import"./IconCross-DYjIbZqx.js";import"./multiselect-DElL0Rlw.js";import"./IconClose-Dia1noy8.js";const pe={class:"tw-px-4 md:tw-px-8"},ve={class:"section"},_e={class:"tw-text-xl sm:tw-text-4xl"},Se={class:"tw-p-3 md:tw-p-6 tw-border tw-border-gray-200 tw-rounded tw-mt-8"},fe={class:"tw-flex tw-flex-wrap tw-gap-6 tw-mt-2"},De={class:"tw-text-gray-500 tw-text-xs"},ye={class:"tw-text-gray-800 tw-text-sm"},we={class:"tw-my-6"},Ie={key:1,class:"section"},be={__name:"DSSchemesId",async setup(xe){let m,p;const A=ie(),l=oe(),y=ue(),g=ne(),w=le(),o=f(null),n=f([]),I=f(!1),c=f(null),F=f(!1);[m,p]=k(()=>l.fetchDSOrders()),await m,p(),[m,p]=k(()=>l.fetchDSSchemes()),await m,p(),[m,p]=k(()=>y.fetchServices()),await m,p();const U=i(()=>o.value===null||c.value===null),b=i(()=>A.contractsList[c.value]),L=i(()=>{const t=l.DSSchemes?.[g.params.id];return t?de(t):[]}),v=i(()=>l.DSSchemes?.[g.params.id]),T=i(()=>y?.ServicesList),K=i(()=>{let t=0;return n.value.forEach(e=>{t+=Number(e?.Price)}),t}),G=i(()=>Object.values(l.dsOrders).find(t=>t.SchemeID==g.params.id&&t.ContractId==b.value.ID));function M(){let t=0;return o.value?.discounts?.Bonuses.map(e=>{t+=Number(e.Economy)}),t}function R(t){const e=Number(v.value?.CostInstall)||0,r=Number(t)||0,_=(e+r).toFixed(2);return Number(_)}async function j(t){if(!(!n.value||n.value.length===0))for(const e of n.value){let r=T.value[e.ServiceID]?.Code;const{result:_,info:x}=await y.ServiceOrder({Code:r,DependOrderID:t,...e,ContractID:c.value});if(_==="SUCCESS"){let S={};r==="Default"?S.ServiceOrderID=x?.ServiceOrderID:S[`${r}OrderID`]=x?.ServiceOrderID;const h=await y.ServiceOrderPay(r,S);let{result:C}=h;C==="SUCCESS"?w.push("/AdditionalServices"):C==="BASKET"&&w.push("/Basket")}else break}}async function E(){I.value=!0;const t=await l.DSOrder({ContractID:c.value,DSSchemeID:v.value.ID});if(t.result==="SUCCESS"){j(t.info?.OrderID);const e=await l.DSOrderPay({DSOrderID:t.info?.DSOrderID,DaysPayFromBallance:o.value?.daysFromBalance||0,DaysPay:o.value?.actualDays,IsChange:!0});e.result==="SUCCESS"?w.push("/DSOrders"):e.result==="BASKET"&&w.push("/Basket"),I.value=!1}else I.value=!1}const P=t=>{t.key==="Enter"&&t.ctrlKey&&!U.value&&E()};return ae(()=>{document.addEventListener("keyup",P)}),re(()=>{document.removeEventListener("keyup",P)}),(t,e)=>{const r=se,_=te,x=ee,S=Z,h=Y,C=X,W=Q,q=J,z=H;return u(),D(B,null,[d(r),s("div",pe,[v.value?.ID?(u(),D(B,{key:0},[s("div",ve,[s("div",null,[s("h1",_e,O(v.value?.Name),1),e[4]||(e[4]=s("div",{class:"section-label"},"Выделенный сервер",-1))]),d(_)]),d(C,{basic_title:"Выделенный сервер"},{page:V(()=>[s("div",Se,[e[5]||(e[5]=s("div",{class:"tw-text-2xl"},"Конфигурация",-1)),s("div",fe,[(u(!0),D(B,null,ce(L.value,a=>(u(),D("div",{class:"tw-space-y-1",key:a.label},[s("div",De,O(a.label),1),s("div",ye,O(a.text),1)]))),128))])]),e[6]||(e[6]=s("div",{class:"section"},[s("div",{class:"section-subtitle"},"Что входит в стоимость"),s("div",{class:"text"},[s("p",null,"Для подключения дополнительных услуг"),s("ul",null,[s("li",null,"Размещение в РФ, Москва"),s("li",null,"IP адрес, с возможностью расширения"),s("li",null,"Бесплатная панель управления ISPManager Lite"),s("li",null,"Круглосуточная поддержка")])])],-1)),d(x,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=a=>c.value=a),title:"Оформление услуги"},null,8,["modelValue"]),b.value?(u(),N(S,{key:0,modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a),contract:b.value,scheme:v.value,"service-id":4e4,order:G.value},null,8,["modelValue","contract","scheme","order"])):$("",!0)]),services:V(()=>[d(h,{modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value=a),"service-search-params":{ServiceID:4e4,ServersGroupID:v.value?.ServersGroupID}},null,8,["modelValue","service-search-params"])]),_:1}),s("div",we,[o.value?(u(),N(W,{key:0,tariff:o.value,"additional-services":n.value},null,8,["tariff","additional-services"])):$("",!0),d(q,{class:"btn--wide",label:F.value||b.value?.Balance>R(o.value?.price-M()+K.value)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||c.value===null,"is-loading":I.value,onClick:e[3]||(e[3]=a=>E())},null,8,["label","disabled","is-loading"])])],64)):(u(),D("div",Ie,[d(z,{label:"Сервер не найден"})]))])],64)}}},He=me(be,[["__scopeId","data-v-6e554b54"]]);export{He as default};
