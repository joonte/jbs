import{_ as j}from"./IconUpload-DmhfICPy.js";import{_ as K}from"./IconClose-Dia1noy8.js";import{_ as L}from"./IconFile-ZfzHpv9u.js";import{N as O,o as i,c as d,t as w,h as T,a as l,K as G,Y as C,O as z,r as f,f as A,I as R,s as H,E as Y,b as n,w as I,n as _,v as J,F as V,g as P,G as Q,d as W,e as X}from"./index-Codq73aV.js";import{_ as Z}from"./ClausesKeeper-iUM0yapS.js";import{_ as ee}from"./BlockBalanceAgreement-v_bWuiVT.js";import{u as le}from"./edesks-T89tHK8I.js";import{u as te}from"./files-B5cKv3cM.js";import{s as se}from"./multiselect-DElL0Rlw.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BO2gwtUe.js";import"./ButtonDefault-CMw2aBy6.js";import"./common-DyknwSqv.js";const ae={class:"tw-flex tw-flex-col md:tw-flex-row tw-items-center tw-text-sm tw-gap-4 tw-mb-4"},ne={key:0,class:"tw-w-full md:tw-w-64"},re={class:"tw-w-full md:tw-flex-1"},ue=["disabled","name","placeholder"],ie={__name:"InputText",props:z({label:{type:String,default:""},name:{type:String,default:""},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1}},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const m=O(r,"modelValue");return(c,a)=>(i(),d("div",ae,[r.label?(i(),d("div",ne,w(r.label),1)):T("",!0),l("div",re,[G(l("input",{"onUpdate:modelValue":a[0]||(a[0]=p=>m.value=p),disabled:r.disabled,name:r.name,placeholder:r.placeholder,class:"tw-flex tw-justify-center tw-h-10 tw-px-3.5 tw-border tw-border-solid tw-border-gray-200 tw-rounded tw-text-gray-500 tw-placeholder-gray-300 tw-w-full"},null,8,ue),[[C,m.value]])])]))}},de={class:"tw-px-4 md:tw-px-8 tw-mb-4"},me={class:"tw-mb-8"},fe={class:"form-field form-field--basic"},ce={class:"tw-relative tw-flex tw-w-full"},pe={class:"multiselect-option"},ve={class:"tw-flex tw-items-start form-field form-field--basic"},_e={class:"tw-relative tw-flex tw-w-full"},we={key:0,class:"form-field form-field--file form-field--basic"},be={class:"tw-relative tw-flex tw-w-full"},ge={class:"chat-files"},he=["onClick"],ke={class:"form-field form-field--file form-field--basic"},xe={class:"tw-relative tw-flex tw-w-full"},ye={class:"form-field-input__file tw-h-12 tw-w-full"},Ee={class:"tw-flex tw-justify-end"},Ie={__name:"NewTicket",async setup(r){let m,c;const a=le(),p=te(),D=W(),t=f({theme:{value:null,required:!0,isError:!1},selectGroup:{value:null,required:!0,isError:!1},message:{value:null,required:!0,isError:!1},file:{value:null,required:!1,isError:!1}}),b=f(null),u=f([]),g=f(null),h=A(()=>Object.keys(a?.eDeskGroups||[])?.map(s=>({value:a?.eDeskGroups?.[s]?.ID,name:a?.eDeskGroups?.[s]?.Name})));function S(s){t.value.file.value=s.target.files?.[0]||null,t.value.file.value&&(b.value.value="",p.sendFile(t.value.file.value).then(e=>{u.value.push({name:t.value.file.value?.name,value:e.slice(e.lastIndexOf("^")+1,e.length)})}))}function $(s){u.value=u.value.filter((e,v)=>v!==s)}function k(){let s=!1;Object.keys(t.value).map(e=>{t.value?.[e].required&&t.value?.[e].value===null&&(t.value[e].isError=!0,s=!0)}),s||a.ticketEdit({Theme:t.value?.theme.value||null,TargetGroupID:t.value?.selectGroup.value||null,Message:t.value?.message.value||null,TicketMessageFile:u.value?.map(e=>e?.value)||null}).then(e=>{e==="success"&&D.push("/Tickets")})}const x=s=>{s.key==="Enter"&&s.ctrlKey&&k()};R(()=>{document.addEventListener("keyup",x),y()}),H(()=>{document.removeEventListener("keyup",x)}),[m,c]=Y(()=>a.fetchTicketGroups().then(()=>{t.value.selectGroup.value=h.value?.[0]?.value})),await m,c();function y(){const s=g.value;s.style.height="auto",s.style.height=s.scrollHeight+10+"px"}return(s,e)=>{const v=ee,N=Q("router-link"),B=Z,F=ie,M=L,U=K,q=j;return i(),d(V,null,[n(v),l("div",de,[l("div",me,[n(N,{to:"/Tickets",class:"section-label"},{default:I(()=>e[4]||(e[4]=[X("Служба поддержки",-1)])),_:1,__:[4]}),e[5]||(e[5]=l("h1",{class:"section-title"},"Создать тикет",-1))]),n(B),n(F,{class:_({"form-error":t.value.theme.isError}),label:"Тема запроса",placeholder:"Заголовок",name:"login",modelValue:t.value.theme.value,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.theme.value=o)},null,8,["class","modelValue"]),l("label",fe,[e[6]||(e[6]=l("div",{class:"form-field__label"},"Отдел",-1)),l("div",ce,[n(J(se),{class:_(["tw-flex tw-w-full",{"multiselect--white":!0,"form-error":t.value.selectGroup.isError}]),modelValue:t.value.selectGroup.value,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.selectGroup.value=o),options:h.value,label:"name"},{option:I(({option:o})=>[l("div",pe,w(o.name),1)]),_:1},8,["class","modelValue","options"])])]),l("label",ve,[e[7]||(e[7]=l("div",{class:"form-field__label tw-pt-2"},"Сообщение",-1)),l("div",_e,[G(l("textarea",{ref_key:"messageInput",ref:g,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.message.value=o),onInput:y,class:_(["tw-min-h-48 tw-placeholder-gray-300",{"form-error":t.value.message.isError}]),placeholder:"Опишите проблему, указав сервер размещения, вашу учётную запись на сервере, имя сайта, УРЛ ошибки и способ её воспроизведения."},null,34),[[C,t.value.message.value]])])]),u.value.length?(i(),d("div",we,[e[8]||(e[8]=l("div",{class:"form-field__label"},null,-1)),l("div",be,[l("div",ge,[(i(!0),d(V,null,P(u.value,(o,E)=>(i(),d("div",{class:"chat-files__item",key:E},[l("span",null,[n(M,{class:"file-icon"})]),l("span",null,w(o?.name),1),l("button",{class:"close",onClick:Ve=>$(E)},[n(U)],8,he)]))),128))])])])):T("",!0),l("label",ke,[e[10]||(e[10]=l("div",{class:"form-field__label"},null,-1)),l("div",xe,[l("input",{ref_key:"fileInput",ref:b,type:"file",onChange:S},null,544),l("div",ye,[n(q),e[9]||(e[9]=l("span",{class:"tw-text-sm"},"Прикрепить файл",-1))])])]),l("div",Ee,[l("button",{class:"btn btn--blue btn-default",onClick:e[3]||(e[3]=o=>k())},e[11]||(e[11]=[l("span",{class:"tw-text-sm tw-min-w-32"},"Отправить",-1)]))])])],64)}}},Ke=oe(Ie,[["__scopeId","data-v-e50d9b51"]]);export{Ke as default};
