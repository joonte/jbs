import{o as A,c as F,b,a as o,t as I,F as B,k as w,p as x,l as V,_ as N,a7 as E,e as L,f as q,r as D,g as u,h as M,a2 as R}from"./index-83b4b7ba.js";import{u as U}from"./postings-05f51b78.js";import{u as J}from"./services-c044aff2.js";import{_ as K}from"./ButtonDefault-dc248ec6.js";import{_ as T}from"./ClausesKeeper-55c14b7f.js";import{B as z}from"./BlockBalanceAgreement-c5fad736.js";import"./IconClose-86aafc4e.js";import"./contracts-623ec7a8.js";import"./bootstrap-vue-next.es-8f3ae81a.js";import"./IconArrow-80c72216.js";const h=_=>(x("data-v-1e184e1a"),_=_(),V(),_),G={class:"additional-service-prolong"},H={class:"section"},Q={class:"container"},W={class:"section-header"},X=h(()=>o("h1",{class:"section-title"},"Оплата заказа дополнительной услуги",-1)),Y={class:"section-label"},Z={class:"section"},$={class:"container"},j={class:"service-prolong__data"},ee={class:"form-field"},se=h(()=>o("div",{class:"form-field__label"},"Стоимость заказа",-1)),te=["value"],oe={class:"form-field"},re={class:"form-field__label"},ae=h(()=>o("input",{type:"text",placeholder:"0 руб",value:"1",disabled:""},null,-1)),ie={class:"form-field"},ce=h(()=>o("div",{class:"form-field__label"},"Всего к оплате",-1)),ne=["value"],le={class:"section"},de={class:"container"},_e={class:"service-prolong__data"},ue={class:"total-block"},ve={class:"total-block__row total-block__row--big"},pe=h(()=>o("div",{class:"total-block__col"},"Итого",-1)),me={class:"total-block__col"};function fe(_,v,p,r,k,g){var S,m,f,O,C,l,e;const n=z,y=T,P=K;return A(),F(B,null,[b(n),o("div",G,[o("div",H,[o("div",Q,[o("div",W,[X,o("div",Y,I((S=r.getService)==null?void 0:S.Name)+" # "+I((m=r.getOrder)==null?void 0:m.ID),1)]),b(y)])]),(f=r.getOrder)!=null&&f.IsPayed&&((O=r.getOrder)!=null&&O.IsAutoProlong)||!((C=r.getOrder)!=null&&C.IsPayed)?(A(),F(B,{key:0},[o("div",Z,[o("div",$,[o("div",j,[o("label",ee,[se,o("input",{type:"text",placeholder:"0 руб",value:((l=r.getService)==null?void 0:l.Cost)+" руб",disabled:""},null,8,te)]),o("label",oe,[o("div",re,"Количество ("+I((e=r.getService)==null?void 0:e.Measure)+")",1),ae]),o("label",ie,[ce,o("input",{type:"text",placeholder:"0 руб",value:r.getServicePrice()+" руб",disabled:""},null,8,ne)])])])]),o("div",le,[o("div",de,[o("div",_e,[o("div",ue,[o("div",ve,[pe,o("div",me,I(r.getServicePrice()||"0")+" ₽",1)])]),b(P,{class:"btn--wide",label:"Оплатить",onClick:v[0]||(v[0]=s=>r.orderPay()),"is-loading":r.isLoading},null,8,["is-loading"])])])])],64)):w("",!0)])],64)}const he={async setup(){const _=E(),v=L(),p=U(),r=q(),k=J(),g=D(!1),n=u(()=>Object.keys(r==null?void 0:r.userOrders).map(e=>r==null?void 0:r.userOrders[e]).find(e=>e.ID===_.params.id));u(()=>{var e,s;return(s=(e=P.value)==null?void 0:e.find(t=>{var a,i,c;return t.value===((c=(i=(a=n.value)==null?void 0:a.OrdersFields)==null?void 0:i[0])==null?void 0:c.Value)}))==null?void 0:s.price}),u(()=>{var e,s;return(s=(e=S.value)==null?void 0:e.find(t=>{var a,i,c;return t.value===((c=(i=(a=n.value)==null?void 0:a.OrdersFields)==null?void 0:i[1])==null?void 0:c.Value)}))==null?void 0:s.price});const y=D(0),P=u(()=>{var e,s,t,a,i;return(i=(a=(t=(s=(e=l.value)==null?void 0:e.ServicesFields)==null?void 0:s[0])==null?void 0:t.Options)==null?void 0:a.split(`
`))==null?void 0:i.map(c=>{let d=c.split("=");return{value:d[0],name:d[1],price:d[2]}})}),S=u(()=>{var e,s,t,a,i;return(i=(a=(t=(s=(e=l.value)==null?void 0:e.ServicesFields)==null?void 0:s[1])==null?void 0:t.Options)==null?void 0:a.split(`
`))==null?void 0:i.map(c=>{let d=c.split("=");return{value:d[0],name:d[1],price:d[2]}})});async function m(e){try{const t=(await R.get(`/ServiceOrderPay?OrderID=${e}&JSON=1`)).data,a=f(t);let i=1;return t.AmountPay&&(i=parseInt(t.AmountPay)||1),a}catch(s){return console.error("Ошибка при получении данных о стоимости заказа",s),null}}function f(e){let s=0;for(const t in e)e.hasOwnProperty(t)&&(typeof e[t]=="object"?s+=f(e[t]):t==="Cost"&&!isNaN(e[t])&&(s+=parseFloat(e[t])));return s}function O(){var t;return((parseFloat((t=l.value)==null?void 0:t.Cost)||0)*1).toFixed(2)}function C(){var e,s;g.value=!0,k.ServiceOrderPay((e=n.value)==null?void 0:e.Code,{AmountPay:"1",ServiceOrderID:(s=n.value)==null?void 0:s.ID,IsChange:!0}).then(t=>{var c;let{result:a,error:i}=t;a==="SUCCESS"?v.push(`/AdditionalServices/${(c=n.value)==null?void 0:c.ID}`):a==="BASKET"&&v.push("/Basket"),g.value=!1})}M(async()=>{if(n.value){const e=n.value.ID,s=await m(e);console.log(l),s!==null&&(console.log(s),y.value=s)}});const l=u(()=>{var e;return p==null?void 0:p.servicesList[(e=n.value)==null?void 0:e.ServiceID]});return await r.fetchUserOrders(),await p.fetchServices(),{getOrder:n,getService:l,getServicePrice:O,isLoading:g,orderPay:C,fetchOrderCost:m,orderCost:y}}},Fe=N(he,[["render",fe],["__scopeId","data-v-1e184e1a"]]);export{Fe as default};
