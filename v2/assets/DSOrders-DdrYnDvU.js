import{_ as se}from"./EmptyStateBlock-D6U_EDq6.js";import{_ as oe}from"./DSCard-CbQjm1t4.js";import{_ as ae}from"./FormInputSearch-D7D7Vqhf.js";import{_ as ne}from"./ClausesKeeper-DVJgfLR3.js";import{m as re}from"./bootstrap-vue-next-3DpAa4tb.js";import{_ as le,a as ue}from"./IconButtonBack-D0IRTKQ9.js";import{_ as ce}from"./ButtonDefault-CghIUDY0.js";import{_ as ie}from"./BlockBalanceAgreement-2iQbaweR.js";import{r as d,O as me,D as C,x as de,f as h,c as p,b as n,a as r,C as D,h as y,t as _,I as pe,J as _e,w as k,E as fe,v as ve,F as M,i as we,d as Se,o as l,e as $}from"./index-CipWZKo_.js";import{u as ge}from"./contracts-CILh9uSu.js";import{s as Ce}from"./multiselect-DWCHRlfT.js";import{u as he}from"./global-Fil99La8.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./StatusBadge-B65ys1I-.js";import"./CardButton-Ym2KFbPf.js";import"./ServerStatusBadge.vue_vue_type_script_setup_true_lang-6rZqTOev.js";import"./IconDots-BE2XsWZ6.js";import"./Helper-BWCpStXX.js";import"./IconCard-jY7IitfY.js";import"./time-DenPiOX5.js";import"./IconPlus-bAw7b_ly.js";import"./IconClose-ChC2G6HM.js";const ke={class:"tw-px-4 md:tw-px-8"},be={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},Oe={class:"tw-flex tw-items-center tw-gap-2"},ye={key:0,class:"tw-flex tw-items-center tw-gap-2"},xe={key:1,class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-4 tw-my-4"},Ie={class:"list-form"},Be={class:"list-form_col list-form_col--sm"},Ve={class:"list-form_select"},Pe={class:"multiselect-option"},Le={key:0,class:"tw-space-y-4 tw-mb-6"},Ue={__name:"DSOrders",async setup(Me){let u,c;const f=d("*"),v=d(""),x=he(),m=me(),I=ge(),B=Se(),i=d(!1),w=d([]),b=d(null),O=d(!1);[u,c]=C(()=>m.fetchDSOrders()),await u,c(),[u,c]=C(()=>m.fetchDSSchemes()),await u,c(),[u,c]=C(()=>m.fetchDSOrderIPMI()),await u,c(),[u,c]=C(()=>I.fetchContracts()),await u,c();const S=de("emitter");S.on("updateDSOrdersList",()=>{m.fetchDSOrders()});const j=t=>{w.value=t};async function N(){const t=Object.keys(w.value).filter(s=>w.value[s]),e={ServiceID:"40000",ItemsPay:b.value,OrdersIDs:t,...O.value&&{UseBalance:"yes"}};await x.OrdersPay(e).then(s=>{s==="Basket"?B.push("/Basket"):s?.Status==="Ok"&&(i.value=!1,S.emit("open-modal",{component:"BalanceProlong",data:{Message:s?.Message,Count:s?.Count}}))})}function E(){i.value=!0}function R(){i.value=!1}const a=h(()=>Object.keys(m.dsOrders).map(t=>m.dsOrders[t])?.reverse()),V=h(()=>I?.contractsList),g=h(()=>T(A(a.value)));function A(t){return f.value!=="*"?t.filter(e=>e?.ContractID===f.value):t}function T(t){if(v.value){const e=v.value.toLowerCase();t.filter(s=>s?.Customer.toLowerCase().includes(e)||String(s?.OrderID).includes(e)||s?.Scheme.toLowerCase().includes(e)||s?.IP.toLowerCase().includes(e)||s?.disks.toLowerCase().includes(e)||s?.CPU.toLowerCase().includes(e)||s?.ram.toLowerCase().includes(e))}else return t}function F(t){x.OrderManage(t)}const P=h(()=>{let t=[{value:"*",name:"Все договора"}];return a.value!==null&&V.value!==null?(Object.keys(a.value).forEach(e=>{t.find(s=>s.value===a.value[e]?.ContractID)||t.push({value:a.value[e]?.ContractID,name:V.value[a.value[e]?.ContractID]?.Customer})}),t):{value:"*",name:"Все договора"}});function G(t){let e=H(t?.SchemeID);e===void 0&&(e=t);let s=[];return t?.Scheme&&s.push(t?.Scheme),t?.CPU&&s.push(t?.CPU),e?.ram&&s.push("RAM "+e?.ram+" GB"),e?.disks&&s.push(e?.disks),e?.CostMonth&&s.push(e?.CostMonth+" / месяц"),s}function H(t){return m.DSSchemes?.[t]}function J(t,e){S.emit("open-modal",{component:"DeleteItem",data:{id:t,message:`Вы действительно хотите удалить выделенный сервер #${e}?`,tableID:"DSOrders",successEmit:"updateDSOrdersList"}})}function q(t){S.emit("open-modal",{component:"OrdersTransfer",data:t})}function z(){B.go(0)}return(t,e)=>{const s=ie,K=le,L=ce,Q=fe("router-link"),W=ue,X=re,Y=ne,Z=ae,ee=oe,U=se;return l(),p(M,null,[n(s),r("div",ke,[r("div",be,[r("div",Oe,[i.value?(l(),D(K,{key:0,onClick:e[0]||(e[0]=o=>R()),class:"tw-cursor-pointer"})):y("",!0),r("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:e[1]||(e[1]=o=>z())},_(i.value?"Продление услуг выделенных серверов":"Выделенные серверы"),1)]),i.value?y("",!0):(l(),p("div",ye,[pe(n(L,{class:"btn-several",label:"Продлить несколько заказов",onClick:e[2]||(e[2]=o=>E())},null,512),[[_e,a.value.length>1]]),n(Q,{class:"btn btn--blue btn-default",to:"DSSchemes"},{default:k(()=>e[8]||(e[8]=[$("Заказать",-1)])),_:1,__:[8]})])),i.value?(l(),p("div",xe,[n(W,{class:"contr period",modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=o=>b.value=o)},null,8,["modelValue"]),n(X,{id:"checkbox-balance",modelValue:O.value,"onUpdate:modelValue":e[4]||(e[4]=o=>O.value=o),name:"checkbox-balance"},{default:k(()=>e[9]||(e[9]=[$(" Использовать средства с баланса ",-1)])),_:1,__:[9]},8,["modelValue"]),n(L,{label:"Продлить",onClick:e[5]||(e[5]=o=>N())})])):y("",!0)]),n(Y,{partition:"Header:/DSOrders"}),r("div",Ie,[r("div",Be,[r("div",Ve,[n(ve(Ce),{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=o=>f.value=o),options:P.value,disabled:P.value?.length<=1,label:"name"},{singlelabel:k(({value:o})=>[r("span",null," # "+_(String(o.value).padStart(5,"0"))+" / "+_(o.name),1)]),option:k(({option:o})=>[r("div",Pe,"# "+_(String(o.value).padStart(5,"0"))+" / "+_(o.name),1)]),_:1},8,["modelValue","options","disabled"])])]),n(Z,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=o=>v.value=o)},null,8,["modelValue"])]),a.value&&a.value?.length>0?(l(),p("div",Le,[g.value&&g.value?.length>0?(l(!0),p(M,{key:0},we(g.value,(o,te)=>(l(),D(ee,{key:o.OrderID,params:G(o),"is-last":te===g.value.length-1,server:o,isSeveral:i.value,"selected-rows":w.value,onUpdateSelectedRows:j,onDelete:J,onTransfer:q,onManage:F},null,8,["params","is-last","server","isSeveral","selected-rows"]))),128)):(l(),D(U,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(l(),D(U,{key:1,class:"no-margin",label:"У Вас нет заказов на выделенные серверы"}))])],64)}}},ot=De(Ue,[["__scopeId","data-v-131d3142"]]);export{ot as default};
