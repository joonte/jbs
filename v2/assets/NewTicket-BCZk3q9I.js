import{_ as O}from"./IconUpload-Cg-cU5FU.js";import{_ as K}from"./IconClose-s_NQ_Q4c.js";import{_ as A}from"./IconFile-3Bs1Bn0r.js";import{aq as z,ar as R,c as u,o as d,i as C,a as l,t as c,I as D,P as S,am as H,r as w,f as V,h as J,s as Q,E as W,b as a,w as b,G as X,n as m,v as T,F as G,j as Y,d as Z,e as ee}from"./index-XtiBO-PZ.js";import{_ as le}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as te}from"./BlockBalanceAgreement-DjWMZ940.js";import{u as se}from"./edesks-C7o6eTx8.js";import{u as oe}from"./files-Xptl5-9o.js";import{s as I}from"./multiselect-eqvbz1NV.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./contracts-BdlSA9YT.js";import"./ButtonDefault-eJbeaBtE.js";const re={class:"tw-flex tw-flex-col md:tw-flex-row tw-items-center tw-text-sm tw-gap-4 tw-mb-4"},ie={key:0,class:"tw-w-full md:tw-w-64"},ne={class:"tw-w-full md:tw-flex-1"},ue=["disabled","name","placeholder"],de={__name:"InputText",props:z({label:{type:String,default:""},name:{type:String,default:""},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1}},{modelValue:{modelValue:{type:String,default:""}},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const f=R(i,"modelValue");return(v,r)=>(d(),u("div",re,[i.label?(d(),u("div",ie,c(i.label),1)):C("",!0),l("div",ne,[D(l("input",{"onUpdate:modelValue":r[0]||(r[0]=p=>f.value=p),disabled:i.disabled,name:i.name,placeholder:i.placeholder,class:"tw-flex tw-justify-center tw-h-10 tw-px-3.5 tw-border tw-border-solid tw-border-gray-200 tw-rounded tw-text-gray-500 tw-placeholder-gray-300 tw-w-full"},null,8,ue),[[S,f.value]])])]))}},fe={class:"container"},me={class:"section-header"},ce={class:"form-field form-field--basic"},ve={class:"tw-relative tw-flex tw-w-full"},pe={class:"multiselect-option"},_e={class:"form-field form-field--basic"},we={class:"tw-relative tw-flex tw-w-full"},be={class:"multiselect-option"},ge={class:"tw-flex tw-items-start form-field form-field--basic"},ke={class:"tw-relative tw-flex tw-w-full"},ye={key:0,class:"form-field form-field--file form-field--basic"},he={class:"tw-relative tw-flex tw-w-full"},xe={class:"chat-files"},Ee=["onClick"],Ve={class:"form-field form-field--file form-field--basic"},Te={class:"tw-relative tw-flex tw-w-full"},Ge={class:"form-field-input__file tw-h-12 tw-w-full"},Ie={class:"tw-flex tw-justify-end"},Ce={__name:"NewTicket",async setup(i){let f,v;const r=se(),p=H(),P=oe(),U=Z(),t=w({theme:{value:null,required:!0,isError:!1},selectGroup:{value:null,required:!0,isError:!1},selectPriority:{value:null,required:!0,isError:!1},message:{value:null,required:!0,isError:!1},file:{value:null,required:!1,isError:!1}}),g=w(null),n=w([]),k=V(()=>Object.keys(r?.eDeskGroups||[])?.map(o=>({value:r?.eDeskGroups?.[o]?.ID,name:r?.eDeskGroups?.[o]?.Name}))),y=V(()=>p.data.Edesks?.Priorities);function $(o){t.value.file.value=o.target.files?.[0]||null,t.value.file.value&&(g.value.value="",P.sendFile(t.value.file.value).then(e=>{n.value.push({name:t.value.file.value?.name,value:e.slice(e.lastIndexOf("^")+1,e.length)})}))}function q(o){n.value=n.value.filter((e,_)=>_!==o)}function h(){let o=!1;Object.keys(t.value).map(e=>{t.value?.[e].required&&t.value?.[e].value===null&&(t.value[e].isError=!0,o=!0)}),o||r.ticketEdit({Theme:t.value?.theme.value||null,TargetGroupID:t.value?.selectGroup.value||null,PriorityID:t.value?.selectPriority.value||null,Message:t.value?.message.value||null,TicketMessageFile:n.value?.map(e=>e?.value)||null}).then(e=>{e==="success"&&U.push({name:"default.Tickets"})})}const x=o=>{o.key==="Enter"&&o.ctrlKey&&h()};return J(()=>{document.addEventListener("keyup",x)}),Q(()=>{document.removeEventListener("keyup",x)}),[f,v]=W(()=>r.fetchTicketGroups().then(()=>{t.value.selectGroup.value=k.value?.[0]?.value,t.value.selectPriority.value=Object.keys(y.value)?.[0]})),await f,v(),(o,e)=>{const _=te,B=X("router-link"),F=le,M=de,N=A,j=K,L=O;return d(),u(G,null,[a(_),l("section",fe,[l("div",me,[a(B,{to:"/Tickets",class:"section-label"},{default:b(()=>e[5]||(e[5]=[ee("Служба поддержки",-1)])),_:1,__:[5]}),e[6]||(e[6]=l("h1",{class:"section-title"},"Создать тикет",-1))]),a(F),a(M,{class:m({"form-error":t.value.theme.isError}),label:"Тема запроса",placeholder:"Заголовок",name:"login",modelValue:t.value.theme.value,"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.theme.value=s)},null,8,["class","modelValue"]),l("label",ce,[e[7]||(e[7]=l("div",{class:"form-field__label"},"Отдел",-1)),l("div",ve,[a(T(I),{class:m(["tw-flex tw-w-full",{"multiselect--white":!0,"form-error":t.value.selectGroup.isError}]),modelValue:t.value.selectGroup.value,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.selectGroup.value=s),options:k.value,label:"name"},{option:b(({option:s})=>[l("div",pe,c(s.name),1)]),_:1},8,["class","modelValue","options"])])]),l("label",_e,[e[8]||(e[8]=l("div",{class:"form-field__label"},"Приоритет",-1)),l("div",we,[a(T(I),{class:m(["tw-flex tw-w-full",{"multiselect--white":!0,"form-error":t.value.selectPriority.isError}]),modelValue:t.value.selectPriority.value,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.selectPriority.value=s),options:y.value,label:"name"},{option:b(({option:s})=>[l("div",be,c(s.name),1)]),_:1},8,["class","modelValue","options"])])]),l("label",ge,[e[9]||(e[9]=l("div",{class:"form-field__label tw-pt-2"},"Сообщение",-1)),l("div",ke,[D(l("textarea",{class:m(["tw-h-64 tw-placeholder-gray-300",{"form-error":t.value.message.isError}]),placeholder:"Опишите проблему, указав сервер размещения, вашу учётную запись на сервере, имя сайта, УРЛ ошибки и способ её воспроизведения.","onUpdate:modelValue":e[3]||(e[3]=s=>t.value.message.value=s)},null,2),[[S,t.value.message.value]])])]),n.value.length?(d(),u("div",ye,[e[10]||(e[10]=l("div",{class:"form-field__label"},null,-1)),l("div",he,[l("div",xe,[(d(!0),u(G,null,Y(n.value,(s,E)=>(d(),u("div",{class:"chat-files__item",key:E},[l("span",null,[a(N,{class:"file-icon"})]),l("span",null,c(s?.name),1),l("button",{class:"close",onClick:De=>q(E)},[a(j)],8,Ee)]))),128))])])])):C("",!0),l("label",Ve,[e[12]||(e[12]=l("div",{class:"form-field__label"},null,-1)),l("div",Te,[l("input",{ref_key:"fileInput",ref:g,type:"file",onChange:$},null,544),l("div",Ge,[a(L),e[11]||(e[11]=l("span",{class:"tw-text-sm"},"Прикрепить файл",-1))])])]),l("div",Ie,[l("button",{class:"btn btn--blue btn-default",onClick:e[4]||(e[4]=s=>h())},e[13]||(e[13]=[l("span",{class:"tw-text-sm tw-min-w-32"},"Отправить",-1)]))])])],64)}}},Ke=ae(Ce,[["__scopeId","data-v-ce9d54a7"]]);export{Ke as default};
