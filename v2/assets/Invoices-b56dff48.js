import{k as ee,o as F,c as x,b as l,a as s,w as i,t as r,F as q,l as J,d as T,z as te,p as oe,m as ne,_ as se,u as ae,e as ie,f as ce,U as le,r as v,h as g}from"./index-400feb76.js";import{u as re}from"./postings-c4c6c79e.js";import{u as de}from"./contracts-d1f15c94.js";import{s as me}from"./multiselect-f4d64e06.js";import{S as K}from"./StatusBadge-9e94e9cc.js";import{I as Q}from"./IconDownload-1df3951b.js";import{I as W}from"./IconFile-3b17df5e.js";import{B as X}from"./BlockBalanceAgreement-9b1029a8.js";import{a as _e,f as ue}from"./useTimeFunction-8602dd60.js";import{E as pe}from"./EmptyStateBlock-d1623b92.js";import{z as ve,d as fe,C as Ie,F as be}from"./bootstrap-vue-next.es-03cca149.js";import{_ as De}from"./IconDots-af08ce2d.js";import{_ as ye}from"./IconCard-1439ea83.js";import{_ as Ce}from"./FormInputSearch-4b3080df.js";import{_ as ge}from"./ClausesKeeper-d8c25fea.js";import{_ as he}from"./ButtonDefault-7609cc9e.js";import"./IconArrow-10b76666.js";import"./IconPlus-8b0adc75.js";import"./IconSearch-cc35bac7.js";import"./IconClose-20ed8b3b.js";const ke=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Files",variant:"td-controls",label:""}],f=u=>(oe("data-v-47f1ceee"),u=u(),ne(),u),Se={class:"section"},Pe={class:"container"},Fe={class:"section-header"},Le={class:"list-form"},Ne={class:"list-form_col list-form_col--sm"},Be={class:"list-form_select"},Ve={class:"multiselect-option"},xe=f(()=>s("span",{class:"td-mobile"},"Платежная система",-1)),Te={class:"d-block"},Ue=f(()=>s("span",{class:"td-mobile"},"Дата Создания",-1)),Oe={class:"d-block"},Me=f(()=>s("span",{class:"td-mobile"},"Номер счета",-1)),Re={class:"d-block"},Ee=f(()=>s("span",{class:"td-mobile"},"Договор",-1)),je={class:"d-block"},Ae=f(()=>s("span",{class:"td-mobile"},"Статус",-1)),ze=f(()=>s("span",{class:"td-mobile"},"Сумма",-1)),He={class:"d-block"},Ge={class:"invoices__controls-wrapper"},Ze=["href"],qe={class:"invoices__download-button-wrapper"},Je={class:"invoices__download-text"},Ke={class:"btn__group"},Qe=["onClick"],We={class:"dropdown-button"},Xe={class:"btn btn--dots"},Ye=["href"],we={key:0,class:"table-controls"},$e=f(()=>s("span",{class:"text-success"},"First",-1)),et=f(()=>s("span",{class:"text-info"},"Last",-1)),tt={class:"multiselect-multiple-label"},ot={class:"multiselect-option"};function nt(u,n,G,o,h,p){var N,B;const U=X,O=he,M=ge,y=ee("Multiselect"),I=Ce,L=K,R=W,E=Q,b=ye,j=De,D=ve,k=fe,A=Ie,z=be,H=pe;return F(),x(q,null,[l(U),s("div",Se,[s("div",Pe,[s("div",Fe,[s("h1",{class:"section-title",onClick:n[0]||(n[0]=e=>o.reloadNow())},"Счета на оплату"),l(O,{onClick:n[1]||(n[1]=e=>o.createNewIncoice()),label:"Выписать новый счёт"})]),l(M),s("div",Le,[s("div",Ne,[s("div",Be,[l(y,{modelValue:o.select,"onUpdate:modelValue":n[2]||(n[2]=e=>o.select=e),options:o.getUsers,disabled:((N=o.getUsers)==null?void 0:N.length)<=1,label:"name"},{singlelabel:i(({value:e})=>[s("span",null,"# "+r(e.value.padStart(5,"0"))+" / "+r(e.name),1)]),option:i(({option:e})=>[s("div",Ve,"# "+r(e.value.padStart(5,"0"))+" / "+r(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l(I,{modelValue:o.search,"onUpdate:modelValue":n[3]||(n[3]=e=>o.search=e)},null,8,["modelValue"])]),((B=o.getFilteredOrders)==null?void 0:B.length)>0?(F(),x(q,{key:0},[l(A,{class:"basic-table",items:o.getFilteredOrders,fields:o.worksCompleteFields,"show-empty":!0,filter:o.search,"per-page":o.perPage,"current-page":o.currentPage,responsive:"","sort-by":o.sortBy,"onUpdate:sortBy":n[4]||(n[4]=e=>o.sortBy=e),"sort-desc":o.sortDesc,"onUpdate:sortDesc":n[5]||(n[5]=e=>o.sortDesc=e),"sort-direction":o.sortDirection,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:o.setPageToZero},{"cell(PaymentSystemName)":i(e=>[xe,s("span",Te,r(e.value),1)]),"cell(CreateDate)":i(e=>{var d;return[Ue,s("span",Oe,r(o.formNormalDate(o.secondToDate((d=e.item)==null?void 0:d.CreateDate))),1)]}),"cell(ID)":i(e=>[Me,s("span",Re,r(e.value),1)]),"cell(ContractID)":i(e=>{var d,_;return[Ee,s("span",je,"#"+r((d=e.item)==null?void 0:d.ContractID)+" / "+r((_=e.item)==null?void 0:_.Customer),1)]}),"cell(StatusID)":i(e=>[Ae,l(L,{status:e.value,"status-table":"Invoices",onClick:d=>{var _;return o.openHistoryStatuses((_=e.item)==null?void 0:_.ID)}},null,8,["status","onClick"])]),"cell(Summ)":i(e=>{var d;return[ze,s("span",He,r((d=e.item)==null?void 0:d.Summ)+" ₽",1)]}),"cell(Files)":i(e=>{var d,_,V,S;return[s("div",Ge,[e!=null&&e.value?(F(),x("a",{key:0,class:"invoices__download-button",href:o.getInvoicesPDFLink(e)},[s("div",qe,[l(R,{class:"invoices__download-icon"}),s("div",Je,"Счет №"+r((V=(_=e==null?void 0:e.value)==null?void 0:_[(d=Object.keys(e==null?void 0:e.value))==null?void 0:d[0]])==null?void 0:V.RowID),1),l(E,{class:"invoices__download-icon"})])],8,Ze)):J("",!0),s("div",Ke,[s("button",{class:"btn btn-default btn--border",onClick:C=>o.invoicePayment(e)},[l(b),s("p",null,r((S=e.item)!=null&&S.IsPosted?"ПОСМОТРЕТЬ":"ОПЛАТИТЬ"),1)],8,Qe),s("div",We,[l(k,{class:"dropdown-dots",right:""},{"button-content":i(()=>[s("div",Xe,[l(j)])]),default:i(()=>[l(D,null,{default:i(()=>[s("a",{href:o.getInvoicesTTFLink(e)},"Скачать в формате tiff",8,Ye)]),_:2},1024),l(D,{onClick:C=>o.switchPaymentSystem(e)},{default:i(()=>[T("Изменить счёт")]),_:2},1032,["onClick"]),l(D,{onClick:C=>o.invoicePayment(e)},{default:i(()=>[T("Оплатить")]),_:2},1032,["onClick"]),l(D,{onClick:C=>o.invoicesReject(e)},{default:i(()=>[T("Отменить")]),_:2},1032,["onClick"]),l(D,{onClick:C=>o.invoiceSetConditionally(e)},{default:i(()=>[T("Провести условно")]),_:2},1032,["onClick"])]),_:2},1024)])])])]}),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),o.filteredContractsLength>0?(F(),x("div",we,[l(z,{modelValue:o.currentPage,"onUpdate:modelValue":n[6]||(n[6]=e=>o.currentPage=e),"total-rows":o.filteredContractsLength,"per-page":o.perPage,"first-number":"","last-number":""},{"first-text":i(()=>[$e]),"last-text":i(()=>[et]),page:i(({page:e,active:d})=>[s("span",null,r((e-1)*o.perPage+1)+"-"+r(e*o.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),l(y,{class:"multiselect--white",modelValue:o.perPage,"onUpdate:modelValue":n[7]||(n[7]=e=>o.perPage=e),options:o.pageOptions,label:"name",openDirection:"top",onInput:n[8]||(n[8]=e=>o.currentPage=1)},{singlelabel:i(({value:e})=>[s("div",tt,[s("span",null,"Отображать "+r(e.value)+" строк",1)])]),option:i(({option:e})=>[s("div",ot,"Отображать "+r(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):J("",!0)],64)):(F(),te(H,{key:1,label:"Заказов не найдено"}))])])],64)}const st={components:{Multiselect:me,StatusBadge:K,IconDownload:Q,IconFile:W,BlockBalanceAgreement:X},async setup(){const u=de(),n=re(),G=ae(),o=ie(),h=ce(),p=le("emitter");p.on("updateInvoicesTable",()=>{n.fetchInvoices()});const U=v("CreateDate"),O=v(!0),M=v("desc"),y=v(""),I=v("*"),L=v(1),R=v(10),E=v([10,25,50,100]),b=g(()=>Object.keys(n==null?void 0:n.invoicesList).map(t=>{var a,c,m;return{...n==null?void 0:n.invoicesList[t],Customer:(c=(a=k.value)==null?void 0:a[n==null?void 0:n.invoicesList[t].ContractID])==null?void 0:c.Customer,Summ:Number((m=n==null?void 0:n.invoicesList[t])==null?void 0:m.Summ)}}).reverse()),j=g(()=>b.value.filter(a=>I.value!=="*"?Number(a.ContractID)===Number(I.value):!0)),D=g(()=>n==null?void 0:n.servicesList),k=g(()=>u.contractsList),A=g(()=>{let t=[];return b.value.map(a=>{if(!t.find(c=>c===a.Customer))return t.push(a.Customer),{value:a.ContractID,name:a.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),z=g(()=>b.value.filter(t=>{var a,c;return(t==null?void 0:t.PaymentSystemName.toLowerCase().includes((a=y.value)==null?void 0:a.toLowerCase()))||String(t==null?void 0:t.Summ).toLowerCase().includes((c=y.value)==null?void 0:c.toLowerCase())}).filter(t=>t.ContractID.includes(I.value!=="*"?I.value:"")).length);function H(){o.go(0)}function N(){L.value=1}function B(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsStamp=yes`}function e(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsTIFF=yes&IsStamp=yes`}function d(t){var a,c,m;p.emit("open-modal",{component:"AcceptConditionally",data:{ContractID:(a=t==null?void 0:t.item)==null?void 0:a.ContractID,RowsIDs:(c=t==null?void 0:t.item)==null?void 0:c.ID,AllowConditionallyMessage:(m=t==null?void 0:t.item)==null?void 0:m.AllowConditionallyMessage}})}function _(t){p.emit("open-modal",{component:"StatusHistory",data:{modeID:"Invoices",rowID:t}})}function V(t){var a,c,m,P,Z;p.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:(a=t==null?void 0:t.item)==null?void 0:a.ID,TypeID:(P=(m=k.value)==null?void 0:m[(c=t==null?void 0:t.item)==null?void 0:c.ContractID])==null?void 0:P.TypeID,Summ:(Z=t==null?void 0:t.item)==null?void 0:Z.Summ}})}function S(t){var a;n.InvoiceDocument({InvoiceID:(a=t.item)==null?void 0:a.ID}).then(c=>{var m;p.emit("open-modal",{component:"InvoiceDocument",data:{html:c,ID:(m=t.item)==null?void 0:m.ID}})})}function C(){p.emit("open-modal",{component:"NewInvoice"})}function Y(){}function w(){}function $(t){var c;let a=new FormData;a.append("ContractID","Default"),a.append("RowsIDs[]",(c=t.item)==null?void 0:c.ID),n.InvoicesReject(a).then(m=>{m==="SUCCESS"&&n.fetchInvoices()})}return window.FormGet=Y.bind(this),window.Mobile=w.bind(this),await u.fetchContracts(),await u.fetchProfiles(),await G.fetchConfig(),await n.fetchInvoices().then(()=>{var t,a;(t=h.params)!=null&&t.id&&((a=b.value)!=null&&a.find(m=>{var P;return m.ID===((P=h.params)==null?void 0:P.id)}))&&S({item:{ID:h.params.id}}),h.query.Error==="yes"&&p.emit("open-modal",{component:"InvoiceError"})}),await n.fetchServices(),{search:y,select:I,getContracts:k,getUsers:A,getOrders:b,getServices:D,currentPage:L,perPage:R,sortBy:U,sortDesc:O,sortDirection:M,pageOptions:E,filteredContractsLength:z,worksCompleteFields:ke,getFilteredOrders:j,invoicePayment:S,invoicesReject:$,switchPaymentSystem:V,setPageToZero:N,secondToDate:_e,formNormalDate:ue,getInvoicesTTFLink:e,getInvoicesPDFLink:B,createNewIncoice:C,invoiceSetConditionally:d,openHistoryStatuses:_,reloadNow:H}}},St=se(st,[["render",nt],["__scopeId","data-v-47f1ceee"]]);export{St as default};
