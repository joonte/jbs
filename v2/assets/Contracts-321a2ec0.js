import{_ as le}from"./FormInputSearch-4c769092.js";import{_ as re}from"./ClausesKeeper-eb954229.js";import{_ as ce}from"./ButtonDefault-7c216fc6.js";import{_ as U,o as L,c as R,b as l,a as e,m as ie,r as h,i as q,w as s,t as f,M as w,k as W,p as G,l as z,e as Y,u as X,S as J,g as B,h as _e,j as ue,ao as Z,y as j,d as H,a7 as de,ag as Q,F as pe}from"./index-5e313302.js";import{u as K}from"./contracts-3351d68f.js";import{S as me}from"./SlotPageTitle-9e8de2b4.js";import{F as ve}from"./FormTabs-ead5a058.js";import{F as fe,f as be,z as ge,d as ye,C as ee}from"./bootstrap-vue-next.es-a19a8b41.js";import{_ as Ce}from"./IconDots-f060bcd6.js";import{S as te}from"./StatusBadge-98696de1.js";import{f as he,a as Ie}from"./useTimeFunction-8602dd60.js";/* empty css                                                                       */import{_ as ke}from"./IconCard-67ad5f17.js";import{s as De}from"./multiselect-bfc29db8.js";import{B as Te}from"./BlockBalanceAgreement-bb87adc1.js";import"./IconPlus-856cd9b9.js";import"./IconSearch-5f35739d.js";import"./IconClose-1f889a2e.js";import"./IconArrow-555f9d45.js";const $e=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"Customer",label:"Договор"},{key:"TypeID",label:"Тип",variant:"td-gray td-order"},{key:"Orders",label:"Количество подключенных услуг",sortable:!0,variant:"td-gray td-order"},{key:"Balance",label:"Баланс",sortable:!0,variant:"td-gray td-order"},{key:"IsHidden",label:"Скрыт ?",variant:"td-gray td-order"},{key:"Status",label:"Статус",variant:"td-gray td-order"},{key:"controls",label:"",variant:"td-controls"}];const Se={class:"button-payment"},Pe={class:"button-payment__text"},Le={__name:"FormButtonPayment",setup(_){return(b,m)=>(L(),R("button",Se,[l(ke,{class:"button-payment__icon"}),e("span",Pe,[ie(b.$slots,"default",{},void 0,!0)])]))}},xe=U(Le,[["__scopeId","data-v-fcb8fa3c"]]);const oe=_=>(G("data-v-64d83888"),_=_(),z(),_),we={key:0,class:"table-controls"},Be=oe(()=>e("span",{class:"text-success"},"First",-1)),Ve=oe(()=>e("span",{class:"text-info"},"Last",-1)),Fe={class:"multiselect-multiple-label"},Ne={class:"multiselect-option"},Ee={__name:"PaginationBlock",props:["modelValue","total_rows"],emits:["update:modelValue","updatePage"],setup(_,{emit:b}){const m=_,r=[10,25,50,100],c=h({current_page:1,per_page:10});return q(c.value,()=>{b("updatePage",c.value)}),($,y)=>{const S=fe;return m.total_rows>0?(L(),R("div",we,[l(S,{modelValue:c.value.current_page,"onUpdate:modelValue":y[0]||(y[0]=d=>c.value.current_page=d),"total-rows":m.total_rows,"per-page":c.value.per_page,"first-number":"","last-number":""},{"first-text":s(()=>[Be]),"last-text":s(()=>[Ve]),page:s(({page:d,active:v})=>[e("span",null,f((d-1)*c.value.per_page+1)+"-"+f(d*c.value.per_page),1)]),_:1},8,["modelValue","total-rows","per-page"]),l(w(De),{class:"multiselect--white",modelValue:c.value.per_page,"onUpdate:modelValue":y[1]||(y[1]=d=>c.value.per_page=d),options:r,label:"name",openDirection:"top",onInput:y[2]||(y[2]=d=>c.value.current_page=1)},{singlelabel:s(({value:d})=>[e("div",Fe,[e("span",null,"Отображать "+f(d.value)+" строк",1)])]),option:s(({option:d})=>[e("div",Ne,"Отображать "+f(d.name)+" строк",1)]),_:1},8,["modelValue"])])):W("",!0)}}},se=U(Ee,[["__scopeId","data-v-64d83888"]]);const x=_=>(G("data-v-3779134c"),_=_(),z(),_),He={class:"contracts-list"},Ue=x(()=>e("span",{class:"td-mobile"},"Номер",-1)),Re={class:"td-column-heavy"},Oe={class:"table-td-gray"},Ae=x(()=>e("span",{class:"td-mobile"},"Дата Создания",-1)),Me={class:"d-block"},je=x(()=>e("span",{class:"td-mobile"},"Договор",-1)),qe={class:"td-column-heavy"},Ge={class:"table-td-blue"},ze=x(()=>e("span",{class:"td-mobile"},"Тип договора",-1)),Ye=x(()=>e("span",{class:"td-mobile"},"Баланс",-1)),Je=x(()=>e("span",{class:"td-mobile"},"Скрыт ?",-1)),Ke=x(()=>e("span",{class:"td-mobile"},"Статус",-1)),Qe=x(()=>e("span",{class:"td-mobile"},"Количество подключенных услуг",-1)),We={class:"btn__group"},Xe={class:"dropdown-button"},Ze={class:"btn btn--dots"},et={__name:"ContractsList",props:{search:{type:String,default:""}},setup(_){const b=_,m=Y(),r=K(),c=X(),$=J("emitter"),y=h("CreateDate"),S=h(!0),d=h("desc"),v=h(10),I=h(1);h(!1);const V=t=>{r.booleanEdit({TableID:"Contracts",ColumnID:"IsHidden",RowID:t.ID}).then(()=>{r.fetchContracts()})},F=B(()=>{var t,u;return(u=(t=Object.keys(r==null?void 0:r.contractsList))==null?void 0:t.map(P=>r==null?void 0:r.contractsList[P]))==null?void 0:u.reverse()}),N=B(()=>{var t,u;return(u=(t=c.ConfigList)==null?void 0:t.Contracts)==null?void 0:u.Types}),E=B(()=>{var t;return(t=F.value.filter(u=>{var P;return u.Customer.toLowerCase().includes(((P=b.search)==null?void 0:P.toLowerCase())||"")}))==null?void 0:t.length});function A(t){$.emit("open-modal",{component:"StatusHistory",data:{modeID:"Contracts",rowID:t}})}function D(t){m.push(`/Balance/${t}`)}_e(()=>{});function a(t={}){v.value=t==null?void 0:t.per_page,I.value=t==null?void 0:t.current_page}function i(t){r==null||r.contractDownload({ContractID:t})}return q(()=>b,()=>{I.value=1}),(t,u)=>{const P=be,p=te,g=Ce,T=ue("router-link"),M=ge,ae=ye,ne=ee;return L(),R("div",He,[l(ne,{class:"basic-table",items:F.value,fields:w($e),"show-empty":!0,filterable:[],filter:b.search,"per-page":v.value,"sort-desc":S.value,"onUpdate:sortDesc":u[0]||(u[0]=o=>S.value=o),"sort-by":y.value,"onUpdate:sortBy":u[1]||(u[1]=o=>y.value=o),"sort-direction":d.value,"current-page":I.value,"empty-text":"У вас пока нет договоров.","empty-filtered-text":"Договора не найдены."},{"cell(ID)":s(o=>{var n;return[Ue,e("div",Re,[e("div",Oe,f(w(Z).transformContractNumber((n=o.item)==null?void 0:n.ID)),1)])]}),"cell(CreateDate)":s(o=>{var n;return[Ae,e("span",Me,f(w(he)(w(Ie)((n=o.item)==null?void 0:n.CreateDate))),1)]}),"cell(Customer)":s(o=>{var n;return[je,e("div",qe,[e("div",Ge,f((n=o.item)==null?void 0:n.Customer),1)])]}),"cell(TypeID)":s(o=>{var n,C;return[ze,e("span",null,f((C=N.value[(n=o.item)==null?void 0:n.TypeID])==null?void 0:C.Name),1)]}),"cell(Balance)":s(o=>{var n;return[Ye,e("span",null,f((n=o.item)==null?void 0:n.Balance)+" ₽",1)]}),"cell(IsHidden)":s(o=>{var n,C;return[Je,l(P,{class:"rule-checkbox",name:"checkbox",checked:(n=o.item)==null?void 0:n.IsHidden,modelValue:o.item.IsChecked,"onUpdate:modelValue":k=>o.item.IsChecked=k,onChange:k=>V(o.item)},null,8,["checked","modelValue","onUpdate:modelValue","onChange"]),e("span",null,f(((C=o.item)==null?void 0:C.IsHidden)===!0?"Да":"Нет"),1)]}),"cell(Status)":s(o=>{var n;return[Ke,l(p,{status:(n=o.item)==null?void 0:n.StatusID,"status-table":"Contracts",onClick:C=>{var k;return A((k=o.item)==null?void 0:k.ID)}},null,8,["status","onClick"])]}),"cell(Orders)":s(o=>{var n;return[Qe,e("span",null,f((n=o.item)==null?void 0:n.Orders),1)]}),"cell(controls)":s(o=>{var n;return[e("div",We,[((n=o.item)==null?void 0:n.TypeID)!="NaturalPartner"?(L(),j(xe,{key:0,onClick:C=>{var k;return D((k=o.item)==null?void 0:k.ID)}},{default:s(()=>[H("Пополнить баланс")]),_:2},1032,["onClick"])):W("",!0),e("div",Xe,[l(ae,{class:"dropdown-dots",right:""},{"button-content":s(()=>[e("div",Ze,[l(g)])]),default:s(()=>[l(M,null,{default:s(()=>{var C;return[l(T,{to:`/ContractScheme/${(C=o.item)==null?void 0:C.ID}`},{default:s(()=>[H("Открыть")]),_:2},1032,["to"])]}),_:2},1024),l(M,null,{default:s(()=>{var C;return[l(T,{to:`/ContractSettings/${(C=o.item)==null?void 0:C.ID}`},{default:s(()=>[H("Изменить тип учёта")]),_:2},1032,["to"])]}),_:2},1024),l(M,{onClick:C=>{var k;return i((k=o.item)==null?void 0:k.ID)}},{default:s(()=>[H("Загрузить договор")]),_:2},1032,["onClick"])]),_:2},1024)])])]}),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(se,{total_rows:E.value,onUpdatePage:a},null,8,["total_rows"])])}}},tt=U(et,[["__scopeId","data-v-3779134c"]]),ot=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"Name",label:"Профиль",variant:"td-blue"},{key:"TemplateID",label:"Тип",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",sortable:!0,variant:"td-gray td-order"},{key:"StatusDate",label:"От статуса",sortable:!0,variant:"td-default td-order"}];const O=_=>(G("data-v-55858f0b"),_=_(),z(),_),st={class:"contracts-profile-list"},at=O(()=>e("span",{class:"td-mobile"},"Номер",-1)),nt={class:"d-block"},lt=O(()=>e("span",{class:"td-mobile"},"Номер",-1)),rt=O(()=>e("span",{class:"td-mobile"},"От статуса",-1)),ct={class:"d-block"},it=O(()=>e("span",{class:"td-mobile"},"Тип",-1)),_t=O(()=>e("span",{class:"td-mobile"},"Статус",-1)),ut={__name:"ContractsProfileList",props:["search"],setup(_){const b=_;Y();const m=K(),r=X(),c=J("emitter"),$=h("ID"),y=h(!0),S=h("desc"),d=h(10),v=h(1),I=B(()=>{var a,i;return(i=(a=Object==null?void 0:Object.keys(m==null?void 0:m.profileList))==null?void 0:a.map(t=>m==null?void 0:m.profileList[t]))==null?void 0:i.reverse()}),V=B(()=>{var a,i;return(i=(a=r.ConfigList)==null?void 0:a.Profiles)==null?void 0:i.Templates}),F=B(()=>{var a;return(a=I.value.filter(i=>{var t;return i.Name.toLowerCase().includes(((t=b.search)==null?void 0:t.toLowerCase())||"")}))==null?void 0:a.length});function N(a={}){d.value=a==null?void 0:a.per_page,v.value=a==null?void 0:a.current_page}function E(a,i){i.target.closest("button, a, .clickable-element")||c.emit("open-modal",{component:"ProfileInfo",data:{data:a,template:V.value[a.TemplateID]}})}function A(a){return Math.floor((new Date().getTime()-a*1e3)/(1e3*60*60*24))}function D(a){c.emit("open-modal",{component:"StatusHistory",data:{modeID:"Profiles",rowID:a}})}return(a,i)=>{const t=te,u=ee,P=se;return L(),R("div",st,[l(u,{class:"basic-table",items:I.value,fields:w(ot),"show-empty":!0,filterable:[],filter:b.search,"per-page":d.value,"sort-desc":y.value,"onUpdate:sortDesc":i[0]||(i[0]=p=>y.value=p),"sort-by":$.value,"onUpdate:sortBy":i[1]||(i[1]=p=>$.value=p),"sort-direction":S.value,"current-page":v.value,"empty-text":"У вас пока нет профилей.","empty-filtered-text":"Профили не найдены.",onRowClicked:i[2]||(i[2]=(p,g,T)=>E(p,T))},{"cell(ID)":s(p=>{var g;return[at,e("span",nt,f(w(Z).transformContractNumber((g=p.item)==null?void 0:g.ID)),1)]}),"cell(Name)":s(p=>{var g;return[lt,e("span",null,f((g=p.item)==null?void 0:g.Name),1)]}),"cell(StatusDate)":s(p=>{var g;return[rt,e("span",ct,f(A((g=p.item)==null?void 0:g.StatusDate))+" дн.",1)]}),"cell(TemplateID)":s(p=>{var g,T;return[it,e("span",null,f((T=V.value[(g=p.item)==null?void 0:g.TemplateID])==null?void 0:T.Name),1)]}),"cell(StatusID)":s(p=>[_t,l(t,{class:"clickable-element",status:p.value,"status-table":"Profiles",onClick:g=>{var T;return D((T=p.item)==null?void 0:T.ID)}},null,8,["status","onClick"])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(P,{total_rows:F.value,onUpdatePage:N},null,8,["total_rows"])])}}},dt=U(ut,[["__scopeId","data-v-55858f0b"]]);const pt={class:"section"},mt={class:"container"},vt={class:"list-form"},ft={class:"contracts__page"},bt={__name:"Contracts",async setup(_){var N,E;let b,m;const r=de(),c=Y(),$=K(),y=J("emitter"),S=[{value:"Contracts",name:"Договора"},{value:"Profiles",name:"Профили"}],d=B(()=>v.value==="Contracts"?"Договора":"Профили"),v=h("Contracts"),I=h("");function V(){v.value==="Contracts"?c.push({path:"/ContractMake"}):c.push({path:"/ProfileMake"})}function F(){y.emit("open-modal",{component:"FundsTransfer"})}return(N=r==null?void 0:r.query)!=null&&N.section?v.value=(E=r.query)==null?void 0:E.section:c.replace({query:{section:"Contracts"}}),q(v,()=>{c.replace({query:{section:v.value}})}),[b,m]=Q(()=>$.fetchContracts()),await b,m(),[b,m]=Q(()=>$.fetchProfiles()),await b,m(),(A,D)=>{const a=ce,i=re,t=le;return L(),R(pe,null,[l(Te),e("div",pt,[e("div",mt,[l(ve,{tabs:S,modelValue:v.value,"onUpdate:modelValue":D[0]||(D[0]=u=>v.value=u)},null,8,["modelValue"]),l(me,null,{title:s(()=>[H(f(d.value),1)]),buttons:s(()=>[l(a,{label:"Перевод средств",onClick:D[1]||(D[1]=u=>F())}),l(a,{label:v.value==="Contracts"?"Создать договор":"Создать профиль",onClick:V},null,8,["label"])]),_:1}),l(i),e("div",vt,[l(t,{modelValue:I.value,"onUpdate:modelValue":D[2]||(D[2]=u=>I.value=u)},null,8,["modelValue"])]),e("div",ft,[v.value==="Contracts"?(L(),j(tt,{key:0,search:I.value},null,8,["search"])):(L(),j(dt,{key:1,search:I.value},null,8,["search"]))])])])],64)}}},Ht=U(bt,[["__scopeId","data-v-78dadc77"]]);export{Ht as default};
