import{q as G,r as p,a2 as D,a3 as x,j as E,o as g,c as b,b as v,w as _,a as n,t as f,k as w,F as k,y as P,_ as B,g as C,Z as H,af as J,p as L,l as S,e as O,h as V,O as Q,n as I,a7 as W}from"./index-5e313302.js";import{u as X}from"./promoStore-fc4c0282.js";import{s as A}from"./multiselect-bfc29db8.js";import{a as M,f as R}from"./useTimeFunction-8602dd60.js";import{E as T}from"./EmptyStateBlock-9f752916.js";import{C as N,F}from"./bootstrap-vue-next.es-a19a8b41.js";import{_ as Y}from"./ButtonDefault-7c216fc6.js";import{B as j}from"./BlockBalanceAgreement-bb87adc1.js";import{_ as $}from"./ClausesKeeper-eb954229.js";import"./contracts-3351d68f.js";import"./IconArrow-555f9d45.js";import"./IconClose-1f889a2e.js";const h=G("bonuses",()=>{const t=p(null),o=p(null);async function m(l){await D.post(""+x.fetchBonuses,l).then(a=>{a!=null&&a.data&&(t.value=a.data)})}async function e(l){await D.post(""+x.fetchPromos,l).then(a=>{a!=null&&a.data&&(o.value=a.data)})}async function c(l){let a="ERROR",i=null;return await D.post(""+x.PromoCodesActivate,l).then(d=>{var u;((u=d==null?void 0:d.data)==null?void 0:u.Status)==="Ok"&&(a="SUCCESS")}),{result:a,error:i}}return{bonusesList:t,promosList:o,fetchBonuses:m,fetchPromos:e,PromoCodesActivate:c}}),ee=[{key:"CreateDate",label:"Дата создания",variant:"td-gray",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray",sortable:!0},{key:"Display",label:"Тариф/Группа",variant:"td-blue"},{key:"DaysRemainded",label:"Дней осталось",sortable:!0},{key:"Discont",variant:"td-controls",label:"Скидка"},{key:"Comment",label:"Комментарий",variant:"td-gray"}],te=n("span",null,null,-1),oe=n("span",null,null,-1),se={key:0,class:"table-controls"},ne=n("span",{class:"text-success"},"First",-1),ae=n("span",{class:"text-info"},"Last",-1),re={class:"multiselect-multiple-label"},le={class:"multiselect-option"};function ce(t,o,m,e,c,l){const a=N,i=F,d=E("Multiselect"),u=T;return e.getBonuses?(g(),b(k,{key:0},[te,oe,v(a,{class:"basic-table",items:e.getBonuses,fields:e.bonusesTable,"show-empty":!0,"per-page":e.perPage,"current-page":e.currentPage,"empty-text":"Бонусов пока нет.","empty-filtered-text":"Бонусов не найдены.","sort-desc":e.sortDesc,"onUpdate:sortDesc":o[0]||(o[0]=s=>e.sortDesc=s),"sort-by":e.sortBy,"onUpdate:sortBy":o[1]||(o[1]=s=>e.sortBy=s),"sort-direction":e.sortDirection},{"cell(CreateDate)":_(s=>[n("span",null,f(e.formNormalDate(e.secondToDate(s==null?void 0:s.value))),1)]),"cell(ExpirationDate)":_(s=>[n("span",null,f(e.formNormalDate(e.secondToDate(s==null?void 0:s.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),e.getBonusesLength>0?(g(),b("div",se,[v(i,{modelValue:e.currentPage,"onUpdate:modelValue":o[2]||(o[2]=s=>e.currentPage=s),"total-rows":e.getBonusesLength,"per-page":e.perPage,"first-number":"","last-number":""},{"first-text":_(()=>[ne]),"last-text":_(()=>[ae]),page:_(({page:s,active:r})=>[n("span",null,f((s-1)*e.perPage+1)+"-"+f(s*e.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),v(d,{class:"multiselect--white",modelValue:e.perPage,"onUpdate:modelValue":o[3]||(o[3]=s=>e.perPage=s),options:e.pageOptions,label:"name",openDirection:"top",onInput:o[4]||(o[4]=s=>e.currentPage=1)},{singlelabel:_(({value:s})=>[n("div",re,[n("span",null,"Отображать "+f(s.value)+" строк",1)])]),option:_(({option:s})=>[n("div",le,"Отображать "+f(s.name)+" строк",1)]),_:1},8,["modelValue","options"])])):w("",!0)],64)):(g(),P(u,{key:1,label:"Бонусов не найдено"}))}const ie={components:{Multiselect:A},setup(){const t=h(),o=p("CreateDate"),m=p(!0),e=p("desc"),c=p(1),l=p(10),a=p([10,25,50,100]),i=C(()=>{var s;return(s=Object.keys(t==null?void 0:t.bonusesList))==null?void 0:s.map(r=>t==null?void 0:t.bonusesList[r])}),d=C(()=>{var s;return(s=Object.keys(t==null?void 0:t.bonusesList))==null?void 0:s.length});function u(){c.value=1}return{bonusesTable:ee,sortBy:o,sortDesc:m,sortDirection:e,currentPage:c,perPage:l,pageOptions:a,setPageToZero:u,getBonuses:i,getBonusesLength:d,secondToDate:M,formNormalDate:R}}},q=B(ie,[["render",ce]]),de=[{key:"CreateDate",label:"Дата активации",variant:"td-gray",sortable:!0},{key:"ApplyTo",label:"Тариф/Группа",variant:"td-blue"},{key:"PromoCode",label:"Промокод"}],me=t=>(L("data-v-7d214ff9"),t=t(),S(),t),pe={class:"promo-field"},ue=me(()=>n("div",{class:"promo-field-text"},"Промокод",-1)),_e={class:"promo-field-input form-field"};function ge(t,o,m,e,c,l){const a=Y;return g(),b("div",pe,[ue,n("div",_e,[H(n("input",{type:"text",name:"promo-code","onUpdate:modelValue":o[0]||(o[0]=i=>e.promoInput=i)},null,512),[[J,e.promoInput]])]),v(a,{"is-loading":e.isLoading,label:"Применить",onClick:o[1]||(o[1]=i=>e.activatePromo())},null,8,["is-loading"])])}const fe={props:{promoCode:{type:String,default:""}},emits:["update"],setup(t,{emit:o}){const m=h(),e=O(),c=p(!1),l=p("");function a(){l.value.length>0&&(c.value=!0,m.PromoCodesActivate({Code:l.value}).then(i=>{const{result:d}=i;d==="SUCCESS"&&o("update"),c.value=!1}))}return V(()=>{e.currentRoute.value.query.PromoCode?(l.value=e.currentRoute.value.query.PromoCode,a()):t.promoCode&&(l.value=t.promoCode),console.log(e)}),{isLoading:c,promoInput:l,activatePromo:a,router:e}}},Z=B(fe,[["render",ge],["__scopeId","data-v-7d214ff9"]]),U=t=>(L("data-v-5617c0ed"),t=t(),S(),t),ve={class:"promo-block block--wrapper"},ye=U(()=>n("div",{class:"promo-text"},"Активировать промокод",-1)),be={key:0,class:"table-controls"},Pe=U(()=>n("span",{class:"text-success"},"First",-1)),ke=U(()=>n("span",{class:"text-info"},"Last",-1)),Ce={class:"multiselect-multiple-label"},Be={class:"multiselect-option"};function he(t,o,m,e,c,l){const a=Z,i=N,d=F,u=E("Multiselect"),s=T;return g(),b(k,null,[n("div",ve,[ye,v(a,{onUpdate:o[0]||(o[0]=r=>e.updatePromos()),promoCode:m.promoCode},null,8,["promoCode"])]),e.getPromos?(g(),b(k,{key:0},[v(i,{class:"basic-table",items:e.getPromos,fields:e.promosTable,"show-empty":!0,"per-page":e.perPage,"current-page":e.currentPage,"empty-text":"Промокодов пока нет.","empty-filtered-text":"Промокоды не найдены.","sort-desc":e.sortDesc,"onUpdate:sortDesc":o[1]||(o[1]=r=>e.sortDesc=r),"sort-by":e.sortBy,"onUpdate:sortBy":o[2]||(o[2]=r=>e.sortBy=r),"sort-direction":e.sortDirection},{"cell(CreateDate)":_(r=>[n("span",null,f(e.formNormalDate(e.secondToDate(r==null?void 0:r.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),e.getPromosLength>0?(g(),b("div",be,[v(d,{modelValue:e.currentPage,"onUpdate:modelValue":o[3]||(o[3]=r=>e.currentPage=r),"total-rows":e.getPromosLength,"per-page":e.perPage,"first-number":"","last-number":""},{"first-text":_(()=>[Pe]),"last-text":_(()=>[ke]),page:_(({page:r,active:y})=>[n("span",null,f((r-1)*e.perPage+1)+"-"+f(r*e.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),v(u,{class:"multiselect--white",modelValue:e.perPage,"onUpdate:modelValue":o[4]||(o[4]=r=>e.perPage=r),options:e.pageOptions,label:"name",openDirection:"top",onInput:o[5]||(o[5]=r=>e.currentPage=1)},{singlelabel:_(({value:r})=>[n("div",Ce,[n("span",null,"Отображать "+f(r.value)+" строк",1)])]),option:_(({option:r})=>[n("div",Be,"Отображать "+f(r.name)+" строк",1)]),_:1},8,["modelValue","options"])])):w("",!0)],64)):(g(),P(s,{key:1,label:"Промокоды не найдены"}))],64)}const De={components:{ActivatePromo:Z,Multiselect:A},props:{promoCode:{type:String,default:""}},setup(){const t=h(),o=p("CreateDate"),m=p(!0),e=p("desc"),c=p(1),l=p(10),a=p([10,25,50,100]),i=C(()=>{var y;return(y=Object.keys(t==null?void 0:t.promosList))==null?void 0:y.map(z=>t==null?void 0:t.promosList[z])}),d=C(()=>{var y;return(y=Object.keys(t==null?void 0:t.promosList))==null?void 0:y.length});function u(){c.value=1}function s(){t.fetchBonuses(),t.fetchPromos()}const r=y=>{y.key==="Enter"&&y.ctrlKey&&s()};return V(()=>{document.addEventListener("keyup",r)}),Q(()=>{document.removeEventListener("keyup",r)}),{promosTable:de,sortBy:o,sortDesc:m,sortDirection:e,currentPage:c,perPage:l,pageOptions:a,setPageToZero:u,getPromos:i,getPromosLength:d,secondToDate:M,formNormalDate:R,updatePromos:s}}},K=B(De,[["render",he],["__scopeId","data-v-5617c0ed"]]),xe=t=>(L("data-v-8e58387d"),t=t(),S(),t),Le={class:"section"},Se={class:"container"},Ve=xe(()=>n("div",{class:"section-header"},[n("h1",{class:"section-title"},"Бонусы и промокоды")],-1)),Te={class:"section-header"},Ue={class:"section-nav"};function Ie(t,o,m,e,c,l){const a=j,i=$,d=q,u=K,s=T;return g(),b(k,null,[v(a),n("div",Le,[n("div",Se,[Ve,v(i),n("div",Te,[n("div",Ue,[n("div",{class:I(["section-nav__item",{"section-link":!0,"section-link-active":e.section==="bonuses"}]),onClick:o[0]||(o[0]=r=>e.switchToSection("bonuses"))},"Бонусы",2),n("div",{class:I(["section-nav__item",{"section-link":!0,"section-link-active":e.section==="promos"}]),onClick:o[1]||(o[1]=r=>e.switchToSection("promos"))},"Промокоды",2)])]),e.section==="bonuses"?(g(),P(d,{key:0})):e.section==="promos"?(g(),P(u,{key:1,promoCode:e.promoCode},null,8,["promoCode"])):(g(),P(s,{key:2,label:"Секция не найдена"}))])])],64)}const Ee={components:{BonusesBlock:q,PromosBlock:K,BlockBalanceAgreement:j},async setup(){const t=h(),o=X(),m=p("bonuses"),e=O(),c=W(),l=o.promoCode;function a(i){e.replace(`/Bonuses?section=${i}`),m.value=i}return V(()=>{var i,d;l&&t.PromoCodesActivate({Code:l}).then(u=>{const{result:s}=u;s==="SUCCESS"&&emit("update"),e.replace("/Bonuses?section=promos"),m.value="promos"}),(i=c==null?void 0:c.query)!=null&&i.section?m.value=(d=c==null?void 0:c.query)==null?void 0:d.section:e.replace("/Bonuses?section=bonuses")}),await t.fetchBonuses(),await t.fetchPromos(),{section:m,switchToSection:a,promoCode:l}}},Ge=B(Ee,[["render",Ie],["__scopeId","data-v-8e58387d"]]);export{Ge as default};
