import{_ as ct}from"./EmptyStateBlock-BaR9js3E.js";import{L as ut,a as dt,v as pt,r as vt}from"./bootstrap-vue-next-DwS3lKQb.js";import{_ as _t}from"./IconDots-hRD0_8ej.js";import{_ as ft}from"./IconCard-_anr564X.js";import{R as It,c as S,o as D,n as yt,L as bt,ao as Dt,x as Ct,r as c,f,D as g,b as a,a as n,C as wt,w as s,v as b,F as R,h as gt,d as St,g as kt,t as l,e as $,W as U}from"./index-CmCGXBst.js";import{_ as xt}from"./IconDownload-B1Yh9ot7.js";import{_ as Bt}from"./StatusBadge-CjHHKSUG.js";import{_ as $t}from"./FormInputSearch-BN5nl3dB.js";import{_ as Lt}from"./ClausesKeeper-CTja-fCz.js";import{_ as Nt}from"./ButtonDefault-BIBStZbJ.js";import{_ as Vt,f as Pt}from"./BlockBalanceAgreement-qtspRQ_B.js";import{u as Ft}from"./postings-CAwWnBGE.js";import{u as Tt}from"./contracts-P7YPBhEI.js";import{s as h}from"./multiselect-DhoC9bwZ.js";import{f as Et,s as Rt}from"./time-DenPiOX5.js";import{_ as Ut}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-BicE38kO.js";import"./IconClose-B_k4TzXM.js";const ht=It({__name:"SimpleButton",props:{type:{}},setup(A){return(i,m)=>(D(),S("button",{class:yt(["tw-h-8 tw-px-2 tw-flex tw-items-center tw-gap-2 tw-text-2xs tw-font-bold tw-uppercase tw-border tw-rounded hover:tw-text-sky-400",i.type==="cancel"?"tw-text-red-500":"tw-text-gray-800"])},[bt(i.$slots,"default")],2))}}),At={class:"tw-px-4 md:tw-px-8"},Ot={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},jt={class:"list-form"},Mt={class:"list-form_col list-form_col--sm"},zt={class:"list-form_select"},Ht={class:"multiselect-option"},Wt={class:"d-block"},qt={class:"d-block"},Zt={class:"d-block"},Gt={class:"d-block"},Jt={class:"d-block"},Kt=["href"],Qt={key:0,class:"table-controls"},Xt={class:"multiselect-multiple-label"},Yt={class:"multiselect-option"},te={__name:"Invoices",async setup(A){let i,m;const k=Tt(),r=Ft();Dt();const O=St(),C=kt(),u=Ct("emitter"),j=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Button1",variant:"td-controls",label:""},{key:"Button2",variant:"td-controls",label:""},{key:"Button3",variant:"td-controls",label:""},{key:"Button4",variant:"td-controls",label:""}];u.on("updateInvoicesTable",()=>{r.fetchInvoices()});const L=c("CreateDate"),N=c(!0),M=c("desc"),I=c(""),d=c("*"),y=c(1),p=c(10),z=c([10,25,50,100]),w=f(()=>Object.keys(r?.invoicesList).map(o=>({...r?.invoicesList[o],Customer:P.value?.[r?.invoicesList[o].ContractID]?.Customer,Summ:Number(r?.invoicesList[o]?.Summ)})).reverse()),V=f(()=>w.value.filter(t=>d.value!=="*"?Number(t.ContractID)===Number(d.value):!0));f(()=>r?.servicesList);const P=f(()=>k.contractsList),F=f(()=>{let o=[];return w.value.map(t=>{if(!o.find(v=>v===t.Customer))return o.push(t.Customer),{value:t.ContractID,name:t.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),T=f(()=>w.value.filter(o=>o?.PaymentSystemName.toLowerCase().includes(I.value?.toLowerCase())||String(o?.Summ).toLowerCase().includes(I.value?.toLowerCase())).filter(o=>String(o.ContractID).includes(d.value!=="*"?d.value:"")).length);function H(){O.go(0)}function W(){y.value=1}function q(o){window.location=`${U}/InvoiceDownload?InvoiceID=${o?.item?.ID}&IsStamp=yes`}function Z(o){return`${U}/InvoiceDownload?InvoiceID=${o?.item?.ID}&IsTIFF=yes&IsStamp=yes`}function G(o){u.emit("open-modal",{component:"AcceptConditionally",data:{ContractID:o?.item?.ContractID,RowsIDs:o?.item?.ID,AllowConditionallyMessage:o?.item?.AllowConditionallyMessage}})}function J(o){u.emit("open-modal",{component:"StatusHistory",data:{modeID:"Invoices",rowID:o}})}function K(o){u.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:o?.item?.ID,TypeID:P.value?.[o?.item?.ContractID]?.TypeID,Summ:o?.item?.Summ,PaymentSystemID:o.item.PaymentSystemID}})}function E(o){r.InvoiceDocument({InvoiceID:o.item?.ID}).then(t=>{u.emit("open-modal",{component:"InvoiceDocument",data:{html:t,ID:o.item?.ID}})})}function Q(){u.emit("open-modal",{component:"NewInvoice"})}function X(o){let t=new FormData;t.append("ContractID","Default"),t.append("RowsIDs[]",o.item?.ID),r.InvoicesReject(t).then(v=>{v==="SUCCESS"&&r.fetchInvoices()})}return[i,m]=g(()=>k.fetchContracts()),await i,m(),[i,m]=g(()=>k.fetchProfiles()),await i,m(),[i,m]=g(()=>r.fetchInvoices().then(()=>{C.params?.id&&w.value?.find(t=>t.ID===C.params?.id)&&E({item:{ID:C.params.id}}),C.query.Error==="yes"&&u.emit("open-modal",{component:"InvoiceError"})})),await i,m(),[i,m]=g(()=>r.fetchServices()),await i,m(),(o,t)=>{const v=Vt,Y=Nt,tt=Lt,et=$t,ot=Bt,nt=xt,x=ht,st=ft,at=_t,B=vt,lt=pt,it=ut,rt=dt,mt=ct;return D(),S(R,null,[a(v),n("div",At,[n("div",Ot,[n("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:t[0]||(t[0]=e=>H())},"Счета на оплату"),a(Y,{onClick:t[1]||(t[1]=e=>Q()),label:"Выписать новый счёт"})]),a(tt),n("div",jt,[n("div",Mt,[n("div",zt,[a(b(h),{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),options:F.value,disabled:F.value?.length<=1,label:"name"},{singlelabel:s(({value:e})=>[n("span",null,"# "+l(String(e.value).padStart(5,"0"))+" / "+l(e.name),1)]),option:s(({option:e})=>[n("span",Ht,"# "+l(String(e.value).padStart(5,"0"))+" / "+l(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a(et,{modelValue:I.value,"onUpdate:modelValue":t[3]||(t[3]=e=>I.value=e)},null,8,["modelValue"])]),V.value?.length>0?(D(),S(R,{key:0},[a(it,{class:"basic-table",items:V.value,fields:j,"show-empty":!0,filter:I.value,"per-page":p.value,"current-page":y.value,responsive:"","sort-by":L.value,"onUpdate:sortBy":t[4]||(t[4]=e=>L.value=e),"sort-desc":N.value,"onUpdate:sortDesc":t[5]||(t[5]=e=>N.value=e),"sort-direction":M.value,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:W},{"cell(PaymentSystemName)":s(e=>[t[9]||(t[9]=n("span",{class:"td-mobile"},"Платежная система",-1)),n("span",Wt,l(e.value),1)]),"cell(CreateDate)":s(e=>[t[10]||(t[10]=n("span",{class:"td-mobile"},"Дата Создания",-1)),n("span",qt,l(b(Et)(b(Rt)(e.item?.CreateDate))),1)]),"cell(ID)":s(e=>[t[11]||(t[11]=n("span",{class:"td-mobile"},"Номер счета",-1)),n("span",Zt,l(e.value),1)]),"cell(ContractID)":s(e=>[t[12]||(t[12]=n("span",{class:"td-mobile"},"Договор",-1)),n("span",Gt,"#"+l(e.item?.ContractID)+" / "+l(e.item?.Customer),1)]),"cell(StatusID)":s(e=>[a(ot,{status:e.value,"status-table":"Invoices",onClick:_=>J(e.item?.ID),class:"tw-cursor-pointer"},null,8,["status","onClick"])]),"cell(Summ)":s(e=>[t[13]||(t[13]=n("span",{class:"td-mobile"},"Сумма",-1)),n("span",Jt,l(b(Pt)(e.item?.Summ)),1)]),"cell(Button1)":s(e=>[a(x,{onClick:_=>q(e)},{default:s(()=>[a(nt,{class:"tw-size-5"}),t[14]||(t[14]=n("div",null,"Скачать",-1))]),_:2,__:[14]},1032,["onClick"])]),"cell(Button2)":s(e=>[a(x,{onClick:_=>E(e)},{default:s(()=>[a(st,{class:"tw-size-5"}),n("div",null,l(e.item?.IsPosted?"Посмотреть":"Оплатить"),1)]),_:2},1032,["onClick"])]),"cell(Button3)":s(e=>[a(x,{type:"cancel",onClick:_=>X(e)},{default:s(()=>t[15]||(t[15]=[$("Отменить",-1)])),_:2,__:[15]},1032,["onClick"])]),"cell(Button4)":s(e=>[a(lt,{class:"dropdown-dots tw-m-0",right:""},{"button-content":s(()=>[a(at)]),default:s(()=>[a(B,null,{default:s(()=>[n("a",{href:Z(e)},"Скачать в формате tiff",8,Kt)]),_:2},1024),a(B,{onClick:_=>K(e)},{default:s(()=>t[16]||(t[16]=[$("Изменить счёт",-1)])),_:2,__:[16]},1032,["onClick"]),a(B,{onClick:_=>G(e)},{default:s(()=>t[17]||(t[17]=[$("Провести условно",-1)])),_:2,__:[17]},1032,["onClick"])]),_:2},1024)]),_:1},8,["items","filter","per-page","current-page","sort-by","sort-desc","sort-direction"]),T.value>0?(D(),S("div",Qt,[a(rt,{modelValue:y.value,"onUpdate:modelValue":t[6]||(t[6]=e=>y.value=e),"total-rows":T.value,"per-page":p.value,"first-number":"","last-number":""},{"first-text":s(()=>t[18]||(t[18]=[n("span",{class:"text-success"},"First",-1)])),"last-text":s(()=>t[19]||(t[19]=[n("span",{class:"text-info"},"Last",-1)])),page:s(({page:e,active:_})=>[n("span",null,l((e-1)*p.value+1)+"-"+l(e*p.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),a(b(h),{class:"multiselect--white",modelValue:p.value,"onUpdate:modelValue":t[7]||(t[7]=e=>p.value=e),options:z.value,label:"name",openDirection:"top",onInput:t[8]||(t[8]=e=>y.value=1)},{singlelabel:s(({value:e})=>[n("span",Xt," Отображать "+l(e.value)+" строк ",1)]),option:s(({option:e})=>[n("span",Yt,"Отображать "+l(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):gt("",!0)],64)):(D(),wt(mt,{key:1,label:"Заказов не найдено"}))])],64)}}},be=Ut(te,[["__scopeId","data-v-9062ddab"]]);export{be as default};
