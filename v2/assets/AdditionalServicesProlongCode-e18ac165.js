import{E as he}from"./EmptyStateBlock-b0a120e4.js";import{_ as be}from"./BlockOrderPayBalance-39bb297a.js";import{_ as ye}from"./ClausesKeeper-90c650cc.js";import{_ as ke}from"./ButtonDefault-11c4541b.js";import{_ as Ie,f as Se,e as fe,r as ie,h as O,i as re,P as De,ah as E,o as r,c as _,b as D,a as o,t as d,z as de,l as F,F as U,y as we,Z as _e,ab as ue,p as Ce,m as ge}from"./index-aeb1df1e.js";import{u as Be}from"./IconArrow-a6c91ada.js";import{u as Pe}from"./services-bb78f548.js";/* empty css                                                                             */import{B as Oe}from"./BlockBalanceAgreement-906c1168.js";import"./bootstrap-vue-next.es-c6bcf011.js";import"./IconHelp-66378dff.js";import"./globalActions-3944bebb.js";import"./component-60ac2998.js";import"./IconClose-c7c36336.js";const ve=w=>(Ce("data-v-4ebb2806"),w=w(),ge(),w),Ee={key:0,class:"hosting-sheme"},Fe={class:"section"},Ue={class:"container"},Ne={class:"section-header"},xe={class:"section-header__wrapper"},Ae={class:"section-title"},Te={class:"section-label"},Le={key:1,class:"section"},Re={class:"container"},Me={class:"total-block"},$e={class:"total-block__row divider-bottom"},Ve=ve(()=>o("div",{class:"total-block__col"},"Цена тарифа",-1)),je={class:"total-block__col"},ze={class:"total-block__row no-divider"},Ke={class:"total-block__col"},qe={class:"total-block__col"},Ze={class:"total-block__row total-block__row--big economy-line"},Ge=ve(()=>o("div",{class:"total-block__col red"},"Выгода",-1)),He={class:"total-block__col flex-col"},Je={class:"red"},Qe={class:"total-block__row total-block__row--big"},We={class:"total-block__col"},Xe={class:"total-block__col"},Ye={key:2,class:"section"},eo={class:"container"},oo={key:1,class:"section"},so={class:"container"},to={__name:"AdditionalServicesProlongCode",async setup(w){let v,p;const N=Be(),a=Pe(),pe=Se(),x=fe(),t=ie(null),h=ie(!1),n=O(()=>Object.keys(a==null?void 0:a.ISPswOrdersList).map(s=>a==null?void 0:a.ISPswOrdersList[s]).find(s=>s.OrderID===pe.params.id)),A=s=>{s.key==="Enter"&&s.ctrlKey&&B()};re(()=>{document.addEventListener("keyup",A)}),De(()=>{document.removeEventListener("keyup",A)});const c=O(()=>{var s;return(s=a==null?void 0:a.additionalServicesScheme)!=null&&s.ISPsw?Object.keys(a.additionalServicesScheme.ISPsw).map(l=>{const e=a.additionalServicesScheme.ISPsw[l];return{...e,value:e==null?void 0:e.ID,name:e==null?void 0:e.Name,cost:e==null?void 0:e.CostDay,month:e==null?void 0:e.CostMonth}}).filter(l=>{var e;return(l==null?void 0:l.ID)==((e=n.value)==null?void 0:e.SchemeID)}):[]}),g=O(()=>N.contractsList);function B(){var y,k,I,S,f;h.value=!0;const s=parseFloat((y=g.value[n.value.ContractID])==null?void 0:y.Balance)>=parseFloat(m(((k=t.value)==null?void 0:k.price)-C())??0),l=((I=c.value[0])==null?void 0:I.cost)==="0.00"&&((S=c.value[0])==null?void 0:S.month)==="0.00",e=s||l,b=!e,P={ISPswOrderID:n.value.ID,DaysPay:(f=t.value)==null?void 0:f.actualDays,IsNoBasket:e,IsUseBasket:b,PayMessage:""};a.ISPswOrderPay(P).then(u=>{u==="UseBasket"?x.push("/Basket"):u==="NoBasket"&&x.push("/AdditionalServices?ServiceID=51000"),h.value=!1}).catch(u=>{console.error("ISPswOrderPay error:",u),h.value=!1})}function m(s){return Number(s).toFixed(2)||0}function C(){var l,e;let s=0;return(e=(l=t.value)==null?void 0:l.discounts)==null||e.Bonuses.map(b=>{s+=+b.Economy}),s}function me(s){t.value=s}return re(()=>{a.fetchAdditionalServiceScheme("ISPsw")}),[v,p]=E(()=>a.fetchISPswOrders()),await v,p(),[v,p]=E(()=>a.fetchAdditionalServiceScheme("ISPsw")),await v,p(),[v,p]=E(()=>N.fetchContracts()),await v,p(),(s,l)=>{var k,I,S,f,u,T,L,R,M,$,V,j,z,K,q,Z,G,H,J,Q,W,X,Y,ee,oe,se,te,ae,le,ne,ce;const e=ke,b=ye,P=be,y=he;return r(),_(U,null,[D(Oe),n.value?(r(),_("div",Ee,[o("div",Fe,[o("div",Ue,[o("div",Ne,[o("div",xe,[o("h1",Ae,"Оплата заказа ПО ISPsystem, "+d(((k=n.value)==null?void 0:k.IP)||""),1),((I=c.value[0])==null?void 0:I.ConsiderTypeID)!=="Upon"?(r(),de(e,{key:0,class:"btn--wide",label:parseFloat((S=g.value[n.value.ContractID])==null?void 0:S.Balance)>=parseFloat((f=t.value)==null?void 0:f.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||((u=t.value)==null?void 0:u.price)===null,"is-loading":h.value,onClick:l[0]||(l[0]=i=>B())},null,8,["label","disabled","is-loading"])):F("",!0)]),o("div",Te,d((T=c.value[0])==null?void 0:T.Name),1)])]),D(b)]),((L=c.value[0])==null?void 0:L.ConsiderTypeID)!=="Upon"?(r(),de(P,{key:0,contractID:(R=n.value)==null?void 0:R.ContractID,daysRemainded:(M=n.value)==null?void 0:M.DaysRemainded,serviceID:"51000",scheme:c.value[0],orderID:($=n.value)==null?void 0:$.OrderID,isOrderID:!0,onSelect:me},null,8,["contractID","daysRemainded","scheme","orderID"])):F("",!0),n.value?(r(),_("div",Le,[o("div",Re,[o("div",Me,[((z=(j=(V=t.value)==null?void 0:V.discounts)==null?void 0:j.Bonuses)==null?void 0:z.length)>0?(r(),_(U,{key:0},[o("div",$e,[Ve,o("div",je,d(m((K=t.value)==null?void 0:K.price))+" ₽",1)]),(r(!0),_(U,null,we((Z=(q=t.value)==null?void 0:q.discounts)==null?void 0:Z.Bonuses,i=>(r(),_("div",ze,[o("div",Ke,"Скидка "+d(i==null?void 0:i.Discount)+"% на "+d(i==null?void 0:i.Days)+" дней",1),o("div",qe,"-"+d(m(i==null?void 0:i.Economy))+" ₽",1)]))),256)),_e(o("div",Ze,[Ge,o("div",He,[o("span",null,[o("s",null,d(m((G=t.value)==null?void 0:G.price))+" ₽",1)]),o("span",Je,"-"+d(C())+" ₽",1)])],512),[[ue,((Q=(J=(H=t.value)==null?void 0:H.discounts)==null?void 0:J.Bonuses)==null?void 0:Q.length)>0]])],64)):F("",!0),_e(o("div",Qe,[o("div",We,d(((W=c.value[0])==null?void 0:W.ConsiderTypeID)==="Upon"?"Итого":`Итого за ${(X=t.value)==null?void 0:X.label}`),1),o("div",Xe,d(((Y=c.value[0])==null?void 0:Y.ConsiderTypeID)==="Upon"?(ee=c.value[0])==null?void 0:ee.CostMonth:m(((oe=t.value)==null?void 0:oe.price)-C()))+" ₽",1)],512),[[ue,((se=t.value)==null?void 0:se.price)||((te=c.value[0])==null?void 0:te.ConsiderTypeID)==="Upon"]])]),D(e,{class:"btn--wide",label:parseFloat((ae=g.value[n.value.ContractID])==null?void 0:ae.Balance)>=(m(((le=t.value)==null?void 0:le.price)-C())??0)?"Оплатить c баланса договора":"Добавить в корзину",disabled:(t.value===null||((ne=t.value)==null?void 0:ne.price)===null)&&((ce=c.value[0])==null?void 0:ce.ConsiderTypeID)!=="Upon","is-loading":h.value,onClick:l[1]||(l[1]=i=>B())},null,8,["label","disabled","is-loading"])])])):(r(),_("div",Ye,[o("div",eo,[D(y,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),_("div",oo,[o("div",so,[D(y,{label:"не удалось найти заказ хостинга"})])]))],64)}}},ko=Ie(to,[["__scopeId","data-v-4ebb2806"]]);export{ko as default};
