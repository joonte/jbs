import{_ as Z}from"./EmptyStateBlock-BaR9js3E.js";import{m as Le,r as je,Y as Ee,v as Ue,L as Ve}from"./bootstrap-vue-next-DwS3lKQb.js";import{_ as Ae}from"./IconDots-hRD0_8ej.js";import{_ as Te}from"./IconCard-_anr564X.js";import{_ as He}from"./UserNote-8i0DdDDd.js";import{_ as Me}from"./StatusBadge-CjHHKSUG.js";import{_ as Re}from"./ClausesKeeper-CTja-fCz.js";import{_ as Ge}from"./WhiteButton-B0VC5rKo.js";import{_ as We}from"./BlueButton.vue_vue_type_script_setup_true_lang-CnzqAS80.js";import{_ as ze,a as Fe}from"./IconButtonBack-yE5ZfOaf.js";import{r as b,u as ee,f as U,H as te,c as C,o as f,a as i,C as w,b as p,n as z,h as P,t as k,w as l,e as S,E as Ke,j as qe,F as M,I as Xe,J as Ye,d as se,x as ne,g as oe,D as E,U as Je,i as Qe,v as Ze}from"./index-CmCGXBst.js";import{u as re,_ as et}from"./contracts-P7YPBhEI.js";import{u as ae}from"./services-C54cnl9l.js";import{f as Q}from"./time-DenPiOX5.js";import{i as tt,_ as st}from"./BlockBalanceAgreement-qtspRQ_B.js";import{u as nt}from"./global-5eUCDNCu.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as ot}from"./server-CRQmsQ4v.js";import{s as rt}from"./multiselect-DhoC9bwZ.js";import"./IconClose-B_k4TzXM.js";import"./ButtonDefault-BIBStZbJ.js";const at={class:"title__icon"},it={key:0,class:"tw-flex tw-items-center tw-gap-4 tw-mt-4"},lt={key:1,class:"tw-flex tw-gap-2"},ct={class:"tw-text-sky-400"},dt={class:"key-field"},ut={class:"key-field"},mt={class:"key-field"},vt={class:"hosting-status__date"},pt={class:"service__controls-wrapper"},ft=["onClick"],_t={class:"btn btn--dots"},It={__name:"ServiceListSection",props:{sectionID:{type:Number,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],setup(_,{emit:I}){const u=_,V={key:"Several",label:"",variant:"",sortable:!1},D=b([{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"Scheme",label:"Тариф",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}]),c=se(),R=oe(),x=ee(),g=ne("emitter"),O=b(!1),G=b("ID"),N=b(!0),F=b("desc"),v=b(!1),$=b([]),B=b(null),K=re(),A=ae(),L=nt(),a=U(()=>A?.DNSmanagerOrdersList),y=U(()=>A?.ISPswOrdersList),W=U(()=>A?.ExtraIPOrdersList);function q(){c.go(0)}async function X(){let n="";u.sectionID==5e4?n="IP адресов":u.sectionID==51e3?n="лицензии ISPsystem":u.sectionID==52e3&&(n="вторичного DNS");const s=j.value.filter((r,m)=>$.value[m]).map(r=>r.ID),o={ServiceID:u.sectionID,ItemsPay:B.value,OrdersIDs:s,...O.value&&{UseBalance:"yes"}};await L.OrdersPay(o).then(r=>{r==="Basket"?c.push("/Basket"):r?.Status==="Ok"&&(v.value=!1,g.emit("open-modal",{component:"BalanceProlong",data:{Service:n,Message:r?.Message,Count:r?.Count}}))})}function Y(n){const e=a.value;return Object.values(e).find(o=>o.OrderID==n)}const d=U(()=>K?.contractsList);function J(n,e,s){e==5e4||e==51e3||e==52e3?_e(n,e):c.push(`/ServiceOrderPay/${n}`)}function le(n,e){const s=Y(n);g.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:s.ID,ServiceID:e,emitEvent:"updateServicesList",Login:s.Login}})}function ce(n,e){let s=null,o="";switch(Number(e)){case 5e4:s=Object.entries(W.value).find(([r,m])=>m),o="ExtraIPOrders";break;case 51e3:s=Object.entries(y.value).find(([r,m])=>m),o="ISPswOrders";break;case 52e3:s=Object.entries(a.value).find(([r,m])=>m),o="DNSmanagerOrders";break;default:s=Object.entries(j.value).find(([r,m])=>m),o="Orders"}s&&g.emit("open-modal",{component:"StatusHistory",data:{modeID:o,rowID:s[1].ID}})}const de=n=>{const e=ue(n);if(e){const s=e.split(","),o=s.length,r=s.join(`
`);return`Всего: ${o}
${r}`}return"Нет данных"},ue=n=>{const e=Object.entries(a.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID==n)return o.Parked}return null},me=n=>{const e=Object.entries(y.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID===n)return o.IP}},ve=n=>{const e=Object.entries(W.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID==n)return o.Login}};function pe(){D.value.unshift(V),v.value=!0}function fe(){D.value.shift(),v.value=!1}function _e(n,e,s){e==51e3?c.push(`/ISPswOrderPay/${n}`):e==52e3?c.push(`/DNSmanagerOrderPay/${n}`):e==5e4&&c.push(`/ExtraIPOrderPay/${n}`)}function Ie(n,e,s){tt()||(R.meta?.ServiceID==51e3?c.push(`/ISPswOrders/${n.ID}`):c.push(`/AdditionalServices/${n.ID}`))}function De(n,e){g.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:n,ServiceID:e}})}function Se(n,e){let s;e==51e3?s=Object.entries(y.value).reduce((r,[m,T])=>(r[m]=T,r),{}):e==52e3&&(s=Object.entries(a.value).reduce((r,[m,T])=>(r[m]=T,r),{}));let o;for(const r in s)if(Object.hasOwnProperty.call(s,r)){const m=s[r];if(m.OrderID==n){o=m;break}}o&&L.OrderManageHosting({ServiceOrderID:o.ID,OrderID:n,ServiceID:e,XMLHttpRequest:"yes"})}const ke=n=>{const e=Object.entries(a.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID==n)return o.Domain}return null},j=U(()=>Object.keys(x.userOrders).map(n=>({...x?.userOrders[n],ID:Number(x?.userOrders[n]?.ID)}))?.reverse()?.filter(n=>n.ServiceID==u?.sectionID));function be(){c.push(`/AdditionalServicesOrder?ServiceID=${u?.sectionID}`)}function Oe(n){if(!n)return Q(new Date);const e=new Date,s=new Date(e.getTime()+n*24*60*60*1e3);return Q(s)}return te(()=>{$.value=j.value.map(()=>!1)}),(n,e)=>{const s=ze,o=Fe,r=Le,m=We,T=Ge,ye=Re,ge=Me,we=He,Ce=Te,$e=Ae,Pe=Ke("router-link"),H=je,xe=Ee,he=Ue,Ne=Ve,Be=Z;return f(),C(M,null,[i("div",null,[i("div",{class:z(["tw-flex tw-justify-between tw-gap-4",{column:v.value}])},[i("div",at,[i("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:e[0]||(e[0]=t=>q())},k(v.value?"Продление услуг "+_.sectionData?.Item:_.sectionData?.Item),1),v.value?(f(),w(s,{key:0,onClick:e[1]||(e[1]=t=>fe())})):P("",!0)]),v.value?(f(),C("div",it,[p(o,{class:"contr period",modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=t=>B.value=t)},null,8,["modelValue"]),p(r,{id:"checkbox-balance",modelValue:O.value,"onUpdate:modelValue":e[3]||(e[3]=t=>O.value=t),name:"checkbox-balance"},{default:l(()=>e[9]||(e[9]=[S(" Использовать средства с баланса ",-1)])),_:1,__:[9]},8,["modelValue"]),p(m,{onClick:e[4]||(e[4]=t=>X())},{default:l(()=>e[10]||(e[10]=[S("Продлить",-1)])),_:1,__:[10]})])):(f(),C("div",lt,[(_.sectionID==5e4||_.sectionID==51e3||_.sectionID==52e3)&&j.value.length>1?(f(),w(T,{key:0,onClick:e[5]||(e[5]=t=>pe())},{default:l(()=>e[11]||(e[11]=[S("Продлить несколько заказов",-1)])),_:1,__:[11]})):P("",!0),p(m,{onClick:e[6]||(e[6]=t=>be())},{default:l(()=>e[12]||(e[12]=[S("Заказать",-1)])),_:1,__:[12]})]))],2),p(ye,{class:"additional-clauses",partition:`Header:${_.sectionData?.Code==="Default"?_.sectionID:`/${_.sectionData?.Code}Orders`}`},null,8,["partition"])]),j.value.length?(f(),w(Ne,{key:0,class:"basic-table tw-mt-4",items:j.value,fields:D.value,"sort-by":G.value,"onUpdate:sortBy":e[7]||(e[7]=t=>G.value=t),"sort-desc":N.value,"onUpdate:sortDesc":e[8]||(e[8]=t=>N.value=t),onRowClicked:Ie,"sort-direction":F.value},{"cell(Several)":l(t=>[Xe(p(r,{id:"checkbox-"+t.index,modelValue:$.value[t.index],"onUpdate:modelValue":h=>$.value[t.index]=h,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[Ye,v.value]])]),"cell(ID)":l(t=>[e[13]||(e[13]=i("span",{class:"td-mobile"},"Заказ",-1)),i("span",ct,k(t.value),1)]),"cell(ContractID)":l(t=>[e[14]||(e[14]=i("span",{class:"td-mobile"},"Договор",-1)),i("span",null,"#"+k(d.value[t.value]?.ID)+" / "+k(d.value[t.value]?.Customer),1)]),"cell(Scheme)":l(t=>[e[15]||(e[15]=i("span",{class:"td-mobile"},"Тариф",-1)),i("span",null,k(t.item?.SchemeName),1)]),"cell(Keys)":l(t=>[e[16]||(e[16]=i("span",{class:"td-mobile"},"Ключевые поля",-1)),i("span",dt,[t.item?.Code==="ISPsw"?(f(),C(M,{key:0},[S(k(me(t.item?.ID)),1)],64)):P("",!0)]),i("span",ut,[t.item?.Code==="ExtraIP"?(f(),C(M,{key:0},[S(k(ve(t.item?.ID)),1)],64)):P("",!0)]),i("span",mt,[S(k(ke(t.item?.ID))+" ",1),i("pre",vt,k(de(t.item?.ID)),1)])]),"cell(StatusID)":l(t=>[p(ge,{class:"tw-cursor-pointer",status:t.value,"status-table":"Orders",onClick:qe(h=>ce(t.item?.ID,t.item?.ServiceID),["stop"])},null,8,["status","onClick"])]),"cell(ExpirationDate)":l(t=>[e[17]||(e[17]=i("span",{class:"td-mobile"},"Дата окончания",-1)),i("span",{class:z({danger:Number(t.item?.DaysRemainded)<14})},k(Oe(t.item?.DaysRemainded))+" | "+k(t.item?.DaysRemainded||0)+" дн. ",3)]),"cell(UserNotice)":l(t=>[e[18]||(e[18]=i("span",{class:"td-mobile"},"Комментарий",-1)),p(we,{text:t.value,"order-id":t.item?.ID,emit:"updateServicesList"},null,8,["text","order-id"])]),"cell(controls)":l(t=>[i("div",pt,[i("div",{class:"btn btn--md btn--bold",onClick:h=>J(t.item.ID,t.item.ServiceID,t.item.ContractID)},[p(Ce),e[19]||(e[19]=S(" Оплатить ",-1))],8,ft),p(he,{class:"dropdown-dots",right:""},{"button-content":l(()=>[i("span",_t,[p($e)])]),default:l(()=>[p(H,null,{default:l(()=>[p(Pe,{to:`/AdditionalServices/${t.item.ID}`},{default:l(()=>e[20]||(e[20]=[S("Дополнительная информация",-1)])),_:2,__:[20]},1032,["to"])]),_:2},1024),p(H,{onClick:h=>De(t.item.ID,t.item.ServiceID)},{default:l(()=>e[21]||(e[21]=[S("Передать на другой аккаунт",-1)])),_:2,__:[21]},1032,["onClick"]),_.sectionID==51e3||_.sectionID==52e3?(f(),w(H,{key:0,onClick:h=>Se(t.item.ID,t.item.ServiceID)},{default:l(()=>e[22]||(e[22]=[S("Управлять заказом",-1)])),_:2,__:[22]},1032,["onClick"])):P("",!0),_.sectionID==52e3?(f(),w(H,{key:1,onClick:h=>le(t.item.ID,t.item.ServiceID)},{default:l(()=>e[23]||(e[23]=[S("Сменить пароль",-1)])),_:2,__:[23]},1032,["onClick"])):P("",!0),p(xe),p(H,{class:"color-red",onClick:h=>n.$emit("deleteItem",t.item)},{default:l(()=>e[24]||(e[24]=[S("Удалить",-1)])),_:2,__:[24]},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","sort-direction"])):(f(),w(Be,{key:1,class:"tw-mt-4",label:"Вы еще не пользовались этой услугой"}))],64)}}},Dt=ie(It,[["__scopeId","data-v-ed4350cc"]]),St={class:"section"},kt={class:"container"},bt={class:"section-header"},Ot={class:"section-nav"},yt=["title","onClick"],gt={class:"multiselect-option"},wt={key:0,class:"section-body"},Ct={__name:"AdditionalServices",async setup(_){let I,u;const V=b(!1),D=b(3),c=b(null),R=oe(),x=se(),g=ne("emitter"),O=ae(),G=ot(),N=ee(),F=re();[I,u]=E(()=>F.fetchContracts()),await I,u(),[I,u]=E(()=>N.fetchUserOrders()),await I,u(),[I,u]=E(()=>O.fetchServices()),await I,u(),[I,u]=E(()=>O.fetchDNSmanagerOrders()),await I,u(),[I,u]=E(()=>O.fetchISPswOrders()),await I,u(),[I,u]=E(()=>O.fetchExtraIPOrders()),await I,u();const v=U(()=>Object.values(O.ServicesList).filter(a=>a.ServicesGroupID!=1e3&&a.IsActive&&!a.IsHidden).sort((a,y)=>Number(a.SortID)-Number(y.SortID)).map(a=>({...a,ID:Number(a.ID),value:Number(a.ID)}))),$=Number(R.query.ServiceID)||R.meta?.ServiceID||null;$&&v.value.find(a=>a.ID==$)?c.value=$:(c.value=v.value[0].ID,x.replace(`/AdditionalServices?ServiceID=${c.value}`));async function B(a){V.value=!0,c.value=a,a==51e3?await x.replace("/ISPswOrders"):await x.replace(`/AdditionalServices?ServiceID=${a}`),V.value=!1}function K(a){return G.serverGroupsList.ServersGroups[a]}function A(a){g.emit("open-modal",{component:"DeleteItem",data:{id:a.ID,message:`Вы действительно хотите удалить заказ #${a.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}g.on("updateUserOrdersList",()=>{N.fetchUserOrders()}),g.on("updateServicesList",()=>{N.fetchUserOrders()}),g.on("updateDNSManagerPage",()=>{O.fetchDNSmanagerOrders()}),te(async()=>{window.addEventListener("resize",L),L()}),Je(()=>{window.removeEventListener("resize",L)});const L=()=>{window.innerWidth>=1536?D.value=v.length:window.innerWidth>=1280?D.value=7:window.innerWidth>=1024?D.value=5:window.innerWidth>=480?D.value=4:D.value=2};return(a,y)=>{const W=st,q=et,X=Dt,Y=Z;return f(),C(M,null,[p(W),i("div",St,[i("div",kt,[i("div",bt,[i("div",Ot,[(f(!0),C(M,null,Qe(v.value.slice(0,D.value),d=>(f(),C("div",{key:d?.ID,class:z([{"section-link":!0,"section-link-active":c.value===d?.ID},"section-nav__item"]),title:K(d.ServersGroupID)?.Comment,onClick:J=>B(d.ID)},k(d?.Item),11,yt))),128)),v.value.length>D.value?(f(),w(Ze(rt),{key:0,modelValue:c.value,"onUpdate:modelValue":y[0]||(y[0]=d=>c.value=d),class:z({"multiselect--white additional-service__select":!0,"additional-service__select_active":v.value.slice(D.value).find(d=>d?.ID===c.value)}),options:v.value.slice(D.value),label:"ID",onSelect:y[1]||(y[1]=d=>B(d))},{option:l(({option:d})=>[i("div",gt,k(d?.Item),1)]),caret:l(()=>[p(q,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):P("",!0)])]),V.value?P("",!0):(f(),C("div",wt,[v.value.find(d=>d.ID==c.value)?(f(),w(X,{key:0,sectionID:c.value,sectionData:v.value.find(d=>d.ID==c.value),onDeleteItem:A},null,8,["sectionID","sectionData"])):(f(),w(Y,{key:1,label:"Услуга не найдена"}))]))])])],64)}}},qt=ie(Ct,[["__scopeId","data-v-22ee2781"]]);export{qt as default};
