import{j as $,o as n,c as d,b as _,a as s,w as U,d as x,t as A,F as T,v as H,k as i,x as y,n as B,p as ee,l as le,_ as oe,u as ae,e as se,a7 as re,r as h,g as z}from"./index-4434f005.js";import{u as ne}from"./contracts-d017d511.js";import{s as ce}from"./SimpleCheckbox-8ffec57f.js";import{_ as G}from"./BasicInput-50e80b39.js";import{P as J,T as K,S as Q}from"./PhoneInput-537a35e2.js";import{u as te}from"./files-75d972ee.js";import{I as W}from"./IconFile-e9e74639.js";import{I as X}from"./IconClose-0cfbf563.js";import{B as Y}from"./BlockBalanceAgreement-4e844242.js";import{E as ue}from"./EmptyStateBlock-927727c9.js";import{_ as de}from"./ButtonDefault-f91c301e.js";import{f as fe}from"./bootstrap-vue-next.es-5d8af788.js";import{_ as pe}from"./IconClip-77067ddf.js";import{_ as _e}from"./ClausesKeeper-68df7f35.js";import"./component2-53fb8201.js";import"./component-6f0e2102.js";import"./multiselect-eb561fe9.js";import"./IconArrow-6847c901.js";const Z=v=>(ee("data-v-444439cc"),v=v(),le(),v),ie={class:"section"},he={class:"container"},ve={class:"section-header"},ke={class:"breadcrumb"},ge=Z(()=>s("h1",{class:"section-title"},"Редактировать договор",-1)),be={class:"form"},ye={class:"form-row-wrapper"},Ce={class:"special-form-row"},me={key:0,class:"section-header inputs-block"},Ve={class:"section-block_title"},Ie={key:0,class:"form width-limit"},Ee={key:0,class:"form-field form-field--file form-field--basic"},Te={class:"chat-files"},Pe={class:"chat-files__item"},Se={key:1,class:"form-field form-field--file form-field--basic"},Fe={class:"chat-files"},we={class:"chat-files__item"},De=["onClick"],Le={class:"form-field form-field--file form-field--basic"},Ue={class:"form-field-input__file-wrapper"},xe={class:"form-field-input__file"},Ae=Z(()=>s("span",null,"Прикрепить документ подтверждающий личность",-1)),Be=["innerHTML"];function Oe(v,u,M,l,C,m){var L,I,a,r,c;const b=Y,f=$("router-link"),P=_e,g=G,S=J,V=K,F=Q,k=W,w=X,p=pe,D=fe,O=de,N=ue;return n(),d(T,null,[_(b),s("div",ie,[s("div",he,[s("div",ve,[s("div",ke,[_(f,{class:"section-label",to:"/Contracts"},{default:U(()=>[x("Договор /")]),_:1}),_(f,{class:"section-label",to:`/ContractScheme/${v.$route.params.id}`},{default:U(()=>{var e;return[x(A((e=l.getProfile)==null?void 0:e.Name),1)]}),_:1},8,["to"])]),ge]),_(P),l.getProfile?(n(),d(T,{key:0},[s("div",be,[(n(!0),d(T,null,H((c=(r=(a=(I=(L=l.getConfig)==null?void 0:L.Profiles)==null?void 0:I.Templates)==null?void 0:a[l.templateValue])==null?void 0:r.Template)==null?void 0:c.Attribs,(e,o)=>(n(),d("div",ye,[s("div",Ce,[e!=null&&e.Title?(n(),d("div",me,[s("h2",Ve,A(e==null?void 0:e.Title),1)])):i("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)!=="Phone"?(n(),y(g,{key:1,class:B({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":t=>l.form[o].value=t},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):i("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)==="Phone"?(n(),y(S,{key:2,class:B({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":t=>l.form[o].value=t},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):i("",!0),(e==null?void 0:e.Type)==="TextArea"?(n(),y(V,{key:3,class:B({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":t=>l.form[o].value=t},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):(e==null?void 0:e.Type)==="Select"?(n(),y(F,{key:4,class:B({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,options:e==null?void 0:e.Options,modelValue:l.form[o].value,"onUpdate:modelValue":t=>l.form[o].value=t},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):i("",!0)])]))),256))]),l.templateValue!==0?(n(),d("div",Ie,[l.fileListOld.length?(n(),d("div",Ee,[s("div",Te,[(n(!0),d(T,null,H(l.fileListOld,(e,o)=>(n(),d("div",Pe,[s("span",null,[_(k,{class:"file-icon"})]),s("span",null,A(e==null?void 0:e.name),1)]))),256))])])):i("",!0),l.fileList.length?(n(),d("div",Se,[s("div",Fe,[(n(!0),d(T,null,H(l.fileList,(e,o)=>(n(),d("div",we,[s("span",null,[_(k,{class:"file-icon"})]),s("span",null,A(e==null?void 0:e.name),1),s("button",{class:"close",onClick:t=>l.removeFile(o)},[_(w)],8,De)]))),256))])])):i("",!0),s("label",Le,[s("div",Ue,[s("input",{ref:"fileInput",type:"file",onChange:u[0]||(u[0]=(...e)=>l.fileUpload&&l.fileUpload(...e))},null,544),s("div",xe,[_(p),Ae])])]),_(D,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agree,"onUpdate:modelValue":u[1]||(u[1]=e=>l.agree=e)},{default:U(()=>[x("Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет")]),_:1},8,["modelValue"]),_(D,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agreeHandle,"onUpdate:modelValue":u[2]||(u[2]=e=>l.agreeHandle=e)},{default:U(()=>[x("Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменто и т.п.)")]),_:1},8,["modelValue"])])):i("",!0),l.createProfileErrorMessage?(n(),d("div",{key:1,class:"error-message width-limit",innerHTML:l.formErrorMessage(l.createProfileErrorMessage)},null,8,Be)):i("",!0),l.templateValue!==0?(n(),y(O,{key:2,class:"width-limit","is-loading":l.createProfileResult==="pending",label:"Сохранить",onClick:u[3]||(u[3]=e=>l.checkForm())},null,8,["is-loading"])):i("",!0)],64)):(n(),y(N,{key:1,label:"Профиль договора не найден"}))])])],64)}const Ne={components:{TextAreaLine:K,simpleCheckbox:ce,basicInput:G,SelectLine:Q,PhoneInput:J,IconFile:W,IconClose:X,BlockBalanceAgreement:Y},async setup(){const v=ae(),u=ne(),M=te(),l=se(),C=re(),m=h(!1),b=h(!1),f=h({}),P=h(null),g=h([]),S=h([]),V=h(null),F=h(null),k=h(0),w=z(()=>v.ConfigList),p=z(()=>{var a;return(a=u.profileList)==null?void 0:a[C.params.id]});function D(){let a=!1;if(Object.keys(f.value).forEach(r=>{f.value[r].value===null&&f.value[r].required?(f.value[r].error=!0,a=!0,console.log(a,"1")):f.value[r].error=!1}),!a&&m.value&&b.value){let r={},c=new FormData;Object.keys(f.value).forEach(e=>{var o;c.append(e,(o=f.value[e])==null?void 0:o.value)}),c.append("TemplateID",k.value),c.append("Agree",m.value),c.append("AgreeHandle",b.value),c.append("ProfileID",C.params.id),g.value.forEach((e,o)=>{c.append("Document[]",e==null?void 0:e.value)}),V.value="pending",u.createNewContract({ProfileID:C.params.id,TemplateID:k.value,Agree:m.value,AgreeHandle:b.value,...r}).then(e=>{var o;e.status==="success"?l.push(`/ContractScheme/${C.params.id}`):(V.value="error",F.value=(o=e.data)==null?void 0:o.Exception)})}}function O(a){g.value=g.value.filter((r,c)=>c!==a)}function N(a){return""+I(a)}function L(a){var c;let r=((c=a.target.files)==null?void 0:c[0])||null;r&&(P.value.value="",M.sendFile(r).then(e=>{g.value.push({name:r==null?void 0:r.name,value:e.slice(e.lastIndexOf("^")+1,e.length)})}))}function I(a){return a?"<div>"+(a==null?void 0:a.String)+"</div>"+I(a==null?void 0:a.Parent):""}return await u.fetchContracts().then(()=>{u.fetchProfiles().then(()=>{var a,r,c,e;k.value=(a=p.value)==null?void 0:a.TemplateID,(r=p.value)!=null&&r.Files&&(S.value=(e=Object.keys((c=p.value)==null?void 0:c.Files))==null?void 0:e.map(o=>{var t,E;return{name:(t=p.value)==null?void 0:t.Files[o].Name,value:(E=p.value)==null?void 0:E.Files[o].Name}})),Object.keys(p.value.Attribs).forEach(o=>{var t,E,j,R,q;f.value[o]={value:p.value.Attribs[o],required:((q=(R=(j=(E=(t=w.value)==null?void 0:t.Profiles)==null?void 0:E.Templates)==null?void 0:j[k.value])==null?void 0:R.Template)==null?void 0:q.Attribs[o].IsDuty)==="1",error:!1}})})}),await v.fetchConfig(),{getConfig:w,getProfile:p,templateValue:k,agreeHandle:b,fileInput:P,fileList:g,fileListOld:S,agree:m,createProfileResult:V,createProfileErrorMessage:F,checkForm:D,fileUpload:L,removeFile:O,formErrorMessage:N,form:f}}},al=oe(Ne,[["render",Oe],["__scopeId","data-v-444439cc"]]);export{al as default};
