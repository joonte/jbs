import{_ as fe}from"./ButtonDefault-eJbeaBtE.js";import{_ as Se}from"./BlockOrderServiceWrapper-Las2JEDB.js";import{_ as he}from"./BlockAdditionalServices-DPr--p0K.js";import{_ as be}from"./BlockOrderPayBalance-CwLP8dIN.js";import{_ as ke}from"./BlockSelectContract-BJLjloC1.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as f,h as J,c as n,o as a,a as o,L as ae,i as x,t as u,e as Ie,F as b,j as D,H as ye,f as h,s as De,E as R,b as g,w as T,I as le,J as ne,d as ge,D as K,B as Ve}from"./index-XtiBO-PZ.js";import{_ as Pe}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as Be}from"./BlockBalanceAgreement-DjWMZ940.js";import{u as Ce}from"./resetServer-CCXxJWyw.js";import{u as Oe}from"./contracts-BdlSA9YT.js";import{u as $e}from"./services-izfy4zss.js";import"./EmptyStateBlock-CV1Zaaf7.js";import"./bootstrap-vue-next-CxxkTytZ.js";import"./ServiceListOrderSelection-D6_D29T7.js";import"./BasicInput-TTn3Hxre.js";import"./component-YfTGPdLe.js";import"./multiselect-eqvbz1NV.js";import"./globalActions-Tf2FwXht.js";import"./IconHelp-C9M5tavY.js";import"./IconClose-s_NQ_Q4c.js";const Ee={class:"form-input_border"},we={class:"form-input_border-label"},Ne=["name","checked"],Ue={class:"form-field__data"},xe={key:0,class:"form-field__img"},Ae=["src"],Le={class:"form-field__name"},Fe={class:"form-field__desc"},Re={class:"form-field__select"},Ge={__name:"InputBoxBorder",props:{modelValue:[String,Number,Object],data:{type:Object,default:()=>{}},name:{type:String,default:""},type:{type:String,default:"radio"},checked:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(c,{emit:m}){const i=c,_=m,V=f(null);function P(){_("update:modelValue",i.data)}return J(()=>{V.value=i.modelValue}),(k,B)=>(a(),n("div",Ee,[o("label",we,[o("input",{name:c.name,type:"radio",checked:c.checked,onInput:P},null,40,Ne),o("div",Ue,[ae(k.$slots,"default",{},()=>[c.data.img?(a(),n("div",xe,[o("img",{src:c.data.img,alt:""},null,8,Ae)])):x("",!0)],!0),o("div",Le,u(c.data.name),1),o("div",Fe,[Ie(u(c.data.desc)+" ",1),c.data.select?ae(k.$slots,"default",{key:0},()=>[o("div",Re,[(a(!0),n(b,null,D(c.data.select,(l,S)=>(a(),n("div",{key:S,class:"form-field__select-item"},u(l.text),1))),128))])],!0):x("",!0)])])])]))}},je=q(Ge,[["__scopeId","data-v-7bda4e94"]]),Me={class:"form-input_border"},Te={class:"form-input_border-label"},Ke=["name","type","checked"],He={class:"form-field__data"},qe={class:"form-field_header"},Je={__name:"VpsInputLine",props:{modelValue:Object,data:{type:Object,default:()=>{}},headers:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1},checked:{type:Boolean,default:!1}},emits:["update:modelValue","input"],setup(c,{emit:m}){const i=c,_=m,V=f(null);function P(){_("update:modelValue",i.data),_("input",i.data)}return J(()=>{V.value=i.modelValue}),(k,B)=>(a(),n("div",Me,[o("label",Te,[o("input",{name:c.name,type:c.checkbox?"checkbox":"radio",checked:c.checked,onInput:P},null,40,Ke),o("div",He,[(a(!0),n(b,null,D(c.headers,(l,S)=>(a(),n("div",{key:S,class:"form-field__col"},[o("span",qe,u(l),1),o("span",null,u(c.data[S]),1)]))),128))])])]))}},We=q(Je,[["__scopeId","data-v-50a24753"]]),Xe="/v2/oc-2.jpg",ze={class:"vps-scheme-page"},Qe={class:"section"},Ye={class:"container"},Ze={class:"section"},et={class:"form-column"},tt={class:"form-header"},ot={key:0,class:"section"},st={class:"form grid-gorm"},at=["src","alt"],lt={class:"section"},nt={class:"form"},rt={class:"section"},ct={class:"container"},ut={class:"total-block"},it={class:"total-block__row divider-bottom"},dt={class:"total-block__col"},mt={class:"total-block__col"},_t={class:"total-block__col"},vt={class:"total-block__row"},pt={class:"total-block__col"},ft={class:"total-block__col"},St={class:"total-block__col"},ht={class:"total-block__row total-block__row--big economy-line"},bt={class:"total-block__col flex-col"},kt={class:"red"},It={class:"total-block__row total-block__row--big"},yt={class:"total-block__col"},Dt={class:"total-block__col"},H="Moscow",gt={__name:"VPSSchemes",async setup(c){let m,i;const _=ye(),V=Oe(),P=Ce(),k=$e(),B=ge(),l=f(null),S=f([]),I=f(null),$=f(null),A=f(!1),v=f(null),W=f(!1),X=f(""),re=f([{img:Xe,value:"Moscow",name:"Россия",desc:"Москва"}]),z=h(()=>{const t=E.value?.[0];return t?.SchemeParams?{PackageID:"Тариф",cpu_number:t?.SchemeParams?.cpu_number?.Name||"CPU",ram_mib:t?.SchemeParams?.ram_mib?.Name||"RAM",hdd_mib:t?.SchemeParams?.hdd_mib?.Name||"Память",net_in_mbitps:t?.SchemeParams?.net_in_mbitps?.Name||"Канал",CostMonth:"Стоимость"}:{PackageID:"Тариф",cpu_number:"CPU",ram_mib:"RAM",hdd_mib:"Память",net_in_mbitps:"Канал",CostMonth:"Стоимость"}}),E=h(()=>Object.keys(_.vpsSchemes).filter(t=>_.vpsSchemes[t].IsActive).map(t=>_.vpsSchemes[t]).sort((t,e)=>{const r=Number(t.SortID),d=Number(e.SortID);return r-d})),ce=h(()=>V?.contractsList),w=h(()=>E.value.find(t=>t?.ID===v.value?.ID)),N=h(()=>P?.serverGroupsList?.ServersGroups),Q=h(()=>k?.ServicesList),G=h(()=>{let t=0;return S.value.forEach(e=>{t+=e?.Price}),Z(t)||0}),L=h(()=>{const t=w.value?.OS||[],e=w.value?.OSs||[];return t.map(r=>{const d=e.find(y=>y.Name===r);return{name:r,value:r,imageUrl:d?d.Image:""}})}),Y=t=>{t.key==="Enter"&&t.ctrlKey&&!ue.value&&te()},ue=h(()=>l.value===null||I.value===null),ie=h(()=>{if(l.value?.daysFromBalance)return"Оплатить c баланса договора";const t=C(l.value?.price-j()+ +G.value);return(ce.value?.[I.value]?.Balance||0)>=t?"Оплатить c баланса договора":"Добавить в корзину"});J(()=>{document.addEventListener("keyup",Y)}),De(()=>{document.removeEventListener("keyup",Y)});function C(t){const e=Number(w.value?.CostInstall)||0,r=Number(t)||0,d=(e+r).toFixed(2);return Number(d)}function Z(t){return Number(t).toFixed(2)||0}function j(){let t=0;return l.value?.discounts?.Bonuses.map(e=>{t+=+e.Economy}),t}function ee(t){return{ID:t?.ID,PackageID:t?.PackageID,ServersGroupID:t?.ServersGroupID,cpu_number:t?.SchemeParams?.cpu_number?.Value,ram_mib:t?.SchemeParams?.ram_mib?.Value,hdd_mib:t?.SchemeParams?.hdd_mib?.Value,net_in_mbitps:t?.SchemeParams?.net_in_mbitps?.Value,CostMonth:t?.CostMonth}}function de(){let t=Object.keys(N.value?.[v.value?.ServersGroupID])?.find(r=>N.value?.[v.value?.ServersGroupID]?.[r]?.IsActive&&N.value?.[v.value?.ServersGroupID]?.[r]?.IsDefault),e=Object.keys(N.value?.[v.value?.ServersGroupID])?.find(r=>N.value?.[v.value?.ServersGroupID]?.[r]?.IsActive);return t||e}function me(t){t!==void 0&&(l.value=t)}async function _e(t){for(const e of S.value){let r="SUCCESS",d=Q.value[e.ServiceID]?.Code;if(await k.ServiceOrder({Code:d,DependOrderID:t,...e,ContractID:I.value}).then(({result:y,info:O,error:oe})=>{if(y==="SUCCESS"){let U={};d==="Default"?U.ServiceOrderID=O?.ServiceOrderID:U[`${d}OrderID`]=O?.ServiceOrderID,k.ServiceOrderPay(d,U,{XMLHttpRequest:"yes"}).then(M=>{let{result:F,error:se}=M;F==="SUCCESS"?B.push("/AdditionalServices"):F==="BASKET"&&B.push("/Basket")})}else r="ERROR"}),r==="ERROR")break}}function te(){A.value=!0,_.VPSOrder({ContractID:I.value,VPSSchemeID:v.value?.ID,ServerID:de(),DiskTemplate:$.value?.value}).then(({result:t,info:e,error:r})=>{t==="SUCCESS"?(_e(e?.OrderID),_.VPSOrderPay({VPSOrderID:e?.VPSOrderID,DaysPayFromBallance:l.value?.daysFromBalance||0,DaysPay:l.value?.actualDays,IsChange:!0}).then(d=>{let{result:y,error:O}=d;y==="SUCCESS"?B.push("/VPSOrders"):y==="BASKET"&&B.push("/Basket"),A.value=!1})):A.value=!1})}const ve=t=>{Ve(()=>{const e=document.querySelector(".form-input_border-label input:checked~.form-field__content");e&&e.click()})};function pe(){L?.value?.length>0&&($.value=L.value?.[0])}return[m,i]=R(()=>_.fetchVPSSchemes().then(()=>{E.value?.length>0&&(v.value=ee(E.value?.[0])),pe()})),await m,i(),[m,i]=R(()=>V.fetchContracts()),await m,i(),[m,i]=R(()=>P.fetchServerGroups()),await m,i(),[m,i]=R(()=>k.fetchServices()),await m,i(),(t,e)=>{const r=Be,d=Pe,y=We,O=je,oe=ke,U=be,M=he,F=Se,se=fe;return a(),n(b,null,[g(r),o("div",ze,[o("section",Qe,[o("div",Ye,[e[8]||(e[8]=o("div",{class:"section-header"},[o("h1",{class:"section-title"},"Заказать VPS/VDS сервер")],-1)),g(d)])]),g(F,{basic_title:"VPS/VDS сервер",modelValue:X.value,"onUpdate:modelValue":e[6]||(e[6]=s=>X.value=s)},{page:T(()=>[o("section",Ze,[e[9]||(e[9]=o("h2",{class:"section-block_title"},"Конфигурация",-1)),o("div",et,[o("div",tt,[(a(!0),n(b,null,D(z.value,(s,p)=>(a(),n("div",{class:"form-header_col",key:p},u(s),1))),128))]),(a(!0),n(b,null,D(E.value,s=>(a(),K(y,{key:s.ID,data:ee(s),type:"",modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=p=>v.value=p),name:"config",checked:v.value?.ID===s?.ID,headers:z.value,onInput:ve},null,8,["data","modelValue","checked","headers"]))),128))])]),L.value?(a(),n("section",ot,[e[10]||(e[10]=o("h2",{class:"section-block_title"},"Операционная система",-1)),o("div",st,[(a(!0),n(b,null,D(L.value,s=>(a(),K(O,{key:s.value,data:s,modelValue:$.value,"onUpdate:modelValue":e[1]||(e[1]=p=>$.value=p),checked:s?.value===$.value?.value,type:"",name:"operating_system"},{default:T(()=>[s.imageUrl?(a(),n("img",{key:0,src:s.imageUrl,alt:s.name},null,8,at)):x("",!0)]),_:2},1032,["data","modelValue","checked"]))),128))])])):x("",!0),o("section",lt,[e[11]||(e[11]=o("h2",{class:"section-block_title"},"Регион",-1)),o("div",nt,[(a(!0),n(b,null,D(re.value,s=>(a(),K(O,{key:s.value,data:s,checked:s?.value===H,modelValue:H,"onUpdate:modelValue":e[2]||(e[2]=p=>H=p),type:"",name:"region"},null,8,["data","checked"]))),128))])]),g(oe,{title:"Информация о сервере",modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=s=>I.value=s)},null,8,["modelValue"]),g(U,{contractID:I.value,scheme:w.value,serviceID:"30000",isOrderID:!1,onSelect:me,isBalancePay:W.value,"onUpdate:isBalancePay":e[4]||(e[4]=s=>W.value=s)},null,8,["contractID","scheme","isBalancePay"])]),services:T(()=>[g(M,{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=s=>S.value=s),serviceSearchParams:{ServiceID:"30000",ServersGroupID:w.value?.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]),_:1},8,["modelValue"]),o("section",rt,[o("div",ct,[o("div",ut,[l.value?.discounts?.Bonuses?.length>0?(a(),n(b,{key:0},[o("div",it,[e[12]||(e[12]=o("div",{class:"total-block__col"},"Цена тарифа",-1)),o("div",dt,u(C(l.value?.price))+" ₽",1)]),(a(!0),n(b,null,D(l.value?.discounts?.Bonuses,(s,p)=>(a(),n("div",{class:"total-block__row no-divider",key:p},[o("div",mt,"Скидка "+u(s?.Discount)+"% на "+u(s?.Days)+" дней",1),o("div",_t,"-"+u(C(s?.Economy))+" ₽",1)]))),128))],64)):x("",!0),o("div",vt,[e[13]||(e[13]=o("div",{class:"total-block__col"},"Дополнительные услуги",-1)),o("div",pt,u(G.value)+" ₽",1)]),(a(!0),n(b,null,D(S.value,(s,p)=>(a(),n("div",{class:"total-block__row no-divider",key:s.ServiceID+"-"+p},[o("div",ft,u(Q.value[s?.ServiceID]?.Name),1),o("div",St,u(Z(s?.Price))+" ₽",1)]))),128)),le(o("div",ht,[e[14]||(e[14]=o("div",{class:"total-block__col red"},"Выгода",-1)),o("div",bt,[o("span",null,[o("s",null,u(C(l.value?.price))+" ₽",1)]),o("span",kt,"-"+u(C(j()))+" ₽",1)])],512),[[ne,l.value?.discounts?.Bonuses?.length>0]]),le(o("div",It,[o("div",yt,"Итого за "+u(l.value?.label),1),o("div",Dt,u(C(l.value?.price-j()+ +G.value))+" ₽ ",1)],512),[[ne,l.value?.price]])]),g(se,{class:"btn--wide",label:ie.value,disabled:l.value===null||I.value===null,"is-loading":A.value,onClick:e[7]||(e[7]=s=>te())},null,8,["label","disabled","is-loading"])])])])],64)}}},qt=q(gt,[["__scopeId","data-v-0f5d1fcd"]]);export{qt as default};
