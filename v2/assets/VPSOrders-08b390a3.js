import{j as K,o as P,c as L,a as l,Z as E,a9 as H,b as c,w as g,d as C,t as O,F as G,x as re,n as J,k as Se,p as be,l as Ie,_ as le,e as ie,r as B,h as he,S as ce,y as Z,g as j,i as Ve}from"./index-00a0bf0d.js";import{I as pe}from"./IconSearch-ea3f052d.js";import{u as de}from"./vps-f0a3ea5b.js";import{_ as Pe}from"./HelperComponent-2a852b86.js";import{S as me}from"./StatusBadge-4c2dc228.js";import{I as ue}from"./IconRotate-4b2872f9.js";import{f as se}from"./useTimeFunction-8602dd60.js";import{v as Oe}from"./vpsStatuses-32ffaaf5.js";import{f as _e,z as we,k as ke,d as Ce}from"./bootstrap-vue-next.es-be8a8de1.js";import{_ as ye}from"./IconDots-6b52141e.js";import{_ as Be}from"./IconCard-30dada0d.js";import{_ as Re}from"./OrderIDBadge-99ffd0aa.js";import{S as xe}from"./Select2-f35389a7.js";import{s as Me}from"./multiselect-9faec1a5.js";import{_ as fe}from"./ClausesKeeper-ce1dcc35.js";import{u as Ue}from"./contracts-8ab155ab.js";import{B as ve}from"./BlockBalanceAgreement-fb81df3d.js";import{u as Le}from"./globalActions-72d167c2.js";import{_ as Ne,B as De}from"./IconButtonBack-330011b5.js";import{E as Ae}from"./EmptyStateBlock-ccb3476e.js";import{_ as je}from"./FormInputSearch-b340fca7.js";import{_ as Ee}from"./ButtonDefault-4233c21f.js";import"./IconArrow-74dc045b.js";import"./IconClose-97a82d3d.js";import"./IconPlus-578a30b2.js";const He=r=>(be("data-v-67634e6a"),r=r(),Ie(),r),Te={class:"hosting-item"},ze={class:"hosting-item__row"},Fe={class:"hosting-item__row"},qe={class:"hosting-item__person"},Ke={class:"hosting-item__row"},Ze={class:"hosting-item__list"},Ge=["innerHTML"],Je={class:"hosting-status__info"},Qe={class:"hosting-status__date"},We={class:"hosting-item__controls"},Xe={class:"ico"},Ye=He(()=>l("div",{class:"hosting-item__title"},"Перезагрузить виртуальный сервер",-1)),$e={class:"btn btn--dots"};function et(r,t,n,e,R,I){var m,f,k,a,p,b,N,T,z,F,i,o,u;const D=_e,S=Re,h=K("router-link"),y=K("Helper"),w=me,x=ue,M=Be,U=ye,V=we,v=ke,s=Ce;return P(),L("div",Te,[l("div",ze,[E(c(D,{id:"checkbox-"+((m=n.itemData)==null?void 0:m.OrderID),modelValue:e.localSelectedRows[(f=n.itemData)==null?void 0:f.OrderID],"onUpdate:modelValue":t[0]||(t[0]=d=>{var _;return e.localSelectedRows[(_=n.itemData)==null?void 0:_.OrderID]=d}),name:"checkbox-"+((k=n.itemData)==null?void 0:k.OrderID),onChange:e.updateSelectedRows},null,8,["id","modelValue","name","onChange"]),[[H,n.isSeveral]]),c(S,{orderID:(a=n.itemData)==null?void 0:a.OrderID,onClick:t[1]||(t[1]=d=>{var _;return e.toItem((_=n.itemData)==null?void 0:_.OrderID)})},null,8,["orderID"]),c(h,{class:"hosting-item__name",to:`/VPSOrders/${n.itemData.OrderID}`},{default:g(()=>[C(O(n.itemData.IP||n.itemData.Domain),1)]),_:1},8,["to"])]),l("div",Fe,[l("div",qe,O(n.userName),1),c(y,{"user-notice":(p=n.itemData)==null?void 0:p.UserNotice,id:(b=n.itemData)==null?void 0:b.OrderID,position:n.isLast?"bottom":"top",emit:"updateVPSList"},null,8,["user-notice","id","position"])]),l("div",Ke,[l("ul",Ze,[(P(!0),L(G,null,re(n.params,d=>(P(),L("li",{innerHTML:d==null?void 0:d.text},null,8,Ge))),256)),l("div",{class:"btn btn--md btn--bold btn-manage",onClick:t[2]||(t[2]=d=>e.orderManage())},"Управлять заказом")]),l("div",Je,[l("div",{class:J(["hosting-item__date",{danger:Number((N=n.itemData)==null?void 0:N.DaysRemainded)<14}])},O(e.calculateExpirationDate((T=n.itemData)==null?void 0:T.DaysRemainded))+" • "+O(((z=n.itemData)==null?void 0:z.DaysRemainded)||0)+" дн.",3),c(w,{class:"status-badge",status:(F=n.itemData)==null?void 0:F.StatusID,"status-table":"VPSOrders",onClick:t[3]||(t[3]=d=>{var _;return e.openHistoryStatuses((_=n.itemData)==null?void 0:_.ID)})},null,8,["status"]),l("div",Qe,O(e.calculateDaysSinceStatusUpdate((i=n.itemData)==null?void 0:i.StatusDate)),1)])]),l("div",We,[((o=n.itemData)==null?void 0:o.StatusID)==="Active"?(P(),L("div",{key:0,class:J(["btn btn--md btn--border btn--rotate btn--rotate_green button-large btn-reload",{"btn--rotate_gray":((u=n.itemData)==null?void 0:u.StatusID)!=="Active"||e.isReloading,"btn--rotate_loading":e.isReloading}]),onClick:t[4]||(t[4]=(...d)=>e.reloadItem&&e.reloadItem(...d))},[C("Включен"),l("button",null,[l("div",Xe,[c(x)])]),Ye],2)):Se("",!0),l("div",{class:"btn btn--md btn--bold",onClick:t[5]||(t[5]=d=>{var _;return r.$router.push(`/VPSOrders/${(_=n.itemData)==null?void 0:_.OrderID}/SchemeChange`)})},"Изменить тариф"),l("div",{class:"btn btn--md btn--bold",onClick:t[6]||(t[6]=d=>{var _;return r.$router.push(`/VPSOrderPay/${(_=n.itemData)==null?void 0:_.OrderID}`)})},[c(M),C("Оплатить")]),c(s,{class:"dropdown-dots",right:""},{"button-content":g(()=>[l("div",$e,[c(U)])]),default:g(()=>[c(V,{onClick:t[7]||(t[7]=d=>e.transferAccount())},{default:g(()=>[C("Передать на другой аккаунт")]),_:1}),c(V,{onClick:t[8]||(t[8]=d=>e.openPasswordChange())},{default:g(()=>[C("Сменить пароль")]),_:1}),c(V,null,{default:g(()=>{var d;return[c(h,{to:`/VPSOrders/${(d=n.itemData)==null?void 0:d.OrderID}/SchemeChange`},{default:g(()=>[C("Изменить тариф")]),_:1},8,["to"])]}),_:1}),c(v),c(V,{class:"color-red",onClick:t[9]||(t[9]=d=>e.deleteItem())},{default:g(()=>[C("Удалить")]),_:1})]),_:1})])])}const tt={components:{StatusBadge:me,IconRotate:ue,Helper:Pe},props:{params:{type:Array,default:()=>[]},itemData:{type:Object,default:()=>{}},isLast:{type:Boolean,default:!1},userName:{type:String,default:""},isSeveral:{type:Boolean,default:!1},selectedRows:{type:Object,required:!0}},emits:["manage","transfer","delete"],setup(r,{emit:t}){de();const n=ie(),e=B({...r.selectedRows}),R=()=>{t("update-selected-rows",e.value)};he(()=>r.selectedRows,s=>{e.value={...s}},{deep:!0});const I=ce("emitter"),D=B(!1);function S(s){if(!s)return se(new Date);const m=new Date,f=new Date(m.getTime()+s*24*60*60*1e3);return se(f)}function h(){var s;t("delete",(s=r.itemData)==null?void 0:s.ID)}function y(s){n.push(`/VPSOrders/${s}`)}function w(){var s,m;I.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:(s=r.itemData)==null?void 0:s.ID,ServiceID:(m=r.itemData)==null?void 0:m.ServiceID}})}function x(s){I.emit("open-modal",{component:"StatusHistory",data:{modeID:"VPSOrders",rowID:s}})}function M(){var s,m,f;I.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:(s=r.itemData)==null?void 0:s.ID,ServiceID:(m=r.itemData)==null?void 0:m.ServiceID,emitEvent:"updateVPSIDPage",Login:(f=r.itemData)==null?void 0:f.Login}})}function U(){var m;function s(f){D.value=f}I.emit("open-modal",{component:"ReloadVPS",data:{VPSOrderID:(m=r.itemData)==null?void 0:m.ID,isReloading:D.value,onReloadStatusChange:s}})}function V(){var s,m,f;t("manage",{ServiceOrderID:(s=r.itemData)==null?void 0:s.ID,ServiceID:(m=r.itemData)==null?void 0:m.ServiceID,OrderID:(f=r.itemData)==null?void 0:f.OrderID})}function v(s){if(!s)return"";const m=new Date(parseInt(s)*1e3),k=new Date-m,a=Math.floor(k/1e3),p=Math.floor(a/60),b=Math.floor(p/60),N=Math.floor(b/24);return a<60?`${a} сек. от статуса`:p<60?`${p} мин. от статуса`:b<24?`${b} ч. от статуса`:`${N} дн. от статуса`}return{vpsStatuses:Oe,reloadItem:U,isReloading:D,orderManage:V,calculateExpirationDate:S,transferAccount:w,openHistoryStatuses:x,toItem:y,deleteItem:h,calculateDaysSinceStatusUpdate:v,openPasswordChange:M,localSelectedRows:e,updateSelectedRows:R}}},ge=le(tt,[["render",et],["__scopeId","data-v-67634e6a"]]),ot={class:"section"},at={class:"container"},nt={class:"title__icon"},st={class:"btn__group"},rt={class:"group__several"},lt={class:"list-form"},it={class:"list-form_col list-form_col--sm"},ct={class:"list-form_select"},dt={class:"multiselect-option"},mt={key:0};function ut(r,t,n,e,R,I){var m,f,k;const D=ve,S=Ne,h=Ee,y=K("router-link"),w=De,x=_e,M=fe,U=K("Multiselect"),V=je,v=ge,s=Ae;return P(),L(G,null,[c(D),l("div",ot,[l("div",at,[l("div",{class:J(["section-header",e.isSeveral?"column":""])},[l("div",nt,[l("h1",{class:"section-title",onClick:t[0]||(t[0]=a=>e.reloadNow())},O(e.isSeveral?"Продление услуг виртуальных серверов":"VPS/VDS серверы"),1),E(c(S,{onClick:t[1]||(t[1]=a=>e.outSeveralOrders())},null,512),[[H,e.isSeveral]])]),E(l("div",st,[E(c(h,{class:"btn-several",label:"Продлить несколько заказов",onClick:t[2]||(t[2]=a=>e.prolongSeveralOrders())},null,512),[[H,e.getVpsOrders.length>1]]),c(y,{class:"btn btn--blue btn-default",to:"/VPSSchemes"},{default:g(()=>[C("Заказать")]),_:1})],512),[[H,!e.isSeveral]]),E(l("div",rt,[c(w,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":t[3]||(t[3]=a=>e.selectPeriod=a)},null,8,["modelValue"]),c(x,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":t[4]||(t[4]=a=>e.useBalance=a),name:"checkbox-balance"},{default:g(()=>[C("Использовать средства с баланса")]),_:1},8,["modelValue"]),c(h,{label:"Продлить",onClick:t[5]||(t[5]=a=>e.prolongOrders())})],512),[[H,e.isSeveral]])],2),c(M),l("div",lt,[l("div",it,[l("div",ct,[c(U,{modelValue:e.select,"onUpdate:modelValue":t[6]||(t[6]=a=>e.select=a),options:e.getUsers,disabled:((m=e.getUsers)==null?void 0:m.length)<=1,label:"name"},{singlelabel:g(({value:a})=>[l("span",null,"# "+O(a.value.padStart(5,"0"))+" / "+O(a.name),1)]),option:g(({option:a})=>[l("div",dt,"# "+O(a.value.padStart(5,"0"))+" / "+O(a.name),1)]),_:1},8,["modelValue","options","disabled"])])]),c(V,{modelValue:e.search,"onUpdate:modelValue":t[7]||(t[7]=a=>e.search=a)},null,8,["modelValue"])]),e.getVpsOrders&&((f=e.getVpsOrders)==null?void 0:f.length)>0?(P(),L("div",mt,[e.filterProducts&&((k=e.filterProducts)==null?void 0:k.length)>0?(P(!0),L(G,{key:0},re(e.filterProducts,(a,p)=>{var b;return P(),Z(v,{"item-data":a,"is-last":p===e.filterProducts.length-1,"user-name":(b=e.getContracts[a==null?void 0:a.ContractID])==null?void 0:b.Customer,params:e.formItemParamList(a),isSeveral:e.isSeveral,"selected-rows":e.selectedRows,onUpdateSelectedRows:e.handleSelectedRowsUpdate,onDelete:e.deleteItem,onManage:e.orderManage},null,8,["item-data","is-last","user-name","params","isSeveral","selected-rows","onUpdateSelectedRows","onDelete","onManage"])}),256)):(P(),Z(s,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(P(),Z(s,{key:1,class:"no-margin",label:"У вас нет заказов на VPS/VDS серверы"}))])])],64)}const _t={components:{IconSearch:pe,Select2:xe,ClausesKeeper:fe,Multiselect:Me,VpsItem:ge,BlockBalanceAgreement:ve,BlockSelectPeriod:De},async setup(){const r=de(),t=Ue(),n=Le(),e=ie(),R=B(null),I=B("*"),D=B(!1),S=B([]),h=B(null),y=B(!1),w=ce("emitter");w.on("updateVPSList",()=>{r.fetchVPS()});const x=i=>{S.value=i};async function M(){console.log(S.value);const i=Object.keys(S.value).filter(u=>S.value[u]),o={ServiceID:"30000",ItemsPay:h.value,OrdersIDs:i,...y.value&&{UseBalance:"yes"}};await n.OrdersPay(o).then(u=>{u==="Basket"?(console.log("Success"),e.push("/Basket")):(u==null?void 0:u.Status)==="Ok"&&(D.value=!1,w.emit("open-modal",{component:"BalanceProlong",data:{Message:u==null?void 0:u.Message,Count:u==null?void 0:u.Count}}))})}function U(){D.value=!0}function V(){D.value=!1}const v=j(()=>{var i;return(i=Object.keys(r==null?void 0:r.vpsList).map(o=>r==null?void 0:r.vpsList[o]))==null?void 0:i.reverse()}),s=j(()=>r.vpsSchemes),m=j(()=>T(p(v.value))),f=j(()=>t==null?void 0:t.contractsList);Ve(()=>{v.value.length<1&&a()});function k(){e.go(0)}function a(){e.push({path:"/VPSSchemes"})}function p(i){return I.value!=="*"?i.filter(o=>(o==null?void 0:o.ContractID)===I.value):i}function b(i){n.OrderManage(i)}function N(i){w.emit("open-modal",{component:"DeleteItem",data:{id:i,message:`Вы действительно хотите удалить виртуальный сервер #${i}?`,tableID:"VPSOrders",successEmit:"updateVPSList"}})}function T(i){return R.value!==null?i.filter(o=>o==null?void 0:o.IP.toLowerCase().includes(R.value.toLowerCase())):i}const z=j(()=>{let i=[{value:"*",name:"Все договора"}];return v.value!==null?(Object.keys(v.value).forEach(o=>{var u,d,_;i.find(q=>{var A;return q.value===((A=v.value[o])==null?void 0:A.ContractID)})||i.push({value:(u=v.value[o])==null?void 0:u.ContractID,name:(_=f.value[(d=v.value[o])==null?void 0:d.ContractID])==null?void 0:_.Customer})}),i):{value:"*",name:"Все договора"}});function F(i){var u,d,_,q,A,Q,W,X,Y,$,ee,te,oe,ae,ne;const o=(u=s.value)==null?void 0:u[i.SchemeID];return[{text:`${o==null?void 0:o.Name}`},{text:`${(_=(d=o==null?void 0:o.SchemeParams)==null?void 0:d.hdd_mib)==null?void 0:_.InternalName} ${(A=(q=o==null?void 0:o.SchemeParams)==null?void 0:q.hdd_mib)==null?void 0:A.Value} ${(W=(Q=o==null?void 0:o.SchemeParams)==null?void 0:Q.hdd_mib)==null?void 0:W.Unit}`},{text:`RAM ${(Y=(X=o==null?void 0:o.SchemeParams)==null?void 0:X.ram_mib)==null?void 0:Y.Value} ${(ee=($=o==null?void 0:o.SchemeParams)==null?void 0:$.ram_mib)==null?void 0:ee.Unit}`},{text:`Канал ${(oe=(te=o==null?void 0:o.SchemeParams)==null?void 0:te.net_bandwidth_mbitps)==null?void 0:oe.Value} ${(ne=(ae=o==null?void 0:o.SchemeParams)==null?void 0:ae.net_bandwidth_mbitps)==null?void 0:ne.Unit}`}]}return await r.fetchVPS(),await r.fetchVPSSchemes(),await t.fetchContracts(),{getVpsOrders:v,search:R,getContracts:f,select:I,orderManage:b,formItemParamList:F,getUsers:z,filterProducts:m,navigateToVPSSchemes:a,deleteItem:N,reloadNow:k,prolongSeveralOrders:U,isSeveral:D,selectedRows:S,selectPeriod:h,prolongOrders:M,outSeveralOrders:V,useBalance:y,handleSelectedRowsUpdate:x}}},Et=le(_t,[["render",ut],["__scopeId","data-v-3dbccff2"]]);export{Et as default};
