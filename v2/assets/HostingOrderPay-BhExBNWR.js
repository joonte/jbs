import{_ as K}from"./EmptyStateBlock-DgFyy_gi.js";import{_ as T}from"./BlockOrderPayBalance-BulK2jU0.js";import{_ as U}from"./ParamsAccordionBlock-CKTEYLPP.js";import{_ as V}from"./ClausesKeeper-Cjjq7JUL.js";import{_ as j}from"./ButtonDefault-CgQ13ecW.js";import{_ as J}from"./BlockBalanceAgreement-BNU6bIWW.js";import{r as k,f as g,g as M,h as q,v as z,E as f,c as d,b as m,a as e,D as E,F as p,t as l,i as G,I as H,j as Q,J as x,d as W,o as c}from"./index-DakgQwZZ.js";import{u as X}from"./hosting-DbjpRfIi.js";import{u as Y}from"./contracts-C-xJvA56.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-CDL_Y1-V.js";import"./component-BXhtJwv0.js";import"./globalActions-BG7EYttN.js";import"./IconHelp-DQ9vdhmP.js";import"./IconClose-Camrw-uN.js";const ee={class:"tw-px-4 md:tw-px-8"},oe={class:"section-header"},te={class:"section-header__wrapper"},se={class:"section-title"},ae={class:"section-container"},le={class:"section-label __login"},ne={class:"section-label __login"},ce={class:"section"},ie={class:"container"},re={class:"total-block"},_e={class:"total-block__row divider-bottom"},ue={class:"total-block__col"},de={class:"total-block__col"},me={class:"total-block__col"},ve={class:"total-block__row total-block__row--big economy-line"},pe={class:"total-block__col flex-col"},be={class:"red"},ye={class:"total-block__row total-block__row--big"},ge={class:"total-block__col"},he={class:"total-block__col"},ke={__name:"HostingOrderPay",async setup(fe){let i,r;const _=X(),D=Y(),L=M(),B=W(),b=k(!1),o=k(null),y=k(!1),a=g(()=>Object.keys(_?.hostingList).map(s=>_?.hostingList[s]).find(s=>s.OrderID===L.params.id)),u=g(()=>_?.hostingSchemes?.[a.value?.SchemeID]),I=g(()=>D.contractsList);function v(s){return Number(s).toFixed(2)||0}function w(){let s=0;return o.value?.discounts?.Bonuses.map(t=>{s+=+t.Economy}),s}function h(){y.value=!0,_.HostingOrderPay({HostingOrderID:a.value?.ID,DaysPayFromBallance:o.value?.daysFromBalance||0,DaysPay:o.value?.actualDays,IsChange:!0}).then(s=>{let{result:t,error:S}=s;t==="SUCCESS"?B.push(`/HostingOrders/${a.value?.OrderID}`):t==="BASKET"&&B.push("/Basket"),y.value=!1})}const P=s=>{s.key==="Enter"&&s.ctrlKey&&!F.value&&h()},F=g(()=>o.value===null);q(()=>{document.addEventListener("keyup",P)}),z(()=>{document.removeEventListener("keyup",P)});function N(s){o.value=s}return[i,r]=f(()=>_.fetchHostingOrders()),await i,r(),[i,r]=f(()=>_.fetchHostingSchemes()),await i,r(),[i,r]=f(()=>D.fetchContracts()),await i,r(),(s,t)=>{const S=J,C=j,R=V,$=U,A=T,O=K;return c(),d(p,null,[m(S),e("div",ee,[a.value?(c(),d(p,{key:0},[e("div",oe,[e("div",te,[e("h1",se,l(a.value?.Domain),1),m(C,{class:"btn--wide",label:b.value||I.value[a.value.ContractID]?.Balance>o.value?.price?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||o.value?.price===null,"is-loading":y.value,onClick:t[0]||(t[0]=n=>h())},null,8,["label","disabled","is-loading"])]),e("div",ae,[e("span",le,"Логин: "+l(a.value?.Login),1),t[3]||(t[3]=e("span",{class:"section-label __login"},"/",-1)),e("span",ne,"Тариф: "+l(u.value?.Name),1)])]),m(R),m($,{"params-list":u.value?.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),u.value?.IsPayed&&u.value?.IsProlong||!u.value?.IsPayed?(c(),d(p,{key:0},[m(A,{contractID:a.value?.ContractID,daysRemainded:a.value?.DaysRemainded,scheme:u.value,orderID:a.value?.OrderID,isOrderID:!0,onSelect:N,isBalancePay:b.value,"onUpdate:isBalancePay":t[1]||(t[1]=n=>b.value=n)},null,8,["contractID","daysRemainded","scheme","orderID","isBalancePay"]),e("div",ce,[e("div",ie,[e("div",re,[o.value?.discounts?.Bonuses?.length>0?(c(),d(p,{key:0},[e("div",_e,[t[4]||(t[4]=e("div",{class:"total-block__col"},"Цена тарифа",-1)),e("div",ue,l(v(o.value?.price))+" ₽",1)]),(c(!0),d(p,null,Q(o.value?.discounts?.Bonuses,n=>(c(),d("div",{key:n?.Discount+"-"+n?.Days,class:"total-block__row no-divider"},[e("div",de,"Скидка "+l(n?.Discount)+"% на "+l(n?.Days)+" дней",1),e("div",me,"-"+l(v(n?.Economy))+" ₽",1)]))),128))],64)):G("",!0),H(e("div",ve,[t[5]||(t[5]=e("div",{class:"total-block__col red"},"Выгода",-1)),e("div",pe,[e("span",null,[e("s",null,l(v(o.value?.price))+" ₽",1)]),e("span",be,"-"+l(v(w()))+" ₽",1)])],512),[[x,o.value?.discounts?.Bonuses?.length>0]]),H(e("div",ye,[e("div",ge,"Итого за "+l(o.value?.label),1),e("div",he,l(v(o.value?.price-w()))+" ₽",1)],512),[[x,o.value?.price]])]),m(C,{class:"btn--wide",label:b.value||I.value[a.value.ContractID]?.Balance>o.value?.price?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||o.value?.price===null,"is-loading":y.value,onClick:t[2]||(t[2]=n=>h())},null,8,["label","disabled","is-loading"])])])],64)):(c(),E(O,{key:1,class:"no-margin",label:"Заказ нельзя продлить"}))],64)):(c(),E(O,{key:1,label:"не удалось найти заказ хостинга"}))])],64)}}},$e=Z(ke,[["__scopeId","data-v-0cb71668"]]);export{$e as default};
