import{j as U,o as f,c as A,a as r,t as y,b as d,x as C,w as _,d as T,F as E,p as J,l as Q,_ as F,e as M,f as z,r as O,g as V,v as X,n as H,k as Y,a7 as Z,R as $,i as ee}from"./index-4434f005.js";import{u as te}from"./services-de1bc20c.js";import{u as q}from"./contracts-d017d511.js";import"./postings-9b7fbb4e.js";import{u as oe}from"./globalActions-e617f474.js";import{f as R}from"./useTimeFunction-8602dd60.js";import{_ as W}from"./IconCard-285cc6ac.js";import{E as N}from"./EmptyStateBlock-927727c9.js";import{S as G}from"./StatusBadge-129e5649.js";import{s as se}from"./servicesStatuses-6293b6ac.js";import{_ as ne}from"./HelperComponent-e4e3ffbd.js";import{z as ce,k as re,d as ae,C as ie}from"./bootstrap-vue-next.es-5d8af788.js";import{_ as le}from"./IconDots-a0319d0c.js";import{_ as de}from"./ClausesKeeper-68df7f35.js";import{_ as _e}from"./ButtonDefault-f91c301e.js";import{s as ue}from"./multiselect-eb561fe9.js";import{B as K}from"./BlockBalanceAgreement-4e844242.js";import{_ as me}from"./IconArrow-6847c901.js";import"./IconClose-0cfbf563.js";const ve=[{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],w=c=>(J("data-v-768f230e"),c=c(),Q(),c),De={class:"section-header"},pe={class:"section-title__nowrap"},fe={class:"section-title"},Ie={class:"btn__group"},Se=w(()=>r("span",{class:"td-mobile"},"Заказ",-1)),be=w(()=>r("span",{class:"td-mobile"},"Договор",-1)),ge=w(()=>r("span",{class:"td-mobile"},"Статус",-1)),ye=w(()=>r("span",{class:"td-mobile"},"Дата окончания",-1)),ke=w(()=>r("span",{class:"td-mobile"},"Комментарий",-1)),he={class:"service__controls-wrapper"},Ce=["onClick"],Oe={class:"btn btn--dots"};function we(c,l,i,e,k,I){var h,o,L;const D=_e,S=de,p=G,m=U("Helper"),b=W,u=le,s=U("router-link"),t=ce,n=re,g=ae,B=ie,x=N;return f(),A(E,null,[r("div",De,[r("div",pe,[r("h1",fe,y((h=i.sectionData)==null?void 0:h.Item),1),r("div",Ie,[d(D,{label:"Заказать",onClick:l[0]||(l[0]=a=>e.navigateToOrder())})])]),d(S,{class:"additional-clauses",partition:`Header:${((o=i.sectionData)==null?void 0:o.Code)==="Default"?i.sectionID:`/${(L=i.sectionData)==null?void 0:L.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(f(),C(B,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":l[1]||(l[1]=a=>e.sortBy=a),"sort-desc":e.sortDesc,"onUpdate:sortDesc":l[2]||(l[2]=a=>e.sortDesc=a),"sort-direction":e.sortDirection},{"cell(ID)":_(a=>[Se,r("span",null,y(a.value),1)]),"cell(ContractID)":_(a=>{var v;return[be,r("span",null,y((v=e.getContracts[a.value])==null?void 0:v.Customer),1)]}),"cell(StatusID)":_(a=>[ge,d(p,{status:a.value,"status-table":"Orders"},null,8,["status"])]),"cell(ExpirationDate)":_(a=>{var v,j;return[ye,r("span",null,y(e.calculateExpirationDate((v=a.item)==null?void 0:v.DaysRemainded))+" | "+y(((j=a.item)==null?void 0:j.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":_(a=>{var v;return[ke,d(m,{"user-notice":a.value,id:(v=a.item)==null?void 0:v.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":_(a=>[r("div",he,[r("div",{class:"btn btn--md btn--bold",onClick:v=>c.$router.push(`/ServiceOrderPay/${a.item.ID}`)},[d(b),T("Оплатить")],8,Ce),d(g,{class:"dropdown-dots",right:""},{"button-content":_(()=>[r("div",Oe,[d(u)])]),default:_(()=>[d(t,null,{default:_(()=>[d(s,{to:`/AdditionalServices/${a.item.ID}`},{default:_(()=>[T("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),d(n),d(t,{class:"color-red",onClick:v=>c.$emit("deleteItem",a.item)},{default:_(()=>[T("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","sort-direction"])):(f(),C(x,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const Be={components:{EmptyStateBlock:N,StatusBadge:G,IconCard:W,Helper:ne},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList"],setup(c){const l=M(),i=z(),e=O("ID"),k=O(!0),I=O("desc"),D=q(),S=V(()=>D==null?void 0:D.contractsList),p=V(()=>{var u,s;return(s=(u=Object.keys(i==null?void 0:i.userOrders).map(t=>{var n;return{...i==null?void 0:i.userOrders[t],ID:Number((n=i==null?void 0:i.userOrders[t])==null?void 0:n.ID)}}))==null?void 0:u.reverse())==null?void 0:s.filter(t=>t.ServiceID===(c==null?void 0:c.sectionID))});function m(){l.push(`/AdditionalServicesOrder?ServiceID=${c==null?void 0:c.sectionID}`)}function b(u){if(!u)return R(new Date);const s=new Date,t=new Date(s.getTime()+u*24*60*60*1e3);return R(t)}return{authStore:i,getOrders:p,getContracts:S,sortBy:e,sortDesc:k,sortDirection:I,navigateToOrder:m,servicesStatuses:se,oneTimeWorksFields:ve,calculateExpirationDate:b}}},P=F(Be,[["render",we],["__scopeId","data-v-768f230e"]]),xe={class:"section"},Ae={class:"container"},Ne={class:"section-header"},Le={class:"section-nav"},Te=["onClick"],Ue={class:"multiselect-option"},Ee={class:"section-body"};function Ve(c,l,i,e,k,I){var u,s,t,n,g,B,x,h;const D=K,S=me,p=U("Multiselect"),m=P,b=N;return f(),A(E,null,[d(D),r("div",xe,[r("div",Ae,[r("div",Ne,[r("div",Le,[(f(!0),A(E,null,X((u=e.getServices)==null?void 0:u.slice(0,3),o=>(f(),A("div",{class:H(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(o==null?void 0:o.ID)}]),onClick:L=>e.switchToSection(o==null?void 0:o.ID)},y(o==null?void 0:o.Item),11,Te))),256)),((s=e.getServices)==null?void 0:s.length)>3?(f(),C(p,{key:0,modelValue:e.section,"onUpdate:modelValue":l[0]||(l[0]=o=>e.section=o),class:H({"multiselect--white additional-service__select":!0,"additional-service__select_active":(n=e.getServices)==null?void 0:n.slice(3,(t=e.getServices)==null?void 0:t.length).find(o=>(o==null?void 0:o.ID)===e.section)}),options:(B=e.getServices)==null?void 0:B.slice(3,(g=e.getServices)==null?void 0:g.length),label:"ID",onSelect:l[1]||(l[1]=o=>e.switchToSection(o))},{option:_(({option:o})=>[r("div",Ue,y(o==null?void 0:o.Item),1)]),caret:_(()=>[d(S,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):Y("",!0)])]),r("div",Ee,[(x=e.getServices)!=null&&x.find(o=>o.ID===e.section)?(f(),C(m,{key:0,sectionID:e.section,sectionData:(h=e.getServices)==null?void 0:h.find(o=>o.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(f(),C(b,{key:1,label:"Услуга не найдена"}))])])])],64)}const je={components:{ServiceListSection:P,emptyStateBlock:N,Multiselect:ue,BlockBalanceAgreement:K},async setup(){const c=Z(),l=M(),i=$("emitter"),e=te(),k=oe(),I=z(),D=q(),S=O(null),p=V(()=>{var s;return(s=Object.keys(e==null?void 0:e.ServicesList))==null?void 0:s.map(t=>{var n;return{...e==null?void 0:e.ServicesList[t],value:(n=e==null?void 0:e.ServicesList[t])==null?void 0:n.ID}}).filter(t=>(t==null?void 0:t.ServicesGroupID)!=="1000"&&(t==null?void 0:t.IsActive)&&!(t!=null&&t.IsHidden)).sort((t,n)=>Number(t==null?void 0:t.SortID)<Number(n==null?void 0:n.SortID)?-1:Number(t==null?void 0:t.SortID)>Number(n==null?void 0:n.SortID)?1:0)}),m=O(null);i.on("updateServicesList",()=>{I.fetchUserOrders()});function b(s){l.replace(`/AdditionalServices?ServiceID=${s}`),m.value=s}function u(s){k.deleteItem({TableID:"Orders",RowsIDs:s.ID}).then(({result:t,error:n})=>{t==="SUCCESS"&&I.fetchUserOrders()})}return ee(()=>{var s,t;(s=p.value)!=null&&s.find(n=>{var g;return(n==null?void 0:n.ID)===((g=c==null?void 0:c.query)==null?void 0:g.ServiceID)})?m.value=(t=c==null?void 0:c.query)==null?void 0:t.ServiceID:l.replace(`/AdditionalServices?ServiceID=${m.value}`)}),await e.fetchServices().then(()=>{var s,t;m.value=(t=(s=p.value)==null?void 0:s[0])==null?void 0:t.ID}),await D.fetchContracts(),await I.fetchUserOrders(),{section:m,deleteItem:u,getServices:p,additionalServicesValue:S,switchToSection:b}}},st=F(je,[["render",Ve],["__scopeId","data-v-5443aad9"]]);export{st as default};
