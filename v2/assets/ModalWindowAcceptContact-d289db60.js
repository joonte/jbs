import{o as V,c as k,a as f,t as _,b,_ as A,f as x,g as u,r as d,i as B}from"./index-1c309346.js";import{_ as S}from"./ButtonDefault-cd183bf8.js";import{_ as q}from"./BasicInput-33bf464f.js";import"./component2-139d1cad.js";import"./component-a2c8255f.js";const w={class:"modal__body"},O=f("div",{class:"list-item__title"},"Введите код подтверждения",-1),R={class:"list-item__subtitle"},j={class:"modal__accept-form"};function N(t,n,I,e,c,r){const l=q,i=S;return V(),k("div",w,[O,f("div",R,"Прислали на "+_(e.mergedData.methodId)+" «"+_(e.mergedData.address)+"» ID - "+_(e.mergedData.contactId),1),f("div",j,[b(l,{label:"Код подтверждения",name:"mailCode",placeholder:"Введите код",modelValue:e.codeMail,"onUpdate:modelValue":n[0]||(n[0]=s=>e.codeMail=s)},null,8,["modelValue"]),b(i,{class:"modal__button",label:"Подтвердить",onClick:n[1]||(n[1]=s=>e.acceptCode())})])])}const U={props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(t,{emit:n}){const I=x(),e=u(()=>I.userInfo),c=u(()=>{var o,a;return(a=Object.keys((o=e.value)==null?void 0:o.Contacts))==null?void 0:a.map(C=>{var p,v,g,h,D;if(!((g=(v=(p=e.value)==null?void 0:p.Contacts)==null?void 0:v[C])!=null&&g.IsHidden))return(D=(h=e.value)==null?void 0:h.Contacts)==null?void 0:D[C]})}),r=d(""),l=d(t.data.contactId||""),i=d(t.data.methodId||""),s=d(t.data.address||""),y=t.data.sendConfirmRequest;B(()=>{console.log(c.value)});const M=o=>c.value.find(a=>a.ID===o),m=u(()=>{const o=M(t.data.contactId);return o?{...t.data,methodId:o.MethodID,address:o.Address}:(console.error("Контакт не найден по ID",t.data.contactId),t.data)});return{methodId:i,address:s,contactId:l,acceptCode:async()=>{const o={Method:m.value.methodId,Value:m.value.address,ContactID:t.data.contactId,Confirm:r.value};try{(await y("/API/Confirm",o)).Status==="Ok"?(n("modalClose"),console.log("Код подтверждения отправлен успешно")):console.error("Ошибка подтверждения кода")}catch(a){console.error("Ошибка запроса подтверждения кода",a)}},codeMail:r,mergedData:m}}},G=A(U,[["render",N]]);export{G as default};
