import{_ as R}from"./EmptyStateBlock-DgFyy_gi.js";import{_ as W}from"./IconClose-Camrw-uN.js";import{_ as H}from"./ClausesKeeper-Cjjq7JUL.js";import{_ as U}from"./BlockBalanceAgreement-BNU6bIWW.js";import{c as O,b as C,a as f,D as P,w as q,ap as F,F as x,r as G,u as K,f as k,m as Y,v as z,h as J,y as Q,d as X,W as Z,al as ee,G as te,o as p,j as oe}from"./index-DakgQwZZ.js";import{u as ne,n as se}from"./networkController-B4RgbGzn.js";import{u as re}from"./postings-CaUZn88T.js";import{u as ce}from"./contracts-C-xJvA56.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ButtonDefault-CgQ13ecW.js";const ae={async setup(){const l=ne(),i=G(null),y=re(),d=ce(),S=K(),u=k(()=>S.userInfo),I=k(()=>Object.keys(u.value?.Contacts)?.map(e=>{if(!u.value?.Contacts?.[e]?.IsHidden)return u.value?.Contacts?.[e]})),g=e=>I.value.find(t=>t.ID===e),n=X(),o=Q("emitter"),v=[{old:"/v2/DNSmanagerSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=52000"},{old:"/v2/ExtraIPSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=50000"},{old:"/v2/ISPswSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=51000"}],h=k(()=>{let e={};return Object.keys(l?.notesList).reverse().forEach(t=>{e[t]=l?.notesList?.[t]}),Object.keys(e).length>0?e:null});function a(){let e={};Object.keys(l?.notesList).reverse().forEach(t=>{b(t)&&(e[t]=l?.notesList?.[t])}),i.value=e}function b(e){return document.cookie.match(RegExp(`(?:^|;\\s*)${e}=([^;]*)`))===null}function _(e){return Object.values(e).map((t,r)=>{let s=t;const c=/<NOBODY>/gi;return s=s.replace(c,"<div>"),s=s.replace(/<\/NOBODY>/gi,"</div>"),v.forEach(({old:w,new:m})=>{const T=new RegExp(`<a[^>]*href="${w}"[^>]*>`,"gi");s=s.replace(T,V=>V.replace(`href="${w}"`,`href="${m}"`))}),s})}function M(e){n.push(e)}function N(e){let t=new Date;t.setDate(30+t.getDate()),delete i.value[e],document.cookie=`${e}=hidden; path=/; expires=${t}`,o.emit("notes-reduce"),console.log(document.cookie,2),console.log(e,2)}const E=async(e,t)=>{try{return(await ee.post(e,t)).data}catch(r){throw new Error(`Error sending confirm request: ${r.message}`)}};async function D(e,t){if(e.includes("ISPswSchemes")&&n.push("/AdditionalServicesOrder?ServiceID=51000"),e.includes("ExtraIPSchemes")&&n.push("/AdditionalServicesOrder?ServiceID=50000"),e.includes("DNSmanagerSchemes")&&n.push("/AdditionalServicesOrder?ServiceID=52000"),e.includes("OrderPay")){let r=t[Object.keys(t).find(s=>s.includes("OrderID"))];e!=="/ExtraIPOrderPay"&&e!=="/ISPswOrderPay"&&e!=="/DNSmanagerOrderPay"?n.push(`${e}/${r}`):e==="/ExtraIPOrderPay"||e==="/ISPswOrderPay"||e==="/DNSmanagerOrderPay"?n.push(`${e}/${r}`):n.push(`/ServiceOrderPay/${r}`)}else if(e==="/InvoiceDocument")y.InvoiceDocument({InvoiceID:t.InvoiceID}).then(r=>{o.emit("open-modal",{component:"InvoiceDocument",data:{html:r,ID:t.InvoiceID}})});else if(e==="/API/OrdersTransfer")o.emit("open-modal",{component:"TakeOrder",data:{OrdersTransferID:t}});else if(e==="/ContractMake")n.push("ContractMake");else if(e==="/HostingOrderSchemeChange")n.push(`/HostingOrders/${t.OrderID}/SchemeChange`);else if(e==="/VPSOrderSchemeChange")n.push(`/VPSOrders/${t.OrderID}/SchemeChange`);else if(e==="/DomainSelectOwner")o.emit("open-modal",{component:"DomainSelectOwner",data:t});else if(e==="/ISPswOrders")n.push("AdditionalServices");else if(e==="/ContactEdit?MethodID=VKontakte")o.emit("open-modal",{component:"CreateVK"});else if(e==="/ContactEdit?MethodID=Telegram")o.emit("open-modal",{component:"CreateTelegram"});else if(e==="/ContactEdit?MethodID=Viber")o.emit("open-modal",{component:"CreateViber"});else if(e==="/ContactEdit?MethodID=SMS")o.emit("open-modal",{component:"CreatePhone"});else if(e.includes("/ContactEdit")){t?.MethodID==="SMS"&&o.emit("open-modal",{component:"CreatePhone"});const r=e.match(/ContactID=(\d+)/),s=r?r[1]:null;if(s){const c=g(s);if(c){const w={Method:c.MethodID,Value:c.Address,ContactID:c.ID};try{const m=await E(`${Z}/API/Confirm`,w);m.Status==="Ok"?o.emit("open-modal",{component:"AcceptContact",data:{contactId:s,sendConfirmRequest:E}}):console.error(`Error confirming code. Status: ${m.Status}, Message: ${m.Message}`)}catch(m){console.error("Error accepting contact:",m.message)}}}else console.error("ContactID is not present in the URL params.",e)}else e==="/ProfileEdit"?n.push(`/ContractEdit/${t.ProfileID}`):o.emit("open-modal",{component:e.replace("/",""),data:t})}function A(){}function j(e,t,r,s){se.post(e,t).then(c=>{c.data.Status==="Exception"?o.emit("open-modal",{component:"ExclusionWindow",data:c.data}):l.fetchNotes().then(()=>{a()})}).catch(c=>{console.error("Ошибка при выполнении запроса:",c)})}function B(e,t){o.emit("open-modal",{component:"DeleteItem",data:{id:null,callback:t,message:e,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function L(){}function $(){window.ShowWindow=D.bind(this)}return Y(()=>{$()}),z(()=>{window.ShowWindow=null}),J(()=>{console.log(i,"view");const e=h.value;e&&(i.value=_(e),console.log(_(e)),a())}),o.on("close-modal",()=>{$()}),window.ShowProgress=L.bind(this),window.ShowWindow=D.bind(this),window.PromptShow=A.bind(this),window.AjaxCall=j.bind(this),window.ShowConfirm=B.bind(this),await l.fetchNotes().then(()=>{a()}),await d.fetchContracts(),await d.fetchProfiles(),await S.fetchUserData(),{getNotesList:h,notes:i,ShowWindow:D,deleteItem:N,processNotes:_,redirectToNewPage:M}}},le={class:"section"},de={class:"container"},me={class:"notes"};function pe(l,i,y,d,S,u){const I=U,g=H,n=W,o=te("note"),v=R;return p(),O(x,null,[C(I),f("section",le,[f("div",de,[i[0]||(i[0]=f("div",{class:"section-header"},[f("h1",{class:"section-title"},"Уведомления")],-1)),C(g),f("div",me,[d.notes&&Object.keys(d.notes).length>0?(p(),P(F,{key:0,tag:"div",name:"list",class:"notes__transition-container tw-space-y-4"},{default:q(()=>[(p(!0),O(x,null,oe(d.notes,(h,a)=>(p(),O("div",{class:"tw-relative tw-border tw-border-gray-200 tw-rounded tw-py-4 tw-pl-4 tw-pr-12",key:a},[C(n,{class:"tw-absolute tw-top-4 tw-right-4 tw-size-5 tw-cursor-pointer hover:tw-text-orange-500",onClick:b=>d.deleteItem(a)},null,8,["onClick"]),(p(),P(o,{innerHTML:h,item:h,index:a,key:a},null,8,["innerHTML","item","index"]))]))),128))]),_:1})):(p(),P(v,{key:1,label:"Все уведомления прочитаны или они еще не пришли"}))])])])],64)}const Oe=ie(ae,[["render",pe],["__scopeId","data-v-8ea0d2f7"]]);export{Oe as default};
