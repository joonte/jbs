import{E as pe}from"./EmptyStateBlock-5a6a4cd4.js";import{_ as he}from"./ButtonDefault-cd183bf8.js";import{_ as Se}from"./BlockOrderPayBalance-8fab58d2.js";import{_ as ce,a6 as ne,e as re,r as w,i as be,o as D,c as k,a as e,n as se,t as n,b as f,Y as j,ad as G,m as oe,F as T,R as De,g as U,af as W,w as le,v as ae,k as ke,p as fe,l as ge}from"./index-1c309346.js";import{u as ye}from"./hosting-fd5f9472.js";import{u as Ie}from"./contracts-7b919c67.js";import{u as Ce}from"./domain-89453842.js";import{u as Oe}from"./services-4f3539cc.js";import{_ as Be}from"./paramsAccordionBlock-10c330d0.js";import{D as we}from"./DomainCheckBlock-8a40919c.js";import{_ as Ee}from"./BlockSelectContract-13fe66da.js";import{_ as $e}from"./ClausesKeeper-b9906182.js";import Ve from"./BlockAdditionalServices-f9716b56.js";import"./bootstrap-vue-next.es-b799f76d.js";import"./IconHelp-648316fb.js";import"./globalActions-8efdfe11.js";import"./BasicInput-33bf464f.js";import"./component2-139d1cad.js";import"./component-a2c8255f.js";import"./IconArrow-6927efe5.js";import"./multiselect-b7ad6876.js";import"./IconClose-7cf50ca7.js";import"./ServiceListOrderSelection-d47a53de.js";const Ne={class:"section"},Pe={class:"container"},He={class:"section-nav"},Re={__name:"BlockOrderServiceWrapper",props:{basic_title:{type:String,default:"basic_title"},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(E,{emit:_}){const u=E,v=ne(),y=re(),a=w("");function m(){return v.fullPath.includes("?section=Services")}function L(d=null){d?(a.value="Services",y.replace({query:{section:"Services"}})):(a.value="",y.replace({query:{}})),_("update:modelValue",d||"")}return be(()=>{v.query.section==="Services"&&(a.value="Services")}),(d,l)=>{const I=$e;return D(),k(T,null,[e("div",Ne,[e("div",Pe,[e("div",He,[e("div",{class:se(["section-nav__item",[m()?"":"active"]]),onClick:l[0]||(l[0]=$=>L())},n(u.basic_title),3),e("div",{class:se(["section-nav__item",[m()?"active":""]]),onClick:l[1]||(l[1]=$=>L("Services"))},"Услуги",2)])])]),f(I),e("div",null,[j(e("div",null,[oe(d.$slots,"page",{},void 0,!0)],512),[[G,a.value===""]]),j(e("div",null,[oe(d.$slots,"services",{},void 0,!0)],512),[[G,a.value!==""]])])],64)}}},xe=ce(Re,[["__scopeId","data-v-e8bb070c"]]);const K=E=>(fe("data-v-e6086e89"),E=E(),ge(),E),Ae={class:"hosting-sheme"},Fe={class:"section"},Ue={class:"container"},Te={class:"section-header"},Le={class:"section-title"},qe=K(()=>e("div",{class:"section-label"},"Хостинг",-1)),We={class:"section"},je={class:"container"},Ge={class:"total-block"},Ke={class:"total-block__row divider-bottom"},ze=K(()=>e("div",{class:"total-block__col"},"Цена тарифа",-1)),Me={class:"total-block__col"},Ye={class:"total-block__row no-divider"},Je={class:"total-block__col"},Qe={class:"total-block__col"},Xe={class:"total-block__row"},Ze=K(()=>e("div",{class:"total-block__col"},"Дополнительные услуги",-1)),et={class:"total-block__col"},tt={class:"total-block__row no-divider"},st={class:"total-block__col"},ot={class:"total-block__col"},lt={class:"total-block__row total-block__row--big economy-line"},at=K(()=>e("div",{class:"total-block__col red"},"Выгода",-1)),ct={class:"total-block__col flex-col"},nt={class:"red"},rt={class:"total-block__row total-block__row--big"},it={class:"total-block__col"},_t={class:"total-block__col"},ut={key:1,class:"section"},dt={class:"container"},vt={__name:"HostingScheme",async setup(E){let _,u;const v=ye(),y=Ie(),a=Ce(),m=Oe();De("emitter");const L=ne(),d=re(),l=w(null),I=w([]),$=w(!1),C=w(null),i=w(null),Y=w(""),V=U(()=>{var o;return(o=v==null?void 0:v.hostingSchemes)==null?void 0:o[L.params.id]}),ie=U(()=>y==null?void 0:y.contractsList),J=U(()=>m==null?void 0:m.ServicesList),_e=U(()=>{var o;return(o=Object.keys(a==null?void 0:a.domainSchemes))==null?void 0:o.map(s=>{var c;return{...a==null?void 0:a.domainSchemes[s],value:(c=a==null?void 0:a.domainSchemes[s])==null?void 0:c.ID}})}),Q=U(()=>{let o=0;return I.value.forEach(s=>{o+=s==null?void 0:s.Price}),N(o)||0});function X(){var s,c;let o=0;return(c=(s=l.value)==null?void 0:s.discounts)==null||c.Bonuses.map(p=>{o+=+p.Economy}),o}function N(o){return Number(o).toFixed(2)||0}function ue(o){i.value=o}function de(o){l.value=o}async function ve(o){var s;for(const c of I.value){console.log(c);let p="SUCCESS",h=(s=J.value[c.ServiceID])==null?void 0:s.Code;if(await m.ServiceOrder({Code:h,DependOrderID:o,...c,ContractID:C.value}).then(({result:O,info:r,error:P})=>{if(O==="SUCCESS"){let S={};h==="Default"?S.ServiceOrderID=r==null?void 0:r.ServiceOrderID:S[`${h}OrderID`]=r==null?void 0:r.ServiceOrderID,m.ServiceOrderPay(h,S).then(B=>{let{result:g,error:R}=B;g==="SUCCESS"?d.push("/AdditionalServices}"):g==="BASKET"&&d.push("/Basket")})}else p="ERROR"}),p==="ERROR")break}}function me(){var o,s,c,p,h,O,r,P,S,B,g;$.value=!0,v.HostingOrder({ContractID:C.value,Domain:`${((o=i.value)==null?void 0:o.line)||""}${(s=i.value)!=null&&s.line&&((c=i.value)!=null&&c.Name)?"."+(((p=i.value)==null?void 0:p.Name)||""):""}`,DomainName:(h=i.value)==null?void 0:h.line,HostingSchemeID:(O=V.value)==null?void 0:O.ID,DomainSchemeID:(r=i.value)!=null&&r.line&&((P=i.value)!=null&&P.ID)?(S=i.value)==null?void 0:S.ID:null,DomainTypeID:(B=i.value)!=null&&B.line?(g=i.value)!=null&&g.Name?"Order":"Nothing":"None"}).then(({result:R,info:b,error:z})=>{var x,A;R==="SUCCESS"?(ve(b==null?void 0:b.OrderID),v.HostingOrderPay({HostingOrderID:b==null?void 0:b.HostingOrderID,DaysPayFromBallance:((x=l.value)==null?void 0:x.daysFromBalance)||0,DaysPay:(A=l.value)==null?void 0:A.actualDays}).then(q=>{let{result:F,error:M}=q;F==="SUCCESS"?d.push("/HostingOrders"):F==="BASKET"&&d.push("/Basket"),$.value=!1})):$.value=!1})}return[_,u]=W(()=>a.fetchDomainSchemes()),await _,u(),[_,u]=W(()=>v.fetchHostingSchemes()),await _,u(),[_,u]=W(()=>y.fetchContracts()),await _,u(),[_,u]=W(()=>m.fetchServices()),await _,u(),(o,s)=>{var O,r,P,S,B,g,R,b,z,x,A,q,F,M,Z,ee,te;const c=Se,p=he,h=pe;return D(),k("div",Ae,[(O=V.value)!=null&&O.ID?(D(),k(T,{key:0},[e("div",Fe,[e("div",Ue,[e("div",Te,[e("h1",Le,n((r=V.value)==null?void 0:r.Name),1),qe])])]),f(xe,{basic_title:"Хостинг",modelValue:Y.value,"onUpdate:modelValue":s[2]||(s[2]=t=>Y.value=t)},{page:le(()=>{var t;return[f(Be,{"params-list":(t=V.value)==null?void 0:t.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),f(Ee,{title:"Договор",modelValue:C.value,"onUpdate:modelValue":s[0]||(s[0]=H=>C.value=H)},null,8,["modelValue"]),f(c,{contractID:C.value,scheme:V.value,isOrderID:!1,onSelect:de},null,8,["contractID","scheme"]),f(we,{"domain-list":_e.value,onSelect:ue},null,8,["domain-list"])]}),services:le(()=>{var t;return[f(Ve,{modelValue:I.value,"onUpdate:modelValue":s[1]||(s[1]=H=>I.value=H),serviceSearchParams:{ServiceID:"10000",ServersGroupID:(t=V.value)==null?void 0:t.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]}),_:1},8,["modelValue"]),e("div",We,[e("div",je,[j(e("div",Ge,[((B=(S=(P=l.value)==null?void 0:P.discounts)==null?void 0:S.Bonuses)==null?void 0:B.length)>0?(D(),k(T,{key:0},[e("div",Ke,[ze,e("div",Me,n(N((g=l.value)==null?void 0:g.price))+" ₽",1)]),(D(!0),k(T,null,ae((b=(R=l.value)==null?void 0:R.discounts)==null?void 0:b.Bonuses,t=>(D(),k("div",Ye,[e("div",Je,"Скидка "+n(t==null?void 0:t.Discount)+"% на "+n(t==null?void 0:t.Days)+" дней",1),e("div",Qe,"-"+n(N(t==null?void 0:t.Economy))+" ₽",1)]))),256))],64)):ke("",!0),e("div",Xe,[Ze,e("div",et,n(Q.value)+" ₽",1)]),(D(!0),k(T,null,ae(I.value,t=>{var H;return D(),k("div",tt,[e("div",st,n((H=J.value[t==null?void 0:t.ServiceID])==null?void 0:H.Name),1),e("div",ot,n(N(t==null?void 0:t.Price))+" ₽",1)])}),256)),j(e("div",lt,[at,e("div",ct,[e("span",null,[e("s",null,n(N((z=l.value)==null?void 0:z.price))+" ₽",1)]),e("span",nt,"-"+n(X())+" ₽",1)])],512),[[G,((q=(A=(x=l.value)==null?void 0:x.discounts)==null?void 0:A.Bonuses)==null?void 0:q.length)>0]]),e("div",rt,[e("div",it,"Итого за "+n((F=l.value)==null?void 0:F.label),1),e("div",_t,n(N(((M=l.value)==null?void 0:M.price)-X()+ +Q.value))+" ₽",1)])],512),[[G,(Z=l.value)==null?void 0:Z.price]]),f(p,{class:"btn--wide",label:((ee=ie.value[C.value])==null?void 0:ee.Balance)>((te=l.value)==null?void 0:te.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:l.value===null||C.value===null,"is-loading":$.value,onClick:s[3]||(s[3]=t=>me())},null,8,["label","disabled","is-loading"])])])],64)):(D(),k("div",ut,[e("div",dt,[f(h,{label:"Тариф не найден"})])]))])}}},At=ce(vt,[["__scopeId","data-v-e6086e89"]]);export{At as default};
