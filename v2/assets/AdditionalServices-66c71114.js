import{j as q,o as O,c as G,a as d,t as w,b as p,y as E,w as I,d as M,k as X,F as z,p as le,l as de,_ as J,e as Q,f as Y,S as Z,r as V,g as A,h as $,i as _e,x as ue,n as K,a7 as me}from"./index-5e313302.js";import{u as ee}from"./services-21abfb71.js";import{u as te}from"./contracts-3351d68f.js";import"./postings-03760ecf.js";import{u as ne}from"./globalActions-a7429ad5.js";import{u as fe}from"./resetServer-2f6a71c3.js";import{f as W}from"./useTimeFunction-8602dd60.js";import{_ as oe}from"./IconCard-67ad5f17.js";import{E as R}from"./EmptyStateBlock-9f752916.js";import{S as se}from"./StatusBadge-98696de1.js";import{s as ve}from"./servicesStatuses-6293b6ac.js";import{_ as De}from"./HelperComponent-21d9fd2e.js";import{z as Ie,k as ge,d as pe,C as Se}from"./bootstrap-vue-next.es-a19a8b41.js";import{_ as ke}from"./IconDots-f060bcd6.js";import{_ as be}from"./ClausesKeeper-eb954229.js";import{_ as Oe}from"./ButtonDefault-7c216fc6.js";import{s as ye}from"./multiselect-bfc29db8.js";import{B as re}from"./BlockBalanceAgreement-bb87adc1.js";import{_ as he}from"./IconArrow-555f9d45.js";import"./IconClose-1f889a2e.js";const Ce=[{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],H=f=>(le("data-v-bdee9fb1"),f=f(),de(),f),Pe={class:"section-header"},we={class:"section-title__nowrap"},xe={class:"section-title"},Be={class:"btn__group"},Ne=H(()=>d("span",{class:"td-mobile"},"Заказ",-1)),je=["onClick"],Le=H(()=>d("span",{class:"td-mobile"},"Договор",-1)),Te=H(()=>d("span",{class:"td-mobile"},"Ключевые поля",-1)),Ae=["title"],Ee=H(()=>d("span",{class:"td-mobile"},"Статус",-1)),He=H(()=>d("span",{class:"td-mobile"},"Дата окончания",-1)),Ue=H(()=>d("span",{class:"td-mobile"},"Комментарий",-1)),Me={class:"service__controls-wrapper"},Ve=["onClick"],Ge={class:"btn btn--dots"};function Re(f,_,u,e,B,N){var x,r,T;const j=Oe,y=be,m=se,b=q("Helper"),S=oe,h=ke,C=q("router-link"),a=Ie,o=ge,l=pe,P=Se,L=R;return O(),G(z,null,[d("div",Pe,[d("div",we,[d("h1",xe,w((x=u.sectionData)==null?void 0:x.Item),1),d("div",Be,[p(j,{label:"Заказать",onClick:_[0]||(_[0]=n=>e.navigateToOrder())})])]),p(y,{class:"additional-clauses",partition:`Header:${((r=u.sectionData)==null?void 0:r.Code)==="Default"?u.sectionID:`/${(T=u.sectionData)==null?void 0:T.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(O(),E(P,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":_[1]||(_[1]=n=>e.sortBy=n),"sort-desc":e.sortDesc,"onUpdate:sortDesc":_[2]||(_[2]=n=>e.sortDesc=n),onRowClicked:e.navigateToOrderPage,"sort-direction":e.sortDirection},{"cell(ID)":I(n=>[Ne,d("span",{class:"order-id",onClick:v=>e.toItem(n.value)},w(n.value),9,je)]),"cell(ContractID)":I(n=>{var v,k;return[Le,d("span",null,"#"+w((v=e.getContracts[n.value])==null?void 0:v.ID)+" / "+w((k=e.getContracts[n.value])==null?void 0:k.Customer),1)]}),"cell(Keys)":I(n=>{var v,k;return[Te,d("span",{title:e.getTitleText((v=n.item)==null?void 0:v.ID)},w(e.findDomainByOrderID((k=n.item)==null?void 0:k.ID)),9,Ae)]}),"cell(StatusID)":I(n=>[Ee,p(m,{class:"clickable-element",status:n.value,"status-table":"Orders",onClick:v=>{var k,U;return e.openHistoryStatuses((k=n.item)==null?void 0:k.ID,(U=n.item)==null?void 0:U.ServiceID)}},null,8,["status","onClick"])]),"cell(ExpirationDate)":I(n=>{var v,k;return[He,d("span",null,w(e.calculateExpirationDate((v=n.item)==null?void 0:v.DaysRemainded))+" | "+w(((k=n.item)==null?void 0:k.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":I(n=>{var v;return[Ue,p(b,{class:"clickable-element","user-notice":n.value,id:(v=n.item)==null?void 0:v.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":I(n=>[d("div",Me,[d("div",{class:"btn btn--md btn--bold clickable-element",onClick:v=>e.handlePayment(n.item.ID,n.item.ServiceID,n.item.ContractID)},[p(S),M("Оплатить")],8,Ve),p(l,{class:"dropdown-dots",right:""},{"button-content":I(()=>[d("div",Ge,[p(h)])]),default:I(()=>[p(a,null,{default:I(()=>[p(C,{to:`/AdditionalServices/${n.item.ID}`},{default:I(()=>[M("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),p(a,{onClick:v=>e.transferItem(n.item.ID,n.item.ServiceID)},{default:I(()=>[M("Передать на другой аккаунт")]),_:2},1032,["onClick"]),u.sectionID==="51000"||u.sectionID==="52000"?(O(),E(a,{key:0,onClick:v=>e.orderManage(n.item.ID,n.item.ServiceID)},{default:I(()=>[M("Управлять заказом")]),_:2},1032,["onClick"])):X("",!0),p(o),p(a,{class:"color-red",onClick:v=>f.$emit("deleteItem",n.item)},{default:I(()=>[M("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","onRowClicked","sort-direction"])):(O(),E(L,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const Fe={components:{EmptyStateBlock:R,StatusBadge:se,IconCard:oe,Helper:De},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],async setup(f){const _=Q(),u=Y(),e=Z("emitter"),B=V("ID"),N=V(!0),j=V("desc"),y=te(),m=ee(),b=ne(),S=A(()=>m==null?void 0:m.DNSmanagerOrdersList),h=A(()=>m==null?void 0:m.ISPswOrdersList),C=A(()=>m==null?void 0:m.ExtraIPOrdersList),a=A(()=>y==null?void 0:y.contractsList);function o(c,s,t){console.log("serviceID - ",s),s==="50000"||s==="51000"||s==="52000"?x(c,s):_.push(`/ServiceOrderPay/${c}`)}function l(c,s){console.log("getExtraIPOrders - ",C.value),console.log("ID - ",c);let t=null,i="";switch(s){case"50000":t=Object.entries(C.value).find(([D,g])=>g),i="ExtraIPOrders",console.log(t);break;case"51000":t=Object.entries(h.value).find(([D,g])=>g),i="ISPswOrders";break;case"52000":t=Object.entries(S.value).find(([D,g])=>g),i="DNSmanagerOrders",console.log(t);break;default:t=Object.entries(U.value).find(([D,g])=>g),i="Orders",console.log(t)}t&&e.emit("open-modal",{component:"StatusHistory",data:{modeID:i,rowID:t[1].ID}})}const P=c=>{const s=L(c);if(s){const t=s.split(","),i=t.length,D=t.join(`
`);return`Всего: ${i}
${D}`}return"Нет данных"},L=c=>{console.log(c);const s=Object.entries(S.value).reduce((t,[i,D])=>(t[i]=D,t),{});for(const t in s)if(Object.hasOwnProperty.call(s,t)){const i=s[t];if(String(i.OrderID)===String(c))return i.Parked}return null};function x(c,s,t){s==="51000"?_.push(`/ISPswOrderPay/${c}`):s==="52000"?_.push(`/DNSmanagerOrderPay/${c}`):s==="50000"&&_.push(`/ExtraIPOrderPay/${c}`)}function r(c,s,t){t.target.closest("button, a, .clickable-element")||_.push(`/AdditionalServices/${c.ID}`)}function T(c){_.push(`/AdditionalServices/${c}`)}function n(c,s){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:c,ServiceID:s}})}function v(c,s){let t;s==="51000"?t=Object.entries(h.value).reduce((D,[g,F])=>(D[g]=F,D),{}):s==="52000"&&(t=Object.entries(S.value).reduce((D,[g,F])=>(D[g]=F,D),{}));let i;for(const D in t)if(Object.hasOwnProperty.call(t,D)){const g=t[D];if(String(g.OrderID)===String(c)){i=g;break}}i&&b.OrderManageHosting({ServiceOrderID:i.ID,OrderID:c,ServiceID:s,XMLHttpRequest:"yes"})}const k=c=>{console.log(c);const s=Object.entries(S.value).reduce((t,[i,D])=>(t[i]=D,t),{});for(const t in s)if(Object.hasOwnProperty.call(s,t)){const i=s[t];if(String(i.OrderID)===String(c))return i.Domain}return null};$(()=>{console.log(S),console.log(a)});const U=A(()=>{var c,s;return(s=(c=Object.keys(u==null?void 0:u.userOrders).map(t=>{var i;return{...u==null?void 0:u.userOrders[t],ID:Number((i=u==null?void 0:u.userOrders[t])==null?void 0:i.ID)}}))==null?void 0:c.reverse())==null?void 0:s.filter(t=>t.ServiceID===(f==null?void 0:f.sectionID))});function ae(){_.push(`/AdditionalServicesOrder?ServiceID=${f==null?void 0:f.sectionID}`)}function ie(c){if(!c)return W(new Date);const s=new Date,t=new Date(s.getTime()+c*24*60*60*1e3);return W(t)}return _e(S,c=>{console.log(c)}),await m.fetchDNSmanagerOrders(),await m.fetchISPswOrders(),await m.fetchExtraIPOrders(),{authStore:u,getOrders:U,getContracts:a,sortBy:B,sortDesc:N,sortDirection:j,navigateToOrder:ae,servicesStatuses:ve,oneTimeWorksFields:Ce,calculateExpirationDate:ie,getDNSmanagerOrders:S,findDomainByOrderID:k,findParkedByOrderID:L,getTitleText:P,transferItem:n,orderManage:v,servicePay:x,handlePayment:o,navigateToOrderPage:r,openHistoryStatuses:l,toItem:T}}},ce=J(Fe,[["render",Re],["__scopeId","data-v-bdee9fb1"]]),qe={class:"section"},ze={class:"container"},Ke={class:"section-header"},We={class:"section-nav"},Xe=["title","onClick"],Je={class:"multiselect-option"},Qe={class:"section-body"};function Ye(f,_,u,e,B,N){var h,C,a,o,l,P,L,x;const j=re,y=he,m=q("Multiselect"),b=ce,S=R;return O(),G(z,null,[p(j),d("div",qe,[d("div",ze,[d("div",Ke,[d("div",We,[(O(!0),G(z,null,ue((h=e.getServices)==null?void 0:h.slice(0,3),r=>{var T;return O(),G("div",{class:K(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(r==null?void 0:r.ID)}]),title:(T=e.getServerGroup(r==null?void 0:r.ServersGroupID))==null?void 0:T.Comment,onClick:n=>e.switchToSection(r==null?void 0:r.ID)},w(r==null?void 0:r.Item),11,Xe)}),256)),((C=e.getServices)==null?void 0:C.length)>3?(O(),E(m,{key:0,modelValue:e.section,"onUpdate:modelValue":_[0]||(_[0]=r=>e.section=r),class:K({"multiselect--white additional-service__select":!0,"additional-service__select_active":(o=e.getServices)==null?void 0:o.slice(3,(a=e.getServices)==null?void 0:a.length).find(r=>(r==null?void 0:r.ID)===e.section)}),options:(P=e.getServices)==null?void 0:P.slice(3,(l=e.getServices)==null?void 0:l.length),label:"ID",onSelect:_[1]||(_[1]=r=>e.switchToSection(r))},{option:I(({option:r})=>[d("div",Je,w(r==null?void 0:r.Item),1)]),caret:I(()=>[p(y,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):X("",!0)])]),d("div",Qe,[(L=e.getServices)!=null&&L.find(r=>r.ID===e.section)?(O(),E(b,{key:0,sectionID:e.section,sectionData:(x=e.getServices)==null?void 0:x.find(r=>r.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(O(),E(S,{key:1,label:"Услуга не найдена"}))])])])],64)}const Ze={components:{ServiceListSection:ce,emptyStateBlock:R,Multiselect:ye,BlockBalanceAgreement:re},async setup(){const f=me(),_=Q(),u=Z("emitter"),e=ee(),B=fe();ne();const N=Y(),j=te(),y=V(null);u.on("updateUserOrdersList",()=>{N.fetchUserOrders()});const m=A(()=>{var a;return(a=Object.keys(e==null?void 0:e.ServicesList))==null?void 0:a.map(o=>{var l;return{...e==null?void 0:e.ServicesList[o],value:(l=e==null?void 0:e.ServicesList[o])==null?void 0:l.ID}}).filter(o=>(o==null?void 0:o.ServicesGroupID)!=="1000"&&(o==null?void 0:o.IsActive)&&!(o!=null&&o.IsHidden)).sort((o,l)=>Number(o==null?void 0:o.SortID)<Number(l==null?void 0:l.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(l==null?void 0:l.SortID)?1:0)}),b=V(null);u.on("updateServicesList",()=>{N.fetchUserOrders()});function S(a){_.replace(`/AdditionalServices?ServiceID=${a}`),b.value=a}function h(a){var o,l;return(l=(o=B==null?void 0:B.serverGroupsList)==null?void 0:o.ServersGroups)==null?void 0:l[a]}function C(a){u.emit("open-modal",{component:"DeleteItem",data:{id:a.ID,message:`Вы действительно хотите удалить заказ #${a.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}return $(()=>{var a,o;console.log(m.value),(a=m.value)!=null&&a.find(l=>{var P;return(l==null?void 0:l.ID)===((P=f==null?void 0:f.query)==null?void 0:P.ServiceID)})?b.value=(o=f==null?void 0:f.query)==null?void 0:o.ServiceID:_.replace(`/AdditionalServices?ServiceID=${b.value}`)}),await e.fetchServices().then(()=>{var a,o;b.value=(o=(a=m.value)==null?void 0:a[0])==null?void 0:o.ID}),await j.fetchContracts(),await N.fetchUserOrders(),await e.fetchDNSmanagerOrders(),await e.fetchISPswOrders(),await e.fetchExtraIPOrders(),{section:b,deleteItem:C,getServices:m,additionalServicesValue:y,switchToSection:S,getServerGroup:h}}},pt=J(Ze,[["render",Ye],["__scopeId","data-v-ca63ce6a"]]);export{pt as default};
