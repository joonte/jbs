import{_ as $}from"./EmptyStateBlock-DA3-0YDi.js";import{_ as V}from"./ButtonDefault-CMw2aBy6.js";import{_ as L}from"./TotalAmount.vue_vue_type_script_setup_true_lang-Dg-09YER.js";import{_ as j}from"./BlockOrderPayBalance-DG_N_8bZ.js";import{_ as M}from"./ClausesKeeper-iUM0yapS.js";import{_ as R}from"./BlueButton.vue_vue_type_script_setup_true_lang-BKdLNEec.js";import{_ as K}from"./BlockBalanceAgreement-v_bWuiVT.js";import{r as g,f as I,I as F,s as q,E as h,o as i,c as N,b as k,a as u,F as E,t as B,C as _,w as z,h as C,v as G,d as H,i as J,e as Q}from"./index-Codq73aV.js";import{u as W}from"./index-BO2gwtUe.js";import{u as X}from"./services-DyPBvbVy.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./common-DyknwSqv.js";import"./bootstrap-vue-next-W16P-SAV.js";import"./component-DqcwA9JN.js";import"./global-CdY51QQZ.js";import"./IconCross-DYjIbZqx.js";import"./IconClose-Dia1noy8.js";const Z={class:"tw-px-4 md:tw-px-8 tw-mb-6"},ee={class:"section"},te={class:"tw-flex tw-flex-col sm:tw-flex-row sm:tw-items-center tw-justify-between tw-gap-4"},ae={class:"tw-text-2xl sm:tw-text-4xl"},oe={class:"tw-text-gray-500 tw-text-sm tw-mt-2"},se={__name:"AdditionalServicesProlongCode",async setup(ne){let r,c;const v=W(),s=X(),O=J(),P=H(),a=g(null),m=g(!1),o=I(()=>Object.values(s?.ISPswOrdersList).find(e=>e.OrderID==O.params.id)),d=I(()=>v.contractsList[o.value.ContractID]),n=I(()=>s?.additionalServicesScheme?.ISPsw?Object.keys(s.additionalServicesScheme.ISPsw).map(e=>{const t=s.additionalServicesScheme.ISPsw[e];return{...t,value:t?.ID,name:t?.Name,cost:t?.CostDay,month:t?.CostMonth}}).filter(e=>e?.ID==o.value?.SchemeID):[]),x=e=>{e.key==="Enter"&&e.ctrlKey&&f()};F(()=>{document.addEventListener("keyup",x)}),q(()=>{document.removeEventListener("keyup",x)});function f(){m.value=!0;const e=parseFloat(d.value?.Balance)>=parseFloat(D(a.value?.price-b())??0),t=n.value[0]?.cost==="0.00"&&n.value[0]?.month==="0.00",p=e||t,y=!p,S={ISPswOrderID:o.value.ID,DaysPay:a.value?.actualDays,IsNoBasket:p,IsUseBasket:y,PayMessage:""};s.ISPswOrderPay(S).then(l=>{l==="UseBasket"?P.push("/Basket"):l==="NoBasket"&&P.push("/AdditionalServices?ServiceID=51000"),m.value=!1}).catch(l=>{console.error("ISPswOrderPay error:",l),m.value=!1})}function D(e){return Number(e).toFixed(2)||0}function b(){let e=0;return a.value?.discounts?.Bonuses.map(t=>{e+=+t.Economy}),e}return F(()=>{s.fetchAdditionalServiceScheme("ISPsw")}),[r,c]=h(()=>s.fetchISPswOrders()),await r,c(),[r,c]=h(()=>s.fetchAdditionalServiceScheme("ISPsw")),await r,c(),[r,c]=h(()=>v.fetchContracts()),await r,c(),(e,t)=>{const p=K,y=R,S=M,l=j,A=L,T=V,U=$;return i(),N(E,null,[k(p,{"contract-id":o.value?.ContractID},null,8,["contract-id"]),u("div",Z,[o.value?(i(),N(E,{key:0},[u("section",ee,[u("div",te,[u("h1",ae," Оплата заказа ПО ISPsystem, "+B(o.value.IP||""),1),n.value[0]?.ConsiderTypeID!=="Upon"?(i(),_(y,{key:0,disabled:a.value===null||a.value?.price===null,onClick:t[0]||(t[0]=w=>f())},{default:z(()=>[Q(B(parseFloat(d.value.Balance)>=parseFloat(a.value?.price)?"Оплатить c баланса договора":"Добавить в корзину"),1)]),_:1},8,["disabled"])):C("",!0)]),u("div",oe,B(n.value[0]?.Name),1),k(S)]),d.value&&n.value[0]?.ConsiderTypeID!=="Upon"?(i(),_(l,{key:0,modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=w=>a.value=w),contract:d.value,"days-remainded":o.value.DaysRemainded,"service-id":51e3,scheme:n.value[0],order:o.value},null,8,["modelValue","contract","days-remainded","scheme","order"])):C("",!0),u("div",null,[a.value?(i(),_(A,{key:0,tariff:a.value},null,8,["tariff"])):C("",!0),k(T,{class:"btn--wide",label:parseFloat(G(v).contractsList[o.value.ContractID]?.Balance)>=(D(a.value?.price-b())??0)?"Оплатить c баланса договора":"Добавить в корзину",disabled:(a.value===null||a.value?.price===null)&&n.value[0]?.ConsiderTypeID!=="Upon","is-loading":m.value,onClick:t[2]||(t[2]=w=>f())},null,8,["label","disabled","is-loading"])])],64)):(i(),_(U,{key:1,label:"Заказ нельзя продлить"}))])],64)}}},Be=Y(se,[["__scopeId","data-v-216fef1d"]]);export{Be as default};
