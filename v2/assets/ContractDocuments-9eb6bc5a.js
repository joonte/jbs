import{a1 as U,r as E,a2 as v,a3 as b,j as V,o as D,c as g,b as f,a as i,w as p,d as N,t as k,F as B,v as x,x as A,p as F,l as q,_ as z,u as G,a7 as H,g as I}from"./index-01c72474.js";import{u as J}from"./contracts-b8a59bf1.js";import{f as K,a as P}from"./useTimeFunction-8602dd60.js";import{_ as S}from"./ButtonDefault-6f60da99.js";import{E as T}from"./EmptyStateBlock-453d542f.js";import{I as O}from"./IconDownload-9a9b23b8.js";import{B as R}from"./BlockBalanceAgreement-89ea0555.js";import"./bootstrap-vue-next.es-44eeb912.js";import"./IconArrow-669aa41b.js";const Q=U("documents",()=>{const s=E(null),e=E(null);async function h(){let a="error";return await v.post(""+b.motionDocuments).then(o=>{s.value=o==null?void 0:o.data}).catch(()=>{a="error"}),a}async function n(){await v.post(""+b.contractsEnclosures).then(a=>{e.value=a.data})}async function w(a){await v.post(""+b.motionDocumentDownload,{...a}).then(o=>{var r,l;((r=o==null?void 0:o.data)==null?void 0:r.Status)==="Ok"&&C({url:(l=o==null?void 0:o.data)==null?void 0:l.Location,original_name:"Contract"})})}async function y(a){await v.post(""+b.contractEnclosureDownload,{...a}).then(o=>{var r,l;console.log(o==null?void 0:o.Status),((r=o==null?void 0:o.data)==null?void 0:r.Status)==="Ok"&&C({url:(l=o==null?void 0:o.data)==null?void 0:l.Location,original_name:"Contract"})})}function C({url:a,original_name:o}){v.get(a,{responseType:"blob"}).then(r=>{const l=new Blob([r.data],{type:"application/pdf"}),t=document.createElement("a");t.href=URL.createObjectURL(l),t.download=o,t.click(),URL.revokeObjectURL(t.href)}).catch(console.error)}return{motionDocumentsList:s,contractDocumentsList:e,motionDocumentDownload:w,contractEnclosureDownload:y,fetchMotionDocuments:h,fetchContractDocuments:n}}),W=s=>(F("data-v-573a315d"),s=s(),q(),s),X={class:"section"},Y={class:"container"},Z={class:"section-header"},$={class:"breadcrumb"},tt=W(()=>i("h1",{class:"section-title"},"Документы",-1)),ot={key:0,class:"grid-section"},nt={class:"list-item"},ct={class:"list-item__row"},at={class:"list-item__row secondary-text"},et={class:"list-item"},st={class:"list-item__row"},rt={class:"list-item__row secondary-text"};function lt(s,e,h,n,w,y){const C=R,a=V("router-link"),o=O,r=S,l=T;return D(),g(B,null,[f(C),i("div",X,[i("div",Y,[i("div",Z,[i("div",$,[f(a,{class:"section-label",to:"/Contracts"},{default:p(()=>[N("Договор /")]),_:1}),f(a,{class:"section-label",to:`/ContractScheme/${s.$route.params.id}`},{default:p(()=>{var t;return[N(k((t=n.getContract)==null?void 0:t.Customer),1)]}),_:1},8,["to"])]),tt]),n.filterDocuments(n.getMotionDocuments)&&n.filterDocuments(n.getMotionDocuments).length>0||n.filterDocuments(n.getContractDocuments)&&n.filterDocuments(n.getContractDocuments).length>0?(D(),g("div",ot,[(D(!0),g(B,null,x(n.filterDocuments(n.getMotionDocuments),t=>(D(),g("div",nt,[i("div",ct,k(n.getMotionDocumentName(t==null?void 0:t.TypeID)),1),i("div",at,k(n.getDocumentDate(t==null?void 0:t.CreateDate)),1),f(r,{class:"download-button",label:"Скачать",onClick:L=>n.downloadMotionDocument(t==null?void 0:t.ID)},{icon:p(()=>[f(o,{class:"download-icon"})]),_:2},1032,["onClick"])]))),256)),(D(!0),g(B,null,x(n.filterDocuments(n.getContractDocuments),t=>(D(),g("div",et,[i("div",st,k(n.getContractDocumentName(t==null?void 0:t.TypeID)),1),i("div",rt,k(n.getDocumentDate(t==null?void 0:t.CreateDate)),1),f(r,{class:"download-button",label:"Скачать",onClick:L=>n.downloadContractDocument(t==null?void 0:t.ID)},{icon:p(()=>[f(o,{class:"download-icon"})]),_:2},1032,["onClick"])]))),256))])):(D(),A(l,{key:1,label:"У вас пока что нету документов"}))])])],64)}const it={components:{IconDownload:O,ButtonDefault:S,EmptyStateBlock:T,BlockBalanceAgreement:R},async setup(){const s=J(),e=Q(),h=G(),n=H(),w=I(()=>{var c;return(c=s==null?void 0:s.contractsList)==null?void 0:c[n.params.id]}),y=I(()=>e==null?void 0:e.motionDocumentsList),C=I(()=>e==null?void 0:e.contractDocumentsList),a=I(()=>h==null?void 0:h.ConfigList);function o(c){var u,d,_,m;return(m=(_=(d=(u=a.value)==null?void 0:u.MotionDocuments)==null?void 0:d.Types)==null?void 0:_[c])==null?void 0:m.Name}function r(c){var u,d,_,m,M;return(M=(m=(_=(d=(u=a.value)==null?void 0:u.Contracts)==null?void 0:d.Enclosures)==null?void 0:_.Types)==null?void 0:m[c])==null?void 0:M.Name}function l(c){return c?"от "+K(P(c)):""}function t(c){let u=[];return c&&Object.keys(c).forEach(d=>{var _,m;((_=c[d])==null?void 0:_.ContractID)===((m=w.value)==null?void 0:m.ID)&&u.push(c[d])}),u}function L(c){e.motionDocumentDownload({MotionDocumentID:c})}function j(c){e.contractEnclosureDownload({ContractEnclosureID:c})}return await s.fetchContracts(),await e.fetchMotionDocuments(),await e.fetchContractDocuments(),{getContract:w,getMotionDocuments:y,getContractDocuments:C,filterDocuments:t,getMotionDocumentName:o,getContractDocumentName:r,downloadMotionDocument:L,downloadContractDocument:j,getDocumentDate:l}}},wt=z(it,[["render",lt],["__scopeId","data-v-573a315d"]]);export{wt as default};
