import{k as M,o as c,c as d,b as I,a as e,t as b,F as B,y as U,l as E,z as j,n as z,p as F,m as R,_ as O,u as T,U as q,f as G,e as H,r as y,h as P,i as J,P as Q}from"./index-aeb1df1e.js";import{I as W}from"./IconSearch-4ea59048.js";import{_ as x}from"./ClausesKeeper-90c650cc.js";import{c as X}from"./component-60ac2998.js";import{u as Y}from"./postings-926be189.js";import{u as Z}from"./IconArrow-a6c91ada.js";import{u as $}from"./invoices-841bb78d.js";import{B as K}from"./BlockBalanceAgreement-906c1168.js";import{E as tt}from"./EmptyStateBlock-b0a120e4.js";import{_ as et}from"./ButtonDefault-11c4541b.js";import"./IconClose-c7c36336.js";import"./bootstrap-vue-next.es-c6bcf011.js";const f=i=>(F("data-v-118bb3f6"),i=i(),R(),i),ot={class:"section"},nt={class:"container"},st={class:"section-header"},it=f(()=>e("h1",{class:"section-title"},"Пополнить баланс",-1)),at={class:"section-label"},ct={key:0,class:"list-form"},lt={class:"list-part"},rt=f(()=>e("div",{class:"list-item__title"},"Платежные системы",-1)),_t={key:0,class:"list-row grid-net"},dt=["onClick"],mt=["src"],ut={class:"list-item__image-title"},pt={class:"list-part"},vt=f(()=>e("div",{class:"list-item__title"},"Сумма пополнения",-1)),ft={class:"list-row"},ht=f(()=>e("div",{class:"list-form_col list-form_col--sm"},"Пополнить на сумму",-1)),It={class:"list-form_col list-form_col--xl"},St={class:"search-field form-field"},kt={class:"list-row"},gt=f(()=>e("div",{class:"list-form_col list-form_col--sm"},null,-1)),Ct={class:"btn-container"};function Dt(i,l,V,n,A,S){const k=K,m=x,u=M("imask-input"),p=et,v=tt;return c(),d(B,null,[I(k),e("div",ot,[e("div",nt,[e("div",st,[it,e("div",at,"Договор # "+b(i.$route.params.id)+" / "+b(n.getContract.Customer),1)]),I(m),n.getContract?(c(),d("div",ct,[e("div",lt,[rt,n.filterActiveSystems?(c(),d("div",_t,[(c(!0),d(B,null,U(n.filterActiveSystems,t=>{var h;return c(),d(B,null,[t!=null&&t.IsActive?(c(),d("div",{key:0,class:z(["list-item",{"list-item_active":((h=n.paymentSystem)==null?void 0:h.id)===(t==null?void 0:t.ID)}]),onClick:g=>n.paymentSystem={id:t==null?void 0:t.ID,type:t==null?void 0:t.Source}},[e("img",{class:"list-item__image",src:t==null?void 0:t.Image},null,8,mt),e("div",ut,b(t==null?void 0:t.Description),1)],10,dt)):E("",!0)],64)}),256))])):E("",!0)]),e("div",pt,[vt,e("div",ft,[ht,e("div",It,[e("div",St,[I(u,{type:"text",mask:Number,placeholder:"100 ₽",modelValue:n.inputValue,"onUpdate:modelValue":l[0]||(l[0]=t=>n.inputValue=t)},null,8,["modelValue"])])])]),e("div",kt,[gt,e("div",Ct,[I(p,{"is-loading":n.isLoading,label:"Пополнить баланс",onClick:l[1]||(l[1]=t=>n.sendInvoice())},null,8,["is-loading"])])])])])):(c(),j(v,{key:1,label:"Договор не найден"}))])])],64)}const bt={components:{IconSearch:W,BlockBalanceAgreement:K,ClausesKeeper:x,"imask-input":X},async setup(){const i=Z(),l=T(),V=$(),n=Y(),A=q("emitter"),S=G(),k=H(),m=y(null),u=y(null),p=y(!1),v=P(()=>{var o;return(o=i.contractsList)==null?void 0:o[S.params.id]}),t=P(()=>l.ConfigList),h=P(()=>{const o=t.value,a=v.value;if(o!=null&&o.PaymentSystems&&(a!=null&&a.PaymentSystems)){const r=new Set(a.PaymentSystems);return Object.keys(o.PaymentSystems).filter(s=>r.has(s)).map(s=>{const _=o.PaymentSystems[s];return String(_==null?void 0:_.IsActive)==="1"?_.Collations:null}).filter(s=>s!==null).flat().slice().sort((s,_)=>{const w=parseInt(s.SortID,10),L=parseInt(_.SortID,10);return isNaN(w)?1:isNaN(L)?-1:w-L})}else return null}),g=o=>{o.key==="Enter"&&o.ctrlKey&&N()};J(()=>{document.addEventListener("keyup",g)}),Q(()=>{document.removeEventListener("keyup",g)});function N(){var o,a;u.value>0&&(p.value=!0,V.InvoiceMake({ContractID:(o=v.value)==null?void 0:o.ID,PaymentSystemID:(a=m.value)==null?void 0:a.type,Summ:u.value}).then(r=>{var C;if(p.value=!1,r.status==="success"&&r.data&&r.data.InvoiceID){const D=r.data.InvoiceID;n.InvoiceDocument({InvoiceID:D}).then(s=>{A.emit("open-modal",{component:"InvoiceDocument",data:{html:s,ID:D}})})}else k.push(`/ProfileMake?Contract=${S.params.id}&TemplateID=${(C=m.value)==null?void 0:C.type}`)}))}return await i.fetchContracts(),{inputValue:u,getConfig:t,filterActiveSystems:h,paymentSystem:m,isLoading:p,getContract:v,sendInvoice:N}}},Ut=O(bt,[["render",Dt],["__scopeId","data-v-118bb3f6"]]);export{Ut as default};
