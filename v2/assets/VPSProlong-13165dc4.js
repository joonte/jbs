import{E as se}from"./EmptyStateBlock-68a1c33e.js";import{_ as ae}from"./ButtonDefault-dc248ec6.js";import{_ as ce}from"./BlockOrderPayBalance-6a44874e.js";import{_ as le}from"./ClausesKeeper-55c14b7f.js";import{_ as ne,e as re,a7 as _e,r as y,g as k,ag as f,o as c,c as l,b as p,a as t,F as D,t as n,x as ie,k as de,Z as W,ae as X,p as ue,l as ve}from"./index-83b4b7ba.js";import{u as pe}from"./vps-0d37158a.js";import{u as me}from"./contracts-623ec7a8.js";import{B as he}from"./BlockBalanceAgreement-c5fad736.js";import"./bootstrap-vue-next.es-8f3ae81a.js";import"./IconHelp-c62d5911.js";import"./globalActions-633eb799.js";import"./BasicInput-3f1e9fd6.js";import"./component-abb1f5a9.js";import"./IconClose-86aafc4e.js";import"./IconArrow-80c72216.js";const P=h=>(ue("data-v-96b0d6c2"),h=h(),ve(),h),be={key:0,class:"vps-scheme-page"},Se={class:"section"},ke={class:"container"},ge=P(()=>t("div",{class:"section-header"},[t("h1",{class:"section-title"},"Оплата заказа VPS/VDS сервера")],-1)),ye={key:0,class:"section"},fe={class:"container"},De={class:"total-block"},Pe={class:"total-block__row divider-bottom"},Ie=P(()=>t("div",{class:"total-block__col"},"Цена тарифа",-1)),Ve={class:"total-block__col"},Be={class:"total-block__row no-divider"},we={class:"total-block__col"},Ce={class:"total-block__col"},xe={class:"total-block__row total-block__row--big economy-line"},Ee=P(()=>t("div",{class:"total-block__col red"},"Выгода",-1)),Oe={class:"total-block__col flex-col"},Fe={class:"red"},Le={class:"total-block__row total-block__row--big"},Re={class:"total-block__col"},Ne={class:"total-block__col"},Ae={key:1,class:"section"},Te={class:"container"},je={key:1,class:"section"},$e={class:"container"},He={__name:"VPSProlong",async setup(h){let _,i;const r=pe(),I=me(),V=re(),Y=_e(),o=y(null),b=y(null),g=y(!1),ee=k(()=>Object.keys(r.vpsSchemes).map(e=>r.vpsSchemes[e])),d=k(()=>Object.keys(r.vpsList).map(e=>r.vpsList[e]).find(e=>e.OrderID===Y.params.id)),B=k(()=>I.contractsList);console.log("getContracts",B);const m=k(()=>ee.value.find(e=>{var s;return(e==null?void 0:e.ID)===((s=d.value)==null?void 0:s.SchemeID)}));console.log("getSelectedPackage",m);function S(e){return Number(e).toFixed(2)||0}function w(){var s,u;let e=0;return(u=(s=o.value)==null?void 0:s.discounts)==null||u.Bonuses.map(v=>{e+=+v.Economy}),e}function te(e){o.value=e}function oe(){var e,s;g.value=!0,r.VPSOrderPay({VPSOrderID:(e=d.value)==null?void 0:e.ID,DaysPay:(s=o.value)==null?void 0:s.actualDays,IsChange:!0}).then(u=>{let{result:v,error:C}=u;v==="SUCCESS"?V.push("/VPSOrders"):v==="BASKET"&&V.push("/Basket"),g.value=!0})}return[_,i]=f(()=>r.fetchVPSSchemes()),await _,i(),[_,i]=f(()=>I.fetchContracts()),await _,i(),[_,i]=f(()=>r.fetchVPS().then(()=>{var e;b.value=(e=d.value)==null?void 0:e.ContractID})),await _,i(),(e,s)=>{var E,O,F,L,R,N,A,T,j,$,H,K,U,Z,q,z,G,J,M,Q;const u=le,v=ce,C=ae,x=se;return c(),l(D,null,[p(he),d.value?(c(),l("div",be,[t("div",Se,[t("div",ke,[ge,p(u,{partition:"Header:/VPSSchemes"})])]),p(v,{contractID:b.value,scheme:m.value,serviceID:"30000",daysRemainded:(E=d.value)==null?void 0:E.DaysRemainded,isOrderID:!0,orderID:(O=d.value)==null?void 0:O.OrderID,onSelect:te},null,8,["contractID","scheme","daysRemainded","orderID"]),(F=m.value)!=null&&F.IsPayed&&((L=m.value)!=null&&L.IsProlong)||!((R=m.value)!=null&&R.IsPayed)?(c(),l("div",ye,[t("div",fe,[t("div",De,[((T=(A=(N=o.value)==null?void 0:N.discounts)==null?void 0:A.Bonuses)==null?void 0:T.length)>0?(c(),l(D,{key:0},[t("div",Pe,[Ie,t("div",Ve,n(S((j=o.value)==null?void 0:j.price))+" ₽",1)]),(c(!0),l(D,null,ie((H=($=o.value)==null?void 0:$.discounts)==null?void 0:H.Bonuses,a=>(c(),l("div",Be,[t("div",we,"Скидка "+n(a==null?void 0:a.Discount)+"% на "+n(a==null?void 0:a.Days)+" дней",1),t("div",Ce,"-"+n(S(a==null?void 0:a.Economy))+" ₽",1)]))),256))],64)):de("",!0),W(t("div",xe,[Ee,t("div",Oe,[t("span",null,[t("s",null,n(S((K=o.value)==null?void 0:K.price))+" ₽",1)]),t("span",Fe,"-"+n(w())+" ₽",1)])],512),[[X,((q=(Z=(U=o.value)==null?void 0:U.discounts)==null?void 0:Z.Bonuses)==null?void 0:q.length)>0]]),W(t("div",Le,[t("div",Re,"Итого за "+n((z=o.value)==null?void 0:z.label),1),t("div",Ne,n(S(((G=o.value)==null?void 0:G.price)-w()))+" ₽",1)],512),[[X,(J=o.value)==null?void 0:J.price]])]),p(C,{class:"btn--wide",label:((M=B.value[b.value])==null?void 0:M.Balance)>((Q=o.value)==null?void 0:Q.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||b.value===null,"is-loading":g.value,onClick:s[0]||(s[0]=a=>oe())},null,8,["label","disabled","is-loading"])])])):(c(),l("div",Ae,[t("div",Te,[p(x,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(c(),l("div",je,[t("div",$e,[p(x,{label:"Заказ VPS/VDS сервера не найден"})])]))],64)}}},st=ne(He,[["__scopeId","data-v-96b0d6c2"]]);export{st as default};
