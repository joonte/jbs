import{E as he}from"./EmptyStateBlock-25904ff1.js";import{_ as ye}from"./BlockOrderPayBalance-b06eeb59.js";import{_ as ke}from"./ClausesKeeper-1519f453.js";import{_ as be}from"./ButtonDefault-b95c906d.js";import{_ as Ie,a7 as Se,e as De,r as ie,g as B,i as re,O as fe,ag as C,o as r,c as _,b,a as o,t as d,y as de,k as P,F as O,x as we,Z as _e,a9 as ue,p as ge,l as Be}from"./index-3af25d4c.js";import{u as Ce}from"./contracts-4f21f7b6.js";import{u as Pe}from"./services-b0ae5192.js";/* empty css                                                                             */import{B as Oe}from"./BlockBalanceAgreement-4b67da5f.js";import"./bootstrap-vue-next.es-79941670.js";import"./IconHelp-f5d462d2.js";import"./globalActions-83829f94.js";import"./BasicInput-ee6974cd.js";import"./component-17343301.js";import"./IconClose-f49a70b0.js";import"./IconArrow-7b47b2f8.js";const ve=I=>(ge("data-v-1e33d91b"),I=I(),Be(),I),Ee={key:0,class:"hosting-sheme"},Ue={class:"section"},xe={class:"container"},Fe={class:"section-header"},Ne={class:"section-header__wrapper"},Ae={class:"section-title"},Te={class:"section-label"},Le={key:1,class:"section"},Re={class:"container"},Me={class:"total-block"},$e={class:"total-block__row divider-bottom"},Ve=ve(()=>o("div",{class:"total-block__col"},"Цена тарифа",-1)),je={class:"total-block__col"},Ke={class:"total-block__row no-divider"},qe={class:"total-block__col"},Ze={class:"total-block__col"},ze={class:"total-block__row total-block__row--big economy-line"},Ge=ve(()=>o("div",{class:"total-block__col red"},"Выгода",-1)),He={class:"total-block__col flex-col"},Je={class:"red"},Qe={class:"total-block__row total-block__row--big"},We={class:"total-block__col"},Xe={class:"total-block__col"},Ye={key:2,class:"section"},eo={class:"container"},oo={key:1,class:"section"},so={class:"container"},to={__name:"AdditionalServicesProlongCode",async setup(I){let u,v;const E=Ce(),a=Pe(),pe=Se(),U=De(),s=ie(null),S=ie(!1),n=B(()=>Object.keys(a==null?void 0:a.ISPswOrdersList).map(t=>a==null?void 0:a.ISPswOrdersList[t]).find(t=>t.OrderID===pe.params.id)),x=t=>{t.key==="Enter"&&t.ctrlKey&&g()};re(()=>{document.addEventListener("keyup",x)}),fe(()=>{document.removeEventListener("keyup",x)});const c=B(()=>{var t;return(t=a==null?void 0:a.additionalServicesScheme)!=null&&t.ISPsw?Object.keys(a.additionalServicesScheme.ISPsw).map(l=>{const e=a.additionalServicesScheme.ISPsw[l];return{...e,value:e==null?void 0:e.ID,name:e==null?void 0:e.Name,cost:e==null?void 0:e.CostDay,month:e==null?void 0:e.CostMonth}}).filter(l=>{var e;return(l==null?void 0:l.ID)==((e=n.value)==null?void 0:e.SchemeID)}):[]}),w=B(()=>E.contractsList);function g(){var p,f,m,h,y;S.value=!0;const t=((p=w.value[n.ContractID])==null?void 0:p.Balance)>((f=s==null?void 0:s.value)==null?void 0:f.price)||((m=c.value[0])==null?void 0:m.cost)==="0.00"&&((h=c.value[0])==null?void 0:h.month)==="0.00",l=!t,e={ISPswOrderID:n.value.ID,DaysPay:(y=s.value)==null?void 0:y.actualDays,IsNoBasket:t,IsUseBasket:l,PayMessage:""};a.ISPswOrderPay(e).then(k=>{k==="UseBasket"?U.push("/Basket"):k==="NoBasket"?U.push("/AdditionalServices?ServiceID=51000"):console.error("Ошибка оплаты заказа"),S.value=!0})}function D(t){return Number(t).toFixed(2)||0}function F(){var l,e;let t=0;return(e=(l=s.value)==null?void 0:l.discounts)==null||e.Bonuses.map(p=>{t+=+p.Economy}),t}function me(t){s.value=t}return re(()=>{a.fetchAdditionalServiceScheme("ISPsw")}),[u,v]=C(()=>a.fetchISPswOrders()),await u,v(),[u,v]=C(()=>a.fetchAdditionalServiceScheme("ISPsw")),await u,v(),[u,v]=C(()=>E.fetchContracts()),await u,v(),(t,l)=>{var h,y,k,N,A,T,L,R,M,$,V,j,K,q,Z,z,G,H,J,Q,W,X,Y,ee,oe,se,te,ae,le,ne,ce;const e=be,p=ke,f=ye,m=he;return r(),_(O,null,[b(Oe),n.value?(r(),_("div",Ee,[o("div",Ue,[o("div",xe,[o("div",Fe,[o("div",Ne,[o("h1",Ae,"Оплата заказа ПО ISPsystem, "+d(((h=n.value)==null?void 0:h.IP)||""),1),((y=c.value[0])==null?void 0:y.ConsiderTypeID)!=="Upon"?(r(),de(e,{key:0,class:"btn--wide",label:parseFloat((k=w.value[n.value.ContractID])==null?void 0:k.Balance)>=parseFloat((N=s.value)==null?void 0:N.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||((A=s.value)==null?void 0:A.price)===null,"is-loading":S.value,onClick:l[0]||(l[0]=i=>g())},null,8,["label","disabled","is-loading"])):P("",!0)]),o("div",Te,d((T=c.value[0])==null?void 0:T.Name),1)])]),b(p)]),((L=c.value[0])==null?void 0:L.ConsiderTypeID)!=="Upon"?(r(),de(f,{key:0,contractID:(R=n.value)==null?void 0:R.ContractID,daysRemainded:(M=n.value)==null?void 0:M.DaysRemainded,serviceID:"51000",scheme:c.value[0],orderID:($=n.value)==null?void 0:$.OrderID,isOrderID:!0,onSelect:me},null,8,["contractID","daysRemainded","scheme","orderID"])):P("",!0),n.value?(r(),_("div",Le,[o("div",Re,[o("div",Me,[((K=(j=(V=s.value)==null?void 0:V.discounts)==null?void 0:j.Bonuses)==null?void 0:K.length)>0?(r(),_(O,{key:0},[o("div",$e,[Ve,o("div",je,d(D((q=s.value)==null?void 0:q.price))+" ₽",1)]),(r(!0),_(O,null,we((z=(Z=s.value)==null?void 0:Z.discounts)==null?void 0:z.Bonuses,i=>(r(),_("div",Ke,[o("div",qe,"Скидка "+d(i==null?void 0:i.Discount)+"% на "+d(i==null?void 0:i.Days)+" дней",1),o("div",Ze,"-"+d(D(i==null?void 0:i.Economy))+" ₽",1)]))),256)),_e(o("div",ze,[Ge,o("div",He,[o("span",null,[o("s",null,d(D((G=s.value)==null?void 0:G.price))+" ₽",1)]),o("span",Je,"-"+d(F())+" ₽",1)])],512),[[ue,((Q=(J=(H=s.value)==null?void 0:H.discounts)==null?void 0:J.Bonuses)==null?void 0:Q.length)>0]])],64)):P("",!0),_e(o("div",Qe,[o("div",We,d(((W=c.value[0])==null?void 0:W.ConsiderTypeID)==="Upon"?"Итого":`Итого за ${(X=s.value)==null?void 0:X.label}`),1),o("div",Xe,d(((Y=c.value[0])==null?void 0:Y.ConsiderTypeID)==="Upon"?(ee=c.value[0])==null?void 0:ee.CostMonth:D(((oe=s.value)==null?void 0:oe.price)-F()))+" ₽",1)],512),[[ue,((se=s.value)==null?void 0:se.price)||((te=c.value[0])==null?void 0:te.ConsiderTypeID)==="Upon"]])]),b(e,{class:"btn--wide",label:parseFloat((ae=w.value[n.value.ContractID])==null?void 0:ae.Balance)>=parseFloat((le=s.value)==null?void 0:le.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:(s.value===null||((ne=s.value)==null?void 0:ne.price)===null)&&((ce=c.value[0])==null?void 0:ce.ConsiderTypeID)!=="Upon","is-loading":S.value,onClick:l[1]||(l[1]=i=>g())},null,8,["label","disabled","is-loading"])])])):(r(),_("div",Ye,[o("div",eo,[b(m,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),_("div",oo,[o("div",so,[b(m,{label:"не удалось найти заказ хостинга"})])]))],64)}}},So=Ie(to,[["__scopeId","data-v-1e33d91b"]]);export{So as default};
