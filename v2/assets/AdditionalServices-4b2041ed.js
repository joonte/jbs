import{j as q,o as C,c as G,a as _,t as j,b as g,x as A,w as I,d as V,k as X,F as z,p as ae,l as ie,_ as J,e as Q,f as Y,R as Z,r as H,g as L,i as $,h as le,v as de,n as K,a7 as _e}from"./index-01c72474.js";import{u as ee}from"./services-479ed473.js";import{u as te}from"./contracts-b8a59bf1.js";import"./postings-78945a1c.js";import{u as ne}from"./globalActions-8f995eb9.js";import{u as ue}from"./resetServer-9a5160ca.js";import{f as W}from"./useTimeFunction-8602dd60.js";import{_ as oe}from"./IconCard-35ff8a4a.js";import{E as F}from"./EmptyStateBlock-453d542f.js";import{S as re}from"./StatusBadge-1436ac85.js";import{s as me}from"./servicesStatuses-6293b6ac.js";import{_ as De}from"./HelperComponent-266443ae.js";import{z as fe,k as ve,d as pe,C as Ie}from"./bootstrap-vue-next.es-44eeb912.js";import{_ as Se}from"./IconDots-b90ab2cc.js";import{_ as ge}from"./ClausesKeeper-39926d40.js";import{_ as ye}from"./ButtonDefault-6f60da99.js";import{s as Oe}from"./multiselect-b3bc32a2.js";import{B as se}from"./BlockBalanceAgreement-89ea0555.js";import{_ as be}from"./IconArrow-669aa41b.js";import"./IconClose-6051fe98.js";const ke=[{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],R=m=>(ae("data-v-c24cc6a4"),m=m(),ie(),m),he={class:"section-header"},Ce={class:"section-title__nowrap"},xe={class:"section-title"},we={class:"btn__group"},Be=R(()=>_("span",{class:"td-mobile"},"Заказ",-1)),Pe=R(()=>_("span",{class:"td-mobile"},"Договор",-1)),je=R(()=>_("span",{class:"td-mobile"},"Ключевые поля",-1)),Ne=["title"],Te=R(()=>_("span",{class:"td-mobile"},"Статус",-1)),Ee=R(()=>_("span",{class:"td-mobile"},"Дата окончания",-1)),Le=R(()=>_("span",{class:"td-mobile"},"Комментарий",-1)),Ae={class:"service__controls-wrapper"},Re=["onClick"],Ue={class:"btn btn--dots"};function Me(m,f,D,e,N,U){var T,o,E;const x=ye,w=ge,S=re,b=q("Helper"),v=oe,B=Se,P=q("router-link"),y=fe,u=ve,t=pe,c=Ie,k=F;return C(),G(z,null,[_("div",he,[_("div",Ce,[_("h1",xe,j((T=D.sectionData)==null?void 0:T.Item),1),_("div",we,[g(x,{label:"Заказать",onClick:f[0]||(f[0]=s=>e.navigateToOrder())})])]),g(w,{class:"additional-clauses",partition:`Header:${((o=D.sectionData)==null?void 0:o.Code)==="Default"?D.sectionID:`/${(E=D.sectionData)==null?void 0:E.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(C(),A(c,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":f[1]||(f[1]=s=>e.sortBy=s),"sort-desc":e.sortDesc,"onUpdate:sortDesc":f[2]||(f[2]=s=>e.sortDesc=s),"sort-direction":e.sortDirection},{"cell(ID)":I(s=>[Be,_("span",null,j(s.value),1)]),"cell(ContractID)":I(s=>{var p;return[Pe,_("span",null,j((p=e.getContracts[s.value])==null?void 0:p.Customer),1)]}),"cell(Keys)":I(s=>{var p,h;return[je,_("span",{title:e.getTitleText((p=s.item)==null?void 0:p.ID)},j(e.findDomainByOrderID((h=s.item)==null?void 0:h.ID)),9,Ne)]}),"cell(StatusID)":I(s=>[Te,g(S,{status:s.value,"status-table":"Orders"},null,8,["status"])]),"cell(ExpirationDate)":I(s=>{var p,h;return[Ee,_("span",null,j(e.calculateExpirationDate((p=s.item)==null?void 0:p.DaysRemainded))+" | "+j(((h=s.item)==null?void 0:h.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":I(s=>{var p;return[Le,g(b,{"user-notice":s.value,id:(p=s.item)==null?void 0:p.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":I(s=>[_("div",Ae,[_("div",{class:"btn btn--md btn--bold",onClick:p=>e.handlePayment(s.item.ID,s.item.ServiceID,s.item.ContractID)},[g(v),V("Оплатить")],8,Re),g(t,{class:"dropdown-dots",right:""},{"button-content":I(()=>[_("div",Ue,[g(B)])]),default:I(()=>[g(y,null,{default:I(()=>[g(P,{to:`/AdditionalServices/${s.item.ID}`},{default:I(()=>[V("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),g(y,{onClick:p=>e.transferItem(s.item.ID,s.item.ServiceID)},{default:I(()=>[V("Передать на другой аккаунт")]),_:2},1032,["onClick"]),D.sectionID==="51000"||D.sectionID==="52000"?(C(),A(y,{key:0,onClick:p=>e.orderManage(s.item.ID,s.item.ServiceID)},{default:I(()=>[V("Управлять заказом")]),_:2},1032,["onClick"])):X("",!0),g(u),g(y,{class:"color-red",onClick:p=>m.$emit("deleteItem",s.item)},{default:I(()=>[V("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","sort-direction"])):(C(),A(k,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const Ve={components:{EmptyStateBlock:F,StatusBadge:re,IconCard:oe,Helper:De},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],setup(m){const f=Q(),D=Y(),e=Z("emitter"),N=H("ID"),U=H(!0),x=H("desc"),w=te(),S=ee(),b=ne(),v=L(()=>S==null?void 0:S.DNSmanagerOrdersList),B=L(()=>S==null?void 0:S.ISPswOrdersList),P=L(()=>S==null?void 0:S.ExtraIPOrdersList),y=L(()=>w==null?void 0:w.contractsList);function u(a,n,r){console.log("serviceID - ",n),n==="50000"||n==="51000"||n==="52000"?k(a,n,r):f.push(`/ServiceOrderPay/${a}`)}const t=a=>{const n=c(a);if(n){const r=n.split(","),i=r.length,l=r.join(`
`);return`Всего: ${i}
${l}`}return"Нет данных"},c=a=>{console.log(a);const n=Object.entries(v.value).reduce((r,[i,l])=>(r[i]=l,r),{});for(const r in n)if(Object.hasOwnProperty.call(n,r)){const i=n[r];if(String(i.OrderID)===String(a))return i.Parked}return null};function k(a,n,r){let i;n==="51000"?i=Object.entries(B.value).reduce((d,[O,M])=>(d[O]=M,d),{}):n==="52000"?i=Object.entries(v.value).reduce((d,[O,M])=>(d[O]=M,d),{}):n==="50000"&&(i=Object.entries(P.value).reduce((d,[O,M])=>(d[O]=M,d),{}));let l;for(const d in i)if(Object.hasOwnProperty.call(i,d)){const O=i[d];if(String(O.OrderID)===String(a)){l=O;break}}if(l&&n==="50000"){const d=h(l.DaysRemainded);e.emit("open-modal",{component:"ServicePayExtraIP",data:{ServiceOrderID:l.ID,contractID:r,ExpirationDate:d}})}else if(l&&n==="51000"){const d=h(l.DaysRemainded);e.emit("open-modal",{component:"ServicePay",data:{ServiceOrderID:l.ID,contractID:r,ExpirationDate:d}})}else if(l&&n==="52000"){const d=h(l.DaysRemainded);e.emit("open-modal",{component:"ServicePayDNS",data:{ServiceOrderID:l.ID,contractID:r,ExpirationDate:d}})}}function T(a,n){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:a,ServiceID:n}})}function o(a,n){let r;n==="51000"?r=Object.entries(B.value).reduce((l,[d,O])=>(l[d]=O,l),{}):n==="52000"&&(r=Object.entries(v.value).reduce((l,[d,O])=>(l[d]=O,l),{}));let i;for(const l in r)if(Object.hasOwnProperty.call(r,l)){const d=r[l];if(String(d.OrderID)===String(a)){i=d;break}}i&&b.OrderManageHosting({ServiceOrderID:i.ID,OrderID:a,ServiceID:n,XMLHttpRequest:"yes"})}const E=a=>{console.log(a);const n=Object.entries(v.value).reduce((r,[i,l])=>(r[i]=l,r),{});for(const r in n)if(Object.hasOwnProperty.call(n,r)){const i=n[r];if(String(i.OrderID)===String(a))return i.Domain}return null};$(()=>{console.log(v),console.log(y)});const s=L(()=>{var a,n;return(n=(a=Object.keys(D==null?void 0:D.userOrders).map(r=>{var i;return{...D==null?void 0:D.userOrders[r],ID:Number((i=D==null?void 0:D.userOrders[r])==null?void 0:i.ID)}}))==null?void 0:a.reverse())==null?void 0:n.filter(r=>r.ServiceID===(m==null?void 0:m.sectionID))});function p(){f.push(`/AdditionalServicesOrder?ServiceID=${m==null?void 0:m.sectionID}`)}function h(a){if(!a)return W(new Date);const n=new Date,r=new Date(n.getTime()+a*24*60*60*1e3);return W(r)}return le(v,a=>{console.log(a)}),{authStore:D,getOrders:s,getContracts:y,sortBy:N,sortDesc:U,sortDirection:x,navigateToOrder:p,servicesStatuses:me,oneTimeWorksFields:ke,calculateExpirationDate:h,getDNSmanagerOrders:v,findDomainByOrderID:E,findParkedByOrderID:c,getTitleText:t,transferItem:T,orderManage:o,servicePay:k,handlePayment:u}}},ce=J(Ve,[["render",Me],["__scopeId","data-v-c24cc6a4"]]),He={class:"section"},Ge={class:"container"},Fe={class:"section-header"},qe={class:"section-nav"},ze=["title","onClick"],Ke={class:"multiselect-option"},We={class:"section-body"};function Xe(m,f,D,e,N,U){var B,P,y,u,t,c,k,T;const x=se,w=be,S=q("Multiselect"),b=ce,v=F;return C(),G(z,null,[g(x),_("div",He,[_("div",Ge,[_("div",Fe,[_("div",qe,[(C(!0),G(z,null,de((B=e.getServices)==null?void 0:B.slice(0,3),o=>{var E;return C(),G("div",{class:K(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(o==null?void 0:o.ID)}]),title:(E=e.getServerGroup(o==null?void 0:o.ServersGroupID))==null?void 0:E.Comment,onClick:s=>e.switchToSection(o==null?void 0:o.ID)},j(o==null?void 0:o.Item),11,ze)}),256)),((P=e.getServices)==null?void 0:P.length)>3?(C(),A(S,{key:0,modelValue:e.section,"onUpdate:modelValue":f[0]||(f[0]=o=>e.section=o),class:K({"multiselect--white additional-service__select":!0,"additional-service__select_active":(u=e.getServices)==null?void 0:u.slice(3,(y=e.getServices)==null?void 0:y.length).find(o=>(o==null?void 0:o.ID)===e.section)}),options:(c=e.getServices)==null?void 0:c.slice(3,(t=e.getServices)==null?void 0:t.length),label:"ID",onSelect:f[1]||(f[1]=o=>e.switchToSection(o))},{option:I(({option:o})=>[_("div",Ke,j(o==null?void 0:o.Item),1)]),caret:I(()=>[g(w,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):X("",!0)])]),_("div",We,[(k=e.getServices)!=null&&k.find(o=>o.ID===e.section)?(C(),A(b,{key:0,sectionID:e.section,sectionData:(T=e.getServices)==null?void 0:T.find(o=>o.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(C(),A(v,{key:1,label:"Услуга не найдена"}))])])])],64)}const Je={components:{ServiceListSection:ce,emptyStateBlock:F,Multiselect:Oe,BlockBalanceAgreement:se},async setup(){const m=_e(),f=Q(),D=Z("emitter"),e=ee(),N=ue(),U=ne(),x=Y(),w=te(),S=H(null),b=L(()=>{var u;return(u=Object.keys(e==null?void 0:e.ServicesList))==null?void 0:u.map(t=>{var c;return{...e==null?void 0:e.ServicesList[t],value:(c=e==null?void 0:e.ServicesList[t])==null?void 0:c.ID}}).filter(t=>(t==null?void 0:t.ServicesGroupID)!=="1000"&&(t==null?void 0:t.IsActive)&&!(t!=null&&t.IsHidden)).sort((t,c)=>Number(t==null?void 0:t.SortID)<Number(c==null?void 0:c.SortID)?-1:Number(t==null?void 0:t.SortID)>Number(c==null?void 0:c.SortID)?1:0)}),v=H(null);D.on("updateServicesList",()=>{x.fetchUserOrders()});function B(u){f.replace(`/AdditionalServices?ServiceID=${u}`),v.value=u}function P(u){var t,c;return(c=(t=N==null?void 0:N.serverGroupsList)==null?void 0:t.ServersGroups)==null?void 0:c[u]}function y(u){U.deleteItem({TableID:"Orders",RowsIDs:u.ID}).then(({result:t,error:c})=>{t==="SUCCESS"&&x.fetchUserOrders()})}return $(()=>{var u,t;console.log(b.value),(u=b.value)!=null&&u.find(c=>{var k;return(c==null?void 0:c.ID)===((k=m==null?void 0:m.query)==null?void 0:k.ServiceID)})?v.value=(t=m==null?void 0:m.query)==null?void 0:t.ServiceID:f.replace(`/AdditionalServices?ServiceID=${v.value}`)}),await e.fetchServices().then(()=>{var u,t;v.value=(t=(u=b.value)==null?void 0:u[0])==null?void 0:t.ID}),await w.fetchContracts(),await x.fetchUserOrders(),await e.fetchDNSmanagerOrders(),await e.fetchISPswOrders(),await e.fetchExtraIPOrders(),{section:v,deleteItem:y,getServices:b,additionalServicesValue:S,switchToSection:B,getServerGroup:P}}},vt=J(Je,[["render",Xe],["__scopeId","data-v-bcf4ce6d"]]);export{vt as default};
