import{L as ee,a as te}from"./bootstrap-vue-next-9iQSFcL_.js";import{_ as se}from"./IconCard-BQu6YZod.js";import{_ as le}from"./Helper-C1WzNFjD.js";import{_ as ae}from"./StatusBadge-DroW9lKR.js";import{_ as oe}from"./FormInputSearch-CTZl1IoO.js";import{_ as ne}from"./ClausesKeeper-DtaNhp0a.js";import{_ as re}from"./BlockBalanceAgreement-ckI0MbGb.js";import{u as ie,am as ue,x as ce,r as m,f as i,h as me,g as de,E as $,c as w,b as r,a as l,i as pe,w as a,v as S,F as ve,d as _e,o as A,t as o,n as fe}from"./index-DxPA2ffO.js";import{u as De}from"./contracts-DD2O0C6m.js";import{u as be}from"./services-DjjrPMAb.js";import{f as B}from"./time-DenPiOX5.js";import{s as C}from"./multiselect-DxJoM0Ze.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-BzyFfXEL.js";import"./IconClose-Br7S99e8.js";import"./ButtonDefault-tVMF5ozh.js";const ge=[{key:"ID",label:"Заказ",variant:"td-blue",sortable:!0},{key:"ServiceID",label:"Услуга",variant:"td-gray td-order bold"},{key:"SchemeName",label:"Тариф",variant:"td-gray td-order"},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"td-gray td-order"},{key:"ContractID",label:"Договор",sortable:!0,variant:"td-blue"},{key:"UserNotice",label:"Примечание",variant:"td-gray td-limited"},{key:"controls",label:"",variant:"td-controls"}],Ie={class:"section"},ye={class:"container"},Ce={class:"section-header"},Oe={class:"list-form"},ke={class:"list-form_col list-form_col--sm"},Ve={class:"list-form_select"},$e={class:"multiselect-option"},xe={class:"list-form_col list-form_col--sm"},Ne={class:"list-form_select"},he={class:"multiselect-option"},Ee={class:"list-form_col list-form_col--sm"},Le={class:"list-form_select"},Re={class:"multiselect-option"},Te={class:"btn__group"},Ue=["onClick"],we={key:0,class:"table-controls"},Ae={class:"multiselect-multiple-label"},Be={class:"multiselect-option"},Pe={__name:"Orders",async setup(Fe){let d,p;const f=_e(),x=de(),g=ie(),N=De(),h=be(),P=ue(),E=ce("emitter");E.on("updateOrdersList",()=>{g.fetchUserOrders()});const O=m(""),v=m(10),D=m(1),F=m([10,25,50,100]),b=m("*"),I=m("*"),y=m("*"),u=i(()=>Object.keys(g?.userOrders).map(s=>g?.userOrders[s])),k=i(()=>{let s=u.value.filter(e=>e?.ID.includes(O.value));return I.value!=="*"&&s!==null&&(s=s.filter(e=>e.ServiceID.includes(I.value))),b.value!=="*"&&s!==null&&(s=s.filter(e=>e.ContractID.includes(b.value))),y.value!=="*"&&s!==null&&(s=s.filter(e=>e.StatusID.includes(y.value))),D.value=1,s}),V=i(()=>N?.contractsList);function H(){f.go(0)}function j(s){if(!s)return B(new Date);const e=new Date,n=new Date(e.getTime()+s*24*60*60*1e3);return B(n)}const _=i(()=>h.ServicesList);function q(s,e){let n="";e==="Default"?n="Orders":n=e+"Orders",E.emit("open-modal",{component:"StatusHistory",data:{modeID:n,rowID:s}})}const L=i(()=>{let s=[{value:"*",name:"Все договора"}];return u.value!==null?(u.value.map(e=>{s.find(n=>n.value===e?.ContractID)||s.push({value:e?.ContractID,name:V.value[e?.ContractID]?.Customer})}),s):{value:"*",name:"Все договора"}}),R=i(()=>{let s=[{value:"*",name:"Все услуги"}];return u.value!==null?(u.value.map(e=>{s.find(n=>n.value===e?.ServiceID)||s.push({value:e?.ServiceID,name:_.value[e?.ServiceID]?.NameShort})}),s):{value:"*",name:"Все услуги"}}),z=i(()=>P.data.Statuses?.Orders),T=i(()=>{let s=[{value:"*",name:"Все статусы"}];return u.value!==null?(u.value.map(e=>{s.find(n=>n.value===e?.StatusID)||s.push({value:e?.StatusID,name:z.value?.[e?.StatusID]?.Name||e?.StatusID})}),s):{value:"*",name:"Все статусы"}});function M(s){return _.value[s]?.Code!=="Default"?_.value[s]?.Code+"Orders":"Orders"}function G(s,e,n){if(!n.target.closest("button, a, .clickable-element")){let c=_.value[s.ServiceID]?.Code;c==="Default"||c==="ExtraIP"||c==="ISPsw"||c==="DNSmanager"?f.push(`/AdditionalServices/${s.ID}`):f.push(`/${c}Orders/${s.ID}`)}}function J(s){let e=_.value[s.ServiceID]?.Code;e==="Default"?f.push(`/ServiceOrderPay/${s.ID}`):f.push(`/${e}OrderPay/${s.ID}`)}return me(()=>{x.query?.contractID&&(b.value=x.query?.contractID)}),[d,p]=$(()=>g.fetchUserOrders()),await d,p(),[d,p]=$(()=>N.fetchContracts()),await d,p(),[d,p]=$(()=>h.fetchServices()),await d,p(),(s,e)=>{const n=re,c=ne,K=oe,Q=ae,W=le,X=se,Y=ee,Z=te;return A(),w(ve,null,[r(n),l("section",Ie,[l("div",ye,[l("div",Ce,[l("h1",{class:"section-title",onClick:e[0]||(e[0]=t=>H())},"Мои заказы")]),r(c),l("div",Oe,[r(K,{modelValue:O.value,"onUpdate:modelValue":e[1]||(e[1]=t=>O.value=t)},null,8,["modelValue"]),l("div",ke,[l("div",Ve,[r(S(C),{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),options:L.value,disabled:L.value?.length<=1,label:"name"},{singlelabel:a(({value:t})=>[l("span",null,"# "+o(t.value.padStart(5,"0"))+" / "+o(t.name),1)]),option:a(({option:t})=>[l("div",$e,"# "+o(t.value.padStart(5,"0"))+" / "+o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l("div",xe,[l("div",Ne,[r(S(C),{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),options:T.value,disabled:T.value?.length<=1,label:"name"},{option:a(({option:t})=>[l("div",he,o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l("div",Ee,[l("div",Le,[r(S(C),{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=t=>I.value=t),options:R.value,disabled:R.value?.length<=1,label:"name"},{option:a(({option:t})=>[l("div",Re,o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])])]),r(Y,{class:"basic-table",fields:S(ge),items:k.value,"show-empty":!0,"per-page":v.value,responsive:"","current-page":D.value,"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onRowClicked:G},{"cell(ID)":a(t=>[e[8]||(e[8]=l("span",{class:"td-mobile"},"Заказ",-1)),l("span",null,o(t.value),1)]),"cell(ServiceID)":a(t=>[e[9]||(e[9]=l("span",{class:"td-mobile"},"Услуга",-1)),l("span",null,o(_.value[t.value]?.NameShort),1)]),"cell(SchemeName)":a(t=>[e[10]||(e[10]=l("span",{class:"td-mobile"},"Тариф",-1)),l("span",null,o(t.item?.SchemeName),1)]),"cell(ExpirationDate)":a(t=>[e[11]||(e[11]=l("span",{class:"td-mobile"},"Дата окончания",-1)),l("span",{class:fe({danger:Number(t.item?.DaysRemainded)<14})},o(j(t.item?.DaysRemainded))+" | "+o(t.item?.DaysRemainded||0)+" дн. ",3)]),"cell(StatusID)":a(t=>[e[12]||(e[12]=l("span",{class:"td-mobile"},"Статус",-1)),r(Q,{class:"clickable-element",status:t.value,"status-table":M(t.item?.ServiceID),onClick:U=>q(t.item?.ServiceOrderID,t.item?.Code)},null,8,["status","status-table","onClick"])]),"cell(ContractID)":a(t=>[e[13]||(e[13]=l("span",{class:"td-mobile"},"Договор",-1)),l("span",null,"#"+o(V.value[t.value]?.ID)+" / "+o(V.value[t.value]?.Customer),1)]),"cell(UserNotice)":a(t=>[e[14]||(e[14]=l("span",{class:"td-mobile"},"Комментарий",-1)),r(W,{"user-notice":t.value,id:t.item?.ID,emit:"updateOrdersList"},null,8,["user-notice","id"])]),"cell(controls)":a(t=>[l("div",Te,[l("button",{class:"btn btn-default btn--border",onClick:U=>J(t.item)},[r(X),e[15]||(e[15]=l("p",null,"ОПЛАТИТЬ",-1))],8,Ue)])]),_:1},8,["fields","items","per-page","current-page"]),k.value?.length>0?(A(),w("div",we,[r(Z,{modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=t=>D.value=t),"total-rows":k.value?.length,"per-page":v.value,"first-number":"","last-number":""},{"first-text":a(()=>e[16]||(e[16]=[l("span",{class:"text-success"},"First",-1)])),"last-text":a(()=>e[17]||(e[17]=[l("span",{class:"text-info"},"Last",-1)])),page:a(({page:t,active:U})=>[l("span",null,o((t-1)*v.value+1)+"-"+o(t*v.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),r(S(C),{class:"multiselect--white",modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=t=>v.value=t),options:F.value,label:"name",openDirection:"top",onInput:e[7]||(e[7]=t=>D.value=1)},{singlelabel:a(({value:t})=>[l("div",Ae,[l("span",null,"Отображать "+o(t.value)+" строк",1)])]),option:a(({option:t})=>[l("div",Be,"Отображать "+o(t.name)+" строк",1)]),_:1},8,["modelValue","options"])])):pe("",!0)])])],64)}}},lt=Se(Pe,[["__scopeId","data-v-f6ea2646"]]);export{lt as default};
