import{j as E,o as f,c as x,b as c,a as r,n as oe,t as D,Z as O,a9 as B,w as L,d as T,F,x as ae,y as R,_ as se,r as _,e as ne,S as te,g as v,i as re}from"./index-5f8fd0e9.js";import{u as le}from"./dedicatedServer-6a2fed0f.js";import{u as ce}from"./contracts-00b6c53b.js";import{I as de}from"./IconSearch-adead29d.js";import{D as z}from"./DSItem-8a4a948f.js";import{S as ie}from"./Select2-2afc5f91.js";import{s as ue}from"./multiselect-482845f2.js";import{_ as G}from"./FormInputSearch-2c551819.js";import{B as H}from"./BlockBalanceAgreement-cf03db60.js";import{u as fe}from"./globalActions-2cf5b597.js";import{_ as _e,B as Z}from"./IconButtonBack-8eb937aa.js";import{E as ve}from"./EmptyStateBlock-153c9c6f.js";import{_ as pe}from"./ClausesKeeper-8218189c.js";import{f as me}from"./bootstrap-vue-next.es-a97602fc.js";import{_ as ge}from"./ButtonDefault-458eab69.js";import"./HelperComponent-9b33bb3d.js";import"./IconArrow-c9744352.js";import"./StatusBadge-fdff4dcc.js";import"./IconRotate-00011174.js";import"./useTimeFunction-8602dd60.js";import"./resetServer-0c21ceb4.js";import"./IconDots-01479051.js";import"./IconCard-3d2eebd0.js";import"./OrderIDBadge-d3e09683.js";import"./IconPlus-13feb66d.js";import"./IconClose-2e1ba86d.js";const Se={class:"section"},De={class:"container"},Ce={class:"title__icon"},he={class:"btn__group"},we={class:"group__several"},Ie={class:"list-form"},be={class:"list-form_col list-form_col--sm"},ke={class:"list-form_select"},Oe={class:"multiselect-option"},Be={key:0};function Le(C,s,P,o,p,h){var S,I,b;const i=H,d=_e,m=ge,w=E("router-link"),u=Z,y=me,M=pe,U=E("Multiselect"),V=G,l=z,g=ve;return f(),x(F,null,[c(i),r("div",Se,[r("div",De,[r("div",{class:oe(["section-header",o.isSeveral?"column":""])},[r("div",Ce,[r("h1",{class:"section-title",onClick:s[0]||(s[0]=n=>o.reloadNow())},D(o.isSeveral?"Продление услуг выделенных серверов":"Выделенные серверы"),1),O(c(d,{onClick:s[1]||(s[1]=n=>o.outSeveralOrders())},null,512),[[B,o.isSeveral]])]),O(r("div",he,[O(c(m,{class:"btn-several",label:"Продлить несколько заказов",onClick:s[2]||(s[2]=n=>o.prolongSeveralOrders())},null,512),[[B,o.getDSList.length>1]]),c(w,{class:"btn btn--blue btn-default",to:"DSSchemes"},{default:L(()=>[T("Заказать")]),_:1})],512),[[B,!o.isSeveral]]),O(r("div",we,[c(u,{class:"contr period",modelValue:o.selectPeriod,"onUpdate:modelValue":s[3]||(s[3]=n=>o.selectPeriod=n)},null,8,["modelValue"]),c(y,{id:"checkbox-balance",modelValue:o.useBalance,"onUpdate:modelValue":s[4]||(s[4]=n=>o.useBalance=n),name:"checkbox-balance"},{default:L(()=>[T("Использовать средства с баланса")]),_:1},8,["modelValue"]),c(m,{label:"Продлить",onClick:s[5]||(s[5]=n=>o.prolongOrders())})],512),[[B,o.isSeveral]])],2),c(M,{partition:"Header:/DSOrders"}),r("div",Ie,[r("div",be,[r("div",ke,[c(U,{modelValue:o.select,"onUpdate:modelValue":s[6]||(s[6]=n=>o.select=n),options:o.getUsers,disabled:((S=o.getUsers)==null?void 0:S.length)<=1,label:"name"},{singlelabel:L(({value:n})=>[r("span",null,"# "+D(n.value.padStart(5,"0"))+" / "+D(n.name),1)]),option:L(({option:n})=>[r("div",Oe,"# "+D(n.value.padStart(5,"0"))+" / "+D(n.name),1)]),_:1},8,["modelValue","options","disabled"])])]),c(V,{modelValue:o.search,"onUpdate:modelValue":s[7]||(s[7]=n=>o.search=n)},null,8,["modelValue"])]),o.getDSList&&((I=o.getDSList)==null?void 0:I.length)>0?(f(),x("div",Be,[o.filterProducts&&((b=o.filterProducts)==null?void 0:b.length)>0?(f(!0),x(F,{key:0},ae(o.filterProducts,(n,k)=>(f(),R(l,{params:o.getDSItemParam(n),"is-last":k===o.filterProducts.length-1,"item-data":n,isSeveral:o.isSeveral,"selected-rows":o.selectedRows,onUpdateSelectedRows:o.handleSelectedRowsUpdate,onDelete:o.deleteItem,onTransfer:o.transferItem,onManage:o.orderManage},null,8,["params","is-last","item-data","isSeveral","selected-rows","onUpdateSelectedRows","onDelete","onTransfer","onManage"]))),256)):(f(),R(g,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(f(),R(g,{key:1,class:"no-margin",label:"У Вас нет заказов на выделенные серверы"}))])])],64)}const Pe={components:{FormInputSearch:G,IconSearch:de,Select2:ie,Multiselect:ue,DSItem:z,BlockBalanceAgreement:H,BlockSelectPeriod:Z},async setup(){const C=_("*"),s=_(null),P=fe(),o=le(),p=ce(),h=ne(),i=_(!1),d=_([]),m=_(null),w=_(!1),u=te("emitter");u.on("updateDSOrdersList",()=>{o.fetchDSOrders()});const y=a=>{d.value=a};async function M(){console.log(d.value);const a=Object.keys(d.value).filter(t=>d.value[t]),e={ServiceID:"40000",ItemsPay:m.value,OrdersIDs:a,...w.value&&{UseBalance:"yes"}};await P.OrdersPay(e).then(t=>{t==="Basket"?(console.log("Success"),h.push("/Basket")):(t==null?void 0:t.Status)==="Ok"&&(i.value=!1,u.emit("open-modal",{component:"BalanceProlong",data:{Message:t==null?void 0:t.Message,Count:t==null?void 0:t.Count}}))})}function U(){i.value=!0}function V(){i.value=!1}const l=v(()=>{var a;return(a=Object.keys(o==null?void 0:o.DSList).map(e=>o==null?void 0:o.DSList[e]))==null?void 0:a.reverse()}),g=v(()=>o==null?void 0:o.DSSchemes),S=v(()=>p==null?void 0:p.contractsList),I=v(()=>o==null?void 0:o.DSOrderIPMI),b=v(()=>J(q(l.value)));re(()=>{l.value.length<1&&k()});function n(){h.go(0)}function k(){h.push({path:"/DSSchemes"})}function q(a){return C.value!=="*"?a.filter(e=>(e==null?void 0:e.ContractID)===C.value):a}function J(a){return s.value!==null?a.filter(e=>(e==null?void 0:e.Customer.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.OrderID.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.Scheme.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.IP.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.disks.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.CPU.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.ram.toLowerCase().includes(s.value.toLowerCase()))):a}function K(a){P.OrderManage(a)}const Q=v(()=>{let a=[{value:"*",name:"Все договора"}];return l.value!==null&&S.value!==null?(Object.keys(l.value).forEach(e=>{var t,N,j;a.find(ee=>{var A;return ee.value===((A=l.value[e])==null?void 0:A.ContractID)})||a.push({value:(t=l.value[e])==null?void 0:t.ContractID,name:(j=S.value[(N=l.value[e])==null?void 0:N.ContractID])==null?void 0:j.Customer})}),a):{value:"*",name:"Все договора"}});function W(a){let e=X(a==null?void 0:a.SchemeID);e===void 0&&(e=a);let t=[];return a!=null&&a.Scheme&&t.push(a==null?void 0:a.Scheme),a!=null&&a.CPU&&t.push(a==null?void 0:a.CPU),e!=null&&e.ram&&t.push("RAM "+(e==null?void 0:e.ram)+" GB"),e!=null&&e.disks&&t.push(e==null?void 0:e.disks),e!=null&&e.CostMonth&&t.push("<b>"+(e==null?void 0:e.CostMonth)+"/ месяц</b>"),t}function X(a){var e;return(e=g.value)==null?void 0:e[a]}function Y(a){u.emit("open-modal",{component:"DeleteItem",data:{id:a,message:"Вы действительно хотите удалить этот сервер?",tableID:"DSOrders",successEmit:"updateDSOrdersList"}})}function $(a){u.emit("open-modal",{component:"OrdersTransfer",data:a})}return await o.fetchDSOrders(),await o.fetchDSSchemes(),await o.fetchDSOrderIPMI(),await p.fetchContracts(),{getDSList:l,filterProducts:b,select:C,search:s,getUsers:Q,getDSSchemes:g,getDSItemParam:W,getDSOrderIPMI:I,orderManage:K,deleteItem:Y,transferItem:$,navigateToDSSchemes:k,reloadNow:n,prolongSeveralOrders:U,isSeveral:i,selectedRows:d,selectPeriod:m,prolongOrders:M,outSeveralOrders:V,useBalance:w,handleSelectedRowsUpdate:y}}},ao=se(Pe,[["render",Le],["__scopeId","data-v-143eaad1"]]);export{ao as default};
