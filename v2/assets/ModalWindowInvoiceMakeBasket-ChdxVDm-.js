import{ao as x,D as N,x as M,r as f,d as B,f as j,o as l,c as m,a as d,F as _,g as A,n as $,t as S,h as C}from"./index-Codq73aV.js";import{u as F}from"./invoices-Cz8B-NWJ.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const V={key:0,class:"tw-grid tw-grid-cols-2 md:tw-grid-cols-3 tw-gap-4 tw-mt-4"},W=["onClick"],z={class:"tw-flex tw-justify-center"},E=["src"],J={class:"tw-text-xs tw-text-center tw-mt-2 tw-text-gray-500"},L={class:"modal__error"},R={__name:"ModalWindowInvoiceMakeBasket",props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(g,{emit:k}){const a=g,c=k,u=x(),I=F(),v=N(),p=M("emitter"),h=f(null),P=B(),o=f(null),y=j(()=>{const n=a.data.ContractPaymentSystems;if(u.data.PaymentSystems&&n){const t=new Set(n);return Object.keys(u.data.PaymentSystems).filter(s=>t.has(s)).map(s=>{const r=u.data.PaymentSystems[s];return r.IsActive==="1"&&Number(r.MaximumPayment)>=a.data.sum&&Number(r.MinimumPayment)<=a.data.sum?r.Collations:null}).filter(s=>s!==null).flat().slice().sort((s,r)=>{const D=Number.parseInt(s.SortID,10),w=Number.parseInt(r.SortID,10);return isNaN(D)?1:isNaN(w)?-1:D-w})}else return null});function b(n){o.value={id:n.ID,type:n.Source},a.data.ProfileID===null?o.value?.type==="Natural"||o.value?.type==="Juridical"||o.value?.type==="Individual"?(P.push(`/ProfileMake?ContractNew=${a.data.ItemID}&TemplateID=${o.value.type}`),c("modalClose")):I.InvoiceMake({ContractID:a.data.ItemID,PaymentSystemID:o.value.type}).then(t=>{if(t.status==="success"&&t.data&&t.data.InvoiceID){c("modalClose");const e=t.data.InvoiceID;v.InvoiceDocument({InvoiceID:e}).then(i=>{p.emit("open-modal",{component:"InvoiceDocumentBasket",data:{html:i,ID:e}})})}else c("modalClose")}):I.InvoiceMake({ContractID:a.data.ItemID,PaymentSystemID:o.value?.type}).then(t=>{if(t.status==="success"&&t.data&&t.data.InvoiceID){c("modalClose");const e=t.data.InvoiceID;v.InvoiceDocument({InvoiceID:e}).then(i=>{p.emit("open-modal",{component:"InvoiceDocumentBasket",data:{html:i,ID:e}})})}else c("modalClose")})}return(n,t)=>(l(),m("div",null,[t[0]||(t[0]=d("div",{class:"tw-text-2xl"},"Выбрать платёжную систему",-1)),y.value?(l(),m("div",V,[(l(!0),m(_,null,A(y.value,e=>(l(),m(_,{key:e.ID},[e.IsActive?(l(),m("div",{key:0,class:$(["tw-cursor-pointer tw-p-4 tw-border tw-border-gray-200 hover:tw-border-orange-500 tw-rounded",o.value?.id===e.ID?"tw-border-orange-500":"tw-border-gray-200"]),onClick:i=>b(e)},[d("div",z,[d("img",{class:"tw-w-32 tw-h-20 tw-object-contain",src:e.Image},null,8,E)]),d("div",J,S(e.Description),1)],10,W)):C("",!0)],64))),128))])):C("",!0),d("div",L,S(h.value),1)]))}},H=O(R,[["__scopeId","data-v-9dcc8e45"]]);export{H as default};
