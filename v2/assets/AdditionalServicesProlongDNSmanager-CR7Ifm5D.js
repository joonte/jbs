import{_ as L}from"./EmptyStateBlock-DgFyy_gi.js";import{_ as R}from"./BlockOrderPayBalance-BulK2jU0.js";import{_ as $}from"./ClausesKeeper-Cjjq7JUL.js";import{_ as j}from"./ButtonDefault-CgQ13ecW.js";import{_ as M}from"./BlockBalanceAgreement-BNU6bIWW.js";import{r as w,f as h,g as U,h as V,E as f,c as _,b as v,a as t,D as C,F as k,t as n,i as T,I as O,j as q,J as x,d as J,o as c}from"./index-DakgQwZZ.js";import{u as z}from"./contracts-C-xJvA56.js";import{u as G}from"./services-De9u6bRn.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-CDL_Y1-V.js";import"./component-BXhtJwv0.js";import"./globalActions-BG7EYttN.js";import"./IconHelp-DQ9vdhmP.js";import"./IconClose-Camrw-uN.js";const K={class:"tw-px-4 md:tw-px-8"},Q={class:"section-header"},W={class:"section-header__wrapper"},X={class:"section-label"},Y={key:0,class:"total-block"},Z={class:"total-block__row divider-bottom"},ee={class:"total-block__col"},te={class:"total-block__col"},oe={class:"total-block__col"},ae={class:"total-block__row total-block__row--big economy-line"},se={class:"total-block__col flex-col"},le={class:"red"},ne={class:"total-block__row total-block__row--big"},ce={class:"total-block__col"},re={class:"total-block__col"},ie={__name:"AdditionalServicesProlongDNSmanager",async setup(de){let d,u;const y=z(),l=G(),F=U(),I=J(),o=w(null),p=w(!1),s=h(()=>Object.keys(l?.DNSmanagerOrdersList).map(a=>l?.DNSmanagerOrdersList[a]).find(a=>a.OrderID===F.params.id)),D=h(()=>l?.additionalServicesScheme?.DNSmanager?Object.keys(l.additionalServicesScheme.DNSmanager).map(a=>{const e=l.additionalServicesScheme.DNSmanager[a];return{...e,value:e?.ID,name:e?.Name,cost:e?.CostDay,month:e?.CostMonth}}).filter(a=>a?.ID==s.value?.SchemeID):[]),S=h(()=>y.contractsList);function N(){p.value=!0;const a=S.value[s.value.ContractID]?.Balance>=(r(o.value?.price-b())??0)||D.value[0]?.cost==="0.00"&&D.value[0]?.month==="0.00",e=!a,g={DNSmanagerOrderID:s.value.ID,DaysPay:o.value?.actualDays,IsNoBasket:a,IsUseBasket:e,PayMessage:""};l.DNSOrderPay(g).then(m=>{m==="UseBasket"?I.push("/Basket"):m==="NoBasket"?I.push("/AdditionalServices?ServiceID=52000"):console.error("Ошибка оплаты заказа"),p.value=!0})}function r(a){return Number(a).toFixed(2)||0}function b(){let a=0;return o.value?.discounts?.Bonuses.map(e=>{a+=+e.Economy}),a}function P(a){o.value=a}return V(()=>{l.fetchAdditionalServiceScheme("DNSmanager")}),[d,u]=f(()=>l.fetchDNSmanagerOrders()),await d,u(),[d,u]=f(()=>l.fetchAdditionalServiceScheme("DNSmanager")),await d,u(),[d,u]=f(()=>y.fetchContracts()),await d,u(),(a,e)=>{const g=M,m=j,A=$,E=R,B=L;return c(),_(k,null,[v(g),t("div",K,[s.value?(c(),_(k,{key:0},[t("div",Q,[t("div",W,[e[2]||(e[2]=t("h1",{class:"section-title"},"Оплата заказа вторичного DNS",-1)),v(m,{class:"btn--wide",label:parseFloat(S.value[s.value.ContractID]?.Balance)>=parseFloat(o.value?.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||o.value?.price===null,"is-loading":p.value,onClick:e[0]||(e[0]=i=>N())},null,8,["label","disabled","is-loading"])]),t("div",X,n(D.value[0]?.Name),1)]),v(A),v(E,{contractID:s.value?.ContractID,daysRemainded:s.value?.DaysRemainded,serviceID:"52000",scheme:D.value[0],orderID:s.value?.OrderID,isOrderID:!0,onSelect:P},null,8,["contractID","daysRemainded","scheme","orderID"]),s.value?(c(),_("div",Y,[o.value?.discounts?.Bonuses?.length>0?(c(),_(k,{key:0},[t("div",Z,[e[3]||(e[3]=t("div",{class:"total-block__col"},"Цена тарифа",-1)),t("div",ee,n(r(o.value?.price))+" ₽",1)]),(c(!0),_(k,null,q(o.value?.discounts?.Bonuses,i=>(c(),_("div",{class:"total-block__row no-divider",key:i?.Discount+"-"+i?.Days},[t("div",te,"Скидка "+n(i?.Discount)+"% на "+n(i?.Days)+" дней",1),t("div",oe,"-"+n(r(i?.Economy))+" ₽",1)]))),128)),O(t("div",ae,[e[4]||(e[4]=t("div",{class:"total-block__col red"},"Выгода",-1)),t("div",se,[t("span",null,[t("s",null,n(r(o.value?.price))+" ₽",1)]),t("span",le,"-"+n(r(b()))+" ₽",1)])],512),[[x,o.value?.discounts?.Bonuses?.length>0]])],64)):T("",!0),O(t("div",ne,[t("div",ce,"Итого за "+n(o.value?.label),1),t("div",re,n(r(o.value?.price-b()))+" ₽",1)],512),[[x,o.value?.price]]),v(m,{class:"btn--wide",label:parseFloat(S.value[s.value.ContractID]?.Balance)>=(r(o.value?.price-b())??0)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||o.value?.price===null,"is-loading":p.value,onClick:e[1]||(e[1]=i=>N())},null,8,["label","disabled","is-loading"])])):(c(),C(B,{key:1,class:"no-margin",label:"Заказ нельзя продлить"}))],64)):(c(),C(B,{key:1,label:"не удалось найти заказ хостинга"}))])],64)}}},Ne=H(ie,[["__scopeId","data-v-39a91d43"]]);export{Ne as default};
