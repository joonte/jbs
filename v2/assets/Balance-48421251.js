import{j,o as l,c as _,b as h,a as e,t as A,F as b,x as K,k as x,y as M,n as F,p as O,l as R,_ as U,u as z,S as T,a7 as q,e as G,r as V,g as N,h as H,O as J}from"./index-5e313302.js";import{I as Q}from"./IconSearch-5f35739d.js";import{_ as E}from"./ClausesKeeper-eb954229.js";import{c as W}from"./component-6a5a025c.js";import{u as X}from"./postings-03760ecf.js";import{u as Y}from"./contracts-3351d68f.js";import{u as Z}from"./invoices-5e70ed98.js";import{B as $}from"./BlockBalanceAgreement-bb87adc1.js";import{E as tt}from"./EmptyStateBlock-9f752916.js";import{_ as et}from"./ButtonDefault-7c216fc6.js";import"./IconClose-1f889a2e.js";import"./bootstrap-vue-next.es-a19a8b41.js";import"./IconArrow-555f9d45.js";const S=i=>(O("data-v-ad4549c4"),i=i(),R(),i),ot={class:"section"},st={class:"container"},nt={class:"section-header"},it=S(()=>e("h1",{class:"section-title"},"Пополнить баланс",-1)),at={class:"section-label"},ct={key:0,class:"list-form"},lt={class:"list-part"},rt=S(()=>e("div",{class:"list-item__title"},"Платежные системы",-1)),dt={key:0,class:"list-row grid-net"},_t=["onClick"],mt=["src"],ut={class:"list-item__image-title"},pt={class:"list-part"},vt=S(()=>e("div",{class:"list-item__title"},"Сумма пополнения",-1)),ft={class:"list-row"},St=S(()=>e("div",{class:"list-form_col list-form_col--sm"},"Пополнить на сумму",-1)),It={class:"list-form_col list-form_col--xl"},ht={class:"search-field form-field"},gt={class:"list-row"},kt=S(()=>e("div",{class:"list-form_col list-form_col--sm"},null,-1)),Ct={class:"btn-container"};function Dt(i,r,P,s,w,g){const k=$,m=E,u=j("imask-input"),p=et,v=tt;return l(),_(b,null,[h(k),e("div",ot,[e("div",st,[e("div",nt,[it,e("div",at,"Договор # "+A(i.$route.params.id)+" / "+A(s.getContract.Customer),1)]),h(m),s.getContract?(l(),_("div",ct,[e("div",lt,[rt,s.filterActiveSystems?(l(),_("div",dt,[(l(!0),_(b,null,K(s.filterActiveSystems,t=>{var I;return l(),_(b,null,[t!=null&&t.IsActive?(l(),_("div",{key:0,class:F(["list-item",{"list-item_active":((I=s.paymentSystem)==null?void 0:I.id)===(t==null?void 0:t.ID)}]),onClick:C=>s.paymentSystem={id:t==null?void 0:t.ID,type:t==null?void 0:t.Source}},[e("img",{class:"list-item__image",src:t==null?void 0:t.Image},null,8,mt),e("div",ut,A(t==null?void 0:t.Description),1)],10,_t)):x("",!0)],64)}),256))])):x("",!0)]),e("div",pt,[vt,e("div",ft,[St,e("div",It,[e("div",ht,[h(u,{type:"text",mask:Number,placeholder:"100 ₽",modelValue:s.inputValue,"onUpdate:modelValue":r[0]||(r[0]=t=>s.inputValue=t)},null,8,["modelValue"])])])]),e("div",gt,[kt,e("div",Ct,[h(p,{"is-loading":s.isLoading,label:"Пополнить баланс",onClick:r[1]||(r[1]=t=>s.sendInvoice())},null,8,["is-loading"])])])])])):(l(),M(v,{key:1,label:"Договор не найден"}))])])],64)}const yt={components:{IconSearch:Q,BlockBalanceAgreement:$,ClausesKeeper:E,"imask-input":W},async setup(){const i=Y(),r=z(),P=Z(),s=X(),w=T("emitter"),g=q(),k=G(),m=V(null),u=V(null),p=V(!1),v=N(()=>{var o;return(o=i.contractsList)==null?void 0:o[g.params.id]}),t=N(()=>r.ConfigList),I=N(()=>{const o=t.value,a=v.value;if(o!=null&&o.PaymentSystems&&(a!=null&&a.PaymentSystems)){const d=new Set(a.PaymentSystems),f=Object.keys(o.PaymentSystems).filter(n=>d.has(n)).map(n=>{const c=o.PaymentSystems[n];return String(c==null?void 0:c.IsActive)==="1"?c.Collations:null}).filter(n=>n!==null).flat().slice().sort((n,c)=>{const y=parseInt(n.SortID,10),B=parseInt(c.SortID,10);return console.log(`SortID a: ${n.SortID}, parsed: ${y}`),console.log(`SortID b: ${c.SortID}, parsed: ${B}`),isNaN(y)?1:isNaN(B)?-1:y-B});return console.log("filterActiveSystems:",f),f}else return console.log("filterActiveSystems: null"),null}),C=o=>{o.key==="Enter"&&o.ctrlKey&&L()};H(()=>{document.addEventListener("keyup",C)}),J(()=>{document.removeEventListener("keyup",C)});function L(){var o,a;u.value>0&&(p.value=!0,P.InvoiceMake({ContractID:(o=v.value)==null?void 0:o.ID,PaymentSystemID:(a=m.value)==null?void 0:a.type,Summ:u.value}).then(d=>{var D;if(p.value=!1,d.status==="success"&&d.data&&d.data.InvoiceID){const f=d.data.InvoiceID;s.InvoiceDocument({InvoiceID:f}).then(n=>{w.emit("open-modal",{component:"InvoiceDocument",data:{html:n,ID:f}})})}else k.push(`/ProfileMake?Contract=${g.params.id}&TemplateID=${(D=m.value)==null?void 0:D.type}`)}))}return await i.fetchContracts(),{inputValue:u,getConfig:t,filterActiveSystems:I,paymentSystem:m,isLoading:p,getContract:v,sendInvoice:L}}},Mt=U(yt,[["render",Dt],["__scopeId","data-v-ad4549c4"]]);export{Mt as default};
