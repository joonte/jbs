import{_ as oe,r as A,h as T,i as $,o as u,c as D,a as c,t as V,m as ie,k as p,p as le,l as de,j as se,b as G,y as Y,w as ce,F as M,x as J,d as K,Z as ue,af as fe,f as _e,e as De,a7 as ve,S as Se,g as b,O as he}from"./index-59dbe3d3.js";import{u as Ie}from"./contracts-d90f6cbb.js";import{u as Oe}from"./domain-68920d34.js";import{u as ye}from"./services-05e05079.js";import{s as ke}from"./multiselect-49fa0a82.js";import{_ as be}from"./ButtonDefault-a62141a4.js";import{_ as pe}from"./BasicInput-1e25083b.js";import{_ as Ce}from"./BlockSelectContract-7716f4f9.js";import{_ as ge}from"./ClausesKeeper-b1ff97f6.js";const Ve={props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:f}){const r=A(null);function a(){f("update:modelValue",l.data)}return T(l,()=>{r.value=l.modelValue}),$(()=>{r.value=l.modelValue}),{updateValue:a,inputValue:r}}},me=l=>(le("data-v-414dbe12"),l=l(),de(),l),Ne={class:"form-input_border"},Ae=["checked","name","type"],Be={class:"form-input_border-content"},Ee=me(()=>c("span",{class:"form-input_border-mark"},null,-1)),je={class:"form-input_border-item form-input_border-item--left"},we={class:"form-input_border-item form-input_border-item--right"};function xe(l,f,r,a,R,h){var B,s,E;return u(),D("label",Ne,[c("input",{checked:((B=a.inputValue)==null?void 0:B.value)===((s=r.data)==null?void 0:s.value),name:r.name,type:r.checkbox?"checkbox":"radio",onInput:f[0]||(f[0]=(...m)=>a.updateValue&&a.updateValue(...m))},null,40,Ae),c("span",Be,[Ee,c("span",je,V((E=r.data)==null?void 0:E.name),1),r.data.price?ie(l.$slots,"default",{key:0},()=>{var m;return[c("span",we,V((m=r.data)==null?void 0:m.price),1)]},!0):p("",!0)])])}const re=oe(Ve,[["render",xe],["__scopeId","data-v-414dbe12"]]),ee=l=>(le("data-v-f53933d6"),l=l(),de(),l),Pe={key:0,class:"section"},Ue={class:"section-header"},Fe={key:2,class:"form-field form-field--basic"},Le=ee(()=>c("div",{class:"form-field__label"},[K("IP адрес лицензии"),c("span",null,"*")],-1)),Me={class:"form-field-input__wrapper"},Te={key:3,class:"form-field form-field--basic"},Ke=ee(()=>c("div",{class:"form-field__label"},[K("Выбрать заказ"),c("span",null,"*")],-1)),Re={class:"form-field-input__wrapper"},qe={class:"multiselect-option"},We={class:"form-field form-field--basic"},He={class:"form-field__label"},Ze={key:0},ze={class:"form-field-input__wrapper"},Ge=["name","onUpdate:modelValue"],Je={key:5,class:"section"},Qe={class:"list"},Xe={class:"list-col list-col--md"},Ye=ee(()=>c("div",{class:"list-item__title"},[K("Тариф"),c("span",null,"*")],-1)),$e={key:6,class:"section"},ea={class:"list"},aa={class:"list-col list-col--md"},na={class:"list-item__title"},ta={key:0},oa={key:7,class:"section"},la={class:"total-block block--divider"},da={class:"total-block__row total-block__row--big"},ra={class:"total-block__col"},ia={class:"total-block__col"},sa={key:8,class:"additional-service__inline-price"};function ca(l,f,r,a,R,h){var x,O,q,W,j,P,U,H,Z,F;const B=ge,s=Ce,E=pe,m=se("Multiselect"),w=re,I=be;return u(),D(M,null,[r.isInline?p("",!0):(u(),D("div",Pe,[c("div",Ue,[c("h1",{class:"section-title",onClick:f[0]||(f[0]=d=>a.reloadNow())},V((x=r.sectionData)==null?void 0:x.Item),1),G(B,{partition:`Header:${((O=r.sectionData)==null?void 0:O.Code)==="Default"?r.sectionID:`/${(q=r.sectionData)==null?void 0:q.Code}Orders`}`},null,8,["partition"])])])),r.isInline?p("",!0):(u(),Y(s,{key:1,class:"additional-service__contract-select",title:"Договор",modelValue:a.contractSelect,"onUpdate:modelValue":f[1]||(f[1]=d=>a.contractSelect=d)},null,8,["modelValue"])),a.DependOrderID==="0"&&r.sectionID==="51000"?(u(),D("div",Fe,[Le,c("div",Me,[G(E,{name:"ServiceIP",placeholder:"0.0.0.0",modelValue:a.serviceIP,"onUpdate:modelValue":f[2]||(f[2]=d=>a.serviceIP=d)},null,8,["modelValue"])])])):p("",!0),((W=a.getDependOrders)==null?void 0:W.length)>0?(u(),D("div",Te,[Ke,c("div",Re,[G(m,{class:"multiselect--white",placeholder:"Все заказы",label:"name","track-by":"value",options:a.getDependOrders,modelValue:a.DependOrderID,"onUpdate:modelValue":f[3]||(f[3]=d=>a.DependOrderID=d)},{option:ce(({option:d})=>[c("div",qe,V(d.name),1)]),_:1},8,["options","modelValue"])])])):p("",!0),((j=a.getInputFields)==null?void 0:j.length)>0?(u(!0),D(M,{key:4},J(a.getInputFields,d=>(u(),D("div",We,[c("div",He,[K(V(d==null?void 0:d.Name),1),d!=null&&d.IsDuty?(u(),D("span",Ze,"*")):p("",!0)]),c("div",ze,[ue(c("input",{name:`ID${d==null?void 0:d.ID}`,"onUpdate:modelValue":C=>a.formData[`ID${d==null?void 0:d.ID}`]=C},null,8,Ge),[[fe,a.formData[`ID${d==null?void 0:d.ID}`]]])])]))),256)):p("",!0),((P=r.sectionData)==null?void 0:P.Code)!=="Default"&&((U=a.getAdditionalServicesSchemes)==null?void 0:U.length)>0?(u(),D("div",Je,[c("div",Qe,[c("div",Xe,[Ye,(u(!0),D(M,null,J(a.getAdditionalServicesSchemes,d=>{var C,N;return u(),Y(w,{name:`${(C=r.sectionData)==null?void 0:C.Code}SchemeID`,checkbox:!1,data:d,modelValue:a.formData[`${(N=r.sectionData)==null?void 0:N.Code}SchemeID`],"onUpdate:modelValue":f[4]||(f[4]=Q=>{var L;return a.formData[`${(L=r.sectionData)==null?void 0:L.Code}SchemeID`]=Q}),disabled:a.isDepend()},null,8,["name","data","modelValue","disabled"])}),256))])])])):p("",!0),((H=a.getSelectFields)==null?void 0:H.length)>0?(u(),D("div",$e,[c("div",ea,[(u(!0),D(M,null,J(a.getSelectFields,d=>(u(),D("div",aa,[c("div",na,[K(V(d==null?void 0:d.Name),1),d!=null&&d.IsDuty?(u(),D("span",ta,"*")):p("",!0)]),(u(!0),D(M,null,J(a.getSelectFieldOptions(d),C=>(u(),Y(w,{name:`ID${d==null?void 0:d.ID}`,checkbox:!1,data:C,modelValue:a.formData[`ID${d==null?void 0:d.ID}`],"onUpdate:modelValue":N=>a.formData[`ID${d==null?void 0:d.ID}`]=N},null,8,["name","data","modelValue","onUpdate:modelValue"]))),256))]))),256))])])):p("",!0),r.isInline?(u(),D("div",sa,V(a.finalPrice()||0)+" ₽",1)):(u(),D("div",oa,[c("div",la,[c("div",da,[c("div",ra,"Итого за 1 "+V((Z=r.sectionData)==null?void 0:Z.Measure),1),c("div",ia,V(a.finalPrice()||0)+" ₽",1)])]),G(I,{class:"btn--wide",disabled:a.getButtonDisableCondition||!a.formData[`${r.sectionData.Code}SchemeID`]&&((F=r.sectionData)==null?void 0:F.Code)!=="Default",label:"Заказать","is-loading":a.isLoading,onClick:f[5]||(f[5]=d=>a.payForOrder())},null,8,["disabled","is-loading"])]))],64)}const ua={components:{InputBorderCheckboxRadio:re,Multiselect:ke},props:{modelValue:{type:Object,default:()=>{}},sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},emits:["updateList","update:modelValue"],setup(l,{emit:f}){const r=Ie(),a=ye();_e();const R=Oe(),h=De(),B=ve(),s=A({}),E=A(null),m=A(null),w=A(null),I=A(""),x=A(null),O=A(!1);Se("emitter"),b(()=>r==null?void 0:r.contractsList),b(()=>a.ServicesList),b(()=>R.domainsList);const q=b(()=>{var t,o;return(o=Object.keys((a==null?void 0:a.additionalServicesScheme[(t=l.sectionData)==null?void 0:t.Code])||{}))==null?void 0:o.map(e=>{var v,g,y,_,S,k,z,ne,te;const n=((g=a==null?void 0:a.additionalServicesScheme[(v=l.sectionData)==null?void 0:v.Code][e])==null?void 0:g.DependOrders)||{},i=Object.keys(n);return{...a==null?void 0:a.additionalServicesScheme[(y=l.sectionData)==null?void 0:y.Code][e],value:(S=a==null?void 0:a.additionalServicesScheme[(_=l.sectionData)==null?void 0:_.Code][e])==null?void 0:S.ID,price:(z=a==null?void 0:a.additionalServicesScheme[(k=l.sectionData)==null?void 0:k.Code][e])==null?void 0:z.CostMonth,name:(te=a==null?void 0:a.additionalServicesScheme[(ne=l.sectionData)==null?void 0:ne.Code][e])==null?void 0:te.Name,dependOrders:i}}).sort((e,n)=>Number(e==null?void 0:e.SortID)<Number(n==null?void 0:n.SortID)?-1:Number(e==null?void 0:e.SortID)>Number(n==null?void 0:n.SortID)?1:0).filter(e=>I.value==="0"?(e==null?void 0:e.IsActive)&&e.dependOrders.length===0:I.value===null||I.value===""?e==null?void 0:e.IsActive:(e==null?void 0:e.IsActive)&&e.dependOrders.includes(I.value))}),W=b(()=>{var o;let t=!1;return(o=P.value)==null||o.forEach(e=>{e!=null&&e.IsDuty&&(s.value[`ID${e==null?void 0:e.ID}`]===null||s.value[`ID${e==null?void 0:e.ID}`]===void 0||s.value[`ID${e==null?void 0:e.ID}`]==="")&&(t=!0)}),t}),j=b(()=>{var t;return(t=l.sectionData)==null?void 0:t.ServicesFields.filter(o=>(o==null?void 0:o.TypeID)==="Select").sort((o,e)=>Number(o==null?void 0:o.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),P=b(()=>{var t;return(t=l.sectionData)==null?void 0:t.ServicesFields.filter(o=>(o==null?void 0:o.TypeID)==="Input").sort((o,e)=>Number(o==null?void 0:o.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),U=b(()=>{var v,g,y;let t=[];const o=a==null?void 0:a.additionalServicesScheme[(v=l.sectionData)==null?void 0:v.Code];if(((g=l.sectionData)==null?void 0:g.Code)==="Default"){const _=(y=Object.keys(a==null?void 0:a.ServicesList))==null?void 0:y.map(S=>{var k;return{...a==null?void 0:a.ServicesList[S],value:(k=a==null?void 0:a.ServicesList[S])==null?void 0:k.ID}}).filter(S=>(S==null?void 0:S.ID)===B.query.ServiceID);if(_.length>0){const S=_[0].DependOrders;S&&(t=Object.entries(S).map(([k,z])=>({name:z,value:k})))}return t}if(!o)return t;const e=Object.values(o).filter(_=>(_==null?void 0:_.IsActive)&&(_==null?void 0:_.DependOrders)).flatMap(_=>Object.entries(_.DependOrders)),n=new Map;e.forEach(([_,S])=>{const k=`${_}:${S}`;n.has(k)||n.set(k,{name:S,value:_})});const i=Array.from(n.values());return l.sectionID==="51000"?t=[{name:"Без заказа",value:"0"},...i]:t=i,t}),H=b(()=>{var e;const t=a==null?void 0:a.additionalServicesScheme[(e=l.sectionData)==null?void 0:e.Code];return t?Object.values(t).filter(n=>(n==null?void 0:n.IsActive)&&(n==null?void 0:n.DependOrders)).flatMap(n=>Object.entries(n.DependOrders)).map(([n,i])=>({name:i,value:n})):[]}),Z=b(()=>{var n,i,v;const t=(i=s.value[`${(n=l.sectionData)==null?void 0:n.Code}SchemeID`])==null?void 0:i.ID,o=a==null?void 0:a.additionalServicesScheme[(v=l.sectionData)==null?void 0:v.Code];if(!t)return H.value;const e=o==null?void 0:o[t];return e&&e.DependOrders?Object.entries(e.DependOrders).map(([g,y])=>({name:y,value:g})):[]});T(()=>l.sectionID,()=>{I.value=""});const F=t=>{t.key==="Enter"&&t.ctrlKey&&L()};$(()=>{document.addEventListener("keyup",F)}),he(()=>{document.removeEventListener("keyup",F)});function d(){h.go(0)}function C(){var o;let t=0;return Object.keys(s.value).map(e=>{var n,i;(n=s.value[e])!=null&&n.price&&(t=t+Number((i=s.value[e])==null?void 0:i.price))}),t+Number((o=l.sectionData)==null?void 0:o.Cost)}function N(t){var o,e;return(e=(o=t==null?void 0:t.Options)==null?void 0:o.split(`
`))==null?void 0:e.map(n=>{let i=n.split("=");return{value:i[0],name:i[1],price:i[2]}})}function Q(){return l.sectionID==="50000"&&U.value.length<1}function L(){var o;O.value=!0;let t={};(o=Object.keys(s.value))==null||o.forEach(e=>{var n,i;t[e]=(n=s.value[e])!=null&&n.value?(i=s.value[e])==null?void 0:i.value:s.value[e]}),t.ContractID=w.value,t.ServiceID=l.sectionID,t.DependOrderID=I.value,I.value==="0"&&(t.IP=x.value),l.sectionID==="50000"?a.ExtraIPOrder(t).then(({result:e,info:n,error:i})=>{O.value=!1,e==="SUCCESS"?h.push(`/AdditionalServices?ServiceID=${l.sectionID}`):e==="BASKET"&&h.push("/Basket")}):l.sectionID==="51000"?a.ISPswOrder(t).then(({result:e})=>{O.value=!1,e==="SUCCESS"?h.push(`/AdditionalServices?ServiceID=${l.sectionID}`):e==="BASKET"&&h.push("/Basket")}):l.sectionID==="52000"?a.DNSmanagerOrder(t).then(({result:e,info:n,error:i})=>{O.value=!1,e==="SUCCESS"?h.push(`/AdditionalServices?ServiceID=${l.sectionID}`):e==="BASKET"&&h.push("/Basket")}):a.ServiceOrder(t).then(({result:e,info:n,error:i})=>{var v;e==="SUCCESS"?a.ServiceOrderPay((v=l.sectionData)==null?void 0:v.Code,{AmountPay:"1",ServiceOrderID:n==null?void 0:n.ServiceOrderID,IsChange:!0}).then(g=>{let{result:y,error:_}=g;y==="SUCCESS"?h.push(`/AdditionalServices?ServiceID=${l.sectionID}`):y==="BASKET"&&h.push("/Basket"),O.value=!1}):O.value=!1})}function ae(){var o;let t={};(o=Object.keys(s.value))==null||o.forEach(e=>{var n,i;t[e]=(n=s.value[e])!=null&&n.value?(i=s.value[e])==null?void 0:i.value:s.value[e]}),t.ServiceID=l.sectionID,t.Price=C(),f("update:modelValue",t)}function X(){var t,o;if(l.modelValue){const e=(t=Object.keys(l.modelValue))==null?void 0:t.find(n=>n.includes("SchemeID"));e&&((o=s.value[e])!=null&&o.ID||(s.value[e]={}),s.value[e].ID=l.modelValue[e])}}return T(B,()=>{var t,o,e;X(),l.updateWithPageTransition&&((t=j.value)==null||t.forEach(n=>{var i;s.value[`ID${n==null?void 0:n.ID}`]&&(s.value[`ID${n==null?void 0:n.ID}`]=(i=N(n))==null?void 0:i.find(v=>v.value===(n==null?void 0:n.Default)))}),((o=l.sectionData)==null?void 0:o.Code)!=="Default"&&a.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code))}),T(s.value,()=>{ae()}),T(l,()=>{X()}),$(async()=>{var t,o,e;(t=j.value)==null||t.forEach(n=>{var i;s.value[`ID${n==null?void 0:n.ID}`]=(i=N(n))==null?void 0:i.find(v=>v.value===(n==null?void 0:n.Default))}),((o=l.sectionData)==null?void 0:o.Code)!=="Default"&&await a.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code),await R.fetchDomains(),X(),ae()}),{contractSelect:w,contractsStore:r,getSelectFields:j,getInputFields:P,selectServerModel:E,isLoading:O,getButtonDisableCondition:W,getAdditionalServicesSchemes:q,getSelectFieldOptions:N,getDependOrders:U,DependOrderID:I,operationSystem:m,formData:s,finalPrice:C,payForOrder:L,filteredDependOrders:Z,serviceIP:x,isDepend:Q,reloadNow:d}}},ka=oe(ua,[["render",ca],["__scopeId","data-v-f53933d6"]]);export{ka as S};
