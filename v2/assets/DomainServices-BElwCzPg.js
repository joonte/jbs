import{_ as H}from"./EmptyStateBlock-Dks67PsT.js";import{_ as q}from"./BlockAdditionalServices-BLZFm89Z.js";import{_ as G}from"./ButtonDefault-tVMF5ozh.js";import{_ as K}from"./StatusBadge-DroW9lKR.js";import{_ as X}from"./ClausesKeeper-DtaNhp0a.js";import{_ as z}from"./BlockBalanceAgreement-ckI0MbGb.js";import{c as d,b as u,a as t,i as y,t as m,w as L,G as J,F as R,j as B,D as x,O as Q,u as W,r as A,f as g,g as Y,h as Z,x as $,d as ee,o as c,e as V}from"./index-DxPA2ffO.js";import{u as re}from"./services-DjjrPMAb.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-9iQSFcL_.js";import"./ServiceListOrderSelection-DjdcJR5t.js";import"./BasicInput-DI25CRuk.js";import"./component-BeTqOa0q.js";import"./BlockSelectContract-Cef_Umis.js";import"./contracts-DD2O0C6m.js";import"./multiselect-DxJoM0Ze.js";import"./IconClose-Br7S99e8.js";const oe={async setup(){const w=Y(),o=ee(),D=Q(),e=re(),f=W(),v=$("emitter"),i=A([]),p=A(!0),I=A(!1),_=g(()=>D?.domainsList?Object.keys(D.domainsList).map(r=>D.domainsList[r]).find(r=>r&&String(r.OrderID)===String(w.params.id)):null),O=g(()=>_.value?{ServiceID:_.value.ServiceID}:null),S=g(()=>e?.ServicesList||{}),b=g(()=>{if(!_.value?.OrderID||!f?.userOrders)return[];const r=_.value.OrderID;return Object.keys(f.userOrders).map(l=>f.userOrders[l]).filter(l=>String(l?.DependOrderID)===String(r)&&l?.ServiceID&&S.value[l.ServiceID]).sort((l,k)=>Number(l?.ID)-Number(k?.ID))}),s=g(()=>{if(!i.value||!Array.isArray(i.value))return 0;let r=0;return i.value.forEach(n=>{n&&typeof n.Price=="number"&&(r+=n.Price)}),N(r)});function C(r){i.value=r||[]}function N(r){return r==null?"0.00":Number(r).toFixed(2)||"0.00"}async function T(){if(!(!i.value||!Array.isArray(i.value)||i.value.length===0))for(const r of i.value){if(!r)continue;let n="SUCCESS",a=S.value[r.ServiceID]?.Code;const h={Code:a,DependOrderID:_.value?.OrderID,...r,ContractID:_.value?.ContractID};try{const{result:l,info:k,error:Ae}=await e.ServiceOrder(h);if(l==="SUCCESS"){let E={};a==="Default"?E.ServiceOrderID=k?.ServiceOrderID:E[`${a}OrderID`]=k?.ServiceOrderID;const j=await e.ServiceOrderPay(a,E,{XMLHttpRequest:"yes"});let{result:P,error:we}=j;P==="SUCCESS"?(v.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),i.value=[],o.push("/AdditionalServices")):P==="BASKET"&&o.push("/Basket")}else n="ERROR",v.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(l){console.error("Ошибка при заказе услуги:",l),n="ERROR",v.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(n==="ERROR")break}}async function U(){I.value=!0;try{await T()}catch(r){console.error("Ошибка при заказе услуг:",r),v.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{I.value=!1}}function F(r){const n=Object.values(S.value).find(h=>h.ID===r);if(!n){o.push(`/AdditionalServices/${r}`);return}const a=n.Code;a==="Default"||a==="DNSmanager"||a==="ISPsw"||a==="ExtraIP"?o.push(`/AdditionalServices/${r}`):o.push(`/${a}Orders/${r}`)}function M(r,n){let a="Orders";n==="50000"?a="ExtraIPOrders":n==="51000"?a="ISPswOrders":n==="52000"&&(a="DNSmanagerOrders"),v.emit("open-modal",{component:"StatusHistory",data:{modeID:a,rowID:r}})}return Z(async()=>{try{await D.fetchDomains(),await e.fetchServices(),await f.fetchUserOrders()}catch(r){console.error("Ошибка загрузки данных:",r)}finally{p.value=!1}}),{getDomainData:_,serviceSearchParams:O,selectedServices:i,getServices:S,orderedServices:b,ADDITIONAL_SERVICES_PRICE:s,handleServicesUpdate:C,setToFixedService:N,orderServices:U,isLoading:p,isOrderLoading:I,navigateToService:F,openHistoryStatuses:M}}},se={class:"container"},ae={class:"section-header"},ne={key:0,class:"section-label"},ie={class:"section-nav"},ce={key:0,class:"section-body"},le={class:"ordered-services-list"},de={class:"ordered-service-header"},_e={class:"ordered-service-name"},me={class:"ordered-service-status"},ue={class:"ordered-service-details"},ve={class:"ordered-service-info"},Se={key:0},De={class:"ordered-service-actions"},fe={class:"section-body"},pe={key:2,class:"loading"},Ie={key:0},ge={class:"container"},Oe={class:"total-block"},he={class:"total-block__row"},ke={class:"total-block__col"},ye={class:"total-block__col"},be={class:"total-block__col"},Ce={class:"total-block__row total-block__row--big"},Ee={class:"total-block__col"};function Re(w,o,D,e,f,v){const i=z,p=J("router-link"),I=X,_=K,O=G,S=q,b=H;return c(),d(R,null,[u(i),t("section",null,[t("div",se,[t("div",ae,[o[4]||(o[4]=t("h1",{class:"section-title"},"Дополнительные услуги",-1)),e.getDomainData?(c(),d("div",ne,"Домен # "+m(e.getDomainData?.OrderID),1)):y("",!0),t("div",ie,[u(p,{class:"section-nav__item",to:`/DomainOrders/${e.getDomainData?.OrderID}`},{default:L(()=>o[2]||(o[2]=[V(" Домен ",-1)])),_:1,__:[2]},8,["to"]),u(p,{class:"section-nav__item active",to:`/DomainServices/${e.getDomainData?.OrderID}`},{default:L(()=>o[3]||(o[3]=[V(" Услуги ",-1)])),_:1,__:[3]},8,["to"])])]),u(I),e.orderedServices&&e.orderedServices.length>0?(c(),d("div",ce,[o[5]||(o[5]=t("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),t("div",le,[(c(!0),d(R,null,B(e.orderedServices,s=>(c(),d("div",{class:"ordered-service-item",key:s.ID},[t("div",de,[t("div",_e,m(e.getServices[s?.ServiceID]?.Name||s?.ServiceName||`Услуга #${s?.ServiceID}`),1),t("div",me,[u(_,{status:s?.StatusID,"status-table":"Orders",onClick:C=>e.openHistoryStatuses(s?.ID,s?.ServiceID)},null,8,["status","onClick"])])]),t("div",ue,[t("div",ve,[t("span",null,"Заказ # "+m(s?.ID),1),s?.DaysRemainded?(c(),d("span",Se,"| Осталось дней: "+m(s?.DaysRemainded),1)):y("",!0)])]),t("div",De,[u(O,{class:"btn--sm",label:"Перейти к заказу",onClick:C=>e.navigateToService(s?.ID)},null,8,["onClick"])])]))),128))])])):y("",!0),t("div",fe,[e.getDomainData&&e.serviceSearchParams?(c(),x(S,{key:0,modelValue:e.selectedServices,"onUpdate:modelValue":[o[0]||(o[0]=s=>e.selectedServices=s),e.handleServicesUpdate],"service-search-params":e.serviceSearchParams},null,8,["modelValue","service-search-params","onUpdate:modelValue"])):e.isLoading?(c(),d("div",pe,"Загрузка...")):(c(),x(b,{key:1,label:"Заказ не найден"}))])])]),e.selectedServices&&e.selectedServices.length>0?(c(),d("section",Ie,[t("div",ge,[t("div",Oe,[t("div",he,[o[6]||(o[6]=t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),t("div",ke,m(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(c(!0),d(R,null,B(e.selectedServices,s=>(c(),d("div",{class:"total-block__row no-divider",key:s.ServiceID},[t("div",ye,m(e.getServices[s?.ServiceID]?.Name),1),t("div",be,m(e.setToFixedService(s?.Price))+" ₽",1)]))),128)),t("div",Ce,[o[7]||(o[7]=t("div",{class:"total-block__col"},"Итого к оплате",-1)),t("div",Ee,m(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)])]),u(O,{class:"btn--wide",disabled:!e.selectedServices||e.selectedServices.length===0||e.isOrderLoading,"is-loading":e.isOrderLoading,label:"Заказать дополнительные услуги",onClick:o[1]||(o[1]=s=>e.orderServices())},null,8,["disabled","is-loading"])])])):y("",!0)],64)}const Je=te(oe,[["render",Re],["__scopeId","data-v-3173c263"]]);export{Je as default};
