import{_ as I}from"./EmptyStateBlock-BaR9js3E.js";import{L as j,a as M}from"./bootstrap-vue-next-DwS3lKQb.js";import{_ as z}from"./ButtonDefault-BIBStZbJ.js";import{al as H,r as l,am as S,an as L,c as C,o as v,a,b as g,I as Z,S as G,d as q,H as O,C as w,F as V,h as F,w as _,t as b,E as J,f as P,s as Q,v as k,g as W,D as h,n as N}from"./index-CmCGXBst.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as $}from"./multiselect-DhoC9bwZ.js";import{f as E,s as U}from"./time-DenPiOX5.js";import{_ as X}from"./ClausesKeeper-CTja-fCz.js";import{_ as Y}from"./BlockBalanceAgreement-qtspRQ_B.js";import{u as ee}from"./promoStore-BJ3MBkUt.js";import"./IconClose-B_k4TzXM.js";import"./contracts-P7YPBhEI.js";const x=H("bonuses",()=>{const u=l(null),o=l(null);async function i(n){await S.post(L.bonuses,n).then(s=>{s?.data&&(u.value=s.data)})}async function e(n){await S.post(L.promoCodes,n).then(s=>{s?.data&&(o.value=s.data)})}async function p(n){let s="ERROR",m=null;return await S.post(L.PromoCodesActivate,n).then(d=>{d?.data?.Status==="Ok"&&(s="SUCCESS")}),{result:s,error:m}}return{bonusesList:u,promosList:o,fetchBonuses:i,fetchPromos:e,PromoCodesActivate:p}}),te={props:{promoCode:{type:String,default:""}},emits:["update"],setup(u,{emit:o}){const i=x(),e=q(),p=l(!1),n=l("");function s(){n.value.length>0&&(p.value=!0,i.PromoCodesActivate({Code:n.value}).then(m=>{const{result:d}=m;d==="SUCCESS"&&o("update"),p.value=!1}))}return O(()=>{e.currentRoute.value.query.PromoCode?(n.value=e.currentRoute.value.query.PromoCode,s()):u.promoCode&&(n.value=u.promoCode)}),{isLoading:p,promoInput:n,activatePromo:s,router:e}}},oe={class:"promo-field"},se={class:"promo-field-input form-field"};function ne(u,o,i,e,p,n){const s=z;return v(),C("div",oe,[o[1]||(o[1]=a("div",{class:"promo-field-text"},"Промокод",-1)),a("div",se,[Z(a("input",{type:"text",name:"promo-code","onUpdate:modelValue":o[0]||(o[0]=m=>e.promoInput=m)},null,512),[[G,e.promoInput]])]),g(s,{"is-loading":e.isLoading,label:"Применить",onClick:e.activatePromo},null,8,["is-loading","onClick"])])}const ae=T(te,[["render",ne],["__scopeId","data-v-738bd0db"]]),re=[{key:"CreateDate",label:"Дата активации",variant:"td-gray",sortable:!0},{key:"ApplyTo",label:"Тариф/Группа",variant:"td-blue"},{key:"PromoCode",label:"Промокод"}],le={components:{Multiselect:$},props:{promoCode:{type:String,default:""}},setup(){const u=x(),o=l("CreateDate"),i=l(!0),e=l("desc"),p=l(1),n=l(10),s=l([10,25,50,100]),m=P(()=>Object.keys(u?.promosList)?.map(c=>u?.promosList[c])),d=P(()=>Object.keys(u?.promosList)?.length);function y(){p.value=1}function f(){u.fetchBonuses(),u.fetchPromos()}const t=c=>{c.key==="Enter"&&c.ctrlKey&&f()};return O(()=>{document.addEventListener("keyup",t)}),Q(()=>{document.removeEventListener("keyup",t)}),{promosTable:re,sortBy:o,sortDesc:i,sortDirection:e,currentPage:p,perPage:n,pageOptions:s,setPageToZero:y,getPromos:m,getPromosLength:d,secondToDate:U,formNormalDate:E,updatePromos:f}}},ie={class:"promo-block block--wrapper"},ce={key:0,class:"table-controls"},ue={class:"multiselect-multiple-label"},pe={class:"multiselect-option"};function me(u,o,i,e,p,n){const s=ae,m=j,d=M,y=J("Multiselect"),f=I;return v(),C(V,null,[a("div",ie,[o[6]||(o[6]=a("div",{class:"promo-text"},"Активировать промокод",-1)),g(s,{onUpdate:o[0]||(o[0]=t=>e.updatePromos()),promoCode:i.promoCode},null,8,["promoCode"])]),e.getPromos?(v(),C(V,{key:0},[g(m,{class:"basic-table",items:e.getPromos,fields:e.promosTable,"show-empty":!0,"per-page":e.perPage,"current-page":e.currentPage,"empty-text":"Промокодов пока нет.","empty-filtered-text":"Промокоды не найдены.","sort-desc":e.sortDesc,"onUpdate:sortDesc":o[1]||(o[1]=t=>e.sortDesc=t),"sort-by":e.sortBy,"onUpdate:sortBy":o[2]||(o[2]=t=>e.sortBy=t),"sort-direction":e.sortDirection},{"cell(CreateDate)":_(t=>[a("span",null,b(e.formNormalDate(e.secondToDate(t?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),e.getPromosLength>0?(v(),C("div",ce,[g(d,{modelValue:e.currentPage,"onUpdate:modelValue":o[3]||(o[3]=t=>e.currentPage=t),"total-rows":e.getPromosLength,"per-page":e.perPage,"first-number":"","last-number":""},{"first-text":_(()=>o[7]||(o[7]=[a("span",{class:"text-success"},"First",-1)])),"last-text":_(()=>o[8]||(o[8]=[a("span",{class:"text-info"},"Last",-1)])),page:_(({page:t,active:c})=>[a("span",null,b((t-1)*e.perPage+1)+"-"+b(t*e.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),g(y,{class:"multiselect--white",modelValue:e.perPage,"onUpdate:modelValue":o[4]||(o[4]=t=>e.perPage=t),options:e.pageOptions,label:"name",openDirection:"top",onInput:o[5]||(o[5]=t=>e.currentPage=1)},{singlelabel:_(({value:t})=>[a("div",ue,[a("span",null,"Отображать "+b(t.value)+" строк",1)])]),option:_(({option:t})=>[a("div",pe,"Отображать "+b(t.name)+" строк",1)]),_:1},8,["modelValue","options"])])):F("",!0)],64)):(v(),w(f,{key:1,label:"Промокоды не найдены"}))],64)}const de=T(le,[["render",me],["__scopeId","data-v-783817f8"]]),_e=[{key:"CreateDate",label:"Дата создания",variant:"td-gray",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray",sortable:!0},{key:"Display",label:"Тариф/Группа",variant:"td-blue"},{key:"DaysRemainded",label:"Дней осталось",sortable:!0},{key:"Discont",variant:"td-controls",label:"Скидка"},{key:"Comment",label:"Комментарий",variant:"td-gray"}],ve={key:0},be={key:0,class:"table-controls"},fe={class:"multiselect-multiple-label"},ge={class:"multiselect-option"},ye={__name:"BonusesBlock",setup(u){const o=x(),i=l("CreateDate"),e=l(!0),p=l("desc"),n=l(1),s=l(10),m=l([10,25,50,100]),d=P(()=>Object.keys(o?.bonusesList)?.map(f=>o?.bonusesList[f])),y=P(()=>Object.keys(o?.bonusesList)?.length);return(f,t)=>{const c=j,B=M,D=I;return d.value?(v(),C("div",ve,[g(c,{class:"basic-table",items:d.value,fields:k(_e),"show-empty":!0,"per-page":s.value,"current-page":n.value,"empty-text":"Бонусов пока нет.","empty-filtered-text":"Бонусов не найдены.","sort-desc":e.value,"onUpdate:sortDesc":t[0]||(t[0]=r=>e.value=r),"sort-by":i.value,"onUpdate:sortBy":t[1]||(t[1]=r=>i.value=r),"sort-direction":p.value},{"cell(CreateDate)":_(r=>[a("span",null,b(k(E)(k(U)(r?.value))),1)]),"cell(ExpirationDate)":_(r=>[a("span",null,b(k(E)(k(U)(r?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),y.value>0?(v(),C("div",be,[g(B,{modelValue:n.value,"onUpdate:modelValue":t[2]||(t[2]=r=>n.value=r),"total-rows":y.value,"per-page":s.value,"first-number":"","last-number":""},{"first-text":_(()=>t[5]||(t[5]=[a("span",{class:"text-success"},"First",-1)])),"last-text":_(()=>t[6]||(t[6]=[a("span",{class:"text-info"},"Last",-1)])),page:_(({page:r,active:A})=>[a("span",null,b((r-1)*s.value+1)+"-"+b(r*s.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),g(k($),{class:"multiselect--white",modelValue:s.value,"onUpdate:modelValue":t[3]||(t[3]=r=>s.value=r),options:m.value,label:"name",openDirection:"top",onInput:t[4]||(t[4]=r=>n.value=1)},{singlelabel:_(({value:r})=>[a("div",fe,[a("span",null,"Отображать "+b(r.value)+" строк",1)])]),option:_(({option:r})=>[a("div",ge,"Отображать "+b(r.name)+" строк",1)]),_:1},8,["modelValue","options"])])):F("",!0)])):(v(),w(D,{key:1,label:"Бонусов не найдено"}))}}},ke={class:"tw-px-4 md:tw-px-8"},Ce={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},we={class:"tw-mb-6"},Pe={class:"tw-flex tw-items-center tw-border-b tw-border-gray-200 tw-mt-4 tw-whitespace-nowrap"},xe={__name:"Bonuses",async setup(u){let o,i;const e=x(),p=ee(),n=l("bonuses"),s=q(),m=W(),d=p.promoCode;function y(){s.go(0)}function f(t){s.replace(`/Bonuses?section=${t}`),n.value=t}return O(()=>{d&&e.PromoCodesActivate({Code:d}).then(t=>{const{result:c}=t;c==="SUCCESS"&&emit("update"),s.replace("/Bonuses?section=promos"),n.value="promos"}),m?.query?.section?n.value=m?.query?.section:s.replace("/Bonuses?section=bonuses")}),[o,i]=h(()=>e.fetchBonuses()),await o,i(),[o,i]=h(()=>e.fetchPromos()),await o,i(),(t,c)=>{const B=Y,D=X,r=ye,A=de,K=I;return v(),C(V,null,[g(B),a("div",ke,[a("div",Ce,[a("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:c[0]||(c[0]=R=>y())},"Бонусы и промокоды")]),g(D),a("div",we,[a("div",Pe,[a("div",{class:N(["section-nav__item",{"section-link":!0,"section-link-active":n.value==="bonuses"}]),onClick:c[1]||(c[1]=R=>f("bonuses"))}," Бонусы ",2),a("div",{class:N(["section-nav__item",{"section-link":!0,"section-link-active":n.value==="promos"}]),onClick:c[2]||(c[2]=R=>f("promos"))}," Промокоды ",2)])]),n.value==="bonuses"?(v(),w(r,{key:0})):n.value==="promos"?(v(),w(A,{key:1,promoCode:k(d)},null,8,["promoCode"])):(v(),w(K,{key:2,label:"Секция не найдена"}))])],64)}}},he=T(xe,[["__scopeId","data-v-e27bb065"]]);export{he as default};
