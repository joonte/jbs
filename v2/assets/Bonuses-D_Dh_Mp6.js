import{_ as R}from"./EmptyStateBlock-DA3-0YDi.js";import{L as K,a as h}from"./bootstrap-vue-next-W16P-SAV.js";import{_ as G}from"./ButtonDefault-CMw2aBy6.js";import{al as H,r as u,am as V,an as E,d as M,I,o as f,c as B,a as t,K as J,Y as Q,b as C,f as D,s as W,F as U,w as v,t as g,v as k,h as z,C as S,E as q,n as F,i as X}from"./index-Codq73aV.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Y}from"./multiselect-DElL0Rlw.js";import{f as A,s as O}from"./time-DenPiOX5.js";import{_ as Z}from"./ClausesKeeper-iUM0yapS.js";import{_ as ee}from"./BlockBalanceAgreement-v_bWuiVT.js";import{u as te}from"./promoStore-C2KMFTOO.js";import"./IconClose-Dia1noy8.js";import"./index-BO2gwtUe.js";import"./common-DyknwSqv.js";const P=H("bonuses",()=>{const x=u(null),i=u(null);async function c(n){const e=await V.post(E.bonuses,n);e?.data&&(x.value=e.data)}async function m(n){const e=await V.post(E.promoCodes,n);e?.data&&(i.value=e.data)}async function w(n){let e="ERROR",l=null;return(await V.post(E.PromoCodesActivate,n))?.data?.Status==="Ok"&&(e="SUCCESS"),{result:e,error:l}}return{bonusesList:x,promosList:i,fetchBonuses:c,fetchPromos:m,PromoCodesActivate:w}}),oe={class:"promo-field"},se={class:"promo-field-input form-field"},ne={__name:"ActivatePromo",props:{promoCode:{type:String,default:""}},emits:["update"],setup(x,{emit:i}){const c=x,m=i,w=P(),n=M(),e=u(!1),l=u("");function d(){l.value.length>0&&(e.value=!0,w.PromoCodesActivate({Code:l.value}).then(y=>{const{result:p}=y;p==="SUCCESS"&&m("update"),e.value=!1}))}return I(()=>{n.currentRoute.value.query.PromoCode?(l.value=n.currentRoute.value.query.PromoCode,d()):c.promoCode&&(l.value=c.promoCode)}),(y,p)=>{const a=G;return f(),B("div",oe,[p[1]||(p[1]=t("div",{class:"promo-field-text"},"Промокод",-1)),t("div",se,[J(t("input",{type:"text",name:"promo-code","onUpdate:modelValue":p[0]||(p[0]=_=>l.value=_)},null,512),[[Q,l.value]])]),C(a,{"is-loading":e.value,label:"Применить",onClick:d},null,8,["is-loading"])])}}},ae=T(ne,[["__scopeId","data-v-831ae56e"]]),le=[{key:"CreateDate",label:"Дата активации",variant:"td-gray",sortable:!0},{key:"ApplyTo",label:"Тариф/Группа",variant:"td-blue"},{key:"PromoCode",label:"Промокод"}],re={class:"promo-block block--wrapper"},ue={key:0,class:"table-controls"},ie={class:"multiselect-multiple-label"},pe={class:"multiselect-option"},ce={__name:"PromosBlock",props:{promoCode:{type:String,default:""}},setup(x){const i=P(),c=u("CreateDate"),m=u(!0),w=u("desc"),n=u(1),e=u(10),l=u([10,25,50,100]),d=D(()=>Object.keys(i?.promosList)?.map(_=>i?.promosList[_])),y=D(()=>Object.keys(i?.promosList)?.length);function p(){i.fetchBonuses(),i.fetchPromos()}const a=_=>{_.key==="Enter"&&_.ctrlKey&&p()};return I(()=>{document.addEventListener("keyup",a)}),W(()=>{document.removeEventListener("keyup",a)}),(_,o)=>{const b=ae,s=K,$=h,L=R;return f(),B(U,null,[t("div",re,[o[6]||(o[6]=t("div",{class:"promo-text"},"Активировать промокод",-1)),C(b,{onUpdate:o[0]||(o[0]=r=>p()),promoCode:x.promoCode},null,8,["promoCode"])]),d.value?(f(),B(U,{key:0},[C(s,{class:"basic-table",items:d.value,fields:k(le),"show-empty":!0,"per-page":e.value,"current-page":n.value,"empty-text":"Промокодов пока нет.","empty-filtered-text":"Промокоды не найдены.","sort-desc":m.value,"onUpdate:sortDesc":o[1]||(o[1]=r=>m.value=r),"sort-by":c.value,"onUpdate:sortBy":o[2]||(o[2]=r=>c.value=r),"sort-direction":w.value},{"cell(CreateDate)":v(r=>[t("span",null,g(k(A)(k(O)(r?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),y.value>0?(f(),B("div",ue,[C($,{modelValue:n.value,"onUpdate:modelValue":o[3]||(o[3]=r=>n.value=r),"total-rows":y.value,"per-page":e.value,"first-number":"","last-number":""},{"first-text":v(()=>o[7]||(o[7]=[t("span",{class:"text-success"},"First",-1)])),"last-text":v(()=>o[8]||(o[8]=[t("span",{class:"text-info"},"Last",-1)])),page:v(({page:r,active:j})=>[t("span",null,g((r-1)*e.value+1)+"-"+g(r*e.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),C(k(Y),{class:"multiselect--white",modelValue:e.value,"onUpdate:modelValue":o[4]||(o[4]=r=>e.value=r),options:l.value,label:"name",openDirection:"top",onInput:o[5]||(o[5]=r=>n.value=1)},{singlelabel:v(({value:r})=>[t("div",ie,[t("span",null,"Отображать "+g(r.value)+" строк",1)])]),option:v(({option:r})=>[t("div",pe,"Отображать "+g(r.name)+" строк",1)]),_:1},8,["modelValue","options"])])):z("",!0)],64)):(f(),S(L,{key:1,label:"Промокоды не найдены"}))],64)}}},me=T(ce,[["__scopeId","data-v-f67bee06"]]),de=[{key:"CreateDate",label:"Дата создания",variant:"td-gray",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray",sortable:!0},{key:"Display",label:"Тариф/Группа",variant:"td-blue"},{key:"DaysRemainded",label:"Дней осталось",sortable:!0},{key:"Discont",variant:"td-controls",label:"Скидка"},{key:"Comment",label:"Комментарий",variant:"td-gray"}],ve={key:0},_e={key:0,class:"table-controls"},be={class:"multiselect-multiple-label"},fe={class:"multiselect-option"},ye={__name:"BonusesBlock",setup(x){const i=P(),c=u("CreateDate"),m=u(!0),w=u("desc"),n=u(1),e=u(10),l=u([10,25,50,100]),d=D(()=>Object.keys(i?.bonusesList)?.map(p=>i?.bonusesList[p])),y=D(()=>Object.keys(i?.bonusesList)?.length);return(p,a)=>{const _=K,o=h,b=R;return d.value?(f(),B("div",ve,[C(_,{class:"basic-table",items:d.value,fields:k(de),"show-empty":!0,"per-page":e.value,"current-page":n.value,"empty-text":"Бонусов пока нет.","empty-filtered-text":"Бонусов не найдены.","sort-desc":m.value,"onUpdate:sortDesc":a[0]||(a[0]=s=>m.value=s),"sort-by":c.value,"onUpdate:sortBy":a[1]||(a[1]=s=>c.value=s),"sort-direction":w.value},{"cell(CreateDate)":v(s=>[t("span",null,g(k(A)(k(O)(s?.value))),1)]),"cell(ExpirationDate)":v(s=>[t("span",null,g(k(A)(k(O)(s?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),y.value>0?(f(),B("div",_e,[C(o,{modelValue:n.value,"onUpdate:modelValue":a[2]||(a[2]=s=>n.value=s),"total-rows":y.value,"per-page":e.value,"first-number":"","last-number":""},{"first-text":v(()=>a[5]||(a[5]=[t("span",{class:"text-success"},"First",-1)])),"last-text":v(()=>a[6]||(a[6]=[t("span",{class:"text-info"},"Last",-1)])),page:v(({page:s,active:$})=>[t("span",null,g((s-1)*e.value+1)+"-"+g(s*e.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),C(k(Y),{class:"multiselect--white",modelValue:e.value,"onUpdate:modelValue":a[3]||(a[3]=s=>e.value=s),options:l.value,label:"name",openDirection:"top",onInput:a[4]||(a[4]=s=>n.value=1)},{singlelabel:v(({value:s})=>[t("div",be,[t("span",null,"Отображать "+g(s.value)+" строк",1)])]),option:v(({option:s})=>[t("div",fe,"Отображать "+g(s.name)+" строк",1)]),_:1},8,["modelValue","options"])])):z("",!0)])):(f(),S(b,{key:1,label:"Бонусов не найдено"}))}}},ge={class:"tw-px-4 md:tw-px-8"},ke={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},Ce={class:"tw-mb-6"},we={class:"tw-flex tw-items-center tw-border-b tw-border-gray-200 tw-mt-4 tw-whitespace-nowrap"},xe={__name:"Bonuses",emits:["update"],async setup(x,{emit:i}){let c,m;const w=i,n=P(),e=te(),l=u("bonuses"),d=M(),y=X(),p=e.promoCode;function a(){d.go(0)}function _(o){d.replace(`/Bonuses?section=${o}`),l.value=o}return I(()=>{p&&n.PromoCodesActivate({Code:p}).then(o=>{const{result:b}=o;b==="SUCCESS"&&w("update"),d.replace("/Bonuses?section=promos"),l.value="promos"}),y?.query?.section?l.value=y?.query?.section:d.replace("/Bonuses?section=bonuses")}),[c,m]=q(()=>n.fetchBonuses()),await c,m(),[c,m]=q(()=>n.fetchPromos()),await c,m(),(o,b)=>{const s=ee,$=Z,L=ye,r=me,j=R;return f(),B(U,null,[C(s),t("div",ge,[t("div",ke,[t("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:b[0]||(b[0]=N=>a())}," Бонусы и промокоды ")]),C($),t("div",Ce,[t("div",we,[t("div",{class:F(["section-nav__item",{"section-link":!0,"section-link-active":l.value==="bonuses"}]),onClick:b[1]||(b[1]=N=>_("bonuses"))}," Бонусы ",2),t("div",{class:F(["section-nav__item",{"section-link":!0,"section-link-active":l.value==="promos"}]),onClick:b[2]||(b[2]=N=>_("promos"))}," Промокоды ",2)])]),l.value==="bonuses"?(f(),S(L,{key:0})):l.value==="promos"?(f(),S(r,{key:1,promoCode:k(p)},null,8,["promoCode"])):(f(),S(j,{key:2,label:"Секция не найдена"}))])],64)}}},Te=T(xe,[["__scopeId","data-v-db2e95bb"]]);export{Te as default};
