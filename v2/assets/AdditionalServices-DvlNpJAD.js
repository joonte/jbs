import{_ as J}from"./EmptyStateBlock-DA3-0YDi.js";import{m as je,v as Ee,r as Ue,Y as Ve,L as Ae}from"./bootstrap-vue-next-W16P-SAV.js";import{_ as Te}from"./IconDots-BIoh_VC5.js";import{_ as He}from"./IconCard-C_8uFbeS.js";import{_ as Me}from"./UserNote-9g0f9gxP.js";import{_ as We}from"./StatusBadge-BmqDrHzy.js";import{_ as Re}from"./ClausesKeeper-iUM0yapS.js";import{_ as Ge}from"./WhiteButton.vue_vue_type_script_setup_true_lang-CdZRVTJ5.js";import{_ as Ke}from"./BlueButton.vue_vue_type_script_setup_true_lang-BKdLNEec.js";import{a as ze,_ as Fe}from"./IconButtonBack-CTMQ7Okc.js";import{r as g,d as ee,i as te,u as se,x as ne,f as R,I as oe,G as qe,o as v,c as x,a as i,n as F,t as S,C,h as $,b as m,w as l,e as D,j as Xe,F as G,K as Ye,Q as Qe,E as j,Z as Ze,g as Je,v as Q}from"./index-Codq73aV.js";import{u as re,_ as et}from"./index-BO2gwtUe.js";import{u as ae}from"./services-DyPBvbVy.js";import{f as Z}from"./time-DenPiOX5.js";import{i as tt}from"./common-DyknwSqv.js";import{u as st}from"./global-CdY51QQZ.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as nt}from"./BlockBalanceAgreement-v_bWuiVT.js";import{u as ot}from"./server-DnY_Nzbw.js";import{s as rt}from"./multiselect-DElL0Rlw.js";import"./IconClose-Dia1noy8.js";import"./ButtonDefault-CMw2aBy6.js";const at={class:"title__icon"},it={key:0,class:"tw-flex tw-items-center tw-gap-4 tw-mt-4"},lt={key:1,class:"tw-flex tw-gap-2"},dt={class:"tw-text-sky-400"},ct={class:"key-field"},ut={class:"key-field"},mt={class:"key-field"},vt={class:"hosting-status__date"},ft={class:"service__controls-wrapper"},pt=["onClick"],It={class:"btn btn--dots"},_t={__name:"ServiceListSection",props:{sectionId:{type:Number,default:null},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],setup(_,{emit:p}){const d=_,E=p,I={key:"Several",label:"",variant:"",sortable:!1},f=g([{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"Scheme",label:"Тариф",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}]),O=ee(),U=te(),P=se(),k=ne("emitter"),V=g(!1),h=g("ID"),K=g(!0),y=g("desc"),b=g(!1),N=g([]),A=g(null),T=re(),a=ae(),w=st(),H=R(()=>a?.ISPswOrdersList),z=R(()=>a?.ExtraIPOrdersList);function q(){O.go(0)}async function X(){let n="";d.sectionId===5e4?n="IP адресов":d.sectionId===51e3?n="лицензии ISPsystem":d.sectionId===52e3&&(n="вторичного DNS");const s=B.value.filter((r,u)=>N.value[u]).map(r=>r.ID),o={ServiceID:d.sectionId,ItemsPay:A.value,OrdersIDs:s,...V.value&&{UseBalance:"yes"}};await w.OrdersPay(o).then(r=>{r==="Basket"?O.push("/Basket"):r?.Status==="Ok"&&(b.value=!1,k.emit("open-modal",{component:"BalanceProlong",data:{Service:n,Message:r?.Message,Count:r?.Count}}))})}function c(n){const e=a.DNSmanagerOrdersList;return Object.values(e).find(o=>o.OrderID==n)}const Y=R(()=>T?.contractsList);function le(n,e,s){e==5e4||e==51e3||e==52e3?_e(n,e):O.push(`/ServiceOrderPay/${n}`)}function de(n,e){const s=c(n);k.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:s.ID,ServiceID:e,emitEvent:"updateServicesList",Login:s.Login}})}function ce(n,e){let s=null,o="";switch(Number(e)){case 5e4:s=Object.entries(z.value).find(([r,u])=>u),o="ExtraIPOrders";break;case 51e3:s=Object.entries(H.value).find(([r,u])=>u),o="ISPswOrders";break;case 52e3:s=Object.entries(a.DNSmanagerOrdersList).find(([r,u])=>u),o="DNSmanagerOrders";break;default:s=Object.entries(B.value).find(([r,u])=>u),o="Orders"}s&&k.emit("open-modal",{component:"StatusHistory",data:{modeID:o,rowID:s[1].ID}})}const ue=n=>{const e=me(n);if(e){const s=e.split(","),o=s.length,r=s.join(`
`);return`Всего: ${o}
${r}`}return"Нет данных"},me=n=>{const e=Object.entries(a.DNSmanagerOrdersList).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID==n)return o.Parked}return null},ve=n=>{const e=Object.entries(H.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID===n)return o.IP}},fe=n=>{const e=Object.entries(z.value).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID==n)return o.Login}};function pe(){f.value.unshift(I),b.value=!0}function Ie(){f.value.shift(),b.value=!1}function _e(n,e){e==51e3?O.push(`/ISPswOrderPay/${n}`):e==52e3?O.push(`/DNSmanagerOrderPay/${n}`):e==5e4&&O.push(`/ExtraIPOrderPay/${n}`)}function De(n){tt()||(U.meta?.ServiceID==51e3?O.push(`/ISPswOrders/${n.ID}`):O.push(`/AdditionalServices/${n.ID}`))}function Se(n,e){k.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:n,ServiceID:e}})}function Oe(n,e){let s;e==51e3?s=Object.entries(H.value).reduce((r,[u,M])=>(r[u]=M,r),{}):e==52e3&&(s=Object.entries(a.DNSmanagerOrdersList).reduce((r,[u,M])=>(r[u]=M,r),{}));let o;for(const r in s)if(Object.hasOwnProperty.call(s,r)){const u=s[r];if(u.OrderID==n){o=u;break}}o&&w.OrderManageHosting({ServiceOrderID:o.ID,OrderID:n,ServiceID:e,XMLHttpRequest:"yes"})}const be=n=>{const e=Object.entries(a.DNSmanagerOrdersList).reduce((s,[o,r])=>(s[o]=r,s),{});for(const s in e)if(Object.hasOwnProperty.call(e,s)){const o=e[s];if(o.OrderID==n)return o.Domain}return null},B=R(()=>Object.keys(P.userOrders).map(n=>({...P?.userOrders[n],ID:Number(P?.userOrders[n]?.ID)}))?.reverse()?.filter(n=>n.ServiceID==d?.sectionId));function ke(){O.push(`/AdditionalServicesOrder?ServiceID=${d?.sectionId}`)}function ye(n){if(!n)return Z(new Date);const e=new Date,s=new Date(e.getTime()+n*24*60*60*1e3);return Z(s)}return oe(()=>{N.value=B.value.map(()=>!1)}),(n,e)=>{const s=Fe,o=ze,r=je,u=Ke,M=Ge,ge=Re,we=We,Ce=Me,xe=He,Pe=Te,$e=qe("router-link"),W=Ue,Ne=Ve,Le=Ee,he=Ae,Be=J;return v(),x(G,null,[i("div",null,[i("div",{class:F(["tw-flex tw-justify-between tw-gap-4",{column:b.value}])},[i("div",at,[i("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:e[0]||(e[0]=t=>q())},S(b.value?"Продление услуг "+_.sectionData?.Item:_.sectionData?.Item),1),b.value?(v(),C(s,{key:0,onClick:e[1]||(e[1]=t=>Ie())})):$("",!0)]),b.value?(v(),x("div",it,[m(o,{modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=t=>A.value=t),class:"contr period"},null,8,["modelValue"]),m(r,{id:"checkbox-balance",modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=t=>V.value=t),name:"checkbox-balance"},{default:l(()=>e[9]||(e[9]=[D(" Использовать средства с баланса ",-1)])),_:1,__:[9]},8,["modelValue"]),m(u,{onClick:e[4]||(e[4]=t=>X())},{default:l(()=>e[10]||(e[10]=[D("Продлить",-1)])),_:1,__:[10]})])):(v(),x("div",lt,[(_.sectionId==5e4||_.sectionId==51e3||_.sectionId==52e3)&&B.value.length>1?(v(),C(M,{key:0,onClick:e[5]||(e[5]=t=>pe())},{default:l(()=>e[11]||(e[11]=[D(" Продлить несколько заказов ",-1)])),_:1,__:[11]})):$("",!0),m(u,{onClick:e[6]||(e[6]=t=>ke())},{default:l(()=>e[12]||(e[12]=[D(" Заказать ",-1)])),_:1,__:[12]})]))],2),m(ge,{class:"additional-clauses",partition:`Header:${_.sectionData?.Code==="Default"?_.sectionId:`/${_.sectionData?.Code}Orders`}`},null,8,["partition"])]),B.value.length?(v(),C(he,{key:0,"sort-by":h.value,"onUpdate:sortBy":e[7]||(e[7]=t=>h.value=t),"sort-desc":K.value,"onUpdate:sortDesc":e[8]||(e[8]=t=>K.value=t),class:"basic-table tw-mt-4",items:B.value,fields:f.value,"sort-direction":y.value,onRowClicked:De},{"cell(Several)":l(t=>[Ye(m(r,{id:"checkbox-"+t.index,modelValue:N.value[t.index],"onUpdate:modelValue":L=>N.value[t.index]=L,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[Qe,b.value]])]),"cell(ID)":l(t=>[e[13]||(e[13]=i("span",{class:"td-mobile"},"Заказ",-1)),i("span",dt,S(t.value),1)]),"cell(ContractID)":l(t=>[e[14]||(e[14]=i("span",{class:"td-mobile"},"Договор",-1)),i("span",null,"#"+S(Y.value[t.value]?.ID)+" / "+S(Y.value[t.value]?.Customer),1)]),"cell(Scheme)":l(t=>[e[15]||(e[15]=i("span",{class:"td-mobile"},"Тариф",-1)),i("span",null,S(t.item?.SchemeName),1)]),"cell(Keys)":l(t=>[e[16]||(e[16]=i("span",{class:"td-mobile"},"Ключевые поля",-1)),i("span",ct,[t.item?.Code==="ISPsw"?(v(),x(G,{key:0},[D(S(ve(t.item?.ID)),1)],64)):$("",!0)]),i("span",ut,[t.item?.Code==="ExtraIP"?(v(),x(G,{key:0},[D(S(fe(t.item?.ID)),1)],64)):$("",!0)]),i("span",mt,[D(S(be(t.item?.ID))+" ",1),i("pre",vt,S(ue(t.item?.ID)),1)])]),"cell(StatusID)":l(t=>[m(we,{class:"tw-cursor-pointer",status:t.value,"status-table":"Orders",onClick:Xe(L=>ce(t.item?.ID,t.item?.ServiceID),["stop"])},null,8,["status","onClick"])]),"cell(ExpirationDate)":l(t=>[e[17]||(e[17]=i("span",{class:"td-mobile"},"Дата окончания",-1)),i("span",{class:F({danger:Number(t.item?.DaysRemainded)<14})},S(ye(t.item?.DaysRemainded))+" | "+S(t.item?.DaysRemainded||0)+" дн. ",3)]),"cell(UserNotice)":l(t=>[e[18]||(e[18]=i("span",{class:"td-mobile"},"Комментарий",-1)),m(Ce,{text:t.value,"order-id":t.item?.ID,emit:"updateServicesList"},null,8,["text","order-id"])]),"cell(controls)":l(t=>[i("div",ft,[i("div",{class:"btn btn--md btn--bold",onClick:L=>le(t.item.ID,t.item.ServiceID,t.item.ContractID)},[m(xe),e[19]||(e[19]=D(" Оплатить ",-1))],8,pt),m(Le,{class:"dropdown-dots",right:""},{"button-content":l(()=>[i("span",It,[m(Pe)])]),default:l(()=>[m(W,null,{default:l(()=>[m($e,{to:`/AdditionalServices/${t.item.ID}`},{default:l(()=>e[20]||(e[20]=[D("Дополнительная информация",-1)])),_:2,__:[20]},1032,["to"])]),_:2},1024),m(W,{onClick:L=>Se(t.item.ID,t.item.ServiceID)},{default:l(()=>e[21]||(e[21]=[D("Передать на другой аккаунт",-1)])),_:2,__:[21]},1032,["onClick"]),_.sectionId==51e3||_.sectionId==52e3?(v(),C(W,{key:0,onClick:L=>Oe(t.item.ID,t.item.ServiceID)},{default:l(()=>e[22]||(e[22]=[D("Управлять заказом",-1)])),_:2,__:[22]},1032,["onClick"])):$("",!0),_.sectionId==52e3?(v(),C(W,{key:1,onClick:L=>de(t.item.ID,t.item.ServiceID)},{default:l(()=>e[23]||(e[23]=[D("Сменить пароль",-1)])),_:2,__:[23]},1032,["onClick"])):$("",!0),m(Ne),m(W,{class:"color-red",onClick:L=>E("deleteItem",t.item)},{default:l(()=>e[24]||(e[24]=[D("Удалить",-1)])),_:2,__:[24]},1032,["onClick"])]),_:2},1024)])]),_:1},8,["sort-by","sort-desc","items","fields","sort-direction"])):(v(),C(Be,{key:1,class:"tw-mt-4",label:"Вы еще не пользовались этой услугой"}))],64)}}},Dt=ie(_t,[["__scopeId","data-v-86ffc47d"]]),St={class:"tw-px-4 md:tw-px-8"},Ot={class:"section-nav"},bt=["title","onClick"],kt={class:"multiselect-option"},yt={key:0,class:"section-body tw-mt-4"},gt={__name:"AdditionalServices",async setup(_){let p,d;const E=g(!1),I=g(3),f=g(null),O=te(),U=ee(),P=ne("emitter"),k=ae(),V=ot(),h=se(),K=re();[p,d]=j(()=>K.fetchContracts()),await p,d(),[p,d]=j(()=>h.fetchUserOrders()),await p,d(),[p,d]=j(()=>k.fetchServices()),await p,d(),[p,d]=j(()=>k.fetchDNSmanagerOrders()),await p,d(),[p,d]=j(()=>k.fetchISPswOrders()),await p,d(),[p,d]=j(()=>k.fetchExtraIPOrders()),await p,d();const y=R(()=>Object.values(k.ServicesList).filter(a=>a.ServicesGroupID!=1e3&&a.IsActive&&!a.IsHidden).sort((a,w)=>Number(a.SortID)-Number(w.SortID)).map(a=>({...a,ID:Number(a.ID),value:Number(a.ID)}))),b=Number(O.query.ServiceID)||O.meta?.ServiceID||null;b&&y.value.find(a=>a.ID==b)?f.value=b:(f.value=y.value[0].ID,U.replace(`/AdditionalServices?ServiceID=${f.value}`));async function N(a){E.value=!0,f.value=a,a==51e3?await U.replace("/ISPswOrders"):await U.replace(`/AdditionalServices?ServiceID=${a}`),E.value=!1}function A(a){P.emit("open-modal",{component:"DeleteItem",data:{id:a.ID,message:`Вы действительно хотите удалить заказ #${a.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}P.on("updateUserOrdersList",()=>{h.fetchUserOrders()}),P.on("updateServicesList",()=>{h.fetchUserOrders()}),P.on("updateDNSManagerPage",()=>{k.fetchDNSmanagerOrders()}),oe(async()=>{window.addEventListener("resize",T),T()}),Ze(()=>{window.removeEventListener("resize",T)});const T=()=>{window.innerWidth>=1920?I.value=y.value.length:window.innerWidth>=1536?I.value=8:window.innerWidth>=1280?I.value=6:window.innerWidth>=1024?I.value=4:window.innerWidth>=768?I.value=3:window.innerWidth>=640?I.value=4:window.innerWidth>=480?I.value=3:I.value=2};return(a,w)=>{const H=nt,z=et,q=Dt,X=J;return v(),x(G,null,[m(H),i("div",St,[i("div",Ot,[(v(!0),x(G,null,Je(y.value.slice(0,I.value),c=>(v(),x("div",{key:c?.ID,class:F(["section-nav__item",{"section-link":!0,"section-link-active":f.value===c?.ID}]),title:Q(V).serverGroupsList?.ServersGroups[c.ServersGroupID]?.Comment,onClick:Y=>N(c.ID)},S(c?.Item),11,bt))),128)),y.value.length>I.value?(v(),C(Q(rt),{key:0,modelValue:f.value,"onUpdate:modelValue":w[0]||(w[0]=c=>f.value=c),class:F({"multiselect--white additional-service__select":!0,"additional-service__select_active":y.value.slice(I.value).find(c=>c?.ID===f.value)}),options:y.value.slice(I.value),label:"ID",onSelect:w[1]||(w[1]=c=>N(c))},{option:l(({option:c})=>[i("div",kt,S(c?.Item),1)]),caret:l(()=>[m(z,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):$("",!0)]),E.value?$("",!0):(v(),x("div",yt,[y.value.find(c=>c.ID==f.value)?(v(),C(q,{key:0,"section-id":f.value,"section-data":y.value.find(c=>c.ID==f.value),onDeleteItem:A},null,8,["section-id","section-data"])):(v(),C(X,{key:1,label:"Услуга не найдена"}))]))])],64)}}},Ft=ie(gt,[["__scopeId","data-v-2cc8da52"]]);export{Ft as default};
