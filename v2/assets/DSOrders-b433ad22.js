import{k as T,o as f,c as x,b as c,a as r,n as oe,t as D,$ as O,aa as B,w as L,d as j,F,y as ae,z as R,_ as se,r as _,e as ne,U as te,h as v,i as re}from"./index-c781268b.js";import{u as le}from"./dedicatedServer-1d58ce86.js";import{u as ce}from"./contracts-7e377877.js";import{I as de}from"./IconSearch-afa9efad.js";import{D as z}from"./DSItem-5a29024f.js";import{S as ie}from"./Select2-a2bee03b.js";import{s as ue}from"./multiselect-9a74535b.js";import{_ as G}from"./FormInputSearch-2b54abc4.js";import{B as H}from"./BlockBalanceAgreement-1d554184.js";import{u as fe}from"./globalActions-bedd3c73.js";import{_ as _e,B as q}from"./IconButtonBack-9fec81dc.js";import{E as ve}from"./EmptyStateBlock-8165a481.js";import{_ as pe}from"./ClausesKeeper-5fae717f.js";import{f as me}from"./bootstrap-vue-next.es-c86262f3.js";import{_ as ge}from"./ButtonDefault-dafa6215.js";import"./HelperComponent-7ac34d9c.js";import"./StatusBadge-499d8e7d.js";import"./IconRotate-a53b93ce.js";import"./useTimeFunction-8602dd60.js";import"./resetServer-bcdc43a0.js";import"./IconDots-4f78eb4a.js";import"./IconCard-07d73f70.js";import"./OrderIDBadge-8c4c416f.js";import"./IconPlus-97ddfd30.js";import"./IconArrow-8731a209.js";import"./IconClose-3fa8ed32.js";const Se={class:"section"},De={class:"container"},Ce={class:"title__icon"},he={class:"btn__group"},we={class:"group__several"},ke={class:"list-form"},Ie={class:"list-form_col list-form_col--sm"},be={class:"list-form_select"},Oe={class:"multiselect-option"},Be={key:0};function Le(C,s,P,o,p,h){var S,k,I;const i=H,d=_e,m=ge,w=T("router-link"),u=q,y=me,M=pe,U=T("Multiselect"),V=G,l=z,g=ve;return f(),x(F,null,[c(i),r("div",Se,[r("div",De,[r("div",{class:oe(["section-header",o.isSeveral?"column":""])},[r("div",Ce,[r("h1",{class:"section-title",onClick:s[0]||(s[0]=n=>o.reloadNow())},D(o.isSeveral?"Продление услуг выделенных серверов":"Выделенные серверы"),1),O(c(d,{onClick:s[1]||(s[1]=n=>o.outSeveralOrders())},null,512),[[B,o.isSeveral]])]),O(r("div",he,[O(c(m,{class:"btn-several",label:"Продлить несколько заказов",onClick:s[2]||(s[2]=n=>o.prolongSeveralOrders())},null,512),[[B,o.getDSList.length>1]]),c(w,{class:"btn btn--blue btn-default",to:"DSSchemes"},{default:L(()=>[j("Заказать")]),_:1})],512),[[B,!o.isSeveral]]),O(r("div",we,[c(u,{class:"contr period",modelValue:o.selectPeriod,"onUpdate:modelValue":s[3]||(s[3]=n=>o.selectPeriod=n)},null,8,["modelValue"]),c(y,{id:"checkbox-balance",modelValue:o.useBalance,"onUpdate:modelValue":s[4]||(s[4]=n=>o.useBalance=n),name:"checkbox-balance"},{default:L(()=>[j("Использовать средства с баланса")]),_:1},8,["modelValue"]),c(m,{label:"Продлить",onClick:s[5]||(s[5]=n=>o.prolongOrders())})],512),[[B,o.isSeveral]])],2),c(M,{partition:"Header:/DSOrders"}),r("div",ke,[r("div",Ie,[r("div",be,[c(U,{modelValue:o.select,"onUpdate:modelValue":s[6]||(s[6]=n=>o.select=n),options:o.getUsers,disabled:((S=o.getUsers)==null?void 0:S.length)<=1,label:"name"},{singlelabel:L(({value:n})=>[r("span",null,"# "+D(n.value.padStart(5,"0"))+" / "+D(n.name),1)]),option:L(({option:n})=>[r("div",Oe,"# "+D(n.value.padStart(5,"0"))+" / "+D(n.name),1)]),_:1},8,["modelValue","options","disabled"])])]),c(V,{modelValue:o.search,"onUpdate:modelValue":s[7]||(s[7]=n=>o.search=n)},null,8,["modelValue"])]),o.getDSList&&((k=o.getDSList)==null?void 0:k.length)>0?(f(),x("div",Be,[o.filterProducts&&((I=o.filterProducts)==null?void 0:I.length)>0?(f(!0),x(F,{key:0},ae(o.filterProducts,(n,b)=>(f(),R(l,{params:o.getDSItemParam(n),"is-last":b===o.filterProducts.length-1,"item-data":n,isSeveral:o.isSeveral,"selected-rows":o.selectedRows,onUpdateSelectedRows:o.handleSelectedRowsUpdate,onDelete:o.deleteItem,onTransfer:o.transferItem,onManage:o.orderManage},null,8,["params","is-last","item-data","isSeveral","selected-rows","onUpdateSelectedRows","onDelete","onTransfer","onManage"]))),256)):(f(),R(g,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(f(),R(g,{key:1,class:"no-margin",label:"У Вас нет заказов на выделенные серверы"}))])])],64)}const Pe={components:{FormInputSearch:G,IconSearch:de,Select2:ie,Multiselect:ue,DSItem:z,BlockBalanceAgreement:H,BlockSelectPeriod:q},async setup(){const C=_("*"),s=_(null),P=fe(),o=le(),p=ce(),h=ne(),i=_(!1),d=_([]),m=_(null),w=_(!1),u=te("emitter");u.on("updateDSOrdersList",()=>{o.fetchDSOrders()});const y=a=>{d.value=a};async function M(){console.log(d.value);const a=Object.keys(d.value).filter(t=>d.value[t]),e={ServiceID:"40000",ItemsPay:m.value,OrdersIDs:a,...w.value&&{UseBalance:"yes"}};await P.OrdersPay(e).then(t=>{t==="Basket"?(console.log("Success"),h.push("/Basket")):(t==null?void 0:t.Status)==="Ok"&&(i.value=!1,u.emit("open-modal",{component:"BalanceProlong",data:{Message:t==null?void 0:t.Message,Count:t==null?void 0:t.Count}}))})}function U(){i.value=!0}function V(){i.value=!1}const l=v(()=>{var a;return(a=Object.keys(o==null?void 0:o.DSList).map(e=>o==null?void 0:o.DSList[e]))==null?void 0:a.reverse()}),g=v(()=>o==null?void 0:o.DSSchemes),S=v(()=>p==null?void 0:p.contractsList),k=v(()=>o==null?void 0:o.DSOrderIPMI),I=v(()=>K(J(l.value)));re(()=>{l.value.length<1&&b()});function n(){h.go(0)}function b(){h.push({path:"/DSSchemes"})}function J(a){return C.value!=="*"?a.filter(e=>(e==null?void 0:e.ContractID)===C.value):a}function K(a){return s.value!==null?a.filter(e=>(e==null?void 0:e.Customer.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.OrderID.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.Scheme.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.IP.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.disks.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.CPU.toLowerCase().includes(s.value.toLowerCase()))||(e==null?void 0:e.ram.toLowerCase().includes(s.value.toLowerCase()))):a}function Q(a){P.OrderManage(a)}const W=v(()=>{let a=[{value:"*",name:"Все договора"}];return l.value!==null&&S.value!==null?(Object.keys(l.value).forEach(e=>{var t,N,A;a.find(ee=>{var E;return ee.value===((E=l.value[e])==null?void 0:E.ContractID)})||a.push({value:(t=l.value[e])==null?void 0:t.ContractID,name:(A=S.value[(N=l.value[e])==null?void 0:N.ContractID])==null?void 0:A.Customer})}),a):{value:"*",name:"Все договора"}});function X(a){let e=Y(a==null?void 0:a.SchemeID);e===void 0&&(e=a);let t=[];return a!=null&&a.Scheme&&t.push(a==null?void 0:a.Scheme),a!=null&&a.CPU&&t.push(a==null?void 0:a.CPU),e!=null&&e.ram&&t.push("RAM "+(e==null?void 0:e.ram)+" GB"),e!=null&&e.disks&&t.push(e==null?void 0:e.disks),e!=null&&e.CostMonth&&t.push("<b>"+(e==null?void 0:e.CostMonth)+"/ месяц</b>"),t}function Y(a){var e;return(e=g.value)==null?void 0:e[a]}function Z(a){u.emit("open-modal",{component:"DeleteItem",data:{id:a,message:"Вы действительно хотите удалить этот сервер?",tableID:"DSOrders",successEmit:"updateDSOrdersList"}})}function $(a){u.emit("open-modal",{component:"OrdersTransfer",data:a})}return await o.fetchDSOrders(),await o.fetchDSSchemes(),await o.fetchDSOrderIPMI(),await p.fetchContracts(),{getDSList:l,filterProducts:I,select:C,search:s,getUsers:W,getDSSchemes:g,getDSItemParam:X,getDSOrderIPMI:k,orderManage:Q,deleteItem:Z,transferItem:$,navigateToDSSchemes:b,reloadNow:n,prolongSeveralOrders:U,isSeveral:i,selectedRows:d,selectPeriod:m,prolongOrders:M,outSeveralOrders:V,useBalance:w,handleSelectedRowsUpdate:y}}},ao=se(Pe,[["render",Le],["__scopeId","data-v-143eaad1"]]);export{ao as default};
