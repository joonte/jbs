import{_ as G}from"./EmptyStateBlock-CV1Zaaf7.js";import{_ as q}from"./BlockAdditionalServices-DPr--p0K.js";import{_ as K}from"./ButtonDefault-eJbeaBtE.js";import{_ as X}from"./StatusBadge-DoJSzeeo.js";import{_ as z}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as J}from"./BlockBalanceAgreement-DjWMZ940.js";import{c as _,b as S,a as t,i as y,t as u,w as N,G as Q,F as V,j as L,D as B,H as W,u as Y,r as E,f as p,g as Z,h as $,x as ee,d as re,o as c,e as x}from"./index-XtiBO-PZ.js";import{u as te}from"./services-izfy4zss.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-CxxkTytZ.js";import"./ServiceListOrderSelection-D6_D29T7.js";import"./BasicInput-TTn3Hxre.js";import"./component-YfTGPdLe.js";import"./BlockSelectContract-BJLjloC1.js";import"./contracts-BdlSA9YT.js";import"./multiselect-eqvbz1NV.js";import"./IconClose-s_NQ_Q4c.js";const oe={async setup(){const R=Z(),s=re(),v=W(),e=te(),D=Y(),m=ee("emitter"),i=E([]),I=E(!0),g=E(!1),l=p(()=>v?.vpsList?Object.keys(v.vpsList).map(r=>v.vpsList[r]).find(r=>r&&String(r.OrderID)===String(R.params.id)):null),h=p(()=>!l.value?.SchemeID||!v?.vpsSchemes?null:v.vpsSchemes[l.value.SchemeID]),b=p(()=>!l.value||!h.value?null:{ServiceID:l.value.ServiceID,ServersGroupID:h.value.ServersGroupID}),f=p(()=>e?.ServicesList||{}),o=p(()=>{if(!l.value?.OrderID||!D?.userOrders)return[];const r=l.value.OrderID;return Object.keys(D.userOrders).map(d=>D.userOrders[d]).filter(d=>String(d?.DependOrderID)===String(r)&&d?.ServiceID&&f.value[d.ServiceID]).sort((d,k)=>Number(d?.ID)-Number(k?.ID))}),P=p(()=>{if(!i.value||!Array.isArray(i.value))return 0;let r=0;return i.value.forEach(n=>{n&&typeof n.Price=="number"&&(r+=n.Price)}),A(r)});function T(r){i.value=r||[]}function A(r){return r==null?"0.00":Number(r).toFixed(2)||"0.00"}async function U(){if(!(!i.value||!Array.isArray(i.value)||i.value.length===0))for(const r of i.value){if(!r)continue;let n="SUCCESS",a=f.value[r.ServiceID]?.Code;const O={Code:a,DependOrderID:l.value?.OrderID,...r,ContractID:l.value?.ContractID};try{const{result:d,info:k,error:Re}=await e.ServiceOrder(O);if(d==="SUCCESS"){let C={};a==="Default"?C.ServiceOrderID=k?.ServiceOrderID:C[`${a}OrderID`]=k?.ServiceOrderID;const H=await e.ServiceOrderPay(a,C,{XMLHttpRequest:"yes"});let{result:w,error:Ae}=H;w==="SUCCESS"?(m.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),i.value=[],s.push("/AdditionalServices")):w==="BASKET"&&s.push("/Basket")}else n="ERROR",m.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(d){console.error("Ошибка при заказе услуги:",d),n="ERROR",m.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(n==="ERROR")break}}async function F(){g.value=!0;try{await U()}catch(r){console.error("Ошибка при заказе услуг:",r),m.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{g.value=!1}}function M(r){const n=Object.values(f.value).find(O=>O.ID===r);if(!n){s.push(`/AdditionalServices/${r}`);return}const a=n.Code;a==="Default"||a==="DNSmanager"||a==="ISPsw"||a==="ExtraIP"?s.push(`/AdditionalServices/${r}`):s.push(`/${a}Orders/${r}`)}function j(r,n){let a="Orders";n==="50000"?a="ExtraIPOrders":n==="51000"?a="ISPswOrders":n==="52000"&&(a="DNSmanagerOrders"),m.emit("open-modal",{component:"StatusHistory",data:{modeID:a,rowID:r}})}return $(async()=>{try{await v.fetchVPS(),await v.fetchVPSSchemes(),await e.fetchServices(),await D.fetchUserOrders()}catch(r){console.error("Ошибка загрузки данных:",r)}finally{I.value=!1}}),{getVPSData:l,serviceSearchParams:b,selectedServices:i,getServices:f,orderedServices:o,ADDITIONAL_SERVICES_PRICE:P,handleServicesUpdate:T,setToFixedService:A,orderServices:F,isLoading:I,isOrderLoading:g,navigateToService:M,openHistoryStatuses:j}}},ae={class:"container"},ne={class:"section-header"},ie={key:0,class:"section-label"},ce={class:"section-nav"},le={key:0,class:"section-body"},de={class:"ordered-services-list"},_e={class:"ordered-service-header"},ve={class:"ordered-service-name"},ue={class:"ordered-service-status"},Se={class:"ordered-service-details"},me={class:"ordered-service-info"},fe={key:0},pe={class:"ordered-service-actions"},De={class:"section-body"},Ie={key:2,class:"loading"},ge={key:0},he={class:"container"},Oe={class:"total-block"},ke={class:"total-block__row"},ye={class:"total-block__col"},be={class:"total-block__col"},Pe={class:"total-block__col"},Ce={class:"total-block__row total-block__row--big"},Ve={class:"total-block__col"};function Ee(R,s,v,e,D,m){const i=J,I=Q("router-link"),g=z,l=X,h=K,b=q,f=G;return c(),_(V,null,[S(i),t("section",null,[t("div",ae,[t("div",ne,[s[4]||(s[4]=t("h1",{class:"section-title"},"Дополнительные услуги",-1)),e.getVPSData?(c(),_("div",ie,"VPS/VDS сервер # "+u(e.getVPSData?.OrderID),1)):y("",!0),t("div",ce,[S(I,{class:"section-nav__item",to:`/VPSOrders/${e.getVPSData?.OrderID}`},{default:N(()=>s[2]||(s[2]=[x(" Сервер ",-1)])),_:1,__:[2]},8,["to"]),S(I,{class:"section-nav__item active",to:`/VPSServices/${e.getVPSData?.OrderID}`},{default:N(()=>s[3]||(s[3]=[x(" Услуги ",-1)])),_:1,__:[3]},8,["to"])])]),S(g),e.orderedServices&&e.orderedServices.length>0?(c(),_("div",le,[s[5]||(s[5]=t("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),t("div",de,[(c(!0),_(V,null,L(e.orderedServices,o=>(c(),_("div",{class:"ordered-service-item",key:o.ID},[t("div",_e,[t("div",ve,u(e.getServices[o?.ServiceID]?.Name||o?.ServiceName||`Услуга #${o?.ServiceID}`),1),t("div",ue,[S(l,{status:o?.StatusID,"status-table":"Orders",onClick:P=>e.openHistoryStatuses(o?.ID,o?.ServiceID)},null,8,["status","onClick"])])]),t("div",Se,[t("div",me,[t("span",null,"Заказ # "+u(o?.ID),1),o?.DaysRemainded?(c(),_("span",fe," Осталось дней: "+u(o?.DaysRemainded),1)):y("",!0)])]),t("div",pe,[S(h,{class:"btn--sm",label:"Перейти к заказу",onClick:P=>e.navigateToService(o?.ID)},null,8,["onClick"])])]))),128))])])):y("",!0),t("div",De,[e.getVPSData&&e.serviceSearchParams?(c(),B(b,{key:0,modelValue:e.selectedServices,"onUpdate:modelValue":[s[0]||(s[0]=o=>e.selectedServices=o),e.handleServicesUpdate],"service-search-params":e.serviceSearchParams},null,8,["modelValue","service-search-params","onUpdate:modelValue"])):e.isLoading?(c(),_("div",Ie,"Загрузка...")):(c(),B(f,{key:1,label:"Заказ не найден"}))])])]),e.selectedServices&&e.selectedServices.length>0?(c(),_("section",ge,[t("div",he,[t("div",Oe,[t("div",ke,[s[6]||(s[6]=t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),t("div",ye,u(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(c(!0),_(V,null,L(e.selectedServices,o=>(c(),_("div",{class:"total-block__row no-divider",key:o.ServiceID},[t("div",be,u(e.getServices[o?.ServiceID]?.Name),1),t("div",Pe,u(e.setToFixedService(o?.Price))+" ₽",1)]))),128)),t("div",Ce,[s[7]||(s[7]=t("div",{class:"total-block__col"},"Итого к оплате",-1)),t("div",Ve,u(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)])]),S(h,{class:"btn--wide",disabled:!e.selectedServices||e.selectedServices.length===0||e.isOrderLoading,"is-loading":e.isOrderLoading,label:"Заказать дополнительные услуги",onClick:s[1]||(s[1]=o=>e.orderServices())},null,8,["disabled","is-loading"])])])):y("",!0)],64)}const Qe=se(oe,[["render",Ee],["__scopeId","data-v-7f1e2409"]]);export{Qe as default};
