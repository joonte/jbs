import{o as D,c as F,a as t,t as y,b as I,p as w,l as x,_ as V,a6 as N,e as B,f as E,r as P,g as _,i as L,a2 as q}from"./index-ed1f28f8.js";import{u as M}from"./postings-71aa09ae.js";import{u as R}from"./services-092233a9.js";import{_ as U}from"./ButtonDefault-a8aacc82.js";import{_ as J}from"./ClausesKeeper-9aa8ead7.js";import"./IconClose-a1e58263.js";const h=d=>(w("data-v-2984d943"),d=d(),x(),d),K={class:"additional-service-prolong"},T={class:"section"},$={class:"container"},z={class:"section-header"},G=h(()=>t("h1",{class:"section-title"},"Оплата заказа дополнительной услуги",-1)),H={class:"section-label"},Q={class:"section"},W={class:"container"},X={class:"service-prolong__data"},Y={class:"form-field"},Z=h(()=>t("div",{class:"form-field__label"},"Стоимость заказа",-1)),j=["value"],ee={class:"form-field"},se={class:"form-field__label"},te=h(()=>t("input",{type:"text",placeholder:"0 руб",value:"1",disabled:""},null,-1)),oe={class:"form-field"},ae=h(()=>t("div",{class:"form-field__label"},"Всего к оплате",-1)),re=["value"],ie={class:"section"},ce={class:"container"},le={class:"service-prolong__data"},ne={class:"total-block"},de={class:"total-block__row total-block__row--big"},_e=h(()=>t("div",{class:"total-block__col"},"Итого",-1)),ue={class:"total-block__col"};function ve(d,u,v,a,C,m){var g,S,f;const l=J,p=U;return D(),F("div",K,[t("div",T,[t("div",$,[t("div",z,[G,t("div",H,y((g=a.getService)==null?void 0:g.Name)+" # "+y((S=a.getOrder)==null?void 0:S.ID),1)]),I(l)])]),t("div",Q,[t("div",W,[t("div",X,[t("label",Y,[Z,t("input",{type:"text",placeholder:"0 руб",value:a.orderCost+" руб",disabled:""},null,8,j)]),t("label",ee,[t("div",se,"Количество ("+y((f=a.getService)==null?void 0:f.Measure)+")",1),te]),t("label",oe,[ae,t("input",{type:"text",placeholder:"0 руб",value:a.getServicePrice()+" руб",disabled:""},null,8,re)])])])]),t("div",ie,[t("div",ce,[t("div",le,[t("div",ne,[t("div",de,[_e,t("div",ue,y(a.getServicePrice()||"0")+" ₽",1)])]),I(p,{class:"btn--wide",label:"Оплатить",onClick:u[0]||(u[0]=b=>a.orderPay()),"is-loading":a.isLoading},null,8,["is-loading"])])])])])}const pe={async setup(){const d=N(),u=B(),v=M(),a=E(),C=R(),m=P(!1),l=_(()=>Object.keys(a==null?void 0:a.userOrders).map(e=>a==null?void 0:a.userOrders[e]).find(e=>e.ID===d.params.id));_(()=>{var e,s;return(s=(e=g.value)==null?void 0:e.find(o=>{var r,i,c;return o.value===((c=(i=(r=l.value)==null?void 0:r.OrdersFields)==null?void 0:i[0])==null?void 0:c.Value)}))==null?void 0:s.price}),_(()=>{var e,s;return(s=(e=S.value)==null?void 0:e.find(o=>{var r,i,c;return o.value===((c=(i=(r=l.value)==null?void 0:r.OrdersFields)==null?void 0:i[1])==null?void 0:c.Value)}))==null?void 0:s.price});const p=P(0),g=_(()=>{var e,s,o,r,i;return(i=(r=(o=(s=(e=O.value)==null?void 0:e.ServicesFields)==null?void 0:s[0])==null?void 0:o.Options)==null?void 0:r.split(`
`))==null?void 0:i.map(c=>{let n=c.split("=");return{value:n[0],name:n[1],price:n[2]}})}),S=_(()=>{var e,s,o,r,i;return(i=(r=(o=(s=(e=O.value)==null?void 0:e.ServicesFields)==null?void 0:s[1])==null?void 0:o.Options)==null?void 0:r.split(`
`))==null?void 0:i.map(c=>{let n=c.split("=");return{value:n[0],name:n[1],price:n[2]}})});async function f(e){try{const o=(await q.get(`/ServiceOrderPay?OrderID=${e}&JSON=1`)).data,r=b(o);let i=1;return o.AmountPay&&(i=parseInt(o.AmountPay)||1),console.log(i),r}catch(s){return console.error("Ошибка при получении данных о стоимости заказа",s),null}}function b(e){let s=0;for(const o in e)e.hasOwnProperty(o)&&(typeof e[o]=="object"?s+=b(e[o]):o==="Cost"&&!isNaN(e[o])&&(s+=parseFloat(e[o])));return s}function k(){return((parseFloat(p.value)||0)*1).toFixed(2)}function A(){var e,s;m.value=!0,C.ServiceOrderPay((e=l.value)==null?void 0:e.Code,{AmountPay:"1",ServiceOrderID:(s=l.value)==null?void 0:s.ID,IsChange:!0}).then(o=>{var c;let{result:r,error:i}=o;r==="SUCCESS"?u.push(`/AdditionalServices/${(c=l.value)==null?void 0:c.ID}`):r==="BASKET"&&u.push("/Basket"),m.value=!1})}L(async()=>{if(l.value){const e=l.value.ID,s=await f(e);s!==null&&(p.value=s)}});const O=_(()=>{var e;return v==null?void 0:v.servicesList[(e=l.value)==null?void 0:e.ServiceID]});return await a.fetchUserOrders(),await v.fetchServices(),{getOrder:l,getService:O,getServicePrice:k,isLoading:m,orderPay:A,fetchOrderCost:f,orderCost:p}}},be=V(pe,[["render",ve],["__scopeId","data-v-2984d943"]]);export{be as default};
