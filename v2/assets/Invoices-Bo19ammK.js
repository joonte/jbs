import{_ as q}from"./EmptyStateBlock-CV1Zaaf7.js";import{L as z,a as J,v as K,r as Q}from"./bootstrap-vue-next-CxxkTytZ.js";import{_ as X}from"./IconDots-DWUcOOJk.js";import{_ as Y}from"./IconCard-cFowCC2T.js";import{_ as $}from"./IconDownload-Dy4eMtUh.js";import{_ as ee}from"./IconFile-3Bs1Bn0r.js";import{_ as te}from"./StatusBadge-DoJSzeeo.js";import{_ as oe}from"./FormInputSearch-DhLeThyA.js";import{_ as ne}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as se}from"./ButtonDefault-eJbeaBtE.js";import{_ as ae}from"./BlockBalanceAgreement-DjWMZ940.js";import{c as y,b as i,a as n,D as ie,w as a,G as le,F as O,i as M,am as re,x as ce,r as _,f as v,g as me,d as de,W as R,o as I,t as l,e as C}from"./index-XtiBO-PZ.js";import{u as ue}from"./postings-D5DA40Zz.js";import{u as _e}from"./contracts-BdlSA9YT.js";import{s as pe}from"./multiselect-eqvbz1NV.js";import{f as ve,s as fe}from"./time-DenPiOX5.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-DYth91EZ.js";import"./IconClose-s_NQ_Q4c.js";const be=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Files",variant:"td-controls",label:""}],ge={components:{Multiselect:pe},async setup(){const b=_e(),t=ue();re();const x=de(),o=me(),m=ce("emitter");m.on("updateInvoicesTable",()=>{t.fetchInvoices()});const B=_("CreateDate"),k=_(!0),S=_("desc"),f=_(""),d=_("*"),g=_(1),w=_(10),P=_([10,25,50,100]),p=v(()=>Object.keys(t?.invoicesList).map(s=>({...t?.invoicesList[s],Customer:c.value?.[t?.invoicesList[s].ContractID]?.Customer,Summ:Number(t?.invoicesList[s]?.Summ)})).reverse()),F=v(()=>p.value.filter(r=>d.value!=="*"?Number(r.ContractID)===Number(d.value):!0)),h=v(()=>t?.servicesList),c=v(()=>b.contractsList),L=v(()=>{let s=[];return p.value.map(r=>{if(!s.find(D=>D===r.Customer))return s.push(r.Customer),{value:r.ContractID,name:r.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),N=v(()=>p.value.filter(s=>s?.PaymentSystemName.toLowerCase().includes(f.value?.toLowerCase())||String(s?.Summ).toLowerCase().includes(f.value?.toLowerCase())).filter(s=>s.ContractID.includes(d.value!=="*"?d.value:"")).length);function V(){x.go(0)}function T(){g.value=1}function e(s){return`${R}/InvoiceDownload?InvoiceID=${s?.item?.ID}&IsStamp=yes`}function u(s){return`${R}/InvoiceDownload?InvoiceID=${s?.item?.ID}&IsTIFF=yes&IsStamp=yes`}function E(s){m.emit("open-modal",{component:"AcceptConditionally",data:{ContractID:s?.item?.ContractID,RowsIDs:s?.item?.ID,AllowConditionallyMessage:s?.item?.AllowConditionallyMessage}})}function j(s){m.emit("open-modal",{component:"StatusHistory",data:{modeID:"Invoices",rowID:s}})}function A(s){m.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:s?.item?.ID,TypeID:c.value?.[s?.item?.ContractID]?.TypeID,Summ:s?.item?.Summ}})}function U(s){t.InvoiceDocument({InvoiceID:s.item?.ID}).then(r=>{m.emit("open-modal",{component:"InvoiceDocument",data:{html:r,ID:s.item?.ID}})})}function G(){m.emit("open-modal",{component:"NewInvoice"})}function H(){}function W(){}function Z(s){let r=new FormData;r.append("ContractID","Default"),r.append("RowsIDs[]",s.item?.ID),t.InvoicesReject(r).then(D=>{D==="SUCCESS"&&t.fetchInvoices()})}return window.FormGet=H.bind(this),window.Mobile=W.bind(this),await b.fetchContracts(),await b.fetchProfiles(),await t.fetchInvoices().then(()=>{o.params?.id&&p.value?.find(r=>r.ID===o.params?.id)&&U({item:{ID:o.params.id}}),o.query.Error==="yes"&&m.emit("open-modal",{component:"InvoiceError"})}),await t.fetchServices(),{search:f,select:d,getContracts:c,getUsers:L,getOrders:p,getServices:h,currentPage:g,perPage:w,sortBy:B,sortDesc:k,sortDirection:S,pageOptions:P,filteredContractsLength:N,worksCompleteFields:be,getFilteredOrders:F,invoicePayment:U,invoicesReject:Z,switchPaymentSystem:A,setPageToZero:T,secondToDate:fe,formNormalDate:ve,getInvoicesTTFLink:u,getInvoicesPDFLink:e,createNewIncoice:G,invoiceSetConditionally:E,openHistoryStatuses:j,reloadNow:V}}},De={class:"section"},ye={class:"container"},Ce={class:"section-header"},ke={class:"list-form"},Se={class:"list-form_col list-form_col--sm"},we={class:"list-form_select"},Pe={class:"multiselect-option"},Fe={class:"d-block"},he={class:"d-block"},Le={class:"d-block"},Ne={class:"d-block"},Ve={class:"d-block"},Te={class:"invoices__controls-wrapper"},xe=["href"],Be={class:"invoices__download-button-wrapper"},Ue={class:"invoices__download-text"},Oe={class:"btn__group"},Me=["onClick"],Re={class:"dropdown-button"},Ee={class:"btn btn--dots"},je=["href"],Ae={key:0,class:"table-controls"},Ge={class:"multiselect-multiple-label"},He={class:"multiselect-option"};function We(b,t,x,o,m,B){const k=ae,S=se,f=ne,d=le("Multiselect"),g=oe,w=te,P=ee,p=$,F=Y,h=X,c=Q,L=K,N=z,V=J,T=q;return I(),y(O,null,[i(k),n("section",De,[n("div",ye,[n("div",Ce,[n("h1",{class:"section-title",onClick:t[0]||(t[0]=e=>o.reloadNow())},"Счета на оплату"),i(S,{onClick:t[1]||(t[1]=e=>o.createNewIncoice()),label:"Выписать новый счёт"})]),i(f),n("div",ke,[n("div",Se,[n("div",we,[i(d,{modelValue:o.select,"onUpdate:modelValue":t[2]||(t[2]=e=>o.select=e),options:o.getUsers,disabled:o.getUsers?.length<=1,label:"name"},{singlelabel:a(({value:e})=>[n("span",null,"# "+l(e.value.padStart(5,"0"))+" / "+l(e.name),1)]),option:a(({option:e})=>[n("span",Pe,"# "+l(e.value.padStart(5,"0"))+" / "+l(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),i(g,{modelValue:o.search,"onUpdate:modelValue":t[3]||(t[3]=e=>o.search=e)},null,8,["modelValue"])]),o.getFilteredOrders?.length>0?(I(),y(O,{key:0},[i(N,{class:"basic-table",items:o.getFilteredOrders,fields:o.worksCompleteFields,"show-empty":!0,filter:o.search,"per-page":o.perPage,"current-page":o.currentPage,responsive:"","sort-by":o.sortBy,"onUpdate:sortBy":t[4]||(t[4]=e=>o.sortBy=e),"sort-desc":o.sortDesc,"onUpdate:sortDesc":t[5]||(t[5]=e=>o.sortDesc=e),"sort-direction":o.sortDirection,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:o.setPageToZero},{"cell(PaymentSystemName)":a(e=>[t[9]||(t[9]=n("span",{class:"td-mobile"},"Платежная система",-1)),n("span",Fe,l(e.value),1)]),"cell(CreateDate)":a(e=>[t[10]||(t[10]=n("span",{class:"td-mobile"},"Дата Создания",-1)),n("span",he,l(o.formNormalDate(o.secondToDate(e.item?.CreateDate))),1)]),"cell(ID)":a(e=>[t[11]||(t[11]=n("span",{class:"td-mobile"},"Номер счета",-1)),n("span",Le,l(e.value),1)]),"cell(ContractID)":a(e=>[t[12]||(t[12]=n("span",{class:"td-mobile"},"Договор",-1)),n("span",Ne,"#"+l(e.item?.ContractID)+" / "+l(e.item?.Customer),1)]),"cell(StatusID)":a(e=>[t[13]||(t[13]=n("span",{class:"td-mobile"},"Статус",-1)),i(w,{status:e.value,"status-table":"Invoices",onClick:u=>o.openHistoryStatuses(e.item?.ID)},null,8,["status","onClick"])]),"cell(Summ)":a(e=>[t[14]||(t[14]=n("span",{class:"td-mobile"},"Сумма",-1)),n("span",Ve,l(e.item?.Summ)+" ₽",1)]),"cell(Files)":a(e=>[n("div",Te,[e?.value?(I(),y("a",{key:0,class:"invoices__download-button",href:o.getInvoicesPDFLink(e)},[n("span",Be,[i(P,{class:"invoices__download-icon"}),n("span",Ue," Счет №"+l(e?.value?.[Object.keys(e?.value)?.[0]]?.RowID),1),i(p,{class:"invoices__download-icon"})])],8,xe)):M("",!0),n("div",Oe,[n("button",{class:"btn btn-default btn--border",onClick:u=>o.invoicePayment(e)},[i(F),n("p",null,l(e.item?.IsPosted?"ПОСМОТРЕТЬ":"ОПЛАТИТЬ"),1)],8,Me),n("div",Re,[i(L,{class:"dropdown-dots",right:""},{"button-content":a(()=>[n("span",Ee,[i(h)])]),default:a(()=>[i(c,null,{default:a(()=>[n("a",{href:o.getInvoicesTTFLink(e)},"Скачать в формате tiff",8,je)]),_:2},1024),i(c,{onClick:u=>o.switchPaymentSystem(e)},{default:a(()=>t[15]||(t[15]=[C("Изменить счёт",-1)])),_:2,__:[15]},1032,["onClick"]),i(c,{onClick:u=>o.invoicePayment(e)},{default:a(()=>t[16]||(t[16]=[C("Оплатить",-1)])),_:2,__:[16]},1032,["onClick"]),i(c,{onClick:u=>o.invoicesReject(e)},{default:a(()=>t[17]||(t[17]=[C("Отменить",-1)])),_:2,__:[17]},1032,["onClick"]),i(c,{onClick:u=>o.invoiceSetConditionally(e)},{default:a(()=>t[18]||(t[18]=[C("Провести условно",-1)])),_:2,__:[18]},1032,["onClick"])]),_:2},1024)])])])]),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),o.filteredContractsLength>0?(I(),y("div",Ae,[i(V,{modelValue:o.currentPage,"onUpdate:modelValue":t[6]||(t[6]=e=>o.currentPage=e),"total-rows":o.filteredContractsLength,"per-page":o.perPage,"first-number":"","last-number":""},{"first-text":a(()=>t[19]||(t[19]=[n("span",{class:"text-success"},"First",-1)])),"last-text":a(()=>t[20]||(t[20]=[n("span",{class:"text-info"},"Last",-1)])),page:a(({page:e,active:u})=>[n("span",null,l((e-1)*o.perPage+1)+"-"+l(e*o.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),i(d,{class:"multiselect--white",modelValue:o.perPage,"onUpdate:modelValue":t[7]||(t[7]=e=>o.perPage=e),options:o.pageOptions,label:"name",openDirection:"top",onInput:t[8]||(t[8]=e=>o.currentPage=1)},{singlelabel:a(({value:e})=>[n("span",Ge," Отображать "+l(e.value)+" строк ",1)]),option:a(({option:e})=>[n("span",He,"Отображать "+l(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):M("",!0)],64)):(I(),ie(T,{key:1,label:"Заказов не найдено"}))])])],64)}const mt=Ie(ge,[["render",We],["__scopeId","data-v-d3e0796d"]]);export{mt as default};
