import{o as F,c as A,b as k,a as o,t as O,F as B,l as x,p as V,m as N,_ as L,f as q,e as E,g as M,r as D,h as _,i as w,a3 as R}from"./index-777dc609.js";import{u as U}from"./postings-3ba4b843.js";import{u as H}from"./services-60e1ba3c.js";import{_ as J}from"./ButtonDefault-7f62b822.js";import{_ as K}from"./ClausesKeeper-4fcca336.js";import{B as T}from"./BlockBalanceAgreement-d9b1b07a.js";import"./IconClose-166e70a9.js";import"./IconArrow-1d7911e1.js";import"./bootstrap-vue-next.es-8d4e1458.js";const g=d=>(V("data-v-4dd4814f"),d=d(),N(),d),X={class:"additional-service-prolong"},z={class:"section"},G={class:"container"},Q={class:"section-header"},W=g(()=>o("h1",{class:"section-title"},"Оплата заказа дополнительной услуги",-1)),Y={class:"section-label"},Z={class:"section"},$={class:"container"},j={class:"service-prolong__data"},ee={class:"form-field"},te=g(()=>o("div",{class:"form-field__label"},"Стоимость заказа",-1)),se=["value"],oe={class:"form-field"},re={class:"form-field__label"},ae=g(()=>o("input",{type:"text",placeholder:"0 руб",value:"1",disabled:""},null,-1)),ie={class:"form-field"},ce=g(()=>o("div",{class:"form-field__label"},"Всего к оплате",-1)),le=["value"],ne={class:"section"},de={class:"container"},_e={class:"service-prolong__data"},ue={class:"total-block"},ve={class:"total-block__row total-block__row--big"},pe=g(()=>o("div",{class:"total-block__col"},"Итого",-1)),fe={class:"total-block__col"};function me(d,u,v,r,I,y){var S,f,m,C;const l=T,p=K,b=J;return F(),A(B,null,[k(l),o("div",X,[o("div",z,[o("div",G,[o("div",Q,[W,o("div",Y,O((S=r.getService)==null?void 0:S.Name)+" # "+O((f=r.getOrder)==null?void 0:f.ID),1)]),k(p)])]),r.getOrder?(F(),A(B,{key:0},[o("div",Z,[o("div",$,[o("div",j,[o("label",ee,[te,o("input",{type:"text",placeholder:"0 руб",value:((m=r.getService)==null?void 0:m.Cost)+" руб",disabled:""},null,8,se)]),o("label",oe,[o("div",re,"Количество ("+O((C=r.getService)==null?void 0:C.Measure)+")",1),ae]),o("label",ie,[ce,o("input",{type:"text",placeholder:"0 руб",value:r.getServicePrice()+" руб",disabled:""},null,8,le)])])])]),o("div",ne,[o("div",de,[o("div",_e,[o("div",ue,[o("div",ve,[pe,o("div",fe,O(r.getServicePrice()||"0")+" ₽",1)])]),k(b,{class:"btn--wide",label:"Оплатить",onClick:u[0]||(u[0]=P=>r.orderPay()),"is-loading":r.isLoading},null,8,["is-loading"])])])])],64)):x("",!0)])],64)}const he={async setup(){const d=q(),u=E(),v=U(),r=M(),I=H(),y=D(!1),l=_(()=>Object.keys(r==null?void 0:r.userOrders).map(e=>r==null?void 0:r.userOrders[e]).find(e=>e.ID===d.params.id));_(()=>{var e,t;return(t=(e=b.value)==null?void 0:e.find(s=>{var a,i,c;return s.value===((c=(i=(a=l.value)==null?void 0:a.OrdersFields)==null?void 0:i[0])==null?void 0:c.Value)}))==null?void 0:t.price}),_(()=>{var e,t;return(t=(e=S.value)==null?void 0:e.find(s=>{var a,i,c;return s.value===((c=(i=(a=l.value)==null?void 0:a.OrdersFields)==null?void 0:i[1])==null?void 0:c.Value)}))==null?void 0:t.price});const p=D(0),b=_(()=>{var e,t,s,a,i;return(i=(a=(s=(t=(e=h.value)==null?void 0:e.ServicesFields)==null?void 0:t[0])==null?void 0:s.Options)==null?void 0:a.split(`
`))==null?void 0:i.map(c=>{let n=c.split("=");return{value:n[0],name:n[1],price:n[2]}})}),S=_(()=>{var e,t,s,a,i;return(i=(a=(s=(t=(e=h.value)==null?void 0:e.ServicesFields)==null?void 0:t[1])==null?void 0:s.Options)==null?void 0:a.split(`
`))==null?void 0:i.map(c=>{let n=c.split("=");return{value:n[0],name:n[1],price:n[2]}})});async function f(e){try{const s=(await R.get(`/ServiceOrderPay?OrderID=${e}&JSON=1`)).data,a=m(s);let i=1;return s.AmountPay&&(i=parseInt(s.AmountPay)||1),a}catch(t){return console.error("Ошибка при получении данных о стоимости заказа",t),null}}function m(e){let t=0;for(const s in e)e.hasOwnProperty(s)&&(typeof e[s]=="object"?t+=m(e[s]):s==="Cost"&&!isNaN(e[s])&&(t+=parseFloat(e[s])));return t}function C(){var s;return((parseFloat((s=h.value)==null?void 0:s.Cost)||parseFloat(p.value)||0)*1).toFixed(2)}function P(){var e,t;y.value=!0,I.ServiceOrderPay((e=l.value)==null?void 0:e.Code,{AmountPay:"1",ServiceOrderID:(t=l.value)==null?void 0:t.ID,IsChange:!0},{XMLHttpRequest:"yes"}).then(s=>{var c;let{result:a,error:i}=s;a==="SUCCESS"?u.push(`/AdditionalServices/${(c=l.value)==null?void 0:c.ID}`):a==="BASKET"&&u.push("/Basket"),y.value=!1})}w(async()=>{if(l.value){const e=l.value.ID,t=await f(e);t!==null&&(p.value=t)}}),w(()=>{console.log(h,"service get")});const h=_(()=>{var e;return v==null?void 0:v.servicesList[(e=l.value)==null?void 0:e.ServiceID]});return await r.fetchUserOrders(),await v.fetchServices(),{getOrder:l,getService:h,getServicePrice:C,isLoading:y,orderPay:P,fetchOrderCost:f,orderCost:p}}},Fe=L(he,[["render",me],["__scopeId","data-v-4dd4814f"]]);export{Fe as default};
