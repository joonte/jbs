import{_ as w}from"./EmptyStateBlock-CV1Zaaf7.js";import{_ as L}from"./ButtonDefault-eJbeaBtE.js";import{_ as x}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as E}from"./BlockBalanceAgreement-DjWMZ940.js";import{c as l,b as f,a as t,D as j,t as S,i as A,F as g,j as M,G as F,am as K,r as k,f as C,g as R,h as U,s as z,x as G,d as O,o as a,n as T}from"./index-XtiBO-PZ.js";import{c as $}from"./component-YfTGPdLe.js";import{u as q}from"./postings-D5DA40Zz.js";import{u as H}from"./contracts-BdlSA9YT.js";import{u as J}from"./invoices-DnpA41Eo.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconClose-s_NQ_Q4c.js";const W={components:{"imask-input":$},async setup(){const _=H(),e=K(),D=J(),o=q(),h=G("emitter"),v=R(),y=O(),r=k(null),c=k(null),m=k(!1),d=C(()=>_.contractsList?.[v.params.id]),s=C(()=>e.data),b=C(()=>{const n=s.value,u=d.value;if(n?.PaymentSystems&&u?.PaymentSystems){const I=new Set(u.PaymentSystems);return Object.keys(n.PaymentSystems).filter(i=>I.has(i)).map(i=>{const p=n.PaymentSystems[i];return String(p?.IsActive)==="1"?p.Collations:null}).filter(i=>i!==null).flat().slice().sort((i,p)=>{const N=parseInt(i.SortID,10),P=parseInt(p.SortID,10);return isNaN(N)?1:isNaN(P)?-1:N-P})}else return null}),B=n=>{n.key==="Enter"&&n.ctrlKey&&V()};U(()=>{document.addEventListener("keyup",B)}),z(()=>{document.removeEventListener("keyup",B)});function V(){c.value>0&&(m.value=!0,D.InvoiceMake({ContractID:d.value?.ID,PaymentSystemID:r.value?.type,Summ:c.value}).then(n=>{if(m.value=!1,n.status==="success"&&n.data&&n.data.InvoiceID){const u=n.data.InvoiceID;o.InvoiceDocument({InvoiceID:u}).then(I=>{h.emit("open-modal",{component:"InvoiceDocument",data:{html:I,ID:u}})})}else y.push(`/ProfileMake?Contract=${v.params.id}&TemplateID=${r.value?.type}`)}))}return await _.fetchContracts(),{inputValue:c,getConfig:s,filterActiveSystems:b,paymentSystem:r,isLoading:m,getContract:d,sendInvoice:V}}},X={class:"container"},Y={class:"section-header"},Z={class:"section-label"},tt={key:0,class:"list-form"},et={class:"list-part"},st={key:0,class:"list-row grid-net"},ot=["onClick"],nt=["src"],it={class:"list-item__image-title"},at={class:"list-part"},lt={class:"list-row"},rt={class:"list-form_col list-form_col--xl"},ct={class:"search-field form-field"},mt={class:"list-row"},dt={class:"btn-container"};function ut(_,e,D,o,h,v){const y=E,r=x,c=F("imask-input"),m=L,d=w;return a(),l(g,null,[f(y),t("section",null,[t("div",X,[t("div",Y,[e[2]||(e[2]=t("h1",{class:"section-title"},"Пополнить баланс",-1)),t("div",Z,"Договор # "+S(_.$route.params.id)+" / "+S(o.getContract.Customer),1)]),f(r),o.getContract?(a(),l("div",tt,[t("div",et,[e[3]||(e[3]=t("div",{class:"list-item__title"},"Платежные системы",-1)),o.filterActiveSystems?(a(),l("div",st,[(a(!0),l(g,null,M(o.filterActiveSystems,s=>(a(),l(g,{key:s?.ID},[s?.IsActive?(a(),l("div",{key:0,class:T(["list-item",{"list-item_active":o.paymentSystem?.id===s?.ID}]),onClick:b=>o.paymentSystem={id:s?.ID,type:s?.Source}},[t("img",{class:"list-item__image",src:s?.Image},null,8,nt),t("div",it,S(s?.Description),1)],10,ot)):A("",!0)],64))),128))])):A("",!0)]),t("div",at,[e[6]||(e[6]=t("div",{class:"list-item__title"},"Сумма пополнения",-1)),t("div",lt,[e[4]||(e[4]=t("div",{class:"list-form_col list-form_col--sm"},"Пополнить на сумму",-1)),t("div",rt,[t("div",ct,[f(c,{type:"text",mask:Number,placeholder:"100 ₽",modelValue:o.inputValue,"onUpdate:modelValue":e[0]||(e[0]=s=>o.inputValue=s)},null,8,["modelValue"])])])]),t("div",mt,[e[5]||(e[5]=t("div",{class:"list-form_col list-form_col--sm"},null,-1)),t("div",dt,[f(m,{"is-loading":o.isLoading,label:"Пополнить баланс",onClick:e[1]||(e[1]=s=>o.sendInvoice())},null,8,["is-loading"])])])])])):(a(),j(d,{key:1,label:"Договор не найден"}))])])],64)}const Bt=Q(W,[["render",ut],["__scopeId","data-v-d5b5813c"]]);export{Bt as default};
