import{j as M,o as P,c as w,b as p,a as o,w as r,t as n,F as U,n as E,k as O,y as T,p as R,l as j,_ as Z,a7 as q,e as z,r as m,i as G,g as b}from"./index-4466e2da.js";import{u as H}from"./postings-8cf94dee.js";import{u as J}from"./contracts-44396072.js";import{s as K}from"./multiselect-a1f1bb25.js";import{a as Q,f as W}from"./useTimeFunction-8602dd60.js";import{B as S}from"./BlockBalanceAgreement-762408e5.js";import{E as X}from"./EmptyStateBlock-1f67284f.js";import{C as Y,F as $}from"./bootstrap-vue-next.es-61f2820f.js";import{_ as ee}from"./FormInputSearch-671230ef.js";import{_ as te}from"./ClausesKeeper-f5a8709e.js";import"./ButtonDefault-18fa1414.js";import"./IconArrow-1085f1dc.js";import"./IconPlus-fcf0b45d.js";import"./IconSearch-2aa1e8a5.js";import"./IconClose-96271d50.js";const se=[{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"ServiceID",label:"Операция"},{key:"Comment",label:"Примечание"},{key:"Before",variant:"td-gray td-order",label:"До"},{key:"After",variant:"td-gray td-order",label:"После"},{key:"Change",variant:"td-gray td-order",label:"Сумма",sortable:!0}],u=i=>(R("data-v-49f2fb5b"),i=i(),j(),i),oe={class:"section"},ae={class:"container"},ne={class:"section-header"},le={class:"list-form"},re={class:"list-form_col list-form_col--sm"},ce={class:"list-form_select"},ie={class:"multiselect-option"},de=u(()=>o("span",{class:"td-mobile"},"Дата Создания",-1)),me={class:"d-block"},ue=u(()=>o("span",{class:"td-mobile"},"Договор",-1)),_e=u(()=>o("span",{class:"td-mobile"},"До",-1)),pe={class:"d-block"},fe=u(()=>o("span",{class:"td-mobile"},"После",-1)),ge={class:"d-block"},ve=u(()=>o("span",{class:"td-mobile"},"Операция",-1)),be=u(()=>o("span",{class:"td-mobile"},"Сумма",-1)),Ce={key:0,class:"table-controls"},he=u(()=>o("span",{class:"text-success"},"First",-1)),ye=u(()=>o("span",{class:"text-info"},"Last",-1)),De={class:"multiselect-multiple-label"},ke={class:"multiselect-option"};function Pe(i,t,N,s,C,f){var D,v;const h=S,I=te,y=M("Multiselect"),B=ee,L=Y,V=$,g=X;return P(),w(U,null,[p(h),o("div",oe,[o("div",ae,[o("div",ne,[o("h1",{class:"section-title",onClick:t[0]||(t[0]=e=>s.reloadNow())},"История операций")]),p(I),o("div",le,[o("div",re,[o("div",ce,[p(y,{modelValue:s.select,"onUpdate:modelValue":t[1]||(t[1]=e=>s.select=e),options:s.getUsers,disabled:((D=s.getUsers)==null?void 0:D.length)<=1,label:"name","track-by":"value"},{singlelabel:r(({value:e})=>[o("span",null,"# "+n(e.value.padStart(5,"0"))+" / "+n(e.name),1)]),option:r(({option:e})=>[o("div",ie,"# "+n(e.value.padStart(5,"0"))+" / "+n(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),p(B,{modelValue:s.search,"onUpdate:modelValue":t[2]||(t[2]=e=>s.search=e)},null,8,["modelValue"])]),s.getPostings&&((v=s.getPostings)==null?void 0:v.length)>0?(P(),w(U,{key:0},[p(L,{class:"basic-table",items:s.getPostings.filter(e=>e.ContractID.includes(s.select!=="*"?s.select:"")),fields:s.postingsFields,"show-empty":!0,filter:s.search,"per-page":s.perPage,"current-page":s.currentPage,filterable:["Customer","Comment"],"sort-by":s.sortBy,"onUpdate:sortBy":t[3]||(t[3]=e=>s.sortBy=e),"sort-desc":s.sortDesc,"onUpdate:sortDesc":t[4]||(t[4]=e=>s.sortDesc=e),"sort-direction":s.sortDirection,"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Операций пока нет.","empty-filtered-text":"Операции не найдены.",onFiltered:s.setPageToZero},{"cell(CreateDate)":r(e=>{var c;return[de,o("span",me,n(s.formNormalDate(s.secondToDate((c=e.item)==null?void 0:c.CreateDate))),1)]}),"cell(ContractID)":r(e=>{var c,d;return[ue,o("span",null,"#"+n((c=e.item)==null?void 0:c.ContractID)+" / "+n((d=e.item)==null?void 0:d.Customer),1)]}),"cell(Before)":r(e=>[_e,o("span",pe,n(e.value),1)]),"cell(After)":r(e=>[fe,o("span",ge,n(e.value),1)]),"cell(ServiceID)":r(e=>{var c,d,k;return[ve,o("span",null,n((k=(d=s.getServices)==null?void 0:d[(c=e.item)==null?void 0:c.ServiceID])==null?void 0:k.Name),1)]}),"cell(Change)":r(e=>[be,o("span",{class:E(["d-block",{positive:e.value>0,negative:e.value<0}])},n(e.value>0?`+${e.value}`:e.value)+" ₽",3)]),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),s.filteredContractsLength>0?(P(),w("div",Ce,[p(V,{modelValue:s.currentPage,"onUpdate:modelValue":t[5]||(t[5]=e=>s.currentPage=e),"total-rows":s.filteredContractsLength,"per-page":s.perPage,"first-number":"","last-number":""},{"first-text":r(()=>[he]),"last-text":r(()=>[ye]),page:r(({page:e,active:c})=>[o("span",null,n((e-1)*s.perPage+1)+"-"+n(e*s.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),p(y,{class:"multiselect--white",modelValue:s.perPage,"onUpdate:modelValue":t[6]||(t[6]=e=>s.perPage=e),options:s.pageOptions,label:"name",openDirection:"top",onInput:t[7]||(t[7]=e=>s.currentPage=1)},{singlelabel:r(({value:e})=>[o("div",De,[o("span",null,"Отображать "+n(e.value)+" строк",1)])]),option:r(({option:e})=>[o("div",ke,"Отображать "+n(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):O("",!0)],64)):(P(),T(g,{key:1,label:"Ваша история операций пуста"}))])])],64)}const Ie={components:{Multiselect:K,BlockBalanceAgreement:S},async setup(){const i=J(),t=H(),N=q(),s=z(),C=m(""),f=m("*"),h=m(1),I=m(10),y=m([10,25,50,100]),B=m("CreateDate"),L=m(!0),V=m("desc");G(async()=>{await i.fetchContracts(),await t.fetchPostings(),await t.fetchServices();const a=N.query.ContractID;a&&(f.value=a||"*")});const g=b(()=>Object.keys(t==null?void 0:t.postingsList).map(a=>{var l,_,x,F;return{...t==null?void 0:t.postingsList[a],Customer:(_=(l=v.value)==null?void 0:l[t==null?void 0:t.postingsList[a].ContractID])==null?void 0:_.Customer,Change:d((x=t==null?void 0:t.postingsList[a])==null?void 0:x.Before,(F=t==null?void 0:t.postingsList[a])==null?void 0:F.After)}})),D=b(()=>t==null?void 0:t.servicesList),v=b(()=>i.contractsList),e=b(()=>{let a=[];return g.value.map(l=>{if(!a.find(_=>_===l.Customer))return a.push(l.Customer),{value:l.ContractID,name:l.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),c=b(()=>g.value.filter(a=>{var l,_;return a.Comment.toLowerCase().includes((l=C.value)==null?void 0:l.toLowerCase())||a.Customer.toLowerCase().includes((_=C.value)==null?void 0:_.toLowerCase())}).filter(a=>a.ContractID.includes(f.value!=="*"?f.value:"")).length);function d(a,l){return l-a>0,Number(Math.round((l-a+Number.EPSILON)*100)/100)}function k(){s.go(0)}function A(){h.value=1}return await i.fetchContracts(),await t.fetchPostings(),await t.fetchServices(),{search:C,select:f,getContracts:v,getUsers:e,getPostings:g,getServices:D,currentPage:h,perPage:I,sortBy:B,sortDesc:L,sortDirection:V,pageOptions:y,filteredContractsLength:c,postingsFields:se,setPageToZero:A,secondToDate:Q,formNormalDate:W,calculateChange:d,reloadNow:k}}},je=Z(Ie,[["render",Pe],["__scopeId","data-v-49f2fb5b"]]);export{je as default};
