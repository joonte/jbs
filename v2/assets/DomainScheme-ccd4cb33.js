import{j as q,o as W,c as z,b,a as e,w as V,t as D,Z as v,a9 as w,af as O,d as J,F as Q,p as X,l as Y,_ as $,e as ee,a7 as se,r as I,g as p,i as U,O as oe,h as te}from"./index-90eb49f0.js";import{u as ae}from"./domain-589159b1.js";import{u as le}from"./contracts-0cbe8270.js";import{u as ne}from"./hosting-606725d4.js";import{u as ce}from"./resetServer-5aa8ad31.js";import{D as P}from"./DomainCheckBlock-d4d732a5.js";import{_ as T}from"./BlockSelectContract-5c8bdad1.js";import{B as F}from"./BlockBalanceAgreement-267acfcf.js";import{s as ie}from"./multiselect-e18abfd5.js";import{_ as re}from"./ButtonDefault-5aebc1f7.js";import{_ as de}from"./ClausesKeeper-313482ce.js";import"./EmptyStateBlock-2d70ce64.js";import"./bootstrap-vue-next.es-788a757a.js";import"./IconClose-c838a5bc.js";import"./IconArrow-380053a0.js";const n=a=>(X("data-v-49d8f0ec"),a=a(),Y(),a),me={class:"domain-scheme"},_e={class:"section"},ue={class:"container"},he=n(()=>e("div",{class:"section-header"},[e("h1",{class:"section-title"},"Заказ доменного имени")],-1)),fe={class:"section"},ve={class:"container"},pe=n(()=>e("div",{class:"section-header"},[e("h2",{class:"section-block_title"},"Заказ хостинга"),e("div",{class:"section-label"},"Если домен будет использоваться совместно с заказом хостинга, выберите нужный из существующего списка")],-1)),Ne={class:"form multy"},De={class:"multi-top"},ge={class:"multiselect-option"},be={class:"section"},Se={class:"container"},ke=n(()=>e("div",{class:"section-header"},[e("div",{class:"section-label"},"Для успешной регистрации, домен должен быть настроен на используемых именных серверах. Для этого в панели управления хостингом необходимо добавить домен, как дополнительный или паркованный.")],-1)),ye={class:"form form-grid-columns"},Ie={class:"form-col"},we=n(()=>e("div",{class:"form-col__title"},"Первичный сервер имен",-1)),Oe={class:"form-field"},xe=n(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),Ce=n(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),Be={class:"form-col"},Ee=n(()=>e("div",{class:"form-col__title"},"Вторичный сервер имен",-1)),Le={class:"form-field"},Ve=n(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),He=n(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),Re={class:"form-col"},Ue=n(()=>e("div",{class:"form-col__title"},"Дополнительный сервер имен",-1)),Pe={class:"form-field"},Te=n(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),Fe=n(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),je={class:"form-col"},Me=n(()=>e("div",{class:"form-col__title"},"Расширенный сервер имен",-1)),Ae={class:"form-field"},Ge=n(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),Ke=n(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),Ze={class:"section"},qe={class:"container"},We={class:"total-block"},ze={class:"total-block__row total-block__row--big"},Je=n(()=>e("div",{class:"total-block__col"},"Итого за 12 месяцев",-1)),Qe={class:"total-block__col"};function Xe(a,l,c,s,x,j){var f;const C=F,S=de,h=T,g=P,k=q("Multiselect"),m=re;return W(),z(Q,null,[b(C),e("div",me,[e("div",_e,[e("div",ue,[he,b(S)])]),b(h,{title:"Договор",modelValue:s.contractSelect,"onUpdate:modelValue":l[0]||(l[0]=o=>s.contractSelect=o)},null,8,["modelValue"]),b(g,{"domain-list":s.getDomains,search:s.search,onSelect:s.selectDomain},null,8,["domain-list","search","onSelect"]),e("div",fe,[e("div",ve,[pe,e("div",Ne,[b(k,{class:"hosting-select multiselect--white",modelValue:s.hostingSelect,"onUpdate:modelValue":l[1]||(l[1]=o=>s.hostingSelect=o),options:s.FILTERED_ORDERS,label:"login",placeholder:"Выберите хостинг","track-by":"value"},{singlelabel:V(({value:o})=>{var _,N;return[e("div",De,D(o.login),1),v(e("span",{class:"server"},"/ "+D((_=s.getHostingSchemes[o.schemeID])==null?void 0:_.Name),513),[[w,(N=s.getHostingSchemes[o.schemeID])==null?void 0:N.Name]]),v(e("span",{class:"domain"},"/ "+D(o.domain),513),[[w,o.domain]])]}),option:V(({option:o})=>{var _,N;return[e("div",ge,D(o.login),1),v(e("span",{class:"server"},"/ "+D((_=s.getHostingSchemes[o.schemeID])==null?void 0:_.Name),513),[[w,(N=s.getHostingSchemes[o.schemeID])==null?void 0:N.Name]]),v(e("span",{class:"domain"},"/ "+D(o.domain),513),[[w,o.domain]])]}),_:1},8,["modelValue","options"])])])]),e("div",be,[e("div",Se,[ke,e("div",ye,[e("div",Ie,[we,e("label",Oe,[xe,v(e("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":l[2]||(l[2]=o=>s.formData.Ns1Name=o)},null,512),[[O,s.formData.Ns1Name]])]),Ce]),e("div",Be,[Ee,e("label",Le,[Ve,v(e("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":l[3]||(l[3]=o=>s.formData.Ns2Name=o)},null,512),[[O,s.formData.Ns2Name]])]),He]),e("div",Re,[Ue,e("label",Pe,[Te,v(e("input",{type:"text","onUpdate:modelValue":l[4]||(l[4]=o=>s.formData.Ns3Name=o)},null,512),[[O,s.formData.Ns3Name]])]),Fe]),e("div",je,[Me,e("label",Ae,[Ge,v(e("input",{type:"text","onUpdate:modelValue":l[5]||(l[5]=o=>s.formData.Ns4Name=o)},null,512),[[O,s.formData.Ns4Name]])]),Ke])])])]),e("div",Ze,[e("div",qe,[e("div",We,[e("div",ze,[Je,e("div",Qe,D(s.domains.length?s.domains.reduce((o,_)=>o+parseFloat(_.CostOrder),0):"0")+" ₽",1)])]),b(m,{class:"btn--wide",label:((f=s.getContracts[s.contractSelect])==null?void 0:f.Balance)>(s.domains.length?s.domains.reduce((o,_)=>o+parseFloat(_.CostOrder),0):0)?"Оплатить c баланса договора":"Добавить в корзину",onClick:l[6]||(l[6]=o=>s.createDomain()),"is-loading":s.isLoading,disabled:s.domains.length===0},{default:V(()=>[J("Добавить в корзину")]),_:1},8,["label","is-loading","disabled"])])])])],64)}const Ye={components:{BlockSelectContract:T,DomainCheckBlock:P,BlockBalanceAgreement:F,Multiselect:ie},async setup(){const a=ae(),l=le(),c=ne(),s=ce(),x=ee(),C=se().query.DomainName||"",S=I(null),h=I([]),g=I(null),k=I(!1),m=I({Ns1Name:"dns0.host-food.ru",Ns2Name:"dns1.host-food.ru",Ns3Name:null,Ns4Name:null}),f=p(()=>l.contractsList),o=t=>{t.key==="Enter"&&t.ctrlKey&&!_.value&&R()},_=p(()=>h.value.length===0);U(()=>{document.addEventListener("keyup",o),console.log(E)}),oe(()=>{document.removeEventListener("keyup",o)});const N=p(()=>{var t;return(t=Object.keys(a==null?void 0:a.domainSchemes))==null?void 0:t.map(i=>{var r;return{...a==null?void 0:a.domainSchemes[i],value:(r=a==null?void 0:a.domainSchemes[i])==null?void 0:r.ID}})}),M=p(()=>c==null?void 0:c.hostingSchemes),H=p(()=>Object.keys(c==null?void 0:c.hostingList).map(t=>c==null?void 0:c.hostingList[t])),B=p(()=>c==null?void 0:c.hostingList),E=p(()=>{const t=Object.keys(B.value).map(i=>{const r=B.value[i];return{value:r.ID,login:r.Login,customer:r.Customer,domain:r.Domain,schemeID:r.SchemeID}});return t.unshift({value:0,login:"Без хостинга",customer:"",domain:""}),t}),A=p(()=>{var t;return(t=s==null?void 0:s.serverGroupsList)==null?void 0:t.Servers});te(()=>g.value,t=>{const i=H.value.find(r=>r.ID===t);i?(m.value.Ns1Name=i.Ns1Name,m.value.Ns2Name=i.Ns2Name,m.value.Ns3Name=i.Ns3Name,m.value.Ns4Name=i.Ns4Name):(m.value.Ns1Name="dns0.host-food.ru",m.value.Ns2Name="dns1.host-food.ru",m.value.Ns3Name=null,m.value.Ns4Name=null)});async function R(){k.value=!0;let t=0;const i=[],r=()=>{if(t<h.value.length){const d=h.value[t];a.DomainOrder({ContractID:S.value,Domain:`${d.line}${d.line&&d.Name?"."+d.Name:""}`,DomainName:d.line,DomainSchemeID:d.value,DomainZone:d.Name,IsPrivateWhoIs:"yes",HostingOrderID:g.value,...m.value}).then(({result:u,info:y,error:L})=>{if(u==="SUCCESS")return a.DomainOrderPay({DomainOrderID:y==null?void 0:y.DomainOrderID});throw new Error(L)}).then(u=>{let{result:y,error:L}=u;i.push({result:y,error:L})}).catch(u=>{console.error("An error occurred:",u),i.push({result:"ERROR",error:u})}).finally(()=>{t++,setTimeout(r,1e3)})}else k.value=!1};r(),await new Promise(d=>{const u=()=>{t===h.value.length?d():setTimeout(u,100)};u()});const K=i.some(d=>d.result==="BASKET"),Z=i.every(d=>d.result==="SUCCESS");K?x.push("/Basket"):Z&&x.push("/DomainOrders")}function G(t){h.value=t}return U(()=>{B.value&&(g.value=E.value[0].value)}),await a.fetchDomainSchemes(),await l.fetchContracts().then(()=>{var t;f.value&&(S.value=(t=Object.keys(f==null?void 0:f.value))==null?void 0:t[0])}),await c.fetchHostingOrders(),await c.fetchHostingSchemes(),await s.fetchServerGroups(),{contractSelect:S,selectDomain:G,domains:h,hostingSelect:g,getDomains:N,getContracts:f,getHostingOrders:H,getServerGroup:A,formData:m,isLoading:k,createDomain:R,buttonDisabled:_,FILTERED_ORDERS:E,getHostingSchemes:M,search:C}}},hs=$(Ye,[["render",Xe],["__scopeId","data-v-49d8f0ec"]]);export{hs as default};
