import{E as ve}from"./EmptyStateBlock-1f3845f9.js";import{_ as me}from"./BlockOrderPayBalance-6e862c0f.js";import{_ as pe}from"./ClausesKeeper-4fcca336.js";import{_ as he}from"./ButtonDefault-7f62b822.js";import{_ as be,f as ye,e as ge,U as ke,r as p,h as B,i as fe,P as De,ah as C,o as r,c as _,b as d,a as e,t as c,F as I,y as Be,l as Ie,Z as ie,aa as re,p as we,m as Pe}from"./index-777dc609.js";import{u as Ce}from"./hosting-d8f271af.js";import{u as Se}from"./IconArrow-1d7911e1.js";import{_ as Ee}from"./paramsAccordionBlock-5a07994d.js";import{B as He}from"./BlockBalanceAgreement-d9b1b07a.js";import"./bootstrap-vue-next.es-8d4e1458.js";import"./IconHelp-39243eed.js";import"./globalActions-a63f697e.js";import"./component-6aa3a5f3.js";import"./IconClose-166e70a9.js";/* empty css                                                                             */const S=y=>(we("data-v-344208ee"),y=y(),Pe(),y),Oe={key:0,class:"hosting-sheme"},xe={class:"section"},Le={class:"container"},Fe={class:"section-header"},Ne={class:"section-header__wrapper"},Re={class:"section-title"},Ue={class:"section-container"},$e={class:"section-label __login"},Ae=S(()=>e("div",{class:"section-label __login"},"/",-1)),Ke={class:"section-label __login"},Te={class:"section"},Ve={class:"container"},je={class:"total-block"},Me={class:"total-block__row divider-bottom"},Ze=S(()=>e("div",{class:"total-block__col"},"Цена тарифа",-1)),qe={class:"total-block__col"},ze={class:"total-block__row no-divider"},Ge={class:"total-block__col"},Je={class:"total-block__col"},Qe={class:"total-block__row total-block__row--big economy-line"},We=S(()=>e("div",{class:"total-block__col red"},"Выгода",-1)),Xe={class:"total-block__col flex-col"},Ye={class:"red"},es={class:"total-block__row total-block__row--big"},ss={class:"total-block__col"},os={class:"total-block__col"},ts={key:1,class:"section"},as={class:"container"},ls={key:1,class:"section"},ns={class:"container"},cs={__name:"HostingProlong",async setup(y){let u,v;const l=Ce(),E=Se(),_e=ye(),H=ge();ke("emitter");const g=p(!1);p(null),p(null),p("");const o=p(null),k=p(!1),n=B(()=>Object.keys(l==null?void 0:l.hostingList).map(s=>l==null?void 0:l.hostingList[s]).find(s=>s.OrderID===_e.params.id)),m=B(()=>{var s,t;return(t=l==null?void 0:l.hostingSchemes)==null?void 0:t[(s=n.value)==null?void 0:s.SchemeID]}),O=B(()=>E.contractsList);function f(s){return Number(s).toFixed(2)||0}function x(){var t,i;let s=0;return(i=(t=o.value)==null?void 0:t.discounts)==null||i.Bonuses.map(h=>{s+=+h.Economy}),s}function w(){var s,t,i;k.value=!0,l.HostingOrderPay({HostingOrderID:(s=n.value)==null?void 0:s.ID,DaysPayFromBallance:((t=o.value)==null?void 0:t.daysFromBalance)||0,DaysPay:(i=o.value)==null?void 0:i.actualDays,IsChange:!0}).then(h=>{var b;let{result:D,error:P}=h;D==="SUCCESS"?H.push(`/HostingOrders/${(b=n.value)==null?void 0:b.OrderID}`):D==="BASKET"&&H.push("/Basket"),k.value=!1})}const L=s=>{s.key==="Enter"&&s.ctrlKey&&!de.value&&w()},de=B(()=>o.value===null);fe(()=>{document.addEventListener("keyup",L),console.log(n,"fixed")}),De(()=>{document.removeEventListener("keyup",L)});function ue(s){o.value=s}return[u,v]=C(()=>l.fetchHostingOrders()),await u,v(),[u,v]=C(()=>l.fetchHostingSchemes()),await u,v(),[u,v]=C(()=>E.fetchContracts()),await u,v(),(s,t)=>{var b,F,N,R,U,$,A,K,T,V,j,M,Z,q,z,G,J,Q,W,X,Y,ee,se,oe,te,ae,le,ne,ce;const i=he,h=pe,D=me,P=ve;return r(),_(I,null,[d(He),n.value?(r(),_("div",Oe,[e("div",xe,[e("div",Le,[e("div",Fe,[e("div",Ne,[e("h1",Re,c((b=n.value)==null?void 0:b.Domain),1),d(i,{class:"btn--wide",label:g.value||((F=O.value[n.value.ContractID])==null?void 0:F.Balance)>((N=o.value)==null?void 0:N.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||((R=o.value)==null?void 0:R.price)===null,"is-loading":k.value,onClick:t[0]||(t[0]=a=>w())},null,8,["label","disabled","is-loading"])]),e("div",Ue,[e("div",$e,"Логин: "+c((U=n.value)==null?void 0:U.Login),1),Ae,e("div",Ke,"Тариф: "+c(($=m.value)==null?void 0:$.Name),1)])]),d(h)])]),d(Ee,{"params-list":(A=m.value)==null?void 0:A.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),(K=m.value)!=null&&K.IsPayed&&((T=m.value)!=null&&T.IsProlong)||!((V=m.value)!=null&&V.IsPayed)?(r(),_(I,{key:0},[d(D,{contractID:(j=n.value)==null?void 0:j.ContractID,daysRemainded:(M=n.value)==null?void 0:M.DaysRemainded,scheme:m.value,orderID:(Z=n.value)==null?void 0:Z.OrderID,isOrderID:!0,onSelect:ue,isBalancePay:g.value,"onUpdate:isBalancePay":t[1]||(t[1]=a=>g.value=a)},null,8,["contractID","daysRemainded","scheme","orderID","isBalancePay"]),e("div",Te,[e("div",Ve,[e("div",je,[((G=(z=(q=o.value)==null?void 0:q.discounts)==null?void 0:z.Bonuses)==null?void 0:G.length)>0?(r(),_(I,{key:0},[e("div",Me,[Ze,e("div",qe,c(f((J=o.value)==null?void 0:J.price))+" ₽",1)]),(r(!0),_(I,null,Be((W=(Q=o.value)==null?void 0:Q.discounts)==null?void 0:W.Bonuses,a=>(r(),_("div",ze,[e("div",Ge,"Скидка "+c(a==null?void 0:a.Discount)+"% на "+c(a==null?void 0:a.Days)+" дней",1),e("div",Je,"-"+c(f(a==null?void 0:a.Economy))+" ₽",1)]))),256))],64)):Ie("",!0),ie(e("div",Qe,[We,e("div",Xe,[e("span",null,[e("s",null,c(f((X=o.value)==null?void 0:X.price))+" ₽",1)]),e("span",Ye,"-"+c(x())+" ₽",1)])],512),[[re,((se=(ee=(Y=o.value)==null?void 0:Y.discounts)==null?void 0:ee.Bonuses)==null?void 0:se.length)>0]]),ie(e("div",es,[e("div",ss,"Итого за "+c((oe=o.value)==null?void 0:oe.label),1),e("div",os,c(f(((te=o.value)==null?void 0:te.price)-x()))+" ₽",1)],512),[[re,(ae=o.value)==null?void 0:ae.price]])]),d(i,{class:"btn--wide",label:g.value||((le=O.value[n.value.ContractID])==null?void 0:le.Balance)>((ne=o.value)==null?void 0:ne.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||((ce=o.value)==null?void 0:ce.price)===null,"is-loading":k.value,onClick:t[2]||(t[2]=a=>w())},null,8,["label","disabled","is-loading"])])])],64)):(r(),_("div",ts,[e("div",as,[d(P,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),_("div",ls,[e("div",ns,[d(P,{label:"не удалось найти заказ хостинга"})])]))],64)}}},Bs=be(cs,[["__scopeId","data-v-344208ee"]]);export{Bs as default};
