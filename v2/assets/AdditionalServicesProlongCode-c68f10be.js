import{E as ne}from"./EmptyStateBlock-cd0c2748.js";import{_ as ie}from"./BlockOrderPayBalance-c29bc7b2.js";import{_ as re}from"./ClausesKeeper-3a1c11ba.js";import{_ as de}from"./ButtonDefault-0006f72a.js";import{_ as _e,a7 as ue,e as ve,r as ee,g as B,i as oe,O as pe,ag as P,o as r,c as d,b as _,a as o,t as i,F as C,x as me,Z as te,ae as se,k as he,p as ke,l as be}from"./index-b5b5ce3d.js";import{u as ye}from"./contracts-74f05bb7.js";import{u as Se}from"./services-18148891.js";/* empty css                                                                             */import{B as fe}from"./BlockBalanceAgreement-a016b94f.js";import"./bootstrap-vue-next.es-37aa63ea.js";import"./IconHelp-12aa8ba1.js";import"./globalActions-6936f67f.js";import"./BasicInput-a3395017.js";import"./component-2368399e.js";import"./IconClose-cd6d3917.js";import"./IconArrow-fddabae2.js";const ae=y=>(ke("data-v-166f6d3d"),y=y(),be(),y),Ie={key:0,class:"hosting-sheme"},we={class:"section"},ge={class:"container"},De={class:"section-header"},Be={class:"section-header__wrapper"},Pe={class:"section-title"},Ce={class:"section-label"},Oe={key:0,class:"section"},Ee={class:"container"},xe={class:"total-block"},Ne={class:"total-block__row divider-bottom"},Ae=ae(()=>o("div",{class:"total-block__col"},"Цена тарифа",-1)),Le={class:"total-block__col"},Fe={class:"total-block__row no-divider"},Re={class:"total-block__col"},Ue={class:"total-block__col"},Me={class:"total-block__row total-block__row--big economy-line"},Ve=ae(()=>o("div",{class:"total-block__col red"},"Выгода",-1)),$e={class:"total-block__col flex-col"},je={class:"red"},Ke={class:"total-block__row total-block__row--big"},Te={class:"total-block__col"},qe={class:"total-block__col"},Ze={key:1,class:"section"},ze={class:"container"},Ge={key:1,class:"section"},He={class:"container"},Je={__name:"AdditionalServicesProlongCode",async setup(y){let u,v;const O=ye(),a=Se(),le=ue(),E=ve(),t=ee(null),S=ee(!1),c=B(()=>Object.keys(a==null?void 0:a.ISPswOrdersList).map(s=>a==null?void 0:a.ISPswOrdersList[s]).find(s=>s.OrderID===le.params.id)),x=s=>{s.key==="Enter"&&s.ctrlKey&&D()};oe(()=>{document.addEventListener("keyup",x)}),pe(()=>{document.removeEventListener("keyup",x)});const f=B(()=>{var s;return(s=a==null?void 0:a.additionalServicesScheme)!=null&&s.ISPsw?Object.keys(a.additionalServicesScheme.ISPsw).map(l=>{const e=a.additionalServicesScheme.ISPsw[l];return{...e,value:e==null?void 0:e.ID,name:e==null?void 0:e.Name,cost:e==null?void 0:e.CostDay,month:e==null?void 0:e.CostMonth}}).filter(l=>{var e;return(l==null?void 0:l.ID)==((e=c.value)==null?void 0:e.SchemeID)}):[]}),g=B(()=>O.contractsList);function D(){var p,w,m,h,k;S.value=!0;const s=((p=g.value[c.ContractID])==null?void 0:p.Balance)>((w=t==null?void 0:t.value)==null?void 0:w.price)||((m=f.value[0])==null?void 0:m.cost)==="0.00"&&((h=f.value[0])==null?void 0:h.month)==="0.00",l=!s,e={ISPswOrderID:c.value.ID,DaysPay:(k=t.value)==null?void 0:k.actualDays,IsNoBasket:s,IsUseBasket:l,PayMessage:""};a.ISPswOrderPay(e).then(b=>{b==="UseBasket"?E.push("/Basket"):b==="NoBasket"?E.push("/AdditionalServices"):console.error("Ошибка оплаты заказа"),S.value=!0})}function I(s){return Number(s).toFixed(2)||0}function N(){var l,e;let s=0;return(e=(l=t.value)==null?void 0:l.discounts)==null||e.Bonuses.map(p=>{s+=+p.Economy}),s}function ce(s){t.value=s}return oe(()=>{a.fetchAdditionalServiceScheme("ISPsw")}),[u,v]=P(()=>a.fetchISPswOrders()),await u,v(),[u,v]=P(()=>a.fetchAdditionalServiceScheme("ISPsw")),await u,v(),[u,v]=P(()=>O.fetchContracts()),await u,v(),(s,l)=>{var h,k,b,A,L,F,R,U,M,V,$,j,K,T,q,Z,z,G,H,J,Q,W,X,Y;const e=de,p=re,w=ie,m=ne;return r(),d(C,null,[_(fe),c.value?(r(),d("div",Ie,[o("div",we,[o("div",ge,[o("div",De,[o("div",Be,[o("h1",Pe,"Оплата заказа ПО ISPsystem, "+i(((h=c.value)==null?void 0:h.IP)||""),1),_(e,{class:"btn--wide",label:((k=g.value[c.value.ContractID])==null?void 0:k.Balance)>((b=t.value)==null?void 0:b.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||((A=t.value)==null?void 0:A.price)===null,"is-loading":S.value,onClick:l[0]||(l[0]=n=>D())},null,8,["label","disabled","is-loading"])]),o("div",Ce,i((L=f.value[0])==null?void 0:L.Name),1)])]),_(p)]),_(w,{contractID:(F=c.value)==null?void 0:F.ContractID,daysRemainded:(R=c.value)==null?void 0:R.DaysRemainded,serviceID:"51000",scheme:f.value[0],orderID:(U=c.value)==null?void 0:U.OrderID,isOrderID:!0,onSelect:ce},null,8,["contractID","daysRemainded","scheme","orderID"]),c.value?(r(),d("div",Oe,[o("div",Ee,[o("div",xe,[(($=(V=(M=t.value)==null?void 0:M.discounts)==null?void 0:V.Bonuses)==null?void 0:$.length)>0?(r(),d(C,{key:0},[o("div",Ne,[Ae,o("div",Le,i(I((j=t.value)==null?void 0:j.price))+" ₽",1)]),(r(!0),d(C,null,me((T=(K=t.value)==null?void 0:K.discounts)==null?void 0:T.Bonuses,n=>(r(),d("div",Fe,[o("div",Re,"Скидка "+i(n==null?void 0:n.Discount)+"% на "+i(n==null?void 0:n.Days)+" дней",1),o("div",Ue,"-"+i(I(n==null?void 0:n.Economy))+" ₽",1)]))),256)),te(o("div",Me,[Ve,o("div",$e,[o("span",null,[o("s",null,i(I((q=t.value)==null?void 0:q.price))+" ₽",1)]),o("span",je,"-"+i(N())+" ₽",1)])],512),[[se,((G=(z=(Z=t.value)==null?void 0:Z.discounts)==null?void 0:z.Bonuses)==null?void 0:G.length)>0]])],64)):he("",!0),te(o("div",Ke,[o("div",Te,"Итого за "+i((H=t.value)==null?void 0:H.label),1),o("div",qe,i(I(((J=t.value)==null?void 0:J.price)-N()))+" ₽",1)],512),[[se,(Q=t.value)==null?void 0:Q.price]])]),_(e,{class:"btn--wide",label:((W=g.value[c.value.ContractID])==null?void 0:W.Balance)>((X=t.value)==null?void 0:X.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||((Y=t.value)==null?void 0:Y.price)===null,"is-loading":S.value,onClick:l[1]||(l[1]=n=>D())},null,8,["label","disabled","is-loading"])])])):(r(),d("div",Ze,[o("div",ze,[_(m,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),d("div",Ge,[o("div",He,[_(m,{label:"не удалось найти заказ хостинга"})])]))],64)}}},vo=_e(Je,[["__scopeId","data-v-166f6d3d"]]);export{vo as default};
