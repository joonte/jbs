import{_ as Z}from"./FormInputSearch-6ae97e00.js";import{_ as ee}from"./ClausesKeeper-db215214.js";import{_ as te}from"./ButtonDefault-cdd68300.js";import{_ as F,o as I,c as E,b as l,a as t,m as se,r as g,h as M,w as a,t as v,L,k as Y,p as j,l as q,e as G,u as J,g as P,i as oe,j as ae,ao as K,x as A,d as V,R as ne,a7 as le,ag as H,F as re}from"./index-7c70979b.js";import{u as z}from"./contracts-6e790117.js";import{S as ce}from"./SlotPageTitle-78d27acf.js";import{F as _e}from"./FormTabs-6acd61d1.js";import{F as ie,z as ue,d as pe,C as Q}from"./bootstrap-vue-next.es-44836407.js";import{_ as de}from"./IconDots-287ffdeb.js";import{f as me,a as ve}from"./useTimeFunction-8602dd60.js";import{_ as fe}from"./IconCard-b77c66c4.js";import{s as be}from"./multiselect-42ffb1f2.js";import{S as ge}from"./StatusBadge-d1ca4bcf.js";import{B as ye}from"./BlockBalanceAgreement-e7636133.js";import"./IconPlus-42ca604a.js";import"./IconSearch-c81d59de.js";import"./IconClose-358a4a84.js";import"./IconArrow-6bef9064.js";const Ce=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"Customer",label:"Договор"},{key:"TypeID",label:"Тип",variant:"td-gray td-order"},{key:"Orders",label:"Количество подключенных услуг",sortable:!0,variant:"td-gray td-order"},{key:"Balance",label:"Баланс",sortable:!0,variant:"td-gray td-order"},{key:"controls",label:"",variant:"td-controls"}];const he={class:"button-payment"},De={class:"button-payment__text"},Ie={__name:"FormButtonPayment",setup(c){return(d,u)=>(I(),E("button",he,[l(fe,{class:"button-payment__icon"}),t("span",De,[se(d.$slots,"default",{},void 0,!0)])]))}},ke=F(Ie,[["__scopeId","data-v-fcb8fa3c"]]);const W=c=>(j("data-v-64d83888"),c=c(),q(),c),Te={key:0,class:"table-controls"},$e=W(()=>t("span",{class:"text-success"},"First",-1)),Le=W(()=>t("span",{class:"text-info"},"Last",-1)),Pe={class:"multiselect-multiple-label"},we={class:"multiselect-option"},Se={__name:"PaginationBlock",props:["modelValue","total_rows"],emits:["update:modelValue","updatePage"],setup(c,{emit:d}){const u=c,i=[10,25,50,100],_=g({current_page:1,per_page:10});return M(_.value,()=>{d("updatePage",_.value)}),(h,f)=>{const k=ie;return u.total_rows>0?(I(),E("div",Te,[l(k,{modelValue:_.value.current_page,"onUpdate:modelValue":f[0]||(f[0]=s=>_.value.current_page=s),"total-rows":u.total_rows,"per-page":_.value.per_page,"first-number":"","last-number":""},{"first-text":a(()=>[$e]),"last-text":a(()=>[Le]),page:a(({page:s,active:y})=>[t("span",null,v((s-1)*_.value.per_page+1)+"-"+v(s*_.value.per_page),1)]),_:1},8,["modelValue","total-rows","per-page"]),l(L(be),{class:"multiselect--white",modelValue:_.value.per_page,"onUpdate:modelValue":f[1]||(f[1]=s=>_.value.per_page=s),options:i,label:"name",openDirection:"top",onInput:f[2]||(f[2]=s=>_.value.current_page=1)},{singlelabel:a(({value:s})=>[t("div",Pe,[t("span",null,"Отображать "+v(s.value)+" строк",1)])]),option:a(({option:s})=>[t("div",we,"Отображать "+v(s.name)+" строк",1)]),_:1},8,["modelValue"])])):Y("",!0)}}},X=F(Se,[["__scopeId","data-v-64d83888"]]);const S=c=>(j("data-v-04d3be30"),c=c(),q(),c),xe={class:"contracts-list"},Be=S(()=>t("span",{class:"td-mobile"},"Номер",-1)),Ne={class:"td-column-heavy"},Ve={class:"table-td-gray"},Fe=S(()=>t("span",{class:"td-mobile"},"Дата Создания",-1)),Ee={class:"d-block"},Re=S(()=>t("span",{class:"td-mobile"},"Договор",-1)),Ue={class:"td-column-heavy"},Oe={class:"table-td-blue"},Ae=S(()=>t("span",{class:"td-mobile"},"Тип договора",-1)),Me=S(()=>t("span",{class:"td-mobile"},"Баланс",-1)),je=S(()=>t("span",{class:"td-mobile"},"Количество подключенных услуг",-1)),qe={class:"btn__group"},Ge={class:"dropdown-button"},ze={class:"btn btn--dots"},He={__name:"ContractsList",props:{search:{type:String,default:""}},setup(c){const d=c,u=G(),i=z(),_=J(),h=g("CreateDate"),f=g(!0),k=g("desc"),s=g(10),y=g(1),T=P(()=>{var e,o;return(o=(e=Object.keys(i==null?void 0:i.contractsList))==null?void 0:e.map(p=>i==null?void 0:i.contractsList[p]))==null?void 0:o.reverse()}),$=P(()=>{var e,o;return(o=(e=_.ConfigList)==null?void 0:e.Contracts)==null?void 0:o.Types}),w=P(()=>{var e;return(e=T.value.filter(o=>{var p;return o.Customer.toLowerCase().includes(((p=d.search)==null?void 0:p.toLowerCase())||"")}))==null?void 0:e.length});function U(e){u.push(`/Balance/${e}`)}oe(()=>{});function D(e={}){s.value=e==null?void 0:e.per_page,y.value=e==null?void 0:e.current_page}function x(e){i==null||i.contractDownload({ContractID:e})}return M(()=>d,()=>{y.value=1}),(e,o)=>{const p=de,O=ae("router-link"),B=ue,m=pe,b=Q;return I(),E("div",xe,[l(b,{class:"basic-table",items:T.value,fields:L(Ce),"show-empty":!0,filterable:[],filter:d.search,"per-page":s.value,"sort-desc":f.value,"onUpdate:sortDesc":o[0]||(o[0]=n=>f.value=n),"sort-by":h.value,"onUpdate:sortBy":o[1]||(o[1]=n=>h.value=n),"sort-direction":k.value,"current-page":y.value,"empty-text":"У вас пока нет договоров.","empty-filtered-text":"Договора не найдены."},{"cell(ID)":a(n=>{var r;return[Be,t("div",Ne,[t("div",Ve,v(L(K).transformContractNumber((r=n.item)==null?void 0:r.ID)),1)])]}),"cell(CreateDate)":a(n=>{var r;return[Fe,t("span",Ee,v(L(me)(L(ve)((r=n.item)==null?void 0:r.CreateDate))),1)]}),"cell(Customer)":a(n=>{var r;return[Re,t("div",Ue,[t("div",Oe,v((r=n.item)==null?void 0:r.Customer),1)])]}),"cell(TypeID)":a(n=>{var r,C;return[Ae,t("span",null,v((C=$.value[(r=n.item)==null?void 0:r.TypeID])==null?void 0:C.Name),1)]}),"cell(Balance)":a(n=>{var r;return[Me,t("span",null,v((r=n.item)==null?void 0:r.Balance)+" ₽",1)]}),"cell(Orders)":a(n=>{var r;return[je,t("span",null,v((r=n.item)==null?void 0:r.Orders),1)]}),"cell(controls)":a(n=>{var r;return[t("div",qe,[((r=n.item)==null?void 0:r.TypeID)!="NaturalPartner"?(I(),A(ke,{key:0,onClick:C=>{var N;return U((N=n.item)==null?void 0:N.ID)}},{default:a(()=>[V("Пополнить баланс")]),_:2},1032,["onClick"])):Y("",!0),t("div",Ge,[l(m,{class:"dropdown-dots",right:""},{"button-content":a(()=>[t("div",ze,[l(p)])]),default:a(()=>[l(B,null,{default:a(()=>{var C;return[l(O,{to:`/ContractScheme/${(C=n.item)==null?void 0:C.ID}`},{default:a(()=>[V("Открыть")]),_:2},1032,["to"])]}),_:2},1024),l(B,null,{default:a(()=>{var C;return[l(O,{to:`/ContractSettings/${(C=n.item)==null?void 0:C.ID}`},{default:a(()=>[V("Изменить тип учёта")]),_:2},1032,["to"])]}),_:2},1024),l(B,{onClick:C=>{var N;return x((N=n.item)==null?void 0:N.ID)}},{default:a(()=>[V("Загрузить договор")]),_:2},1032,["onClick"])]),_:2},1024)])])]}),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(X,{total_rows:w.value,onUpdatePage:D},null,8,["total_rows"])])}}},Ye=F(He,[["__scopeId","data-v-04d3be30"]]),Je=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"Name",label:"Профиль",variant:"td-blue"},{key:"TemplateID",label:"Тип",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",sortable:!0,variant:"td-gray td-order"},{key:"StatusDate",label:"От статуса",sortable:!0,variant:"td-default td-order"}];const R=c=>(j("data-v-aab722c9"),c=c(),q(),c),Ke={class:"contracts-profile-list"},Qe=R(()=>t("span",{class:"td-mobile"},"Номер",-1)),We={class:"d-block"},Xe=R(()=>t("span",{class:"td-mobile"},"Номер",-1)),Ze=R(()=>t("span",{class:"td-mobile"},"От статуса",-1)),et={class:"d-block"},tt=R(()=>t("span",{class:"td-mobile"},"Тип",-1)),st=R(()=>t("span",{class:"td-mobile"},"Статус",-1)),ot={__name:"ContractsProfileList",props:["search"],setup(c){const d=c;G();const u=z(),i=J(),_=ne("emitter"),h=g("ID"),f=g(!0),k=g("desc"),s=g(10),y=g(1),T=P(()=>{var e,o;return(o=(e=Object==null?void 0:Object.keys(u==null?void 0:u.profileList))==null?void 0:e.map(p=>u==null?void 0:u.profileList[p]))==null?void 0:o.reverse()}),$=P(()=>{var e,o;return(o=(e=i.ConfigList)==null?void 0:e.Profiles)==null?void 0:o.Templates}),w=P(()=>{var e;return(e=T.value.filter(o=>{var p;return o.Name.toLowerCase().includes(((p=d.search)==null?void 0:p.toLowerCase())||"")}))==null?void 0:e.length});function U(e={}){s.value=e==null?void 0:e.per_page,y.value=e==null?void 0:e.current_page}function D(e){_.emit("open-modal",{component:"ProfileInfo",data:{data:e,template:$.value[e.TemplateID]}})}function x(e){return Math.floor((new Date().getTime()-e*1e3)/(1e3*60*60*24))}return(e,o)=>{const p=ge,O=Q,B=X;return I(),E("div",Ke,[l(O,{class:"basic-table",items:T.value,fields:L(Je),"show-empty":!0,filterable:[],filter:d.search,"per-page":s.value,"sort-desc":f.value,"onUpdate:sortDesc":o[0]||(o[0]=m=>f.value=m),"sort-by":h.value,"onUpdate:sortBy":o[1]||(o[1]=m=>h.value=m),"sort-direction":k.value,"current-page":y.value,"empty-text":"У вас пока нет профилей.","empty-filtered-text":"Профили не найдены.",onRowClicked:D},{"cell(ID)":a(m=>{var b;return[Qe,t("span",We,v(L(K).transformContractNumber((b=m.item)==null?void 0:b.ID)),1)]}),"cell(Name)":a(m=>{var b;return[Xe,t("span",null,v((b=m.item)==null?void 0:b.Name),1)]}),"cell(StatusDate)":a(m=>{var b;return[Ze,t("span",et,v(x((b=m.item)==null?void 0:b.StatusDate))+" дн.",1)]}),"cell(TemplateID)":a(m=>{var b,n;return[tt,t("span",null,v((n=$.value[(b=m.item)==null?void 0:b.TemplateID])==null?void 0:n.Name),1)]}),"cell(StatusID)":a(m=>[st,l(p,{status:m.value,"status-table":"Profiles"},null,8,["status"])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(B,{total_rows:w.value,onUpdatePage:U},null,8,["total_rows"])])}}},at=F(ot,[["__scopeId","data-v-aab722c9"]]);const nt={class:"section"},lt={class:"container"},rt={class:"list-form"},ct={class:"contracts__page"},_t={__name:"Contracts",async setup(c){var $,w;let d,u;const i=le(),_=G(),h=z(),f=[{value:"Contracts",name:"Договора"},{value:"Profiles",name:"Профили"}],k=P(()=>s.value==="Contracts"?"Договора":"Профили"),s=g("Contracts"),y=g("");function T(){s.value==="Contracts"?_.push({path:"/ContractMake"}):_.push({path:"/ProfileMake"})}return($=i==null?void 0:i.query)!=null&&$.section?s.value=(w=i.query)==null?void 0:w.section:_.replace({query:{section:"Contracts"}}),M(s,()=>{_.replace({query:{section:s.value}})}),[d,u]=H(()=>h.fetchContracts()),await d,u(),[d,u]=H(()=>h.fetchProfiles()),await d,u(),(U,D)=>{const x=te,e=ee,o=Z;return I(),E(re,null,[l(ye),t("div",nt,[t("div",lt,[l(_e,{tabs:f,modelValue:s.value,"onUpdate:modelValue":D[0]||(D[0]=p=>s.value=p)},null,8,["modelValue"]),l(ce,null,{title:a(()=>[V(v(k.value),1)]),buttons:a(()=>[l(x,{label:s.value==="Contracts"?"Создать договор":"Создать профиль",onClick:T},null,8,["label"])]),_:1}),l(e),t("div",rt,[l(o,{modelValue:y.value,"onUpdate:modelValue":D[1]||(D[1]=p=>y.value=p)},null,8,["modelValue"])]),t("div",ct,[s.value==="Contracts"?(I(),A(Ye,{key:0,search:y.value},null,8,["search"])):(I(),A(at,{key:1,search:y.value},null,8,["search"]))])])])],64)}}},Pt=F(_t,[["__scopeId","data-v-2a04373f"]]);export{Pt as default};
