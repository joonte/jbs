import{_ as w}from"./EmptyStateBlock-CV1Zaaf7.js";import{L as T,a as h}from"./bootstrap-vue-next-CxxkTytZ.js";import{_ as R}from"./ButtonDefault-eJbeaBtE.js";import{aj as A,r as p,ak as B,al as x,c as v,o as _,a as s,b,I as j,P as q,d as U,h as L,D as P,F as S,i as E,w as u,t as f,G as O,f as k,s as F,n as V,g as K}from"./index-XtiBO-PZ.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as I}from"./multiselect-eqvbz1NV.js";import{f as N,s as M}from"./time-DenPiOX5.js";import{_ as Z}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as z}from"./BlockBalanceAgreement-DjWMZ940.js";import{u as G}from"./promoStore-DTvWZAm5.js";import"./IconClose-s_NQ_Q4c.js";import"./contracts-BdlSA9YT.js";const D=A("bonuses",()=>{const a=p(null),o=p(null);async function m(l){await B.post(x.fetchBonuses,l).then(n=>{n?.data&&(a.value=n.data)})}async function e(l){await B.post(x.fetchPromos,l).then(n=>{n?.data&&(o.value=n.data)})}async function i(l){let n="ERROR",d=null;return await B.post(x.PromoCodesActivate,l).then(c=>{c?.data?.Status==="Ok"&&(n="SUCCESS")}),{result:n,error:d}}return{bonusesList:a,promosList:o,fetchBonuses:m,fetchPromos:e,PromoCodesActivate:i}}),H={props:{promoCode:{type:String,default:""}},emits:["update"],setup(a,{emit:o}){const m=D(),e=U(),i=p(!1),l=p("");function n(){l.value.length>0&&(i.value=!0,m.PromoCodesActivate({Code:l.value}).then(d=>{const{result:c}=d;c==="SUCCESS"&&o("update"),i.value=!1}))}return L(()=>{e.currentRoute.value.query.PromoCode?(l.value=e.currentRoute.value.query.PromoCode,n()):a.promoCode&&(l.value=a.promoCode)}),{isLoading:i,promoInput:l,activatePromo:n,router:e}}},J={class:"promo-field"},Q={class:"promo-field-input form-field"};function W(a,o,m,e,i,l){const n=R;return _(),v("div",J,[o[1]||(o[1]=s("div",{class:"promo-field-text"},"Промокод",-1)),s("div",Q,[j(s("input",{type:"text",name:"promo-code","onUpdate:modelValue":o[0]||(o[0]=d=>e.promoInput=d)},null,512),[[q,e.promoInput]])]),b(n,{"is-loading":e.isLoading,label:"Применить",onClick:e.activatePromo},null,8,["is-loading","onClick"])])}const X=C(H,[["render",W],["__scopeId","data-v-4e2d9b1e"]]),Y=[{key:"CreateDate",label:"Дата активации",variant:"td-gray",sortable:!0},{key:"ApplyTo",label:"Тариф/Группа",variant:"td-blue"},{key:"PromoCode",label:"Промокод"}],$={components:{Multiselect:I},props:{promoCode:{type:String,default:""}},setup(){const a=D(),o=p("CreateDate"),m=p(!0),e=p("desc"),i=p(1),l=p(10),n=p([10,25,50,100]),d=k(()=>Object.keys(a?.promosList)?.map(y=>a?.promosList[y])),c=k(()=>Object.keys(a?.promosList)?.length);function g(){i.value=1}function t(){a.fetchBonuses(),a.fetchPromos()}const r=y=>{y.key==="Enter"&&y.ctrlKey&&t()};return L(()=>{document.addEventListener("keyup",r)}),F(()=>{document.removeEventListener("keyup",r)}),{promosTable:Y,sortBy:o,sortDesc:m,sortDirection:e,currentPage:i,perPage:l,pageOptions:n,setPageToZero:g,getPromos:d,getPromosLength:c,secondToDate:M,formNormalDate:N,updatePromos:t}}},ee={class:"promo-block block--wrapper"},oe={key:0,class:"table-controls"},te={class:"multiselect-multiple-label"},se={class:"multiselect-option"};function ne(a,o,m,e,i,l){const n=X,d=T,c=h,g=O("Multiselect"),t=w;return _(),v(S,null,[s("div",ee,[o[6]||(o[6]=s("div",{class:"promo-text"},"Активировать промокод",-1)),b(n,{onUpdate:o[0]||(o[0]=r=>e.updatePromos()),promoCode:m.promoCode},null,8,["promoCode"])]),e.getPromos?(_(),v(S,{key:0},[b(d,{class:"basic-table",items:e.getPromos,fields:e.promosTable,"show-empty":!0,"per-page":e.perPage,"current-page":e.currentPage,"empty-text":"Промокодов пока нет.","empty-filtered-text":"Промокоды не найдены.","sort-desc":e.sortDesc,"onUpdate:sortDesc":o[1]||(o[1]=r=>e.sortDesc=r),"sort-by":e.sortBy,"onUpdate:sortBy":o[2]||(o[2]=r=>e.sortBy=r),"sort-direction":e.sortDirection},{"cell(CreateDate)":u(r=>[s("span",null,f(e.formNormalDate(e.secondToDate(r?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),e.getPromosLength>0?(_(),v("div",oe,[b(c,{modelValue:e.currentPage,"onUpdate:modelValue":o[3]||(o[3]=r=>e.currentPage=r),"total-rows":e.getPromosLength,"per-page":e.perPage,"first-number":"","last-number":""},{"first-text":u(()=>o[7]||(o[7]=[s("span",{class:"text-success"},"First",-1)])),"last-text":u(()=>o[8]||(o[8]=[s("span",{class:"text-info"},"Last",-1)])),page:u(({page:r,active:y})=>[s("span",null,f((r-1)*e.perPage+1)+"-"+f(r*e.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),b(g,{class:"multiselect--white",modelValue:e.perPage,"onUpdate:modelValue":o[4]||(o[4]=r=>e.perPage=r),options:e.pageOptions,label:"name",openDirection:"top",onInput:o[5]||(o[5]=r=>e.currentPage=1)},{singlelabel:u(({value:r})=>[s("div",te,[s("span",null,"Отображать "+f(r.value)+" строк",1)])]),option:u(({option:r})=>[s("div",se,"Отображать "+f(r.name)+" строк",1)]),_:1},8,["modelValue","options"])])):E("",!0)],64)):(_(),P(t,{key:1,label:"Промокоды не найдены"}))],64)}const re=C($,[["render",ne],["__scopeId","data-v-34f7e807"]]),ae=[{key:"CreateDate",label:"Дата создания",variant:"td-gray",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray",sortable:!0},{key:"Display",label:"Тариф/Группа",variant:"td-blue"},{key:"DaysRemainded",label:"Дней осталось",sortable:!0},{key:"Discont",variant:"td-controls",label:"Скидка"},{key:"Comment",label:"Комментарий",variant:"td-gray"}],le={components:{Multiselect:I},setup(){const a=D(),o=p("CreateDate"),m=p(!0),e=p("desc"),i=p(1),l=p(10),n=p([10,25,50,100]),d=k(()=>Object.keys(a?.bonusesList)?.map(t=>a?.bonusesList[t])),c=k(()=>Object.keys(a?.bonusesList)?.length);function g(){i.value=1}return{bonusesTable:ae,sortBy:o,sortDesc:m,sortDirection:e,currentPage:i,perPage:l,pageOptions:n,setPageToZero:g,getBonuses:d,getBonusesLength:c,secondToDate:M,formNormalDate:N}}},ie={key:0},ce={key:0,class:"table-controls"},me={class:"multiselect-multiple-label"},de={class:"multiselect-option"};function pe(a,o,m,e,i,l){const n=T,d=h,c=O("Multiselect"),g=w;return e.getBonuses?(_(),v("div",ie,[b(n,{class:"basic-table",items:e.getBonuses,fields:e.bonusesTable,"show-empty":!0,"per-page":e.perPage,"current-page":e.currentPage,"empty-text":"Бонусов пока нет.","empty-filtered-text":"Бонусов не найдены.","sort-desc":e.sortDesc,"onUpdate:sortDesc":o[0]||(o[0]=t=>e.sortDesc=t),"sort-by":e.sortBy,"onUpdate:sortBy":o[1]||(o[1]=t=>e.sortBy=t),"sort-direction":e.sortDirection},{"cell(CreateDate)":u(t=>[s("span",null,f(e.formNormalDate(e.secondToDate(t?.value))),1)]),"cell(ExpirationDate)":u(t=>[s("span",null,f(e.formNormalDate(e.secondToDate(t?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),e.getBonusesLength>0?(_(),v("div",ce,[b(d,{modelValue:e.currentPage,"onUpdate:modelValue":o[2]||(o[2]=t=>e.currentPage=t),"total-rows":e.getBonusesLength,"per-page":e.perPage,"first-number":"","last-number":""},{"first-text":u(()=>o[5]||(o[5]=[s("span",{class:"text-success"},"First",-1)])),"last-text":u(()=>o[6]||(o[6]=[s("span",{class:"text-info"},"Last",-1)])),page:u(({page:t,active:r})=>[s("span",null,f((t-1)*e.perPage+1)+"-"+f(t*e.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),b(c,{class:"multiselect--white",modelValue:e.perPage,"onUpdate:modelValue":o[3]||(o[3]=t=>e.perPage=t),options:e.pageOptions,label:"name",openDirection:"top",onInput:o[4]||(o[4]=t=>e.currentPage=1)},{singlelabel:u(({value:t})=>[s("div",me,[s("span",null,"Отображать "+f(t.value)+" строк",1)])]),option:u(({option:t})=>[s("div",de,"Отображать "+f(t.name)+" строк",1)]),_:1},8,["modelValue","options"])])):E("",!0)])):(_(),P(g,{key:1,label:"Бонусов не найдено"}))}const ue=C(le,[["render",pe]]),_e={async setup(){const a=D(),o=G(),m=p("bonuses"),e=U(),i=K(),l=o.promoCode;function n(){e.go(0)}function d(c){e.replace(`/Bonuses?section=${c}`),m.value=c}return L(()=>{l&&a.PromoCodesActivate({Code:l}).then(c=>{const{result:g}=c;g==="SUCCESS"&&emit("update"),e.replace("/Bonuses?section=promos"),m.value="promos"}),i?.query?.section?m.value=i?.query?.section:e.replace("/Bonuses?section=bonuses")}),await a.fetchBonuses(),await a.fetchPromos(),{section:m,switchToSection:d,promoCode:l,reloadNow:n}}},ge={class:"section"},fe={class:"container"},be={class:"section-header"},ve={class:"section-header"},ye={class:"section-nav"};function Pe(a,o,m,e,i,l){const n=z,d=Z,c=ue,g=re,t=w;return _(),v(S,null,[b(n),s("div",ge,[s("div",fe,[s("div",be,[s("h1",{class:"section-title",onClick:o[0]||(o[0]=r=>e.reloadNow())},"Бонусы и промокоды")]),b(d),s("div",ve,[s("div",ye,[s("div",{class:V(["section-nav__item",{"section-link":!0,"section-link-active":e.section==="bonuses"}]),onClick:o[1]||(o[1]=r=>e.switchToSection("bonuses"))}," Бонусы ",2),s("div",{class:V(["section-nav__item",{"section-link":!0,"section-link-active":e.section==="promos"}]),onClick:o[2]||(o[2]=r=>e.switchToSection("promos"))}," Промокоды ",2)])]),e.section==="bonuses"?(_(),P(c,{key:0})):e.section==="promos"?(_(),P(g,{key:1,promoCode:e.promoCode},null,8,["promoCode"])):(_(),P(t,{key:2,label:"Секция не найдена"}))])])],64)}const Ee=C(_e,[["render",Pe],["__scopeId","data-v-73dbc9a3"]]);export{Ee as default};
