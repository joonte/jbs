import{j as w,o as y,c as V,a as o,b as p,w as r,t as c,F,n as U,k as E,x as M,p as O,l as S,_ as A,r as d,g as v}from"./index-1c309346.js";import{u as T}from"./postings-da2063b0.js";import{u as j}from"./contracts-7b919c67.js";import{s as Z}from"./multiselect-b7ad6876.js";import{a as z,f as q}from"./useTimeFunction-8602dd60.js";import{E as G}from"./EmptyStateBlock-5a6a4cd4.js";import{C as H,F as J}from"./bootstrap-vue-next.es-b799f76d.js";import{_ as K}from"./FormInputSearch-de4e3004.js";import{_ as Q}from"./ClausesKeeper-b9906182.js";import"./IconPlus-ea6f8c21.js";import"./IconSearch-373e7b4f.js";import"./IconClose-7cf50ca7.js";const R=[{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"ServiceID",label:"Операция"},{key:"Comment",label:"Примечание"},{key:"Before",variant:"td-gray td-order",label:"До"},{key:"After",variant:"td-gray td-order",label:"После"},{key:"Change",variant:"td-gray td-order",label:"Сумма",sortable:!0}],i=m=>(O("data-v-0c6f09a3"),m=m(),S(),m),W={class:"section"},X={class:"container"},Y=i(()=>o("div",{class:"section-header"},[o("h1",{class:"section-title"},"История операций")],-1)),$={class:"list-form"},ee={class:"list-form_col list-form_col--sm"},te={class:"list-form_select"},se={class:"multiselect-option"},oe=i(()=>o("span",{class:"td-mobile"},"Дата Создания",-1)),ae={class:"d-block"},ne=i(()=>o("span",{class:"td-mobile"},"Договор",-1)),le=i(()=>o("span",{class:"td-mobile"},"До",-1)),re={class:"d-block"},ce=i(()=>o("span",{class:"td-mobile"},"После",-1)),ie={class:"d-block"},de=i(()=>o("span",{class:"td-mobile"},"Операция",-1)),me=i(()=>o("span",{class:"td-mobile"},"Сумма",-1)),_e={key:0,class:"table-controls"},ue=i(()=>o("span",{class:"text-success"},"First",-1)),pe=i(()=>o("span",{class:"text-info"},"Last",-1)),ge={class:"multiselect-multiple-label"},fe={class:"multiselect-option"};function ve(m,s,b,t,D,B){var f,h;const P=Q,C=w("Multiselect"),k=K,I=H,g=J,L=G;return y(),V("div",W,[o("div",X,[Y,p(P),o("div",$,[o("div",ee,[o("div",te,[p(C,{modelValue:t.select,"onUpdate:modelValue":s[0]||(s[0]=e=>t.select=e),options:t.getUsers,disabled:((f=t.getUsers)==null?void 0:f.length)<=1,label:"name"},{option:r(({option:e})=>[o("div",se,c(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),p(k,{modelValue:t.search,"onUpdate:modelValue":s[1]||(s[1]=e=>t.search=e)},null,8,["modelValue"])]),t.getPostings&&((h=t.getPostings)==null?void 0:h.length)>0?(y(),V(F,{key:0},[p(I,{class:"basic-table",items:t.getPostings.filter(e=>e.ContractID.includes(t.select!=="*"?t.select:"")),fields:t.postingsFields,"show-empty":!0,filter:t.search,"per-page":t.perPage,"current-page":t.currentPage,filterable:["Customer","Comment"],"sort-by":t.sortBy,"onUpdate:sortBy":s[2]||(s[2]=e=>t.sortBy=e),"sort-desc":t.sortDesc,"onUpdate:sortDesc":s[3]||(s[3]=e=>t.sortDesc=e),"sort-direction":t.sortDirection,"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Операций пока нет.","empty-filtered-text":"Операции не найдены.",onFiltered:t.setPageToZero},{"cell(CreateDate)":r(e=>{var l;return[oe,o("span",ae,c(t.formNormalDate(t.secondToDate((l=e.item)==null?void 0:l.CreateDate))),1)]}),"cell(ContractID)":r(e=>{var l,_;return[ne,o("span",null,c((l=e.item)==null?void 0:l.ContractID)+" - "+c((_=e.item)==null?void 0:_.Customer),1)]}),"cell(Before)":r(e=>[le,o("span",re,c(e.value),1)]),"cell(After)":r(e=>[ce,o("span",ie,c(e.value),1)]),"cell(ServiceID)":r(e=>{var l,_,a;return[de,o("span",null,c((a=(_=t.getServices)==null?void 0:_[(l=e.item)==null?void 0:l.ServiceID])==null?void 0:a.Name),1)]}),"cell(Change)":r(e=>[me,o("span",{class:U(["d-block",{positive:e.value>0,negative:e.value<0}])},c(e.value>0?`+${e.value}`:e.value)+" ₽",3)]),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),t.filteredContractsLength>0?(y(),V("div",_e,[p(g,{modelValue:t.currentPage,"onUpdate:modelValue":s[4]||(s[4]=e=>t.currentPage=e),"total-rows":t.filteredContractsLength,"per-page":t.perPage,"first-number":"","last-number":""},{"first-text":r(()=>[ue]),"last-text":r(()=>[pe]),page:r(({page:e,active:l})=>[o("span",null,c((e-1)*t.perPage+1)+"-"+c(e*t.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),p(C,{class:"multiselect--white",modelValue:t.perPage,"onUpdate:modelValue":s[5]||(s[5]=e=>t.perPage=e),options:t.pageOptions,label:"name",openDirection:"top",onInput:s[6]||(s[6]=e=>t.currentPage=1)},{singlelabel:r(({value:e})=>[o("div",ge,[o("span",null,"Отображать "+c(e.value)+" строк",1)])]),option:r(({option:e})=>[o("div",fe,"Отображать "+c(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):E("",!0)],64)):(y(),M(L,{key:1,label:"Ваша история операций пуста"}))])])}const be={components:{Multiselect:Z},async setup(){const m=j(),s=T(),b=d(""),t=d("*"),D=d(1),B=d(10),P=d([10,25,50,100]),C=d("CreateDate"),k=d(!0),I=d("desc"),g=v(()=>Object.keys(s==null?void 0:s.postingsList).map(a=>{var n,u,x,N;return{...s==null?void 0:s.postingsList[a],Customer:(u=(n=f.value)==null?void 0:n[s==null?void 0:s.postingsList[a].ContractID])==null?void 0:u.Customer,Change:l((x=s==null?void 0:s.postingsList[a])==null?void 0:x.Before,(N=s==null?void 0:s.postingsList[a])==null?void 0:N.After)}})),L=v(()=>s==null?void 0:s.servicesList),f=v(()=>m.contractsList),h=v(()=>{let a=[];return g.value.map(n=>{if(!a.find(u=>u===n.Customer))return a.push(n.Customer),{value:n.ContractID,name:n.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),e=v(()=>g.value.filter(a=>{var n,u;return a.Comment.toLowerCase().includes((n=b.value)==null?void 0:n.toLowerCase())||a.Customer.toLowerCase().includes((u=b.value)==null?void 0:u.toLowerCase())}).filter(a=>a.ContractID.includes(t.value!=="*"?t.value:"")).length);function l(a,n){return n-a>0,Number(Math.round((n-a+Number.EPSILON)*100)/100)}function _(){D.value=1}return await m.fetchContracts(),await s.fetchPostings(),await s.fetchServices(),{search:b,select:t,getContracts:f,getUsers:h,getPostings:g,getServices:L,currentPage:D,perPage:B,sortBy:C,sortDesc:k,sortDirection:I,pageOptions:P,filteredContractsLength:e,postingsFields:R,setPageToZero:_,secondToDate:z,formNormalDate:q,calculateChange:l}}},we=A(be,[["render",ve],["__scopeId","data-v-0c6f09a3"]]);export{we as default};
