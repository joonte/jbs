import{_ as j}from"./IconUpload-CoMKfY-S.js";import{_ as L}from"./IconClose-Br7S99e8.js";import{_ as K}from"./IconFile-DS54iwgj.js";import{aq as O,ar as z,c as i,o as d,i as T,a as l,t as w,I as G,P as C,am as A,r as f,f as R,h as H,s as P,E as J,b as n,w as V,G as Q,n as _,v as W,F as I,j as X,d as Y,e as Z}from"./index-DxPA2ffO.js";import{_ as ee}from"./ClausesKeeper-DtaNhp0a.js";import{_ as le}from"./BlockBalanceAgreement-ckI0MbGb.js";import{u as te}from"./edesks-4YmWMATL.js";import{u as se}from"./files--xco-kS0.js";import{s as oe}from"./multiselect-DxJoM0Ze.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./contracts-DD2O0C6m.js";import"./ButtonDefault-tVMF5ozh.js";const ne={class:"tw-flex tw-flex-col md:tw-flex-row tw-items-center tw-text-sm tw-gap-4 tw-mb-4"},re={key:0,class:"tw-w-full md:tw-w-64"},ue={class:"tw-w-full md:tw-flex-1"},ie=["disabled","name","placeholder"],de={__name:"InputText",props:O({label:{type:String,default:""},name:{type:String,default:""},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1}},{modelValue:{modelValue:{type:String,default:""}},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const m=z(r,"modelValue");return(c,a)=>(d(),i("div",ne,[r.label?(d(),i("div",re,w(r.label),1)):T("",!0),l("div",ue,[G(l("input",{"onUpdate:modelValue":a[0]||(a[0]=p=>m.value=p),disabled:r.disabled,name:r.name,placeholder:r.placeholder,class:"tw-flex tw-justify-center tw-h-10 tw-px-3.5 tw-border tw-border-solid tw-border-gray-200 tw-rounded tw-text-gray-500 tw-placeholder-gray-300 tw-w-full"},null,8,ie),[[C,m.value]])])]))}},me={class:"tw-px-4 md:tw-px-8 tw-mb-4"},fe={class:"tw-mb-8"},ce={class:"form-field form-field--basic"},pe={class:"tw-relative tw-flex tw-w-full"},ve={class:"multiselect-option"},_e={class:"tw-flex tw-items-start form-field form-field--basic"},we={class:"tw-relative tw-flex tw-w-full"},ge={key:0,class:"form-field form-field--file form-field--basic"},be={class:"tw-relative tw-flex tw-w-full"},he={class:"chat-files"},ke=["onClick"],xe={class:"form-field form-field--file form-field--basic"},ye={class:"tw-relative tw-flex tw-w-full"},Ee={class:"form-field-input__file tw-h-12 tw-w-full"},Ve={class:"tw-flex tw-justify-end"},Ie={__name:"NewTicket",async setup(r){let m,c;const a=te();A();const p=se(),D=Y(),t=f({theme:{value:null,required:!0,isError:!1},selectGroup:{value:null,required:!0,isError:!1},message:{value:null,required:!0,isError:!1},file:{value:null,required:!1,isError:!1}}),g=f(null),u=f([]),b=f(null),h=R(()=>Object.keys(a?.eDeskGroups||[])?.map(s=>({value:a?.eDeskGroups?.[s]?.ID,name:a?.eDeskGroups?.[s]?.Name})));function S(s){t.value.file.value=s.target.files?.[0]||null,t.value.file.value&&(g.value.value="",p.sendFile(t.value.file.value).then(e=>{u.value.push({name:t.value.file.value?.name,value:e.slice(e.lastIndexOf("^")+1,e.length)})}))}function $(s){u.value=u.value.filter((e,v)=>v!==s)}function k(){let s=!1;Object.keys(t.value).map(e=>{t.value?.[e].required&&t.value?.[e].value===null&&(t.value[e].isError=!0,s=!0)}),s||a.ticketEdit({Theme:t.value?.theme.value||null,TargetGroupID:t.value?.selectGroup.value||null,Message:t.value?.message.value||null,TicketMessageFile:u.value?.map(e=>e?.value)||null}).then(e=>{e==="success"&&D.push({name:"default.Tickets"})})}const x=s=>{s.key==="Enter"&&s.ctrlKey&&k()};H(()=>{document.addEventListener("keyup",x),y()}),P(()=>{document.removeEventListener("keyup",x)}),[m,c]=J(()=>a.fetchTicketGroups().then(()=>{t.value.selectGroup.value=h.value?.[0]?.value})),await m,c();function y(){const s=b.value;s.style.height="auto",s.style.height=s.scrollHeight+10+"px"}return(s,e)=>{const v=le,B=Q("router-link"),F=ee,M=de,N=K,U=L,q=j;return d(),i(I,null,[n(v),l("div",me,[l("div",fe,[n(B,{to:"/Tickets",class:"section-label"},{default:V(()=>e[4]||(e[4]=[Z("Служба поддержки",-1)])),_:1,__:[4]}),e[5]||(e[5]=l("h1",{class:"section-title"},"Создать тикет",-1))]),n(F),n(M,{class:_({"form-error":t.value.theme.isError}),label:"Тема запроса",placeholder:"Заголовок",name:"login",modelValue:t.value.theme.value,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.theme.value=o)},null,8,["class","modelValue"]),l("label",ce,[e[6]||(e[6]=l("div",{class:"form-field__label"},"Отдел",-1)),l("div",pe,[n(W(oe),{class:_(["tw-flex tw-w-full",{"multiselect--white":!0,"form-error":t.value.selectGroup.isError}]),modelValue:t.value.selectGroup.value,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.selectGroup.value=o),options:h.value,label:"name"},{option:V(({option:o})=>[l("div",ve,w(o.name),1)]),_:1},8,["class","modelValue","options"])])]),l("label",_e,[e[7]||(e[7]=l("div",{class:"form-field__label tw-pt-2"},"Сообщение",-1)),l("div",we,[G(l("textarea",{ref_key:"messageInput",ref:b,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.message.value=o),onInput:y,class:_(["tw-min-h-48 tw-placeholder-gray-300",{"form-error":t.value.message.isError}]),placeholder:"Опишите проблему, указав сервер размещения, вашу учётную запись на сервере, имя сайта, УРЛ ошибки и способ её воспроизведения."},null,34),[[C,t.value.message.value]])])]),u.value.length?(d(),i("div",ge,[e[8]||(e[8]=l("div",{class:"form-field__label"},null,-1)),l("div",be,[l("div",he,[(d(!0),i(I,null,X(u.value,(o,E)=>(d(),i("div",{class:"chat-files__item",key:E},[l("span",null,[n(N,{class:"file-icon"})]),l("span",null,w(o?.name),1),l("button",{class:"close",onClick:Te=>$(E)},[n(U)],8,ke)]))),128))])])])):T("",!0),l("label",xe,[e[10]||(e[10]=l("div",{class:"form-field__label"},null,-1)),l("div",ye,[l("input",{ref_key:"fileInput",ref:g,type:"file",onChange:S},null,544),l("div",Ee,[n(q),e[9]||(e[9]=l("span",{class:"tw-text-sm"},"Прикрепить файл",-1))])])]),l("div",Ve,[l("button",{class:"btn btn--blue btn-default",onClick:e[3]||(e[3]=o=>k())},e[11]||(e[11]=[l("span",{class:"tw-text-sm tw-min-w-32"},"Отправить",-1)]))])])],64)}}},Le=ae(Ie,[["__scopeId","data-v-27886899"]]);export{Le as default};
