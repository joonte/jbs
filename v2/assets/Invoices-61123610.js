import{j as W,o as k,c as B,b as i,a as n,w as c,t as m,F as Z,k as q,d as E,x as X,p as Y,l as w,_ as $,a7 as ee,R as te,r as u,g as I}from"./index-87a66f57.js";import{u as oe}from"./postings-4f14ba7d.js";import{u as se}from"./contracts-63b183f3.js";import{s as ne}from"./multiselect-19c64478.js";import{S as H}from"./StatusBadge-74310711.js";import{I as J}from"./IconDownload-59ff4b19.js";import{I as K}from"./IconFile-149ccd6e.js";import{B as Q}from"./BlockBalanceAgreement-f9b358ae.js";import{a as ae,f as ce}from"./useTimeFunction-8602dd60.js";import{E as ie}from"./EmptyStateBlock-f512ef0a.js";import{z as le,d as re,C as de,F as me}from"./bootstrap-vue-next.es-e0094127.js";import{_ as _e}from"./IconDots-c481ec47.js";import{_ as ue}from"./IconCard-4f04d33d.js";import{_ as pe}from"./FormInputSearch-f93020c4.js";import{_ as ve}from"./ClausesKeeper-068355e6.js";import{_ as fe}from"./ButtonDefault-646e2a65.js";import"./IconArrow-8c8c28c1.js";import"./IconPlus-a33d0542.js";import"./IconSearch-c3e117a8.js";import"./IconClose-81d0053a.js";const be=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Files",variant:"td-controls",label:""}],_=p=>(Y("data-v-73a569a9"),p=p(),w(),p),Ie={class:"section"},he={class:"container"},De={class:"section-header"},ye=_(()=>n("h1",{class:"section-title"},"Счета на оплату",-1)),ge={class:"list-form"},Ce={class:"list-form_col list-form_col--sm"},ke={class:"list-form_select"},Se={class:"multiselect-option"},Pe=_(()=>n("span",{class:"td-mobile"},"Платежная система",-1)),Fe={class:"d-block"},Le=_(()=>n("span",{class:"td-mobile"},"Дата Создания",-1)),Be={class:"d-block"},Ne=_(()=>n("span",{class:"td-mobile"},"Номер счета",-1)),Ve={class:"d-block"},xe=_(()=>n("span",{class:"td-mobile"},"Договор",-1)),Te={class:"d-block"},Oe=_(()=>n("span",{class:"td-mobile"},"Статус",-1)),Ue=_(()=>n("span",{class:"td-mobile"},"Сумма",-1)),je={class:"d-block"},Me={class:"invoices__controls-wrapper"},Re=["href"],Ee={class:"invoices__download-button-wrapper"},Ae={class:"invoices__download-text"},ze={class:"btn__group"},Ge=["onClick"],Ze=_(()=>n("p",null,"ОПЛАТИТЬ",-1)),qe={class:"dropdown-button"},He={class:"btn btn--dots"},Je=["href"],Ke={key:0,class:"table-controls"},Qe=_(()=>n("span",{class:"text-success"},"First",-1)),We=_(()=>n("span",{class:"text-info"},"Last",-1)),Xe={class:"multiselect-multiple-label"},Ye={class:"multiselect-option"};function we(p,s,S,o,A,z){var P,g;const N=Q,h=fe,v=ve,D=W("Multiselect"),V=pe,x=H,f=K,T=J,O=ue,y=_e,b=le,U=re,j=de,M=me,R=ie;return k(),B(Z,null,[i(N),n("div",Ie,[n("div",he,[n("div",De,[ye,i(h,{onClick:s[0]||(s[0]=e=>o.createNewIncoice()),label:"Выписать новый счёт"})]),i(v),n("div",ge,[n("div",Ce,[n("div",ke,[i(D,{modelValue:o.select,"onUpdate:modelValue":s[1]||(s[1]=e=>o.select=e),options:o.getUsers,disabled:((P=o.getUsers)==null?void 0:P.length)<=1,label:"name"},{option:c(({option:e})=>[n("div",Se,"# "+m(e.value.padStart(5,"0"))+" / "+m(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),i(V,{modelValue:o.search,"onUpdate:modelValue":s[2]||(s[2]=e=>o.search=e)},null,8,["modelValue"])]),((g=o.getFilteredOrders)==null?void 0:g.length)>0?(k(),B(Z,{key:0},[i(j,{class:"basic-table",items:o.getFilteredOrders,fields:o.worksCompleteFields,"show-empty":!0,filter:o.search,"per-page":o.perPage,"current-page":o.currentPage,responsive:"","sort-by":o.sortBy,"onUpdate:sortBy":s[3]||(s[3]=e=>o.sortBy=e),"sort-desc":o.sortDesc,"onUpdate:sortDesc":s[4]||(s[4]=e=>o.sortDesc=e),"sort-direction":o.sortDirection,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:o.setPageToZero},{"cell(PaymentSystemName)":c(e=>[Pe,n("span",Fe,m(e.value),1)]),"cell(CreateDate)":c(e=>{var r;return[Le,n("span",Be,m(o.formNormalDate(o.secondToDate((r=e.item)==null?void 0:r.CreateDate))),1)]}),"cell(ID)":c(e=>[Ne,n("span",Ve,m(e.value),1)]),"cell(ContractID)":c(e=>{var r;return[xe,n("span",Te,m((r=e.item)==null?void 0:r.Customer),1)]}),"cell(StatusID)":c(e=>[Oe,i(x,{status:e.value,"status-table":"Invoices"},null,8,["status"])]),"cell(Summ)":c(e=>{var r;return[Ue,n("span",je,m((r=e.item)==null?void 0:r.Summ)+" ₽",1)]}),"cell(Files)":c(e=>{var r,F,L;return[n("div",Me,[e!=null&&e.value?(k(),B("a",{key:0,class:"invoices__download-button",href:o.getInvoicesPDFLink(e)},[n("div",Ee,[i(f,{class:"invoices__download-icon"}),n("div",Ae,"Счет №"+m((L=(F=e==null?void 0:e.value)==null?void 0:F[(r=Object.keys(e==null?void 0:e.value))==null?void 0:r[0]])==null?void 0:L.ID),1),i(T,{class:"invoices__download-icon"})])],8,Re)):q("",!0),n("div",ze,[n("button",{class:"btn btn-default btn--border",onClick:t=>o.invoicePayment(e)},[i(O),Ze],8,Ge),n("div",qe,[i(U,{class:"dropdown-dots",right:""},{"button-content":c(()=>[n("div",He,[i(y)])]),default:c(()=>[i(b,null,{default:c(()=>[n("a",{href:o.getInvoicesTTFLink(e)},"Скачать в формате tiff",8,Je)]),_:2},1024),i(b,{onClick:t=>o.switchPaymentSystem(e)},{default:c(()=>[E("Изменить счёт")]),_:2},1032,["onClick"]),i(b,{onClick:t=>o.invoicePayment(e)},{default:c(()=>[E("Оплатить")]),_:2},1032,["onClick"]),i(b,{onClick:t=>o.invoicesReject(e)},{default:c(()=>[E("Отменить")]),_:2},1032,["onClick"])]),_:2},1024)])])])]}),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),o.filteredContractsLength>0?(k(),B("div",Ke,[i(M,{modelValue:o.currentPage,"onUpdate:modelValue":s[5]||(s[5]=e=>o.currentPage=e),"total-rows":o.filteredContractsLength,"per-page":o.perPage,"first-number":"","last-number":""},{"first-text":c(()=>[Qe]),"last-text":c(()=>[We]),page:c(({page:e,active:r})=>[n("span",null,m((e-1)*o.perPage+1)+"-"+m(e*o.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),i(D,{class:"multiselect--white",modelValue:o.perPage,"onUpdate:modelValue":s[6]||(s[6]=e=>o.perPage=e),options:o.pageOptions,label:"name",openDirection:"top",onInput:s[7]||(s[7]=e=>o.currentPage=1)},{singlelabel:c(({value:e})=>[n("div",Xe,[n("span",null,"Отображать "+m(e.value)+" строк",1)])]),option:c(({option:e})=>[n("div",Ye,"Отображать "+m(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):q("",!0)],64)):(k(),X(R,{key:1,label:"Заказов не найдено"}))])])],64)}const $e={components:{Multiselect:ne,StatusBadge:H,IconDownload:J,IconFile:K,BlockBalanceAgreement:Q},async setup(){const p=se(),s=oe(),S=ee(),o=te("emitter");o.on("updateInvoicesTable",()=>{s.fetchInvoices()});const A=u("CreateDate"),z=u(!0),N=u("desc"),h=u(""),v=u("*"),D=u(1),V=u(10),x=u([10,25,50,100]),f=I(()=>Object.keys(s==null?void 0:s.invoicesList).map(t=>{var a,l,d;return{...s==null?void 0:s.invoicesList[t],Customer:(l=(a=y.value)==null?void 0:a[s==null?void 0:s.invoicesList[t].ContractID])==null?void 0:l.Customer,Summ:Number((d=s==null?void 0:s.invoicesList[t])==null?void 0:d.Summ)}}).reverse()),T=I(()=>f.value.filter(a=>v.value!=="*"?Number(a.ContractID)===Number(v.value):!0)),O=I(()=>s==null?void 0:s.servicesList),y=I(()=>p.contractsList),b=I(()=>{let t=[];return f.value.map(a=>{if(!t.find(l=>l===a.Customer))return t.push(a.Customer),{value:a.ContractID,name:a.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),U=I(()=>f.value.filter(t=>{var a,l;return(t==null?void 0:t.PaymentSystemName.toLowerCase().includes((a=h.value)==null?void 0:a.toLowerCase()))||String(t==null?void 0:t.Summ).toLowerCase().includes((l=h.value)==null?void 0:l.toLowerCase())}).filter(t=>t.ContractID.includes(v.value!=="*"?v.value:"")).length);function j(){D.value=1}function M(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsStamp=yes`}function R(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsTIFF=yes&IsStamp=yes`}function P(t){var a,l,d,C,G;o.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:(a=t==null?void 0:t.item)==null?void 0:a.ID,TypeID:(C=(d=y.value)==null?void 0:d[(l=t==null?void 0:t.item)==null?void 0:l.ContractID])==null?void 0:C.TypeID,Summ:(G=t==null?void 0:t.item)==null?void 0:G.Summ}})}function g(t){var a;s.InvoiceDocument({InvoiceID:(a=t.item)==null?void 0:a.ID}).then(l=>{var d;o.emit("open-modal",{component:"InvoiceDocument",data:{html:l,ID:(d=t.item)==null?void 0:d.ID}})})}function e(){o.emit("open-modal",{component:"NewInvoice"})}function r(){}function F(){}function L(t){var l;let a=new FormData;a.append("ContractID","Default"),a.append("RowsIDs[]",(l=t.item)==null?void 0:l.ID),s.InvoicesReject(a).then(d=>{d==="SUCCESS"&&s.fetchInvoices()})}return window.FormGet=r.bind(this),window.Mobile=F.bind(this),await p.fetchContracts(),await s.fetchInvoices().then(()=>{var t,a;(t=S.params)!=null&&t.id&&((a=f.value)!=null&&a.find(d=>{var C;return d.ID===((C=S.params)==null?void 0:C.id)}))&&g({item:{ID:S.params.id}})}),await s.fetchServices(),{search:h,select:v,getContracts:y,getUsers:b,getOrders:f,getServices:O,currentPage:D,perPage:V,sortBy:A,sortDesc:z,sortDirection:N,pageOptions:x,filteredContractsLength:U,worksCompleteFields:be,getFilteredOrders:T,invoicePayment:g,invoicesReject:L,switchPaymentSystem:P,setPageToZero:j,secondToDate:ae,formNormalDate:ce,getInvoicesTTFLink:R,getInvoicesPDFLink:M,createNewIncoice:e}}},Dt=$($e,[["render",we],["__scopeId","data-v-73a569a9"]]);export{Dt as default};
