import{o as F,c as A,b as k,a as o,t as C,F as B,l as x,p as V,m as N,_ as E,f as L,e as q,g as M,r as D,h as _,i as w,a3 as R}from"./index-918fd9be.js";import{u as U}from"./postings-4ae265b3.js";import{u as J}from"./services-5f58d54e.js";import{_ as K}from"./ButtonDefault-2f55d117.js";import{_ as T}from"./ClausesKeeper-a5c1abc1.js";import{B as z}from"./BlockBalanceAgreement-e7f96bc6.js";import"./IconClose-6ceae682.js";import"./contracts-580f94dc.js";import"./bootstrap-vue-next.es-1529a2a7.js";import"./IconArrow-f2d41a4e.js";const g=d=>(V("data-v-e5869ba4"),d=d(),N(),d),G={class:"additional-service-prolong"},H={class:"section"},Q={class:"container"},W={class:"section-header"},X=g(()=>o("h1",{class:"section-title"},"Оплата заказа дополнительной услуги",-1)),Y={class:"section-label"},Z={class:"section"},$={class:"container"},j={class:"service-prolong__data"},ee={class:"form-field"},te=g(()=>o("div",{class:"form-field__label"},"Стоимость заказа",-1)),se=["value"],oe={class:"form-field"},ae={class:"form-field__label"},re=g(()=>o("input",{type:"text",placeholder:"0 руб",value:"1",disabled:""},null,-1)),ie={class:"form-field"},ce=g(()=>o("div",{class:"form-field__label"},"Всего к оплате",-1)),le=["value"],ne={class:"section"},de={class:"container"},_e={class:"service-prolong__data"},ue={class:"total-block"},ve={class:"total-block__row total-block__row--big"},pe=g(()=>o("div",{class:"total-block__col"},"Итого",-1)),me={class:"total-block__col"};function fe(d,u,v,a,I,S){var y,m,f,b;const l=z,p=T,O=K;return F(),A(B,null,[k(l),o("div",G,[o("div",H,[o("div",Q,[o("div",W,[X,o("div",Y,C((y=a.getService)==null?void 0:y.Name)+" # "+C((m=a.getOrder)==null?void 0:m.ID),1)]),k(p)])]),a.getOrder?(F(),A(B,{key:0},[o("div",Z,[o("div",$,[o("div",j,[o("label",ee,[te,o("input",{type:"text",placeholder:"0 руб",value:((f=a.getService)==null?void 0:f.Cost)+" руб",disabled:""},null,8,se)]),o("label",oe,[o("div",ae,"Количество ("+C((b=a.getService)==null?void 0:b.Measure)+")",1),re]),o("label",ie,[ce,o("input",{type:"text",placeholder:"0 руб",value:a.getServicePrice()+" руб",disabled:""},null,8,le)])])])]),o("div",ne,[o("div",de,[o("div",_e,[o("div",ue,[o("div",ve,[pe,o("div",me,C(a.getServicePrice()||"0")+" ₽",1)])]),k(O,{class:"btn--wide",label:"Оплатить",onClick:u[0]||(u[0]=P=>a.orderPay()),"is-loading":a.isLoading},null,8,["is-loading"])])])])],64)):x("",!0)])],64)}const he={async setup(){const d=L(),u=q(),v=U(),a=M(),I=J(),S=D(!1),l=_(()=>Object.keys(a==null?void 0:a.userOrders).map(e=>a==null?void 0:a.userOrders[e]).find(e=>e.ID===d.params.id));_(()=>{var e,t;return(t=(e=O.value)==null?void 0:e.find(s=>{var r,i,c;return s.value===((c=(i=(r=l.value)==null?void 0:r.OrdersFields)==null?void 0:i[0])==null?void 0:c.Value)}))==null?void 0:t.price}),_(()=>{var e,t;return(t=(e=y.value)==null?void 0:e.find(s=>{var r,i,c;return s.value===((c=(i=(r=l.value)==null?void 0:r.OrdersFields)==null?void 0:i[1])==null?void 0:c.Value)}))==null?void 0:t.price});const p=D(0),O=_(()=>{var e,t,s,r,i;return(i=(r=(s=(t=(e=h.value)==null?void 0:e.ServicesFields)==null?void 0:t[0])==null?void 0:s.Options)==null?void 0:r.split(`
`))==null?void 0:i.map(c=>{let n=c.split("=");return{value:n[0],name:n[1],price:n[2]}})}),y=_(()=>{var e,t,s,r,i;return(i=(r=(s=(t=(e=h.value)==null?void 0:e.ServicesFields)==null?void 0:t[1])==null?void 0:s.Options)==null?void 0:r.split(`
`))==null?void 0:i.map(c=>{let n=c.split("=");return{value:n[0],name:n[1],price:n[2]}})});async function m(e){try{const s=(await R.get(`/ServiceOrderPay?OrderID=${e}&JSON=1`)).data,r=f(s);let i=1;return s.AmountPay&&(i=parseInt(s.AmountPay)||1),r}catch(t){return console.error("Ошибка при получении данных о стоимости заказа",t),null}}function f(e){let t=0;for(const s in e)e.hasOwnProperty(s)&&(typeof e[s]=="object"?t+=f(e[s]):s==="Cost"&&!isNaN(e[s])&&(t+=parseFloat(e[s])));return t}function b(){var s;return((parseFloat((s=h.value)==null?void 0:s.Cost)||parseFloat(p.value)||0)*1).toFixed(2)}function P(){var e,t;S.value=!0,I.ServiceOrderPay((e=l.value)==null?void 0:e.Code,{AmountPay:"1",ServiceOrderID:(t=l.value)==null?void 0:t.ID,IsChange:!0}).then(s=>{var c;let{result:r,error:i}=s;r==="SUCCESS"?u.push(`/AdditionalServices/${(c=l.value)==null?void 0:c.ID}`):r==="BASKET"&&u.push("/Basket"),S.value=!1})}w(async()=>{if(l.value){const e=l.value.ID,t=await m(e);t!==null&&(p.value=t)}}),w(()=>{console.log(h,"service get")});const h=_(()=>{var e;return v==null?void 0:v.servicesList[(e=l.value)==null?void 0:e.ServiceID]});return await a.fetchUserOrders(),await v.fetchServices(),{getOrder:l,getService:h,getServicePrice:b,isLoading:S,orderPay:P,fetchOrderCost:m,orderCost:p}}},Ae=E(he,[["render",fe],["__scopeId","data-v-e5869ba4"]]);export{Ae as default};
