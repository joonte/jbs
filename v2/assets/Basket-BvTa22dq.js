import{L as w}from"./bootstrap-vue-next-CxxkTytZ.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as m,o as d,a as t,b as f,F as g,j as B,r as F,f as y,x as P,i as L,t as a,w as k}from"./index-XtiBO-PZ.js";import{_ as x}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as N}from"./BlockBalanceAgreement-DjWMZ940.js";import{u as M}from"./basket-CitGM6GF.js";import{u as V}from"./contracts-BdlSA9YT.js";import{u as O}from"./postings-D5DA40Zz.js";import"./IconClose-s_NQ_Q4c.js";import"./ButtonDefault-eJbeaBtE.js";const T={},A={fill:"none",height:"32",viewBox:"0 0 32 32",width:"32",xmlns:"http://www.w3.org/2000/svg"};function E(i,e){return d(),m("svg",A,e[0]||(e[0]=[t("rect",{fill:"#F7F9FF",height:"31",rx:"3.5",width:"31",x:".5",y:".5"},null,-1),t("path",{d:"M8.5 11h15m-1.665 0v11.667a1.667 1.667 0 0 1-1.667 1.666h-8.333a1.667 1.667 0 0 1-1.667-1.666V11m2.5 0V9.333a1.667 1.667 0 0 1 1.667-1.666h3.333a1.667 1.667 0 0 1 1.667 1.666V11m-5.003 4.167v5m3.336-5v5",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("rect",{height:"31",rx:"3.5",stroke:"#C7D1ED",width:"31",x:".5",y:".5"},null,-1)]))}const G=S(T,[["render",E]]),R=[{key:"ServiceID",label:"Услуга",variant:"td-service"},{key:"OrderID",label:"Номер заказа",variant:"td-service"},{key:"Amount",label:"Период"},{key:"Summ",label:"Сумма"},{key:"controls",label:"Действия",variant:"td-controls"}],$={async setup(){const i=M(),e=V(),v=O(),n=P("emitter"),_=F(null),p=y(()=>i?.basketList),u=y(()=>e?.contractsList),h=y(()=>v?.servicesList);n.on("form-cart-invoice",s=>{C(s)}),await i.fetchBasket().then(()=>{_.value=p.value}),await e.fetchContracts(),await v.fetchServices();function I(s){let l=0;for(let c=0;c<s.length;c++)l=l+Number(s[c]?.Summ);return Math.round((l+Number.EPSILON)*100)/100}function D(s){i?.deleteFromBasket({RowsIDs:[s?.ID],TableID:"Basket"}).then(l=>{l==="success"&&(i.basketList?.[s?.ContractID].filter(c=>c?.ID!==s.ID).length>0?_.value[s?.ContractID]=i.basketList?.[s?.ContractID].filter(c=>c?.ID!==s.ID):delete _.value[s?.ContractID])})}function r(){}function b(){}function o(s,l){console.log(s,l,"item, index"),n.emit("open-modal",{component:"InvoiceMakeBasket",data:{ItemID:l,ContractPaymentSystems:u.value?.[l]?.PaymentSystems,ProfileID:u.value?.[l]?.ProfileID,TypeID:u.value?.[l]?.TypeID,...s}})}function C(s){delete _.value[s]}return window.FormGet=r.bind(this),window.Mobile=b.bind(this),{getBasket:p,getContracts:u,getServices:h,basketContent:_,totalPrice:I,deleteFromBasket:D,choosePaymentSystem:o,basketTableFields:R}}},q={class:"section"},z={class:"container"},H={key:0,class:"cart-list"},J={key:0,class:"cart-item"},K={class:"cart-item__subtitle"},Q={class:"cart-item__subtitle-name"},U={class:"d-block"},W={class:"d-block table-td-blue"},X=["onClick"],Y={class:"total-block"},Z={class:"total-block__row"},j={class:"total-block__col"},tt=["onClick"],et={key:1,class:"notification-field"};function st(i,e,v,n,_,p){const u=N,h=x,I=G,D=w;return d(),m(g,null,[f(u),t("section",q,[t("div",z,[e[6]||(e[6]=t("div",{class:"section-header"},[t("h1",{class:"section-title"},"Корзина")],-1)),f(h),n.basketContent&&Object.keys(n.basketContent).length>0?(d(),m("div",H,[(d(!0),m(g,null,B(n.basketContent,(r,b)=>(d(),m(g,{key:b},[r&&r.length>0?(d(),m("div",J,[e[5]||(e[5]=t("div",{class:"cart-item__title"},"Заказ",-1)),t("div",K,[t("div",Q,a(n.getContracts?.[b]?.Customer),1)]),f(D,{items:r,fields:n.basketTableFields,class:"basic-table table-cart"},{"cell(ServiceID)":k(o=>[e[0]||(e[0]=t("span",{class:"td-mobile"},"Услуга",-1)),t("span",U,a(n.getServices?.[o.item?.ServiceID]?.Name),1),t("span",W,a(o.item?.Comment),1)]),"cell(OrderID)":k(o=>[e[1]||(e[1]=t("span",{class:"td-mobile"},"Номер заказа",-1)),t("span",null,"№ "+a(o.item?.OrderID),1)]),"cell(Amount)":k(o=>[e[2]||(e[2]=t("span",{class:"td-mobile"},"Период",-1)),t("span",null,a(o.item?.Amount)+" "+a(o.item?.Measure),1)]),"cell(Summ)":k(o=>[e[3]||(e[3]=t("span",{class:"td-mobile"},"Сумма",-1)),t("span",null,a(o.item?.Summ)+" ₽",1)]),"cell(controls)":k(o=>[t("button",{class:"btn-delete btn",onClick:C=>n.deleteFromBasket(o.item)},[f(I)],8,X)]),_:2},1032,["items","fields"]),t("div",Y,[t("div",Z,[e[4]||(e[4]=t("div",{class:"total-block__col"},"Итого",-1)),t("div",j,a(n.totalPrice(r))+" ₽",1)]),t("button",{class:"btn btn--blue btn-default btn--wide",onClick:o=>n.choosePaymentSystem(r,b)}," Оплатить заказ ",8,tt)])])):L("",!0)],64))),128))])):(d(),m("div",et,"Корзина заказов пуста"))])])],64)}const ut=S($,[["render",st],["__scopeId","data-v-effed727"]]);export{ut as default};
