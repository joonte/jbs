import{_ as te}from"./BlockOrderServiceWrapper-Ccoi2Fl1.js";import{_ as oe}from"./BlockAdditionalServices-BLZFm89Z.js";import{_ as le}from"./DomainCheckBlock-B4KM3Ctv.js";import{_ as ae}from"./BlockSelectContract-Cef_Umis.js";import{_ as ne}from"./ClausesKeeper-DtaNhp0a.js";import{_ as ie}from"./ButtonDefault-tVMF5ozh.js";import{_ as re}from"./BlockBalanceAgreement-ckI0MbGb.js";import{O as de,x as ce,g as me,r as g,f as h,h as W,s as ue,m as ve,E as O,c as N,b as f,a as s,w as E,t as u,F as X,j as _e,d as fe,o as D,v as k,i as R,I as B,P as L,e as pe}from"./index-DxPA2ffO.js";import{u as he}from"./contracts-DD2O0C6m.js";import{u as Se}from"./hosting-BRwESFSW.js";import{u as Ne}from"./services-DjjrPMAb.js";import{s as De}from"./multiselect-DxJoM0Ze.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./EmptyStateBlock-Dks67PsT.js";import"./bootstrap-vue-next-9iQSFcL_.js";import"./ServiceListOrderSelection-DjdcJR5t.js";import"./BasicInput-DI25CRuk.js";import"./component-BeTqOa0q.js";import"./IconClose-Br7S99e8.js";const ge={class:"domain-scheme"},ke={class:"section"},Ie={class:"container"},ye={class:"section-header __sb"},Ce={class:"tw-mt-8"},Oe={class:"section"},Ee={class:"form multy"},we={class:"multi-top"},xe={key:0,class:"server"},Ve={key:1,class:"domain"},Re={class:"multiselect-option"},Be={key:0,class:"server"},Le={key:1,class:"domain"},Pe={class:"section"},Ue={class:"form form-grid-columns"},Te={class:"form-col"},Ae={class:"form-field"},$e={class:"form-col"},Fe={class:"form-field"},He={class:"form-col"},je={class:"form-field"},Ke={class:"form-col"},Me={class:"form-field"},qe={class:"section"},We={class:"container"},Xe={class:"total-block"},Ze={class:"total-block__row"},ze={class:"total-block__col"},Ge={class:"total-block__col"},Je={class:"total-block__col"},Qe={class:"total-block__row total-block__row--big"},Ye={class:"total-block__col"},es={__name:"DomainSchemes",async setup(ss){let r,d;const p=de(),F=he(),v=Se(),w=Ne(),x=fe(),Z=me(),H=ce("emitter");H.on("updateDomainsList",()=>{p.fetchDomains()});const z=Z.query.DomainName||"",b=g(null),c=g([]),I=g(null),y=g([]),P=g(!1),a=g({Ns1Name:"dns0.host-food.ru",Ns2Name:"dns1.host-food.ru",Ns3Name:null,Ns4Name:null}),U=h(()=>F.contractsList),j=h(()=>w?.ServicesList),T=h(()=>{let o=0;return y.value.forEach(e=>{o+=e?.Price}),M(o)||0}),K=o=>{o.key==="Enter"&&o.ctrlKey&&!G.value&&q()},G=h(()=>c.value.length===0);W(()=>{document.addEventListener("keyup",K),console.log($)}),ue(()=>{document.removeEventListener("keyup",K)});const J=h(()=>Object.keys(p.domainSchemes).filter(o=>p.domainSchemes[o].IsActive).map(o=>({...p.domainSchemes[o],value:p.domainSchemes[o]?.ID}))),Q=h(()=>Object.keys(v?.hostingList).map(o=>v?.hostingList[o])),A=h(()=>v?.hostingList),$=h(()=>{const o=Object.keys(A.value).map(e=>{const n=A.value[e];return{value:n.ID,login:n.Login,customer:n.Customer,domain:n.Domain,schemeID:n.SchemeID}});return o.unshift({value:0,login:"Без хостинга",customer:"",domain:""}),o});ve(()=>I.value,o=>{const e=Q.value.find(n=>n.ID===o);e?(a.value.Ns1Name=e.Ns1Name,a.value.Ns2Name=e.Ns2Name,a.value.Ns3Name=e.Ns3Name,a.value.Ns4Name=e.Ns4Name):(a.value.Ns1Name="dns0.host-food.ru",a.value.Ns2Name="dns1.host-food.ru",a.value.Ns3Name=null,a.value.Ns4Name=null)});function M(o){return Number(o).toFixed(2)||0}async function Y(o){for(const e of y.value){let n="SUCCESS",_=j.value[e.ServiceID]?.Code;if(await w.ServiceOrder({Code:_,DependOrderID:o,...e,ContractID:b.value}).then(({result:C,info:l,error:i})=>{if(C==="SUCCESS"){let m={};_==="Default"?m.ServiceOrderID=l?.ServiceOrderID:m[`${_}OrderID`]=l?.ServiceOrderID,w.ServiceOrderPay(_,m,{XMLHttpRequest:"yes"}).then(S=>{let{result:t,error:V}=S;t==="SUCCESS"?x.push("/AdditionalServices"):t==="BASKET"&&x.push("/Basket")})}else n="ERROR"}),n==="ERROR")break}}async function q(){P.value=!0;let o=0;const e=[],n=()=>{if(o<c.value.length){const l=c.value[o];p.DomainOrder({ContractID:b.value,Domain:`${l.line}${l.line&&l.Name?"."+l.Name:""}`,DomainName:l.line,DomainSchemeID:l.value,DomainZone:l.Name,IsPrivateWhoIs:"yes",HostingOrderID:I.value,...a.value}).then(({result:i,info:m,error:S})=>{if(i==="SUCCESS")return o===0&&Y(m?.OrderID),p.DomainOrderPay({DomainOrderID:m?.DomainOrderID});throw new Error(S)}).then(i=>{let{result:m,error:S}=i;e.push({result:m,error:S})}).catch(i=>{console.error("An error occurred:",i),e.push({result:"ERROR",error:i})}).finally(()=>{o++,setTimeout(n,1e3)})}else P.value=!1};n(),await new Promise(l=>{const i=()=>{o===c.value.length?l():setTimeout(i,100)};i()});const _=e.some(l=>l.result==="BASKET"),C=e.every(l=>l.result==="SUCCESS");_?x.push("/Basket"):C&&x.push("/DomainOrders")}function ee(o){c.value=o}function se(){H.emit("open-modal",{component:"DomainTransfer",data:{}})}return W(()=>{A.value&&(I.value=$.value[0].value)}),[r,d]=O(()=>p.fetchDomainSchemes()),await r,d(),[r,d]=O(()=>F.fetchContracts().then(()=>{U.value&&(b.value=Object.keys(U?.value)?.[0])})),await r,d(),[r,d]=O(()=>v.fetchHostingOrders()),await r,d(),[r,d]=O(()=>v.fetchHostingSchemes()),await r,d(),[r,d]=O(()=>w.fetchServices()),await r,d(),(o,e)=>{const n=re,_=ie,C=ne,l=ae,i=le,m=oe,S=te;return D(),N(X,null,[f(n),s("div",ge,[s("section",ke,[s("div",Ie,[s("div",ye,[e[9]||(e[9]=s("h1",{class:"section-title"},"Заказ доменного имени",-1)),f(_,{label:"Перенести домен",onClick:e[0]||(e[0]=t=>se())})]),f(C)])]),f(S,{basic_title:"Домен"},{page:E(()=>[s("div",Ce,[f(l,{title:"Договор",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=t=>b.value=t)},null,8,["modelValue"]),f(i,{"domain-list":J.value,search:k(z),onSelect:ee},null,8,["domain-list","search"]),s("div",Oe,[e[10]||(e[10]=s("div",{class:"section-header"},[s("h2",{class:"section-block_title"},"Заказ хостинга"),s("div",{class:"section-label"}," Если домен будет использоваться совместно с заказом хостинга, выберите нужный из существующего списка ")],-1)),s("form",Ee,[f(k(De),{class:"hosting-select multiselect--white",modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=t=>I.value=t),options:$.value,label:"login",placeholder:"Выберите хостинг","track-by":"value"},{singlelabel:E(({value:t})=>[s("div",we,u(t.login),1),k(v).hostingSchemes[t.schemeID]?.Name?(D(),N("span",xe," / "+u(k(v).hostingSchemes[t.schemeID]?.Name),1)):R("",!0),t.domain?(D(),N("span",Ve," / "+u(t.domain),1)):R("",!0)]),option:E(({option:t})=>[s("div",Re,u(t.login),1),k(v).hostingSchemes[t.schemeID]?.Name?(D(),N("span",Be," / "+u(k(v).hostingSchemes[t.schemeID]?.Name),1)):R("",!0),t.domain?(D(),N("span",Le," / "+u(t.domain),1)):R("",!0)]),_:1},8,["modelValue","options"])])]),s("div",Pe,[e[23]||(e[23]=s("div",{class:"section-header"},[s("div",{class:"section-label"}," Для успешной регистрации, домен должен быть настроен на используемых именных серверах. Для этого в панели управления хостингом необходимо добавить домен, как дополнительный или паркованный. ")],-1)),s("form",Ue,[s("div",Te,[e[12]||(e[12]=s("div",{class:"form-col__title"},"Первичный сервер имен",-1)),s("label",Ae,[e[11]||(e[11]=s("div",{class:"form-field__label"},"Доменный адрес",-1)),B(s("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":e[3]||(e[3]=t=>a.value.Ns1Name=t)},null,512),[[L,a.value.Ns1Name]])]),e[13]||(e[13]=s("label",{class:"form-field"},[s("div",{class:"form-field__label"},"IP адрес"),s("input",{type:"text",disabled:""})],-1))]),s("div",$e,[e[15]||(e[15]=s("div",{class:"form-col__title"},"Вторичный сервер имен",-1)),s("label",Fe,[e[14]||(e[14]=s("div",{class:"form-field__label"},"Доменный адрес",-1)),B(s("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":e[4]||(e[4]=t=>a.value.Ns2Name=t)},null,512),[[L,a.value.Ns2Name]])]),e[16]||(e[16]=s("label",{class:"form-field"},[s("div",{class:"form-field__label"},"IP адрес"),s("input",{type:"text",disabled:""})],-1))]),s("div",He,[e[18]||(e[18]=s("div",{class:"form-col__title"},"Дополнительный сервер имен",-1)),s("label",je,[e[17]||(e[17]=s("div",{class:"form-field__label"},"Доменный адрес",-1)),B(s("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=t=>a.value.Ns3Name=t)},null,512),[[L,a.value.Ns3Name]])]),e[19]||(e[19]=s("label",{class:"form-field"},[s("div",{class:"form-field__label"},"IP адрес"),s("input",{type:"text",disabled:""})],-1))]),s("div",Ke,[e[21]||(e[21]=s("div",{class:"form-col__title"},"Расширенный сервер имен",-1)),s("label",Me,[e[20]||(e[20]=s("div",{class:"form-field__label"},"Доменный адрес",-1)),B(s("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=t=>a.value.Ns4Name=t)},null,512),[[L,a.value.Ns4Name]])]),e[22]||(e[22]=s("label",{class:"form-field"},[s("div",{class:"form-field__label"},"IP адрес"),s("input",{type:"text",disabled:""})],-1))])])])])]),services:E(()=>[f(m,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=t=>y.value=t),serviceSearchParams:{ServiceID:"20000"}},null,8,["modelValue"])]),_:1}),s("section",qe,[s("div",We,[s("div",Xe,[s("div",Ze,[e[24]||(e[24]=s("div",{class:"total-block__col"},"Дополнительные услуги",-1)),s("div",ze,u(T.value)+" ₽",1)]),(D(!0),N(X,null,_e(y.value,t=>(D(),N("div",{class:"total-block__row no-divider",key:t.ServiceID},[s("div",Ge,u(j.value[t?.ServiceID]?.Name),1),s("div",Je,u(M(t?.Price))+" ₽",1)]))),128)),s("div",Qe,[e[25]||(e[25]=s("div",{class:"total-block__col"},"Итого за 12 месяцев",-1)),s("div",Ye,u(c.value.length?c.value.reduce((t,V)=>t+parseFloat(V.CostOrder),0)+ +T.value:"0")+" ₽ ",1)]),f(_,{class:"btn--wide",label:U.value[b.value]?.Balance>(c.value.length?c.value.reduce((t,V)=>t+parseFloat(V.CostOrder),0)+ +T.value:0)?"Оплатить c баланса договора":"Добавить в корзину",onClick:e[8]||(e[8]=t=>q()),"is-loading":P.value,disabled:c.value.length===0},{default:E(()=>e[26]||(e[26]=[pe(" Добавить в корзину ",-1)])),_:1,__:[26]},8,["label","is-loading","disabled"])])])])])],64)}}},bs=be(es,[["__scopeId","data-v-724634c1"]]);export{bs as default};
