import{k as O,o as w,c as x,a as d,d as E,t as m,b,w as C,p as N,m as L,_ as j,r as k,U as B,h as f,i as y,P as U}from"./index-5b1b768e.js";import{u as V}from"./vps-ad5d494d.js";import{s as G}from"./multiselect-0eb7c5c1.js";import{_ as W}from"./ButtonDefault-e9d3cb95.js";const M=n=>(N("data-v-dc2d15f0"),n=n(),L(),n),K={class:"modal__body"},T=M(()=>d("div",{class:"list-item__title"},"Смена тарифного плана",-1)),q={class:"list-item__subtitle"},z={class:"modal__input-row"},A=M(()=>d("div",{class:"modal__input-label"},"Новый тарифный план",-1)),F={class:"list-form_col list-form_col--xl"},H={class:"search-field form-field"},J={class:"multiselect-multiple-label"},Q={class:"multiselect-option"};function R(n,r,e,l,p,I){var i,u;const g=O("Multiselect"),v=W;return w(),x("div",K,[T,d("div",q,[E("Текущий тарифный план "),d("span",null,m((i=l.getVPSScheme[0])==null?void 0:i.name)+"/"+m((u=l.getVPSScheme[0])==null?void 0:u.cost),1)]),d("div",z,[A,d("div",F,[d("div",H,[b(g,{class:"multiselect--white",options:l.getVPSSchemes,type:"text",modelValue:l.selectedPackage,"onUpdate:modelValue":r[0]||(r[0]=a=>l.selectedPackage=a),placeholder:"Поиск"},{singlelabel:C(({value:a})=>[d("div",J,[d("span",null,m(a==null?void 0:a.Name)+"/"+m(a==null?void 0:a.CostMonth),1)])]),option:C(({option:a})=>[d("div",Q,m(a==null?void 0:a.Name)+"/"+m(a==null?void 0:a.CostMonth),1)]),_:1},8,["options","modelValue"])])])]),b(v,{class:"modal__button",label:"Сменить","is-loading":l.isLoading,onClick:r[1]||(r[1]=a=>l.changeScheme())},null,8,["is-loading"])])}const X={components:{Multiselect:G},props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(n,{emit:r}){const e=V(),l=k(!1),p=k(null),I=B("emitter"),g=f(()=>e==null?void 0:e.vpsList),v=f(()=>{var s,c;return(c=g.value)==null?void 0:c[(s=n.data)==null?void 0:s.VpsID]}),i=f(()=>Object.keys(e==null?void 0:e.vpsSchemes).map(s=>{var c,h,_;return{...e==null?void 0:e.vpsSchemes[s],value:(c=e==null?void 0:e.vpsSchemes[s])==null?void 0:c.ID,name:(h=e==null?void 0:e.vpsSchemes[s])==null?void 0:h.Name,cost:(_=e==null?void 0:e.vpsSchemes[s])==null?void 0:_.CostMonth}}).filter(s=>{var c;return(s==null?void 0:s.ID)==((c=v.value)==null?void 0:c.SchemeID)})),u=f(()=>{var _;const s=i.value[0],c=(_=Object.keys(e==null?void 0:e.vpsSchemes).map(t=>{var o;return{...e==null?void 0:e.vpsSchemes[t],value:(o=e==null?void 0:e.vpsSchemes[t])==null?void 0:o.ID}}))==null?void 0:_.filter(t=>{var o,S;return(t==null?void 0:t.IsSchemeChangeable)&&(t==null?void 0:t.ID)!==((o=v.value)==null?void 0:o.SchemeID)&&(t==null?void 0:t.ServersGroupID)===((S=n.data)==null?void 0:S.ServerGroup)});return[s,...c].sort((t,o)=>t.SortID-o.SortID).map(t=>({...t,disabled:t.ID===s.ID}))});function a(){var s;l.value=!0,e.VPSOrderSchemeChange({NewSchemeID:p.value,VPSOrderID:(s=n.data)==null?void 0:s.VpsID}).then(c=>{var t,o;let{result:h,error:_}=c;h==="SUCCESS"&&((t=n.data)!=null&&t.emitEvent&&I.emit((o=n.data)==null?void 0:o.emitEvent),r("modalClose")),l.value=!1})}y(()=>{var s,c;p.value=(c=(s=u.value)==null?void 0:s[1])==null?void 0:c.value});const D=s=>{s.key==="Enter"&&a()};return y(()=>{document.addEventListener("keyup",D)}),U(()=>{document.removeEventListener("keyup",D)}),{isLoading:l,getVPSSchemes:u,changeScheme:a,selectedPackage:p,getVPSScheme:i}}},ee=j(X,[["render",R],["__scopeId","data-v-dc2d15f0"]]);export{ee as default};
