import{_ as le}from"./FormInputSearch-23b3b5c7.js";import{_ as re}from"./ClausesKeeper-3a1c11ba.js";import{_ as ce}from"./ButtonDefault-0006f72a.js";import{_ as O,o as L,c as R,b as c,a as e,m as ie,r as I,h as q,w as n,t as f,M as x,k as Q,p as G,l as z,e as Y,u as W,S as Z,g as P,j as _e,an as X,y as j,d as U,a7 as ue,ag as K,Z as de,ae as pe,F as me}from"./index-b5b5ce3d.js";import{u as J}from"./contracts-74f05bb7.js";import{S as ve}from"./SlotPageTitle-5b5f1b3a.js";import{F as fe}from"./FormTabs-8731f19e.js";import{F as be,f as ge,z as ye,d as Ce,C as ee}from"./bootstrap-vue-next.es-37aa63ea.js";import{_ as he}from"./IconDots-5eb3cb0a.js";import{S as te}from"./StatusBadge-0649a996.js";import{f as Ie,a as ke}from"./useTimeFunction-8602dd60.js";/* empty css                                                                       */import{_ as De}from"./IconCard-cef3f371.js";import{s as Te}from"./multiselect-4f7d14de.js";import{B as Se}from"./BlockBalanceAgreement-a016b94f.js";import"./IconPlus-4ce40522.js";import"./IconSearch-1e5f2e1f.js";import"./IconClose-cd6d3917.js";import"./IconArrow-fddabae2.js";const $e=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"Customer",label:"Договор"},{key:"TypeID",label:"Тип",variant:"td-gray td-order"},{key:"Orders",label:"Количество подключенных услуг",sortable:!0,variant:"td-gray td-order"},{key:"Balance",label:"Баланс",sortable:!0,variant:"td-gray td-order"},{key:"IsHidden",label:"Скрыт ?",variant:"td-gray td-order"},{key:"Status",label:"Статус",variant:"td-gray td-order"},{key:"controls",label:"",variant:"td-controls"}];const Le={class:"button-payment"},Pe={class:"button-payment__text"},we={__name:"FormButtonPayment",setup(u){return(b,p)=>(L(),R("button",Le,[c(De,{class:"button-payment__icon"}),e("span",Pe,[ie(b.$slots,"default",{},void 0,!0)])]))}},xe=O(we,[["__scopeId","data-v-fcb8fa3c"]]);const se=u=>(G("data-v-64d83888"),u=u(),z(),u),Be={key:0,class:"table-controls"},Ve=se(()=>e("span",{class:"text-success"},"First",-1)),Ne=se(()=>e("span",{class:"text-info"},"Last",-1)),Fe={class:"multiselect-multiple-label"},Ee={class:"multiselect-option"},He={__name:"PaginationBlock",props:["modelValue","total_rows"],emits:["update:modelValue","updatePage"],setup(u,{emit:b}){const p=u,_=[10,25,50,100],i=I({current_page:1,per_page:10});return q(i.value,()=>{b("updatePage",i.value)}),(y,C)=>{const $=be;return p.total_rows>0?(L(),R("div",Be,[c($,{modelValue:i.value.current_page,"onUpdate:modelValue":C[0]||(C[0]=d=>i.value.current_page=d),"total-rows":p.total_rows,"per-page":i.value.per_page,"first-number":"","last-number":""},{"first-text":n(()=>[Ve]),"last-text":n(()=>[Ne]),page:n(({page:d,active:m})=>[e("span",null,f((d-1)*i.value.per_page+1)+"-"+f(d*i.value.per_page),1)]),_:1},8,["modelValue","total-rows","per-page"]),c(x(Te),{class:"multiselect--white",modelValue:i.value.per_page,"onUpdate:modelValue":C[1]||(C[1]=d=>i.value.per_page=d),options:_,label:"name",openDirection:"top",onInput:C[2]||(C[2]=d=>i.value.current_page=1)},{singlelabel:n(({value:d})=>[e("div",Fe,[e("span",null,"Отображать "+f(d.value)+" строк",1)])]),option:n(({option:d})=>[e("div",Ee,"Отображать "+f(d.name)+" строк",1)]),_:1},8,["modelValue"])])):Q("",!0)}}},oe=O(He,[["__scopeId","data-v-64d83888"]]);const w=u=>(G("data-v-39022284"),u=u(),z(),u),Ue={class:"contracts-list"},Oe=w(()=>e("span",{class:"td-mobile"},"Номер",-1)),Re={class:"td-column-heavy"},Ae={class:"table-td-gray"},Me=w(()=>e("span",{class:"td-mobile"},"Дата Создания",-1)),je={class:"d-block"},qe=w(()=>e("span",{class:"td-mobile"},"Договор",-1)),Ge={class:"td-column-heavy"},ze={class:"table-td-blue"},Ye=w(()=>e("span",{class:"td-mobile"},"Тип договора",-1)),Ze=w(()=>e("span",{class:"td-mobile"},"Баланс",-1)),Je=w(()=>e("span",{class:"td-mobile"},"Скрыт ?",-1)),Ke=w(()=>e("span",{class:"td-mobile"},"Статус",-1)),Qe=w(()=>e("span",{class:"td-mobile"},"Количество подключенных услуг",-1)),We={class:"btn__group"},Xe={class:"dropdown-button"},et={class:"btn btn--dots"},tt={__name:"ContractsList",props:{search:{type:String,default:""}},setup(u){const b=u,p=Y(),_=J(),i=W(),y=Z("emitter"),C=I("CreateDate"),$=I(!0),d=I("desc"),m=I(10),k=I(1);I(!1);const B=t=>{_.booleanEdit({TableID:"Contracts",ColumnID:"IsHidden",RowID:t.ID}).then(()=>{_.fetchContracts()})},V=P(()=>{var t,v;return(v=(t=Object.keys(_==null?void 0:_.contractsList))==null?void 0:t.map(T=>_==null?void 0:_.contractsList[T]))==null?void 0:v.reverse()}),E=P(()=>{var t,v;return(v=(t=i.ConfigList)==null?void 0:t.Contracts)==null?void 0:v.Types}),H=P(()=>{var t;return(t=V.value.filter(v=>{var T;return v.Customer.toLowerCase().includes(((T=b.search)==null?void 0:T.toLowerCase())||"")}))==null?void 0:t.length});function N(t){y.emit("open-modal",{component:"StatusHistory",data:{modeID:"Contracts",rowID:t}})}function F(t){p.push(`/Balance/${t}`)}function a(t={}){m.value=t==null?void 0:t.per_page,k.value=t==null?void 0:t.current_page}function s(t){_==null||_.contractDownload({ContractID:t})}return q(()=>b,()=>{k.value=1}),(t,v)=>{const T=ge,r=te,g=he,S=_e("router-link"),M=ye,ae=Ce,ne=ee;return L(),R("div",Ue,[c(ne,{class:"basic-table",items:V.value,fields:x($e),"show-empty":!0,filterable:[],filter:b.search,"per-page":m.value,"sort-desc":$.value,"onUpdate:sortDesc":v[0]||(v[0]=o=>$.value=o),"sort-by":C.value,"onUpdate:sortBy":v[1]||(v[1]=o=>C.value=o),"sort-direction":d.value,"current-page":k.value,"empty-text":"У вас пока нет договоров.","empty-filtered-text":"Договора не найдены."},{"cell(ID)":n(o=>{var l;return[Oe,e("div",Re,[e("div",Ae,f(x(X).transformContractNumber((l=o.item)==null?void 0:l.ID)),1)])]}),"cell(CreateDate)":n(o=>{var l;return[Me,e("span",je,f(x(Ie)(x(ke)((l=o.item)==null?void 0:l.CreateDate))),1)]}),"cell(Customer)":n(o=>{var l;return[qe,e("div",Ge,[e("div",ze,f((l=o.item)==null?void 0:l.Customer),1)])]}),"cell(TypeID)":n(o=>{var l,h;return[Ye,e("span",null,f((h=E.value[(l=o.item)==null?void 0:l.TypeID])==null?void 0:h.Name),1)]}),"cell(Balance)":n(o=>{var l;return[Ze,e("span",null,f((l=o.item)==null?void 0:l.Balance)+" ₽",1)]}),"cell(IsHidden)":n(o=>{var l,h;return[Je,c(T,{class:"rule-checkbox",name:"checkbox",checked:(l=o.item)==null?void 0:l.IsHidden,modelValue:o.item.IsChecked,"onUpdate:modelValue":D=>o.item.IsChecked=D,onChange:D=>B(o.item)},null,8,["checked","modelValue","onUpdate:modelValue","onChange"]),e("span",null,f(((h=o.item)==null?void 0:h.IsHidden)===!0?"Да":"Нет"),1)]}),"cell(Status)":n(o=>{var l;return[Ke,c(r,{status:(l=o.item)==null?void 0:l.StatusID,"status-table":"Contracts",onClick:h=>{var D;return N((D=o.item)==null?void 0:D.ID)}},null,8,["status","onClick"])]}),"cell(Orders)":n(o=>{var l;return[Qe,e("span",null,f((l=o.item)==null?void 0:l.Orders),1)]}),"cell(controls)":n(o=>{var l;return[e("div",We,[((l=o.item)==null?void 0:l.TypeID)!="NaturalPartner"?(L(),j(xe,{key:0,onClick:h=>{var D;return F((D=o.item)==null?void 0:D.ID)}},{default:n(()=>[U("Пополнить баланс")]),_:2},1032,["onClick"])):Q("",!0),e("div",Xe,[c(ae,{class:"dropdown-dots",right:""},{"button-content":n(()=>[e("div",et,[c(g)])]),default:n(()=>[c(M,null,{default:n(()=>{var h;return[c(S,{to:`/ContractScheme/${(h=o.item)==null?void 0:h.ID}`},{default:n(()=>[U("Открыть")]),_:2},1032,["to"])]}),_:2},1024),c(M,null,{default:n(()=>{var h;return[c(S,{to:`/ContractSettings/${(h=o.item)==null?void 0:h.ID}`},{default:n(()=>[U("Изменить тип учёта")]),_:2},1032,["to"])]}),_:2},1024),c(M,{onClick:h=>{var D;return s((D=o.item)==null?void 0:D.ID)}},{default:n(()=>[U("Загрузить договор")]),_:2},1032,["onClick"])]),_:2},1024)])])]}),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),c(oe,{total_rows:H.value,onUpdatePage:a},null,8,["total_rows"])])}}},st=O(tt,[["__scopeId","data-v-39022284"]]),ot=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"Name",label:"Профиль",variant:"td-blue"},{key:"TemplateID",label:"Тип",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",sortable:!0,variant:"td-gray td-order"},{key:"StatusDate",label:"От статуса",sortable:!0,variant:"td-default td-order"}];const A=u=>(G("data-v-55858f0b"),u=u(),z(),u),at={class:"contracts-profile-list"},nt=A(()=>e("span",{class:"td-mobile"},"Номер",-1)),lt={class:"d-block"},rt=A(()=>e("span",{class:"td-mobile"},"Номер",-1)),ct=A(()=>e("span",{class:"td-mobile"},"От статуса",-1)),it={class:"d-block"},_t=A(()=>e("span",{class:"td-mobile"},"Тип",-1)),ut=A(()=>e("span",{class:"td-mobile"},"Статус",-1)),dt={__name:"ContractsProfileList",props:["search"],setup(u){const b=u;Y();const p=J(),_=W(),i=Z("emitter"),y=I("ID"),C=I(!0),$=I("desc"),d=I(10),m=I(1),k=P(()=>{var a,s;return(s=(a=Object==null?void 0:Object.keys(p==null?void 0:p.profileList))==null?void 0:a.map(t=>p==null?void 0:p.profileList[t]))==null?void 0:s.reverse()}),B=P(()=>{var a,s;return(s=(a=_.ConfigList)==null?void 0:a.Profiles)==null?void 0:s.Templates}),V=P(()=>{var a;return(a=k.value.filter(s=>{var t;return s.Name.toLowerCase().includes(((t=b.search)==null?void 0:t.toLowerCase())||"")}))==null?void 0:a.length});function E(a={}){d.value=a==null?void 0:a.per_page,m.value=a==null?void 0:a.current_page}function H(a,s){s.target.closest("button, a, .clickable-element")||i.emit("open-modal",{component:"ProfileInfo",data:{data:a,template:B.value[a.TemplateID]}})}function N(a){return Math.floor((new Date().getTime()-a*1e3)/(1e3*60*60*24))}function F(a){i.emit("open-modal",{component:"StatusHistory",data:{modeID:"Profiles",rowID:a}})}return(a,s)=>{const t=te,v=ee,T=oe;return L(),R("div",at,[c(v,{class:"basic-table",items:k.value,fields:x(ot),"show-empty":!0,filterable:[],filter:b.search,"per-page":d.value,"sort-desc":C.value,"onUpdate:sortDesc":s[0]||(s[0]=r=>C.value=r),"sort-by":y.value,"onUpdate:sortBy":s[1]||(s[1]=r=>y.value=r),"sort-direction":$.value,"current-page":m.value,"empty-text":"У вас пока нет профилей.","empty-filtered-text":"Профили не найдены.",onRowClicked:s[2]||(s[2]=(r,g,S)=>H(r,S))},{"cell(ID)":n(r=>{var g;return[nt,e("span",lt,f(x(X).transformContractNumber((g=r.item)==null?void 0:g.ID)),1)]}),"cell(Name)":n(r=>{var g;return[rt,e("span",null,f((g=r.item)==null?void 0:g.Name),1)]}),"cell(StatusDate)":n(r=>{var g;return[ct,e("span",it,f(N((g=r.item)==null?void 0:g.StatusDate))+" дн.",1)]}),"cell(TemplateID)":n(r=>{var g,S;return[_t,e("span",null,f((S=B.value[(g=r.item)==null?void 0:g.TemplateID])==null?void 0:S.Name),1)]}),"cell(StatusID)":n(r=>[ut,c(t,{class:"clickable-element",status:r.value,"status-table":"Profiles",onClick:g=>{var S;return F((S=r.item)==null?void 0:S.ID)}},null,8,["status","onClick"])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),c(T,{total_rows:V.value,onUpdatePage:E},null,8,["total_rows"])])}}},pt=O(dt,[["__scopeId","data-v-55858f0b"]]);const mt={class:"section"},vt={class:"container"},ft={class:"list-form"},bt={class:"contracts__page"},gt={__name:"Contracts",async setup(u){var N,F;let b,p;const _=ue(),i=Y(),y=J(),C=Z("emitter"),$=[{value:"Contracts",name:"Договора"},{value:"Profiles",name:"Профили"}],d=P(()=>m.value==="Contracts"?"Договора":"Профили"),m=I("Contracts"),k=I(""),B=P(()=>{var a,s;return(s=(a=Object.keys(y==null?void 0:y.contractsList))==null?void 0:a.map(t=>y==null?void 0:y.contractsList[t]))==null?void 0:s.reverse()});function V(){i.go(0)}function E(){m.value==="Contracts"?i.push({path:"/ContractMake"}):i.push({path:"/ProfileMake"})}function H(){C.emit("open-modal",{component:"FundsTransfer"})}return(N=_==null?void 0:_.query)!=null&&N.section?m.value=(F=_.query)==null?void 0:F.section:i.replace({query:{section:"Contracts"}}),q(m,()=>{i.replace({query:{section:m.value}})}),[b,p]=K(()=>y.fetchContracts()),await b,p(),[b,p]=K(()=>y.fetchProfiles()),await b,p(),(a,s)=>{const t=ce,v=re,T=le;return L(),R(me,null,[c(Se),e("div",mt,[e("div",vt,[c(fe,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=r=>m.value=r),tabs:$},null,8,["modelValue"]),c(ve,{onClick:s[2]||(s[2]=r=>V())},{title:n(()=>[U(f(d.value),1)]),buttons:n(()=>[de(c(t,{label:"Перевод средств",onClick:s[1]||(s[1]=r=>H())},null,512),[[pe,m.value==="Contracts"&&B.value.length>1]]),c(t,{label:m.value==="Contracts"?"Создать договор":"Создать профиль",onClick:E},null,8,["label"])]),_:1}),c(v),e("div",ft,[c(T,{modelValue:k.value,"onUpdate:modelValue":s[3]||(s[3]=r=>k.value=r)},null,8,["modelValue"])]),e("div",bt,[m.value==="Contracts"?(L(),j(st,{key:0,search:k.value},null,8,["search"])):(L(),j(pt,{key:1,search:k.value},null,8,["search"]))])])])],64)}}},Ut=O(gt,[["__scopeId","data-v-1be433a0"]]);export{Ut as default};
