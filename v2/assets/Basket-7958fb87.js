import{q as M,r as P,a2 as x,a3 as L,_ as A,o as u,c as h,a as e,j as V,b as C,F as w,x as O,t as _,w as v,k as T,p as $,l as E,S as G,g as S}from"./index-00a0bf0d.js";import{u as q}from"./contracts-8ab155ab.js";import{u as R}from"./postings-81749241.js";import"./invoices-c105e759.js";import{S as z}from"./ServerItem-3551251f.js";import{B as H}from"./BlockBalanceAgreement-fb81df3d.js";import{C as J}from"./bootstrap-vue-next.es-be8a8de1.js";import{_ as K}from"./ClausesKeeper-ce1dcc35.js";import"./IconDots-6b52141e.js";import"./IconCard-30dada0d.js";import"./StatusBadge-4c2dc228.js";import"./ButtonDefault-4233c21f.js";import"./IconArrow-74dc045b.js";import"./IconClose-97a82d3d.js";const Q=M("basket",()=>{const n=P(null);async function r(){let o="error";return await x.post(""+L.fetchBasket).then(a=>{n.value=a==null?void 0:a.data}).catch(()=>{o="error"}),o}async function d(o){let a="error";return await x.post(""+L.deleteFromBasket,{...o}).then(f=>{a="success"}).catch(()=>{a="error"}),a}return{basketList:n,fetchBasket:r,deleteFromBasket:d}}),U={},W={fill:"none",height:"32",viewBox:"0 0 32 32",width:"32",xmlns:"http://www.w3.org/2000/svg"},X=e("rect",{fill:"#F7F9FF",height:"31",rx:"3.5",width:"31",x:".5",y:".5"},null,-1),Y=e("path",{d:"M8.5 11h15m-1.665 0v11.667a1.667 1.667 0 0 1-1.667 1.666h-8.333a1.667 1.667 0 0 1-1.667-1.666V11m2.5 0V9.333a1.667 1.667 0 0 1 1.667-1.666h3.333a1.667 1.667 0 0 1 1.667 1.666V11m-5.003 4.167v5m3.336-5v5",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Z=e("rect",{height:"31",rx:"3.5",stroke:"#C7D1ED",width:"31",x:".5",y:".5"},null,-1),j=[X,Y,Z];function tt(n,r){return u(),h("svg",W,j)}const N=A(U,[["render",tt]]),et=[{key:"ServiceID",label:"Услуга",variant:"td-service"},{key:"OrderID",label:"Номер заказа",variant:"td-service"},{key:"Amount",label:"Период"},{key:"Summ",label:"Сумма"},{key:"controls",label:"Действия",variant:"td-controls"}],p=n=>($("data-v-228b6796"),n=n(),E(),n),st={class:"section"},nt={class:"container"},ot=p(()=>e("div",{class:"section-header"},[e("h1",{class:"section-title"},"Корзина")],-1)),at={key:0,class:"cart-list"},ct={key:0,class:"cart-item"},lt=p(()=>e("div",{class:"cart-item__title"},"Заказ",-1)),it={class:"cart-item__subtitle"},rt={class:"cart-item__subtitle-name"},_t=p(()=>e("span",{class:"td-mobile"},"Услуга",-1)),dt={class:"d-block"},mt={class:"d-block table-td-blue"},ut=p(()=>e("span",{class:"td-mobile"},"Номер заказа",-1)),ht=p(()=>e("span",{class:"td-mobile"},"Период",-1)),pt=p(()=>e("span",{class:"td-mobile"},"Сумма",-1)),kt=["onClick"],vt={class:"total-block"},ft={class:"total-block__row"},It=p(()=>e("div",{class:"total-block__col"},"Итого",-1)),bt={class:"total-block__col"},yt=["onClick"],Ct={key:1,class:"notification-field"};function Dt(n,r,d,o,a,f){const k=V("BalanceAgreement"),D=K,B=N,g=J;return u(),h(w,null,[C(k),e("div",st,[e("div",nt,[ot,C(D),o.basketContent&&Object.keys(o.basketContent).length>0?(u(),h("div",at,[(u(!0),h(w,null,O(o.basketContent,(m,I)=>{var b,y;return u(),h(w,null,[m&&m.length>0?(u(),h("div",ct,[lt,e("div",it,[e("div",rt,_((y=(b=o.getContracts)==null?void 0:b[I])==null?void 0:y.Customer),1)]),C(g,{class:"basic-table table-cart",items:m,fields:o.basketTableFields},{"cell(ServiceID)":v(t=>{var s,c,i,l;return[_t,e("span",dt,_((i=(c=o.getServices)==null?void 0:c[(s=t.item)==null?void 0:s.ServiceID])==null?void 0:i.Name),1),e("span",mt,_((l=t.item)==null?void 0:l.Comment),1)]}),"cell(OrderID)":v(t=>{var s;return[ut,e("span",null,"№ "+_((s=t.item)==null?void 0:s.OrderID),1)]}),"cell(Amount)":v(t=>{var s,c;return[ht,e("span",null,_((s=t.item)==null?void 0:s.Amount)+" "+_((c=t.item)==null?void 0:c.Measure),1)]}),"cell(Summ)":v(t=>{var s;return[pt,e("span",null,_((s=t.item)==null?void 0:s.Summ)+" ₽",1)]}),"cell(controls)":v(t=>[e("button",{class:"btn-delete btn",onClick:s=>o.deleteFromBasket(t.item)},[C(B)],8,kt)]),_:2},1032,["items","fields"]),e("div",vt,[e("div",ft,[It,e("div",bt,_(o.totalPrice(m))+" ₽",1)]),e("button",{class:"btn btn--blue btn-default btn--wide",onClick:t=>o.choosePaymentSystem(m,I)},"Оплатить заказ",8,yt)])])):T("",!0)],64)}),256))])):(u(),h("div",Ct,"Корзина заказов пуста"))])])],64)}const Bt={components:{IconDelete:N,ServerItem:z,BalanceAgreement:H},async setup(){const n=Q(),r=q(),d=R(),o=G("emitter"),a=P(null),f=S(()=>n==null?void 0:n.basketList),k=S(()=>r==null?void 0:r.contractsList),D=S(()=>d==null?void 0:d.servicesList);o.on("form-cart-invoice",t=>{y(t)}),await n.fetchBasket().then(()=>{a.value=f.value}),await r.fetchContracts(),await d.fetchServices();function B(t){var c;let s=0;for(let i=0;i<t.length;i++)s=s+Number((c=t[i])==null?void 0:c.Summ);return Math.round((s+Number.EPSILON)*100)/100}function g(t){n==null||n.deleteFromBasket({RowsIDs:[t==null?void 0:t.ID],TableID:"Basket"}).then(s=>{var c,i;s==="success"&&(((c=n.basketList)==null?void 0:c[t==null?void 0:t.ContractID].filter(l=>(l==null?void 0:l.ID)!==t.ID).length)>0?a.value[t==null?void 0:t.ContractID]=(i=n.basketList)==null?void 0:i[t==null?void 0:t.ContractID].filter(l=>(l==null?void 0:l.ID)!==t.ID):delete a.value[t==null?void 0:t.ContractID])})}function m(){}function I(){}function b(t,s){var c,i,l,F;o.emit("open-modal",{component:"InvoiceMakeBasket",data:{ItemID:s,ContractPaymentSystems:(i=(c=k.value)==null?void 0:c[s])==null?void 0:i.PaymentSystems,TypeID:(F=(l=k.value)==null?void 0:l[s])==null?void 0:F.TypeID,...t}})}function y(t){delete a.value[t]}return window.FormGet=m.bind(this),window.Mobile=I.bind(this),{getBasket:f,getContracts:k,getServices:D,basketContent:a,totalPrice:B,deleteFromBasket:g,choosePaymentSystem:b,basketTableFields:et}}},Et=A(Bt,[["render",Dt],["__scopeId","data-v-228b6796"]]);export{Et as default};
