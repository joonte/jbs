import{_ as le}from"./ButtonDefault-BIBStZbJ.js";import{_ as re}from"./TotalAmount.vue_vue_type_script_setup_true_lang-CXrtmBc-.js";import{f as ie}from"./BlockBalanceAgreement-qtspRQ_B.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _,m as g,H as F,c as d,o as u,a as r,L as ue,h as S,t as h,v as J,M as X,N as de,Q as ce,f as D,g as ve,s as fe,C as T,b as k,e as $,w as z,F as V,i as P,I as me,S as De,d as pe}from"./index-CmCGXBst.js";import{_ as Se}from"./BasicInput-KlObNzdO.js";import{_ as Ie}from"./BlockSelectContract-uyQ-oMQe.js";import{_ as _e}from"./ClausesKeeper-CTja-fCz.js";import{u as he}from"./contracts-P7YPBhEI.js";import{u as be}from"./services-C54cnl9l.js";import{s as Oe}from"./multiselect-DhoC9bwZ.js";const ye={class:"form-input_border"},Ce=["checked","name","type"],ke={class:"form-input_border-content"},$e={class:"form-input_border-item form-input_border-item--left"},Ve={class:"form-input_border-item form-input_border-item--right"},ge={__name:"InputBorderCheckboxRadio",props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:K}){const a=l,j=K,C=_(null);function i(){j("update:modelValue",a.data)}return g(a,()=>{C.value=a.modelValue}),F(()=>{C.value=a.modelValue}),(A,v)=>(u(),d("label",ye,[r("input",{checked:C.value?.value===l.data?.value,name:l.name,type:l.checkbox?"checkbox":"radio",onInput:i},null,40,Ce),r("span",ke,[v[0]||(v[0]=r("span",{class:"form-input_border-mark"},null,-1)),r("span",$e,h(l.data?.name),1),l.data.price?ue(A.$slots,"default",{key:0},()=>[r("span",Ve,h(J(ie)(l.data?.price)),1)],!0):S("",!0)])]))}},Ne=G(ge,[["__scopeId","data-v-2c65b20b"]]),Ee={key:0},Be={class:"section-header"},Pe={key:2,class:"form-field form-field--basic"},je={class:"form-field-input__wrapper"},Ae={key:3,class:"form-field form-field--basic"},we={class:"form-field-input__wrapper"},xe={class:"multiselect-option"},Ue={class:"form-field__label"},Le={key:0},Me={class:"form-field-input__wrapper"},Te=["title","name","onUpdate:modelValue"],Fe={key:5},Ke={class:"list"},Re={class:"list-col list-col--md"},qe={key:6},He={class:"list"},We={class:"list-item__title"},Qe={key:0},Xe={class:"list-item__prompt"},ze={key:7},Ge={key:8,class:"additional-service__inline-price"},Je={__name:"ServiceListOrderSelection",props:X({sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},{modelValue:{type:Object},modelModifiers:{}}),emits:X(["updateList"],["update:modelValue"]),setup(l,{emit:K}){const a=l,j=de(l,"modelValue"),C=he(),i=be(),A=ce(),v=pe(),R=ve(),s=_({});_(null),_(null);const N=_(null),p=_(""),w=_(null),b=_(!1),Y=D(()=>C.contractsList[N.value]),q=D(()=>Object.keys(i.additionalServicesScheme[a.sectionData?.Code]||{})?.map(e=>{const t=i?.additionalServicesScheme[a.sectionData?.Code][e]?.DependOrders||{},o=Object.keys(t);return{...i?.additionalServicesScheme[a.sectionData?.Code][e],value:i?.additionalServicesScheme[a.sectionData?.Code][e]?.ID,price:i?.additionalServicesScheme[a.sectionData?.Code][e]?.CostMonth,name:i?.additionalServicesScheme[a.sectionData?.Code][e]?.Name,dependOrders:o}}).sort((e,t)=>Number(e?.SortID)<Number(t?.SortID)?-1:Number(e?.SortID)>Number(t?.SortID)?1:0).filter(e=>p.value==="0"?e.IsActive&&e.dependOrders.length===0:p.value===null||p.value===""?e.IsActive:e.IsActive&&e.dependOrders.includes(p.value))),Z=D(()=>{let e=!1;return x.value?.forEach(t=>{t?.IsDuty&&(s.value[`ID${t?.ID}`]===null||s.value[`ID${t?.ID}`]===void 0||s.value[`ID${t?.ID}`]==="")&&(e=!0)}),e}),E=D(()=>a.sectionData?.ServicesFields?.filter(e=>e?.TypeID==="Select").sort((e,t)=>Number(e?.SortID)<Number(t?.SortID)?-1:Number(e?.SortID)>Number(t?.SortID)?1:0)||[]),x=D(()=>a.sectionData?.ServicesFields?.filter(e=>e?.TypeID==="Input").sort((e,t)=>Number(e?.SortID)<Number(t?.SortID)?-1:Number(e?.SortID)>Number(t?.SortID)?1:0)||[]),U=D(()=>{let e=[];const t=i?.additionalServicesScheme[a.sectionData?.Code];if(a.sectionData?.Code==="Default"){const c=Object.keys(i?.ServicesList)?.map(f=>({...i?.ServicesList[f],value:i?.ServicesList[f]?.ID})).filter(f=>f?.ID===R.query.ServiceID);if(c.length>0){const f=c[0].DependOrders;f&&(e=Object.entries(f).map(([O,n])=>({name:n,value:O})))}return e}if(!t)return e;const o=Object.values(t).filter(c=>c?.IsActive&&c?.DependOrders).flatMap(c=>Object.entries(c.DependOrders)),m=new Map;o.forEach(([c,f])=>{const O=`${c}:${f}`;m.has(O)||m.set(O,{name:f,value:c})});const I=Array.from(m.values());return a.sectionID==51e3?e=[{name:"Без заказа",value:"0"},...I]:e=I,e}),ee=D(()=>{const e=i?.additionalServicesScheme[a.sectionData?.Code];return e?Object.values(e).filter(o=>o?.IsActive&&o?.DependOrders).flatMap(o=>Object.entries(o.DependOrders)).map(([o,m])=>({name:m,value:o})):[]});D(()=>{const e=s.value[`${a.sectionData?.Code}SchemeID`]?.ID,t=i?.additionalServicesScheme[a.sectionData?.Code];if(!e)return ee.value;const o=t?.[e];return o&&o.DependOrders?Object.entries(o.DependOrders).map(([m,I])=>({name:I,value:m})):[]});const te=D(()=>Number(Y.value?.Balance)>B.value?"Оплатить c баланса договора":"Заказать"),ae=D(()=>"1 "+a.sectionData?.ID==5e4||a.sectionData?.ID==51e3||a.sectionData?.ID==52e3?"месяц":a.sectionData?.Measure);g(()=>a.sectionID,()=>{p.value=""});const H=e=>{e.key==="Enter"&&e.ctrlKey&&W()};F(()=>{document.addEventListener("keyup",H)}),fe(()=>{document.removeEventListener("keyup",H)});function ne(){v.go(0)}const B=D(()=>{let e=0;return Object.values(s.value).map(t=>{t?.price&&(e=e+Number(t.price))}),e+Number(a.sectionData?.Cost)+Number(a.sectionData?.CostOn)});function L(e){return e?.Options?.split(`
`)?.map(t=>{let o=t.split("=");return{value:o[0],name:o[1],price:o[2]}})}function oe(){return a.sectionID==5e4&&U.value.length<1}function W(){b.value=!0;let e={};Object.keys(s.value)?.forEach(t=>{e[t]=s.value[t]?.value?s.value[t]?.value:s.value[t]}),e.ContractID=N.value,e.ServiceID=a.sectionID,e.DependOrderID=p.value,p.value==="0"&&(e.IP=w.value),a.sectionID==5e4?i.ExtraIPOrder(e).then(({result:t,info:o})=>{b.value=!1,t==="SUCCESS"?v.push(`/ExtraIPOrderPay/${o.OrderID}`):t==="BASKET"&&v.push("/Basket")}):a.sectionID==51e3?i.ISPswOrder(e).then(({result:t,info:o})=>{b.value=!1,t==="SUCCESS"?v.push(`/ISPswOrderPay/${o.OrderID}`):t==="BASKET"&&v.push("/Basket")}):a.sectionID==52e3?i.DNSmanagerOrder(e).then(({result:t,info:o})=>{b.value=!1,t==="SUCCESS"?v.push(`/DNSmanagerOrderPay/${o.OrderID}`):t==="BASKET"&&v.push("/Basket")}):i.ServiceOrder(e).then(({result:t,info:o})=>{t==="SUCCESS"?i.ServiceOrderPay(a.sectionData?.Code,{AmountPay:"1",ServiceOrderID:o?.ServiceOrderID,IsChange:!0},{XMLHttpRequest:"yes"}).then(m=>{let{result:I}=m;I==="SUCCESS"?v.push(`/AdditionalServices?ServiceID=${a.sectionID}`):I==="BASKET"&&v.push("/Basket"),b.value=!1}):b.value=!1})}function Q(){let e={};Object.keys(s.value)?.forEach(t=>{e[t]=s.value[t]?.value?s.value[t]?.value:s.value[t]}),e.ServiceID=a.sectionID,e.Price=B.value,e.Name=i.ServicesList[e.ServiceID].Name,j.value=e}function M(){if(a.modelValue){const e=Object.keys(a.modelValue)?.find(t=>t.includes("SchemeID"));e&&(s.value[e]?.ID||(s.value[e]={}),s.value[e].ID=a.modelValue[e])}}return g(R,()=>{M(),a.updateWithPageTransition&&(E.value?.forEach(e=>{s.value[`ID${e?.ID}`]&&(s.value[`ID${e?.ID}`]=L(e)?.find(t=>t.value===e?.Default))}),a.sectionData?.Code!=="Default"&&i.fetchAdditionalServiceScheme(a.sectionData?.Code))}),g(s.value,()=>{Q()}),g(a,()=>{M()}),F(async()=>{E.value?.forEach(e=>{s.value[`ID${e?.ID}`]=L(e)?.find(t=>t.value===e?.Default)}),a.sectionData?.Code!=="Default"&&await i.fetchAdditionalServiceScheme(a.sectionData?.Code),await A.fetchDomainOrders(),M(),Q()}),(e,t)=>{const o=_e,m=Ie,I=Se,c=Ne,f=re,O=le;return u(),d(V,null,[l.isInline?S("",!0):(u(),d("section",Ee,[r("div",Be,[r("h1",{class:"section-title",onClick:t[0]||(t[0]=n=>ne())},h(l.sectionData?.Item),1),k(o,{partition:`Header:${l.sectionData?.Code==="Default"?l.sectionID:`/${l.sectionData?.Code}Orders`}`},null,8,["partition"])])])),l.isInline?S("",!0):(u(),T(m,{key:1,modelValue:N.value,"onUpdate:modelValue":t[1]||(t[1]=n=>N.value=n),class:"additional-service__contract-select",title:"Договор"},null,8,["modelValue"])),p.value==0&&l.sectionID==51e3?(u(),d("div",Pe,[t[6]||(t[6]=r("div",{class:"form-field__label"},[$(" IP адрес лицензии "),r("span",null,"*")],-1)),r("div",je,[k(I,{name:"ServiceIP",placeholder:"0.0.0.0",modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=n=>w.value=n)},null,8,["modelValue"])])])):S("",!0),U.value?.length>0?(u(),d("div",Ae,[t[7]||(t[7]=r("div",{class:"form-field__label"},[$(" Выбрать заказ "),r("span",null,"*")],-1)),r("div",we,[k(J(Oe),{placeholder:"Все заказы",class:"multiselect--white",label:"name","track-by":"value",options:U.value,modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=n=>p.value=n)},{option:z(({option:n})=>[r("div",xe,h(n.name),1)]),_:1},8,["options","modelValue"])])])):S("",!0),x.value?.length>0?(u(!0),d(V,{key:4},P(x.value,n=>(u(),d("div",{class:"form-field form-field--basic",key:n?.ID},[r("div",Ue,[$(h(n?.Name)+" ",1),n?.IsDuty?(u(),d("span",Le,"*")):S("",!0)]),r("div",Me,[me(r("input",{title:n?.Prompt,name:`ID${n?.ID}`,"onUpdate:modelValue":y=>s.value[`ID${n?.ID}`]=y},null,8,Te),[[De,s.value[`ID${n?.ID}`]]])])]))),128)):S("",!0),l.sectionData?.Code!=="Default"&&q.value?.length>0?(u(),d("section",Fe,[r("div",Ke,[r("div",Re,[t[8]||(t[8]=r("div",{class:"list-item__title"},[$(" Тариф "),r("span",null,"*")],-1)),(u(!0),d(V,null,P(q.value,n=>(u(),T(c,{key:n.value,name:`${l.sectionData?.Code}SchemeID`,checkbox:!1,data:n,modelValue:s.value[`${l.sectionData?.Code}SchemeID`],"onUpdate:modelValue":t[4]||(t[4]=y=>s.value[`${l.sectionData?.Code}SchemeID`]=y),disabled:oe()},null,8,["name","data","modelValue","disabled"]))),128))])])])):S("",!0),E.value?.length>0?(u(),d("section",qe,[r("div",He,[(u(!0),d(V,null,P(E.value,n=>(u(),d("div",{class:"list-col list-col--md",key:n?.ID},[r("div",We,[$(h(n?.Name)+" ",1),n?.IsDuty?(u(),d("span",Qe,"*")):S("",!0)]),(u(!0),d(V,null,P(L(n),y=>(u(),T(c,{key:y.value,name:`ID${n?.ID}`,checkbox:!1,data:y,modelValue:s.value[`ID${n?.ID}`],"onUpdate:modelValue":se=>s.value[`ID${n?.ID}`]=se},{default:z(()=>[r("div",Xe,h(n?.Prompt),1)]),_:2},1032,["name","data","modelValue","onUpdate:modelValue"]))),128))]))),128))])])):S("",!0),l.isInline?(u(),d("div",Ge,h(B.value)+" ₽",1)):(u(),d("section",ze,[k(f,{tariff:{label:ae.value,price:B.value}},null,8,["tariff"]),k(O,{class:"btn--wide",disabled:Z.value||!s.value[`${l.sectionData.Code}SchemeID`]&&l.sectionData?.Code!=="Default",label:te.value,"is-loading":b.value,onClick:t[5]||(t[5]=n=>W())},null,8,["disabled","label","is-loading"])]))],64)}}},ut=G(Je,[["__scopeId","data-v-53f7307b"]]);export{ut as _};
