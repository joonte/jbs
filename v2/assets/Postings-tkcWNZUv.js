import{_ as x}from"./EmptyStateBlock-CV1Zaaf7.js";import{L as U,a as F}from"./bootstrap-vue-next-CxxkTytZ.js";import{_ as M}from"./FormInputSearch-DhLeThyA.js";import{_ as A}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as O}from"./BlockBalanceAgreement-DjWMZ940.js";import{u as T}from"./postings-D5DA40Zz.js";import{u as E}from"./contracts-BdlSA9YT.js";import{s as R}from"./multiselect-eqvbz1NV.js";import{c as k,b as c,a as o,D as Z,w as r,G as j,F as S,i as q,r as i,h as z,g as G,f as u,d as H,o as b,t as n,n as J}from"./index-XtiBO-PZ.js";import{f as K,s as Q}from"./time-DenPiOX5.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-DYth91EZ.js";import"./IconClose-s_NQ_Q4c.js";import"./ButtonDefault-eJbeaBtE.js";const X=[{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"ServiceID",label:"Операция"},{key:"Comment",label:"Примечание"},{key:"Before",variant:"td-gray td-order",label:"До"},{key:"After",variant:"td-gray td-order",label:"После"},{key:"Change",variant:"td-gray td-order",label:"Сумма",sortable:!0}],Y={components:{Multiselect:R},async setup(){const p=E(),t=T(),L=G(),s=H(),g=i(""),m=i("*"),f=i(1),v=i(10),_=i([10,25,50,100]),C=i("CreateDate"),y=i(!0),D=i("desc");z(async()=>{await p.fetchContracts(),await t.fetchPostings(),await t.fetchServices();const a=L.query.ContractID;a&&(m.value=a||"*")});const d=u(()=>Object.keys(t?.postingsList).map(a=>({...t?.postingsList[a],Customer:P.value?.[t?.postingsList[a].ContractID]?.Customer,Change:I(t?.postingsList[a]?.Before,t?.postingsList[a]?.After)}))),e=u(()=>t?.servicesList),P=u(()=>p.contractsList),V=u(()=>{let a=[];return d.value.map(l=>{if(!a.find(h=>h===l.Customer))return a.push(l.Customer),{value:l.ContractID,name:l.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),B=u(()=>d.value.filter(a=>a.Comment.toLowerCase().includes(g.value?.toLowerCase())||a.Customer.toLowerCase().includes(g.value?.toLowerCase())).filter(a=>a.ContractID.includes(m.value!=="*"?m.value:"")).length);function I(a,l){return l-a>0,Number(Math.round((l-a+Number.EPSILON)*100)/100)}function N(){s.go(0)}function w(){f.value=1}return await p.fetchContracts(),await t.fetchPostings(),await t.fetchServices(),{search:g,select:m,getContracts:P,getUsers:V,getPostings:d,getServices:e,currentPage:f,perPage:v,sortBy:C,sortDesc:y,sortDirection:D,pageOptions:_,filteredContractsLength:B,postingsFields:X,setPageToZero:w,secondToDate:Q,formNormalDate:K,calculateChange:I,reloadNow:N}}},$={class:"section"},ee={class:"container"},te={class:"section-header"},se={class:"list-form"},oe={class:"list-form_col list-form_col--sm"},ae={class:"list-form_select"},ne={class:"multiselect-option"},re={class:"d-block"},le={class:"d-block"},ie={class:"d-block"},ce={key:0,class:"table-controls"},me={class:"multiselect-multiple-label"},de={class:"multiselect-option"};function ue(p,t,L,s,g,m){const f=O,v=A,_=j("Multiselect"),C=M,y=U,D=F,d=x;return b(),k(S,null,[c(f),o("section",$,[o("div",ee,[o("div",te,[o("h1",{class:"section-title",onClick:t[0]||(t[0]=e=>s.reloadNow())},"История операций")]),c(v),o("div",se,[o("div",oe,[o("div",ae,[c(_,{modelValue:s.select,"onUpdate:modelValue":t[1]||(t[1]=e=>s.select=e),options:s.getUsers,disabled:s.getUsers?.length<=1,label:"name","track-by":"value"},{singlelabel:r(({value:e})=>[o("span",null,"# "+n(e.value.padStart(5,"0"))+" / "+n(e.name),1)]),option:r(({option:e})=>[o("span",ne,"# "+n(e.value.padStart(5,"0"))+" / "+n(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),c(C,{modelValue:s.search,"onUpdate:modelValue":t[2]||(t[2]=e=>s.search=e)},null,8,["modelValue"])]),s.getPostings&&s.getPostings?.length>0?(b(),k(S,{key:0},[c(y,{class:"basic-table",items:s.getPostings.filter(e=>e.ContractID.includes(s.select!=="*"?s.select:"")),fields:s.postingsFields,"show-empty":!0,filter:s.search,"per-page":s.perPage,"current-page":s.currentPage,filterable:["Customer","Comment"],"sort-by":s.sortBy,"onUpdate:sortBy":t[3]||(t[3]=e=>s.sortBy=e),"sort-desc":s.sortDesc,"onUpdate:sortDesc":t[4]||(t[4]=e=>s.sortDesc=e),"sort-direction":s.sortDirection,"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Операций пока нет.","empty-filtered-text":"Операции не найдены.",onFiltered:s.setPageToZero},{"cell(CreateDate)":r(e=>[t[8]||(t[8]=o("span",{class:"td-mobile"},"Дата Создания",-1)),o("span",re,n(s.formNormalDate(s.secondToDate(e.item?.CreateDate))),1)]),"cell(ContractID)":r(e=>[t[9]||(t[9]=o("span",{class:"td-mobile"},"Договор",-1)),o("span",null,"#"+n(e.item?.ContractID)+" / "+n(e.item?.Customer),1)]),"cell(Before)":r(e=>[t[10]||(t[10]=o("span",{class:"td-mobile"},"До",-1)),o("span",le,n(e.value),1)]),"cell(After)":r(e=>[t[11]||(t[11]=o("span",{class:"td-mobile"},"После",-1)),o("span",ie,n(e.value),1)]),"cell(ServiceID)":r(e=>[t[12]||(t[12]=o("span",{class:"td-mobile"},"Операция",-1)),o("span",null,n(s.getServices?.[e.item?.ServiceID]?.Name),1)]),"cell(Change)":r(e=>[t[13]||(t[13]=o("span",{class:"td-mobile"},"Сумма",-1)),o("span",{class:J(["d-block",{positive:e.value>0,negative:e.value<0}])},n(e.value>0?`+${e.value}`:e.value)+" ₽ ",3)]),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),s.filteredContractsLength>0?(b(),k("div",ce,[c(D,{modelValue:s.currentPage,"onUpdate:modelValue":t[5]||(t[5]=e=>s.currentPage=e),"total-rows":s.filteredContractsLength,"per-page":s.perPage,"first-number":"","last-number":""},{"first-text":r(()=>t[14]||(t[14]=[o("span",{class:"text-success"},"First",-1)])),"last-text":r(()=>t[15]||(t[15]=[o("span",{class:"text-info"},"Last",-1)])),page:r(({page:e,active:P})=>[o("span",null,n((e-1)*s.perPage+1)+"-"+n(e*s.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),c(_,{class:"multiselect--white",modelValue:s.perPage,"onUpdate:modelValue":t[6]||(t[6]=e=>s.perPage=e),options:s.pageOptions,label:"name",openDirection:"top",onInput:t[7]||(t[7]=e=>s.currentPage=1)},{singlelabel:r(({value:e})=>[o("span",me," Отображать "+n(e.value)+" строк ",1)]),option:r(({option:e})=>[o("span",de," Отображать "+n(e.name)+" строк ",1)]),_:1},8,["modelValue","options"])])):q("",!0)],64)):(b(),Z(d,{key:1,label:"Ваша история операций пуста"}))])])],64)}const Ve=W(Y,[["render",ue],["__scopeId","data-v-f4b2abfb"]]);export{Ve as default};
