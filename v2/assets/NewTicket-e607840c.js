import{j as x,o as b,c as k,a as l,b as u,w as y,d as M,n as g,t as w,Y as L,ae as j,F as B,v as O,k as S,p as z,l as K,_ as R,u as Y,e as A,r as C,g as P}from"./index-ed1f28f8.js";import{u as H}from"./edesks-35dea09d.js";import{u as J}from"./files-d0c0dbbe.js";import{_ as F}from"./BasicInput-13cf2877.js";import{s as Q}from"./multiselect-198a8c51.js";import{I as W}from"./IconUpload-eac4cb9a.js";import{I as U}from"./IconFile-69b8a8f8.js";import{I as N}from"./IconClose-a1e58263.js";import{_ as q}from"./ClausesKeeper-9aa8ead7.js";import{_ as X}from"./IconClip-e63d2ee8.js";import"./component2-08856ab6.js";import"./component-cdbc2d35.js";const f=t=>(z("data-v-c3fa6f66"),t=t(),K(),t),Z={class:"section"},$={class:"container"},ee={class:"section-header"},le=f(()=>l("h1",{class:"section-title"},"Создать тикет",-1)),oe={class:"form-field form-field--basic"},se=f(()=>l("div",{class:"form-field__label"},"Отдел",-1)),te={class:"form-field-input__wrapper"},ae={class:"multiselect-option"},ie={class:"form-field form-field--basic"},re=f(()=>l("div",{class:"form-field__label"},"Приоритет",-1)),ne={class:"form-field-input__wrapper"},ce={class:"multiselect-option"},ue={class:"form-field form-field--textarea form-field--basic"},fe=f(()=>l("div",{class:"form-field__label"},"Сообщение",-1)),de={class:"form-field-input__wrapper"},_e={key:0,class:"form-field form-field--file form-field--basic"},me=f(()=>l("div",{class:"form-field__label"},null,-1)),pe={class:"form-field-input__wrapper"},ve={class:"chat-files"},he={class:"chat-files__item"},be=["onClick"],ke={class:"form-field form-field--file form-field--basic"},ge=f(()=>l("div",{class:"form-field__label"},null,-1)),Ie={class:"form-field-input__wrapper"},De={class:"form-field-input__file"},Ee=f(()=>l("span",null,"Прикрепить файл",-1)),ye={class:"form-offset_label"},we=f(()=>l("span",null,"Отправить",-1)),Ce=[we];function Te(t,a,T,o,i,I){const d=x("router-link"),p=q,v=F,h=x("Multiselect"),D=U,E=N,s=X;return b(),k("div",Z,[l("div",$,[l("div",ee,[u(d,{class:"section-label",to:"/Tickets"},{default:y(()=>[M("Служба поддержки")]),_:1}),le]),u(p),u(v,{class:g({"form-error":o.formData.theme.isError}),label:"Тема запроса",placeholder:"Заголовок",name:"login",modelValue:o.formData.theme.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.formData.theme.value=e)},null,8,["class","modelValue"]),l("label",oe,[se,l("div",te,[u(h,{class:g({"multiselect--white":!0,"form-error":o.formData.selectGroup.isError}),modelValue:o.formData.selectGroup.value,"onUpdate:modelValue":a[1]||(a[1]=e=>o.formData.selectGroup.value=e),options:o.getTicketGroups,label:"name"},{option:y(({option:e})=>[l("div",ae,w(e.name),1)]),_:1},8,["class","modelValue","options"])])]),l("label",ie,[re,l("div",ne,[u(h,{class:g({"multiselect--white":!0,"form-error":o.formData.selectPriority.isError}),modelValue:o.formData.selectPriority.value,"onUpdate:modelValue":a[2]||(a[2]=e=>o.formData.selectPriority.value=e),options:o.getEDeskPriorities,label:"name"},{option:y(({option:e})=>[l("div",ce,w(e.name),1)]),_:1},8,["class","modelValue","options"])])]),l("label",ue,[fe,l("div",de,[L(l("textarea",{class:g({"form-error":o.formData.message.isError}),placeholder:"Опишите проблему, указав сервер размещения, вашу учётную запись на сервере, имя сайта, УРЛ ошибки и способ её воспроизведения.","onUpdate:modelValue":a[3]||(a[3]=e=>o.formData.message.value=e)},null,2),[[j,o.formData.message.value]])])]),o.fileList.length?(b(),k("div",_e,[me,l("div",pe,[l("div",ve,[(b(!0),k(B,null,O(o.fileList,(e,r)=>(b(),k("div",he,[l("span",null,[u(D,{class:"file-icon"})]),l("span",null,w(e==null?void 0:e.name),1),l("button",{class:"close",onClick:n=>o.removeFile(r)},[u(E)],8,be)]))),256))])])])):S("",!0),l("label",ke,[ge,l("div",Ie,[l("input",{ref:"fileInput",type:"file",onChange:a[4]||(a[4]=(...e)=>o.fileUpload&&o.fileUpload(...e))},null,544),l("div",De,[u(s),Ee])])]),l("div",ye,[l("button",{class:"btn btn--blue btn-default",onClick:a[5]||(a[5]=e=>o.createTicket())},Ce)])])])}const Ve={components:{IconUpload:W,IconFile:U,IconClose:N,BasicInput:F,Multiselect:Q,ClausesKeeper:q},async setup(){const t=H(),a=Y(),T=J(),o=A(),i=C({theme:{value:null,required:!0,isError:!1},selectGroup:{value:null,required:!0,isError:!1},selectPriority:{value:null,required:!0,isError:!1},message:{value:null,required:!0,isError:!1},file:{value:null,required:!1,isError:!1}}),I=C(null),d=C([]),p=P(()=>{var s;return(s=Object.keys((t==null?void 0:t.eDeskGroups)||[]))==null?void 0:s.map(e=>{var r,n,_,m;return{value:(n=(r=t==null?void 0:t.eDeskGroups)==null?void 0:r[e])==null?void 0:n.ID,name:(m=(_=t==null?void 0:t.eDeskGroups)==null?void 0:_[e])==null?void 0:m.Name}})}),v=P(()=>{var s,e;return(e=(s=a==null?void 0:a.ConfigList)==null?void 0:s.Edesks)==null?void 0:e.Priorities});function h(s){var e;i.value.file.value=((e=s.target.files)==null?void 0:e[0])||null,i.value.file.value&&(I.value.value="",T.sendFile(i.value.file.value).then(r=>{var n;d.value.push({name:(n=i.value.file.value)==null?void 0:n.name,value:r.slice(r.lastIndexOf("^")+1,r.length)})}))}function D(){var e,r,n,_,m;let s=!1;Object.keys(i.value).map(c=>{var V,G;(V=i.value)!=null&&V[c].required&&((G=i.value)==null?void 0:G[c].value)===null&&(i.value[c].isError=!0,s=!0)}),s||t.ticketEdit({Theme:((e=i.value)==null?void 0:e.theme.value)||null,TargetGroupID:((r=i.value)==null?void 0:r.selectGroup.value)||null,PriorityID:((n=i.value)==null?void 0:n.selectPriority.value)||null,Message:((_=i.value)==null?void 0:_.message.value)||null,TicketMessageFile:((m=d.value)==null?void 0:m.map(c=>c==null?void 0:c.value))||null}).then(c=>{c==="success"&&o.push({name:"default.Tickets"})})}function E(s){d.value=d.value.filter((e,r)=>r!==s)}return await t.fetchTicketGroups().then(()=>{var s,e,r;i.value.selectGroup.value=(e=(s=p.value)==null?void 0:s[0])==null?void 0:e.value,i.value.selectPriority.value=(r=Object.keys(v.value))==null?void 0:r[0]}),{getTicketGroups:p,getEDeskPriorities:v,formData:i,fileList:d,fileInput:I,removeFile:E,fileUpload:h,createTicket:D}}},Se=R(Ve,[["render",Te],["__scopeId","data-v-c3fa6f66"]]);export{Se as default};
