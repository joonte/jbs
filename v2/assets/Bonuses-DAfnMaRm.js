import{_ as R}from"./EmptyStateBlock-Ad1AmtSS.js";import{L as q,a as F}from"./bootstrap-vue-next-BglOzul_.js";import{_ as z}from"./ButtonDefault-B1FApUky.js";import{ak as H,r as i,al as V,am as U,d as h,H as I,c as x,o as b,a as t,b as k,J,X,f as $,s as G,C as S,F as E,h as K,w as _,t as f,v as y,g as Q,D as j,n as N}from"./index-C9dBN6m4.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as M}from"./multiselect-B6DlyfA6.js";import{f as A,s as O}from"./time-DenPiOX5.js";import{_ as W}from"./ClausesKeeper-gPyacQ05.js";import{_ as Y}from"./BlockBalanceAgreement-DSLTUOoQ.js";import{u as Z}from"./promoStore-DvQPLn81.js";import"./IconClose-CgjzG0Yf.js";import"./contracts-BEc0DZS2.js";import"./index-D0iqQ1zq.js";const P=H("bonuses",()=>{const w=i(null),r=i(null);async function p(o){const e=await V.post(U.bonuses,o);e?.data&&(w.value=e.data)}async function d(o){const e=await V.post(U.promoCodes,o);e?.data&&(r.value=e.data)}async function C(o){let e="ERROR",c=null;return(await V.post(U.PromoCodesActivate,o))?.data?.Status==="Ok"&&(e="SUCCESS"),{result:e,error:c}}return{bonusesList:w,promosList:r,fetchBonuses:p,fetchPromos:d,PromoCodesActivate:C}}),ee={class:"promo-field"},te={class:"promo-field-input form-field"},oe={__name:"ActivatePromo",props:{promoCode:{type:String,default:""}},emits:["update"],setup(w,{emit:r}){const p=w,d=r,C=P(),o=h(),e=i(!1),c=i("");function v(){c.value.length>0&&(e.value=!0,C.PromoCodesActivate({Code:c.value}).then(g=>{const{result:m}=g;m==="SUCCESS"&&d("update"),e.value=!1}))}return I(()=>{o.currentRoute.value.query.PromoCode?(c.value=o.currentRoute.value.query.PromoCode,v()):p.promoCode&&(c.value=p.promoCode)}),(g,m)=>{const s=z;return b(),x("div",ee,[m[1]||(m[1]=t("div",{class:"promo-field-text"},"Промокод",-1)),t("div",te,[J(t("input",{type:"text",name:"promo-code","onUpdate:modelValue":m[0]||(m[0]=u=>c.value=u)},null,512),[[X,c.value]])]),k(s,{"is-loading":e.value,label:"Применить",onClick:v},null,8,["is-loading"])])}}},se=T(oe,[["__scopeId","data-v-2d145d73"]]),ne=[{key:"CreateDate",label:"Дата активации",variant:"td-gray",sortable:!0},{key:"ApplyTo",label:"Тариф/Группа",variant:"td-blue"},{key:"PromoCode",label:"Промокод"}],ae={class:"promo-block block--wrapper"},le={key:0,class:"table-controls"},re={class:"multiselect-multiple-label"},ue={class:"multiselect-option"},ie={__name:"PromosBlock",props:{promoCode:{type:String,default:""}},setup(w){const r=P(),p=i("CreateDate"),d=i(!0),C=i("desc"),o=i(1),e=i(10),c=i([10,25,50,100]),v=$(()=>Object.keys(r?.promosList)?.map(u=>r?.promosList[u])),g=$(()=>Object.keys(r?.promosList)?.length);function m(){r.fetchBonuses(),r.fetchPromos()}const s=u=>{u.key==="Enter"&&u.ctrlKey&&m()};return I(()=>{document.addEventListener("keyup",s)}),G(()=>{document.removeEventListener("keyup",s)}),(u,a)=>{const B=se,n=q,D=F,L=R;return b(),x(E,null,[t("div",ae,[a[6]||(a[6]=t("div",{class:"promo-text"},"Активировать промокод",-1)),k(B,{onUpdate:a[0]||(a[0]=l=>m()),promoCode:w.promoCode},null,8,["promoCode"])]),v.value?(b(),x(E,{key:0},[k(n,{class:"basic-table",items:v.value,fields:y(ne),"show-empty":!0,"per-page":e.value,"current-page":o.value,"empty-text":"Промокодов пока нет.","empty-filtered-text":"Промокоды не найдены.","sort-desc":d.value,"onUpdate:sortDesc":a[1]||(a[1]=l=>d.value=l),"sort-by":p.value,"onUpdate:sortBy":a[2]||(a[2]=l=>p.value=l),"sort-direction":C.value},{"cell(CreateDate)":_(l=>[t("span",null,f(y(A)(y(O)(l?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),g.value>0?(b(),x("div",le,[k(D,{modelValue:o.value,"onUpdate:modelValue":a[3]||(a[3]=l=>o.value=l),"total-rows":g.value,"per-page":e.value,"first-number":"","last-number":""},{"first-text":_(()=>a[7]||(a[7]=[t("span",{class:"text-success"},"First",-1)])),"last-text":_(()=>a[8]||(a[8]=[t("span",{class:"text-info"},"Last",-1)])),page:_(({page:l,active:we})=>[t("span",null,f((l-1)*e.value+1)+"-"+f(l*e.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),k(y(M),{class:"multiselect--white",modelValue:e.value,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value=l),options:c.value,label:"name",openDirection:"top",onInput:a[5]||(a[5]=l=>o.value=1)},{singlelabel:_(({value:l})=>[t("div",re,[t("span",null,"Отображать "+f(l.value)+" строк",1)])]),option:_(({option:l})=>[t("div",ue,"Отображать "+f(l.name)+" строк",1)]),_:1},8,["modelValue","options"])])):K("",!0)],64)):(b(),S(L,{key:1,label:"Промокоды не найдены"}))],64)}}},pe=T(ie,[["__scopeId","data-v-ce5e72c3"]]),ce=[{key:"CreateDate",label:"Дата создания",variant:"td-gray",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray",sortable:!0},{key:"Display",label:"Тариф/Группа",variant:"td-blue"},{key:"DaysRemainded",label:"Дней осталось",sortable:!0},{key:"Discont",variant:"td-controls",label:"Скидка"},{key:"Comment",label:"Комментарий",variant:"td-gray"}],me={key:0},de={key:0,class:"table-controls"},ve={class:"multiselect-multiple-label"},_e={class:"multiselect-option"},be={__name:"BonusesBlock",setup(w){const r=P(),p=i("CreateDate"),d=i(!0),C=i("desc"),o=i(1),e=i(10),c=i([10,25,50,100]),v=$(()=>Object.keys(r?.bonusesList)?.map(m=>r?.bonusesList[m])),g=$(()=>Object.keys(r?.bonusesList)?.length);return(m,s)=>{const u=q,a=F,B=R;return v.value?(b(),x("div",me,[k(u,{class:"basic-table",items:v.value,fields:y(ce),"show-empty":!0,"per-page":e.value,"current-page":o.value,"empty-text":"Бонусов пока нет.","empty-filtered-text":"Бонусов не найдены.","sort-desc":d.value,"onUpdate:sortDesc":s[0]||(s[0]=n=>d.value=n),"sort-by":p.value,"onUpdate:sortBy":s[1]||(s[1]=n=>p.value=n),"sort-direction":C.value},{"cell(CreateDate)":_(n=>[t("span",null,f(y(A)(y(O)(n?.value))),1)]),"cell(ExpirationDate)":_(n=>[t("span",null,f(y(A)(y(O)(n?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),g.value>0?(b(),x("div",de,[k(a,{modelValue:o.value,"onUpdate:modelValue":s[2]||(s[2]=n=>o.value=n),"total-rows":g.value,"per-page":e.value,"first-number":"","last-number":""},{"first-text":_(()=>s[5]||(s[5]=[t("span",{class:"text-success"},"First",-1)])),"last-text":_(()=>s[6]||(s[6]=[t("span",{class:"text-info"},"Last",-1)])),page:_(({page:n,active:D})=>[t("span",null,f((n-1)*e.value+1)+"-"+f(n*e.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),k(y(M),{class:"multiselect--white",modelValue:e.value,"onUpdate:modelValue":s[3]||(s[3]=n=>e.value=n),options:c.value,label:"name",openDirection:"top",onInput:s[4]||(s[4]=n=>o.value=1)},{singlelabel:_(({value:n})=>[t("div",ve,[t("span",null,"Отображать "+f(n.value)+" строк",1)])]),option:_(({option:n})=>[t("div",_e,"Отображать "+f(n.name)+" строк",1)]),_:1},8,["modelValue","options"])])):K("",!0)])):(b(),S(B,{key:1,label:"Бонусов не найдено"}))}}},fe={class:"tw-px-4 md:tw-px-8"},ye={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},ge={class:"tw-mb-6"},ke={class:"tw-flex tw-items-center tw-border-b tw-border-gray-200 tw-mt-4 tw-whitespace-nowrap"},Ce={__name:"Bonuses",async setup(w){let r,p;const d=P(),C=Z(),o=i("bonuses"),e=h(),c=Q(),v=C.promoCode;function g(){e.go(0)}function m(s){e.replace(`/Bonuses?section=${s}`),o.value=s}return I(()=>{v&&d.PromoCodesActivate({Code:v}).then(s=>{const{result:u}=s;u==="SUCCESS"&&emit("update"),e.replace("/Bonuses?section=promos"),o.value="promos"}),c?.query?.section?o.value=c?.query?.section:e.replace("/Bonuses?section=bonuses")}),[r,p]=j(()=>d.fetchBonuses()),await r,p(),[r,p]=j(()=>d.fetchPromos()),await r,p(),(s,u)=>{const a=Y,B=W,n=be,D=pe,L=R;return b(),x(E,null,[k(a),t("div",fe,[t("div",ye,[t("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:u[0]||(u[0]=l=>g())},"Бонусы и промокоды")]),k(B),t("div",ge,[t("div",ke,[t("div",{class:N(["section-nav__item",{"section-link":!0,"section-link-active":o.value==="bonuses"}]),onClick:u[1]||(u[1]=l=>m("bonuses"))}," Бонусы ",2),t("div",{class:N(["section-nav__item",{"section-link":!0,"section-link-active":o.value==="promos"}]),onClick:u[2]||(u[2]=l=>m("promos"))}," Промокоды ",2)])]),o.value==="bonuses"?(b(),S(n,{key:0})):o.value==="promos"?(b(),S(D,{key:1,promoCode:y(v)},null,8,["promoCode"])):(b(),S(L,{key:2,label:"Секция не найдена"}))])],64)}}},Ie=T(Ce,[["__scopeId","data-v-e27bb065"]]);export{Ie as default};
