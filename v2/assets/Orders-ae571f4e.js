import{C as ae,F as le}from"./bootstrap-vue-next.es-759b1c9f.js";import{_ as ne}from"./IconCard-647fe573.js";import{S as oe}from"./StatusBadge-cd3873b5.js";import{_ as ue}from"./FormInputSearch-a9f5bea5.js";import{_ as ce}from"./ClausesKeeper-d3875457.js";import{_ as ie,e as re,a7 as pe,f as de,u as ve,S as me,r as _,g as v,ag as R,o as G,c as H,b as c,a,w as o,t as u,M as h,k as _e,F as fe,p as be,l as De}from"./index-145d9cde.js";import{u as Se}from"./contracts-009c925b.js";import{u as ge}from"./services-42f7a1d0.js";import{f as J}from"./useTimeFunction-8602dd60.js";import{_ as he}from"./HelperComponent-3b7b2692.js";import{s as x}from"./multiselect-a2d623ca.js";import{B as Ie}from"./BlockBalanceAgreement-650ad03e.js";import"./IconPlus-de34f4b6.js";import"./IconSearch-9c7c86ad.js";import"./IconClose-f461656c.js";import"./ButtonDefault-6a3a5e1e.js";import"./IconArrow-f2b12a71.js";const Ce=[{key:"ID",label:"Заказ",variant:"td-blue",sortable:!0},{key:"ServiceID",label:"Услуга",variant:"td-gray td-order bold"},{key:"SchemeName",label:"Тариф",variant:"td-gray td-order"},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"td-gray td-order"},{key:"ContractID",label:"Договор",sortable:!0,variant:"td-blue"},{key:"UserNotice",label:"Примечание",variant:"td-gray td-limited"},{key:"controls",label:"",variant:"td-controls"}];const i=I=>(be("data-v-e4b467f5"),I=I(),De(),I),ye={class:"section"},Ve={class:"container"},Oe=i(()=>a("div",{class:"section-header"},[a("h1",{class:"section-title"},"Мои заказы")],-1)),ke={class:"list-form"},xe={class:"list-form_col list-form_col--sm"},Ne={class:"list-form_select"},we={class:"multiselect-option"},Le={class:"list-form_col list-form_col--sm"},Re={class:"list-form_select"},Te={class:"multiselect-option"},Ue={class:"list-form_col list-form_col--sm"},Ee={class:"list-form_select"},Ae={class:"multiselect-option"},Be=i(()=>a("span",{class:"td-mobile"},"Заказ",-1)),$e=i(()=>a("span",{class:"td-mobile"},"Услуга",-1)),Fe=i(()=>a("span",{class:"td-mobile"},"Тариф",-1)),Pe=i(()=>a("span",{class:"td-mobile"},"Дата окончания",-1)),je=i(()=>a("span",{class:"td-mobile"},"Статус",-1)),Me=i(()=>a("span",{class:"td-mobile"},"Договор",-1)),qe=i(()=>a("span",{class:"td-mobile"},"Комментарий",-1)),ze={class:"btn__group"},Ge=["onClick"],He=i(()=>a("p",null,"ОПЛАТИТЬ",-1)),Je={key:0,class:"table-controls"},Ke=i(()=>a("span",{class:"text-success"},"First",-1)),Qe=i(()=>a("span",{class:"text-info"},"Last",-1)),We={class:"multiselect-multiple-label"},Xe={class:"multiselect-option"},Ye={__name:"Orders",async setup(I){let f,b;const C=re(),T=pe(),p=de(),y=Se(),U=ge(),N=ve();me("emitter").on("updateOrdersList",()=>{p.fetchUserOrders()});const w=_(""),D=_(10),g=_(1),K=_([10,25,50,100]),V=_("*"),O=_("*"),k=_("*"),d=v(()=>Object.keys(p==null?void 0:p.userOrders).map(s=>p==null?void 0:p.userOrders[s])),L=v(()=>{let s=d.value.filter(e=>e==null?void 0:e.ID.includes(w.value));return O.value!=="*"&&s!==null&&(s=s.filter(e=>e.ServiceID.includes(O.value))),V.value!=="*"&&s!==null&&(s=s.filter(e=>e.ContractID.includes(V.value))),k.value!=="*"&&s!==null&&(s=s.filter(e=>e.StatusID.includes(k.value))),g.value=1,s}),E=v(()=>y==null?void 0:y.contractsList);function Q(s){if(!s)return J(new Date);const e=new Date,l=new Date(e.getTime()+s*24*60*60*1e3);return J(l)}const m=v(()=>U.ServicesList),A=v(()=>{let s=[{value:"*",name:"Все договора"}];return d.value!==null?(d.value.map(e=>{var l;s.find(r=>r.value===(e==null?void 0:e.ContractID))||s.push({value:e==null?void 0:e.ContractID,name:(l=E.value[e==null?void 0:e.ContractID])==null?void 0:l.Customer})}),s):{value:"*",name:"Все договора"}}),B=v(()=>{let s=[{value:"*",name:"Все услуги"}];return d.value!==null?(d.value.map(e=>{var l;s.find(r=>r.value===(e==null?void 0:e.ServiceID))||s.push({value:e==null?void 0:e.ServiceID,name:(l=m.value[e==null?void 0:e.ServiceID])==null?void 0:l.NameShort})}),s):{value:"*",name:"Все услуги"}}),W=v(()=>{var s,e;return(e=(s=N==null?void 0:N.ConfigList)==null?void 0:s.Statuses)==null?void 0:e.Orders}),$=v(()=>{let s=[{value:"*",name:"Все статусы"}];return d.value!==null?(d.value.map(e=>{var l,r;s.find(S=>S.value===(e==null?void 0:e.StatusID))||s.push({value:e==null?void 0:e.StatusID,name:((r=(l=W.value)==null?void 0:l[e==null?void 0:e.StatusID])==null?void 0:r.Name)||(e==null?void 0:e.StatusID)})}),s):{value:"*",name:"Все статусы"}});function X(s){var e,l;return((e=m.value[s])==null?void 0:e.Code)!=="Default"?((l=m.value[s])==null?void 0:l.Code)+"Orders":"Orders"}function Y(s){var l;let e=(l=m.value[s.ServiceID])==null?void 0:l.Code;e==="Default"?C.push(`/AdditionalServices/${s.ID}`):C.push(`/${e}Orders/${s.ID}`)}function Z(s){var l;let e=(l=m.value[s.ServiceID])==null?void 0:l.Code;e==="Default"?C.push(`/ServiceOrderPay/${s.ID}`):C.push(`/${e}OrderPay/${s.ID}`)}return[f,b]=R(()=>p.fetchUserOrders().then(()=>{var s,e;if((s=T.params)!=null&&s.id){const l=(e=d.value)==null?void 0:e.find(r=>{var S;return r.ID===((S=T.params)==null?void 0:S.id)});console.log(l),console.log(m)}})),await f,b(),[f,b]=R(()=>y.fetchContracts()),await f,b(),[f,b]=R(()=>U.fetchServices()),await f,b(),(s,e)=>{var F,P,j,M,q;const l=ce,r=ue,S=oe,ee=ne,te=ae,se=le;return G(),H(fe,null,[c(Ie),a("div",ye,[a("div",Ve,[Oe,c(l),a("div",ke,[c(r,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t)},null,8,["modelValue"]),a("div",xe,[a("div",Ne,[c(h(x),{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),options:A.value,disabled:((F=A.value)==null?void 0:F.length)<=1,label:"name"},{singlelabel:o(({value:t})=>[a("span",null,"# "+u(t.value.padStart(5,"0"))+" / "+u(t.name),1)]),option:o(({option:t})=>[a("div",we,"# "+u(t.value.padStart(5,"0"))+" / "+u(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",Le,[a("div",Re,[c(h(x),{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=t=>k.value=t),options:$.value,disabled:((P=$.value)==null?void 0:P.length)<=1,label:"name"},{option:o(({option:t})=>[a("div",Te,u(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",Ue,[a("div",Ee,[c(h(x),{modelValue:O.value,"onUpdate:modelValue":e[3]||(e[3]=t=>O.value=t),options:B.value,disabled:((j=B.value)==null?void 0:j.length)<=1,label:"name"},{option:o(({option:t})=>[a("div",Ae,u(t.name),1)]),_:1},8,["modelValue","options","disabled"])])])]),c(te,{class:"basic-table",fields:h(Ce),items:L.value,"show-empty":!0,"per-page":D.value,responsive:"","current-page":g.value,"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onRowClicked:Y},{"cell(ID)":o(t=>[Be,a("span",null,u(t.value),1)]),"cell(ServiceID)":o(t=>{var n;return[$e,a("span",null,u((n=m.value[t.value])==null?void 0:n.NameShort),1)]}),"cell(SchemeName)":o(t=>{var n;return[Fe,a("span",null,u((n=t.item)==null?void 0:n.SchemeName),1)]}),"cell(ExpirationDate)":o(t=>{var n,z;return[Pe,a("span",null,u(Q((n=t.item)==null?void 0:n.DaysRemainded))+" | "+u(((z=t.item)==null?void 0:z.DaysRemainded)||0)+" дн.",1)]}),"cell(StatusID)":o(t=>{var n;return[je,c(S,{status:t.value,"status-table":X((n=t.item)==null?void 0:n.ServiceID)},null,8,["status","status-table"])]}),"cell(ContractID)":o(t=>{var n;return[Me,a("span",null,u((n=E.value[t.value])==null?void 0:n.Customer),1)]}),"cell(UserNotice)":o(t=>{var n;return[qe,c(he,{"user-notice":t.value,id:(n=t.item)==null?void 0:n.ID,emit:"updateOrdersList"},null,8,["user-notice","id"])]}),"cell(controls)":o(t=>[a("div",ze,[a("button",{class:"btn btn-default btn--border",onClick:n=>Z(t.item)},[c(ee),He],8,Ge)])]),_:1},8,["fields","items","per-page","current-page"]),((M=L.value)==null?void 0:M.length)>0?(G(),H("div",Je,[c(se,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t),"total-rows":(q=L.value)==null?void 0:q.length,"per-page":D.value,"first-number":"","last-number":""},{"first-text":o(()=>[Ke]),"last-text":o(()=>[Qe]),page:o(({page:t,active:n})=>[a("span",null,u((t-1)*D.value+1)+"-"+u(t*D.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),c(h(x),{class:"multiselect--white",modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=t=>D.value=t),options:K.value,label:"name",openDirection:"top",onInput:e[6]||(e[6]=t=>g.value=1)},{singlelabel:o(({value:t})=>[a("div",We,[a("span",null,"Отображать "+u(t.value)+" строк",1)])]),option:o(({option:t})=>[a("div",Xe,"Отображать "+u(t.name)+" строк",1)]),_:1},8,["modelValue","options"])])):_e("",!0)])])],64)}}},bt=ie(Ye,[["__scopeId","data-v-e4b467f5"]]);export{bt as default};
