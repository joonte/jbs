import{_ as mt}from"./EmptyStateBlock-D6U_EDq6.js";import{L as ct,a as ut,v as pt,r as dt}from"./bootstrap-vue-next-3DpAa4tb.js";import{_ as _t}from"./IconDots-BE2XsWZ6.js";import{_ as vt}from"./IconCard-jY7IitfY.js";import{R as ft,c as S,o as D,n as It,L as yt,ao as bt,x as Dt,r as c,f,D as g,b as a,a as s,C as Ct,w as n,v as I,F as R,h as wt,d as gt,g as St,t as l,e as L,W as U}from"./index-CipWZKo_.js";import{_ as kt}from"./IconDownload-DHO-052I.js";import{_ as xt}from"./StatusBadge-B65ys1I-.js";import{_ as $t}from"./FormInputSearch-D7D7Vqhf.js";import{_ as Lt}from"./ClausesKeeper-DVJgfLR3.js";import{_ as Nt}from"./ButtonDefault-CghIUDY0.js";import{_ as Vt,f as Bt}from"./BlockBalanceAgreement-2iQbaweR.js";import{u as Pt}from"./postings-dJpYnOCG.js";import{u as Ft}from"./contracts-CILh9uSu.js";import{s as E}from"./multiselect-DWCHRlfT.js";import{f as Tt,s as ht}from"./time-DenPiOX5.js";import{_ as Rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-bAw7b_ly.js";import"./IconClose-ChC2G6HM.js";const Ut=ft({__name:"SimpleButton",props:{type:{}},setup(A){return(i,m)=>(D(),S("button",{class:It(["tw-h-8 tw-px-2 tw-flex tw-items-center tw-gap-2 tw-text-2xs tw-font-bold tw-uppercase tw-border tw-rounded hover:tw-text-sky-400",i.type==="cancel"?"tw-text-red-500":"tw-text-gray-800"])},[yt(i.$slots,"default")],2))}}),Et=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Files",variant:"td-controls",label:""}],At={class:"tw-px-4 md:tw-px-8"},Ot={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},jt={class:"list-form"},Mt={class:"list-form_col list-form_col--sm"},zt={class:"list-form_select"},Ht={class:"multiselect-option"},Wt={class:"d-block"},qt={class:"d-block"},Zt={class:"d-block"},Gt={class:"d-block"},Jt={class:"d-block"},Kt={class:"invoices__controls-wrapper"},Qt={class:"tw-flex tw-flex-wrap lg:tw-flex-nowrap tw-items-center tw-gap-2"},Xt=["href"],Yt={key:0,class:"table-controls"},te={class:"multiselect-multiple-label"},ee={class:"multiselect-option"},oe={__name:"Invoices",async setup(A){let i,m;const k=Ft(),r=Pt();bt();const O=gt(),C=St(),u=Dt("emitter");u.on("updateInvoicesTable",()=>{r.fetchInvoices()});const N=c("CreateDate"),V=c(!0),j=c("desc"),y=c(""),p=c("*"),b=c(1),d=c(10),M=c([10,25,50,100]),w=f(()=>Object.keys(r?.invoicesList).map(o=>({...r?.invoicesList[o],Customer:P.value?.[r?.invoicesList[o].ContractID]?.Customer,Summ:Number(r?.invoicesList[o]?.Summ)})).reverse()),B=f(()=>w.value.filter(t=>p.value!=="*"?Number(t.ContractID)===Number(p.value):!0));f(()=>r?.servicesList);const P=f(()=>k.contractsList),F=f(()=>{let o=[];return w.value.map(t=>{if(!o.find(_=>_===t.Customer))return o.push(t.Customer),{value:t.ContractID,name:t.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),T=f(()=>w.value.filter(o=>o?.PaymentSystemName.toLowerCase().includes(y.value?.toLowerCase())||String(o?.Summ).toLowerCase().includes(y.value?.toLowerCase())).filter(o=>String(o.ContractID).includes(p.value!=="*"?p.value:"")).length);function z(){O.go(0)}function H(){b.value=1}function W(o){window.location=`${U}/InvoiceDownload?InvoiceID=${o?.item?.ID}&IsStamp=yes`}function q(o){return`${U}/InvoiceDownload?InvoiceID=${o?.item?.ID}&IsTIFF=yes&IsStamp=yes`}function Z(o){u.emit("open-modal",{component:"AcceptConditionally",data:{ContractID:o?.item?.ContractID,RowsIDs:o?.item?.ID,AllowConditionallyMessage:o?.item?.AllowConditionallyMessage}})}function G(o){u.emit("open-modal",{component:"StatusHistory",data:{modeID:"Invoices",rowID:o}})}function J(o){u.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:o?.item?.ID,TypeID:P.value?.[o?.item?.ContractID]?.TypeID,Summ:o?.item?.Summ,PaymentSystemID:o.item.PaymentSystemID}})}function h(o){r.InvoiceDocument({InvoiceID:o.item?.ID}).then(t=>{u.emit("open-modal",{component:"InvoiceDocument",data:{html:t,ID:o.item?.ID}})})}function K(){u.emit("open-modal",{component:"NewInvoice"})}function Q(o){let t=new FormData;t.append("ContractID","Default"),t.append("RowsIDs[]",o.item?.ID),r.InvoicesReject(t).then(_=>{_==="SUCCESS"&&r.fetchInvoices()})}return[i,m]=g(()=>k.fetchContracts()),await i,m(),[i,m]=g(()=>k.fetchProfiles()),await i,m(),[i,m]=g(()=>r.fetchInvoices().then(()=>{C.params?.id&&w.value?.find(t=>t.ID===C.params?.id)&&h({item:{ID:C.params.id}}),C.query.Error==="yes"&&u.emit("open-modal",{component:"InvoiceError"})})),await i,m(),[i,m]=g(()=>r.fetchServices()),await i,m(),(o,t)=>{const _=Vt,X=Nt,Y=Lt,tt=$t,et=xt,ot=kt,x=Ut,st=vt,nt=_t,$=dt,at=pt,lt=ct,it=ut,rt=mt;return D(),S(R,null,[a(_),s("div",At,[s("div",Ot,[s("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:t[0]||(t[0]=e=>z())},"Счета на оплату"),a(X,{onClick:t[1]||(t[1]=e=>K()),label:"Выписать новый счёт"})]),a(Y),s("div",jt,[s("div",Mt,[s("div",zt,[a(I(E),{modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),options:F.value,disabled:F.value?.length<=1,label:"name"},{singlelabel:n(({value:e})=>[s("span",null,"# "+l(String(e.value).padStart(5,"0"))+" / "+l(e.name),1)]),option:n(({option:e})=>[s("span",Ht,"# "+l(String(e.value).padStart(5,"0"))+" / "+l(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a(tt,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=e=>y.value=e)},null,8,["modelValue"])]),B.value?.length>0?(D(),S(R,{key:0},[a(lt,{class:"basic-table",items:B.value,fields:I(Et),"show-empty":!0,filter:y.value,"per-page":d.value,"current-page":b.value,responsive:"","sort-by":N.value,"onUpdate:sortBy":t[4]||(t[4]=e=>N.value=e),"sort-desc":V.value,"onUpdate:sortDesc":t[5]||(t[5]=e=>V.value=e),"sort-direction":j.value,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:H},{"cell(PaymentSystemName)":n(e=>[t[9]||(t[9]=s("span",{class:"td-mobile"},"Платежная система",-1)),s("span",Wt,l(e.value),1)]),"cell(CreateDate)":n(e=>[t[10]||(t[10]=s("span",{class:"td-mobile"},"Дата Создания",-1)),s("span",qt,l(I(Tt)(I(ht)(e.item?.CreateDate))),1)]),"cell(ID)":n(e=>[t[11]||(t[11]=s("span",{class:"td-mobile"},"Номер счета",-1)),s("span",Zt,l(e.value),1)]),"cell(ContractID)":n(e=>[t[12]||(t[12]=s("span",{class:"td-mobile"},"Договор",-1)),s("span",Gt,"#"+l(e.item?.ContractID)+" / "+l(e.item?.Customer),1)]),"cell(StatusID)":n(e=>[a(et,{status:e.value,"status-table":"Invoices",onClick:v=>G(e.item?.ID)},null,8,["status","onClick"])]),"cell(Summ)":n(e=>[t[13]||(t[13]=s("span",{class:"td-mobile"},"Сумма",-1)),s("span",Jt,l(I(Bt)(e.item?.Summ)),1)]),"cell(Files)":n(e=>[s("div",Kt,[s("div",Qt,[a(x,{onClick:v=>W(e)},{default:n(()=>[a(ot,{class:"tw-size-5"}),t[14]||(t[14]=s("div",null,"Скачать",-1))]),_:2,__:[14]},1032,["onClick"]),a(x,{onClick:v=>h(e)},{default:n(()=>[a(st,{class:"tw-size-5"}),s("div",null,l(e.item?.IsPosted?"Посмотреть":"Оплатить"),1)]),_:2},1032,["onClick"]),a(x,{type:"cancel",onClick:v=>Q(e)},{default:n(()=>t[15]||(t[15]=[L(" Отменить ",-1)])),_:2,__:[15]},1032,["onClick"]),a(at,{class:"dropdown-dots tw-m-0",right:""},{"button-content":n(()=>[a(nt)]),default:n(()=>[a($,null,{default:n(()=>[s("a",{href:q(e)},"Скачать в формате tiff",8,Xt)]),_:2},1024),a($,{onClick:v=>J(e)},{default:n(()=>t[16]||(t[16]=[L("Изменить счёт",-1)])),_:2,__:[16]},1032,["onClick"]),a($,{onClick:v=>Z(e)},{default:n(()=>t[17]||(t[17]=[L("Провести условно",-1)])),_:2,__:[17]},1032,["onClick"])]),_:2},1024)])])]),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction"]),T.value>0?(D(),S("div",Yt,[a(it,{modelValue:b.value,"onUpdate:modelValue":t[6]||(t[6]=e=>b.value=e),"total-rows":T.value,"per-page":d.value,"first-number":"","last-number":""},{"first-text":n(()=>t[18]||(t[18]=[s("span",{class:"text-success"},"First",-1)])),"last-text":n(()=>t[19]||(t[19]=[s("span",{class:"text-info"},"Last",-1)])),page:n(({page:e,active:v})=>[s("span",null,l((e-1)*d.value+1)+"-"+l(e*d.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),a(I(E),{class:"multiselect--white",modelValue:d.value,"onUpdate:modelValue":t[7]||(t[7]=e=>d.value=e),options:M.value,label:"name",openDirection:"top",onInput:t[8]||(t[8]=e=>b.value=1)},{singlelabel:n(({value:e})=>[s("span",te," Отображать "+l(e.value)+" строк ",1)]),option:n(({option:e})=>[s("span",ee,"Отображать "+l(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):wt("",!0)],64)):(D(),Ct(rt,{key:1,label:"Заказов не найдено"}))])],64)}}},Ce=Rt(oe,[["__scopeId","data-v-6c1b5c12"]]);export{Ce as default};
