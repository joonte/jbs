import{_ as z}from"./ButtonDefault-CgQ13ecW.js";import{m as G}from"./bootstrap-vue-next-CDL_Y1-V.js";import{_ as J}from"./IconClip-YCBfF6gP.js";import{_ as Q}from"./IconClose-Camrw-uN.js";import{_ as W}from"./IconFile-BPBevOIL.js";import{_ as X,a as Y,b as Z}from"./PhoneInput-DQ9kXpKb.js";import{_ as $}from"./BasicInput-B071mWFB.js";import{_ as ee}from"./SimpleCheckbox-DmHcob3H.js";import{_ as oe}from"./ClausesKeeper-Cjjq7JUL.js";import{_ as le}from"./BlockBalanceAgreement-BNU6bIWW.js";import{c as m,b as v,a as n,i as _,D as b,w as S,G as ae,F as D,j as F,an as te,u as ne,r as g,f as L,h as N,v as re,p as se,g as ce,d as ue,y as ie,o as r,e as M,t as H,n as R}from"./index-DakgQwZZ.js";import{u as me}from"./contracts-C-xJvA56.js";import{u as fe}from"./files-BgV1g5f5.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./multiselect-BdMqqcHq.js";import"./component-BXhtJwv0.js";const de={setup(){const q=te(),a=me(),A=ne(),o=fe(),d=ue(),c=ce(),U=ie("emitter"),C=g(!1),V=g(!1),h=g({}),P=g(null),k=g([]),y=g(null),E=g(null),u=g(0),f=L(()=>q.data),w=L(()=>A?.userInfo?.Email),T=f.value,I={};for(const l in T.Regulars)I[l]=T.Regulars[l];const e=l=>I[l]||null,t=()=>{const l=f.value;return l&&l.Regulars&&l.Regulars.Phone?new RegExp(l.Regulars.Phone):/^[0-9]{10}$/},i=l=>{l.key==="Enter"&&l.ctrlKey&&B()};N(()=>{document.addEventListener("keyup",i)}),re(()=>{document.removeEventListener("keyup",i)});function O(l){k.value=k.value.filter((s,p)=>p!==l)}function B(){if(C.value&&V.value){let l=new FormData;Object.keys(h.value).forEach(s=>{l.append(s,h.value[s]?.value)}),l.append("TemplateID",u.value),l.append("Agree",C.value),l.append("AgreeHandle",V.value),k.value.forEach((s,p)=>{l.append("Document[]",s?.value)}),y.value="pending",a.createNewContractFormData(l).then(s=>{s.status==="success"?(y.value="success",c.query.ProfileEmpty?a.contractMake({ProfileID:s.data?.ProfileID,TypeID:u.value}).then(p=>{p.data.Status==="Ok"&&(U.emit("open-modal",{component:"SuccessContract",data:"Профиль и договор успешно созданы!"}),c.query.Redirect?d.push(`${c.query.Redirect}`):d.push("/Contracts"))}):c.query.ContractNew?(a.contractMake({ProfileID:s.data?.ProfileID,TypeID:u.value}).then(p=>{p.data.Status==="Ok"&&d.push("/Basket")}),console.log(s)):c.query.Contract?d.push(`/Balance/${c.query.Contract}`):!c.query.Contract&&c.query.TemplateID?d.push("/Basket"):d.push("/Contracts")):(y.value="error",E.value=s.data?.Exception)})}}function j(l){return""+x(l)}function x(l){return l?"<div>"+l?.String+"</div>"+x(l?.Parent):""}function K(l){let s=l.target.files?.[0]||null;s&&(P.value.value="",o.sendFile(s).then(p=>{k.value.push({name:s?.name,value:p.slice(p.lastIndexOf("^")+1,p.length)})}))}return se(u,()=>{h.value={},Object.keys(f.value?.Profiles?.Templates?.[u.value]?.Template?.Attribs).forEach(l=>{h.value[l]={error:!1,value:(f.value?.Profiles?.Templates?.[u.value]?.Template?.Attribs[l]?.Value==="%Email%"?w.value:f.value?.Profiles?.Templates?.[u.value]?.Template?.Attribs[l]?.Value)||null,required:f.value?.Profiles?.Templates?.[u.value]?.Template?.Attribs[l]?.IsDuty==="1"}})}),N(()=>{console.log(c),console.log(d.options,"options"),console.log(d.options.history.state.back,"full path"),f.value?.Contracts?.Types&&c.query.TemplateID&&(u.value=c.query.TemplateID)}),{getConfig:f,templateValue:u,agreeHandle:V,agree:C,createProfileResult:y,createProfileErrorMessage:E,checkForm:B,formErrorMessage:j,form:h,fileInput:P,fileList:k,removeFile:O,fileUpload:K,getPhoneRegex:t,getFieldRegex:e,fieldRegexMap:I}}},_e={class:"section"},ve={class:"container"},ge={class:"tw-mb-4"},he={class:"form"},ke={class:"form"},ye={class:"special-form-row"},be={key:0,class:"section-header inputs-block"},Ce={class:"section-block_title"},Ve={key:0,class:"form width-limit"},Te={key:0,class:"form-field form-field--file form-field--basic"},Ie={class:"chat-files"},De=["onClick"],Pe={class:"form-field form-field--file form-field--basic"},Ee={class:"form-field-input__file-wrapper"},Re={class:"form-field-input__file"},Ue=["innerHTML"];function we(q,a,A,o,d,c){const U=le,C=ae("router-link"),V=oe,h=ee,P=$,k=X,y=Y,E=Z,u=W,f=Q,w=J,T=G,I=z;return r(),m(D,null,[v(U),n("section",_e,[n("div",ve,[n("div",ge,[v(C,{to:"/Contracts",class:"section-label"},{default:S(()=>a[5]||(a[5]=[M("Мои договора",-1)])),_:1,__:[5]}),a[6]||(a[6]=n("h1",{class:"section-title"},"Создать профиль",-1))]),v(V),a[10]||(a[10]=n("div",{class:"section-header"},[n("h2",{class:"section-block_title"},"Шаблон")],-1)),n("form",he,[(r(!0),m(D,null,F(o.getConfig?.Contracts?.Types,e=>(r(),m(D,{key:e?.ProfileTemplateID},[e?.ProfileTemplateID!==""?(r(),b(h,{key:0,label:e?.Name,value:e?.ProfileTemplateID,modelValue:o.templateValue,"onUpdate:modelValue":a[0]||(a[0]=t=>o.templateValue=t)},null,8,["label","value","modelValue"])):_("",!0)],64))),128))]),n("form",ke,[(r(!0),m(D,null,F(o.getConfig?.Profiles?.Templates?.[o.templateValue]?.Template?.Attribs,(e,t)=>(r(),m("div",{class:"form-row-wrapper",key:t},[n("div",ye,[e?.Title?(r(),m("div",be,[n("h2",Ce,H(e?.Title),1)])):_("",!0),e?.Type==="Input"&&e?.Check!=="Phone"?(r(),b(P,{key:1,class:R({"special-form-input":!0,"form-field-error":o.form[t].error,"form-error":!o.form[t].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:o.form[t].value,"onUpdate:modelValue":i=>o.form[t].value=i,pattern:o.getFieldRegex(e?.Check)},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue","pattern"])):_("",!0),e?.Type==="Input"&&e?.Check==="Phone"?(r(),b(k,{key:2,class:R({"special-form-input":!0,"form-field-error":o.form[t].error,"form-error":!o.form[t].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:o.form[t].value,"onUpdate:modelValue":i=>o.form[t].value=i,pattern:o.getPhoneRegex()},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue","pattern"])):_("",!0),e?.Type==="TextArea"?(r(),b(y,{key:3,class:R({"special-form-input":!0,"form-field-error":o.form[t].error,"form-error":!o.form[t].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:o.form[t].value,"onUpdate:modelValue":i=>o.form[t].value=i},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):e?.Type==="Select"?(r(),b(E,{key:4,class:R({"special-form-input":!0,"form-field-error":o.form[t].error,"form-error":!o.form[t].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,options:e?.Options,modelValue:o.form[t].value,"onUpdate:modelValue":i=>o.form[t].value=i},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):_("",!0)])]))),128))]),o.templateValue!==0?(r(),m("div",Ve,[o.fileList.length?(r(),m("div",Te,[n("div",Ie,[(r(!0),m(D,null,F(o.fileList,(e,t)=>(r(),m("div",{class:"chat-files__item",key:t},[n("span",null,[v(u,{class:"file-icon"})]),n("span",null,H(e?.name),1),n("button",{class:"close",onClick:i=>o.removeFile(t)},[v(f)],8,De)]))),128))])])):_("",!0),n("label",Pe,[n("div",Ee,[n("input",{ref:"fileInput",type:"file",onChange:a[1]||(a[1]=(...e)=>o.fileUpload&&o.fileUpload(...e))},null,544),n("div",Re,[v(w),a[7]||(a[7]=n("span",null,"Прикрепить документ подтверждающий личность",-1))])])]),v(T,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:o.agree,"onUpdate:modelValue":a[2]||(a[2]=e=>o.agree=e)},{default:S(()=>a[8]||(a[8]=[M(" Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет ",-1)])),_:1,__:[8]},8,["modelValue"]),v(T,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:o.agreeHandle,"onUpdate:modelValue":a[3]||(a[3]=e=>o.agreeHandle=e)},{default:S(()=>a[9]||(a[9]=[M(" Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменов и т.п.) ",-1)])),_:1,__:[9]},8,["modelValue"])])):_("",!0),o.createProfileErrorMessage?(r(),m("div",{key:1,class:"error-message width-limit",innerHTML:o.formErrorMessage(o.createProfileErrorMessage)},null,8,Ue)):_("",!0),o.templateValue!==0?(r(),b(I,{key:2,class:"width-limit","is-loading":o.createProfileResult==="pending",label:"Зарегистрировать",onClick:a[4]||(a[4]=e=>o.checkForm())},null,8,["is-loading"])):_("",!0)])])],64)}const Qe=pe(de,[["render",we],["__scopeId","data-v-b7593579"]]);export{Qe as default};
