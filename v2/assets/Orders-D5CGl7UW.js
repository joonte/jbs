import{L as ee,a as te}from"./bootstrap-vue-next-DwS3lKQb.js";import{_ as se}from"./IconCard-_anr564X.js";import{_ as ae}from"./UserNote-8i0DdDDd.js";import{_ as le}from"./StatusBadge-CjHHKSUG.js";import{_ as oe}from"./FormInputSearch-BN5nl3dB.js";import{_ as ne}from"./ClausesKeeper-CTja-fCz.js";import{_ as re}from"./BlockBalanceAgreement-qtspRQ_B.js";import{u as ie,ao as ue,x as ce,r as m,f as i,H as me,g as de,D as V,c as T,b as r,a,h as pe,w as l,v as D,F as ve,d as _e,o as A,t as o,n as fe}from"./index-CmCGXBst.js";import{u as Se}from"./contracts-P7YPBhEI.js";import{u as be}from"./services-C54cnl9l.js";import{f as B}from"./time-DenPiOX5.js";import{s as C}from"./multiselect-DhoC9bwZ.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-BicE38kO.js";import"./IconClose-B_k4TzXM.js";import"./ButtonDefault-BIBStZbJ.js";const ge=[{key:"ID",label:"Заказ",variant:"td-blue",sortable:!0},{key:"ServiceID",label:"Услуга",variant:"td-gray td-order bold"},{key:"SchemeName",label:"Тариф",variant:"td-gray td-order"},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"td-gray td-order"},{key:"ContractID",label:"Договор",sortable:!0,variant:"td-blue"},{key:"UserNotice",label:"Примечание",variant:"td-gray td-limited"},{key:"controls",label:"",variant:"td-controls"}],Ie={class:"tw-px-4 md:tw-px-8"},ye={class:"list-form"},Ce={class:"list-form_col list-form_col--sm"},xe={class:"list-form_select"},Oe={class:"multiselect-option"},ke={class:"list-form_col list-form_col--sm"},Ve={class:"list-form_select"},$e={class:"multiselect-option"},we={class:"list-form_col list-form_col--sm"},Ne={class:"list-form_select"},he={class:"multiselect-option"},Le={class:"btn__group"},Re=["onClick"],Ue={key:0,class:"table-controls"},Ee={class:"multiselect-multiple-label"},Te={class:"multiselect-option"},Ae={__name:"Orders",async setup(Be){let d,p;const f=_e(),$=de(),g=ie(),w=Se(),N=be(),P=ue(),h=ce("emitter");h.on("updateOrdersList",()=>{g.fetchUserOrders()});const x=m(""),v=m(10),S=m(1),F=m([10,25,50,100]),b=m("*"),I=m("*"),y=m("*"),u=i(()=>Object.keys(g?.userOrders).map(s=>g?.userOrders[s])),O=i(()=>{let s=u.value.filter(e=>String(e.ID).includes(x.value));return I.value!=="*"&&s!==null&&(s=s.filter(e=>String(e.ServiceID).includes(I.value))),b.value!=="*"&&s!==null&&(s=s.filter(e=>String(e.ContractID).includes(b.value))),y.value!=="*"&&s!==null&&(s=s.filter(e=>String(e.StatusID).includes(y.value))),S.value=1,s}),k=i(()=>w?.contractsList);function H(){f.go(0)}function j(s){if(!s)return B(new Date);const e=new Date,n=new Date(e.getTime()+s*24*60*60*1e3);return B(n)}const _=i(()=>N.ServicesList);function q(s,e){let n="";e==="Default"?n="Orders":n=e+"Orders",h.emit("open-modal",{component:"StatusHistory",data:{modeID:n,rowID:s}})}const L=i(()=>{let s=[{value:"*",name:"Все договора"}];return u.value!==null?(u.value.map(e=>{s.find(n=>n.value===e?.ContractID)||s.push({value:e?.ContractID,name:k.value[e?.ContractID]?.Customer})}),s):{value:"*",name:"Все договора"}}),R=i(()=>{let s=[{value:"*",name:"Все услуги"}];return u.value!==null?(u.value.map(e=>{s.find(n=>n.value===e?.ServiceID)||s.push({value:e?.ServiceID,name:_.value[e?.ServiceID]?.NameShort})}),s):{value:"*",name:"Все услуги"}}),z=i(()=>P.data.Statuses?.Orders),U=i(()=>{let s=[{value:"*",name:"Все статусы"}];return u.value!==null?(u.value.map(e=>{s.find(n=>n.value===e?.StatusID)||s.push({value:e?.StatusID,name:z.value?.[e?.StatusID]?.Name||e?.StatusID})}),s):{value:"*",name:"Все статусы"}});function M(s){return _.value[s]?.Code!=="Default"?_.value[s]?.Code+"Orders":"Orders"}function G(s,e,n){if(!n.target.closest("button, a, .clickable-element")){let c=_.value[s.ServiceID]?.Code;c==="Default"||c==="ExtraIP"||c==="ISPsw"||c==="DNSmanager"?f.push(`/AdditionalServices/${s.ID}`):f.push(`/${c}Orders/${s.ID}`)}}function J(s){let e=_.value[s.ServiceID]?.Code;e==="Default"?f.push(`/ServiceOrderPay/${s.ID}`):f.push(`/${e}OrderPay/${s.ID}`)}return me(()=>{$.query?.contractID&&(b.value=$.query?.contractID)}),[d,p]=V(()=>g.fetchUserOrders()),await d,p(),[d,p]=V(()=>w.fetchContracts()),await d,p(),[d,p]=V(()=>N.fetchServices()),await d,p(),(s,e)=>{const n=re,c=ne,K=oe,Q=le,W=ae,X=se,Y=ee,Z=te;return A(),T(ve,null,[r(n),a("div",Ie,[a("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer tw-mb-4",onClick:e[0]||(e[0]=t=>H())},"Мои заказы"),r(c),a("div",ye,[r(K,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t)},null,8,["modelValue"]),a("div",Ce,[a("div",xe,[r(D(C),{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),options:L.value,disabled:L.value?.length<=1,label:"name"},{singlelabel:l(({value:t})=>[a("span",null,"# "+o(String(t.value).padStart(5,"0"))+" / "+o(t.name),1)]),option:l(({option:t})=>[a("div",Oe,"# "+o(String(t.value).padStart(5,"0"))+" / "+o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",ke,[a("div",Ve,[r(D(C),{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=t=>y.value=t),options:U.value,disabled:U.value?.length<=1,label:"name"},{option:l(({option:t})=>[a("div",$e,o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",we,[a("div",Ne,[r(D(C),{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=t=>I.value=t),options:R.value,disabled:R.value?.length<=1,label:"name"},{option:l(({option:t})=>[a("div",he,o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])])]),r(Y,{class:"basic-table",fields:D(ge),items:O.value,"show-empty":!0,"per-page":v.value,responsive:"","current-page":S.value,"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onRowClicked:G},{"cell(ID)":l(t=>[e[8]||(e[8]=a("span",{class:"td-mobile"},"Заказ",-1)),a("span",null,o(t.value),1)]),"cell(ServiceID)":l(t=>[e[9]||(e[9]=a("span",{class:"td-mobile"},"Услуга",-1)),a("span",null,o(_.value[t.value]?.NameShort),1)]),"cell(SchemeName)":l(t=>[e[10]||(e[10]=a("span",{class:"td-mobile"},"Тариф",-1)),a("span",null,o(t.item?.SchemeName),1)]),"cell(ExpirationDate)":l(t=>[e[11]||(e[11]=a("span",{class:"td-mobile"},"Дата окончания",-1)),a("span",{class:fe({danger:Number(t.item?.DaysRemainded)<14})},o(j(t.item?.DaysRemainded))+" | "+o(t.item?.DaysRemainded||0)+" дн. ",3)]),"cell(StatusID)":l(t=>[r(Q,{class:"clickable-element tw-cursor-pointer",status:t.value,"status-table":M(t.item?.ServiceID),onClick:E=>q(t.item?.ServiceOrderID,t.item?.Code)},null,8,["status","status-table","onClick"])]),"cell(ContractID)":l(t=>[e[12]||(e[12]=a("span",{class:"td-mobile"},"Договор",-1)),a("span",null,"#"+o(k.value[t.value]?.ID)+" / "+o(k.value[t.value]?.Customer),1)]),"cell(UserNotice)":l(t=>[e[13]||(e[13]=a("span",{class:"td-mobile"},"Комментарий",-1)),r(W,{text:t.value,"order-id":t.item?.ID,emit:"updateOrdersList"},null,8,["text","order-id"])]),"cell(controls)":l(t=>[a("div",Le,[a("button",{class:"btn btn-default btn--border",onClick:E=>J(t.item)},[r(X),e[14]||(e[14]=a("p",null,"ОПЛАТИТЬ",-1))],8,Re)])]),_:1},8,["fields","items","per-page","current-page"]),O.value?.length>0?(A(),T("div",Ue,[r(Z,{modelValue:S.value,"onUpdate:modelValue":e[5]||(e[5]=t=>S.value=t),"total-rows":O.value?.length,"per-page":v.value,"first-number":"","last-number":""},{"first-text":l(()=>e[15]||(e[15]=[a("span",{class:"text-success"},"First",-1)])),"last-text":l(()=>e[16]||(e[16]=[a("span",{class:"text-info"},"Last",-1)])),page:l(({page:t,active:E})=>[a("span",null,o((t-1)*v.value+1)+"-"+o(t*v.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),r(D(C),{class:"multiselect--white",modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=t=>v.value=t),options:F.value,label:"name",openDirection:"top",onInput:e[7]||(e[7]=t=>S.value=1)},{singlelabel:l(({value:t})=>[a("div",Ee,[a("span",null,"Отображать "+o(t.value)+" строк",1)])]),option:l(({option:t})=>[a("div",Te,"Отображать "+o(t.name)+" строк",1)]),_:1},8,["modelValue","options"])])):pe("",!0)])],64)}}},tt=De(Ae,[["__scopeId","data-v-b4e02b38"]]);export{tt as default};
