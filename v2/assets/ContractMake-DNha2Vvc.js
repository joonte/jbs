import{_ as N}from"./InputSelect.vue_vue_type_script_setup_true_lang-D7E9_BoS.js";import{_ as B}from"./SimpleCheckbox-Cmv9xJvR.js";import{_ as $}from"./ClausesKeeper-iUM0yapS.js";import{_ as M}from"./BlockBalanceAgreement-v_bWuiVT.js";import{u as A}from"./index-BO2gwtUe.js";import{ao as R,r as f,E as j,f as _,I as g,s as K,o as i,c,b as n,a,w as U,F as x,g as F,d as O,G,x as q,e as z,C as H}from"./index-Codq73aV.js";import{_ as b}from"./ButtonDefault-CMw2aBy6.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconChevronDown-DOsbTpSQ.js";import"./IconClose-Dia1noy8.js";import"./common-DyknwSqv.js";const Q={class:"tw-px-4 md:tw-px-8"},W={class:"tw-mb-4"},X={class:"form"},Y={key:0,class:"tw-max-w-[722px]"},Z={class:"tw-flex md:tw-items-center tw-flex-col md:tw-flex-row tw-gap-4 tw-mt-4"},ee={class:"tw-w-full"},te={key:1},oe={__name:"ContractMake",async setup(ae){let v,w;const y=R(),o=A(),u=O(),P=q("emitter"),p=f(!1),l=f("Natural"),s=f(null);[v,w]=j(()=>o.fetchProfiles()),await v,w();const I=_(()=>{const e={...y.data.Contracts.Types};return delete e.Default,Object.values(o.contractsList).find(d=>d.TypeID==="NaturalPartner")?(delete e.NaturalPartner,e):y.data?.Contracts?.Types||[]}),m=_(()=>Object.keys(o.profileList).filter(e=>o.profileList[e].TemplateID===l.value&&o.profileList[e].ContractID===0).map(e=>({value:o.profileList[e].ID,name:`#${String(o.profileList[e].ID).padStart(5,"0")} / ${o.profileList[e].Name}`}))),C=e=>{e.key==="Enter"&&e.ctrlKey&&!L.value&&k()},L=_(()=>s.value===null||s.value===void 0);g(()=>{document.addEventListener("keyup",C)}),K(()=>{document.removeEventListener("keyup",C)});async function k(){p.value=!0,(await o.contractMake({ProfileID:s.value,TypeID:l.value})).status==="success"&&(P.emit("open-modal",{component:"SuccessContract",data:"Договор успешно создан!"}),u.push("/Contracts")),p.value=!1}function D(){u.push(`/ProfileMake?TemplateID=${l.value}`)}return g(()=>{m.value.length<1&&u.push(`/ProfileMake?ProfileEmpty=true&Redirect=${u.options.history.state.back}`)}),(e,t)=>{const d=M,T=G("RouterLink"),h=$,S=B,V=N;return i(),c(x,null,[n(d),a("div",Q,[a("div",W,[n(T,{to:"/Contracts",class:"section-label"},{default:U(()=>t[2]||(t[2]=[z(" Мои договора ",-1)])),_:1,__:[2]}),t[3]||(t[3]=a("h1",{class:"tw-mt-4"},"Создать договор",-1))]),n(h),a("form",X,[(i(!0),c(x,null,F(I.value,r=>(i(),H(S,{key:r.ProfileTemplateID,modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=E=>l.value=E),label:r.Name,value:r.ProfileTemplateID},null,8,["modelValue","label","value"]))),128))]),m.value.length>0?(i(),c("div",Y,[a("div",Z,[t[4]||(t[4]=a("div",{class:"tw-w-64"},"Использовать профиль",-1)),a("div",ee,[n(V,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=r=>s.value=r),options:m.value,placeholder:"Выбрать профиль"},null,8,["modelValue","options"])])]),n(b,{disabled:!s.value,"is-loading":p.value,label:"Зарегистрировать",class:"tw-mt-4",onClick:k},null,8,["disabled","is-loading"])])):(i(),c("div",te,[t[5]||(t[5]=a("p",null,"Нет доступных профилей для выбранного типа договора.",-1)),n(b,{label:"Создать профиль",class:"tw-w-64 tw-mt-4",onClick:D})]))])],64)}}},_e=J(oe,[["__scopeId","data-v-7d91e1a9"]]);export{_e as default};
