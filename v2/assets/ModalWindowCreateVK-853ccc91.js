import{_ as I}from"./ButtonDefault-47f7ce80.js";import{_ as k}from"./BasicInput-32ce1450.js";import{f as V,e as b,R as y,r as D,g as _,o as E,c as M,b as p,a as f,a2 as S}from"./index-15714261.js";import"./component-60f19e1e.js";const w={class:"modal__body"},A=f("div",{class:"list-item__title"},"Добавление VKontakte",-1),R=f("div",{class:"modal__input-row"},null,-1),x={__name:"ModalWindowCreateVK",emits:["modalClose","buttonClicked"],setup(B,{emit:C}){const c=V(),u=b(),v=y("emitter"),l=D(""),i=_(()=>c.userInfo),g=_(()=>{var a;return Object.keys((a=i.value)==null?void 0:a.Contacts).map(e=>{var t,o,s,r,n;if(!((s=(o=(t=i.value)==null?void 0:t.Contacts)==null?void 0:o[e])!=null&&s.IsHidden))return(n=(r=i.value)==null?void 0:r.Contacts)==null?void 0:n[e]}).filter(Boolean)}),d=async(a,e)=>{try{return(await S.post(a,e)).data}catch(t){throw new Error(`Error sending confirm request: ${t.message}`)}};function h(){const a={MethodID:"VKontakte",Address:l.value,TimeBegin:"00",TimeEnd:"00",IsActive:"yes",ContactID:"0"};c.userEditContact(a).then(e=>{e.response==="SUCCESS"&&(c.fetchUserData().then(async()=>{var s;((s=u.currentRoute.value)==null?void 0:s.fullPath)!=="/profile/UserProfile"&&u.push("profile/UserProfile");const t=g.value,o=t[t.length-1];if(o){const r={Method:o.MethodID,Value:o.Address,ContactID:o.ID};try{const n=await d("/API/Confirm",r);console.log("Response from server:",n),n.Status==="Ok"?v.emit("open-modal",{component:"AcceptContact",data:{contactId:o.ID,sendConfirmRequest:d}}):console.error(`Error confirming code. Status: ${n.Status}, Message: ${n.Message}`)}catch(n){console.error("Error accepting contact:",n.message)}}}),m())})}function m(){C("modalClose")}return(a,e)=>{const t=k,o=I;return E(),M("div",w,[A,R,p(t,{label:"VKontakte сообщения",name:"name",placeholder:"Ссылка или id",vertical:"",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=s=>l.value=s)},null,8,["modelValue"]),p(o,{class:"profile-info__add-button",label:"Добавить контакт",onClick:h,onButtonClicked:e[1]||(e[1]=s=>m())})])}}};export{x as default};
