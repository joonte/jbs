import{_ as A,o as _,c as d,a as e,j as N,b as C,F as S,x as M,t as i,w as k,k as V,p as O,l as T,S as $,r as E,g as w}from"./index-6f846e0d.js";import{u as G}from"./basket-b7c68c20.js";import{u as R}from"./contracts-b643bcd5.js";import{u as q}from"./postings-24d27e64.js";import"./invoices-41375e35.js";import{S as z}from"./ServerItem-7091fadd.js";import{B as H}from"./BlockBalanceAgreement-4579706c.js";import{C as J}from"./bootstrap-vue-next.es-6bf04585.js";import{_ as K}from"./ClausesKeeper-3ae27028.js";import"./IconDots-740076c4.js";import"./IconCard-b1fefd85.js";import"./StatusBadge-654ab79e.js";import"./ButtonDefault-40efcd87.js";import"./IconArrow-37547b0b.js";import"./IconClose-12869131.js";const Q={},U={fill:"none",height:"32",viewBox:"0 0 32 32",width:"32",xmlns:"http://www.w3.org/2000/svg"},W=e("rect",{fill:"#F7F9FF",height:"31",rx:"3.5",width:"31",x:".5",y:".5"},null,-1),X=e("path",{d:"M8.5 11h15m-1.665 0v11.667a1.667 1.667 0 0 1-1.667 1.666h-8.333a1.667 1.667 0 0 1-1.667-1.666V11m2.5 0V9.333a1.667 1.667 0 0 1 1.667-1.666h3.333a1.667 1.667 0 0 1 1.667 1.666V11m-5.003 4.167v5m3.336-5v5",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Y=e("rect",{height:"31",rx:"3.5",stroke:"#C7D1ED",width:"31",x:".5",y:".5"},null,-1),Z=[W,X,Y];function j(o,u){return _(),d("svg",U,Z)}const L=A(Q,[["render",j]]),tt=[{key:"ServiceID",label:"Услуга",variant:"td-service"},{key:"OrderID",label:"Номер заказа",variant:"td-service"},{key:"Amount",label:"Период"},{key:"Summ",label:"Сумма"},{key:"controls",label:"Действия",variant:"td-controls"}],m=o=>(O("data-v-eed286e3"),o=o(),T(),o),et={class:"section"},st={class:"container"},ot=m(()=>e("div",{class:"section-header"},[e("h1",{class:"section-title"},"Корзина")],-1)),nt={key:0,class:"cart-list"},at={key:0,class:"cart-item"},lt=m(()=>e("div",{class:"cart-item__title"},"Заказ",-1)),ct={class:"cart-item__subtitle"},it={class:"cart-item__subtitle-name"},rt=m(()=>e("span",{class:"td-mobile"},"Услуга",-1)),_t={class:"d-block"},dt={class:"d-block table-td-blue"},mt=m(()=>e("span",{class:"td-mobile"},"Номер заказа",-1)),ut=m(()=>e("span",{class:"td-mobile"},"Период",-1)),ht=m(()=>e("span",{class:"td-mobile"},"Сумма",-1)),vt=["onClick"],pt={class:"total-block"},kt={class:"total-block__row"},ft=m(()=>e("div",{class:"total-block__col"},"Итого",-1)),It={class:"total-block__col"},Dt=["onClick"],Ct={key:1,class:"notification-field"};function bt(o,u,p,l,h,b){const v=N("BalanceAgreement"),g=K,y=L,B=J;return _(),d(S,null,[C(v),e("div",et,[e("div",st,[ot,C(g),l.basketContent&&Object.keys(l.basketContent).length>0?(_(),d("div",nt,[(_(!0),d(S,null,M(l.basketContent,(r,f)=>{var I,D;return _(),d(S,null,[r&&r.length>0?(_(),d("div",at,[lt,e("div",ct,[e("div",it,i((D=(I=l.getContracts)==null?void 0:I[f])==null?void 0:D.Customer),1)]),C(B,{class:"basic-table table-cart",items:r,fields:l.basketTableFields},{"cell(ServiceID)":k(t=>{var s,n,c,a;return[rt,e("span",_t,i((c=(n=l.getServices)==null?void 0:n[(s=t.item)==null?void 0:s.ServiceID])==null?void 0:c.Name),1),e("span",dt,i((a=t.item)==null?void 0:a.Comment),1)]}),"cell(OrderID)":k(t=>{var s;return[mt,e("span",null,"№ "+i((s=t.item)==null?void 0:s.OrderID),1)]}),"cell(Amount)":k(t=>{var s,n;return[ut,e("span",null,i((s=t.item)==null?void 0:s.Amount)+" "+i((n=t.item)==null?void 0:n.Measure),1)]}),"cell(Summ)":k(t=>{var s;return[ht,e("span",null,i((s=t.item)==null?void 0:s.Summ)+" ₽",1)]}),"cell(controls)":k(t=>[e("button",{class:"btn-delete btn",onClick:s=>l.deleteFromBasket(t.item)},[C(y)],8,vt)]),_:2},1032,["items","fields"]),e("div",pt,[e("div",kt,[ft,e("div",It,i(l.totalPrice(r))+" ₽",1)]),e("button",{class:"btn btn--blue btn-default btn--wide",onClick:t=>l.choosePaymentSystem(r,f)},"Оплатить заказ",8,Dt)])])):V("",!0)],64)}),256))])):(_(),d("div",Ct,"Корзина заказов пуста"))])])],64)}const gt={components:{IconDelete:L,ServerItem:z,BalanceAgreement:H},async setup(){const o=G(),u=R(),p=q(),l=$("emitter"),h=E(null),b=w(()=>o==null?void 0:o.basketList),v=w(()=>u==null?void 0:u.contractsList),g=w(()=>p==null?void 0:p.servicesList);l.on("form-cart-invoice",t=>{D(t)}),await o.fetchBasket().then(()=>{h.value=b.value}),await u.fetchContracts(),await p.fetchServices();function y(t){var n;let s=0;for(let c=0;c<t.length;c++)s=s+Number((n=t[c])==null?void 0:n.Summ);return Math.round((s+Number.EPSILON)*100)/100}function B(t){o==null||o.deleteFromBasket({RowsIDs:[t==null?void 0:t.ID],TableID:"Basket"}).then(s=>{var n,c;s==="success"&&(((n=o.basketList)==null?void 0:n[t==null?void 0:t.ContractID].filter(a=>(a==null?void 0:a.ID)!==t.ID).length)>0?h.value[t==null?void 0:t.ContractID]=(c=o.basketList)==null?void 0:c[t==null?void 0:t.ContractID].filter(a=>(a==null?void 0:a.ID)!==t.ID):delete h.value[t==null?void 0:t.ContractID])})}function r(){}function f(){}function I(t,s){var n,c,a,F,P,x;console.log(t,s,"item, index"),l.emit("open-modal",{component:"InvoiceMakeBasket",data:{ItemID:s,ContractPaymentSystems:(c=(n=v.value)==null?void 0:n[s])==null?void 0:c.PaymentSystems,ProfileID:(F=(a=v.value)==null?void 0:a[s])==null?void 0:F.ProfileID,TypeID:(x=(P=v.value)==null?void 0:P[s])==null?void 0:x.TypeID,...t}})}function D(t){delete h.value[t]}return window.FormGet=r.bind(this),window.Mobile=f.bind(this),{getBasket:b,getContracts:v,getServices:g,basketContent:h,totalPrice:y,deleteFromBasket:B,choosePaymentSystem:I,basketTableFields:tt}}},Et=A(gt,[["render",bt],["__scopeId","data-v-eed286e3"]]);export{Et as default};
