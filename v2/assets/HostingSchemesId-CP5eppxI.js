import{_ as ae}from"./EmptyStateBlock-DA3-0YDi.js";import{_ as oe}from"./ButtonDefault-CMw2aBy6.js";import{_ as ne}from"./TotalAmount.vue_vue_type_script_setup_true_lang-Dg-09YER.js";import{_ as le}from"./BlockOrderServiceWrapper-CSOQwJHk.js";import{_ as se}from"./BlockAdditionalServices-Dc0oR6v8.js";import{_ as re}from"./BasicInput-DeQAeyXe.js";import{m as ie}from"./bootstrap-vue-next-W16P-SAV.js";import{_ as ue}from"./DomainCheckBlock-X9fdH0N6.js";import{_ as me}from"./BlockOrderPayBalance-DG_N_8bZ.js";import{_ as ce}from"./BlockSelectContract-CsqQBTZj.js";import{_ as de}from"./ParamsAccordionBlock-DEyHfFSp.js";import{_ as ve}from"./BlockBalanceAgreement-v_bWuiVT.js";import{S as pe,r as u,f as S,I as _e,s as fe,E as V,o as k,c as F,b as m,a as y,F as R,t as Se,w as N,C as $,h as L,d as De,i as ge,e as Ie}from"./index-Codq73aV.js";import{u as ye}from"./hosting-BhryHInW.js";import{u as he}from"./index-BO2gwtUe.js";import{u as Ce}from"./services-DyPBvbVy.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./common-DyknwSqv.js";import"./ClausesKeeper-iUM0yapS.js";import"./IconClose-Dia1noy8.js";import"./InputServiceSelect-Dvi-CxI4.js";import"./InputSelect.vue_vue_type_script_setup_true_lang-D7E9_BoS.js";import"./IconChevronDown-DOsbTpSQ.js";import"./component-DqcwA9JN.js";import"./global-CdY51QQZ.js";import"./IconCross-DYjIbZqx.js";import"./multiselect-DElL0Rlw.js";const Be={class:"tw-px-4 md:tw-px-8 tw-mb-6"},Oe={class:"section-header"},be={class:"section-title"},we={class:"tw-mt-6 tw-w-full"},Ve={class:"tw-my-6"},Ee={__name:"HostingSchemesId",async setup(He){let c,d;const D=ye(),P=he(),B=pe(),O=Ce(),K=ge(),g=De(),p=u(!1),E=u(""),h=u([]),n=u(null),C=u([]),I=u(!1),v=u(null),b=u(null),U=u(""),x=t=>{t.key==="Enter"&&t.ctrlKey&&!G.value&&T()},G=S(()=>n.value===null||v.value===null),_=S(()=>D?.hostingSchemes?.[K.params.id]),H=S(()=>P.contractsList[v.value]),j=S(()=>O?.ServicesList),M=S(()=>Object.keys(B?.domainSchemes)?.map(t=>({...B?.domainSchemes[t],value:B?.domainSchemes[t]?.ID}))),W=S(()=>{let t=0;return C.value.forEach(e=>{t+=Number(e.Price)}),t}),q=S(()=>{if(n.value?.daysFromBalance)return"Оплатить c баланса договора";const t=n.value?.CostPay+W.value;return(H.value?.Balance||0)>=t?"Оплатить c баланса договора":"Добавить в корзину"});_e(()=>{document.addEventListener("keyup",x)}),fe(()=>{document.removeEventListener("keyup",x)});function z(t){h.value=t}function J(){p.value=!1}function Q(){p.value=!0}async function A(t){for(const e of C.value){let f="SUCCESS",s=j.value[e.ServiceID]?.Code;if(await O.ServiceOrder({Code:s,DependOrderID:t,...e,ContractID:v.value}).then(({result:a,info:l})=>{if(a==="SUCCESS"){let r={};s==="Default"?r.ServiceOrderID=l?.ServiceOrderID:r[`${s}OrderID`]=l?.ServiceOrderID,O.ServiceOrderPay(s,r).then(i=>{let{result:w}=i;w==="SUCCESS"?g.push("/AdditionalServices}"):w==="BASKET"&&g.push("/Basket")})}else f="ERROR"}),f==="ERROR")break}}function T(){I.value=!0;let t=0,e,f,s;h.value.length>0&&(e=h.value[t],f=h.value.map(a=>`${a.line}${a.line&&a.Name?"."+a.Name:""}`),s=h.value.map(a=>`${a.ID}`)),p.value===!1?D.HostingOrder({ContractID:v.value,Domain:f||null,DomainName:e?.line||null,HostingSchemeID:_.value?.ID,DomainSchemeID:s||null,DomainTypeID:e?.line?e?.Name?"Order":"Nothing":"None"}).then(({result:a,info:l})=>{a==="SUCCESS"?(t++,A(l?.OrderID),D.HostingOrderPay({HostingOrderID:l?.HostingOrderID,DaysPayFromBallance:n.value?.daysFromBalance||0,DaysPay:n.value?.actualDays}).then(r=>{let{result:i}=r;i==="SUCCESS"?g.push("/HostingOrders"):i==="BASKET"&&g.push("/Basket"),I.value=!1})):I.value=!1}):D.HostingOrder({ContractID:v.value,Domain:E.value,DomainName:b.value?.line,HostingSchemeID:_.value?.ID,DomainSchemeID:b.value?.line&&b.value?.ID?b.value?.ID:null,DomainTypeID:"Nothing"}).then(({result:a,info:l})=>{a==="SUCCESS"?(A(l?.OrderID),D.HostingOrderPay({HostingOrderID:l?.HostingOrderID,DaysPayFromBallance:n.value?.daysFromBalance||0,DaysPay:n.value?.actualDays}).then(r=>{let{result:i}=r;i==="SUCCESS"?g.push("/HostingOrders"):i==="BASKET"&&g.push("/Basket"),I.value=!1})):I.value=!1})}return[c,d]=V(()=>B.fetchDomainSchemes()),await c,d(),[c,d]=V(()=>D.fetchHostingSchemes()),await c,d(),[c,d]=V(()=>P.fetchContracts()),await c,d(),[c,d]=V(()=>O.fetchServices()),await c,d(),(t,e)=>{const f=ve,s=de,a=ce,l=me,r=ue,i=ie,w=re,X=se,Y=le,Z=ne,ee=oe,te=ae;return k(),F(R,null,[m(f),y("div",Be,[_.value?.ID?(k(),F(R,{key:0},[y("div",Oe,[y("h1",be,Se(_.value?.Name),1),e[9]||(e[9]=y("div",{class:"section-label"},"Хостинг",-1))]),m(Y,{basic_title:"Хостинг",modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=o=>U.value=o)},{page:N(()=>[m(s,{"params-list":_.value?.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),m(a,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=o=>v.value=o),title:"Договор",class:"tw-mt-6"},null,8,["modelValue"]),H.value?(k(),$(l,{key:0,modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value=o),contract:H.value,scheme:_.value,"service-id":1e4},null,8,["modelValue","contract","scheme"])):L("",!0),m(r,{disabled:p.value,"domain-list":M.value,onClick:e[2]||(e[2]=o=>J()),onSelect:z},null,8,["disabled","domain-list"]),y("div",we,[m(i,{id:"check-1",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o),name:"checkbox-1"},{default:N(()=>e[10]||(e[10]=[Ie(" Использовать свой домен ",-1)])),_:1,__:[10]},8,["modelValue"]),m(w,{label:"Домен",name:"own-domain",onClick:e[4]||(e[4]=o=>Q()),disabled:!p.value,modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=o=>E.value=o)},null,8,["disabled","modelValue"])])]),services:N(()=>[m(X,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=o=>C.value=o),"service-search-params":{ServiceID:1e4,ServersGroupID:_.value?.ServersGroupID}},null,8,["modelValue","service-search-params"])]),_:1},8,["modelValue"]),y("div",Ve,[n.value?(k(),$(Z,{key:0,tariff:n.value,"additional-services":C.value},null,8,["tariff","additional-services"])):L("",!0),m(ee,{class:"btn--wide",label:q.value,disabled:n.value===null||v.value===null,"is-loading":I.value,onClick:e[8]||(e[8]=o=>T())},null,8,["label","disabled","is-loading"])])],64)):(k(),$(te,{key:1,label:"Тариф не найден"}))])],64)}}},lt=ke(Ee,[["__scopeId","data-v-a1a94076"]]);export{lt as default};
