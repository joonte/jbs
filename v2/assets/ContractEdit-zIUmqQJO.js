import{_ as le}from"./EmptyStateBlock-Ad1AmtSS.js";import{_ as oe}from"./ButtonDefault-B1FApUky.js";import{m as ae}from"./bootstrap-vue-next-BglOzul_.js";import{_ as te}from"./IconClip-dIJlGHB3.js";import{_ as se}from"./IconClose-CgjzG0Yf.js";import{_ as ne}from"./IconFile-pApoDIeO.js";import{_ as re,a as ue,b as ce}from"./PhoneInput--Y8b9QdZ.js";import{_ as ie}from"./BasicInput-VlbY6GiE.js";import{_ as pe}from"./ClausesKeeper-gPyacQ05.js";import{_ as me}from"./BlockBalanceAgreement-DSLTUOoQ.js";import{an as _e,r as p,f as x,g as de,D as fe,c as u,b as c,a,C as v,w as g,E as ve,F as y,h as m,i as P,d as he,o as t,e as C,t as V,n as I}from"./index-C9dBN6m4.js";import{u as ke}from"./contracts-BEc0DZS2.js";import{u as ye}from"./files-DnlMbpQ1.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./multiselect-B6DlyfA6.js";import"./component-D8Pmx5O0.js";import"./index-D0iqQ1zq.js";const ge={class:"container"},Ce={class:"section-header"},Ve={class:"breadcrumb"},Ie={class:"form"},Te={class:"special-form-row"},De={key:0,class:"section-header inputs-block"},Ee={class:"section-block_title"},we={key:0,class:"form width-limit"},Fe={key:0,class:"form-field form-field--file form-field--basic"},Pe={class:"chat-files"},Ae={key:1,class:"form-field form-field--file form-field--basic"},Se={class:"chat-files"},Ue=["onClick"],Ne={class:"form-field form-field--file form-field--basic"},Oe={class:"form-field-input__file-wrapper"},$e={class:"form-field-input__file"},Be=["innerHTML"],xe={__name:"ContractEdit",async setup(Le){let A,S;const L=_e(),b=ke(),j=ye(),H=he(),T=de(),h=p(!1),k=p(!1),r=p({}),U=p(null),f=p([]),D=p([]),E=p(null),w=p(null),d=p(0),N=x(()=>L.data),i=x(()=>b.profileList?.[T.params.id]);function M(){if(h.value&&k.value){let o={};Object.keys(r.value).forEach(s=>{o[s]=r.value[s].value});let l=new FormData;Object.keys(r.value).forEach(s=>{l.append(s,r.value[s]?.value)}),l.append("TemplateID",d.value),l.append("Agree",h.value),l.append("AgreeHandle",k.value),l.append("ProfileID",T.params.id),f.value.forEach((s,F)=>{l.append("Document[]",s?.value)}),E.value="pending",b.createNewContract({ProfileID:T.params.id,TemplateID:d.value,Agree:h.value,AgreeHandle:k.value,...o}).then(s=>{s.status==="success"?H.push("/Contracts?section=Profiles"):(E.value="error",w.value=s.data?.Exception)})}}function R(o){f.value=f.value.filter((l,s)=>s!==o)}function q(o){return""+O(o)}function z(o){let l=o.target.files?.[0]||null;l&&(U.value.value="",j.sendFile(l).then(s=>{f.value.push({name:l?.name,value:s.slice(s.lastIndexOf("^")+1,s.length)})}))}function O(o){return o?"<div>"+o?.String+"</div>"+O(o?.Parent):""}return[A,S]=fe(()=>b.fetchContracts().then(()=>{b.fetchProfiles().then(()=>{d.value=i.value?.TemplateID,i.value?.Files&&(D.value=Object.keys(i.value?.Files)?.map(o=>({name:i.value?.Files[o].Name,value:i.value?.Files[o].Name}))),Object.keys(i.value.Attribs).forEach(o=>{r.value[o]={value:i.value.Attribs[o],required:N.value?.Profiles?.Templates?.[d.value]?.Template?.Attribs[o].IsDuty==="1",error:!1}})})})),await A,S(),(o,l)=>{const s=me,F=ve("router-link"),G=pe,J=ie,K=re,Q=ue,W=ce,$=ne,X=se,Y=te,B=ae,Z=oe,ee=le;return t(),u(y,null,[c(s),a("section",null,[a("div",ge,[a("div",Ce,[a("div",Ve,[c(F,{to:"/Contracts",class:"section-label"},{default:g(()=>l[3]||(l[3]=[C("Договор /",-1)])),_:1,__:[3]}),c(F,{to:`/ContractScheme/${o.$route.params.id}`,class:"section-label"},{default:g(()=>[C(V(i.value?.Name),1)]),_:1},8,["to"])]),l[4]||(l[4]=a("h1",{class:"section-title"},"Редактировать договор",-1))]),c(G),i.value?(t(),u(y,{key:0},[a("div",Ie,[(t(!0),u(y,null,P(N.value?.Profiles?.Templates?.[d.value]?.Template?.Attribs,(e,n)=>(t(),u("div",{class:"form-row-wrapper",key:n},[a("div",Te,[e?.Title?(t(),u("div",De,[a("h2",Ee,V(e?.Title),1)])):m("",!0),e?.Type==="Input"&&e?.Check!=="Phone"?(t(),v(J,{key:1,class:I({"special-form-input":!0,"form-field-error":r.value[n].error}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:r.value[n].value,"onUpdate:modelValue":_=>r.value[n].value=_},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):m("",!0),e?.Type==="Input"&&e?.Check==="Phone"?(t(),v(K,{key:2,class:I({"special-form-input":!0,"form-field-error":r.value[n].error}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:r.value[n].value,"onUpdate:modelValue":_=>r.value[n].value=_},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):m("",!0),e?.Type==="TextArea"?(t(),v(Q,{key:3,class:I({"special-form-input":!0,"form-field-error":r.value[n].error}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:r.value[n].value,"onUpdate:modelValue":_=>r.value[n].value=_},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):e?.Type==="Select"?(t(),v(W,{key:4,class:I({"special-form-input":!0,"form-field-error":r.value[n].error}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,options:e?.Options,modelValue:r.value[n].value,"onUpdate:modelValue":_=>r.value[n].value=_},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):m("",!0)])]))),128))]),d.value!==0?(t(),u("div",we,[D.value.length?(t(),u("div",Fe,[a("div",Pe,[(t(!0),u(y,null,P(D.value,(e,n)=>(t(),u("div",{class:"chat-files__item",key:"old-"+n},[a("span",null,[c($,{class:"file-icon"})]),a("span",null,V(e?.name),1)]))),128))])])):m("",!0),f.value.length?(t(),u("div",Ae,[a("div",Se,[(t(!0),u(y,null,P(f.value,(e,n)=>(t(),u("div",{class:"chat-files__item",key:"new-"+n},[a("span",null,[c($,{class:"file-icon"})]),a("span",null,V(e?.name),1),a("button",{class:"close",onClick:_=>R(n)},[c(X)],8,Ue)]))),128))])])):m("",!0),a("label",Ne,[a("div",Oe,[a("input",{ref_key:"fileInput",ref:U,type:"file",onChange:z},null,544),a("div",$e,[c(Y),l[5]||(l[5]=a("span",null,"Прикрепить документ подтверждающий личность",-1))])])]),c(B,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=e=>h.value=e)},{default:g(()=>l[6]||(l[6]=[C(" Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет ",-1)])),_:1,__:[6]},8,["modelValue"]),c(B,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=e=>k.value=e)},{default:g(()=>l[7]||(l[7]=[C(" Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменов и т.п.) ",-1)])),_:1,__:[7]},8,["modelValue"])])):m("",!0),w.value?(t(),u("div",{key:1,class:"error-message width-limit",innerHTML:q(w.value)},null,8,Be)):m("",!0),d.value!==0?(t(),v(Z,{key:2,class:"width-limit","is-loading":E.value==="pending",label:"Сохранить",onClick:l[2]||(l[2]=e=>M())},null,8,["is-loading"])):m("",!0)],64)):(t(),v(ee,{key:1,label:"Профиль договора не найден"}))])])],64)}}},al=be(xe,[["__scopeId","data-v-601edccb"]]);export{al as default};
