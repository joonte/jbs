import{o as V,c as k,a as f,t as m,b,_ as A,f as w,g as u,r as s,i as x}from"./index-c7c24b76.js";import{_ as B}from"./ButtonDefault-626291b9.js";import{_ as S}from"./BasicInput-0178c2f2.js";import"./component2-1c15eb55.js";import"./component-d5bd2a45.js";const q={class:"modal__body"},O=f("div",{class:"list-item__title"},"Введите код подтверждения",-1),R={class:"list-item__subtitle"},U={class:"modal__accept-form"};function j(t,n,c,e,I,r){const l=S,i=B;return V(),k("div",q,[O,f("div",R,"Прислали на "+m(e.mergedData.methodId)+" «"+m(e.mergedData.address)+"» ID - "+m(e.mergedData.contactId),1),f("div",U,[b(l,{label:"Код подтверждения",name:"mailCode",placeholder:"Введите код",modelValue:e.codeMail,"onUpdate:modelValue":n[0]||(n[0]=d=>e.codeMail=d)},null,8,["modelValue"]),b(i,{class:"modal__button",label:"Подтвердить",onClick:n[1]||(n[1]=d=>e.acceptCode())})])])}const N={props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(t,{emit:n}){const c=w(),e=u(()=>c.userInfo),I=u(()=>{var o,a;return(a=Object.keys((o=e.value)==null?void 0:o.Contacts))==null?void 0:a.map(C=>{var p,v,h,D,g;if(!((h=(v=(p=e.value)==null?void 0:p.Contacts)==null?void 0:v[C])!=null&&h.IsHidden))return(g=(D=e.value)==null?void 0:D.Contacts)==null?void 0:g[C]})}),r=s(""),l=s(t.data.contactId||""),i=s(t.data.methodId||""),d=s(t.data.address||""),y=t.data.sendConfirmRequest;x(()=>{});const M=o=>I.value.find(a=>a.ID===o),_=u(()=>{const o=M(t.data.contactId);return o?{...t.data,methodId:o.MethodID,address:o.Address}:(console.error("Контакт не найден по ID",t.data.contactId),t.data)});return{methodId:i,address:d,contactId:l,acceptCode:async()=>{const o={Method:_.value.methodId,Value:_.value.address,ContactID:t.data.contactId,Confirm:r.value};try{(await y("/API/Confirm",o)).Status==="Ok"?(n("modalClose"),await c.fetchUserData()):console.error("Ошибка подтверждения кода")}catch(a){console.error("Ошибка запроса подтверждения кода",a)}},codeMail:r,mergedData:_}}},F=A(N,[["render",j]]);export{F as default};
