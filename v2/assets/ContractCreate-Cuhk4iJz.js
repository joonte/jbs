import{_ as ne}from"./ButtonDefault-BIBStZbJ.js";import{m as re}from"./bootstrap-vue-next-DwS3lKQb.js";import{_ as ue}from"./IconClip-CVpcn4fA.js";import{_ as ce}from"./IconClose-B_k4TzXM.js";import{_ as ie}from"./IconFile-DZJ6AVgq.js";import{_ as pe,a as me,b as fe}from"./PhoneInput-Be15H1xn.js";import{_ as _e}from"./BasicInput-KlObNzdO.js";import{_ as de}from"./SimpleCheckbox-BAAxXipX.js";import{_ as ve}from"./ClausesKeeper-CTja-fCz.js";import{_ as he}from"./BlockBalanceAgreement-qtspRQ_B.js";import{ao as ke,u as ye,r as _,f as F,H as M,s as ge,m as Ce,g as be,c,b as d,a as s,h as m,C as k,w as D,E as Ve,F as y,i as P,x as Te,d as Ie,o as n,e as E,t as $,n as V}from"./index-CmCGXBst.js";import{u as De}from"./contracts-P7YPBhEI.js";import{u as Pe}from"./files-Dl1sPvHV.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./multiselect-DhoC9bwZ.js";import"./component-0WedTVCo.js";const we={class:"section"},Re={class:"container"},Se={class:"tw-mb-4"},Ue={class:"form"},qe={class:"form"},Ae={class:"special-form-row"},Be={key:0,class:"section-header inputs-block"},Fe={class:"section-block_title"},Me={key:0,class:"form width-limit"},$e={key:0,class:"form-field form-field--file form-field--basic"},xe={class:"chat-files"},Ne=["onClick"],Le={class:"form-field form-field--file form-field--basic"},Oe={class:"form-field-input__file-wrapper"},He={class:"form-field-input__file"},je=["innerHTML"],Ke={__name:"ContractCreate",setup(ze){const x=ke(),T=De(),N=ye(),L=Pe(),v=Ie(),i=be(),O=Te("emitter"),g=_(!1),C=_(!1),t=_({}),w=_(null),h=_([]),b=_(null),I=_(null),r=_(0),p=F(()=>x.data),H=F(()=>N?.userInfo?.Email),R=p.value,S={};for(const l in R.Regulars)S[l]=R.Regulars[l];const j=l=>S[l]||null,K=()=>{const l=p.value;return l&&l.Regulars&&l.Regulars.Phone?new RegExp(l.Regulars.Phone):/^[0-9]{10}$/},U=l=>{l.key==="Enter"&&l.ctrlKey&&q()};M(()=>{document.addEventListener("keyup",U)}),ge(()=>{document.removeEventListener("keyup",U)});function z(l){h.value=h.value.filter((o,u)=>u!==l)}function q(){if(g.value&&C.value){let l=new FormData;Object.keys(t.value).forEach(o=>{l.append(o,t.value[o]?.value)}),l.append("TemplateID",r.value),l.append("Agree",g.value),l.append("AgreeHandle",C.value),h.value.forEach((o,u)=>{l.append("Document[]",o?.value)}),b.value="pending",T.createNewContractFormData(l).then(o=>{o.status==="success"?(b.value="success",i.query.ProfileEmpty?T.contractMake({ProfileID:o.data?.ProfileID,TypeID:r.value}).then(u=>{u.data.Status==="Ok"&&(O.emit("open-modal",{component:"SuccessContract",data:"Профиль и договор успешно созданы!"}),i.query.Redirect?v.push(`${i.query.Redirect}`):v.push("/Contracts"))}):i.query.ContractNew?T.contractMake({ProfileID:o.data?.ProfileID,TypeID:r.value}).then(u=>{u.data.Status==="Ok"&&v.push("/Basket")}):i.query.Contract?v.push(`/Balance/${i.query.Contract}`):!i.query.Contract&&i.query.TemplateID?v.push("/Basket"):v.push("/Contracts")):(b.value="error",I.value=o.data?.Exception)})}}function G(l){return""+A(l)}function A(l){return l?"<div>"+l?.String+"</div>"+A(l?.Parent):""}function J(l){let o=l.target.files?.[0]||null;o&&(w.value.value="",L.sendFile(o).then(u=>{h.value.push({name:o?.name,value:u.slice(u.lastIndexOf("^")+1,u.length)})}))}return Ce(r,()=>{t.value={},Object.keys(p.value?.Profiles?.Templates?.[r.value]?.Template?.Attribs).forEach(l=>{t.value[l]={error:!1,value:(p.value?.Profiles?.Templates?.[r.value]?.Template?.Attribs[l]?.Value==="%Email%"?H.value:p.value?.Profiles?.Templates?.[r.value]?.Template?.Attribs[l]?.Value)||null,required:p.value?.Profiles?.Templates?.[r.value]?.Template?.Attribs[l]?.IsDuty==="1"}})}),M(()=>{p.value?.Contracts?.Types&&i.query.TemplateID&&(r.value=i.query.TemplateID)}),(l,o)=>{const u=he,Q=Ve("router-link"),W=ve,X=de,Y=_e,Z=pe,ee=me,le=fe,oe=ie,ae=ce,te=ue,B=re,se=ne;return n(),c(y,null,[d(u),s("section",we,[s("div",Re,[s("div",Se,[d(Q,{to:"/Contracts",class:"section-label"},{default:D(()=>o[4]||(o[4]=[E("Мои договора",-1)])),_:1,__:[4]}),o[5]||(o[5]=s("h1",{class:"section-title"},"Создать профиль",-1))]),d(W),o[9]||(o[9]=s("div",{class:"section-header"},[s("h2",{class:"section-block_title"},"Шаблон")],-1)),s("form",Ue,[(n(!0),c(y,null,P(p.value?.Contracts?.Types,e=>(n(),c(y,{key:e?.ProfileTemplateID},[e?.ProfileTemplateID!==""?(n(),k(X,{key:0,label:e?.Name,value:e?.ProfileTemplateID,modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=a=>r.value=a)},null,8,["label","value","modelValue"])):m("",!0)],64))),128))]),s("form",qe,[(n(!0),c(y,null,P(p.value?.Profiles?.Templates?.[r.value]?.Template?.Attribs,(e,a)=>(n(),c("div",{class:"form-row-wrapper",key:a},[s("div",Ae,[e?.Title?(n(),c("div",Be,[s("h2",Fe,$(e?.Title),1)])):m("",!0),e?.Type==="Input"&&e?.Check!=="Phone"?(n(),k(Y,{key:1,class:V({"special-form-input":!0,"form-field-error":t.value[a].error,"form-error":!t.value[a].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:t.value[a].value,"onUpdate:modelValue":f=>t.value[a].value=f,pattern:j(e?.Check)},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue","pattern"])):m("",!0),e?.Type==="Input"&&e?.Check==="Phone"?(n(),k(Z,{key:2,class:V({"special-form-input":!0,"form-field-error":t.value[a].error,"form-error":!t.value[a].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:t.value[a].value,"onUpdate:modelValue":f=>t.value[a].value=f,pattern:K()},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue","pattern"])):m("",!0),e?.Type==="TextArea"?(n(),k(ee,{key:3,class:V({"special-form-input":!0,"form-field-error":t.value[a].error,"form-error":!t.value[a].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:t.value[a].value,"onUpdate:modelValue":f=>t.value[a].value=f},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):e?.Type==="Select"?(n(),k(le,{key:4,class:V({"special-form-input":!0,"form-field-error":t.value[a].error,"form-error":!t.value[a].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,options:e?.Options,modelValue:t.value[a].value,"onUpdate:modelValue":f=>t.value[a].value=f},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):m("",!0)])]))),128))]),r.value!==0?(n(),c("div",Me,[h.value.length?(n(),c("div",$e,[s("div",xe,[(n(!0),c(y,null,P(h.value,(e,a)=>(n(),c("div",{class:"chat-files__item",key:a},[s("span",null,[d(oe,{class:"file-icon"})]),s("span",null,$(e?.name),1),s("button",{class:"close",onClick:f=>z(a)},[d(ae)],8,Ne)]))),128))])])):m("",!0),s("label",Le,[s("div",Oe,[s("input",{ref_key:"fileInput",ref:w,type:"file",onChange:J},null,544),s("div",He,[d(te),o[6]||(o[6]=s("span",null,"Прикрепить документ подтверждающий личность",-1))])])]),d(B,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:g.value,"onUpdate:modelValue":o[1]||(o[1]=e=>g.value=e)},{default:D(()=>o[7]||(o[7]=[E(" Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет ",-1)])),_:1,__:[7]},8,["modelValue"]),d(B,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=e=>C.value=e)},{default:D(()=>o[8]||(o[8]=[E(" Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменов и т.п.) ",-1)])),_:1,__:[8]},8,["modelValue"])])):m("",!0),I.value?(n(),c("div",{key:1,class:"error-message width-limit",innerHTML:G(I.value)},null,8,je)):m("",!0),r.value!==0?(n(),k(se,{key:2,class:"width-limit","is-loading":b.value==="pending",label:"Зарегистрировать",onClick:o[3]||(o[3]=e=>q())},null,8,["is-loading"])):m("",!0)])])],64)}}},cl=Ee(Ke,[["__scopeId","data-v-e7e1743e"]]);export{cl as default};
