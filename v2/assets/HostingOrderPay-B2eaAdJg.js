import{_ as A}from"./EmptyStateBlock-CV1Zaaf7.js";import{_ as K}from"./BlockOrderPayBalance-CwLP8dIN.js";import{_ as T}from"./ParamsAccordionBlock-cjEabFcr.js";import{_ as U}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as V}from"./ButtonDefault-eJbeaBtE.js";import{_ as j}from"./BlockBalanceAgreement-DjWMZ940.js";import{r as k,f as g,g as J,h as M,s as q,E as f,c,b as i,a as e,t as n,F as y,i as z,I as E,j as G,J as H,d as Q,o as r}from"./index-XtiBO-PZ.js";import{u as W}from"./hosting-B5Wk2kbD.js";import{u as X}from"./contracts-BdlSA9YT.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-CxxkTytZ.js";import"./component-YfTGPdLe.js";import"./globalActions-Tf2FwXht.js";import"./IconHelp-C9M5tavY.js";import"./IconClose-s_NQ_Q4c.js";const Z={key:0,class:"hosting-sheme"},ee={class:"section"},se={class:"container"},oe={class:"section-header"},te={class:"section-header__wrapper"},ae={class:"section-title"},ne={class:"section-container"},le={class:"section-label __login"},ce={class:"section-label __login"},ie={class:"section"},re={class:"container"},_e={class:"total-block"},de={class:"total-block__row divider-bottom"},ue={class:"total-block__col"},me={class:"total-block__col"},ve={class:"total-block__col"},pe={class:"total-block__row total-block__row--big economy-line"},he={class:"total-block__col flex-col"},ge={class:"red"},ye={class:"total-block__row total-block__row--big"},be={class:"total-block__col"},ke={class:"total-block__col"},fe={key:1,class:"section"},De={class:"container"},Be={key:1,class:"section"},Ie={class:"container"},Pe={__name:"HostingOrderPay",async setup(Se){let _,d;const u=W(),D=X(),L=J(),B=Q(),v=k(!1),s=k(null),p=k(!1),a=g(()=>Object.keys(u?.hostingList).map(t=>u?.hostingList[t]).find(t=>t.OrderID===L.params.id)),m=g(()=>u?.hostingSchemes?.[a.value?.SchemeID]),I=g(()=>D.contractsList);function h(t){return Number(t).toFixed(2)||0}function P(){let t=0;return s.value?.discounts?.Bonuses.map(o=>{t+=+o.Economy}),t}function b(){p.value=!0,u.HostingOrderPay({HostingOrderID:a.value?.ID,DaysPayFromBallance:s.value?.daysFromBalance||0,DaysPay:s.value?.actualDays,IsChange:!0}).then(t=>{let{result:o,error:w}=t;o==="SUCCESS"?B.push(`/HostingOrders/${a.value?.OrderID}`):o==="BASKET"&&B.push("/Basket"),p.value=!1})}const S=t=>{t.key==="Enter"&&t.ctrlKey&&!x.value&&b()},x=g(()=>s.value===null);M(()=>{document.addEventListener("keyup",S)}),q(()=>{document.removeEventListener("keyup",S)});function F(t){s.value=t}return[_,d]=f(()=>u.fetchHostingOrders()),await _,d(),[_,d]=f(()=>u.fetchHostingSchemes()),await _,d(),[_,d]=f(()=>D.fetchContracts()),await _,d(),(t,o)=>{const w=j,C=V,N=U,$=T,R=K,O=A;return r(),c(y,null,[i(w),a.value?(r(),c("div",Z,[e("div",ee,[e("div",se,[e("div",oe,[e("div",te,[e("h1",ae,n(a.value?.Domain),1),i(C,{class:"btn--wide",label:v.value||I.value[a.value.ContractID]?.Balance>s.value?.price?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||s.value?.price===null,"is-loading":p.value,onClick:o[0]||(o[0]=l=>b())},null,8,["label","disabled","is-loading"])]),e("div",ne,[e("span",le,"Логин: "+n(a.value?.Login),1),o[3]||(o[3]=e("span",{class:"section-label __login"},"/",-1)),e("span",ce,"Тариф: "+n(m.value?.Name),1)])]),i(N)])]),i($,{"params-list":m.value?.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),m.value?.IsPayed&&m.value?.IsProlong||!m.value?.IsPayed?(r(),c(y,{key:0},[i(R,{contractID:a.value?.ContractID,daysRemainded:a.value?.DaysRemainded,scheme:m.value,orderID:a.value?.OrderID,isOrderID:!0,onSelect:F,isBalancePay:v.value,"onUpdate:isBalancePay":o[1]||(o[1]=l=>v.value=l)},null,8,["contractID","daysRemainded","scheme","orderID","isBalancePay"]),e("div",ie,[e("div",re,[e("div",_e,[s.value?.discounts?.Bonuses?.length>0?(r(),c(y,{key:0},[e("div",de,[o[4]||(o[4]=e("div",{class:"total-block__col"},"Цена тарифа",-1)),e("div",ue,n(h(s.value?.price))+" ₽",1)]),(r(!0),c(y,null,G(s.value?.discounts?.Bonuses,l=>(r(),c("div",{key:l?.Discount+"-"+l?.Days,class:"total-block__row no-divider"},[e("div",me,"Скидка "+n(l?.Discount)+"% на "+n(l?.Days)+" дней",1),e("div",ve,"-"+n(h(l?.Economy))+" ₽",1)]))),128))],64)):z("",!0),E(e("div",pe,[o[5]||(o[5]=e("div",{class:"total-block__col red"},"Выгода",-1)),e("div",he,[e("span",null,[e("s",null,n(h(s.value?.price))+" ₽",1)]),e("span",ge,"-"+n(P())+" ₽",1)])],512),[[H,s.value?.discounts?.Bonuses?.length>0]]),E(e("div",ye,[e("div",be,"Итого за "+n(s.value?.label),1),e("div",ke,n(h(s.value?.price-P()))+" ₽",1)],512),[[H,s.value?.price]])]),i(C,{class:"btn--wide",label:v.value||I.value[a.value.ContractID]?.Balance>s.value?.price?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||s.value?.price===null,"is-loading":p.value,onClick:o[2]||(o[2]=l=>b())},null,8,["label","disabled","is-loading"])])])],64)):(r(),c("div",fe,[e("div",De,[i(O,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),c("div",Be,[e("div",Ie,[i(O,{label:"не удалось найти заказ хостинга"})])]))],64)}}},Ve=Y(Pe,[["__scopeId","data-v-5a6d2cd2"]]);export{Ve as default};
