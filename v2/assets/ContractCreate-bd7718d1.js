import{j as be,o as n,c as f,b as v,a as r,w as H,d as j,F as U,x as K,k as h,y as m,t as fe,n as L,p as me,l as Ve,_ as Ie,u as Te,f as Pe,e as De,a7 as Ee,S as Se,r as g,g as de,i as pe,O as Re,h as Ue}from"./index-5f8fd0e9.js";import{u as we}from"./contracts-00b6c53b.js";import{s as _e}from"./SimpleCheckbox-439c1d14.js";import{_ as he}from"./BasicInput-4035fd95.js";import{P as ie,T as ve,S as ge}from"./PhoneInput-482cb338.js";import{B as ke}from"./BlockBalanceAgreement-cf03db60.js";import{u as xe}from"./files-100f2518.js";import{I as ye}from"./IconFile-47d018e2.js";import{I as Ce}from"./IconClose-2e1ba86d.js";import{_ as Fe}from"./ButtonDefault-458eab69.js";import{f as Be}from"./bootstrap-vue-next.es-a97602fc.js";import{_ as Ae}from"./IconClip-a9013ba2.js";import{_ as Me}from"./ClausesKeeper-8218189c.js";/* empty css                                                                       */import"./component-62d13c49.js";import"./multiselect-482845f2.js";import"./IconArrow-c9744352.js";const z=C=>(me("data-v-758d9312"),C=C(),Ve(),C),qe={class:"section"},Le={class:"container"},Ne={class:"section-header"},Oe=z(()=>r("h1",{class:"section-title"},"Создать профиль",-1)),He=z(()=>r("div",{class:"section-header"},[r("h2",{class:"section-block_title"},"Шаблон")],-1)),je={class:"form"},Ke={class:"form"},ze={class:"form-row-wrapper"},Ge={class:"special-form-row"},Je={key:0,class:"section-header inputs-block"},Qe={class:"section-block_title"},We={key:0,class:"form width-limit"},Xe={key:0,class:"form-field form-field--file form-field--basic"},Ye={class:"chat-files"},Ze={class:"chat-files__item"},$e=["onClick"],eo={class:"form-field form-field--file form-field--basic"},oo={class:"form-field-input__file-wrapper"},lo={class:"form-field-input__file"},ao=z(()=>r("span",null,"Прикрепить документ подтверждающий личность",-1)),ro=["innerHTML"];function no(C,s,w,l,p,t){var B,A,D,M,E,q,S;const N=ke,V=be("router-link"),I=Me,k=_e,x=he,y=ie,b=ve,F=ge,u=ye,d=Ce,O=Ae,T=Be,P=Fe;return n(),f(U,null,[v(N),r("div",qe,[r("div",Le,[r("div",Ne,[v(V,{class:"section-label",to:"/Contracts"},{default:H(()=>[j("Мои договора")]),_:1}),Oe]),v(I),He,r("div",je,[(n(!0),f(U,null,K((A=(B=l.getConfig)==null?void 0:B.Contracts)==null?void 0:A.Types,e=>(n(),f(U,null,[(e==null?void 0:e.ProfileTemplateID)!==""?(n(),m(k,{key:0,label:e==null?void 0:e.Name,value:e==null?void 0:e.ProfileTemplateID,modelValue:l.templateValue,"onUpdate:modelValue":s[0]||(s[0]=o=>l.templateValue=o)},null,8,["label","value","modelValue"])):h("",!0)],64))),256))]),r("div",Ke,[(n(!0),f(U,null,K((S=(q=(E=(M=(D=l.getConfig)==null?void 0:D.Profiles)==null?void 0:M.Templates)==null?void 0:E[l.templateValue])==null?void 0:q.Template)==null?void 0:S.Attribs,(e,o)=>(n(),f("div",ze,[r("div",Ge,[e!=null&&e.Title?(n(),f("div",Je,[r("h2",Qe,fe(e==null?void 0:e.Title),1)])):h("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)!=="Phone"?(n(),m(x,{key:1,class:L({"special-form-input":!0,"form-field-error":l.form[o].error,"form-error":!l.form[o].value}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":a=>l.form[o].value=a,pattern:l.getFieldRegex(e==null?void 0:e.Check)},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue","pattern"])):h("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)==="Phone"?(n(),m(y,{key:2,class:L({"special-form-input":!0,"form-field-error":l.form[o].error,"form-error":!l.form[o].value}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":a=>l.form[o].value=a,pattern:l.getPhoneRegex()},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue","pattern"])):h("",!0),(e==null?void 0:e.Type)==="TextArea"?(n(),m(b,{key:3,class:L({"special-form-input":!0,"form-field-error":l.form[o].error,"form-error":!l.form[o].value}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":a=>l.form[o].value=a},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):(e==null?void 0:e.Type)==="Select"?(n(),m(F,{key:4,class:L({"special-form-input":!0,"form-field-error":l.form[o].error,"form-error":!l.form[o].value}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,options:e==null?void 0:e.Options,modelValue:l.form[o].value,"onUpdate:modelValue":a=>l.form[o].value=a},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):h("",!0)])]))),256))]),l.templateValue!==0?(n(),f("div",We,[l.fileList.length?(n(),f("div",Xe,[r("div",Ye,[(n(!0),f(U,null,K(l.fileList,(e,o)=>(n(),f("div",Ze,[r("span",null,[v(u,{class:"file-icon"})]),r("span",null,fe(e==null?void 0:e.name),1),r("button",{class:"close",onClick:a=>l.removeFile(o)},[v(d)],8,$e)]))),256))])])):h("",!0),r("label",eo,[r("div",oo,[r("input",{ref:"fileInput",type:"file",onChange:s[1]||(s[1]=(...e)=>l.fileUpload&&l.fileUpload(...e))},null,544),r("div",lo,[v(O),ao])])]),v(T,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agree,"onUpdate:modelValue":s[2]||(s[2]=e=>l.agree=e)},{default:H(()=>[j("Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет")]),_:1},8,["modelValue"]),v(T,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agreeHandle,"onUpdate:modelValue":s[3]||(s[3]=e=>l.agreeHandle=e)},{default:H(()=>[j("Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменто и т.п.)")]),_:1},8,["modelValue"])])):h("",!0),l.createProfileErrorMessage?(n(),f("div",{key:1,class:"error-message width-limit",innerHTML:l.formErrorMessage(l.createProfileErrorMessage)},null,8,ro)):h("",!0),l.templateValue!==0?(n(),m(P,{key:2,class:"width-limit","is-loading":l.createProfileResult==="pending",label:"Зарегистрировать",onClick:s[4]||(s[4]=e=>l.checkForm())},null,8,["is-loading"])):h("",!0)])])],64)}const so={components:{TextAreaLine:ve,simpleCheckbox:_e,basicInput:he,SelectLine:ge,PhoneInput:ie,IconFile:ye,IconClose:Ce,BlockBalanceAgreement:ke},setup(){const C=Te(),s=we(),w=Pe(),l=xe(),p=De(),t=Ee(),N=Se("emitter"),V=g(!1),I=g(!1),k=g({}),x=g(null),y=g([]),b=g(null),F=g(null),u=g(0),d=de(()=>C.ConfigList),O=de(()=>{var o;return(o=w==null?void 0:w.userInfo)==null?void 0:o.Email}),T=d.value,P={};for(const o in T.Regulars)P[o]=T.Regulars[o];const B=o=>P[o]||null,A=()=>{const o=d.value;return o&&o.Regulars&&o.Regulars.Phone?new RegExp(o.Regulars.Phone):/^[0-9]{10}$/},D=o=>{o.key==="Enter"&&o.ctrlKey&&E()};pe(()=>{document.addEventListener("keyup",D)}),Re(()=>{document.removeEventListener("keyup",D)});function M(o){y.value=y.value.filter((a,c)=>c!==o)}function E(){if(V.value&&I.value){let o=new FormData;Object.keys(k.value).forEach(a=>{var c;o.append(a,(c=k.value[a])==null?void 0:c.value)}),o.append("TemplateID",u.value),o.append("Agree",V.value),o.append("AgreeHandle",I.value),y.value.forEach((a,c)=>{o.append("Document[]",a==null?void 0:a.value)}),b.value="pending",s.createNewContractFormData(o).then(a=>{var c,_,R;a.status==="success"?(b.value="success",t.query.ProfileEmpty?s.contractMake({ProfileID:(c=a.data)==null?void 0:c.ProfileID,TypeID:u.value}).then(i=>{i.data.Status==="Ok"&&(N.emit("open-modal",{component:"SuccessContract",data:"Профиль и договор успешно созданы!"}),t.query.Redirect?p.push(`${t.query.Redirect}`):p.push("/Contracts"))}):t.query.ContractNew?(s.contractMake({ProfileID:(_=a.data)==null?void 0:_.ProfileID,TypeID:u.value}).then(i=>{i.data.Status==="Ok"&&p.push("/Basket")}),console.log(a)):t.query.Contract?p.push(`/Balance/${t.query.Contract}`):!t.query.Contract&&t.query.TemplateID?p.push("/Basket"):p.push("/Contracts")):(b.value="error",F.value=(R=a.data)==null?void 0:R.Exception)})}}function q(o){return""+S(o)}function S(o){return o?"<div>"+(o==null?void 0:o.String)+"</div>"+S(o==null?void 0:o.Parent):""}function e(o){var c;let a=((c=o.target.files)==null?void 0:c[0])||null;a&&(x.value.value="",l.sendFile(a).then(_=>{y.value.push({name:a==null?void 0:a.name,value:_.slice(_.lastIndexOf("^")+1,_.length)})}))}return Ue(u,()=>{var o,a,c,_,R;k.value={},Object.keys((R=(_=(c=(a=(o=d.value)==null?void 0:o.Profiles)==null?void 0:a.Templates)==null?void 0:c[u.value])==null?void 0:_.Template)==null?void 0:R.Attribs).forEach(i=>{var G,J,Q,W,X,Y,Z,$,ee,oe,le,ae,re,ne,se,ce,te,ue;k.value[i]={error:!1,value:(((Y=(X=(W=(Q=(J=(G=d.value)==null?void 0:G.Profiles)==null?void 0:J.Templates)==null?void 0:Q[u.value])==null?void 0:W.Template)==null?void 0:X.Attribs[i])==null?void 0:Y.Value)==="%Email%"?O.value:(ae=(le=(oe=(ee=($=(Z=d.value)==null?void 0:Z.Profiles)==null?void 0:$.Templates)==null?void 0:ee[u.value])==null?void 0:oe.Template)==null?void 0:le.Attribs[i])==null?void 0:ae.Value)||null,required:((ue=(te=(ce=(se=(ne=(re=d.value)==null?void 0:re.Profiles)==null?void 0:ne.Templates)==null?void 0:se[u.value])==null?void 0:ce.Template)==null?void 0:te.Attribs[i])==null?void 0:ue.IsDuty)==="1"}})}),pe(()=>{var o,a;console.log(t),console.log(p.options,"options"),console.log(p.options.history.state.back,"full path"),(a=(o=d.value)==null?void 0:o.Contracts)!=null&&a.Types&&t.query.TemplateID&&(u.value=t.query.TemplateID)}),{getConfig:d,templateValue:u,agreeHandle:I,agree:V,createProfileResult:b,createProfileErrorMessage:F,checkForm:E,formErrorMessage:q,form:k,fileInput:x,fileList:y,removeFile:M,fileUpload:e,getPhoneRegex:A,getFieldRegex:B,fieldRegexMap:P}}},To=Ie(so,[["render",no],["__scopeId","data-v-758d9312"]]);export{To as default};
