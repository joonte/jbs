import{j as Z,o as n,c as u,a as c,b as p,w as L,d as U,t as x,F as A,v as M,k as _,x as g,n as O,p as $,l as ee,_ as le,u as oe,e as ae,a6 as se,r as i,g as z}from"./index-ed1f28f8.js";import{u as re}from"./contracts-cedf6a91.js";import{s as ne}from"./SimpleCheckbox-3802eac0.js";import{_ as G}from"./BasicInput-13cf2877.js";import{P as J,T as K,S as Q}from"./PhoneInput-bda7145f.js";import{u as ce}from"./files-d0c0dbbe.js";import{I as W}from"./IconFile-69b8a8f8.js";import{I as X}from"./IconClose-a1e58263.js";import{E as te}from"./EmptyStateBlock-dbc11827.js";import{_ as ue}from"./ButtonDefault-a8aacc82.js";import{f as de}from"./bootstrap-vue-next.es-79226723.js";import{_ as fe}from"./IconClip-e63d2ee8.js";import{_ as pe}from"./ClausesKeeper-9aa8ead7.js";import"./component2-08856ab6.js";import"./component-cdbc2d35.js";import"./multiselect-198a8c51.js";const Y=h=>($("data-v-4b2e1803"),h=h(),ee(),h),_e={class:"section"},ie={class:"container"},he={class:"section-header"},ve={class:"breadcrumb"},ke=Y(()=>c("h1",{class:"section-title"},"Редактировать договор",-1)),be={class:"form"},ge={class:"form-row-wrapper"},ye={class:"special-form-row"},Ce={key:0,class:"section-header inputs-block"},Ve={class:"section-block_title"},me={key:0,class:"form width-limit"},Ie={key:0,class:"form-field form-field--file form-field--basic"},Ee={class:"chat-files"},Te={class:"chat-files__item"},Pe={key:1,class:"form-field form-field--file form-field--basic"},Se={class:"chat-files"},Fe={class:"chat-files__item"},we=["onClick"],De={class:"form-field form-field--file form-field--basic"},Le={class:"form-field-input__file-wrapper"},Ue={class:"form-field-input__file"},xe=Y(()=>c("span",null,"Прикрепить документ подтверждающий личность",-1)),Ae=["innerHTML"];function Oe(h,t,j,l,y,C){var w,D,I,a,r;const v=Z("router-link"),d=pe,P=G,k=J,S=K,V=Q,m=W,b=X,F=fe,f=de,N=ue,H=te;return n(),u("div",_e,[c("div",ie,[c("div",he,[c("div",ve,[p(v,{class:"section-label",to:"/Contracts"},{default:L(()=>[U("Договор /")]),_:1}),p(v,{class:"section-label",to:`/ContractScheme/${h.$route.params.id}`},{default:L(()=>{var e;return[U(x((e=l.getProfile)==null?void 0:e.Name),1)]}),_:1},8,["to"])]),ke]),p(d),l.getProfile?(n(),u(A,{key:0},[c("div",be,[(n(!0),u(A,null,M((r=(a=(I=(D=(w=l.getConfig)==null?void 0:w.Profiles)==null?void 0:D.Templates)==null?void 0:I[l.templateValue])==null?void 0:a.Template)==null?void 0:r.Attribs,(e,o)=>(n(),u("div",ge,[c("div",ye,[e!=null&&e.Title?(n(),u("div",Ce,[c("h2",Ve,x(e==null?void 0:e.Title),1)])):_("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)!=="Phone"?(n(),g(P,{key:1,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":s=>l.form[o].value=s},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):_("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)==="Phone"?(n(),g(k,{key:2,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":s=>l.form[o].value=s},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):_("",!0),(e==null?void 0:e.Type)==="TextArea"?(n(),g(S,{key:3,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":s=>l.form[o].value=s},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):(e==null?void 0:e.Type)==="Select"?(n(),g(V,{key:4,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,options:e==null?void 0:e.Options,modelValue:l.form[o].value,"onUpdate:modelValue":s=>l.form[o].value=s},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):_("",!0)])]))),256))]),l.templateValue!==0?(n(),u("div",me,[l.fileListOld.length?(n(),u("div",Ie,[c("div",Ee,[(n(!0),u(A,null,M(l.fileListOld,(e,o)=>(n(),u("div",Te,[c("span",null,[p(m,{class:"file-icon"})]),c("span",null,x(e==null?void 0:e.name),1)]))),256))])])):_("",!0),l.fileList.length?(n(),u("div",Pe,[c("div",Se,[(n(!0),u(A,null,M(l.fileList,(e,o)=>(n(),u("div",Fe,[c("span",null,[p(m,{class:"file-icon"})]),c("span",null,x(e==null?void 0:e.name),1),c("button",{class:"close",onClick:s=>l.removeFile(o)},[p(b)],8,we)]))),256))])])):_("",!0),c("label",De,[c("div",Le,[c("input",{ref:"fileInput",type:"file",onChange:t[0]||(t[0]=(...e)=>l.fileUpload&&l.fileUpload(...e))},null,544),c("div",Ue,[p(F),xe])])]),p(f,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agree,"onUpdate:modelValue":t[1]||(t[1]=e=>l.agree=e)},{default:L(()=>[U("Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет")]),_:1},8,["modelValue"]),p(f,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agreeHandle,"onUpdate:modelValue":t[2]||(t[2]=e=>l.agreeHandle=e)},{default:L(()=>[U("Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменто и т.п.)")]),_:1},8,["modelValue"])])):_("",!0),l.createProfileErrorMessage?(n(),u("div",{key:1,class:"error-message width-limit",innerHTML:l.formErrorMessage(l.createProfileErrorMessage)},null,8,Ae)):_("",!0),l.templateValue!==0?(n(),g(N,{key:2,class:"width-limit","is-loading":l.createProfileResult==="pending",label:"Сохранить",onClick:t[3]||(t[3]=e=>l.checkForm())},null,8,["is-loading"])):_("",!0)],64)):(n(),g(H,{key:1,label:"Профиль договора не найден"}))])])}const Ne={components:{TextAreaLine:K,simpleCheckbox:ne,basicInput:G,SelectLine:Q,PhoneInput:J,IconFile:W,IconClose:X},async setup(){const h=oe(),t=re(),j=ce(),l=ae(),y=se(),C=i(!1),v=i(!1),d=i({}),P=i(null),k=i([]),S=i([]),V=i(null),m=i(null),b=i(0),F=z(()=>h.ConfigList),f=z(()=>{var a;return(a=t.profileList)==null?void 0:a[y.params.id]});function N(){let a=!1;if(Object.keys(d.value).forEach(r=>{d.value[r].value===null&&d.value[r].required?(d.value[r].error=!0,a=!0,console.log(a,"1")):d.value[r].error=!1}),!a&&C.value&&v.value){let r={},e=new FormData;Object.keys(d.value).forEach(o=>{var s;e.append(o,(s=d.value[o])==null?void 0:s.value)}),e.append("TemplateID",b.value),e.append("Agree",C.value),e.append("AgreeHandle",v.value),e.append("ProfileID",y.params.id),k.value.forEach((o,s)=>{e.append("Document[]",o==null?void 0:o.value)}),V.value="pending",t.createNewContract({ProfileID:y.params.id,TemplateID:b.value,Agree:C.value,AgreeHandle:v.value,...r}).then(o=>{var s;o.status==="success"?l.push(`/ContractScheme/${y.params.id}`):(V.value="error",m.value=(s=o.data)==null?void 0:s.Exception)})}}function H(a){k.value=k.value.filter((r,e)=>e!==a)}function w(a){return""+I(a)}function D(a){var e;let r=((e=a.target.files)==null?void 0:e[0])||null;r&&(P.value.value="",j.sendFile(r).then(o=>{k.value.push({name:r==null?void 0:r.name,value:o.slice(o.lastIndexOf("^")+1,o.length)})}))}function I(a){return a?"<div>"+(a==null?void 0:a.String)+"</div>"+I(a==null?void 0:a.Parent):""}return await t.fetchContracts().then(()=>{t.fetchProfiles().then(()=>{var a,r,e,o;b.value=(a=f.value)==null?void 0:a.TemplateID,(r=f.value)!=null&&r.Files&&(S.value=(o=Object.keys((e=f.value)==null?void 0:e.Files))==null?void 0:o.map(s=>{var E,T;return{name:(E=f.value)==null?void 0:E.Files[s].Name,value:(T=f.value)==null?void 0:T.Files[s].Name}})),Object.keys(f.value.Attribs).forEach(s=>{var E,T,B,R,q;d.value[s]={value:f.value.Attribs[s],required:((q=(R=(B=(T=(E=F.value)==null?void 0:E.Profiles)==null?void 0:T.Templates)==null?void 0:B[b.value])==null?void 0:R.Template)==null?void 0:q.Attribs[s].IsDuty)==="1",error:!1}})})}),await h.fetchConfig(),{getConfig:F,getProfile:f,templateValue:b,agreeHandle:v,fileInput:P,fileList:k,fileListOld:S,agree:C,createProfileResult:V,createProfileErrorMessage:m,checkForm:N,fileUpload:D,removeFile:H,formErrorMessage:w,form:d}}},el=le(Ne,[["render",Oe],["__scopeId","data-v-4b2e1803"]]);export{el as default};
