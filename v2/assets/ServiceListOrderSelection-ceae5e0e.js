import{_ as J,r as b,h as F,i as Q,o as u,c as _,a as c,t as O,m as ae,k as I,p as X,l as Z,j as oe,b as H,x as Y,w as ne,F as j,v as L,d as R,Y as te,af as le,f as de,e as re,a7 as ie,R as se,g}from"./index-01c72474.js";import{u as ce}from"./contracts-b8a59bf1.js";import{u as ue}from"./services-479ed473.js";import{s as _e}from"./multiselect-b3bc32a2.js";import{_ as De}from"./ButtonDefault-6f60da99.js";import{_ as fe}from"./BlockSelectContract-bf712c6c.js";import{_ as ve}from"./ClausesKeeper-39926d40.js";const he={props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:D}){const s=b(null);function o(){D("update:modelValue",l.data)}return F(l,()=>{s.value=l.modelValue}),Q(()=>{s.value=l.modelValue}),{updateValue:o,inputValue:s}}},Se=l=>(X("data-v-414dbe12"),l=l(),Z(),l),Ie={class:"form-input_border"},Oe=["checked","name","type"],Ce={class:"form-input_border-content"},ke=Se(()=>c("span",{class:"form-input_border-mark"},null,-1)),ye={class:"form-input_border-item form-input_border-item--left"},ge={class:"form-input_border-item form-input_border-item--right"};function be(l,D,s,o,v,K){var i,p,V;return u(),_("label",Ie,[c("input",{checked:((i=o.inputValue)==null?void 0:i.value)===((p=s.data)==null?void 0:p.value),name:s.name,type:s.checkbox?"checkbox":"radio",onInput:D[0]||(D[0]=(...h)=>o.updateValue&&o.updateValue(...h))},null,40,Oe),c("span",Ce,[ke,c("span",ye,O((V=s.data)==null?void 0:V.name),1),s.data.price?ae(l.$slots,"default",{key:0},()=>{var h;return[c("span",ge,O((h=s.data)==null?void 0:h.price),1)]},!0):I("",!0)])])}const $=J(he,[["render",be],["__scopeId","data-v-414dbe12"]]),ee=l=>(X("data-v-4c221d86"),l=l(),Z(),l),pe={key:0,class:"section"},Ve={class:"section-header"},me={class:"section-title"},Ne={key:2,class:"form-field form-field--basic"},Be=ee(()=>c("div",{class:"form-field__label"},[R("Выбрать заказ"),c("span",null,"*")],-1)),xe={class:"form-field-input__wrapper"},Ae={class:"multiselect-option"},Ee={class:"form-field form-field--basic"},je={class:"form-field__label"},Fe={key:0},Ue={class:"form-field-input__wrapper"},we=["name","onUpdate:modelValue"],Pe={key:4,class:"section"},Me={class:"list"},Te={class:"list-col list-col--md"},Le=ee(()=>c("div",{class:"list-item__title"},[R("Тариф"),c("span",null,"*")],-1)),Re={key:5,class:"section"},Ke={class:"list"},We={class:"list-col list-col--md"},He={class:"list-item__title"},Ye={key:0},qe={key:6,class:"section"},ze={class:"total-block block--divider"},Ge={class:"total-block__row total-block__row--big"},Je={class:"total-block__col"},Qe={class:"total-block__col"},Xe={key:7,class:"additional-service__inline-price"};function Ze(l,D,s,o,v,K){var S,w,P,m,B,x,M,T,A;const i=ve,p=fe,V=oe("Multiselect"),h=$,U=De;return u(),_(j,null,[s.isInline?I("",!0):(u(),_("div",pe,[c("div",Ve,[c("h1",me,O((S=s.sectionData)==null?void 0:S.Item),1),H(i,{partition:`Header:${((w=s.sectionData)==null?void 0:w.Code)==="Default"?s.sectionID:`/${(P=s.sectionData)==null?void 0:P.Code}Orders`}`},null,8,["partition"])])])),s.isInline?I("",!0):(u(),Y(p,{key:1,class:"additional-service__contract-select",title:"Договор",modelValue:o.contractSelect,"onUpdate:modelValue":D[0]||(D[0]=d=>o.contractSelect=d)},null,8,["modelValue"])),((m=o.filteredDependOrders)==null?void 0:m.length)>0?(u(),_("div",Ne,[Be,c("div",xe,[H(V,{class:"multiselect--white",placeholder:"Все заказы",label:"name","track-by":"value",options:o.filteredDependOrders,modelValue:o.DependOrderID,"onUpdate:modelValue":D[1]||(D[1]=d=>o.DependOrderID=d)},{option:ne(({option:d})=>[c("div",Ae,O(d.name),1)]),_:1},8,["options","modelValue"])])])):I("",!0),((B=o.getInputFields)==null?void 0:B.length)>0?(u(!0),_(j,{key:3},L(o.getInputFields,d=>(u(),_("div",Ee,[c("div",je,[R(O(d==null?void 0:d.Name),1),d!=null&&d.IsDuty?(u(),_("span",Fe,"*")):I("",!0)]),c("div",Ue,[te(c("input",{name:`ID${d==null?void 0:d.ID}`,"onUpdate:modelValue":C=>o.formData[`ID${d==null?void 0:d.ID}`]=C},null,8,we),[[le,o.formData[`ID${d==null?void 0:d.ID}`]]])])]))),256)):I("",!0),((x=s.sectionData)==null?void 0:x.Code)!=="Default"&&((M=o.getAdditionalServicesSchemes)==null?void 0:M.length)>0?(u(),_("div",Pe,[c("div",Me,[c("div",Te,[Le,(u(!0),_(j,null,L(o.getAdditionalServicesSchemes,d=>{var C,k;return u(),Y(h,{name:`${(C=s.sectionData)==null?void 0:C.Code}SchemeID`,checkbox:!1,data:d,modelValue:o.formData[`${(k=s.sectionData)==null?void 0:k.Code}SchemeID`],"onUpdate:modelValue":D[2]||(D[2]=E=>{var n;return o.formData[`${(n=s.sectionData)==null?void 0:n.Code}SchemeID`]=E})},null,8,["name","data","modelValue"])}),256))])])])):I("",!0),((T=o.getSelectFields)==null?void 0:T.length)>0?(u(),_("div",Re,[c("div",Ke,[(u(!0),_(j,null,L(o.getSelectFields,d=>(u(),_("div",We,[c("div",He,[R(O(d==null?void 0:d.Name),1),d!=null&&d.IsDuty?(u(),_("span",Ye,"*")):I("",!0)]),(u(!0),_(j,null,L(o.getSelectFieldOptions(d),C=>(u(),Y(h,{name:`ID${d==null?void 0:d.ID}`,checkbox:!1,data:C,modelValue:o.formData[`ID${d==null?void 0:d.ID}`],"onUpdate:modelValue":k=>o.formData[`ID${d==null?void 0:d.ID}`]=k},null,8,["name","data","modelValue","onUpdate:modelValue"]))),256))]))),256))])])):I("",!0),s.isInline?(u(),_("div",Xe,O(o.finalPrice()||0)+" ₽",1)):(u(),_("div",qe,[c("div",ze,[c("div",Ge,[c("div",Je,"Итого за 1 "+O((A=s.sectionData)==null?void 0:A.Measure),1),c("div",Qe,O(o.finalPrice()||0)+" ₽",1)])]),H(U,{class:"btn--wide",disabled:o.getButtonDisableCondition,label:"Заказать","is-loading":o.isLoading,onClick:D[3]||(D[3]=d=>o.payForOrder())},null,8,["disabled","is-loading"])]))],64)}const $e={components:{InputBorderCheckboxRadio:$,Multiselect:_e},props:{modelValue:{type:Object,default:()=>{}},sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},emits:["updateList","update:modelValue"],setup(l,{emit:D}){const s=ce(),o=ue();de();const v=re(),K=ie(),i=b({}),p=b(null),V=b(null),h=b(null),U=b(null),S=b(!1);se("emitter");const w=g(()=>{var n,t;return(t=Object.keys((o==null?void 0:o.additionalServicesScheme[(n=l.sectionData)==null?void 0:n.Code])||{}))==null?void 0:t.map(e=>{var a,r,f,N,y,W,q,z,G;return{...o==null?void 0:o.additionalServicesScheme[(a=l.sectionData)==null?void 0:a.Code][e],value:(f=o==null?void 0:o.additionalServicesScheme[(r=l.sectionData)==null?void 0:r.Code][e])==null?void 0:f.ID,price:(y=o==null?void 0:o.additionalServicesScheme[(N=l.sectionData)==null?void 0:N.Code][e])==null?void 0:y.CostMonth,name:(q=o==null?void 0:o.additionalServicesScheme[(W=l.sectionData)==null?void 0:W.Code][e])==null?void 0:q.Name,dependOrders:(G=o==null?void 0:o.additionalServicesScheme[(z=l.sectionData)==null?void 0:z.Code][e])==null?void 0:G.DependOrders}}).sort((e,a)=>Number(e==null?void 0:e.SortID)<Number(a==null?void 0:a.SortID)?-1:Number(e==null?void 0:e.SortID)>Number(a==null?void 0:a.SortID)?1:0).filter(e=>e==null?void 0:e.IsActive)}),P=g(()=>{var t;let n=!1;return(t=B.value)==null||t.forEach(e=>{e!=null&&e.IsDuty&&(i.value[`ID${e==null?void 0:e.ID}`]===null||i.value[`ID${e==null?void 0:e.ID}`]===void 0||i.value[`ID${e==null?void 0:e.ID}`]==="")&&(n=!0)}),n}),m=g(()=>{var n;return(n=l.sectionData)==null?void 0:n.ServicesFields.filter(t=>(t==null?void 0:t.TypeID)==="Select").sort((t,e)=>Number(t==null?void 0:t.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(t==null?void 0:t.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),B=g(()=>{var n;return(n=l.sectionData)==null?void 0:n.ServicesFields.filter(t=>(t==null?void 0:t.TypeID)==="Input").sort((t,e)=>Number(t==null?void 0:t.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(t==null?void 0:t.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),x=g(()=>{var e;const n=o==null?void 0:o.additionalServicesScheme[(e=l.sectionData)==null?void 0:e.Code];return n?Object.values(n).filter(a=>(a==null?void 0:a.IsActive)&&(a==null?void 0:a.DependOrders)).flatMap(a=>Object.entries(a.DependOrders)).map(([a,r])=>({name:r,value:a})):[]}),M=g(()=>{var e;const n=o==null?void 0:o.additionalServicesScheme[(e=l.sectionData)==null?void 0:e.Code];return n?Object.values(n).filter(a=>(a==null?void 0:a.IsActive)&&(a==null?void 0:a.DependOrders)).flatMap(a=>Object.entries(a.DependOrders)).map(([a,r])=>({name:r,value:a})):[]}),T=g(()=>{var a,r,f;const n=(r=i.value[`${(a=l.sectionData)==null?void 0:a.Code}SchemeID`])==null?void 0:r.ID,t=o==null?void 0:o.additionalServicesScheme[(f=l.sectionData)==null?void 0:f.Code];if(!n)return M.value;const e=t==null?void 0:t[n];return e&&e.DependOrders?Object.entries(e.DependOrders).map(([N,y])=>({name:y,value:N})):[]});function A(){var t;let n=0;return Object.keys(i.value).map(e=>{var a,r;(a=i.value[e])!=null&&a.price&&(n=n+Number((r=i.value[e])==null?void 0:r.price))}),n+Number((t=l.sectionData)==null?void 0:t.Cost)}function d(n){var t,e;return(e=(t=n==null?void 0:n.Options)==null?void 0:t.split(`
`))==null?void 0:e.map(a=>{let r=a.split("=");return{value:r[0],name:r[1],price:r[2]}})}function C(){var t;S.value=!0;let n={};(t=Object.keys(i.value))==null||t.forEach(e=>{var a,r;n[e]=(a=i.value[e])!=null&&a.value?(r=i.value[e])==null?void 0:r.value:i.value[e]}),n.ContractID=h.value,n.ServiceID=l.sectionID,n.DependOrderID=U.value,console.log(l.sectionID),l.sectionID==="50000"?o.ExtraIPOrder(n).then(({result:e,info:a,error:r})=>{console.log("ExtraIPOrder - ",e),S.value=!1,e==="SUCCESS"?v.push(`/AdditionalServices?ServiceID=${l.sectionID}`):e==="BASKET"&&v.push("/Basket")}):l.sectionID==="51000"?o.ISPswOrder(n).then(({result:e})=>{S.value=!1,e==="SUCCESS"?v.push(`/AdditionalServices?ServiceID=${l.sectionID}`):e==="BASKET"&&v.push("/Basket")}):l.sectionID==="52000"?o.DNSmanagerOrder(n).then(({result:e,info:a,error:r})=>{console.log("DNSManager - ",e),S.value=!1,e==="SUCCESS"?v.push(`/AdditionalServices?ServiceID=${l.sectionID}`):e==="BASKET"&&v.push("/Basket")}):o.ServiceOrder(n).then(({result:e,info:a,error:r})=>{var f;e==="SUCCESS"?o.ServiceOrderPay((f=l.sectionData)==null?void 0:f.Code,{AmountPay:"1",ServiceOrderID:a==null?void 0:a.ServiceOrderID,IsChange:!0}).then(N=>{let{result:y,error:W}=N;y==="SUCCESS"?v.push(`/AdditionalServices?ServiceID=${l.sectionID}`):y==="BASKET"&&v.push("/Basket"),S.value=!1}):S.value=!1})}function k(){var t;let n={};(t=Object.keys(i.value))==null||t.forEach(e=>{var a,r;n[e]=(a=i.value[e])!=null&&a.value?(r=i.value[e])==null?void 0:r.value:i.value[e]}),n.ServiceID=l.sectionID,n.Price=A(),D("update:modelValue",n)}function E(){var n,t;if(l.modelValue){const e=(n=Object.keys(l.modelValue))==null?void 0:n.find(a=>a.includes("SchemeID"));e&&((t=i.value[e])!=null&&t.ID||(i.value[e]={}),i.value[e].ID=l.modelValue[e])}}return F(()=>{var n;return i.value[`${(n=l.sectionData)==null?void 0:n.Code}SchemeID`]},n=>{n&&n.ID?console.log(`Выбран новый тариф с ID: ${n.ID}`):console.log("Тариф не выбран")}),F(K,()=>{var n,t,e;E(),l.updateWithPageTransition&&((n=m.value)==null||n.forEach(a=>{var r;i.value[`ID${a==null?void 0:a.ID}`]&&(i.value[`ID${a==null?void 0:a.ID}`]=(r=d(a))==null?void 0:r.find(f=>f.value===(a==null?void 0:a.Default)))}),((t=l.sectionData)==null?void 0:t.Code)!=="Default"&&o.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code))}),F(i.value,()=>{k()}),F(l,()=>{E()}),Q(async()=>{var n,t,e;console.log(x.value),(n=m.value)==null||n.forEach(a=>{var r;i.value[`ID${a==null?void 0:a.ID}`]=(r=d(a))==null?void 0:r.find(f=>f.value===(a==null?void 0:a.Default))}),((t=l.sectionData)==null?void 0:t.Code)!=="Default"&&await o.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code),E(),k()}),{contractSelect:h,contractsStore:s,getSelectFields:m,getInputFields:B,selectServerModel:p,isLoading:S,getButtonDisableCondition:P,getAdditionalServicesSchemes:w,getSelectFieldOptions:d,getDependOrders:x,DependOrderID:U,operationSystem:V,formData:i,finalPrice:A,payForOrder:C,filteredDependOrders:T}}},ra=J($e,[["render",Ze],["__scopeId","data-v-4c221d86"]]);export{ra as S};
