import{o as A,c as F,b as k,a as o,t as O,F as B,k as w,p as x,l as V,_ as N,a7 as E,e as L,f as q,r as D,g as _,h as M,a2 as R}from"./index-5e313302.js";import{u as U}from"./postings-03760ecf.js";import{u as J}from"./services-21abfb71.js";import{_ as K}from"./ButtonDefault-7c216fc6.js";import{_ as T}from"./ClausesKeeper-eb954229.js";import{B as z}from"./BlockBalanceAgreement-bb87adc1.js";import"./IconClose-1f889a2e.js";import"./contracts-3351d68f.js";import"./bootstrap-vue-next.es-a19a8b41.js";import"./IconArrow-555f9d45.js";const h=d=>(x("data-v-fda3c175"),d=d(),V(),d),G={class:"additional-service-prolong"},H={class:"section"},Q={class:"container"},W={class:"section-header"},X=h(()=>o("h1",{class:"section-title"},"Оплата заказа дополнительной услуги",-1)),Y={class:"section-label"},Z={class:"section"},$={class:"container"},j={class:"service-prolong__data"},ee={class:"form-field"},se=h(()=>o("div",{class:"form-field__label"},"Стоимость заказа",-1)),te=["value"],oe={class:"form-field"},ae={class:"form-field__label"},re=h(()=>o("input",{type:"text",placeholder:"0 руб",value:"1",disabled:""},null,-1)),ie={class:"form-field"},ce=h(()=>o("div",{class:"form-field__label"},"Всего к оплате",-1)),ne=["value"],le={class:"section"},de={class:"container"},_e={class:"service-prolong__data"},ue={class:"total-block"},ve={class:"total-block__row total-block__row--big"},pe=h(()=>o("div",{class:"total-block__col"},"Итого",-1)),fe={class:"total-block__col"};function me(d,u,v,a,I,g){var y,p,f,C;const n=z,S=T,b=K;return A(),F(B,null,[k(n),o("div",G,[o("div",H,[o("div",Q,[o("div",W,[X,o("div",Y,O((y=a.getService)==null?void 0:y.Name)+" # "+O((p=a.getOrder)==null?void 0:p.ID),1)]),k(S)])]),a.getOrder?(A(),F(B,{key:0},[o("div",Z,[o("div",$,[o("div",j,[o("label",ee,[se,o("input",{type:"text",placeholder:"0 руб",value:((f=a.getService)==null?void 0:f.Cost)+" руб",disabled:""},null,8,te)]),o("label",oe,[o("div",ae,"Количество ("+O((C=a.getService)==null?void 0:C.Measure)+")",1),re]),o("label",ie,[ce,o("input",{type:"text",placeholder:"0 руб",value:a.getServicePrice()+" руб",disabled:""},null,8,ne)])])])]),o("div",le,[o("div",de,[o("div",_e,[o("div",ue,[o("div",ve,[pe,o("div",fe,O(a.getServicePrice()||"0")+" ₽",1)])]),k(b,{class:"btn--wide",label:"Оплатить",onClick:u[0]||(u[0]=P=>a.orderPay()),"is-loading":a.isLoading},null,8,["is-loading"])])])])],64)):w("",!0)])],64)}const he={async setup(){const d=E(),u=L(),v=U(),a=q(),I=J(),g=D(!1),n=_(()=>Object.keys(a==null?void 0:a.userOrders).map(e=>a==null?void 0:a.userOrders[e]).find(e=>e.ID===d.params.id));_(()=>{var e,s;return(s=(e=b.value)==null?void 0:e.find(t=>{var r,i,c;return t.value===((c=(i=(r=n.value)==null?void 0:r.OrdersFields)==null?void 0:i[0])==null?void 0:c.Value)}))==null?void 0:s.price}),_(()=>{var e,s;return(s=(e=y.value)==null?void 0:e.find(t=>{var r,i,c;return t.value===((c=(i=(r=n.value)==null?void 0:r.OrdersFields)==null?void 0:i[1])==null?void 0:c.Value)}))==null?void 0:s.price});const S=D(0),b=_(()=>{var e,s,t,r,i;return(i=(r=(t=(s=(e=m.value)==null?void 0:e.ServicesFields)==null?void 0:s[0])==null?void 0:t.Options)==null?void 0:r.split(`
`))==null?void 0:i.map(c=>{let l=c.split("=");return{value:l[0],name:l[1],price:l[2]}})}),y=_(()=>{var e,s,t,r,i;return(i=(r=(t=(s=(e=m.value)==null?void 0:e.ServicesFields)==null?void 0:s[1])==null?void 0:t.Options)==null?void 0:r.split(`
`))==null?void 0:i.map(c=>{let l=c.split("=");return{value:l[0],name:l[1],price:l[2]}})});async function p(e){try{const t=(await R.get(`/ServiceOrderPay?OrderID=${e}&JSON=1`)).data,r=f(t);let i=1;return t.AmountPay&&(i=parseInt(t.AmountPay)||1),r}catch(s){return console.error("Ошибка при получении данных о стоимости заказа",s),null}}function f(e){let s=0;for(const t in e)e.hasOwnProperty(t)&&(typeof e[t]=="object"?s+=f(e[t]):t==="Cost"&&!isNaN(e[t])&&(s+=parseFloat(e[t])));return s}function C(){var t;return((parseFloat((t=m.value)==null?void 0:t.Cost)||0)*1).toFixed(2)}function P(){var e,s;g.value=!0,I.ServiceOrderPay((e=n.value)==null?void 0:e.Code,{AmountPay:"1",ServiceOrderID:(s=n.value)==null?void 0:s.ID,IsChange:!0}).then(t=>{var c;let{result:r,error:i}=t;r==="SUCCESS"?u.push(`/AdditionalServices/${(c=n.value)==null?void 0:c.ID}`):r==="BASKET"&&u.push("/Basket"),g.value=!1})}M(async()=>{if(n.value){const e=n.value.ID,s=await p(e);console.log(m),s!==null&&(console.log(s),S.value=s)}});const m=_(()=>{var e;return v==null?void 0:v.servicesList[(e=n.value)==null?void 0:e.ServiceID]});return await a.fetchUserOrders(),await v.fetchServices(),{getOrder:n,getService:m,getServicePrice:C,isLoading:g,orderPay:P,fetchOrderCost:p,orderCost:S}}},Fe=N(he,[["render",me],["__scopeId","data-v-fda3c175"]]);export{Fe as default};
