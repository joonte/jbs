import{j as X,o as k,c as N,b as l,a,w as i,t as m,F as q,k as H,d as V,x as Y,p as w,l as $,_ as ee,a7 as te,R as oe,r as u,g as D}from"./index-c7c24b76.js";import{u as ne}from"./postings-8eba728f.js";import{u as se}from"./contracts-397b53fe.js";import{s as ae}from"./multiselect-fa331d45.js";import{S as J}from"./StatusBadge-8575efce.js";import{I as K}from"./IconDownload-33292f0d.js";import{I as Q}from"./IconFile-f2565bd9.js";import{B as W}from"./BlockBalanceAgreement-f11c65ba.js";import{a as ce,f as ie}from"./useTimeFunction-8602dd60.js";import{E as le}from"./EmptyStateBlock-b9aefc49.js";import{z as re,d as de,C as me,F as _e}from"./bootstrap-vue-next.es-3f66213d.js";import{_ as ue}from"./IconDots-e4b0dd23.js";import{_ as pe}from"./IconCard-57c0e3d6.js";import{_ as ve}from"./FormInputSearch-4bfb9224.js";import{_ as fe}from"./ClausesKeeper-e7acf2fb.js";import{_ as Ie}from"./ButtonDefault-626291b9.js";import"./IconArrow-dfacb3d4.js";import"./IconPlus-64792f9f.js";import"./IconSearch-5d51b912.js";import"./IconClose-447d7f82.js";const be=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Files",variant:"td-controls",label:""}],_=p=>(w("data-v-32765770"),p=p(),$(),p),De={class:"section"},he={class:"container"},ye={class:"section-header"},Ce=_(()=>a("h1",{class:"section-title"},"Счета на оплату",-1)),ge={class:"list-form"},ke={class:"list-form_col list-form_col--sm"},Se={class:"list-form_select"},Pe={class:"multiselect-option"},Fe=_(()=>a("span",{class:"td-mobile"},"Платежная система",-1)),Le={class:"d-block"},Be=_(()=>a("span",{class:"td-mobile"},"Дата Создания",-1)),Ne={class:"d-block"},Ve=_(()=>a("span",{class:"td-mobile"},"Номер счета",-1)),xe={class:"d-block"},Te=_(()=>a("span",{class:"td-mobile"},"Договор",-1)),Oe={class:"d-block"},Ue=_(()=>a("span",{class:"td-mobile"},"Статус",-1)),je=_(()=>a("span",{class:"td-mobile"},"Сумма",-1)),Me={class:"d-block"},Re={class:"invoices__controls-wrapper"},Ee=["href"],Ae={class:"invoices__download-button-wrapper"},ze={class:"invoices__download-text"},Ge={class:"btn__group"},Ze=["onClick"],qe=_(()=>a("p",null,"ОПЛАТИТЬ",-1)),He={class:"dropdown-button"},Je={class:"btn btn--dots"},Ke=["href"],Qe={key:0,class:"table-controls"},We=_(()=>a("span",{class:"text-success"},"First",-1)),Xe=_(()=>a("span",{class:"text-info"},"Last",-1)),Ye={class:"multiselect-multiple-label"},we={class:"multiselect-option"};function $e(p,n,S,o,z,G){var P,F;const x=W,h=Ie,v=fe,y=X("Multiselect"),T=ve,O=J,f=Q,U=K,j=pe,C=ue,I=re,M=de,R=me,E=_e,A=le;return k(),N(q,null,[l(x),a("div",De,[a("div",he,[a("div",ye,[Ce,l(h,{onClick:n[0]||(n[0]=e=>o.createNewIncoice()),label:"Выписать новый счёт"})]),l(v),a("div",ge,[a("div",ke,[a("div",Se,[l(y,{modelValue:o.select,"onUpdate:modelValue":n[1]||(n[1]=e=>o.select=e),options:o.getUsers,disabled:((P=o.getUsers)==null?void 0:P.length)<=1,label:"name"},{option:i(({option:e})=>[a("div",Pe,"# "+m(e.value.padStart(5,"0"))+" / "+m(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l(T,{modelValue:o.search,"onUpdate:modelValue":n[2]||(n[2]=e=>o.search=e)},null,8,["modelValue"])]),((F=o.getFilteredOrders)==null?void 0:F.length)>0?(k(),N(q,{key:0},[l(R,{class:"basic-table",items:o.getFilteredOrders,fields:o.worksCompleteFields,"show-empty":!0,filter:o.search,"per-page":o.perPage,"current-page":o.currentPage,responsive:"","sort-by":o.sortBy,"onUpdate:sortBy":n[3]||(n[3]=e=>o.sortBy=e),"sort-desc":o.sortDesc,"onUpdate:sortDesc":n[4]||(n[4]=e=>o.sortDesc=e),"sort-direction":o.sortDirection,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:o.setPageToZero},{"cell(PaymentSystemName)":i(e=>[Fe,a("span",Le,m(e.value),1)]),"cell(CreateDate)":i(e=>{var r;return[Be,a("span",Ne,m(o.formNormalDate(o.secondToDate((r=e.item)==null?void 0:r.CreateDate))),1)]}),"cell(ID)":i(e=>[Ve,a("span",xe,m(e.value),1)]),"cell(ContractID)":i(e=>{var r;return[Te,a("span",Oe,m((r=e.item)==null?void 0:r.Customer),1)]}),"cell(StatusID)":i(e=>[Ue,l(O,{status:e.value,"status-table":"Invoices"},null,8,["status"])]),"cell(Summ)":i(e=>{var r;return[je,a("span",Me,m((r=e.item)==null?void 0:r.Summ)+" ₽",1)]}),"cell(Files)":i(e=>{var r,L,B;return[a("div",Re,[e!=null&&e.value?(k(),N("a",{key:0,class:"invoices__download-button",href:o.getInvoicesPDFLink(e)},[a("div",Ae,[l(f,{class:"invoices__download-icon"}),a("div",ze,"Счет №"+m((B=(L=e==null?void 0:e.value)==null?void 0:L[(r=Object.keys(e==null?void 0:e.value))==null?void 0:r[0]])==null?void 0:B.ID),1),l(U,{class:"invoices__download-icon"})])],8,Ee)):H("",!0),a("div",Ge,[a("button",{class:"btn btn-default btn--border",onClick:b=>o.invoicePayment(e)},[l(j),qe],8,Ze),a("div",He,[l(M,{class:"dropdown-dots",right:""},{"button-content":i(()=>[a("div",Je,[l(C)])]),default:i(()=>[l(I,null,{default:i(()=>[a("a",{href:o.getInvoicesTTFLink(e)},"Скачать в формате tiff",8,Ke)]),_:2},1024),l(I,{onClick:b=>o.switchPaymentSystem(e)},{default:i(()=>[V("Изменить счёт")]),_:2},1032,["onClick"]),l(I,{onClick:b=>o.invoicePayment(e)},{default:i(()=>[V("Оплатить")]),_:2},1032,["onClick"]),l(I,{onClick:b=>o.invoicesReject(e)},{default:i(()=>[V("Отменить")]),_:2},1032,["onClick"]),l(I,{onClick:b=>o.invoiceSetConditionally(e)},{default:i(()=>[V("Провести условно")]),_:2},1032,["onClick"])]),_:2},1024)])])])]}),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),o.filteredContractsLength>0?(k(),N("div",Qe,[l(E,{modelValue:o.currentPage,"onUpdate:modelValue":n[5]||(n[5]=e=>o.currentPage=e),"total-rows":o.filteredContractsLength,"per-page":o.perPage,"first-number":"","last-number":""},{"first-text":i(()=>[We]),"last-text":i(()=>[Xe]),page:i(({page:e,active:r})=>[a("span",null,m((e-1)*o.perPage+1)+"-"+m(e*o.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),l(y,{class:"multiselect--white",modelValue:o.perPage,"onUpdate:modelValue":n[6]||(n[6]=e=>o.perPage=e),options:o.pageOptions,label:"name",openDirection:"top",onInput:n[7]||(n[7]=e=>o.currentPage=1)},{singlelabel:i(({value:e})=>[a("div",Ye,[a("span",null,"Отображать "+m(e.value)+" строк",1)])]),option:i(({option:e})=>[a("div",we,"Отображать "+m(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):H("",!0)],64)):(k(),Y(A,{key:1,label:"Заказов не найдено"}))])])],64)}const et={components:{Multiselect:ae,StatusBadge:J,IconDownload:K,IconFile:Q,BlockBalanceAgreement:W},async setup(){const p=se(),n=ne(),S=te(),o=oe("emitter");o.on("updateInvoicesTable",()=>{n.fetchInvoices()});const z=u("CreateDate"),G=u(!0),x=u("desc"),h=u(""),v=u("*"),y=u(1),T=u(10),O=u([10,25,50,100]),f=D(()=>Object.keys(n==null?void 0:n.invoicesList).map(t=>{var s,c,d;return{...n==null?void 0:n.invoicesList[t],Customer:(c=(s=C.value)==null?void 0:s[n==null?void 0:n.invoicesList[t].ContractID])==null?void 0:c.Customer,Summ:Number((d=n==null?void 0:n.invoicesList[t])==null?void 0:d.Summ)}}).reverse()),U=D(()=>f.value.filter(s=>v.value!=="*"?Number(s.ContractID)===Number(v.value):!0)),j=D(()=>n==null?void 0:n.servicesList),C=D(()=>p.contractsList),I=D(()=>{let t=[];return f.value.map(s=>{if(!t.find(c=>c===s.Customer))return t.push(s.Customer),{value:s.ContractID,name:s.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),M=D(()=>f.value.filter(t=>{var s,c;return(t==null?void 0:t.PaymentSystemName.toLowerCase().includes((s=h.value)==null?void 0:s.toLowerCase()))||String(t==null?void 0:t.Summ).toLowerCase().includes((c=h.value)==null?void 0:c.toLowerCase())}).filter(t=>t.ContractID.includes(v.value!=="*"?v.value:"")).length);function R(){y.value=1}function E(t){var s;return`/InvoiceDownload?InvoiceID=${(s=t==null?void 0:t.item)==null?void 0:s.ID}&IsStamp=yes`}function A(t){var s;return`/InvoiceDownload?InvoiceID=${(s=t==null?void 0:t.item)==null?void 0:s.ID}&IsTIFF=yes&IsStamp=yes`}function P(t){var s,c;o.emit("open-modal",{component:"AcceptConditionally",data:{ContractID:(s=t==null?void 0:t.item)==null?void 0:s.ContractID,RowsIDs:(c=t==null?void 0:t.item)==null?void 0:c.ID}})}function F(t){var s,c,d,g,Z;o.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:(s=t==null?void 0:t.item)==null?void 0:s.ID,TypeID:(g=(d=C.value)==null?void 0:d[(c=t==null?void 0:t.item)==null?void 0:c.ContractID])==null?void 0:g.TypeID,Summ:(Z=t==null?void 0:t.item)==null?void 0:Z.Summ}})}function e(t){var s;n.InvoiceDocument({InvoiceID:(s=t.item)==null?void 0:s.ID}).then(c=>{var d;o.emit("open-modal",{component:"InvoiceDocument",data:{html:c,ID:(d=t.item)==null?void 0:d.ID}})})}function r(){o.emit("open-modal",{component:"NewInvoice"})}function L(){}function B(){}function b(t){var c;let s=new FormData;s.append("ContractID","Default"),s.append("RowsIDs[]",(c=t.item)==null?void 0:c.ID),n.InvoicesReject(s).then(d=>{d==="SUCCESS"&&n.fetchInvoices()})}return window.FormGet=L.bind(this),window.Mobile=B.bind(this),await p.fetchContracts(),await n.fetchInvoices().then(()=>{var t,s;(t=S.params)!=null&&t.id&&((s=f.value)!=null&&s.find(d=>{var g;return d.ID===((g=S.params)==null?void 0:g.id)}))&&e({item:{ID:S.params.id}})}),await n.fetchServices(),{search:h,select:v,getContracts:C,getUsers:I,getOrders:f,getServices:j,currentPage:y,perPage:T,sortBy:z,sortDesc:G,sortDirection:x,pageOptions:O,filteredContractsLength:M,worksCompleteFields:be,getFilteredOrders:U,invoicePayment:e,invoicesReject:b,switchPaymentSystem:F,setPageToZero:R,secondToDate:ce,formNormalDate:ie,getInvoicesTTFLink:A,getInvoicesPDFLink:E,createNewIncoice:r,invoiceSetConditionally:P}}},yt=ee(et,[["render",$e],["__scopeId","data-v-32765770"]]);export{yt as default};
