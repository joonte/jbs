import{a as st,L as G,v as nt,r as at,m as lt}from"./bootstrap-vue-next-3DpAa4tb.js";import{s as rt}from"./multiselect-DWCHRlfT.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _,m as U,c as O,h as J,o as $,b as l,w as s,a as e,t as d,v as D,ao as Y,f as T,x as A,L as ct,C as R,e as E,E as it,d as z,g as ut,D as q,F as pt,I as dt,J as mt}from"./index-CipWZKo_.js";import{_ as K}from"./StatusBadge-B65ys1I-.js";import{u as M}from"./contracts-CILh9uSu.js";import{t as Q,f as _t,_ as ft}from"./BlockBalanceAgreement-2iQbaweR.js";import{_ as vt}from"./IconDots-BE2XsWZ6.js";import{_ as bt}from"./IconCard-jY7IitfY.js";import{f as gt,s as Ct}from"./time-DenPiOX5.js";import{_ as yt}from"./FormInputSearch-D7D7Vqhf.js";import{_ as It}from"./ClausesKeeper-DVJgfLR3.js";import{_ as kt}from"./PageTitle-CbsrKCdD.js";import{_ as Dt}from"./ButtonDefault-CghIUDY0.js";import{_ as $t}from"./FormTabs-D9V4Egc_.js";import"./IconPlus-bAw7b_ly.js";import"./IconClose-ChC2G6HM.js";const Tt={key:0,class:"table-controls"},St={class:"multiselect-multiple-label"},Lt={class:"multiselect-option"},Pt={__name:"PaginationBlock",props:["modelValue","total_rows"],emits:["update:modelValue","updatePage"],setup(C,{emit:m}){const p=C,f=m,b=[10,25,50,100],c=_({current_page:1,per_page:10});return U(c.value,()=>{f("updatePage",c.value)}),(y,u)=>{const I=st;return p.total_rows>0?($(),O("div",Tt,[l(I,{modelValue:c.value.current_page,"onUpdate:modelValue":u[0]||(u[0]=n=>c.value.current_page=n),"total-rows":p.total_rows,"per-page":c.value.per_page,"first-number":"","last-number":""},{"first-text":s(()=>u[3]||(u[3]=[e("span",{class:"text-success"},"First",-1)])),"last-text":s(()=>u[4]||(u[4]=[e("span",{class:"text-info"},"Last",-1)])),page:s(({page:n,active:v})=>[e("span",null,d((n-1)*c.value.per_page+1)+"-"+d(n*c.value.per_page),1)]),_:1},8,["modelValue","total-rows","per-page"]),l(D(rt),{class:"multiselect--white",modelValue:c.value.per_page,"onUpdate:modelValue":u[1]||(u[1]=n=>c.value.per_page=n),options:b,label:"name",openDirection:"top",onInput:u[2]||(u[2]=n=>c.value.current_page=1)},{singlelabel:s(({value:n})=>[e("div",St,[e("span",null,"Отображать "+d(n.value)+" строк",1)])]),option:s(({option:n})=>[e("div",Lt,"Отображать "+d(n.name)+" строк",1)]),_:1},8,["modelValue"])])):J("",!0)}}},W=F(Pt,[["__scopeId","data-v-f79dc347"]]),wt=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"Name",label:"Профиль",variant:"td-blue"},{key:"TemplateID",label:"Тип",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",sortable:!0,variant:"td-gray td-order"},{key:"StatusDate",label:"От статуса",sortable:!0,variant:"td-default td-order"}],xt={class:"contracts-profile-list"},Vt={class:"d-block"},Bt={class:"d-block"},ht={__name:"ContractsProfileList",props:["search"],setup(C){const m=C,p=M(),f=Y(),b=A("emitter"),c=_("ID"),y=_(!0),u=_("desc"),I=_(10),n=_(1),v=T(()=>Object?.keys(p?.profileList)?.map(i=>p?.profileList[i])?.reverse()),L=T(()=>f.data.Profiles?.Templates),P=T(()=>v.value.filter(i=>i.Name.toLowerCase().includes(m.search?.toLowerCase()||""))?.length);function x(i={}){I.value=i?.per_page,n.value=i?.current_page}function w(i,a){a.target.closest("button, a, .clickable-element")||b.emit("open-modal",{component:"ProfileInfo",data:{data:i,template:L.value[i.TemplateID]}})}function g(i){const a=Math.floor((new Date().getTime()-i*1e3)/864e5);return a<0?0:a}function V(i){b.emit("open-modal",{component:"StatusHistory",data:{modeID:"Profiles",rowID:i}})}return(i,a)=>{const B=K,h=G,r=W;return $(),O("div",xt,[l(h,{class:"basic-table",items:v.value,fields:D(wt),"show-empty":!0,filterable:[],filter:m.search,"per-page":I.value,"sort-desc":y.value,"onUpdate:sortDesc":a[0]||(a[0]=t=>y.value=t),"sort-by":c.value,"onUpdate:sortBy":a[1]||(a[1]=t=>c.value=t),"sort-direction":u.value,"current-page":n.value,"empty-text":"У вас пока нет профилей.","empty-filtered-text":"Профили не найдены.",onRowClicked:a[2]||(a[2]=(t,N,k)=>w(t,k))},{"cell(ID)":s(t=>[a[3]||(a[3]=e("span",{class:"td-mobile"},"Номер",-1)),e("span",Vt,d(D(Q)(t.item?.ID)),1)]),"cell(Name)":s(t=>[a[4]||(a[4]=e("span",{class:"td-mobile"},"Номер",-1)),e("span",null,d(t.item?.Name),1)]),"cell(StatusDate)":s(t=>[a[5]||(a[5]=e("span",{class:"td-mobile"},"От статуса",-1)),e("span",Bt,d(g(t.item?.StatusDate))+" дн.",1)]),"cell(TemplateID)":s(t=>[a[6]||(a[6]=e("span",{class:"td-mobile"},"Тип",-1)),e("span",null,d(L.value[t.item?.TemplateID]?.Name),1)]),"cell(StatusID)":s(t=>[l(B,{class:"clickable-element",status:t.value,"status-table":"Profiles",onClick:N=>V(t.item?.ID)},null,8,["status","onClick"])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(r,{total_rows:P.value,onUpdatePage:x},null,8,["total_rows"])])}}},Nt=F(ht,[["__scopeId","data-v-d081aafb"]]),Et={},Ft={class:"button-payment"},Ot={class:"button-payment__text"};function Ht(C,m){const p=bt;return $(),O("button",Ft,[l(p,{class:"button-payment__icon"}),e("span",Ot,[ct(C.$slots,"default",{},void 0,!0)])])}const Rt=F(Et,[["render",Ht],["__scopeId","data-v-60aa5d21"]]),Ut=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"Customer",label:"Договор"},{key:"TypeID",label:"Тип",variant:"td-gray td-order"},{key:"Orders",label:"Количество подключенных услуг",sortable:!0,variant:"td-gray td-order"},{key:"Balance",label:"Баланс",sortable:!0,variant:"td-gray td-order"},{key:"IsHidden",label:"Скрыт ?",variant:"td-gray td-order"},{key:"Status",label:"Статус",variant:"td-gray td-order"},{key:"controls",label:"",variant:"td-controls"}],At={class:"contracts-list"},Mt={class:"td-column-heavy"},jt=["onClick"],qt={class:"d-block"},Gt={class:"td-column-heavy"},Jt={class:"table-td-blue"},Yt=["onClick"],zt={class:"btn__group"},Kt={class:"dropdown-button"},Qt={class:"btn btn--dots"},Wt={__name:"ContractsList",props:{search:{type:String,default:""}},setup(C){const m=z(),p=C,f=M(),b=Y(),c=A("emitter"),y=_("CreateDate"),u=_(!0),I=_("desc"),n=_(10),v=_(1);_(!1);const L=r=>{f.booleanEdit({TableID:"Contracts",ColumnID:"IsHidden",RowID:r.ID}).then(()=>{f.fetchContracts()})},P=T(()=>Object.keys(f?.contractsList)?.map(r=>f?.contractsList[r])?.reverse()),x=T(()=>b.data.Contracts?.Types),w=T(()=>P.value.filter(r=>r.Customer.toLowerCase().includes(p.search?.toLowerCase()||""))?.length);function g(r){c.emit("open-modal",{component:"StatusHistory",data:{modeID:"Contracts",rowID:r}})}function V(r){m.push(`/ContractScheme/${r}`)}function i(r){m.push(`/Balance/${r}`)}function a(r={}){n.value=r?.per_page,v.value=r?.current_page}function B(r){f?.contractDownload({ContractID:r})}function h(r){m.push(`/Orders?contractID=${r}`)}return U(()=>p,()=>{v.value=1}),(r,t)=>{const N=lt,k=K,X=Rt,Z=vt,j=it("router-link"),H=at,tt=nt,et=G,ot=W;return $(),O("div",At,[l(et,{class:"basic-table",items:P.value,fields:D(Ut),"show-empty":!0,filterable:[],filter:p.search,"per-page":n.value,"sort-desc":u.value,"onUpdate:sortDesc":t[0]||(t[0]=o=>u.value=o),"sort-by":y.value,"onUpdate:sortBy":t[1]||(t[1]=o=>y.value=o),"sort-direction":I.value,"current-page":v.value,"empty-text":"У вас пока нет договоров.","empty-filtered-text":"Договора не найдены."},{"cell(ID)":s(o=>[t[2]||(t[2]=e("span",{class:"td-mobile"},"Номер",-1)),e("div",Mt,[e("span",{class:"table-td-gray order-id",onClick:S=>V(o.item?.ID)}," # "+d(D(Q)(o.item?.ID)),9,jt)])]),"cell(CreateDate)":s(o=>[t[3]||(t[3]=e("span",{class:"td-mobile"},"Дата Создания",-1)),e("span",qt,d(D(gt)(D(Ct)(o.item?.CreateDate))),1)]),"cell(Customer)":s(o=>[t[4]||(t[4]=e("span",{class:"td-mobile"},"Договор",-1)),e("div",Gt,[e("span",Jt,d(o.item?.Customer),1)])]),"cell(TypeID)":s(o=>[t[5]||(t[5]=e("span",{class:"td-mobile"},"Тип договора",-1)),e("span",null,d(x.value[o.item?.TypeID]?.Name),1)]),"cell(Balance)":s(o=>[t[6]||(t[6]=e("span",{class:"td-mobile"},"Баланс",-1)),e("span",null,d(D(_t)(o.item?.Balance)),1)]),"cell(IsHidden)":s(o=>[t[7]||(t[7]=e("span",{class:"td-mobile"},"Скрыт ?",-1)),l(N,{class:"rule-checkbox",name:"checkbox",checked:o.item?.IsHidden,modelValue:o.item.IsChecked,"onUpdate:modelValue":S=>o.item.IsChecked=S,onChange:S=>L(o.item)},null,8,["checked","modelValue","onUpdate:modelValue","onChange"]),e("span",null,d(o.item?.IsHidden===!0?"Да":"Нет"),1)]),"cell(Status)":s(o=>[l(k,{status:o.item?.StatusID,"status-table":"Contracts",onClick:S=>g(o.item?.ID)},null,8,["status","onClick"])]),"cell(Orders)":s(o=>[t[8]||(t[8]=e("span",{class:"td-mobile"},"Количество подключенных услуг",-1)),e("span",{class:"total-orders",onClick:S=>h(o.item?.ID)},d(o.item?.Orders),9,Yt)]),"cell(controls)":s(o=>[e("div",zt,[o.item?.TypeID!="NaturalPartner"?($(),R(X,{key:0,onClick:S=>i(o.item?.ID)},{default:s(()=>t[9]||(t[9]=[E(" Пополнить баланс ",-1)])),_:2,__:[9]},1032,["onClick"])):J("",!0),e("div",Kt,[l(tt,{right:"",class:"dropdown-dots"},{"button-content":s(()=>[e("span",Qt,[l(Z)])]),default:s(()=>[l(H,null,{default:s(()=>[l(j,{to:`/ContractScheme/${o.item?.ID}`},{default:s(()=>t[10]||(t[10]=[E("Открыть",-1)])),_:2,__:[10]},1032,["to"])]),_:2},1024),l(H,null,{default:s(()=>[l(j,{to:`/ContractSettings/${o.item?.ID}`},{default:s(()=>t[11]||(t[11]=[E("Изменить тип учёта",-1)])),_:2,__:[11]},1032,["to"])]),_:2},1024),l(H,{onClick:S=>B(o.item?.ID)},{default:s(()=>t[12]||(t[12]=[E(" Загрузить договор ",-1)])),_:2,__:[12]},1032,["onClick"])]),_:2},1024)])])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(ot,{total_rows:w.value,onUpdatePage:a},null,8,["total_rows"])])}}},Xt=F(Wt,[["__scopeId","data-v-27e6c19c"]]),Zt={class:"container"},te={class:"list-form"},ee={class:"contracts__page"},oe={__name:"Contracts",async setup(C){let m,p;const f=ut(),b=z(),c=M(),y=A("emitter"),u=[{value:"Contracts",name:"Договора"},{value:"Profiles",name:"Профили"}],I=T(()=>n.value==="Contracts"?"Договора":"Профили"),n=_("Contracts"),v=_(""),L=T(()=>Object.keys(c?.contractsList)?.map(w=>c?.contractsList[w])?.reverse());function P(){n.value==="Contracts"?b.push({path:"/ContractMake"}):b.push({path:"/ProfileMake"})}function x(){y.emit("open-modal",{component:"FundsTransfer"})}return f?.query?.section?n.value=f.query?.section:b.replace({query:{section:"Contracts"}}),U(n,()=>{b.replace({query:{section:n.value}})}),[m,p]=q(()=>c.fetchContracts()),await m,p(),[m,p]=q(()=>c.fetchProfiles()),await m,p(),(w,g)=>{const V=ft,i=$t,a=Dt,B=kt,h=It,r=yt,t=Xt,N=Nt;return $(),O(pt,null,[l(V),e("div",Zt,[l(i,{modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=k=>n.value=k),tabs:u},null,8,["modelValue"]),l(B,null,{title:s(()=>[E(d(I.value),1)]),buttons:s(()=>[dt(l(a,{label:"Перевод средств",onClick:g[1]||(g[1]=k=>x())},null,512),[[mt,n.value==="Contracts"&&L.value.length>1]]),l(a,{label:n.value==="Contracts"?"Создать договор":"Создать профиль",onClick:P},null,8,["label"])]),_:1}),l(h),e("div",te,[l(r,{modelValue:v.value,"onUpdate:modelValue":g[2]||(g[2]=k=>v.value=k)},null,8,["modelValue"])]),e("div",ee,[n.value==="Contracts"?($(),R(t,{key:0,search:v.value},null,8,["search"])):($(),R(N,{key:1,search:v.value},null,8,["search"]))])])],64)}}},ye=F(oe,[["__scopeId","data-v-91e01866"]]);export{ye as default};
