import{E as ye}from"./EmptyStateBlock-8165a481.js";import{_ as ge}from"./ButtonDefault-dafa6215.js";import{_ as Ie}from"./BasicInput-df2ac90e.js";import{f as fe}from"./bootstrap-vue-next.es-c86262f3.js";import{_ as Ce}from"./BlockOrderPayBalance-a5c27437.js";import{_ as Be,U as Oe,f as we,e as Ee,r as m,h as F,i as Ne,P as Pe,ah as M,o as f,c as C,b as d,a as t,F as T,t as i,w as Q,d as Ve,$ as ue,aa as de,y as _e,l as He,p as xe,m as Ue}from"./index-c781268b.js";import{u as Fe}from"./hosting-6f377a00.js";import{u as Ae}from"./contracts-7e377877.js";import{u as Re}from"./domain-ca269c7d.js";import{u as Te}from"./services-f889332c.js";import{_ as $e}from"./paramsAccordionBlock-9a85f66f.js";import{D as Le}from"./DomainCheckBlock-5eb5fe38.js";import{_ as Ke}from"./BlockSelectContract-2bfc7c50.js";import{B as je}from"./BlockOrderServiceWrapper-d3beff81.js";import Ge from"./BlockAdditionalServices-e8b9bc1f.js";import{B as Me}from"./BlockBalanceAgreement-1d554184.js";import"./component-d2f2a50c.js";import"./IconHelp-0d3353ae.js";import"./globalActions-bedd3c73.js";import"./IconArrow-8731a209.js";/* empty css                                                                             */import"./multiselect-9a74535b.js";import"./IconClose-3fa8ed32.js";import"./ClausesKeeper-5fae717f.js";import"./ServiceListOrderSelection-6ff8206a.js";const q=$=>(xe("data-v-577a1461"),$=$(),Ue(),$),qe={class:"hosting-sheme"},We={class:"section"},Xe={class:"container"},ze={class:"section-header"},Je={class:"section-title"},Qe=q(()=>t("div",{class:"section-label"},"Хостинг",-1)),Ye={class:"container"},Ze={class:"section"},et={class:"container"},tt={class:"total-block"},ot={class:"total-block__row divider-bottom"},lt=q(()=>t("div",{class:"total-block__col"},"Цена тарифа",-1)),at={class:"total-block__col"},st={class:"total-block__row no-divider"},nt={class:"total-block__col"},ct={class:"total-block__col"},rt={class:"total-block__row"},it=q(()=>t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),ut={class:"total-block__col"},dt={class:"total-block__row no-divider"},_t={class:"total-block__col"},mt={class:"total-block__col"},vt={class:"total-block__row total-block__row--big economy-line"},pt=q(()=>t("div",{class:"total-block__col red"},"Выгода",-1)),ht={class:"total-block__col flex-col"},Dt={class:"red"},St={class:"total-block__row total-block__row--big"},bt={class:"total-block__col"},kt={class:"total-block__col"},yt={key:1,class:"section"},gt={class:"container"},It={__name:"HostingScheme",async setup($){let S,b;const k=Fe(),L=Ae(),_=Re(),E=Te();Oe("emitter");const me=we(),N=Ee(),B=m(!1),W=m(""),A=m([]),X=m(!1),a=m(null),R=m([]),P=m(!1),v=m(null),K=m(null),Y=m(""),Z=o=>{o.key==="Enter"&&o.ctrlKey&&!ve.value&&le()},ve=F(()=>a.value===null||v.value===null),O=F(()=>{var o;return(o=k==null?void 0:k.hostingSchemes)==null?void 0:o[me.params.id]}),pe=F(()=>L==null?void 0:L.contractsList),ee=F(()=>E==null?void 0:E.ServicesList),he=F(()=>{var o;return(o=Object.keys(_==null?void 0:_.domainSchemes))==null?void 0:o.map(e=>{var r;return{..._==null?void 0:_.domainSchemes[e],value:(r=_==null?void 0:_.domainSchemes[e])==null?void 0:r.ID}})}),z=F(()=>{let o=0;return R.value.forEach(e=>{o+=e==null?void 0:e.Price}),te(o)||0});Ne(()=>{document.addEventListener("keyup",Z)}),Pe(()=>{document.removeEventListener("keyup",Z)});function J(){var e,r;let o=0;return(r=(e=a.value)==null?void 0:e.discounts)==null||r.Bonuses.map(p=>{o+=+p.Economy}),o}function V(o){return Number(o).toFixed(2)||0}function te(o){return Number(o).toFixed(2)||0}function De(o){A.value=o}function Se(){B.value=!1,console.log("Not")}function be(){B.value=!0,console.log("Own")}function ke(o){a.value=o}async function oe(o){var e;for(const r of R.value){let p="SUCCESS",h=(e=ee.value[r.ServiceID])==null?void 0:e.Code;if(await E.ServiceOrder({Code:h,DependOrderID:o,...r,ContractID:v.value}).then(({result:H,info:u,error:x})=>{if(H==="SUCCESS"){let D={};h==="Default"?D.ServiceOrderID=u==null?void 0:u.ServiceOrderID:D[`${h}OrderID`]=u==null?void 0:u.ServiceOrderID,E.ServiceOrderPay(h,D,{XMLHttpRequest:"yes"}).then(w=>{let{result:n,error:s}=w;n==="SUCCESS"?N.push("/AdditionalServices}"):n==="BASKET"&&N.push("/Basket")})}else p="ERROR"}),p==="ERROR")break}}function le(){var h,H,u,x,D,w;P.value=!0;let o=0,e,r,p;A.value.length>0&&(e=A.value[o],r=A.value.map(n=>`${n.line}${n.line&&n.Name?"."+n.Name:""}`),p=A.value.map(n=>`${n.ID}`)),B.value===!1?k.HostingOrder({ContractID:v.value,Domain:r||null,DomainName:(e==null?void 0:e.line)||null,HostingSchemeID:(h=O.value)==null?void 0:h.ID,DomainSchemeID:p||null,DomainTypeID:e!=null&&e.line?e!=null&&e.Name?"Order":"Nothing":"None"}).then(({result:n,info:s,error:j})=>{var y,g;n==="SUCCESS"?(o++,oe(s==null?void 0:s.OrderID),k.HostingOrderPay({HostingOrderID:s==null?void 0:s.HostingOrderID,DaysPayFromBallance:((y=a.value)==null?void 0:y.daysFromBalance)||0,DaysPay:(g=a.value)==null?void 0:g.actualDays}).then(U=>{let{result:I,error:G}=U;I==="SUCCESS"?N.push("/HostingOrders"):I==="BASKET"&&N.push("/Basket"),P.value=!1})):P.value=!1}):(console.log(!0),k.HostingOrder({ContractID:v.value,Domain:W.value,DomainName:(H=K.value)==null?void 0:H.line,HostingSchemeID:(u=O.value)==null?void 0:u.ID,DomainSchemeID:(x=K.value)!=null&&x.line&&((D=K.value)!=null&&D.ID)?(w=K.value)==null?void 0:w.ID:null,DomainTypeID:"Nothing"}).then(({result:n,info:s,error:j})=>{var y,g;n==="SUCCESS"?(oe(s==null?void 0:s.OrderID),k.HostingOrderPay({HostingOrderID:s==null?void 0:s.HostingOrderID,DaysPayFromBallance:((y=a.value)==null?void 0:y.daysFromBalance)||0,DaysPay:(g=a.value)==null?void 0:g.actualDays}).then(U=>{let{result:I,error:G}=U;I==="SUCCESS"?N.push("/HostingOrders"):I==="BASKET"&&N.push("/Basket"),P.value=!1})):P.value=!1}))}return[S,b]=M(()=>_.fetchDomainSchemes()),await S,b(),[S,b]=M(()=>k.fetchHostingSchemes()),await S,b(),[S,b]=M(()=>L.fetchContracts()),await S,b(),[S,b]=M(()=>E.fetchServices()),await S,b(),(o,e)=>{var x,D,w,n,s,j,y,g,U,I,G,ae,se,ne,ce,re,ie;const r=Ce,p=fe,h=Ie,H=ge,u=ye;return f(),C(T,null,[d(Me),t("div",qe,[(x=O.value)!=null&&x.ID?(f(),C(T,{key:0},[t("div",We,[t("div",Xe,[t("div",ze,[t("h1",Je,i((D=O.value)==null?void 0:D.Name),1),Qe])])]),d(je,{basic_title:"Хостинг",modelValue:Y.value,"onUpdate:modelValue":e[7]||(e[7]=l=>Y.value=l)},{page:Q(()=>{var l;return[d($e,{"params-list":(l=O.value)==null?void 0:l.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),d(Ke,{title:"Договор",modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=c=>v.value=c)},null,8,["modelValue"]),d(r,{contractID:v.value,scheme:O.value,serviceID:"10000",isOrderID:!1,onSelect:ke,isBalancePay:X.value,"onUpdate:isBalancePay":e[1]||(e[1]=c=>X.value=c)},null,8,["contractID","scheme","isBalancePay"]),d(Le,{disabled:B.value,"domain-list":he.value,onClick:e[2]||(e[2]=c=>Se()),onSelect:De},null,8,["disabled","domain-list"]),t("div",Ye,[d(p,{id:"check-1",modelValue:B.value,"onUpdate:modelValue":e[3]||(e[3]=c=>B.value=c),name:"checkbox-1"},{default:Q(()=>[Ve("Использовать свой домен")]),_:1},8,["modelValue"]),d(h,{label:"Домен",name:"own-domain",onClick:e[4]||(e[4]=c=>be()),disabled:!B.value,modelValue:W.value,"onUpdate:modelValue":e[5]||(e[5]=c=>W.value=c)},null,8,["disabled","modelValue"])])]}),services:Q(()=>{var l;return[d(Ge,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=c=>R.value=c),serviceSearchParams:{ServiceID:"10000",ServersGroupID:(l=O.value)==null?void 0:l.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]}),_:1},8,["modelValue"]),t("div",Ze,[t("div",et,[ue(t("div",tt,[((s=(n=(w=a.value)==null?void 0:w.discounts)==null?void 0:n.Bonuses)==null?void 0:s.length)>0?(f(),C(T,{key:0},[t("div",ot,[lt,t("div",at,i(V((j=a.value)==null?void 0:j.price))+" ₽",1)]),(f(!0),C(T,null,_e((g=(y=a.value)==null?void 0:y.discounts)==null?void 0:g.Bonuses,l=>(f(),C("div",st,[t("div",nt,"Скидка "+i(l==null?void 0:l.Discount)+"% на "+i(l==null?void 0:l.Days)+" дней",1),t("div",ct,"-"+i(V(l==null?void 0:l.Economy))+" ₽",1)]))),256))],64)):He("",!0),t("div",rt,[it,t("div",ut,i(z.value)+" ₽",1)]),(f(!0),C(T,null,_e(R.value,l=>{var c;return f(),C("div",dt,[t("div",_t,i((c=ee.value[l==null?void 0:l.ServiceID])==null?void 0:c.Name),1),t("div",mt,i(te(l==null?void 0:l.Price))+" ₽",1)])}),256)),ue(t("div",vt,[pt,t("div",ht,[t("span",null,[t("s",null,i(V((U=a.value)==null?void 0:U.price))+" ₽",1)]),t("span",Dt,"-"+i(V(J()))+" ₽",1)])],512),[[de,((ae=(G=(I=a.value)==null?void 0:I.discounts)==null?void 0:G.Bonuses)==null?void 0:ae.length)>0]]),t("div",St,[t("div",bt,"Итого за "+i((se=a.value)==null?void 0:se.label),1),t("div",kt,i(V(((ne=a.value)==null?void 0:ne.price)-J()+ +z.value))+" ₽",1)])],512),[[de,(ce=a.value)==null?void 0:ce.price]]),d(H,{class:"btn--wide",label:X.value||((re=pe.value[v.value])==null?void 0:re.Balance)>V(((ie=a.value)==null?void 0:ie.price)-J()+ +z.value)?"Оплатить c баланса договора":"Добавить в корзину",disabled:a.value===null||v.value===null,"is-loading":P.value,onClick:e[8]||(e[8]=l=>le())},null,8,["label","disabled","is-loading"])])])],64)):(f(),C("div",yt,[t("div",gt,[d(u,{label:"Тариф не найден"})])]))])],64)}}},zt=Be(It,[["__scopeId","data-v-577a1461"]]);export{zt as default};
