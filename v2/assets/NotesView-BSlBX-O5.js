import{_ as R}from"./EmptyStateBlock-CV1Zaaf7.js";import{_ as W}from"./IconClose-s_NQ_Q4c.js";import{_ as H}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as U}from"./BlockBalanceAgreement-DjWMZ940.js";import{c as O,b as C,a as p,D as k,w as q,ao as F,F as x,r as G,u as K,f as P,l as Y,s as z,h as J,x as Q,d as X,W as Z,ak as ee,G as te,o as h,j as oe}from"./index-XtiBO-PZ.js";import{u as ne,n as se}from"./networkController-hO9JK5kQ.js";import{u as ce}from"./postings-D5DA40Zz.js";import{u as re}from"./contracts-BdlSA9YT.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ButtonDefault-eJbeaBtE.js";const ae={async setup(){const l=ne(),i=G(null),b=ce(),d=re(),w=K(),u=P(()=>w.userInfo),I=P(()=>Object.keys(u.value?.Contacts)?.map(e=>{if(!u.value?.Contacts?.[e]?.IsHidden)return u.value?.Contacts?.[e]})),_=e=>I.value.find(t=>t.ID===e),n=X(),o=Q("emitter"),g=[{old:"/v2/DNSmanagerSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=52000"},{old:"/v2/ExtraIPSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=50000"},{old:"/v2/ISPswSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=51000"}],f=P(()=>{let e={};return Object.keys(l?.notesList).reverse().forEach(t=>{e[t]=l?.notesList?.[t]}),Object.keys(e).length>0?e:null});function a(){let e={};Object.keys(l?.notesList).reverse().forEach(t=>{y(t)&&(e[t]=l?.notesList?.[t])}),i.value=e}function y(e){return document.cookie.match(RegExp(`(?:^|;\\s*)${e}=([^;]*)`))===null}function v(e){return Object.values(e).map((t,c)=>{let s=t;const r=/<NOBODY>/gi;return s=s.replace(r,"<div>"),s=s.replace(/<\/NOBODY>/gi,"</div>"),g.forEach(({old:S,new:m})=>{const T=new RegExp(`<a[^>]*href="${S}"[^>]*>`,"gi");s=s.replace(T,V=>V.replace(`href="${S}"`,`href="${m}"`))}),s})}function M(e){n.push(e)}function N(e){let t=new Date;t.setDate(30+t.getDate()),delete i.value[e],document.cookie=`${e}=hidden; path=/; expires=${t}`,o.emit("notes-reduce"),console.log(document.cookie,2),console.log(e,2)}const E=async(e,t)=>{try{return(await ee.post(e,t)).data}catch(c){throw new Error(`Error sending confirm request: ${c.message}`)}};async function D(e,t){if(e.includes("ISPswSchemes")&&n.push("/AdditionalServicesOrder?ServiceID=51000"),e.includes("ExtraIPSchemes")&&n.push("/AdditionalServicesOrder?ServiceID=50000"),e.includes("DNSmanagerSchemes")&&n.push("/AdditionalServicesOrder?ServiceID=52000"),e.includes("OrderPay")){let c=t[Object.keys(t).find(s=>s.includes("OrderID"))];e!=="/ExtraIPOrderPay"&&e!=="/ISPswOrderPay"&&e!=="/DNSmanagerOrderPay"?n.push(`${e}/${c}`):e==="/ExtraIPOrderPay"||e==="/ISPswOrderPay"||e==="/DNSmanagerOrderPay"?n.push(`${e}/${c}`):n.push(`/ServiceOrderPay/${c}`)}else if(e==="/InvoiceDocument")b.InvoiceDocument({InvoiceID:t.InvoiceID}).then(c=>{o.emit("open-modal",{component:"InvoiceDocument",data:{html:c,ID:t.InvoiceID}})});else if(e==="/API/OrdersTransfer")o.emit("open-modal",{component:"TakeOrder",data:{OrdersTransferID:t}});else if(e==="/ContractMake")n.push("ContractMake");else if(e==="/HostingOrderSchemeChange")n.push(`/HostingOrders/${t.OrderID}/SchemeChange`);else if(e==="/VPSOrderSchemeChange")n.push(`/VPSOrders/${t.OrderID}/SchemeChange`);else if(e==="/DomainSelectOwner")o.emit("open-modal",{component:"DomainSelectOwner",data:t});else if(e==="/ISPswOrders")n.push("AdditionalServices");else if(e==="/ContactEdit?MethodID=VKontakte")o.emit("open-modal",{component:"CreateVK"});else if(e==="/ContactEdit?MethodID=Telegram")o.emit("open-modal",{component:"CreateTelegram"});else if(e==="/ContactEdit?MethodID=Viber")o.emit("open-modal",{component:"CreateViber"});else if(e==="/ContactEdit?MethodID=SMS")o.emit("open-modal",{component:"CreatePhone"});else if(e.includes("/ContactEdit")){t?.MethodID==="SMS"&&o.emit("open-modal",{component:"CreatePhone"});const c=e.match(/ContactID=(\d+)/),s=c?c[1]:null;if(s){const r=_(s);if(r){const S={Method:r.MethodID,Value:r.Address,ContactID:r.ID};try{const m=await E(`${Z}/API/Confirm`,S);m.Status==="Ok"?o.emit("open-modal",{component:"AcceptContact",data:{contactId:s,sendConfirmRequest:E}}):console.error(`Error confirming code. Status: ${m.Status}, Message: ${m.Message}`)}catch(m){console.error("Error accepting contact:",m.message)}}}else console.error("ContactID is not present in the URL params.",e)}else e==="/ProfileEdit"?n.push(`/ContractEdit/${t.ProfileID}`):o.emit("open-modal",{component:e.replace("/",""),data:t})}function A(){}function j(e,t,c,s){se.post(e,t).then(r=>{r.data.Status==="Exception"?o.emit("open-modal",{component:"ExclusionWindow",data:r.data}):l.fetchNotes().then(()=>{a()})}).catch(r=>{console.error("Ошибка при выполнении запроса:",r)})}function B(e,t){o.emit("open-modal",{component:"DeleteItem",data:{id:null,callback:t,message:e,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function L(){}function $(){window.ShowWindow=D.bind(this)}return Y(()=>{$()}),z(()=>{window.ShowWindow=null}),J(()=>{console.log(i,"view");const e=f.value;e&&(i.value=v(e),console.log(v(e)),a())}),o.on("close-modal",()=>{$()}),window.ShowProgress=L.bind(this),window.ShowWindow=D.bind(this),window.PromptShow=A.bind(this),window.AjaxCall=j.bind(this),window.ShowConfirm=B.bind(this),await l.fetchNotes().then(()=>{a()}),await d.fetchContracts(),await d.fetchProfiles(),await w.fetchUserData(),{getNotesList:f,notes:i,ShowWindow:D,deleteItem:N,processNotes:v,redirectToNewPage:M}}},le={class:"section"},de={class:"container"},me={class:"notes"},pe=["onClick"];function he(l,i,b,d,w,u){const I=U,_=H,n=W,o=te("note"),g=R;return h(),O(x,null,[C(I),p("section",le,[p("div",de,[i[0]||(i[0]=p("div",{class:"section-header"},[p("h1",{class:"section-title"},"Уведомления")],-1)),C(_),p("div",me,[d.notes&&Object.keys(d.notes).length>0?(h(),k(F,{key:0,tag:"div",name:"list",class:"notes__transition-container"},{default:q(()=>[(h(!0),O(x,null,oe(d.notes,(f,a)=>(h(),O("div",{class:"notes-delete",key:a},[p("div",{class:"notes__close-button",onClick:y=>d.deleteItem(a)},[C(n,{class:"notes__close-button-cross"})],8,pe),(h(),k(o,{innerHTML:f,item:f,index:a,key:a},null,8,["innerHTML","item","index"]))]))),128))]),_:1})):(h(),k(g,{key:1,label:"Все уведомления прочитаны или они еще не пришли"}))])])])],64)}const Ce=ie(ae,[["render",he],["__scopeId","data-v-02b60a2b"]]);export{Ce as default};
