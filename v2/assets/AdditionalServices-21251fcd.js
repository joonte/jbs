import{j as Q,o as C,c as X,a as _,n as Y,t as B,Z as R,a9 as W,b as I,w as S,d as E,y as T,k as $,F as ee,p as pe,l as he,_ as se,e as re,f as ae,S as ie,r as h,g as A,i as te,x as Ce,a7 as we,C as Pe}from"./index-59dbe3d3.js";import{u as ce}from"./services-05e05079.js";import{u as le}from"./contracts-d90f6cbb.js";import"./postings-ab558ece.js";import{u as de}from"./globalActions-d9fee8ed.js";import{u as xe}from"./resetServer-4930e90a.js";import{f as oe}from"./useTimeFunction-8602dd60.js";import{_ as ue}from"./IconCard-4307e3b9.js";import{E as Z}from"./EmptyStateBlock-03e9aa9e.js";import{S as _e}from"./StatusBadge-13d0c588.js";import{s as Be}from"./servicesStatuses-6293b6ac.js";import{_ as Ne}from"./HelperComponent-ac686d35.js";import{s as me}from"./multiselect-49fa0a82.js";import{_ as Le,B as ve}from"./IconButtonBack-7971042b.js";import{f as je,z as Ve,k as Ee,d as Te,C as Ue}from"./bootstrap-vue-next.es-faf1dad1.js";import{_ as Ae}from"./IconDots-29c2c1b9.js";import{_ as Me}from"./ClausesKeeper-b1ff97f6.js";import{_ as He}from"./ButtonDefault-a62141a4.js";import{B as fe}from"./BlockBalanceAgreement-f093da58.js";import{_ as Re}from"./IconArrow-ad4e318c.js";import"./IconClose-0bef5a37.js";const We=[{key:"Several",label:"",variant:"",sortable:!1},{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],M=m=>(pe("data-v-d5ac530e"),m=m(),he(),m),ze={class:"section-header"},Ge={class:"title__icon"},Fe={class:"btn__group"},qe={class:"group__several"},Ke=M(()=>_("span",{class:"td-mobile"},"Заказ",-1)),Xe=["onClick"],Ze=M(()=>_("span",{class:"td-mobile"},"Договор",-1)),Je=M(()=>_("span",{class:"td-mobile"},"Ключевые поля",-1)),Qe={class:"key-field"},Ye={class:"hosting-status__date"},$e=M(()=>_("span",{class:"td-mobile"},"Статус",-1)),et=M(()=>_("span",{class:"td-mobile"},"Дата окончания",-1)),tt=M(()=>_("span",{class:"td-mobile"},"Комментарий",-1)),nt={class:"service__controls-wrapper"},ot=["onClick"],st={class:"btn btn--dots"};function rt(m,a,l,e,N,g){var H,z,G,F;const L=Le,y=He,w=ve,p=je,P=Me,O=_e,x=Q("Helper"),D=ue,j=Ae,u=Q("router-link"),o=Ve,v=Ee,V=Te,c=Ue,U=Z;return C(),X(ee,null,[_("div",ze,[_("div",{class:Y(["section-title__nowrap",e.isSeveral?"column":""])},[_("div",Ge,[_("h1",{class:"section-title",onClick:a[0]||(a[0]=t=>e.reloadNow())},B(e.isSeveral?"Продление услуг "+((H=l.sectionData)==null?void 0:H.Item):(z=l.sectionData)==null?void 0:z.Item),1),R(I(L,{onClick:a[1]||(a[1]=t=>e.outSeveralOrders())},null,512),[[W,e.isSeveral]])]),R(_("div",Fe,[R(I(y,{class:"btn-several",label:"Продлить несколько заказов",onClick:a[2]||(a[2]=t=>e.prolongSeveralOrders())},null,512),[[W,l.sectionID==="50000"||l.sectionID==="51000"||l.sectionID==="52000"&&e.getOrders.length>1]]),I(y,{label:"Заказать",onClick:a[3]||(a[3]=t=>e.navigateToOrder())})],512),[[W,!e.isSeveral]]),R(_("div",qe,[I(w,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":a[4]||(a[4]=t=>e.selectPeriod=t)},null,8,["modelValue"]),I(p,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":a[5]||(a[5]=t=>e.useBalance=t),name:"checkbox-balance"},{default:S(()=>[E("Использовать средства с баланса")]),_:1},8,["modelValue"]),I(y,{label:"Продлить",onClick:a[6]||(a[6]=t=>e.prolongOrders())})],512),[[W,e.isSeveral]])],2),I(P,{class:"additional-clauses",partition:`Header:${((G=l.sectionData)==null?void 0:G.Code)==="Default"?l.sectionID:`/${(F=l.sectionData)==null?void 0:F.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(C(),T(c,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":a[7]||(a[7]=t=>e.sortBy=t),"sort-desc":e.sortDesc,"onUpdate:sortDesc":a[8]||(a[8]=t=>e.sortDesc=t),onRowClicked:e.navigateToOrderPage,"sort-direction":e.sortDirection},{"cell(Several)":S(t=>[R(I(p,{id:"checkbox-"+t.index,modelValue:e.selectedRows[t.index],"onUpdate:modelValue":f=>e.selectedRows[t.index]=f,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[W,e.isSeveral]])]),"cell(ID)":S(t=>[Ke,_("span",{class:"order-id",onClick:f=>e.toItem(t.value)},B(t.value),9,Xe)]),"cell(ContractID)":S(t=>{var f,b;return[Ze,_("span",null,"#"+B((f=e.getContracts[t.value])==null?void 0:f.ID)+" / "+B((b=e.getContracts[t.value])==null?void 0:b.Customer),1)]}),"cell(Keys)":S(t=>{var f,b;return[Je,_("span",Qe,[E(B(e.findDomainByOrderID((f=t.item)==null?void 0:f.ID)),1),_("pre",Ye,B(e.getTitleText((b=t.item)==null?void 0:b.ID)),1)])]}),"cell(StatusID)":S(t=>[$e,I(O,{class:"clickable-element",status:t.value,"status-table":"Orders",onClick:f=>{var b,q;return e.openHistoryStatuses((b=t.item)==null?void 0:b.ID,(q=t.item)==null?void 0:q.ServiceID)}},null,8,["status","onClick"])]),"cell(ExpirationDate)":S(t=>{var f,b;return[et,_("span",null,B(e.calculateExpirationDate((f=t.item)==null?void 0:f.DaysRemainded))+" | "+B(((b=t.item)==null?void 0:b.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":S(t=>{var f;return[tt,I(x,{class:"clickable-element","user-notice":t.value,id:(f=t.item)==null?void 0:f.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":S(t=>[_("div",nt,[_("div",{class:"btn btn--md btn--bold clickable-element",onClick:f=>e.handlePayment(t.item.ID,t.item.ServiceID,t.item.ContractID)},[I(D),E("Оплатить")],8,ot),I(V,{class:"dropdown-dots",right:""},{"button-content":S(()=>[_("div",st,[I(j)])]),default:S(()=>[I(o,null,{default:S(()=>[I(u,{to:`/AdditionalServices/${t.item.ID}`},{default:S(()=>[E("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),I(o,{onClick:f=>e.transferItem(t.item.ID,t.item.ServiceID)},{default:S(()=>[E("Передать на другой аккаунт")]),_:2},1032,["onClick"]),l.sectionID==="51000"||l.sectionID==="52000"?(C(),T(o,{key:0,onClick:f=>e.orderManage(t.item.ID,t.item.ServiceID)},{default:S(()=>[E("Управлять заказом")]),_:2},1032,["onClick"])):$("",!0),l.sectionID==="52000"?(C(),T(o,{key:1,onClick:f=>e.openPasswordChange(t.item.ID,t.item.ServiceID)},{default:S(()=>[E("Сменить пароль")]),_:2},1032,["onClick"])):$("",!0),I(v),I(o,{class:"color-red",onClick:f=>m.$emit("deleteItem",t.item)},{default:S(()=>[E("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","onRowClicked","sort-direction"])):(C(),T(U,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const at={components:{BlockSelectPeriod:ve,EmptyStateBlock:Z,StatusBadge:_e,IconCard:ue,Helper:Ne,Multiselect:me},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],async setup(m){const a=re(),l=ae(),e=ie("emitter"),N=h(!1),g=h("ID"),L=h(!0),y=h("desc"),w=h(!1),p=h([]),P=h(null),O=h(null),x=le(),D=ce(),j=de(),u=A(()=>D==null?void 0:D.DNSmanagerOrdersList),o=A(()=>D==null?void 0:D.ISPswOrdersList),v=A(()=>D==null?void 0:D.ExtraIPOrdersList);function V(){a.go(0)}async function c(){let r="";m.sectionID==="50000"?r="IP адресов":m.sectionID==="51000"?r="лицензии ISPsystem":m.sectionID==="52000"&&(r="вторичного DNS"),console.log(p.value);const s=K.value.filter((i,k)=>p.value[k]),n=s.map(i=>i.ID),d={ServiceID:m.sectionID,ItemsPay:O.value,OrdersIDs:n,...N.value&&{UseBalance:"yes"}};await j.OrdersPay(d).then(i=>{console.log(i),i==="Basket"?(console.log("Success"),a.push("/Basket")):(i==null?void 0:i.Status)==="Ok"&&(w.value=!1,e.emit("open-modal",{component:"BalanceProlong",data:{Service:r,Message:i==null?void 0:i.Message,Count:i==null?void 0:i.Count}}))}),console.log("Selected Orders:",s),console.log("_contract_select:",P.value),console.log("selectPeriod:",O.value)}function U(r){const s=u.value,n=String(r),d=Object.values(s).find(i=>String(i.OrderID)===n);return console.log(d),d}const H=A(()=>x==null?void 0:x.contractsList);function z(r,s,n){s==="50000"||s==="51000"||s==="52000"?ne(r,s):a.push(`/ServiceOrderPay/${r}`)}function G(r,s){console.log(r);const n=U(r);e.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:n.ID,ServiceID:s,emitEvent:"updateServicesList",Login:n.Login}})}function F(r,s){let n=null,d="";switch(s){case"50000":n=Object.entries(v.value).find(([i,k])=>k),d="ExtraIPOrders";break;case"51000":n=Object.entries(o.value).find(([i,k])=>k),d="ISPswOrders";break;case"52000":n=Object.entries(u.value).find(([i,k])=>k),d="DNSmanagerOrders";break;default:n=Object.entries(K.value).find(([i,k])=>k),d="Orders"}n&&e.emit("open-modal",{component:"StatusHistory",data:{modeID:d,rowID:n[1].ID}})}const t=r=>{const s=f(r);if(s){const n=s.split(","),d=n.length,i=n.join(`
`);return`Всего: ${d}
${i}`}return"Нет данных"},f=r=>{const s=Object.entries(u.value).reduce((n,[d,i])=>(n[d]=i,n),{});for(const n in s)if(Object.hasOwnProperty.call(s,n)){const d=s[n];if(String(d.OrderID)===String(r))return d.Parked}return null};function b(){w.value=!0}function q(){w.value=!1}function ne(r,s,n){s==="51000"?a.push(`/ISPswOrderPay/${r}`):s==="52000"?a.push(`/DNSmanagerOrderPay/${r}`):s==="50000"&&a.push(`/ExtraIPOrderPay/${r}`)}function De(r,s,n){n.target.closest("button, a, .clickable-element")||a.push(`/AdditionalServices/${r.ID}`)}function Se(r){a.push(`/AdditionalServices/${r}`)}function ge(r,s){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:r,ServiceID:s}})}function ke(r,s){let n;s==="51000"?n=Object.entries(o.value).reduce((i,[k,J])=>(i[k]=J,i),{}):s==="52000"&&(n=Object.entries(u.value).reduce((i,[k,J])=>(i[k]=J,i),{}));let d;for(const i in n)if(Object.hasOwnProperty.call(n,i)){const k=n[i];if(String(k.OrderID)===String(r)){d=k;break}}d&&j.OrderManageHosting({ServiceOrderID:d.ID,OrderID:r,ServiceID:s,XMLHttpRequest:"yes"})}const Oe=r=>{const s=Object.entries(u.value).reduce((n,[d,i])=>(n[d]=i,n),{});for(const n in s)if(Object.hasOwnProperty.call(s,n)){const d=s[n];if(String(d.OrderID)===String(r))return d.Domain}return null},K=A(()=>{var r,s;return(s=(r=Object.keys(l==null?void 0:l.userOrders).map(n=>{var d;return{...l==null?void 0:l.userOrders[n],ID:Number((d=l==null?void 0:l.userOrders[n])==null?void 0:d.ID)}}))==null?void 0:r.reverse())==null?void 0:s.filter(n=>n.ServiceID===(m==null?void 0:m.sectionID))});function be(){a.push(`/AdditionalServicesOrder?ServiceID=${m==null?void 0:m.sectionID}`)}function ye(r){if(!r)return oe(new Date);const s=new Date,n=new Date(s.getTime()+r*24*60*60*1e3);return oe(n)}return te(()=>{p.value=K.value.map(()=>!1)}),await D.fetchDNSmanagerOrders(),await D.fetchISPswOrders(),await D.fetchExtraIPOrders(),{authStore:l,getOrders:K,getContracts:H,sortBy:g,sortDesc:L,sortDirection:y,navigateToOrder:be,servicesStatuses:Be,oneTimeWorksFields:We,calculateExpirationDate:ye,getDNSmanagerOrders:u,findDomainByOrderID:Oe,findParkedByOrderID:f,getTitleText:t,transferItem:ge,orderManage:ke,servicePay:ne,handlePayment:z,navigateToOrderPage:De,openHistoryStatuses:F,toItem:Se,openPasswordChange:G,reloadNow:V,prolongSeveralOrders:b,isSeveral:w,selectedRows:p,_contract_select:P,selectPeriod:O,prolongOrders:c,outSeveralOrders:q,useBalance:N}}},Ie=se(at,[["render",rt],["__scopeId","data-v-d5ac530e"]]),it={class:"section"},ct={class:"container"},lt={class:"section-header"},dt={class:"section-nav"},ut=["title","onClick"],_t={class:"multiselect-option"},mt={class:"section-body"};function vt(m,a,l,e,N,g){var O,x,D,j,u,o,v,V;const L=fe,y=Re,w=Q("Multiselect"),p=Ie,P=Z;return C(),X(ee,null,[I(L),_("div",it,[_("div",ct,[_("div",lt,[_("div",dt,[(C(!0),X(ee,null,Ce((O=e.getServices)==null?void 0:O.slice(0,e.visibleItemsCount),c=>{var U;return C(),X("div",{class:Y(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(c==null?void 0:c.ID)}]),title:(U=e.getServerGroup(c==null?void 0:c.ServersGroupID))==null?void 0:U.Comment,onClick:H=>e.switchToSection(c==null?void 0:c.ID)},B(c==null?void 0:c.Item),11,ut)}),256)),((x=e.getServices)==null?void 0:x.length)>e.visibleItemsCount?(C(),T(w,{key:0,modelValue:e.section,"onUpdate:modelValue":a[0]||(a[0]=c=>e.section=c),class:Y({"multiselect--white additional-service__select":!0,"additional-service__select_active":(j=e.getServices)==null?void 0:j.slice(e.visibleItemsCount,(D=e.getServices)==null?void 0:D.length).find(c=>(c==null?void 0:c.ID)===e.section)}),options:(o=e.getServices)==null?void 0:o.slice(e.visibleItemsCount,(u=e.getServices)==null?void 0:u.length),label:"ID",onSelect:a[1]||(a[1]=c=>e.switchToSection(c))},{option:S(({option:c})=>[_("div",_t,B(c==null?void 0:c.Item),1)]),caret:S(()=>[I(y,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):$("",!0)])]),_("div",mt,[(v=e.getServices)!=null&&v.find(c=>c.ID===e.section)?(C(),T(p,{key:0,sectionID:e.section,sectionData:(V=e.getServices)==null?void 0:V.find(c=>c.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(C(),T(P,{key:1,label:"Услуга не найдена"}))])])])],64)}const ft={components:{ServiceListSection:Ie,emptyStateBlock:Z,Multiselect:me,BlockBalanceAgreement:fe},async setup(){const m=h(3);let a=()=>{window.innerWidth>=1920?m.value=9:window.innerWidth>=1600?m.value=7:window.innerWidth>=1440?m.value=6:window.innerWidth>=1200?m.value=5:window.innerWidth>=992?m.value=4:m.value=3};const l=we(),e=re(),N=ie("emitter"),g=ce(),L=xe();de();const y=ae(),w=le(),p=h(null);N.on("updateUserOrdersList",()=>{y.fetchUserOrders()});const P=A(()=>{var u;return(u=Object.keys(g==null?void 0:g.ServicesList))==null?void 0:u.map(o=>{var v;return{...g==null?void 0:g.ServicesList[o],value:(v=g==null?void 0:g.ServicesList[o])==null?void 0:v.ID}}).filter(o=>(o==null?void 0:o.ServicesGroupID)!=="1000"&&(o==null?void 0:o.IsActive)&&!(o!=null&&o.IsHidden)).sort((o,v)=>Number(o==null?void 0:o.SortID)<Number(v==null?void 0:v.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(v==null?void 0:v.SortID)?1:0)}),O=h(null);N.on("updateServicesList",()=>{y.fetchUserOrders()}),N.on("updateDNSManagerPage",()=>{g.fetchDNSmanagerOrders()});function x(u){e.replace(`/AdditionalServices?ServiceID=${u}`),O.value=u}function D(u){var o,v;return(v=(o=L==null?void 0:L.serverGroupsList)==null?void 0:o.ServersGroups)==null?void 0:v[u]}function j(u){N.emit("open-modal",{component:"DeleteItem",data:{id:u.ID,message:`Вы действительно хотите удалить заказ #${u.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}return te(()=>{var u,o;(u=P.value)!=null&&u.find(v=>{var V;return(v==null?void 0:v.ID)===((V=l==null?void 0:l.query)==null?void 0:V.ServiceID)})?O.value=(o=l==null?void 0:l.query)==null?void 0:o.ServiceID:e.replace(`/AdditionalServices?ServiceID=${O.value}`)}),te(()=>{window.addEventListener("resize",a),a()}),Pe(()=>{window.removeEventListener("resize",a)}),await g.fetchServices().then(()=>{var u,o;O.value=(o=(u=P.value)==null?void 0:u[0])==null?void 0:o.ID}),await w.fetchContracts(),await y.fetchUserOrders(),await g.fetchDNSmanagerOrders(),await g.fetchISPswOrders(),await g.fetchExtraIPOrders(),{section:O,deleteItem:j,getServices:P,additionalServicesValue:p,switchToSection:x,getServerGroup:D,visibleItemsCount:m}}},Ut=se(ft,[["render",vt],["__scopeId","data-v-ba33f686"]]);export{Ut as default};
