import{k as Z,o as l,c as S,b as f,a as r,t as m,l as B,w as M,d as j,F as V,y as H,z as G,p as $,m as ee,_ as te,f as oe,e as re,g as se,U as ae,r as T,h as k,i as ne}from"./index-aeb1df1e.js";import{u as de}from"./dedicatedServer-1b91e01e.js";import{u as ce}from"./services-bb78f548.js";import{u as le}from"./resetServer-1c71747e.js";import{B as q}from"./BlockBalanceAgreement-906c1168.js";import{B as z}from"./BlockAdditionalServices-3f8c8032.js";import{E as K}from"./EmptyStateBlock-b0a120e4.js";import{_ as X}from"./ButtonDefault-11c4541b.js";import{S as J}from"./StatusBadge-ca078fa4.js";import{_ as ie}from"./ClausesKeeper-90c650cc.js";import"./IconArrow-a6c91ada.js";import"./bootstrap-vue-next.es-c6bcf011.js";import"./ServiceListOrderSelection-8635e3a9.js";import"./domain-0f1019af.js";import"./multiselect-3fbc9d28.js";import"./BasicInput-67b26a5e.js";import"./component-60ac2998.js";import"./BlockSelectContract-9de95b8e.js";import"./IconClose-c7c36336.js";const P=h=>($("data-v-c9167192"),h=h(),ee(),h),_e={class:"section"},Se={class:"container"},ue={class:"section-header"},me=P(()=>r("h1",{class:"section-title"},"Дополнительные услуги",-1)),De={key:0,class:"section-label"},ve={class:"section-nav"},fe={key:0,class:"section-body"},he=P(()=>r("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),pe={class:"ordered-services-list"},Ie={class:"ordered-service-header"},ge={class:"ordered-service-name"},Oe={class:"ordered-service-status"},ke={class:"ordered-service-details"},ye={class:"ordered-service-info"},be={key:0},Ce={class:"ordered-service-actions"},Ee={class:"section-body"},Re={key:2,class:"loading"},we={key:0,class:"section"},Ae={class:"container"},Be={class:"total-block"},Pe={class:"total-block__row"},Ne=P(()=>r("div",{class:"total-block__col"},"Дополнительные услуги",-1)),Le={class:"total-block__col"},xe={class:"total-block__row no-divider"},Ue={class:"total-block__col"},Ve={class:"total-block__col"},Te={class:"total-block__row total-block__row--big"},Fe=P(()=>r("div",{class:"total-block__col"},"Итого к оплате",-1)),Me={class:"total-block__col"};function je(h,_,d,t,u,D){var R,w,A;const c=q,y=Z("router-link"),b=ie,i=J,C=X,N=z,p=K;return l(),S(V,null,[f(c),r("div",_e,[r("div",Se,[r("div",ue,[me,t.getDSServerData?(l(),S("div",De,"Выделенный сервер # "+m((R=t.getDSServerData)==null?void 0:R.OrderID),1)):B("",!0),r("div",ve,[f(y,{class:"section-nav__item",to:`/DSOrders/${(w=t.getDSServerData)==null?void 0:w.OrderID}`},{default:M(()=>[j("Сервер")]),_:1},8,["to"]),f(y,{class:"section-nav__item active",to:`/Services/${(A=t.getDSServerData)==null?void 0:A.OrderID}`},{default:M(()=>[j("Услуги")]),_:1},8,["to"])])]),f(b),t.orderedServices&&t.orderedServices.length>0?(l(),S("div",fe,[he,r("div",pe,[(l(!0),S(V,null,H(t.orderedServices,e=>{var v;return l(),S("div",{class:"ordered-service-item",key:e.ID},[r("div",Ie,[r("div",ge,m(((v=t.getServices[e==null?void 0:e.ServiceID])==null?void 0:v.Name)||(e==null?void 0:e.ServiceName)||`Услуга #${e==null?void 0:e.ServiceID}`),1),r("div",Oe,[f(i,{status:e==null?void 0:e.StatusID,"status-table":"Orders",onClick:L=>t.openHistoryStatuses(e==null?void 0:e.ID,e==null?void 0:e.ServiceID)},null,8,["status","onClick"])])]),r("div",ke,[r("div",ye,[r("span",null,"Заказ # "+m(e==null?void 0:e.ID),1),e!=null&&e.DaysRemainded?(l(),S("span",be,"| Осталось дней: "+m(e==null?void 0:e.DaysRemainded),1)):B("",!0)])]),r("div",Ce,[f(C,{class:"btn--sm",label:"Перейти к заказу",onClick:L=>t.navigateToService(e==null?void 0:e.ID)},null,8,["onClick"])])])}),128))])])):B("",!0),r("div",Ee,[t.getDSServerData&&t.serviceSearchParams?(l(),G(N,{key:0,modelValue:t.selectedServices,"onUpdate:modelValue":[_[0]||(_[0]=e=>t.selectedServices=e),t.handleServicesUpdate],"service-search-params":t.serviceSearchParams},null,8,["modelValue","service-search-params","onUpdate:modelValue"])):t.isLoading?(l(),S("div",Re,"Загрузка...")):(l(),G(p,{key:1,label:"Заказ не найден"}))])])]),t.selectedServices&&t.selectedServices.length>0?(l(),S("div",we,[r("div",Ae,[r("div",Be,[r("div",Pe,[Ne,r("div",Le,m(t.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(l(!0),S(V,null,H(t.selectedServices,e=>{var v;return l(),S("div",xe,[r("div",Ue,m((v=t.getServices[e==null?void 0:e.ServiceID])==null?void 0:v.Name),1),r("div",Ve,m(t.setToFixedService(e==null?void 0:e.Price))+" ₽",1)])}),256)),r("div",Te,[Fe,r("div",Me,m(t.ADDITIONAL_SERVICES_PRICE)+" ₽",1)])]),f(C,{class:"btn--wide",disabled:!t.selectedServices||t.selectedServices.length===0||t.isOrderLoading,"is-loading":t.isOrderLoading,label:"Заказать дополнительные услуги",onClick:_[1]||(_[1]=e=>t.orderServices())},null,8,["disabled","is-loading"])])])):B("",!0)],64)}const He={components:{BlockBalanceAgreement:q,BlockAdditionalServices:z,emptyStateBlock:K,ButtonDefault:X,StatusBadge:J},async setup(){const h=oe(),_=re(),d=de(),t=ce(),u=se();le();const D=ae("emitter");D.on("updateDSIDPage",()=>{u.fetchUserOrders()});const c=T([]),y=T(!0),b=T(!1),i=k(()=>d!=null&&d.DSList?Object.keys(d.DSList).map(o=>d.DSList[o]).find(o=>o&&String(o.OrderID)===String(h.params.id)):null),C=k(()=>{var o;return!((o=i.value)!=null&&o.SchemeID)||!(d!=null&&d.DSSchemes)?null:d.DSSchemes[i.value.SchemeID]}),N=k(()=>!i.value||!C.value?null:{ServiceID:i.value.ServiceID,ServersGroupID:C.value.ServersGroupID}),p=k(()=>(t==null?void 0:t.ServicesList)||{}),R=k(()=>{var g;if(!((g=i.value)!=null&&g.OrderID)||!(u!=null&&u.userOrders))return[];const o=i.value.OrderID;return Object.keys(u.userOrders).map(s=>u.userOrders[s]).filter(s=>(s==null?void 0:s.DependOrderID)===o&&(s==null?void 0:s.ServiceID)&&p.value[s.ServiceID]).sort((s,E)=>Number(s==null?void 0:s.ID)-Number(E==null?void 0:E.ID))}),w=k(()=>{if(!c.value||!Array.isArray(c.value))return 0;let o=0;return c.value.forEach(a=>{a&&typeof a.Price=="number"&&(o+=a.Price)}),e(o)});function A(o){c.value=o||[]}function e(o){return o==null?"0.00":Number(o).toFixed(2)||"0.00"}function v(o,a){let n="Orders";a==="50000"?n="ExtraIPOrders":a==="51000"?n="ISPswOrders":a==="52000"&&(n="DNSmanagerOrders"),D.emit("open-modal",{component:"StatusHistory",data:{modeID:n,rowID:o}})}function L(o){const a=Object.values(p.value).find(I=>I.ID===o);if(!a){_.push(`/AdditionalServices/${o}`);return}const n=a.Code;n==="Default"||n==="DNSmanager"||n==="ISPsw"||n==="ExtraIP"?_.push(`/AdditionalServices/${o}`):_.push(`/${n}Orders/${o}`)}async function Q(){var o,a,n;if(!(!c.value||!Array.isArray(c.value)||c.value.length===0))for(const I of c.value){if(!I)continue;let g="SUCCESS",s=(o=p.value[I.ServiceID])==null?void 0:o.Code;const E={Code:s,DependOrderID:(a=i.value)==null?void 0:a.OrderID,...I,ContractID:(n=i.value)==null?void 0:n.ContractID};try{const{result:x,info:O,error:Ge}=await t.ServiceOrder(E);if(x==="SUCCESS"){let U={};s==="Default"?U.ServiceOrderID=O==null?void 0:O.ServiceOrderID:U[`${s}OrderID`]=O==null?void 0:O.ServiceOrderID;const Y=await t.ServiceOrderPay(s,U,{XMLHttpRequest:"yes"});let{result:F,error:qe}=Y;F==="SUCCESS"?(D.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),c.value=[],await u.fetchUserOrders(),_.push("/AdditionalServices")):F==="BASKET"&&_.push("/Basket")}else g="ERROR",D.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(x){console.error("Ошибка при заказе услуги:",x),g="ERROR",D.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(g==="ERROR")break}}async function W(){b.value=!0;try{await Q()}catch(o){console.error("Ошибка при заказе услуг:",o),D.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{b.value=!1}}return ne(async()=>{try{await d.fetchDSOrders(),await d.fetchDSSchemes(),await t.fetchServices(),await u.fetchUserOrders()}catch(o){console.error("Ошибка загрузки данных:",o)}finally{y.value=!1}}),{getDSServerData:i,serviceSearchParams:N,selectedServices:c,getServices:p,orderedServices:R,ADDITIONAL_SERVICES_PRICE:w,handleServicesUpdate:A,setToFixedService:e,orderServices:W,isLoading:y,isOrderLoading:b,openHistoryStatuses:v,navigateToService:L}}},it=te(He,[["render",je],["__scopeId","data-v-c9167192"]]);export{it as default};
