import{j as U,o as S,c as N,a as l,b as d,w as g,d as k,t as h,F as E,x as X,n as Q,k as rt,p as it,l as lt,_ as Y,e as Z,S as $,r as H,y as A,g as R,i as ct}from"./index-b5b5ce3d.js";import{I as dt}from"./IconSearch-1e5f2e1f.js";import{u as tt}from"./vps-26e9e5ee.js";import{_ as mt}from"./HelperComponent-fa301290.js";import{S as et}from"./StatusBadge-0649a996.js";import{I as at}from"./IconRotate-965813ef.js";import{f as W}from"./useTimeFunction-8602dd60.js";import{v as ut}from"./vpsStatuses-32ffaaf5.js";import{z as _t,k as ft,d as Dt}from"./bootstrap-vue-next.es-37aa63ea.js";import{_ as gt}from"./IconDots-5eb3cb0a.js";import{_ as vt}from"./IconCard-cef3f371.js";import{_ as It}from"./OrderIDBadge-a6480cec.js";import{S as St}from"./Select2-37752b33.js";import{s as bt}from"./multiselect-4f7d14de.js";import{_ as nt}from"./ClausesKeeper-3a1c11ba.js";import{u as ht}from"./contracts-74f05bb7.js";import{B as ot}from"./BlockBalanceAgreement-a016b94f.js";import{u as pt}from"./globalActions-6936f67f.js";import{E as Pt}from"./EmptyStateBlock-cd0c2748.js";import{_ as Vt}from"./FormInputSearch-23b3b5c7.js";import"./ButtonDefault-0006f72a.js";import"./IconArrow-fddabae2.js";import"./IconClose-cd6d3917.js";import"./IconPlus-4ce40522.js";const Ct=s=>(it("data-v-c81d0a31"),s=s(),lt(),s),yt={class:"hosting-item"},Ot={class:"hosting-item__row"},kt={class:"hosting-item__row"},wt={class:"hosting-item__person"},Mt={class:"hosting-item__row"},Lt={class:"hosting-item__list"},xt=["innerHTML"],Bt={class:"hosting-status__info"},Nt={class:"hosting-status__date"},Rt={class:"hosting-item__controls"},Ut={class:"ico"},At=Ct(()=>l("div",{class:"hosting-item__title"},"Перезагрузить виртуальный сервер",-1)),Et={class:"btn btn--dots"};function Ht(s,n,i,e,v,w){var a,V,f,r,t,I,C,y,B,O;const p=It,u=U("router-link"),M=U("Helper"),L=et,P=at,x=vt,b=gt,_=_t,o=ft,c=Dt;return S(),N("div",yt,[l("div",Ot,[d(p,{orderID:(a=i.itemData)==null?void 0:a.OrderID,onClick:n[0]||(n[0]=m=>{var D;return e.toItem((D=i.itemData)==null?void 0:D.OrderID)})},null,8,["orderID"]),d(u,{class:"hosting-item__name",to:`/VPSOrders/${i.itemData.OrderID}`},{default:g(()=>[k(h(i.itemData.IP||i.itemData.Domain),1)]),_:1},8,["to"])]),l("div",kt,[l("div",wt,h(i.userName),1),d(M,{"user-notice":(V=i.itemData)==null?void 0:V.UserNotice,id:(f=i.itemData)==null?void 0:f.OrderID,position:i.isLast?"bottom":"top",emit:"updateVPSList"},null,8,["user-notice","id","position"])]),l("div",Mt,[l("ul",Lt,[(S(!0),N(E,null,X(i.params,m=>(S(),N("li",{innerHTML:m==null?void 0:m.text},null,8,xt))),256)),l("div",{class:"btn btn--md btn--bold btn-manage",onClick:n[1]||(n[1]=m=>e.orderManage())},"Управлять заказом")]),l("div",Bt,[l("div",{class:Q(["hosting-item__date",{danger:Number((r=i.itemData)==null?void 0:r.DaysRemainded)<14}])},h(e.calculateExpirationDate((t=i.itemData)==null?void 0:t.DaysRemainded))+" • "+h(((I=i.itemData)==null?void 0:I.DaysRemainded)||0)+" дн.",3),d(L,{class:"status-badge",status:(C=i.itemData)==null?void 0:C.StatusID,"status-table":"VPSOrders",onClick:n[2]||(n[2]=m=>{var D;return e.openHistoryStatuses((D=i.itemData)==null?void 0:D.ID)})},null,8,["status"]),l("div",Nt,h(e.calculateDaysSinceStatusUpdate((y=i.itemData)==null?void 0:y.StatusDate)),1)])]),l("div",Rt,[((B=i.itemData)==null?void 0:B.StatusID)==="Active"?(S(),N("div",{key:0,class:Q(["btn btn--md btn--border btn--rotate btn--rotate_green button-large btn-reload",{"btn--rotate_gray":((O=i.itemData)==null?void 0:O.StatusID)!=="Active"||e.isReloading,"btn--rotate_loading":e.isReloading}]),onClick:n[3]||(n[3]=(...m)=>e.reloadItem&&e.reloadItem(...m))},[k("Включен"),l("button",null,[l("div",Ut,[d(P)])]),At],2)):rt("",!0),l("div",{class:"btn btn--md btn--bold",onClick:n[4]||(n[4]=m=>{var D;return s.$router.push(`/VPSOrderPay/${(D=i.itemData)==null?void 0:D.OrderID}`)})},[d(x),k("Оплатить")]),d(c,{class:"dropdown-dots",right:""},{"button-content":g(()=>[l("div",Et,[d(b)])]),default:g(()=>[d(_,{onClick:n[5]||(n[5]=m=>e.transferAccount())},{default:g(()=>[k("Передать на другой аккаунт")]),_:1}),d(_,{onClick:n[6]||(n[6]=m=>e.openPasswordChange())},{default:g(()=>[k("Сменить пароль")]),_:1}),d(_,null,{default:g(()=>{var m;return[d(u,{to:`/VPSOrders/${(m=i.itemData)==null?void 0:m.OrderID}/SchemeChange`},{default:g(()=>[k("Изменить тариф")]),_:1},8,["to"])]}),_:1}),d(o),d(_,{class:"color-red",onClick:n[7]||(n[7]=m=>e.deleteItem())},{default:g(()=>[k("Удалить")]),_:1})]),_:1})])])}const Tt={components:{StatusBadge:et,IconRotate:at,Helper:mt},props:{params:{type:Array,default:()=>[]},itemData:{type:Object,default:()=>{}},isLast:{type:Boolean,default:!1},userName:{type:String,default:""}},emits:["manage","transfer","delete"],setup(s,{emit:n}){tt();const i=Z(),e=$("emitter"),v=H(!1);function w(o){if(!o)return W(new Date);const c=new Date,a=new Date(c.getTime()+o*24*60*60*1e3);return W(a)}function p(){var o;n("delete",(o=s.itemData)==null?void 0:o.ID)}function u(o){i.push(`/VPSOrders/${o}`)}function M(){var o,c;e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:(o=s.itemData)==null?void 0:o.ID,ServiceID:(c=s.itemData)==null?void 0:c.ServiceID}})}function L(o){e.emit("open-modal",{component:"StatusHistory",data:{modeID:"VPSOrders",rowID:o}})}function P(){var o,c,a;e.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:(o=s.itemData)==null?void 0:o.ID,ServiceID:(c=s.itemData)==null?void 0:c.ServiceID,emitEvent:"updateVPSIDPage",Login:(a=s.itemData)==null?void 0:a.Login}})}function x(){var c;function o(a){v.value=a}e.emit("open-modal",{component:"ReloadVPS",data:{VPSOrderID:(c=s.itemData)==null?void 0:c.ID,isReloading:v.value,onReloadStatusChange:o}})}function b(){var o,c,a;n("manage",{ServiceOrderID:(o=s.itemData)==null?void 0:o.ID,ServiceID:(c=s.itemData)==null?void 0:c.ServiceID,OrderID:(a=s.itemData)==null?void 0:a.OrderID})}function _(o){if(!o)return"";const c=new Date(parseInt(o)*1e3),V=new Date-c,f=Math.floor(V/1e3),r=Math.floor(f/60),t=Math.floor(r/60),I=Math.floor(t/24);return f<60?`${f} сек. от статуса`:r<60?`${r} мин. от статуса`:t<24?`${t} ч. от статуса`:`${I} дн. от статуса`}return{vpsStatuses:ut,reloadItem:x,isReloading:v,orderManage:b,calculateExpirationDate:w,isReloading:v,transferAccount:M,openHistoryStatuses:L,toItem:u,deleteItem:p,calculateDaysSinceStatusUpdate:_,openPasswordChange:P}}},st=Y(Tt,[["render",Ht],["__scopeId","data-v-c81d0a31"]]),jt={class:"section"},zt={class:"container"},Ft={class:"section-header"},Kt={class:"list-form"},qt={class:"list-form_col list-form_col--sm"},Gt={class:"list-form_select"},Jt={class:"multiselect-option"},Qt={key:0};function Wt(s,n,i,e,v,w){var _,o,c;const p=ot,u=U("router-link"),M=nt,L=U("Multiselect"),P=Vt,x=st,b=Pt;return S(),N(E,null,[d(p),l("div",jt,[l("div",zt,[l("div",Ft,[l("h1",{class:"section-title",onClick:n[0]||(n[0]=a=>e.reloadNow())},"VPS/VDS серверы"),d(u,{class:"btn btn--blue btn-default",to:"/VPSSchemes"},{default:g(()=>[k("Заказать")]),_:1})]),d(M),l("div",Kt,[l("div",qt,[l("div",Gt,[d(L,{modelValue:e.select,"onUpdate:modelValue":n[1]||(n[1]=a=>e.select=a),options:e.getUsers,disabled:((_=e.getUsers)==null?void 0:_.length)<=1,label:"name"},{singlelabel:g(({value:a})=>[l("span",null,"# "+h(a.value.padStart(5,"0"))+" / "+h(a.name),1)]),option:g(({option:a})=>[l("div",Jt,"# "+h(a.value.padStart(5,"0"))+" / "+h(a.name),1)]),_:1},8,["modelValue","options","disabled"])])]),d(P,{modelValue:e.search,"onUpdate:modelValue":n[2]||(n[2]=a=>e.search=a)},null,8,["modelValue"])]),e.getVpsOrders&&((o=e.getVpsOrders)==null?void 0:o.length)>0?(S(),N("div",Qt,[e.filterProducts&&((c=e.filterProducts)==null?void 0:c.length)>0?(S(!0),N(E,{key:0},X(e.filterProducts,(a,V)=>{var f;return S(),A(x,{"item-data":a,"is-last":V===e.filterProducts.length-1,"user-name":(f=e.getContracts[a==null?void 0:a.ContractID])==null?void 0:f.Customer,params:e.formItemParamList(a),onDelete:e.deleteItem,onManage:e.orderManage},null,8,["item-data","is-last","user-name","params","onDelete","onManage"])}),256)):(S(),A(b,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(S(),A(b,{key:1,class:"no-margin",label:"У вас нет заказов на VPS/VDS серверы"}))])])],64)}const Xt={components:{IconSearch:dt,Select2:St,ClausesKeeper:nt,Multiselect:bt,VpsItem:st,BlockBalanceAgreement:ot},async setup(){const s=tt(),n=ht(),i=pt(),e=Z(),v=H(null),w=H("*"),p=$("emitter");p.on("updateVPSList",()=>{s.fetchVPS()});const u=R(()=>{var r;return(r=Object.keys(s==null?void 0:s.vpsList).map(t=>s==null?void 0:s.vpsList[t]))==null?void 0:r.reverse()}),M=R(()=>s.vpsSchemes),L=R(()=>a(_(u.value))),P=R(()=>n==null?void 0:n.contractsList);ct(()=>{u.value.length<1&&b()});function x(){e.go(0)}function b(){e.push({path:"/VPSSchemes"})}function _(r){return w.value!=="*"?r.filter(t=>(t==null?void 0:t.ContractID)===w.value):r}function o(r){i.OrderManage(r)}function c(r){p.emit("open-modal",{component:"DeleteItem",data:{id:r,message:`Вы действительно хотите удалить виртуальный сервер #${r}?`,tableID:"VPSOrders",successEmit:"updateVPSList"}})}function a(r){return v.value!==null?r.filter(t=>t==null?void 0:t.IP.toLowerCase().includes(v.value.toLowerCase())):r}const V=R(()=>{let r=[{value:"*",name:"Все договора"}];return u.value!==null?(Object.keys(u.value).forEach(t=>{var I,C,y;r.find(B=>{var O;return B.value===((O=u.value[t])==null?void 0:O.ContractID)})||r.push({value:(I=u.value[t])==null?void 0:I.ContractID,name:(y=P.value[(C=u.value[t])==null?void 0:C.ContractID])==null?void 0:y.Customer})}),r):{value:"*",name:"Все договора"}});function f(r){var I,C,y,B,O,m,D,T,j,z,F,K,q,G,J;const t=(I=M.value)==null?void 0:I[r.SchemeID];return[{text:`${t==null?void 0:t.Name}`},{text:`${(y=(C=t==null?void 0:t.SchemeParams)==null?void 0:C.hdd_mib)==null?void 0:y.InternalName} ${(O=(B=t==null?void 0:t.SchemeParams)==null?void 0:B.hdd_mib)==null?void 0:O.Value} ${(D=(m=t==null?void 0:t.SchemeParams)==null?void 0:m.hdd_mib)==null?void 0:D.Unit}`},{text:`RAM ${(j=(T=t==null?void 0:t.SchemeParams)==null?void 0:T.ram_mib)==null?void 0:j.Value} ${(F=(z=t==null?void 0:t.SchemeParams)==null?void 0:z.ram_mib)==null?void 0:F.Unit}`},{text:`Канал ${(q=(K=t==null?void 0:t.SchemeParams)==null?void 0:K.net_bandwidth_mbitps)==null?void 0:q.Value} ${(J=(G=t==null?void 0:t.SchemeParams)==null?void 0:G.net_bandwidth_mbitps)==null?void 0:J.Unit}`}]}return await s.fetchVPS(),await s.fetchVPSSchemes(),await n.fetchContracts(),{getVpsOrders:u,search:v,getContracts:P,select:w,orderManage:o,formItemParamList:f,getUsers:V,filterProducts:L,navigateToVPSSchemes:b,deleteItem:c,reloadNow:x}}},he=Y(Xt,[["render",Wt],["__scopeId","data-v-07cf71f8"]]);export{he as default};
