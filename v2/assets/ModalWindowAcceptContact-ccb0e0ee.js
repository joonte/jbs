import{o as V,c as k,a as I,t as u,b,_ as A,f as w,g as f,r as d,i as x}from"./index-87a66f57.js";import{_ as B}from"./ButtonDefault-646e2a65.js";import{_ as S}from"./BasicInput-c8b42403.js";import"./component2-24f540eb.js";import"./component-8fefdc6b.js";const q={class:"modal__body"},O=I("div",{class:"list-item__title"},"Введите код подтверждения",-1),R={class:"list-item__subtitle"},U={class:"modal__accept-form"};function j(t,n,c,e,r,l){const i=S,_=B;return V(),k("div",q,[O,I("div",R,"Прислали на "+u(e.mergedData.methodId)+" «"+u(e.mergedData.address)+"» ID - "+u(e.mergedData.contactId),1),I("div",U,[b(i,{label:"Код подтверждения",name:"mailCode",placeholder:"Введите код",modelValue:e.codeMail,"onUpdate:modelValue":n[0]||(n[0]=s=>e.codeMail=s)},null,8,["modelValue"]),b(_,{class:"modal__button",label:"Подтвердить",onClick:n[1]||(n[1]=s=>e.acceptCode())})])])}const N={props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(t,{emit:n}){const c=w(),e=f(()=>c.userInfo),r=f(()=>{var o,a;return(a=Object.keys((o=e.value)==null?void 0:o.Contacts))==null?void 0:a.map(C=>{var p,v,h,g,D;if(!((h=(v=(p=e.value)==null?void 0:p.Contacts)==null?void 0:v[C])!=null&&h.IsHidden))return(D=(g=e.value)==null?void 0:g.Contacts)==null?void 0:D[C]})}),l=d(""),i=d(t.data.contactId||""),_=d(t.data.methodId||""),s=d(t.data.address||""),y=t.data.sendConfirmRequest;x(()=>{console.log(r.value)});const M=o=>r.value.find(a=>a.ID===o),m=f(()=>{const o=M(t.data.contactId);return o?{...t.data,methodId:o.MethodID,address:o.Address}:(console.error("Контакт не найден по ID",t.data.contactId),t.data)});return{methodId:_,address:s,contactId:i,acceptCode:async()=>{const o={Method:m.value.methodId,Value:m.value.address,ContactID:t.data.contactId,Confirm:l.value};try{(await y("/API/Confirm",o)).Status==="Ok"?(n("modalClose"),await c.fetchUserData()):console.error("Ошибка подтверждения кода")}catch(a){console.error("Ошибка запроса подтверждения кода",a)}},codeMail:l,mergedData:m}}},F=A(N,[["render",j]]);export{F as default};
