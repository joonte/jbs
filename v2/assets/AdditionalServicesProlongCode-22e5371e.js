import{E as he}from"./EmptyStateBlock-d1623b92.js";import{_ as be}from"./BlockOrderPayBalance-605ea2fc.js";import{_ as ke}from"./ClausesKeeper-d8c25fea.js";import{_ as ye}from"./ButtonDefault-7609cc9e.js";import{_ as Ie,f as Se,e as fe,r as ie,h as C,i as re,P as De,ag as P,o as r,c as _,b as I,a as o,t as d,z as de,l as O,F as E,y as we,$ as _e,a9 as ue,p as ge,m as Be}from"./index-400feb76.js";import{u as Ce}from"./contracts-d1f15c94.js";import{u as Pe}from"./services-b1a61255.js";/* empty css                                                                             */import{B as Oe}from"./BlockBalanceAgreement-9b1029a8.js";import"./bootstrap-vue-next.es-03cca149.js";import"./IconHelp-39b892d8.js";import"./globalActions-9f4dbd2c.js";import"./component-5bf95be3.js";import"./IconClose-20ed8b3b.js";import"./IconArrow-10b76666.js";const ve=S=>(ge("data-v-f1b94b50"),S=S(),Be(),S),Ee={key:0,class:"hosting-sheme"},Ne={class:"section"},Ue={class:"container"},xe={class:"section-header"},Ae={class:"section-header__wrapper"},Fe={class:"section-title"},Te={class:"section-label"},Le={key:1,class:"section"},Re={class:"container"},$e={class:"total-block"},Me={class:"total-block__row divider-bottom"},Ve=ve(()=>o("div",{class:"total-block__col"},"Цена тарифа",-1)),je={class:"total-block__col"},Ke={class:"total-block__row no-divider"},qe={class:"total-block__col"},ze={class:"total-block__col"},Ge={class:"total-block__row total-block__row--big economy-line"},He=ve(()=>o("div",{class:"total-block__col red"},"Выгода",-1)),Je={class:"total-block__col flex-col"},Qe={class:"red"},We={class:"total-block__row total-block__row--big"},Xe={class:"total-block__col"},Ye={class:"total-block__col"},Ze={key:2,class:"section"},eo={class:"container"},oo={key:1,class:"section"},so={class:"container"},to={__name:"AdditionalServicesProlongCode",async setup(S){let u,v;const N=Ce(),l=Pe(),pe=Se(),U=fe(),t=ie(null),f=ie(!1),n=C(()=>Object.keys(l==null?void 0:l.ISPswOrdersList).map(s=>l==null?void 0:l.ISPswOrdersList[s]).find(s=>s.OrderID===pe.params.id)),x=s=>{s.key==="Enter"&&s.ctrlKey&&B()};re(()=>{document.addEventListener("keyup",x)}),De(()=>{document.removeEventListener("keyup",x)});const c=C(()=>{var s;return(s=l==null?void 0:l.additionalServicesScheme)!=null&&s.ISPsw?Object.keys(l.additionalServicesScheme.ISPsw).map(a=>{const e=l.additionalServicesScheme.ISPsw[a];return{...e,value:e==null?void 0:e.ID,name:e==null?void 0:e.Name,cost:e==null?void 0:e.CostDay,month:e==null?void 0:e.CostMonth}}).filter(a=>{var e;return(a==null?void 0:a.ID)==((e=n.value)==null?void 0:e.SchemeID)}):[]}),g=C(()=>N.contractsList);function B(){var m,w,h,b,k;f.value=!0;const s=((m=g.value[n.value.ContractID])==null?void 0:m.Balance)>=(p(((w=t.value)==null?void 0:w.price)-D())??0)||((h=c.value[0])==null?void 0:h.cost)==="0.00"&&((b=c.value[0])==null?void 0:b.month)==="0.00",a=!s;console.log(s,"isNoBasket"),console.log(a,"Basket");const e={ISPswOrderID:n.value.ID,DaysPay:(k=t.value)==null?void 0:k.actualDays,IsNoBasket:s,IsUseBasket:a,PayMessage:""};l.ISPswOrderPay(e).then(y=>{y==="UseBasket"?U.push("/Basket"):y==="NoBasket"&&U.push("/AdditionalServices?ServiceID=51000"),f.value=!0})}function p(s){return Number(s).toFixed(2)||0}function D(){var a,e;let s=0;return(e=(a=t.value)==null?void 0:a.discounts)==null||e.Bonuses.map(m=>{s+=+m.Economy}),s}function me(s){t.value=s}return re(()=>{l.fetchAdditionalServiceScheme("ISPsw")}),[u,v]=P(()=>l.fetchISPswOrders()),await u,v(),[u,v]=P(()=>l.fetchAdditionalServiceScheme("ISPsw")),await u,v(),[u,v]=P(()=>N.fetchContracts()),await u,v(),(s,a)=>{var b,k,y,A,F,T,L,R,$,M,V,j,K,q,z,G,H,J,Q,W,X,Y,Z,ee,oe,se,te,ae,le,ne,ce;const e=ye,m=ke,w=be,h=he;return r(),_(E,null,[I(Oe),n.value?(r(),_("div",Ee,[o("div",Ne,[o("div",Ue,[o("div",xe,[o("div",Ae,[o("h1",Fe,"Оплата заказа ПО ISPsystem, "+d(((b=n.value)==null?void 0:b.IP)||""),1),((k=c.value[0])==null?void 0:k.ConsiderTypeID)!=="Upon"?(r(),de(e,{key:0,class:"btn--wide",label:parseFloat((y=g.value[n.value.ContractID])==null?void 0:y.Balance)>=parseFloat((A=t.value)==null?void 0:A.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||((F=t.value)==null?void 0:F.price)===null,"is-loading":f.value,onClick:a[0]||(a[0]=i=>B())},null,8,["label","disabled","is-loading"])):O("",!0)]),o("div",Te,d((T=c.value[0])==null?void 0:T.Name),1)])]),I(m)]),((L=c.value[0])==null?void 0:L.ConsiderTypeID)!=="Upon"?(r(),de(w,{key:0,contractID:(R=n.value)==null?void 0:R.ContractID,daysRemainded:($=n.value)==null?void 0:$.DaysRemainded,serviceID:"51000",scheme:c.value[0],orderID:(M=n.value)==null?void 0:M.OrderID,isOrderID:!0,onSelect:me},null,8,["contractID","daysRemainded","scheme","orderID"])):O("",!0),n.value?(r(),_("div",Le,[o("div",Re,[o("div",$e,[((K=(j=(V=t.value)==null?void 0:V.discounts)==null?void 0:j.Bonuses)==null?void 0:K.length)>0?(r(),_(E,{key:0},[o("div",Me,[Ve,o("div",je,d(p((q=t.value)==null?void 0:q.price))+" ₽",1)]),(r(!0),_(E,null,we((G=(z=t.value)==null?void 0:z.discounts)==null?void 0:G.Bonuses,i=>(r(),_("div",Ke,[o("div",qe,"Скидка "+d(i==null?void 0:i.Discount)+"% на "+d(i==null?void 0:i.Days)+" дней",1),o("div",ze,"-"+d(p(i==null?void 0:i.Economy))+" ₽",1)]))),256)),_e(o("div",Ge,[He,o("div",Je,[o("span",null,[o("s",null,d(p((H=t.value)==null?void 0:H.price))+" ₽",1)]),o("span",Qe,"-"+d(D())+" ₽",1)])],512),[[ue,((W=(Q=(J=t.value)==null?void 0:J.discounts)==null?void 0:Q.Bonuses)==null?void 0:W.length)>0]])],64)):O("",!0),_e(o("div",We,[o("div",Xe,d(((X=c.value[0])==null?void 0:X.ConsiderTypeID)==="Upon"?"Итого":`Итого за ${(Y=t.value)==null?void 0:Y.label}`),1),o("div",Ye,d(((Z=c.value[0])==null?void 0:Z.ConsiderTypeID)==="Upon"?(ee=c.value[0])==null?void 0:ee.CostMonth:p(((oe=t.value)==null?void 0:oe.price)-D()))+" ₽",1)],512),[[ue,((se=t.value)==null?void 0:se.price)||((te=c.value[0])==null?void 0:te.ConsiderTypeID)==="Upon"]])]),I(e,{class:"btn--wide",label:parseFloat((ae=g.value[n.value.ContractID])==null?void 0:ae.Balance)>=(p(((le=t.value)==null?void 0:le.price)-D())??0)?"Оплатить c баланса договора":"Добавить в корзину",disabled:(t.value===null||((ne=t.value)==null?void 0:ne.price)===null)&&((ce=c.value[0])==null?void 0:ce.ConsiderTypeID)!=="Upon","is-loading":f.value,onClick:a[1]||(a[1]=i=>B())},null,8,["label","disabled","is-loading"])])])):(r(),_("div",Ze,[o("div",eo,[I(h,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),_("div",oo,[o("div",so,[I(h,{label:"не удалось найти заказ хостинга"})])]))],64)}}},Io=Ie(to,[["__scopeId","data-v-f1b94b50"]]);export{Io as default};
