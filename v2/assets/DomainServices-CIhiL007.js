import{_ as K}from"./EmptyStateBlock-D6U_EDq6.js";import{_ as Q}from"./BlockAdditionalServices-CY_Vrm6d.js";import{_ as q}from"./ButtonDefault-CghIUDY0.js";import{_ as z}from"./StatusBadge-B65ys1I-.js";import{_ as G}from"./ClausesKeeper-DVJgfLR3.js";import{_ as J}from"./BlockBalanceAgreement-2iQbaweR.js";import{Q as W,u as X,r as x,f as D,g as Y,H as Z,c,b as m,a as r,h as I,t as d,w as B,E as ee,F as O,i as P,C as L,x as te,d as re,o as i,e as V}from"./index-CipWZKo_.js";import{u as se}from"./services-Dmz4Qt8q.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-3DpAa4tb.js";import"./ServiceListOrderSelection-CxiE4waM.js";import"./TotalAmount.vue_vue_type_script_setup_true_lang-GfTe3s0M.js";import"./BasicInput-BYe5b9L8.js";import"./component-DWBAga-C.js";import"./BlockSelectContract-3ekz5W0S.js";import"./contracts-CILh9uSu.js";import"./multiselect-DWCHRlfT.js";import"./IconClose-ChC2G6HM.js";const ae={class:"tw-px-4 md:tw-px-8 tw-mb-6"},ne={key:0,class:"section-label"},ie={class:"tw-flex tw-items-center tw-gap-8 tw-border-b tw-border-gray-200 tw-mt-4 tw-whitespace-nowrap tw-mb-6"},le={key:1,class:"section-body"},ce={class:"ordered-services-list"},de={class:"ordered-service-header"},ue={class:"ordered-service-name"},me={class:"ordered-service-status"},ve={class:"ordered-service-details"},_e={class:"ordered-service-info"},pe={key:0},Se={class:"ordered-service-actions"},fe={class:"section-body"},De={key:2,class:"loading"},be={class:"total-block"},we={class:"total-block__row"},ke={class:"total-block__col"},ye={class:"total-block__col"},Ie={class:"total-block__col"},Oe={class:"total-block__row total-block__row--big"},ge={class:"total-block__col"},he={__name:"DomainServices",setup(Ce){const U=Y(),_=re(),b=W(),w=se(),k=X(),p=te("emitter"),a=x([]),E=x(!0),y=x(!1),l=D(()=>b?.domainsList?Object.keys(b.domainsList).map(t=>b.domainsList[t]).find(t=>t&&t.OrderID==U.params.id):null),R=D(()=>l.value?{ServiceID:l.value.ServiceID}:null),S=D(()=>w?.ServicesList||{}),g=D(()=>{if(!l.value?.OrderID||!k?.userOrders)return[];const t=l.value.OrderID;return Object.keys(k.userOrders).map(n=>k.userOrders[n]).filter(n=>String(n?.DependOrderID)===String(t)&&n?.ServiceID&&S.value[n.ServiceID]).sort((n,v)=>Number(n?.ID)-Number(v?.ID))}),$=D(()=>{if(!a.value||!Array.isArray(a.value))return 0;let t=0;return a.value.forEach(e=>{e&&typeof e.Price=="number"&&(t+=e.Price)}),A(t)});function F(t){a.value=t||[]}function A(t){return t==null?"0.00":Number(t).toFixed(2)||"0.00"}async function M(){if(!(!a.value||!Array.isArray(a.value)||a.value.length===0))for(const t of a.value){if(!t)continue;let e="SUCCESS",o=S.value[t.ServiceID]?.Code;const u={Code:o,DependOrderID:l.value?.OrderID,...t,ContractID:l.value?.ContractID};try{const{result:n,info:v,error:h}=await w.ServiceOrder(u);if(n==="SUCCESS"){let f={};o==="Default"?f.ServiceOrderID=v?.ServiceOrderID:f[`${o}OrderID`]=v?.ServiceOrderID;const C=await w.ServiceOrderPay(o,f);let{result:s,error:N}=C;s==="SUCCESS"?(p.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),a.value=[],_.push("/AdditionalServices")):s==="BASKET"&&_.push("/Basket")}else e="ERROR",p.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(n){console.error("Ошибка при заказе услуги:",n),e="ERROR",p.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(e==="ERROR")break}}async function T(){y.value=!0;try{await M()}catch(t){console.error("Ошибка при заказе услуг:",t),p.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{y.value=!1}}function j(t){const e=Object.values(S.value).find(u=>u.ID===t);if(!e){_.push(`/AdditionalServices/${t}`);return}const o=e.Code;o==="Default"||o==="DNSmanager"||o==="ISPsw"||o==="ExtraIP"?_.push(`/AdditionalServices/${t}`):_.push(`/${o}Orders/${t}`)}function H(t,e){let o="Orders";e==5e4?o="ExtraIPOrders":e==51e3?o="ISPswOrders":e==52e3&&(o="DNSmanagerOrders"),p.emit("open-modal",{component:"StatusHistory",data:{modeID:o,rowID:t}})}return Z(async()=>{try{await b.fetchDomainOrders(),await w.fetchServices(),await k.fetchUserOrders()}catch(t){console.error("Ошибка загрузки данных:",t)}finally{E.value=!1}}),(t,e)=>{const o=J,u=ee("RouterLink"),n=G,v=z,h=q,f=Q,C=K;return i(),c(O,null,[m(o),r("div",ae,[e[7]||(e[7]=r("h1",{class:"tw-text-xl sm:tw-text-4xl"},"Дополнительные услуги",-1)),l.value?(i(),c("div",ne,"Домен #"+d(l.value?.OrderID),1)):I("",!0),r("div",ie,[m(u,{class:"tw-py-2 tw-cursor-pointer -tw-mb-[1px]","active-class":"tw-text-sky-400 tw-border-b-2 tw-border-sky-400",to:`/DomainOrders/${l.value?.OrderID}`},{default:B(()=>e[2]||(e[2]=[V(" Домен ",-1)])),_:1,__:[2]},8,["to"]),m(u,{class:"tw-py-2 tw-cursor-pointer -tw-mb-[1px]","active-class":"tw-text-sky-400 tw-border-b-2 tw-border-sky-400",to:`/DomainServices/${l.value?.OrderID}`},{default:B(()=>e[3]||(e[3]=[V(" Услуги ",-1)])),_:1,__:[3]},8,["to"])]),m(n),g.value&&g.value.length>0?(i(),c("div",le,[e[4]||(e[4]=r("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),r("div",ce,[(i(!0),c(O,null,P(g.value,s=>(i(),c("div",{class:"ordered-service-item",key:s.ID},[r("div",de,[r("div",ue,d(S.value[s?.ServiceID]?.Name||s?.ServiceName||`Услуга #${s?.ServiceID}`),1),r("div",me,[m(v,{status:s?.StatusID,"status-table":"Orders",onClick:N=>H(s?.ID,s?.ServiceID)},null,8,["status","onClick"])])]),r("div",ve,[r("div",_e,[r("span",null,"Заказ # "+d(s?.ID),1),s?.DaysRemainded?(i(),c("span",pe,"| Осталось дней: "+d(s?.DaysRemainded),1)):I("",!0)])]),r("div",Se,[m(h,{class:"btn--sm",label:"Перейти к заказу",onClick:N=>j(s?.ID)},null,8,["onClick"])])]))),128))])])):I("",!0),r("div",fe,[l.value&&R.value?(i(),L(f,{key:0,modelValue:a.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>a.value=s),F],"service-search-params":R.value},null,8,["modelValue","service-search-params"])):E.value?(i(),c("div",De,"Загрузка...")):(i(),L(C,{key:1,label:"Заказ не найден"}))]),a.value&&a.value.length>0?(i(),c(O,{key:2},[r("div",be,[r("div",we,[e[5]||(e[5]=r("div",{class:"total-block__col"},"Дополнительные услуги",-1)),r("div",ke,d($.value)+" ₽",1)]),(i(!0),c(O,null,P(a.value,s=>(i(),c("div",{class:"total-block__row no-divider",key:s.ServiceID},[r("div",ye,d(S.value[s?.ServiceID]?.Name),1),r("div",Ie,d(A(s?.Price))+" ₽",1)]))),128)),r("div",Oe,[e[6]||(e[6]=r("div",{class:"total-block__col"},"Итого к оплате",-1)),r("div",ge,d($.value)+" ₽",1)])]),m(h,{class:"btn--wide",disabled:!a.value||a.value.length===0||y.value,"is-loading":y.value,label:"Заказать дополнительные услуги",onClick:e[1]||(e[1]=s=>T())},null,8,["disabled","is-loading"])],64)):I("",!0)])],64)}}},qe=oe(he,[["__scopeId","data-v-941f2240"]]);export{qe as default};
