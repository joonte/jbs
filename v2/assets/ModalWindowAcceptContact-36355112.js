import{o as B,c as w,a as _,t as D,b as k,_ as x,f as E,g as m,r as d,h as M,O}from"./index-5e313302.js";import{_ as S}from"./ButtonDefault-7c216fc6.js";import{_ as U}from"./BasicInput-be1c88a0.js";import"./component-6a5a025c.js";const q={class:"modal__body"},R=_("div",{class:"list-item__title"},"Введите код подтверждения",-1),j={class:"list-item__subtitle"},L={class:"modal__accept-form"};function N(e,n,c,o,f,r){const l=U,i=S;return B(),w("div",q,[R,_("div",j,"Отправили "+D(o.mergedData.methodId)+" на «"+D(o.mergedData.address)+"»",1),_("div",L,[k(l,{label:"Код подтверждения",name:"mailCode",placeholder:"Введите код",modelValue:o.codeMail,"onUpdate:modelValue":n[0]||(n[0]=s=>o.codeMail=s)},null,8,["modelValue"]),k(i,{class:"modal__button",label:"Подтвердить",onClick:n[1]||(n[1]=s=>o.acceptCode())})])])}const W={props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(e,{emit:n}){const c=E(),o=m(()=>c.userInfo),f=m(()=>{var t,a;return(a=Object.keys((t=o.value)==null?void 0:t.Contacts))==null?void 0:a.map(p=>{var v,h,y,b,g;if(!((y=(h=(v=o.value)==null?void 0:v.Contacts)==null?void 0:h[p])!=null&&y.IsHidden))return(g=(b=o.value)==null?void 0:b.Contacts)==null?void 0:g[p]})}),r=d(""),l=d(e.data.contactId||""),i=d(e.data.methodId||""),s=d(e.data.address||""),V=e.data.sendConfirmRequest;M(()=>{});const A=t=>f.value.find(a=>a.ID===t),u=m(()=>{const t=A(e.data.contactId);return t?{...e.data,methodId:t.MethodID,address:t.Address}:(console.error("Контакт не найден по ID",e.data.contactId),e.data)}),C=async()=>{const t={Method:u.value.methodId,Value:u.value.address,ContactID:e.data.contactId,Confirm:r.value};try{(await V("/API/Confirm",t)).Status==="Ok"?(n("modalClose"),await c.fetchUserData()):console.error("Ошибка подтверждения кода")}catch(a){console.error("Ошибка запроса подтверждения кода",a)}},I=t=>{t.key==="Enter"&&C()};return M(()=>{document.addEventListener("keyup",I)}),O(()=>{document.removeEventListener("keyup",I)}),{methodId:i,address:s,contactId:l,acceptCode:C,codeMail:r,mergedData:u}}},z=x(W,[["render",N]]);export{z as default};
