import{j as E,o as b,c as L,a,t as O,b as v,x,w as m,d as A,F as V,p as Y,l as Z,_ as P,e as R,f as F,R as M,r as N,g as j,i as z,h as $,v as ee,n as G,k as te,a7 as oe}from"./index-15714261.js";import{u as q}from"./services-8084fcef.js";import{u as K}from"./contracts-f65e198e.js";import"./postings-4d84dab6.js";import{u as ne}from"./globalActions-197e816b.js";import{u as se}from"./resetServer-e35e0679.js";import{f as H}from"./useTimeFunction-8602dd60.js";import{_ as W}from"./IconCard-e28e03f4.js";import{E as U}from"./EmptyStateBlock-fe9538c2.js";import{S as J}from"./StatusBadge-d84388d1.js";import{s as re}from"./servicesStatuses-6293b6ac.js";import{_ as ce}from"./HelperComponent-122493e3.js";import{z as ae,k as ie,d as le,C as de}from"./bootstrap-vue-next.es-a66dab43.js";import{_ as _e}from"./IconDots-c3bbe0b3.js";import{_ as ue}from"./ClausesKeeper-e7fc0265.js";import{_ as me}from"./ButtonDefault-47f7ce80.js";import{s as ve}from"./multiselect-fd0ad678.js";import{B as Q}from"./BlockBalanceAgreement-8319794d.js";import{_ as De}from"./IconArrow-3252fec2.js";import"./IconClose-b189ba41.js";const fe=[{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],B=l=>(Y("data-v-58f65870"),l=l(),Z(),l),pe={class:"section-header"},Ie={class:"section-title__nowrap"},Se={class:"section-title"},ge={class:"btn__group"},ye=B(()=>a("span",{class:"td-mobile"},"Заказ",-1)),ke=B(()=>a("span",{class:"td-mobile"},"Договор",-1)),be=B(()=>a("span",{class:"td-mobile"},"Ключевые поля",-1)),he=["title"],Oe=B(()=>a("span",{class:"td-mobile"},"Статус",-1)),Ce=B(()=>a("span",{class:"td-mobile"},"Дата окончания",-1)),Be=B(()=>a("span",{class:"td-mobile"},"Комментарий",-1)),we={class:"service__controls-wrapper"},Te=["onClick"],xe={class:"btn btn--dots"};function Ne(l,u,_,e,C,w){var c,t,s;const I=me,S=ue,g=J,D=E("Helper"),f=W,h=_e,y=E("router-link"),p=ae,i=ie,n=le,r=de,k=U;return b(),L(V,null,[a("div",pe,[a("div",Ie,[a("h1",Se,O((c=_.sectionData)==null?void 0:c.Item),1),a("div",ge,[v(I,{label:"Заказать",onClick:u[0]||(u[0]=o=>e.navigateToOrder())})])]),v(S,{class:"additional-clauses",partition:`Header:${((t=_.sectionData)==null?void 0:t.Code)==="Default"?_.sectionID:`/${(s=_.sectionData)==null?void 0:s.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(b(),x(r,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":u[1]||(u[1]=o=>e.sortBy=o),"sort-desc":e.sortDesc,"onUpdate:sortDesc":u[2]||(u[2]=o=>e.sortDesc=o),"sort-direction":e.sortDirection},{"cell(ID)":m(o=>[ye,a("span",null,O(o.value),1)]),"cell(ContractID)":m(o=>{var d;return[ke,a("span",null,O((d=e.getContracts[o.value])==null?void 0:d.Customer),1)]}),"cell(Keys)":m(o=>{var d,T;return[be,a("span",{title:e.getTitleText((d=o.item)==null?void 0:d.ID)},O(e.findDomainByOrderID((T=o.item)==null?void 0:T.ID)),9,he)]}),"cell(StatusID)":m(o=>[Oe,v(g,{status:o.value,"status-table":"Orders"},null,8,["status"])]),"cell(ExpirationDate)":m(o=>{var d,T;return[Ce,a("span",null,O(e.calculateExpirationDate((d=o.item)==null?void 0:d.DaysRemainded))+" | "+O(((T=o.item)==null?void 0:T.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":m(o=>{var d;return[Be,v(D,{"user-notice":o.value,id:(d=o.item)==null?void 0:d.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":m(o=>[a("div",we,[a("div",{class:"btn btn--md btn--bold",onClick:d=>l.$router.push(`/ServiceOrderPay/${o.item.ID}`)},[v(f),A("Оплатить")],8,Te),v(n,{class:"dropdown-dots",right:""},{"button-content":m(()=>[a("div",xe,[v(h)])]),default:m(()=>[v(p,null,{default:m(()=>[v(y,{to:`/AdditionalServices/${o.item.ID}`},{default:m(()=>[A("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),v(p,{onClick:d=>e.transferItem(o.item.ID,o.item.ServiceID)},{default:m(()=>[A("Передать на другой аккаунт")]),_:2},1032,["onClick"]),v(i),v(p,{class:"color-red",onClick:d=>l.$emit("deleteItem",o.item)},{default:m(()=>[A("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","sort-direction"])):(b(),x(k,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const Ae={components:{EmptyStateBlock:U,StatusBadge:J,IconCard:W,Helper:ce},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],setup(l){const u=R(),_=F(),e=M("emitter"),C=N("ID"),w=N(!0),I=N("desc"),S=K(),g=q(),D=j(()=>g==null?void 0:g.DNSmanagerOrdersList),f=j(()=>S==null?void 0:S.contractsList),h=c=>{const t=y(c);if(t){const s=t.split(","),o=s.length,d=s.join(`
`);return`Всего: ${o}
${d}`}return"Нет данных"},y=c=>{console.log(c);const t=Object.entries(D.value).reduce((s,[o,d])=>(s[o]=d,s),{});for(const s in t)if(Object.hasOwnProperty.call(t,s)){const o=t[s];if(String(o.OrderID)===String(c))return o.Parked}return null};function p(c,t){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:c,ServiceID:t}})}const i=c=>{console.log(c);const t=Object.entries(D.value).reduce((s,[o,d])=>(s[o]=d,s),{});for(const s in t)if(Object.hasOwnProperty.call(t,s)){const o=t[s];if(String(o.OrderID)===String(c))return o.Domain}return null};z(()=>{console.log(D),console.log(f)});const n=j(()=>{var c,t;return(t=(c=Object.keys(_==null?void 0:_.userOrders).map(s=>{var o;return{..._==null?void 0:_.userOrders[s],ID:Number((o=_==null?void 0:_.userOrders[s])==null?void 0:o.ID)}}))==null?void 0:c.reverse())==null?void 0:t.filter(s=>s.ServiceID===(l==null?void 0:l.sectionID))});function r(){u.push(`/AdditionalServicesOrder?ServiceID=${l==null?void 0:l.sectionID}`)}function k(c){if(!c)return H(new Date);const t=new Date,s=new Date(t.getTime()+c*24*60*60*1e3);return H(s)}return $(D,c=>{console.log(c)}),{authStore:_,getOrders:n,getContracts:f,sortBy:C,sortDesc:w,sortDirection:I,navigateToOrder:r,servicesStatuses:re,oneTimeWorksFields:fe,calculateExpirationDate:k,getDNSmanagerOrders:D,findDomainByOrderID:i,findParkedByOrderID:y,getTitleText:h,transferItem:p}}},X=P(Ae,[["render",Ne],["__scopeId","data-v-58f65870"]]),Le={class:"section"},je={class:"container"},Ue={class:"section-header"},Ee={class:"section-nav"},Ve=["title","onClick"],Ge={class:"multiselect-option"},He={class:"section-body"};function Pe(l,u,_,e,C,w){var h,y,p,i,n,r,k,c;const I=Q,S=De,g=E("Multiselect"),D=X,f=U;return b(),L(V,null,[v(I),a("div",Le,[a("div",je,[a("div",Ue,[a("div",Ee,[(b(!0),L(V,null,ee((h=e.getServices)==null?void 0:h.slice(0,3),t=>{var s;return b(),L("div",{class:G(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(t==null?void 0:t.ID)}]),title:(s=e.getServerGroup(t==null?void 0:t.ServersGroupID))==null?void 0:s.Comment,onClick:o=>e.switchToSection(t==null?void 0:t.ID)},O(t==null?void 0:t.Item),11,Ve)}),256)),((y=e.getServices)==null?void 0:y.length)>3?(b(),x(g,{key:0,modelValue:e.section,"onUpdate:modelValue":u[0]||(u[0]=t=>e.section=t),class:G({"multiselect--white additional-service__select":!0,"additional-service__select_active":(i=e.getServices)==null?void 0:i.slice(3,(p=e.getServices)==null?void 0:p.length).find(t=>(t==null?void 0:t.ID)===e.section)}),options:(r=e.getServices)==null?void 0:r.slice(3,(n=e.getServices)==null?void 0:n.length),label:"ID",onSelect:u[1]||(u[1]=t=>e.switchToSection(t))},{option:m(({option:t})=>[a("div",Ge,O(t==null?void 0:t.Item),1)]),caret:m(()=>[v(S,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):te("",!0)])]),a("div",He,[(k=e.getServices)!=null&&k.find(t=>t.ID===e.section)?(b(),x(D,{key:0,sectionID:e.section,sectionData:(c=e.getServices)==null?void 0:c.find(t=>t.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(b(),x(f,{key:1,label:"Услуга не найдена"}))])])])],64)}const Re={components:{ServiceListSection:X,emptyStateBlock:U,Multiselect:ve,BlockBalanceAgreement:Q},async setup(){const l=oe(),u=R(),_=M("emitter"),e=q(),C=se(),w=ne(),I=F(),S=K(),g=N(null),D=j(()=>{var i;return(i=Object.keys(e==null?void 0:e.ServicesList))==null?void 0:i.map(n=>{var r;return{...e==null?void 0:e.ServicesList[n],value:(r=e==null?void 0:e.ServicesList[n])==null?void 0:r.ID}}).filter(n=>(n==null?void 0:n.ServicesGroupID)!=="1000"&&(n==null?void 0:n.IsActive)&&!(n!=null&&n.IsHidden)).sort((n,r)=>Number(n==null?void 0:n.SortID)<Number(r==null?void 0:r.SortID)?-1:Number(n==null?void 0:n.SortID)>Number(r==null?void 0:r.SortID)?1:0)}),f=N(null);_.on("updateServicesList",()=>{I.fetchUserOrders()});function h(i){u.replace(`/AdditionalServices?ServiceID=${i}`),f.value=i}function y(i){var n,r;return(r=(n=C==null?void 0:C.serverGroupsList)==null?void 0:n.ServersGroups)==null?void 0:r[i]}function p(i){w.deleteItem({TableID:"Orders",RowsIDs:i.ID}).then(({result:n,error:r})=>{n==="SUCCESS"&&I.fetchUserOrders()})}return z(()=>{var i,n;(i=D.value)!=null&&i.find(r=>{var k;return(r==null?void 0:r.ID)===((k=l==null?void 0:l.query)==null?void 0:k.ServiceID)})?f.value=(n=l==null?void 0:l.query)==null?void 0:n.ServiceID:u.replace(`/AdditionalServices?ServiceID=${f.value}`)}),await e.fetchServices().then(()=>{var i,n;f.value=(n=(i=D.value)==null?void 0:i[0])==null?void 0:n.ID}),await S.fetchContracts(),await I.fetchUserOrders(),await e.fetchDNSmanagerOrders(),{section:f,deleteItem:p,getServices:D,additionalServicesValue:g,switchToSection:h,getServerGroup:y}}},it=P(Re,[["render",Pe],["__scopeId","data-v-a94a4142"]]);export{it as default};
