import{o as h,c as y,a as f,b as O,_ as E,y as v,w as R,F as x,x as W,a8 as H,p as q,l as U,r as F,f as K,g as C,e as G,S as z,a0 as J,O as Q,a2 as X}from"./index-b5b5ce3d.js";import{_ as Y,u as Z,n as ee}from"./networkController-ac56f90f.js";import{u as te}from"./postings-ed3c9d0d.js";import{u as ne}from"./contracts-74f05bb7.js";import{I as oe}from"./IconClose-cd6d3917.js";import{E as $}from"./EmptyStateBlock-cd0c2748.js";import{B as N}from"./BlockBalanceAgreement-a016b94f.js";import{_ as se}from"./ClausesKeeper-3a1c11ba.js";import"./bootstrap-vue-next.es-37aa63ea.js";import"./ButtonDefault-0006f72a.js";import"./IconArrow-fddabae2.js";const ce={class:"notes__note-container"},ae=["innerHTML"];function ie(n,r,p,c,l,u){const _=oe;return h(),y("div",ce,[f("div",{class:"notes__content",innerHTML:p.item},null,8,ae),f("div",{class:"notes__close-button",onClick:r[0]||(r[0]=w=>c.closeNote(p.index))},[O(_,{class:"notes__close-button-cross"})])])}const re={props:{item:{type:String,default:""},index:{type:[String,Number],default:""}},emits:["delete"],setup(n,{emit:r}){function p(c){let l=new Date;l.setDate(30+l.getDate()),document.cookie=`${c}=hidden; path=/; expires=${l}`,r("delete",c)}return{closeNote:p}}},M=E(re,[["render",ie],["__scopeId","data-v-8295fda7"]]),de=n=>(q("data-v-11fac9ff"),n=n(),U(),n),le={class:"section"},me={class:"container"},pe=de(()=>f("div",{class:"section-header"},[f("h1",{class:"section-title"},"Уведомления")],-1)),fe={class:"notes"};function he(n,r,p,c,l,u){const _=N,w=se,i=M,s=$;return h(),y(x,null,[O(_),f("div",le,[f("div",me,[pe,O(w),f("div",fe,[c.notes&&Object.keys(c.notes).length>0?(h(),v(H,{key:0,class:"notes__transition-container",tag:"div",name:"list"},{default:R(()=>[(h(!0),y(x,null,W(c.notes,(D,I)=>(h(),v(i,{item:D,index:I,key:I,onDelete:c.deleteItem},null,8,["item","index","onDelete"]))),128))]),_:1})):(h(),v(s,{key:1,label:"Все уведомления прочитаны или они еще не пришли"}))])])])],64)}const ue={components:{IconCross:Y,Note:M,EmptyStateBlock:$,BlockBalanceAgreement:N},async setup(){const n=Z(),r=F(null),p=te(),c=ne(),l=K(),u=C(()=>l.userInfo),_=C(()=>{var e,t;return(t=Object.keys((e=u.value)==null?void 0:e.Contacts))==null?void 0:t.map(o=>{var d,a,S,m,b;if(!((S=(a=(d=u.value)==null?void 0:d.Contacts)==null?void 0:a[o])!=null&&S.IsHidden))return(b=(m=u.value)==null?void 0:m.Contacts)==null?void 0:b[o]})}),w=e=>_.value.find(t=>t.ID===e),i=G(),s=z("emitter"),D=C(()=>{let e={};return Object.keys(n==null?void 0:n.notesList).reverse().forEach(t=>{var o;e[t]=(o=n==null?void 0:n.notesList)==null?void 0:o[t]}),Object.keys(e).length>0?e:null});function I(){let e={};Object.keys(n==null?void 0:n.notesList).reverse().forEach(t=>{var o;A(t)&&(e[t]=(o=n==null?void 0:n.notesList)==null?void 0:o[t])}),r.value=e}function A(e){return document.cookie.match(RegExp(`(?:^|;\\s*)${e}=([^;]*)`))===null}function B(e){delete r.value[e],s.emit("notes-reduce")}const k=async(e,t)=>{try{return(await X.post(e,t)).data}catch(o){throw new Error(`Error sending confirm request: ${o.message}`)}};async function g(e,t){if((e.includes("ISPswSchemes")||e.includes("ExtraIPSchemes")||e.includes("DNSmanagerSchemes"))&&(e.includes("ISPswSchemes")&&i.push("/AdditionalServicesOrder?ServiceID=51000"),e.includes("ExtraIPSchemes")&&i.push("/AdditionalServicesOrder?ServiceID=50000"),e.includes("DNSmanagerSchemes")&&i.push("/AdditionalServicesOrder?ServiceID=52000")),e.includes("OrderPay")){let o=t[Object.keys(t).find(d=>d.includes("OrderID"))];e!=="/ExtraIPOrderPay"&&e!=="/ISPswOrderPay"&&e!=="/DNSmanagerOrderPay"?i.push(`${e}/${o}`):e==="/ExtraIPOrderPay"||e==="/ISPswOrderPay"||e==="/DNSmanagerOrderPay"?i.push(`${e}/${o}`):i.push(`/ServiceOrderPay/${o}`)}else if(e==="/InvoiceDocument")p.InvoiceDocument({InvoiceID:t.InvoiceID}).then(o=>{s.emit("open-modal",{component:"InvoiceDocument",data:{html:o,ID:t.InvoiceID}})});else if(e==="/API/OrdersTransfer")s.emit("open-modal",{component:"TakeOrder",data:{OrdersTransferID:t}});else if(e==="/ContractMake")i.push("ContractMake");else if(e==="/DomainSelectOwner")s.emit("open-modal",{component:"DomainSelectOwner",data:t});else if(e==="/ISPswOrders")i.push("AdditionalServices");else if(e==="/ContactEdit?MethodID=VKontakte")s.emit("open-modal",{component:"CreateVK"});else if(e==="/ContactEdit?MethodID=Telegram")s.emit("open-modal",{component:"CreateTelegram"});else if(e==="/ContactEdit?MethodID=Viber")s.emit("open-modal",{component:"CreateViber"});else if(e==="/ContactEdit?MethodID=SMS")s.emit("open-modal",{component:"CreatePhone"});else if(e.includes("/ContactEdit")){(t==null?void 0:t.MethodID)==="SMS"&&s.emit("open-modal",{component:"CreatePhone"});const o=e.match(/ContactID=(\d+)/),d=o?o[1]:null;if(d){const a=w(d);if(a){const S={Method:a.MethodID,Value:a.Address,ContactID:a.ID};try{const m=await k("/API/Confirm",S);m.Status==="Ok"?s.emit("open-modal",{component:"AcceptContact",data:{contactId:d,sendConfirmRequest:k}}):console.error(`Error confirming code. Status: ${m.Status}, Message: ${m.Message}`)}catch(m){console.error("Error accepting contact:",m.message)}}}else console.error("ContactID is not present in the URL params.",e)}else s.emit("open-modal",{component:e.replace("/",""),data:t})}function j(){}function L(e,t,o,d){ee.post(e,t).then(a=>{a.data.Status==="Exception"?s.emit("open-modal",{component:"ExclusionWindow",data:a.data}):n.fetchNotes().then(()=>{I()})}).catch(a=>{console.error("Ошибка при выполнении запроса:",a)})}function T(e,t){s.emit("open-modal",{component:"DeleteItem",data:{id:null,callback:t,message:e,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function V(){}function P(){window.ShowWindow=g.bind(this)}return J(()=>{P()}),Q(()=>{window.ShowWindow=null}),s.on("close-modal",()=>{P()}),window.ShowProgress=V.bind(this),window.ShowWindow=g.bind(this),window.PromptShow=j.bind(this),window.AjaxCall=L.bind(this),window.ShowConfirm=T.bind(this),await n.fetchNotes().then(()=>{I()}),await c.fetchContracts(),await c.fetchProfiles(),await l.fetchUserData(),{getNotesList:D,notes:r,ShowWindow:g,deleteItem:B}}},Pe=E(ue,[["render",he],["__scopeId","data-v-11fac9ff"]]);export{Pe as default};
