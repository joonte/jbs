import{_ as pt}from"./EmptyStateBlock-Ad1AmtSS.js";import{L as dt,a as vt,v as _t,r as ft}from"./bootstrap-vue-next-BglOzul_.js";import{_ as It}from"./IconDots-Mp79qN9u.js";import{_ as yt}from"./IconCard-CjQefsRP.js";import{S as Dt,c as x,o as d,n as bt,M as Ct,an as wt,x as gt,r as u,f as I,D as S,b as a,a as n,C as V,w as s,v as b,F as R,h as St,d as kt,g as xt,t as l,e as k,W as A}from"./index-C9dBN6m4.js";import{_ as Bt}from"./IconDownload-BySwh-ff.js";import{_ as $t}from"./StatusBadge-DZmmWv0G.js";import{_ as Vt}from"./FormInputSearch-B6VLZUqq.js";import{_ as Lt}from"./ClausesKeeper-gPyacQ05.js";import{_ as Nt}from"./ButtonDefault-B1FApUky.js";import{_ as Pt,f as Ft}from"./BlockBalanceAgreement-DSLTUOoQ.js";import{u as Tt}from"./postings-CmcOMU5N.js";import{u as Et}from"./contracts-BEc0DZS2.js";import{s as O}from"./multiselect-B6DlyfA6.js";import{f as Ut,s as Rt}from"./time-DenPiOX5.js";import{_ as At}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-aXPVPivX.js";import"./IconClose-CgjzG0Yf.js";import"./index-D0iqQ1zq.js";const Ot=Dt({__name:"SimpleButton",props:{type:{}},setup(j){return(r,m)=>(d(),x("button",{class:bt(["tw-h-8 tw-px-2 tw-flex tw-items-center tw-gap-2 tw-text-2xs tw-font-bold tw-uppercase tw-border tw-rounded hover:tw-text-sky-400",r.type==="cancel"?"tw-text-red-500":"tw-text-gray-800"])},[Ct(r.$slots,"default")],2))}}),jt={class:"tw-px-4 md:tw-px-8"},Mt={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},ht={class:"list-form"},zt={class:"list-form_col list-form_col--sm"},Ht={class:"list-form_select"},Wt={class:"multiselect-option"},qt={class:"d-block"},Zt={class:"d-block"},Gt={class:"d-block"},Jt={class:"d-block"},Kt={class:"d-block"},Qt=["href"],Xt={key:0,class:"table-controls"},Yt={class:"multiselect-multiple-label"},te={class:"multiselect-option"},ee={__name:"Invoices",async setup(j){let r,m;const B=Et(),i=Tt();wt();const M=kt(),C=xt(),c=gt("emitter"),h=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Button1",variant:"td-controls",label:""},{key:"Button2",variant:"td-controls",label:""},{key:"Button3",variant:"td-controls",label:""},{key:"Button4",variant:"td-controls",label:""}];c.on("updateInvoicesTable",()=>{i.fetchInvoices()});const L=u("CreateDate"),N=u(!0),z=u("desc"),y=u(""),v=u("*"),D=u(1),_=u(10),H=u([10,25,50,100]),w=I(()=>Object.keys(i?.invoicesList).map(o=>({...i?.invoicesList[o],Customer:F.value?.[i?.invoicesList[o].ContractID]?.Customer,Summ:Number(i?.invoicesList[o]?.Summ)})).reverse()),P=I(()=>w.value.filter(t=>v.value!=="*"?Number(t.ContractID)===Number(v.value):!0));I(()=>i?.servicesList);const F=I(()=>B.contractsList),T=I(()=>{let o=[];return w.value.map(t=>{if(!o.find(f=>f===t.Customer))return o.push(t.Customer),{value:t.ContractID,name:t.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),E=I(()=>w.value.filter(o=>o?.PaymentSystemName.toLowerCase().includes(y.value?.toLowerCase())||String(o?.Summ).toLowerCase().includes(y.value?.toLowerCase())).filter(o=>String(o.ContractID).includes(v.value!=="*"?v.value:"")).length);function W(){M.go(0)}function q(){D.value=1}function Z(o){window.location=`${A}/InvoiceDownload?InvoiceID=${o?.item?.ID}&IsStamp=yes`}function G(o){return`${A}/InvoiceDownload?InvoiceID=${o?.item?.ID}&IsTIFF=yes&IsStamp=yes`}function J(o){c.emit("open-modal",{component:"AcceptConditionally",data:{ContractID:o?.item?.ContractID,RowsIDs:o?.item?.ID,AllowConditionallyMessage:o?.item?.AllowConditionallyMessage}})}function K(o){c.emit("open-modal",{component:"StatusHistory",data:{modeID:"Invoices",rowID:o}})}function Q(o){c.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:o?.item?.ID,TypeID:F.value?.[o?.item?.ContractID]?.TypeID,Summ:o?.item?.Summ,PaymentSystemID:o.item.PaymentSystemID}})}async function U(o){const t=await i.InvoiceDocument({InvoiceID:o.item?.ID});c.emit("open-modal",{component:"InvoiceDocument",data:{html:t,ID:o.item?.ID}})}async function X(o){const t=await i.InvoiceDocument({InvoiceID:o.item?.ID});c.emit("open-modal",{component:"InvoiceDocumentView",data:{html:t}})}function Y(){c.emit("open-modal",{component:"NewInvoice"})}function tt(o){let t=new FormData;t.append("ContractID","Default"),t.append("RowsIDs[]",o.item?.ID),i.InvoicesReject(t).then(f=>{f==="SUCCESS"&&i.fetchInvoices()})}return[r,m]=S(()=>B.fetchContracts()),await r,m(),[r,m]=S(()=>B.fetchProfiles()),await r,m(),[r,m]=S(()=>i.fetchInvoices().then(()=>{C.params?.id&&w.value?.find(t=>t.ID===C.params?.id)&&U({item:{ID:C.params.id}}),C.query.Error==="yes"&&c.emit("open-modal",{component:"InvoiceError"})})),await r,m(),[r,m]=S(()=>i.fetchServices()),await r,m(),(o,t)=>{const f=Pt,et=Nt,ot=Lt,nt=Vt,st=$t,at=Bt,g=Ot,lt=yt,it=It,$=ft,rt=_t,mt=dt,ct=vt,ut=pt;return d(),x(R,null,[a(f),n("div",jt,[n("div",Mt,[n("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:t[0]||(t[0]=e=>W())},"Счета на оплату"),a(et,{onClick:t[1]||(t[1]=e=>Y()),label:"Выписать новый счёт"})]),a(ot),n("div",ht,[n("div",zt,[n("div",Ht,[a(b(O),{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e),options:T.value,disabled:T.value?.length<=1,label:"name"},{singlelabel:s(({value:e})=>[n("span",null,"# "+l(String(e.value).padStart(5,"0"))+" / "+l(e.name),1)]),option:s(({option:e})=>[n("span",Wt,"# "+l(String(e.value).padStart(5,"0"))+" / "+l(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a(nt,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=e=>y.value=e)},null,8,["modelValue"])]),P.value?.length>0?(d(),x(R,{key:0},[a(mt,{class:"basic-table",items:P.value,fields:h,"show-empty":!0,filter:y.value,"per-page":_.value,"current-page":D.value,responsive:"","sort-by":L.value,"onUpdate:sortBy":t[4]||(t[4]=e=>L.value=e),"sort-desc":N.value,"onUpdate:sortDesc":t[5]||(t[5]=e=>N.value=e),"sort-direction":z.value,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:q},{"cell(PaymentSystemName)":s(e=>[t[9]||(t[9]=n("span",{class:"td-mobile"},"Платежная система",-1)),n("span",qt,l(e.value),1)]),"cell(CreateDate)":s(e=>[t[10]||(t[10]=n("span",{class:"td-mobile"},"Дата Создания",-1)),n("span",Zt,l(b(Ut)(b(Rt)(e.item?.CreateDate))),1)]),"cell(ID)":s(e=>[t[11]||(t[11]=n("span",{class:"td-mobile"},"Номер счета",-1)),n("span",Gt,l(e.value),1)]),"cell(ContractID)":s(e=>[t[12]||(t[12]=n("span",{class:"td-mobile"},"Договор",-1)),n("span",Jt,"#"+l(e.item?.ContractID)+" / "+l(e.item?.Customer),1)]),"cell(StatusID)":s(e=>[a(st,{status:e.value,"status-table":"Invoices",onClick:p=>K(e.item?.ID),class:"tw-cursor-pointer"},null,8,["status","onClick"])]),"cell(Summ)":s(e=>[t[13]||(t[13]=n("span",{class:"td-mobile"},"Сумма",-1)),n("span",Kt,l(b(Ft)(e.item?.Summ)),1)]),"cell(Button1)":s(e=>[a(g,{onClick:p=>Z(e)},{default:s(()=>[a(at,{class:"tw-size-5"}),t[14]||(t[14]=n("div",null,"Скачать",-1))]),_:2,__:[14]},1032,["onClick"])]),"cell(Button2)":s(e=>[e.item?.IsPosted?(d(),V(g,{key:0,onClick:p=>X(e)},{default:s(()=>t[15]||(t[15]=[k(" Посмотреть ",-1)])),_:2,__:[15]},1032,["onClick"])):(d(),V(g,{key:1,onClick:p=>U(e)},{default:s(()=>[a(lt,{class:"tw-size-5"}),t[16]||(t[16]=n("div",null,"Оплатить",-1))]),_:2,__:[16]},1032,["onClick"]))]),"cell(Button3)":s(e=>[a(g,{type:"cancel",onClick:p=>tt(e)},{default:s(()=>t[17]||(t[17]=[k("Отменить",-1)])),_:2,__:[17]},1032,["onClick"])]),"cell(Button4)":s(e=>[a(rt,{class:"dropdown-dots tw-m-0",right:""},{"button-content":s(()=>[a(it)]),default:s(()=>[a($,null,{default:s(()=>[n("a",{href:G(e)},"Скачать в формате tiff",8,Qt)]),_:2},1024),a($,{onClick:p=>Q(e)},{default:s(()=>t[18]||(t[18]=[k("Изменить счёт",-1)])),_:2,__:[18]},1032,["onClick"]),a($,{onClick:p=>J(e)},{default:s(()=>t[19]||(t[19]=[k("Провести условно",-1)])),_:2,__:[19]},1032,["onClick"])]),_:2},1024)]),_:1},8,["items","filter","per-page","current-page","sort-by","sort-desc","sort-direction"]),E.value>0?(d(),x("div",Xt,[a(ct,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=e=>D.value=e),"total-rows":E.value,"per-page":_.value,"first-number":"","last-number":""},{"first-text":s(()=>t[20]||(t[20]=[n("span",{class:"text-success"},"First",-1)])),"last-text":s(()=>t[21]||(t[21]=[n("span",{class:"text-info"},"Last",-1)])),page:s(({page:e,active:p})=>[n("span",null,l((e-1)*_.value+1)+"-"+l(e*_.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),a(b(O),{class:"multiselect--white",modelValue:_.value,"onUpdate:modelValue":t[7]||(t[7]=e=>_.value=e),options:H.value,label:"name",openDirection:"top",onInput:t[8]||(t[8]=e=>D.value=1)},{singlelabel:s(({value:e})=>[n("span",Yt," Отображать "+l(e.value)+" строк ",1)]),option:s(({option:e})=>[n("span",te,"Отображать "+l(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):St("",!0)],64)):(d(),V(ut,{key:1,label:"Заказов не найдено"}))])],64)}}},Ce=At(ee,[["__scopeId","data-v-972a960c"]]);export{Ce as default};
