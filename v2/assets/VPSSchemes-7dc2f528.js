import{_ as Ce}from"./ButtonDefault-dafa6215.js";import{_ as se,r as I,i as oe,o as u,c as _,a,q as Se,l as z,t as m,d as Oe,F as C,y as N,e as we,h as B,P as Ee,j as xe,ah as X,b as $,w as ee,$ as fe,aa as be,z as te,p as Ne,m as Ue,K as $e}from"./index-c781268b.js";import{_ as Ae}from"./ClausesKeeper-5fae717f.js";import{u as Le}from"./vps-3be73a4d.js";import{u as Re}from"./resetServer-bcdc43a0.js";import{u as Fe}from"./contracts-7e377877.js";import{u as Ge}from"./services-f889332c.js";import{_ as Me}from"./BlockSelectContract-2bfc7c50.js";import{B as Te}from"./BlockOrderServiceWrapper-d3beff81.js";import je from"./BlockAdditionalServices-e8b9bc1f.js";import{_ as Ke}from"./BlockOrderPayBalance-a5c27437.js";import{B as qe}from"./BlockBalanceAgreement-1d554184.js";import"./IconClose-3fa8ed32.js";import"./multiselect-9a74535b.js";import"./EmptyStateBlock-8165a481.js";import"./bootstrap-vue-next.es-c86262f3.js";import"./ServiceListOrderSelection-6ff8206a.js";import"./domain-ca269c7d.js";import"./BasicInput-df2ac90e.js";import"./component-d2f2a50c.js";import"./IconHelp-0d3353ae.js";import"./globalActions-bedd3c73.js";import"./IconArrow-8731a209.js";const He={props:{modelValue:[String,Number],data:{type:Object,default:()=>{}},name:{type:String,default:""},type:{type:String,default:"radio"},checked:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(S,{emit:i}){const o=I(null),p=I(!1);function V(){i("update:modelValue",S.data)}function P(){p.value=!0}return oe(()=>{o.value=S.modelValue}),{inputValue:o,isIconPressed:p,onMouseEvent:P,updateValue:V}}},ze={class:"form-input_border"},We={class:"form-input_border-label"},Xe=["name","checked"],Je={class:"form-field__data"},Qe={key:0,class:"form-field__img"},Ye=["src"],Ze={class:"form-field__name"},et={class:"form-field__desc"},tt={class:"form-field__select"};function at(S,i,o,p,V,P){return u(),_("div",ze,[a("label",We,[a("input",{name:o.name,type:"radio",checked:o.checked,onInput:i[0]||(i[0]=(...f)=>p.updateValue&&p.updateValue(...f))},null,40,Xe),a("div",Je,[Se(S.$slots,"default",{},()=>[o.data.img?(u(),_("div",Qe,[a("img",{src:o.data.img,alt:""},null,8,Ye)])):z("",!0)],!0),a("div",Ze,m(o.data.name),1),a("div",et,[Oe(m(o.data.desc)+" ",1),o.data.select?Se(S.$slots,"default",{key:0},()=>[a("div",tt,[(u(!0),_(C,null,N(o.data.select,(f,O)=>(u(),_("div",{key:O,class:"form-field__select-item"},m(f.text),1))),128))])],!0):z("",!0)])])])])}const st=se(He,[["render",at],["__scopeId","data-v-6ee6abfb"]]);const ot={props:{modelValue:[String,Number],data:{type:Object,default:()=>{}},headers:{type:Array,default:()=>[]},name:{type:String,default:""},checkbox:{type:Boolean,default:!1},checked:{type:Boolean,default:!1}},emits:["update:modelValue","input"],setup(S,{emit:i}){const o=I(null),p=I(!1);function V(){i("update:modelValue",S.data),i("input",S.data)}function P(){p.value=!0}return oe(()=>{o.value=S.modelValue}),{inputValue:o,isIconPressed:p,onMouseEvent:P,updateValue:V}}},lt={class:"form-input_border"},nt={class:"form-input_border-label"},ct=["name","type","checked"],rt={class:"form-field__data"},ut={class:"form-field_header"};function dt(S,i,o,p,V,P){return u(),_("div",lt,[a("label",nt,[a("input",{name:o.name,type:o.checkbox?"checkbox":"radio",checked:o.checked,onInput:i[0]||(i[0]=(...f)=>p.updateValue&&p.updateValue(...f))},null,40,ct),a("div",rt,[(u(!0),_(C,null,N(o.headers,(f,O)=>(u(),_("div",{key:O,class:"form-field__col"},[a("span",ut,m(f),1),a("span",null,m(o.data[O]),1)]))),128))])])])}const _t=se(ot,[["render",dt],["__scopeId","data-v-a13950e6"]]),it="/v2/assets/oc-2-8f4c288c.jpg";const A=S=>(Ne("data-v-37f0a1c3"),S=S(),Ue(),S),vt={class:"vps-scheme-page"},pt={class:"section"},mt={class:"container"},ht=A(()=>a("div",{class:"section-header"},[a("h1",{class:"section-title"},"Заказать VPS/VDS сервер")],-1)),St={class:"section"},ft={class:"container"},bt=A(()=>a("h2",{class:"section-block_title"},"Конфигурация",-1)),kt={class:"form-column"},It={class:"form-header"},gt={class:"form-header_col"},yt={key:0,class:"section"},Dt={class:"container"},Vt=A(()=>a("h2",{class:"section-block_title"},"Операционная система",-1)),Pt={class:"form grid-gorm"},Bt=["src","alt"],Ct={class:"section"},Ot={class:"container"},wt=A(()=>a("h2",{class:"section-block_title"},"Регион",-1)),Et={class:"form"},xt={class:"section"},Nt={class:"container"},Ut={class:"total-block"},$t={class:"total-block__row divider-bottom"},At=A(()=>a("div",{class:"total-block__col"},"Цена тарифа",-1)),Lt={class:"total-block__col"},Rt={class:"total-block__row no-divider"},Ft={class:"total-block__col"},Gt={class:"total-block__col"},Mt={class:"total-block__row"},Tt=A(()=>a("div",{class:"total-block__col"},"Дополнительные услуги",-1)),jt={class:"total-block__col"},Kt={class:"total-block__row no-divider"},qt={class:"total-block__col"},Ht={class:"total-block__col"},zt={class:"total-block__row total-block__row--big economy-line"},Wt=A(()=>a("div",{class:"total-block__col red"},"Выгода",-1)),Xt={class:"total-block__col flex-col"},Jt={class:"red"},Qt={class:"total-block__row total-block__row--big"},Yt={class:"total-block__col"},Zt={class:"total-block__col"},ae="Moscow",ea={__name:"VPSSchemes",async setup(S){let i,o;const p=Le(),V=Fe(),P=Re(),f=Ge(),O=we(),h=I(null),F=I([]),E=I(null),G=I(null),W=I(!1),g=I(null),J=I(!1),le=I(""),ke=I([{img:it,value:"Moscow",name:"Россия",desc:"Москва"}]),ne=B(()=>{var t,c,l,n,v,r,b,d,k;const e=(t=M.value)==null?void 0:t[0];return e!=null&&e.SchemeParams?{PackageID:"Тариф",cpu_number:((l=(c=e==null?void 0:e.SchemeParams)==null?void 0:c.cpu_number)==null?void 0:l.Name)||"CPU",ram_mib:((v=(n=e==null?void 0:e.SchemeParams)==null?void 0:n.ram_mib)==null?void 0:v.Name)||"RAM",hdd_mib:((b=(r=e==null?void 0:e.SchemeParams)==null?void 0:r.hdd_mib)==null?void 0:b.Name)||"Память",net_in_mbitps:((k=(d=e==null?void 0:e.SchemeParams)==null?void 0:d.net_in_mbitps)==null?void 0:k.Name)||"Канал",CostMonth:"Стоимость"}:{PackageID:"Тариф",cpu_number:"CPU",ram_mib:"RAM",hdd_mib:"Память",net_in_mbitps:"Канал",CostMonth:"Стоимость"}}),M=B(()=>Object.keys(p.vpsSchemes).map(e=>p.vpsSchemes[e])),Ie=B(()=>M.value.sort((t,c)=>{const l=Number(t.SortID),n=Number(c.SortID);return l-n})),ge=B(()=>V==null?void 0:V.contractsList),U=B(()=>M.value.find(e=>{var t;return(e==null?void 0:e.ID)===((t=g.value)==null?void 0:t.ID)})),T=B(()=>{var e;return(e=P==null?void 0:P.serverGroupsList)==null?void 0:e.ServersGroups}),ce=B(()=>f==null?void 0:f.ServicesList),Q=B(()=>{let e=0;return F.value.forEach(t=>{e+=t==null?void 0:t.Price}),ue(e)||0}),L=B(()=>{var c,l;const e=((c=U.value)==null?void 0:c.OS)||[],t=((l=U.value)==null?void 0:l.OSs)||[];return e.map(n=>{const v=t.find(r=>r.Name===n);return{name:n,value:n,imageUrl:v?v.Image:""}})}),re=e=>{e.key==="Enter"&&e.ctrlKey&&!ye.value&&ie()},ye=B(()=>h.value===null||E.value===null);oe(()=>{console.log(U),document.addEventListener("keyup",re)}),Ee(()=>{document.removeEventListener("keyup",re)});function R(e){var n;const t=Number((n=U.value)==null?void 0:n.CostInstall)||0,c=Number(e)||0,l=(t+c).toFixed(2);return Number(l)}function ue(e){return Number(e).toFixed(2)||0}function Y(){var t,c;let e=0;return(c=(t=h.value)==null?void 0:t.discounts)==null||c.Bonuses.map(l=>{e+=+l.Economy}),e}xe(g,e=>{h.value=e,console.log(U)});function de(e){var t,c,l,n,v,r,b,d;return{ID:e==null?void 0:e.ID,PackageID:e==null?void 0:e.PackageID,ServersGroupID:e==null?void 0:e.ServersGroupID,cpu_number:(c=(t=e==null?void 0:e.SchemeParams)==null?void 0:t.cpu_number)==null?void 0:c.Value,ram_mib:(n=(l=e==null?void 0:e.SchemeParams)==null?void 0:l.ram_mib)==null?void 0:n.Value,hdd_mib:(r=(v=e==null?void 0:e.SchemeParams)==null?void 0:v.hdd_mib)==null?void 0:r.Value,net_in_mbitps:(d=(b=e==null?void 0:e.SchemeParams)==null?void 0:b.net_in_mbitps)==null?void 0:d.Value,CostMonth:e==null?void 0:e.CostMonth}}function De(){var c,l,n,v,r,b;let e=(n=Object.keys((l=T.value)==null?void 0:l[(c=g.value)==null?void 0:c.ServersGroupID]))==null?void 0:n.find(d=>{var k,D,w,x,j,K,q,H;return((x=(w=(D=T.value)==null?void 0:D[(k=g.value)==null?void 0:k.ServersGroupID])==null?void 0:w[d])==null?void 0:x.IsActive)&&((H=(q=(K=T.value)==null?void 0:K[(j=g.value)==null?void 0:j.ServersGroupID])==null?void 0:q[d])==null?void 0:H.IsDefault)}),t=(b=Object.keys((r=T.value)==null?void 0:r[(v=g.value)==null?void 0:v.ServersGroupID]))==null?void 0:b.find(d=>{var k,D,w,x;return(x=(w=(D=T.value)==null?void 0:D[(k=g.value)==null?void 0:k.ServersGroupID])==null?void 0:w[d])==null?void 0:x.IsActive});return e||t}function _e(e){h.value=e,console.log("select balance pay working")}async function Ve(e){var t;for(const c of F.value){let l="SUCCESS",n=(t=ce.value[c.ServiceID])==null?void 0:t.Code;if(await f.ServiceOrder({Code:n,DependOrderID:e,...c,ContractID:E.value}).then(({result:v,info:r,error:b})=>{if(v==="SUCCESS"){let d={};n==="Default"?d.ServiceOrderID=r==null?void 0:r.ServiceOrderID:d[`${n}OrderID`]=r==null?void 0:r.ServiceOrderID,f.ServiceOrderPay(n,d,{XMLHttpRequest:"yes"}).then(k=>{let{result:D,error:w}=k;D==="SUCCESS"?O.push("/AdditionalServices"):D==="BASKET"&&O.push("/Basket")})}else l="ERROR"}),l==="ERROR")break}}function ie(){var e,t;W.value=!0,p.VPSOrder({ContractID:E.value,VPSSchemeID:(e=g.value)==null?void 0:e.ID,ServerID:De(),DiskTemplate:(t=G.value)==null?void 0:t.value}).then(({result:c,info:l,error:n})=>{var v,r;c==="SUCCESS"?(Ve(l==null?void 0:l.OrderID),p.VPSOrderPay({VPSOrderID:l==null?void 0:l.VPSOrderID,DaysPayFromBallance:((v=h.value)==null?void 0:v.daysFromBalance)||0,DaysPay:(r=h.value)==null?void 0:r.actualDays,IsChange:!0}).then(b=>{let{result:d,error:k}=b;d==="SUCCESS"?O.push("/VPSOrders"):d==="BASKET"&&O.push("/Basket"),W.value=!1})):W.value=!1})}const Pe=e=>{$e(()=>{const t=document.querySelector(".form-input_border-label input:checked~.form-field__content");t?t.click():_e()})};function Be(){var e,t;((e=L==null?void 0:L.value)==null?void 0:e.length)>0&&(G.value=(t=L.value)==null?void 0:t[0])}return[i,o]=X(()=>p.fetchVPSSchemes().then(()=>{var e,t;((e=M.value)==null?void 0:e.length)>0&&(g.value=de((t=M.value)==null?void 0:t[0])),Be()})),await i,o(),[i,o]=X(()=>V.fetchContracts()),await i,o(),[i,o]=X(()=>P.fetchServerGroups()),await i,o(),[i,o]=X(()=>f.fetchServices()),await i,o(),(e,t)=>{var r,b,d,k,D,w,x,j,K,q,H,ve,pe,me,he;const c=Ae,l=_t,n=st,v=Ce;return u(),_(C,null,[$(qe),a("div",vt,[a("div",pt,[a("div",mt,[ht,$(c)])]),$(Te,{basic_title:"VPS/VDS сервер",modelValue:le.value,"onUpdate:modelValue":t[6]||(t[6]=s=>le.value=s)},{page:ee(()=>[a("div",St,[a("div",ft,[bt,a("div",kt,[a("div",It,[(u(!0),_(C,null,N(ne.value,s=>(u(),_("div",gt,m(s),1))),256))]),(u(!0),_(C,null,N(Ie.value,s=>{var y;return u(),te(l,{data:de(s),type:"",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=Z=>g.value=Z),name:"config",checked:((y=g.value)==null?void 0:y.ID)===(s==null?void 0:s.ID),headers:ne.value,onInput:Pe},null,8,["data","modelValue","checked","headers"])}),256))])])]),L.value?(u(),_("div",yt,[a("div",Dt,[Vt,a("div",Pt,[(u(!0),_(C,null,N(L.value,s=>{var y;return u(),te(n,{data:s,modelValue:G.value,"onUpdate:modelValue":t[1]||(t[1]=Z=>G.value=Z),checked:(s==null?void 0:s.value)===((y=G.value)==null?void 0:y.value),type:"",name:"operating_system"},{default:ee(()=>[s.imageUrl?(u(),_("img",{key:0,src:s.imageUrl,alt:s.name},null,8,Bt)):z("",!0)]),_:2},1032,["data","modelValue","checked"])}),256))])])])):z("",!0),a("div",Ct,[a("div",Ot,[wt,a("div",Et,[(u(!0),_(C,null,N(ke.value,s=>(u(),te(n,{data:s,checked:(s==null?void 0:s.value)===ae,modelValue:ae,"onUpdate:modelValue":t[2]||(t[2]=y=>ae=y),type:"",name:"region"},null,8,["data","checked"]))),256))])])]),$(Me,{title:"Информация о сервере",modelValue:E.value,"onUpdate:modelValue":t[3]||(t[3]=s=>E.value=s)},null,8,["modelValue"]),$(Ke,{contractID:E.value,scheme:U.value,serviceID:"30000",isOrderID:!1,onSelect:_e,isBalancePay:J.value,"onUpdate:isBalancePay":t[4]||(t[4]=s=>J.value=s)},null,8,["contractID","scheme","isBalancePay"])]),services:ee(()=>{var s;return[$(je,{modelValue:F.value,"onUpdate:modelValue":t[5]||(t[5]=y=>F.value=y),serviceSearchParams:{ServiceID:"30000",ServersGroupID:(s=U.value)==null?void 0:s.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]}),_:1},8,["modelValue"]),a("div",xt,[a("div",Nt,[a("div",Ut,[((d=(b=(r=h.value)==null?void 0:r.discounts)==null?void 0:b.Bonuses)==null?void 0:d.length)>0?(u(),_(C,{key:0},[a("div",$t,[At,a("div",Lt,m(R((k=h.value)==null?void 0:k.price))+" ₽",1)]),(u(!0),_(C,null,N((w=(D=h.value)==null?void 0:D.discounts)==null?void 0:w.Bonuses,s=>(u(),_("div",Rt,[a("div",Ft,"Скидка "+m(s==null?void 0:s.Discount)+"% на "+m(s==null?void 0:s.Days)+" дней",1),a("div",Gt,"-"+m(R(s==null?void 0:s.Economy))+" ₽",1)]))),256))],64)):z("",!0),a("div",Mt,[Tt,a("div",jt,m(Q.value)+" ₽",1)]),(u(!0),_(C,null,N(F.value,s=>{var y;return u(),_("div",Kt,[a("div",qt,m((y=ce.value[s==null?void 0:s.ServiceID])==null?void 0:y.Name),1),a("div",Ht,m(ue(s==null?void 0:s.Price))+" ₽",1)])}),256)),fe(a("div",zt,[Wt,a("div",Xt,[a("span",null,[a("s",null,m(R((x=h.value)==null?void 0:x.price))+" ₽",1)]),a("span",Jt,"-"+m(R(Y()))+" ₽",1)])],512),[[be,((q=(K=(j=h.value)==null?void 0:j.discounts)==null?void 0:K.Bonuses)==null?void 0:q.length)>0]]),fe(a("div",Qt,[a("div",Yt,"Итого за "+m((H=h.value)==null?void 0:H.label),1),a("div",Zt,m(R(((ve=h.value)==null?void 0:ve.price)-Y()+ +Q.value))+" ₽",1)],512),[[be,(pe=h.value)==null?void 0:pe.price]])]),$(v,{class:"btn--wide",label:J.value||((me=ge.value[E.value])==null?void 0:me.Balance)>R(((he=h.value)==null?void 0:he.price)-Y()+ +Q.value)?"Оплатить c баланса договора":"Добавить в корзину",disabled:h.value===null||E.value===null,"is-loading":W.value,onClick:t[7]||(t[7]=s=>ie())},null,8,["label","disabled","is-loading"])])])])],64)}}},Da=se(ea,[["__scopeId","data-v-37f0a1c3"]]);export{Da as default};
