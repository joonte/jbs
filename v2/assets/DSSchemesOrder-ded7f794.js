import{_ as ue}from"./ButtonDefault-dafa6215.js";import{_ as ve}from"./ClausesKeeper-5fae717f.js";import{_ as me,f as pe,e as be,U as he,r as C,h as O,i as Se,P as De,ah as A,o as _,c as d,b as p,a as t,F as E,t as a,w as ce,y as M,$ as j,aa as G,l as ke,p as fe,m as ye}from"./index-c781268b.js";import{u as Ie}from"./dedicatedServer-1d58ce86.js";import{u as Be}from"./contracts-7e377877.js";import{u as Ce}from"./services-f889332c.js";import{B as Oe}from"./BlockBalanceAgreement-1d554184.js";import{_ as Ee}from"./BlockSelectContract-2bfc7c50.js";import{B as we}from"./BlockOrderServiceWrapper-d3beff81.js";import xe from"./BlockAdditionalServices-e8b9bc1f.js";import{_ as Pe}from"./BlockOrderPayBalance-a5c27437.js";import{E as ge}from"./EmptyStateBlock-8165a481.js";import"./IconClose-3fa8ed32.js";import"./bootstrap-vue-next.es-c86262f3.js";import"./IconArrow-8731a209.js";import"./multiselect-9a74535b.js";import"./ServiceListOrderSelection-6ff8206a.js";import"./domain-ca269c7d.js";import"./BasicInput-df2ac90e.js";import"./component-d2f2a50c.js";import"./IconHelp-0d3353ae.js";import"./globalActions-bedd3c73.js";const w=g=>(fe("data-v-593e9331"),g=g(),ye(),g),Ve={class:"dedicated-server-order"},Re={class:"section"},Ue={class:"container"},Ne={class:"section-header"},Ae={class:"section-title"},Fe=w(()=>t("div",{class:"section-label"},"Выделенный сервер",-1)),Le={class:"section"},$e={class:"container"},Te={class:"list"},Ke={class:"list-col list-col--xl"},Me={class:"list-item"},je=w(()=>t("div",{class:"list-item__row"},[t("div",{class:"list-item__title"},"Конфигурация")],-1)),Ge={class:"list-item__row list-item__table"},qe={class:"list-item__table-col"},He={class:"list-item__label"},We={class:"list-item__text"},Xe=w(()=>t("div",{class:"section"},[t("div",{class:"container"},[t("div",{class:"section-subtitle"},"Что входит в стоимость"),t("div",{class:"text"},[t("p",null,"Для подключения дополнительных услуг"),t("ul",null,[t("li",null,"Размещение в РФ, Москва"),t("li",null,"IP адрес, с возможностью расширения"),t("li",null,"Бесплатная панель управления ISPManager Lite"),t("li",null,"Круглосуточная поддержка")])])])],-1)),ze={class:"section"},Je={class:"container"},Qe={class:"total-block"},Ye={class:"total-block__row divider-bottom"},Ze=w(()=>t("div",{class:"total-block__col"},"Цена тарифа",-1)),et={class:"total-block__col"},tt={class:"total-block__row no-divider"},st={class:"total-block__col"},lt={class:"total-block__col"},ot={class:"total-block__row"},at=w(()=>t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),rt={class:"total-block__col"},ct={class:"total-block__row no-divider"},it={class:"total-block__col"},nt={class:"total-block__col"},_t={class:"total-block__row total-block__row--big economy-line"},dt=w(()=>t("div",{class:"total-block__col red"},"Выгода",-1)),ut={class:"total-block__col flex-col"},vt={class:"red"},mt={class:"total-block__row total-block__row--big"},pt={class:"total-block__col"},bt={class:"total-block__col"},ht={key:1,class:"section"},St={class:"container"},Dt={__name:"DSSchemesOrder",async setup(g){let v,m;const q=Be(),b=Ie(),D=Ce(),H=pe(),V=be();he("emitter");const o=C(null),h=C([]),R=C(!1),u=C(null),F=C(!1),W=C(""),X=e=>{e.key==="Enter"&&e.ctrlKey&&!ie.value&&Q()},ie=O(()=>o.value===null||u.value===null);Se(()=>{document.addEventListener("keyup",X)}),De(()=>{document.removeEventListener("keyup",X)});const x=O(()=>q.contractsList),k=O(()=>b==null?void 0:b.DSSchemes),f=O(()=>{var e;return(e=k==null?void 0:k.value)==null?void 0:e[H.params.id]}),z=O(()=>D==null?void 0:D.ServicesList),L=O(()=>{let e=0;return h.value.forEach(s=>{e+=s==null?void 0:s.Price}),J(e)||0});function ne(e){o.value=e}function $(){var s,i;let e=0;return(i=(s=o.value)==null?void 0:s.discounts)==null||i.Bonuses.map(c=>{e+=+c.Economy}),e}function y(e){var r;const s=Number((r=f.value)==null?void 0:r.CostInstall)||0,i=Number(e)||0,c=(s+i).toFixed(2);return Number(c)}function J(e){return Number(e).toFixed(2)||0}function _e(){var s;const e=(s=k==null?void 0:k.value)==null?void 0:s[H.params.id];return[{label:"Процессор",text:(e==null?void 0:e.CPU)||"-"},{label:"Объём оперативной памяти",text:(e==null?void 0:e.ram)||"-"},{label:"Характеристики жёстких дисков",text:(e==null?void 0:e.disks)||"-"},{label:"Предустановленная ОС",text:(e==null?void 0:e.OS)||"-"},{label:"RAID",text:(e==null?void 0:e.raid)||"-"},{label:"Месячный трафик",text:e!=null&&e.trafflimit?`${e==null?void 0:e.trafflimit} ГБ`:"-"},{label:"Скорость канала",text:e!=null&&e.chrate?`${e==null?void 0:e.chrate} Мбит/с`:"-"}]}async function de(e){var s;if(!(!h.value||h.value.length===0))for(const i of h.value){let c="SUCCESS",r=(s=z.value[i.ServiceID])==null?void 0:s.Code;const I={Code:r,DependOrderID:e,...i,ContractID:u.value};if(await D.ServiceOrder(I).then(({result:S,info:n,error:T})=>{if(S==="SUCCESS"){let B={};r==="Default"?B.ServiceOrderID=n==null?void 0:n.ServiceOrderID:B[`${r}OrderID`]=n==null?void 0:n.ServiceOrderID,D.ServiceOrderPay(r,B,{XMLHttpRequest:"yes"}).then(U=>{let{result:P,error:K}=U;P==="SUCCESS"?V.push("/AdditionalServices"):P==="BASKET"&&V.push("/Basket")})}else c="ERROR"}),c==="ERROR")break}}function Q(){R.value=!0,b.DSOrder({ContractID:u.value,DSSchemeID:f.value.ID}).then(({result:e,info:s,error:i})=>{var c,r;e==="SUCCESS"?(de(s==null?void 0:s.OrderID),b.DSOrderPay({DSOrderID:s==null?void 0:s.DSOrderID,DaysPayFromBallance:((c=o.value)==null?void 0:c.daysFromBalance)||0,DaysPay:(r=o.value)==null?void 0:r.actualDays,IsChange:!0}).then(I=>{let{result:S,error:n}=I;S==="SUCCESS"?V.push("/DSOrders"):S==="BASKET"&&V.push("/Basket"),R.value=!1})):R.value=!1})}return[v,m]=A(()=>b.fetchDSOrders()),await v,m(),[v,m]=A(()=>b.fetchDSSchemes()),await v,m(),[v,m]=A(()=>q.fetchContracts().then(()=>{var e;x.value&&(u.value=(e=Object.keys(x==null?void 0:x.value))==null?void 0:e[0])})),await v,m(),[v,m]=A(()=>D.fetchServices()),await v,m(),(e,s)=>{var r,I,S,n,T,B,U,P,K,Y,Z,ee,te,se,le,oe,ae,re;const i=ve,c=ue;return _(),d(E,null,[p(Oe),t("div",Ve,[(r=f.value)!=null&&r.ID?(_(),d(E,{key:0},[t("div",Re,[t("div",Ue,[t("div",Ne,[t("h1",Ae,a((I=f.value)==null?void 0:I.Name),1),Fe]),p(i)])]),p(we,{basic_title:"Выделенный сервер",modelValue:W.value,"onUpdate:modelValue":s[3]||(s[3]=l=>W.value=l)},{page:ce(()=>[t("div",Le,[t("div",$e,[t("div",Te,[t("div",Ke,[t("div",Me,[je,t("div",Ge,[(_(!0),d(E,null,M(_e(),l=>(_(),d("div",qe,[t("div",He,a(l.label),1),t("div",We,a(l.text),1)]))),256))])])])])])]),Xe,p(Ee,{title:"Оформление услуги",modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=l=>u.value=l)},null,8,["modelValue"]),p(Pe,{contractID:u.value,scheme:f.value,serviceID:"40000",isOrderID:!1,onSelect:ne,isBalancePay:F.value,"onUpdate:isBalancePay":s[1]||(s[1]=l=>F.value=l)},null,8,["contractID","scheme","isBalancePay"])]),services:ce(()=>{var l;return[p(xe,{modelValue:h.value,"onUpdate:modelValue":s[2]||(s[2]=N=>h.value=N),serviceSearchParams:{ServiceID:"40000",ServersGroupID:(l=f.value)==null?void 0:l.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]}),_:1},8,["modelValue"]),t("div",ze,[t("div",Je,[j(t("div",Qe,[((T=(n=(S=o.value)==null?void 0:S.discounts)==null?void 0:n.Bonuses)==null?void 0:T.length)>0?(_(),d(E,{key:0},[t("div",Ye,[Ze,t("div",et,a(y((B=o.value)==null?void 0:B.price))+" ₽",1)]),(_(!0),d(E,null,M((P=(U=o.value)==null?void 0:U.discounts)==null?void 0:P.Bonuses,l=>(_(),d("div",tt,[t("div",st,"Скидка "+a(l==null?void 0:l.Discount)+"% на "+a(l==null?void 0:l.Days)+" дней",1),t("div",lt,"-"+a(y(l==null?void 0:l.Economy))+" ₽",1)]))),256))],64)):ke("",!0),t("div",ot,[at,t("div",rt,a(L.value)+" ₽",1)]),(_(!0),d(E,null,M(h.value,l=>{var N;return _(),d("div",ct,[t("div",it,a((N=z.value[l==null?void 0:l.ServiceID])==null?void 0:N.Name),1),t("div",nt,a(J(l==null?void 0:l.Price))+" ₽",1)])}),256)),j(t("div",_t,[dt,t("div",ut,[t("span",null,[t("s",null,a(y((K=o.value)==null?void 0:K.price))+" ₽",1)]),t("span",vt,"-"+a(y($()))+" ₽",1)])],512),[[G,((ee=(Z=(Y=o.value)==null?void 0:Y.discounts)==null?void 0:Z.Bonuses)==null?void 0:ee.length)>0]]),j(t("div",mt,[t("div",pt,"Итого за "+a((te=o.value)==null?void 0:te.label),1),t("div",bt,a(y(((se=o.value)==null?void 0:se.price)-$()+ +L.value))+" ₽",1)],512),[[G,(le=o.value)==null?void 0:le.price]])],512),[[G,(oe=o.value)==null?void 0:oe.price]]),p(c,{class:"btn--wide",label:F.value||((ae=x.value[u.value])==null?void 0:ae.Balance)>y(((re=o.value)==null?void 0:re.price)-$()+ +L.value)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||u.value===null,"is-loading":R.value,onClick:s[4]||(s[4]=l=>Q())},null,8,["label","disabled","is-loading"])])])],64)):(_(),d("div",ht,[t("div",St,[p(ge,{label:"Сервер не найден"})])]))])],64)}}},Mt=me(Dt,[["__scopeId","data-v-593e9331"]]);export{Mt as default};
