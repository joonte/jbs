import{_ as G}from"./EmptyStateBlock-Dks67PsT.js";import{_ as q}from"./BlockAdditionalServices-BLZFm89Z.js";import{_ as K}from"./ButtonDefault-tVMF5ozh.js";import{_ as X}from"./StatusBadge-DroW9lKR.js";import{_ as z}from"./ClausesKeeper-DtaNhp0a.js";import{_ as J}from"./BlockBalanceAgreement-ckI0MbGb.js";import{c as _,b as D,a as t,i as k,t as S,w as L,G as Q,F as R,j as x,D as V,M as W,u as Y,x as Z,r as w,f as p,g as $,h as ee,d as re,o as c,e as U}from"./index-DxPA2ffO.js";import{u as te}from"./services-DjjrPMAb.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-9iQSFcL_.js";import"./ServiceListOrderSelection-DjdcJR5t.js";import"./BasicInput-DI25CRuk.js";import"./component-BeTqOa0q.js";import"./BlockSelectContract-Cef_Umis.js";import"./contracts-DD2O0C6m.js";import"./multiselect-DxJoM0Ze.js";import"./IconClose-Br7S99e8.js";const oe={async setup(){const A=$(),s=re(),v=W(),e=te(),u=Y(),m=Z("emitter");m.on("updateDSIDPage",()=>{u.fetchUserOrders()});const i=w([]),I=w(!0),h=w(!1),l=p(()=>v?.DSList?Object.keys(v.DSList).map(r=>v.DSList[r]).find(r=>r&&String(r.OrderID)===String(A.params.id)):null),g=p(()=>!l.value?.SchemeID||!v?.DSSchemes?null:v.DSSchemes[l.value.SchemeID]),y=p(()=>!l.value||!g.value?null:{ServiceID:l.value.ServiceID,ServersGroupID:g.value.ServersGroupID}),f=p(()=>e?.ServicesList||{}),o=p(()=>{if(!l.value?.OrderID||!u?.userOrders)return[];const r=l.value.OrderID;return Object.keys(u.userOrders).map(d=>u.userOrders[d]).filter(d=>d?.DependOrderID===r&&d?.ServiceID&&f.value[d.ServiceID]).sort((d,b)=>Number(d?.ID)-Number(b?.ID))}),C=p(()=>{if(!i.value||!Array.isArray(i.value))return 0;let r=0;return i.value.forEach(n=>{n&&typeof n.Price=="number"&&(r+=n.Price)}),P(r)});function B(r){i.value=r||[]}function P(r){return r==null?"0.00":Number(r).toFixed(2)||"0.00"}function T(r,n){let a="Orders";n==="50000"?a="ExtraIPOrders":n==="51000"?a="ISPswOrders":n==="52000"&&(a="DNSmanagerOrders"),m.emit("open-modal",{component:"StatusHistory",data:{modeID:a,rowID:r}})}function M(r){const n=Object.values(f.value).find(O=>O.ID===r);if(!n){s.push(`/AdditionalServices/${r}`);return}const a=n.Code;a==="Default"||a==="DNSmanager"||a==="ISPsw"||a==="ExtraIP"?s.push(`/AdditionalServices/${r}`):s.push(`/${a}Orders/${r}`)}async function F(){if(!(!i.value||!Array.isArray(i.value)||i.value.length===0))for(const r of i.value){if(!r)continue;let n="SUCCESS",a=f.value[r.ServiceID]?.Code;const O={Code:a,DependOrderID:l.value?.OrderID,...r,ContractID:l.value?.ContractID};try{const{result:d,info:b}=await e.ServiceOrder(O);if(d==="SUCCESS"){let E={};a==="Default"?E.ServiceOrderID=b?.ServiceOrderID:E[`${a}OrderID`]=b?.ServiceOrderID;const H=await e.ServiceOrderPay(a,E,{XMLHttpRequest:"yes"});let{result:N}=H;N==="SUCCESS"?(m.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),i.value=[],await u.fetchUserOrders(),s.push("/AdditionalServices")):N==="BASKET"&&s.push("/Basket")}else n="ERROR",m.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(d){console.error("Ошибка при заказе услуги:",d),n="ERROR",m.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(n==="ERROR")break}}async function j(){h.value=!0;try{await F()}catch(r){console.error("Ошибка при заказе услуг:",r),m.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{h.value=!1}}return ee(async()=>{try{await v.fetchDSOrders(),await v.fetchDSSchemes(),await e.fetchServices(),await u.fetchUserOrders()}catch(r){console.error("Ошибка загрузки данных:",r)}finally{I.value=!1}}),{getDSServerData:l,serviceSearchParams:y,selectedServices:i,getServices:f,orderedServices:o,ADDITIONAL_SERVICES_PRICE:C,handleServicesUpdate:B,setToFixedService:P,orderServices:j,isLoading:I,isOrderLoading:h,openHistoryStatuses:T,navigateToService:M}}},ae={class:"container"},ne={class:"section-header"},ie={key:0,class:"section-label"},ce={class:"section-nav"},le={key:0,class:"section-body"},de={class:"ordered-services-list"},_e={class:"ordered-service-header"},ve={class:"ordered-service-name"},Se={class:"ordered-service-status"},ue={class:"ordered-service-details"},me={class:"ordered-service-info"},De={key:0},fe={class:"ordered-service-actions"},pe={class:"section-body"},Ie={key:2,class:"loading"},he={key:0},ge={class:"container"},Oe={class:"total-block"},be={class:"total-block__row"},ke={class:"total-block__col"},ye={class:"total-block__col"},Ce={class:"total-block__col"},Ee={class:"total-block__row total-block__row--big"},Re={class:"total-block__col"};function we(A,s,v,e,u,m){const i=J,I=Q("router-link"),h=z,l=X,g=K,y=q,f=G;return c(),_(R,null,[D(i),t("section",null,[t("div",ae,[t("div",ne,[s[4]||(s[4]=t("h1",{class:"section-title"},"Дополнительные услуги",-1)),e.getDSServerData?(c(),_("div",ie,"Выделенный сервер # "+S(e.getDSServerData?.OrderID),1)):k("",!0),t("div",ce,[D(I,{class:"section-nav__item",to:`/DSOrders/${e.getDSServerData?.OrderID}`},{default:L(()=>s[2]||(s[2]=[U(" Сервер ",-1)])),_:1,__:[2]},8,["to"]),D(I,{class:"section-nav__item active",to:`/Services/${e.getDSServerData?.OrderID}`},{default:L(()=>s[3]||(s[3]=[U(" Услуги ",-1)])),_:1,__:[3]},8,["to"])])]),D(h),e.orderedServices&&e.orderedServices.length>0?(c(),_("div",le,[s[5]||(s[5]=t("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),t("div",de,[(c(!0),_(R,null,x(e.orderedServices,o=>(c(),_("div",{class:"ordered-service-item",key:o.ID},[t("div",_e,[t("div",ve,S(e.getServices[o?.ServiceID]?.Name||o?.ServiceName||`Услуга #${o?.ServiceID}`),1),t("div",Se,[D(l,{status:o?.StatusID,"status-table":"Orders",onClick:C=>e.openHistoryStatuses(o?.ID,o?.ServiceID)},null,8,["status","onClick"])])]),t("div",ue,[t("div",me,[t("span",null,"Заказ # "+S(o?.ID),1),o?.DaysRemainded?(c(),_("span",De," Осталось дней: "+S(o?.DaysRemainded),1)):k("",!0)])]),t("div",fe,[D(g,{class:"btn--sm",label:"Перейти к заказу",onClick:C=>e.navigateToService(o?.ID)},null,8,["onClick"])])]))),128))])])):k("",!0),t("div",pe,[e.getDSServerData&&e.serviceSearchParams?(c(),V(y,{key:0,modelValue:e.selectedServices,"onUpdate:modelValue":[s[0]||(s[0]=o=>e.selectedServices=o),e.handleServicesUpdate],"service-search-params":e.serviceSearchParams},null,8,["modelValue","service-search-params","onUpdate:modelValue"])):e.isLoading?(c(),_("div",Ie,"Загрузка...")):(c(),V(f,{key:1,label:"Заказ не найден"}))])])]),e.selectedServices&&e.selectedServices.length>0?(c(),_("section",he,[t("div",ge,[t("div",Oe,[t("div",be,[s[6]||(s[6]=t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),t("div",ke,S(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(c(!0),_(R,null,x(e.selectedServices,o=>(c(),_("div",{class:"total-block__row no-divider",key:o.ServiceID},[t("div",ye,S(e.getServices[o?.ServiceID]?.Name),1),t("div",Ce,S(e.setToFixedService(o?.Price))+" ₽",1)]))),128)),t("div",Ee,[s[7]||(s[7]=t("div",{class:"total-block__col"},"Итого к оплате",-1)),t("div",Re,S(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)])]),D(g,{class:"btn--wide",disabled:!e.selectedServices||e.selectedServices.length===0||e.isOrderLoading,"is-loading":e.isOrderLoading,label:"Заказать дополнительные услуги",onClick:s[1]||(s[1]=o=>e.orderServices())},null,8,["disabled","is-loading"])])])):k("",!0)],64)}const ze=se(oe,[["render",we],["__scopeId","data-v-d87fbb69"]]);export{ze as default};
