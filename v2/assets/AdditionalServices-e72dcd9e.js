import{k as Z,o as P,c as J,a as u,n as $,t as y,$ as z,aa as W,b as I,w as D,d as E,z as U,l as ee,F as te,p as he,m as Ce,_ as re,e as ae,g as ie,U as ce,r as C,h as H,i as ne,y as Pe,f as we,D as Be}from"./index-c781268b.js";import{u as le}from"./services-f889332c.js";import{u as de}from"./contracts-7e377877.js";import"./postings-8aa39eee.js";import{u as ue}from"./globalActions-bedd3c73.js";import{u as xe}from"./resetServer-bcdc43a0.js";import{f as se}from"./useTimeFunction-8602dd60.js";import{_ as _e}from"./IconCard-07d73f70.js";import{E as Q}from"./EmptyStateBlock-8165a481.js";import{S as me}from"./StatusBadge-499d8e7d.js";import{s as Ne}from"./servicesStatuses-6293b6ac.js";import{_ as Le}from"./HelperComponent-7ac34d9c.js";import{s as ve}from"./multiselect-9a74535b.js";import{_ as je,B as fe}from"./IconButtonBack-9fec81dc.js";import{f as Ve,z as Ee,k as Te,d as Ue,C as Ae}from"./bootstrap-vue-next.es-c86262f3.js";import{_ as Me}from"./IconDots-4f78eb4a.js";import{_ as He}from"./ClausesKeeper-5fae717f.js";import{_ as Re}from"./ButtonDefault-dafa6215.js";import{B as Ie}from"./BlockBalanceAgreement-1d554184.js";import{_ as ze}from"./IconArrow-8731a209.js";import"./IconClose-3fa8ed32.js";const We=[{key:"Several",label:"",variant:"",sortable:!1},{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"Scheme",label:"Тариф",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],A=v=>(he("data-v-7b702a7c"),v=v(),Ce(),v),Ge={class:"section-header"},Fe={class:"title__icon"},qe={class:"btn__group"},Ke={class:"group__several"},Xe=A(()=>u("span",{class:"td-mobile"},"Заказ",-1)),Je=["onClick"],Qe=A(()=>u("span",{class:"td-mobile"},"Договор",-1)),Ye=A(()=>u("span",{class:"td-mobile"},"Тариф",-1)),Ze=A(()=>u("span",{class:"td-mobile"},"Ключевые поля",-1)),$e={class:"key-field"},et={class:"key-field"},tt={class:"hosting-status__date"},nt=A(()=>u("span",{class:"td-mobile"},"Статус",-1)),ot=A(()=>u("span",{class:"td-mobile"},"Дата окончания",-1)),st=A(()=>u("span",{class:"td-mobile"},"Комментарий",-1)),rt={class:"service__controls-wrapper"},at=["onClick"],it={class:"btn btn--dots"};function ct(v,a,d,e,N,g){var R,G,F,q;const L=je,p=Re,w=fe,h=Ve,B=He,O=me,x=Z("Helper"),S=_e,j=Me,_=Z("router-link"),s=Ee,f=Te,V=Ue,l=Ae,M=Q;return P(),J(te,null,[u("div",Ge,[u("div",{class:$(["section-title__nowrap",e.isSeveral?"column":""])},[u("div",Fe,[u("h1",{class:"section-title",onClick:a[0]||(a[0]=t=>e.reloadNow())},y(e.isSeveral?"Продление услуг "+((R=d.sectionData)==null?void 0:R.Item):(G=d.sectionData)==null?void 0:G.Item),1),z(I(L,{onClick:a[1]||(a[1]=t=>e.outSeveralOrders())},null,512),[[W,e.isSeveral]])]),z(u("div",qe,[z(I(p,{class:"btn-several",label:"Продлить несколько заказов",onClick:a[2]||(a[2]=t=>e.prolongSeveralOrders())},null,512),[[W,d.sectionID==="50000"||d.sectionID==="51000"||d.sectionID==="52000"&&e.getOrders.length>1]]),I(p,{label:"Заказать",onClick:a[3]||(a[3]=t=>e.navigateToOrder())})],512),[[W,!e.isSeveral]]),z(u("div",Ke,[I(w,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":a[4]||(a[4]=t=>e.selectPeriod=t)},null,8,["modelValue"]),I(h,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":a[5]||(a[5]=t=>e.useBalance=t),name:"checkbox-balance"},{default:D(()=>[E("Использовать средства с баланса")]),_:1},8,["modelValue"]),I(p,{label:"Продлить",onClick:a[6]||(a[6]=t=>e.prolongOrders())})],512),[[W,e.isSeveral]])],2),I(B,{class:"additional-clauses",partition:`Header:${((F=d.sectionData)==null?void 0:F.Code)==="Default"?d.sectionID:`/${(q=d.sectionData)==null?void 0:q.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(P(),U(l,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":a[7]||(a[7]=t=>e.sortBy=t),"sort-desc":e.sortDesc,"onUpdate:sortDesc":a[8]||(a[8]=t=>e.sortDesc=t),onRowClicked:e.navigateToOrderPage,"sort-direction":e.sortDirection},{"cell(Several)":D(t=>[z(I(h,{id:"checkbox-"+t.index,modelValue:e.selectedRows[t.index],"onUpdate:modelValue":m=>e.selectedRows[t.index]=m,name:"checkbox-"+t.index},null,8,["id","modelValue","onUpdate:modelValue","name"]),[[W,e.isSeveral]])]),"cell(ID)":D(t=>[Xe,u("span",{class:"order-id",onClick:m=>e.toItem(t.value)},y(t.value),9,Je)]),"cell(ContractID)":D(t=>{var m,b;return[Qe,u("span",null,"#"+y((m=e.getContracts[t.value])==null?void 0:m.ID)+" / "+y((b=e.getContracts[t.value])==null?void 0:b.Customer),1)]}),"cell(Scheme)":D(t=>{var m;return[Ye,u("span",null,y((m=t.item)==null?void 0:m.SchemeName),1)]}),"cell(Keys)":D(t=>{var m,b,T,K;return[Ze,u("span",$e,y(((m=t.item)==null?void 0:m.Code)==="ISPsw"?e.findISPOrderIP((b=t.item)==null?void 0:b.ID):""),1),u("span",et,[E(y(e.findDomainByOrderID((T=t.item)==null?void 0:T.ID)),1),u("pre",tt,y(e.getTitleText((K=t.item)==null?void 0:K.ID)),1)])]}),"cell(StatusID)":D(t=>[nt,I(O,{class:"clickable-element",status:t.value,"status-table":"Orders",onClick:m=>{var b,T;return e.openHistoryStatuses((b=t.item)==null?void 0:b.ID,(T=t.item)==null?void 0:T.ServiceID)}},null,8,["status","onClick"])]),"cell(ExpirationDate)":D(t=>{var m,b;return[ot,u("span",null,y(e.calculateExpirationDate((m=t.item)==null?void 0:m.DaysRemainded))+" | "+y(((b=t.item)==null?void 0:b.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":D(t=>{var m;return[st,I(x,{class:"clickable-element","user-notice":t.value,id:(m=t.item)==null?void 0:m.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":D(t=>[u("div",rt,[u("div",{class:"btn btn--md btn--bold clickable-element",onClick:m=>e.handlePayment(t.item.ID,t.item.ServiceID,t.item.ContractID)},[I(S),E("Оплатить")],8,at),I(V,{class:"dropdown-dots",right:""},{"button-content":D(()=>[u("div",it,[I(j)])]),default:D(()=>[I(s,null,{default:D(()=>[I(_,{to:`/AdditionalServices/${t.item.ID}`},{default:D(()=>[E("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),I(s,{onClick:m=>e.transferItem(t.item.ID,t.item.ServiceID)},{default:D(()=>[E("Передать на другой аккаунт")]),_:2},1032,["onClick"]),d.sectionID==="51000"||d.sectionID==="52000"?(P(),U(s,{key:0,onClick:m=>e.orderManage(t.item.ID,t.item.ServiceID)},{default:D(()=>[E("Управлять заказом")]),_:2},1032,["onClick"])):ee("",!0),d.sectionID==="52000"?(P(),U(s,{key:1,onClick:m=>e.openPasswordChange(t.item.ID,t.item.ServiceID)},{default:D(()=>[E("Сменить пароль")]),_:2},1032,["onClick"])):ee("",!0),I(f),I(s,{class:"color-red",onClick:m=>v.$emit("deleteItem",t.item)},{default:D(()=>[E("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","onRowClicked","sort-direction"])):(P(),U(M,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const lt={components:{BlockSelectPeriod:fe,EmptyStateBlock:Q,StatusBadge:me,IconCard:_e,Helper:Le,Multiselect:ve},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],async setup(v){const a=ae(),d=ie(),e=ce("emitter"),N=C(!1),g=C("ID"),L=C(!0),p=C("desc"),w=C(!1),h=C([]),B=C(null),O=C(null),x=de(),S=le(),j=ue(),_=H(()=>S==null?void 0:S.DNSmanagerOrdersList),s=H(()=>S==null?void 0:S.ISPswOrdersList),f=H(()=>S==null?void 0:S.ExtraIPOrdersList);function V(){a.go(0)}async function l(){let r="";v.sectionID==="50000"?r="IP адресов":v.sectionID==="51000"?r="лицензии ISPsystem":v.sectionID==="52000"&&(r="вторичного DNS"),console.log(h.value);const o=X.value.filter((i,k)=>h.value[k]),n=o.map(i=>i.ID),c={ServiceID:v.sectionID,ItemsPay:O.value,OrdersIDs:n,...N.value&&{UseBalance:"yes"}};await j.OrdersPay(c).then(i=>{console.log(i),i==="Basket"?(console.log("Success"),a.push("/Basket")):(i==null?void 0:i.Status)==="Ok"&&(w.value=!1,e.emit("open-modal",{component:"BalanceProlong",data:{Service:r,Message:i==null?void 0:i.Message,Count:i==null?void 0:i.Count}}))}),console.log("Selected Orders:",o),console.log("_contract_select:",B.value),console.log("selectPeriod:",O.value)}function M(r){const o=_.value,n=String(r),c=Object.values(o).find(i=>String(i.OrderID)===n);return console.log(c),c}const R=H(()=>x==null?void 0:x.contractsList);function G(r,o,n){o==="50000"||o==="51000"||o==="52000"?oe(r,o):a.push(`/ServiceOrderPay/${r}`)}function F(r,o){console.log(r);const n=M(r);e.emit("open-modal",{component:"OrderPasswordChange",data:{OrderID:n.ID,ServiceID:o,emitEvent:"updateServicesList",Login:n.Login}})}function q(r,o){let n=null,c="";switch(o){case"50000":n=Object.entries(f.value).find(([i,k])=>k),c="ExtraIPOrders";break;case"51000":n=Object.entries(s.value).find(([i,k])=>k),c="ISPswOrders";break;case"52000":n=Object.entries(_.value).find(([i,k])=>k),c="DNSmanagerOrders";break;default:n=Object.entries(X.value).find(([i,k])=>k),c="Orders"}n&&e.emit("open-modal",{component:"StatusHistory",data:{modeID:c,rowID:n[1].ID}})}const t=r=>{const o=m(r);if(o){const n=o.split(","),c=n.length,i=n.join(`
`);return`Всего: ${c}
${i}`}return"Нет данных"},m=r=>{const o=Object.entries(_.value).reduce((n,[c,i])=>(n[c]=i,n),{});for(const n in o)if(Object.hasOwnProperty.call(o,n)){const c=o[n];if(String(c.OrderID)===String(r))return c.Parked}return null},b=r=>{const o=Object.entries(s.value).reduce((n,[c,i])=>(n[c]=i,n),{});for(const n in o)if(Object.hasOwnProperty.call(o,n)){const c=o[n];if(String(c.OrderID)===String(r))return c.IP}};function T(){w.value=!0}function K(){w.value=!1}function oe(r,o,n){o==="51000"?a.push(`/ISPswOrderPay/${r}`):o==="52000"?a.push(`/DNSmanagerOrderPay/${r}`):o==="50000"&&a.push(`/ExtraIPOrderPay/${r}`)}function Se(r,o,n){n.target.closest("button, a, .clickable-element")||a.push(`/AdditionalServices/${r.ID}`)}function ge(r){a.push(`/AdditionalServices/${r}`)}function ke(r,o){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:r,ServiceID:o}})}function Oe(r,o){let n;o==="51000"?n=Object.entries(s.value).reduce((i,[k,Y])=>(i[k]=Y,i),{}):o==="52000"&&(n=Object.entries(_.value).reduce((i,[k,Y])=>(i[k]=Y,i),{}));let c;for(const i in n)if(Object.hasOwnProperty.call(n,i)){const k=n[i];if(String(k.OrderID)===String(r)){c=k;break}}c&&j.OrderManageHosting({ServiceOrderID:c.ID,OrderID:r,ServiceID:o,XMLHttpRequest:"yes"})}const be=r=>{const o=Object.entries(_.value).reduce((n,[c,i])=>(n[c]=i,n),{});for(const n in o)if(Object.hasOwnProperty.call(o,n)){const c=o[n];if(String(c.OrderID)===String(r))return c.Domain}return null},X=H(()=>{var r,o;return(o=(r=Object.keys(d==null?void 0:d.userOrders).map(n=>{var c;return{...d==null?void 0:d.userOrders[n],ID:Number((c=d==null?void 0:d.userOrders[n])==null?void 0:c.ID)}}))==null?void 0:r.reverse())==null?void 0:o.filter(n=>n.ServiceID===(v==null?void 0:v.sectionID))});function ye(){a.push(`/AdditionalServicesOrder?ServiceID=${v==null?void 0:v.sectionID}`)}function pe(r){if(!r)return se(new Date);const o=new Date,n=new Date(o.getTime()+r*24*60*60*1e3);return se(n)}return ne(()=>{h.value=X.value.map(()=>!1)}),await S.fetchDNSmanagerOrders(),await S.fetchISPswOrders(),await S.fetchExtraIPOrders(),{authStore:d,getOrders:X,getContracts:R,sortBy:g,sortDesc:L,sortDirection:p,navigateToOrder:ye,servicesStatuses:Ne,oneTimeWorksFields:We,calculateExpirationDate:pe,getDNSmanagerOrders:_,findDomainByOrderID:be,findParkedByOrderID:m,getTitleText:t,transferItem:ke,orderManage:Oe,servicePay:oe,handlePayment:G,navigateToOrderPage:Se,openHistoryStatuses:q,toItem:ge,openPasswordChange:F,reloadNow:V,prolongSeveralOrders:T,isSeveral:w,selectedRows:h,_contract_select:B,selectPeriod:O,prolongOrders:l,outSeveralOrders:K,useBalance:N,findISPOrderIP:b}}},De=re(lt,[["render",ct],["__scopeId","data-v-7b702a7c"]]),dt={class:"section"},ut={class:"container"},_t={class:"section-header"},mt={class:"section-nav"},vt=["title","onClick"],ft={class:"multiselect-option"},It={class:"section-body"};function Dt(v,a,d,e,N,g){var O,x,S,j,_,s,f,V;const L=Ie,p=ze,w=Z("Multiselect"),h=De,B=Q;return P(),J(te,null,[I(L),u("div",dt,[u("div",ut,[u("div",_t,[u("div",mt,[(P(!0),J(te,null,Pe((O=e.getServices)==null?void 0:O.slice(0,e.visibleItemsCount),l=>{var M;return P(),J("div",{class:$(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(l==null?void 0:l.ID)}]),title:(M=e.getServerGroup(l==null?void 0:l.ServersGroupID))==null?void 0:M.Comment,onClick:R=>e.switchToSection(l==null?void 0:l.ID)},y(l==null?void 0:l.Item),11,vt)}),256)),((x=e.getServices)==null?void 0:x.length)>e.visibleItemsCount?(P(),U(w,{key:0,modelValue:e.section,"onUpdate:modelValue":a[0]||(a[0]=l=>e.section=l),class:$({"multiselect--white additional-service__select":!0,"additional-service__select_active":(j=e.getServices)==null?void 0:j.slice(e.visibleItemsCount,(S=e.getServices)==null?void 0:S.length).find(l=>(l==null?void 0:l.ID)===e.section)}),options:(s=e.getServices)==null?void 0:s.slice(e.visibleItemsCount,(_=e.getServices)==null?void 0:_.length),label:"ID",onSelect:a[1]||(a[1]=l=>e.switchToSection(l))},{option:D(({option:l})=>[u("div",ft,y(l==null?void 0:l.Item),1)]),caret:D(()=>[I(p,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):ee("",!0)])]),u("div",It,[(f=e.getServices)!=null&&f.find(l=>l.ID===e.section)?(P(),U(h,{key:0,sectionID:e.section,sectionData:(V=e.getServices)==null?void 0:V.find(l=>l.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(P(),U(B,{key:1,label:"Услуга не найдена"}))])])])],64)}const St={components:{ServiceListSection:De,emptyStateBlock:Q,Multiselect:ve,BlockBalanceAgreement:Ie},async setup(){const v=C(3);let a=()=>{window.innerWidth>=1920?v.value=9:window.innerWidth>=1600?v.value=7:window.innerWidth>=1440?v.value=6:window.innerWidth>=1200?v.value=5:window.innerWidth>=992?v.value=4:v.value=3};const d=we(),e=ae(),N=ce("emitter"),g=le(),L=xe();ue();const p=ie(),w=de(),h=C(null);N.on("updateUserOrdersList",()=>{p.fetchUserOrders()});const B=H(()=>{var _;return(_=Object.keys(g==null?void 0:g.ServicesList))==null?void 0:_.map(s=>{var f;return{...g==null?void 0:g.ServicesList[s],value:(f=g==null?void 0:g.ServicesList[s])==null?void 0:f.ID}}).filter(s=>(s==null?void 0:s.ServicesGroupID)!=="1000"&&(s==null?void 0:s.IsActive)&&!(s!=null&&s.IsHidden)).sort((s,f)=>Number(s==null?void 0:s.SortID)<Number(f==null?void 0:f.SortID)?-1:Number(s==null?void 0:s.SortID)>Number(f==null?void 0:f.SortID)?1:0)}),O=C(null);N.on("updateServicesList",()=>{p.fetchUserOrders()}),N.on("updateDNSManagerPage",()=>{g.fetchDNSmanagerOrders()});function x(_){e.replace(`/AdditionalServices?ServiceID=${_}`),O.value=_}function S(_){var s,f;return(f=(s=L==null?void 0:L.serverGroupsList)==null?void 0:s.ServersGroups)==null?void 0:f[_]}function j(_){N.emit("open-modal",{component:"DeleteItem",data:{id:_.ID,message:`Вы действительно хотите удалить заказ #${_.ID}?`,tableID:"Orders",successEmit:"updateUserOrdersList"}})}return ne(()=>{var _,s;(_=B.value)!=null&&_.find(f=>{var V;return(f==null?void 0:f.ID)===((V=d==null?void 0:d.query)==null?void 0:V.ServiceID)})?O.value=(s=d==null?void 0:d.query)==null?void 0:s.ServiceID:e.replace(`/AdditionalServices?ServiceID=${O.value}`)}),ne(()=>{window.addEventListener("resize",a),a()}),Be(()=>{window.removeEventListener("resize",a)}),await g.fetchServices().then(()=>{var _,s;O.value=(s=(_=B.value)==null?void 0:_[0])==null?void 0:s.ID}),await w.fetchContracts(),await p.fetchUserOrders(),await g.fetchDNSmanagerOrders(),await g.fetchISPswOrders(),await g.fetchExtraIPOrders(),{section:O,deleteItem:j,getServices:B,additionalServicesValue:h,switchToSection:x,getServerGroup:S,visibleItemsCount:v}}},Ht=re(St,[["render",Dt],["__scopeId","data-v-ba33f686"]]);export{Ht as default};
