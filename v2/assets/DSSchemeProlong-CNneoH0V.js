import{_ as T}from"./EmptyStateBlock-Dks67PsT.js";import{_ as V}from"./BlockOrderPayBalance-DhEnZ_L6.js";import{_ as j}from"./ClausesKeeper-DtaNhp0a.js";import{_ as M}from"./ButtonDefault-tVMF5ozh.js";import{_ as U}from"./BlockBalanceAgreement-ckI0MbGb.js";import{r as E,M as J,f as m,g as q,h as z,s as G,E as k,c as i,b as u,a as e,t as c,F as h,j as P,i as H,I as O,J as L,D as F,d as Q,o as a}from"./index-DxPA2ffO.js";import{u as W}from"./contracts-DD2O0C6m.js";import{g as X}from"./common-B12QeiN6.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-9iQSFcL_.js";import"./component-BeTqOa0q.js";import"./globalActions-DUlmxNCV.js";import"./IconHelp-D_mPG6iA.js";import"./IconClose-Br7S99e8.js";const Z={key:0,class:"domain-scheme"},ee={class:"section"},te={class:"container"},se={class:"section-header"},oe={class:"section-header__wrapper"},ae={class:"section-label"},le={class:"section"},ne={class:"container"},ce={class:"tw-p-3 md:tw-p-6 tw-border tw-border-gray-200 tw-rounded tw-mt-8"},ie={class:"tw-flex tw-flex-wrap tw-gap-6 tw-mt-2"},re={class:"tw-text-gray-500 tw-text-xs"},de={class:"tw-text-gray-800 tw-text-sm"},_e={key:0,class:"section"},ue={class:"container"},ve={class:"total-block"},me={class:"total-block__row divider-bottom"},pe={class:"total-block__col"},be={class:"total-block__col"},he={class:"total-block__col"},De={class:"total-block__row total-block__row--big economy-line"},ye={class:"total-block__col flex-col"},ke={class:"red"},fe={class:"total-block__row total-block__row--big"},Se={class:"total-block__col"},we={class:"total-block__col"},ge={key:1,class:"section"},Ie={class:"container"},xe={key:1,class:"section"},Be={class:"container"},Ce={__name:"DSSchemeProlong",async setup(Ee){let d,_;const t=E(null),r=J(),f=W(),S=q(),w=Q(),p=E(!1),l=m(()=>Object.keys(r?.DSList).map(s=>r?.DSList[s]).find(s=>s.OrderID===S.params.id)),v=m(()=>r?.DSSchemes?.[l.value?.SchemeID]),g=m(()=>f.contractsList),R=m(()=>{const s=r.DSSchemes?.[S.params.id];return s?X(s):[]}),I=s=>{s.key==="Enter"&&s.ctrlKey&&!$.value&&D()},$=m(()=>t.value===null||t.value?.price===null);z(()=>{document.addEventListener("keyup",I)}),G(()=>{document.removeEventListener("keyup",I)});function x(){let s=0;return t.value?.discounts?.Bonuses.map(o=>{s+=+o.Economy}),s}function b(s){return Number(s).toFixed(2)||0}function D(){p.value=!0,r.DSOrderPay({DSOrderID:l.value?.ID,DaysPay:t.value?.actualDays,IsChange:!0}).then(s=>{let{result:o,error:B}=s;o==="SUCCESS"?w.push("/DSOrders"):o==="BASKET"&&w.push("/Basket"),p.value=!1})}function N(s){t.value=s}return[d,_]=k(()=>r.fetchDSOrders()),await d,_(),[d,_]=k(()=>r.fetchDSSchemes()),await d,_(),[d,_]=k(()=>f.fetchContracts()),await d,_(),(s,o)=>{const B=U,C=M,A=j,K=V,y=T;return a(),i(h,null,[u(B),l.value?.ID&&v.value?.ID?(a(),i("div",Z,[e("div",ee,[e("div",te,[e("div",se,[e("div",oe,[o[2]||(o[2]=e("h1",{class:"section-title"},"Оплата заказа выделенного сервера",-1)),u(C,{class:"btn--wide",label:g.value[l.value?.ContractID]?.Balance>t.value?.price?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||t.value?.price===null,"is-loading":p.value,onClick:o[0]||(o[0]=n=>D())},null,8,["label","disabled","is-loading"])]),e("div",ae,c(l.value?.IP?`#${l.value?.IP}`:""),1)]),u(A)])]),e("div",le,[e("div",ne,[e("div",ce,[o[3]||(o[3]=e("div",{class:"tw-text-2xl"},"Конфигурация",-1)),e("div",ie,[(a(!0),i(h,null,P(R.value,n=>(a(),i("div",{class:"tw-space-y-1",key:n.label},[e("div",re,c(n.label),1),e("div",de,c(n.text),1)]))),128))])])])]),u(K,{contractID:l.value?.ContractID,scheme:v.value,serviceID:"40000",daysRemainded:l.value?.DaysRemainded,isOrderID:!0,orderID:l.value?.OrderID,onSelect:N},null,8,["contractID","scheme","daysRemainded","orderID"]),v.value?.IsPayed&&v.value?.IsProlong||!v.value?.IsPayed?(a(),i("div",_e,[e("div",ue,[e("div",ve,[t.value?.discounts?.Bonuses?.length>0?(a(),i(h,{key:0},[e("div",me,[o[4]||(o[4]=e("div",{class:"total-block__col"},"Цена тарифа",-1)),e("div",pe,c(b(t.value?.price))+" ₽",1)]),(a(!0),i(h,null,P(t.value?.discounts?.Bonuses,n=>(a(),i("div",{class:"total-block__row no-divider",key:n?.Discount+"-"+n?.Days},[e("div",be,"Скидка "+c(n?.Discount)+"% на "+c(n?.Days)+" дней",1),e("div",he,"-"+c(b(n?.Economy))+" ₽",1)]))),128))],64)):H("",!0),O(e("div",De,[o[5]||(o[5]=e("div",{class:"total-block__col red"},"Выгода",-1)),e("div",ye,[e("span",null,[e("s",null,c(b(t.value?.price))+" ₽",1)]),e("span",ke,"-"+c(x())+" ₽",1)])],512),[[L,t.value?.discounts?.Bonuses?.length>0]]),O(e("div",fe,[e("div",Se,"Итого за "+c(t.value?.label),1),e("div",we,c(b(t.value?.price-x()))+" ₽",1)],512),[[L,t.value?.price]])]),u(C,{class:"btn--wide",label:g.value[l.value?.ContractID]?.Balance>t.value?.price?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||t.value?.price===null,"is-loading":p.value,onClick:o[1]||(o[1]=n=>D())},null,8,["label","disabled","is-loading"])])])):(a(),i("div",ge,[e("div",Ie,[u(y,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(a(),i("div",xe,[e("div",Be,[l.value?.ID?(a(),F(y,{key:0,label:"Заказ не может быть продлен"})):(a(),F(y,{key:1,label:"Заказ не найден"}))])]))],64)}}},Je=Y(Ce,[["__scopeId","data-v-fb5c9255"]]);export{Je as default};
