import{_ as de,r as N,h as R,i as ae,o as D,c as v,a as c,t as p,m as ce,k as C,p as re,l as ie,j as ue,b as Y,y as ee,w as le,F as K,x as $,d as q,Z as De,af as fe,f as _e,e as ve,a7 as Se,S as he,g as b,O as Oe}from"./index-6f846e0d.js";import{u as ye}from"./contracts-b643bcd5.js";import{u as Ie}from"./domain-67490636.js";import{u as ke}from"./services-5cbecf62.js";import{s as be}from"./multiselect-265f6f4c.js";import{_ as Ce}from"./ButtonDefault-40efcd87.js";import{_ as pe}from"./BasicInput-2f6a9161.js";import{_ as ge}from"./BlockSelectContract-579fe474.js";import{_ as Ve}from"./ClausesKeeper-3ae27028.js";const me={props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(d,{emit:u}){const r=N(null);function a(){u("update:modelValue",d.data)}return R(d,()=>{r.value=d.modelValue}),ae(()=>{r.value=d.modelValue}),{updateValue:a,inputValue:r}}},Ne=d=>(re("data-v-414dbe12"),d=d(),ie(),d),Pe={class:"form-input_border"},Be=["checked","name","type"],Ee={class:"form-input_border-content"},je=Ne(()=>c("span",{class:"form-input_border-mark"},null,-1)),we={class:"form-input_border-item form-input_border-item--left"},Ae={class:"form-input_border-item form-input_border-item--right"};function xe(d,u,r,a,W,h){var P,s,E;return D(),v("label",Pe,[c("input",{checked:((P=a.inputValue)==null?void 0:P.value)===((s=r.data)==null?void 0:s.value),name:r.name,type:r.checkbox?"checkbox":"radio",onInput:u[0]||(u[0]=(...m)=>a.updateValue&&a.updateValue(...m))},null,40,Be),c("span",Ee,[je,c("span",we,p((E=r.data)==null?void 0:E.name),1),r.data.price?ce(d.$slots,"default",{key:0},()=>{var m;return[c("span",Ae,p((m=r.data)==null?void 0:m.price),1)]},!0):C("",!0)])])}const se=de(me,[["render",xe],["__scopeId","data-v-414dbe12"]]),ne=d=>(re("data-v-e3ee3669"),d=d(),ie(),d),Fe={key:0,class:"section"},Ue={class:"section-header"},Le={key:2,class:"form-field form-field--basic"},Me=ne(()=>c("div",{class:"form-field__label"},[q("IP адрес лицензии"),c("span",null,"*")],-1)),Te={class:"form-field-input__wrapper"},Ke={key:3,class:"form-field form-field--basic"},Re=ne(()=>c("div",{class:"form-field__label"},[q("Выбрать заказ"),c("span",null,"*")],-1)),qe={class:"form-field-input__wrapper"},We={class:"multiselect-option"},He={class:"form-field form-field--basic"},Ze={class:"form-field__label"},ze={key:0},Ge={class:"form-field-input__wrapper"},Je=["title","name","onUpdate:modelValue"],Qe={key:5,class:"section"},Xe={class:"list"},Ye={class:"list-col list-col--md"},$e=ne(()=>c("div",{class:"list-item__title"},[q("Тариф"),c("span",null,"*")],-1)),ea={key:6,class:"section"},aa={class:"list"},na={class:"list-col list-col--md"},ta={class:"list-item__title"},oa={key:0},la={class:"list-item__prompt"},da={key:7,class:"section"},ra={class:"total-block block--divider"},ia={class:"total-block__row total-block__row--big"},sa={class:"total-block__col"},ca={key:8,class:"additional-service__inline-price"};function ua(d,u,r,a,W,h){var x,y,H,Z,z,j,F,U,G,J,L,Q,M,w;const P=Ve,s=ge,E=pe,m=ue("Multiselect"),A=se,O=Ce;return D(),v(K,null,[r.isInline?C("",!0):(D(),v("div",Fe,[c("div",Ue,[c("h1",{class:"section-title",onClick:u[0]||(u[0]=l=>a.reloadNow())},p((x=r.sectionData)==null?void 0:x.Item),1),Y(P,{partition:`Header:${((y=r.sectionData)==null?void 0:y.Code)==="Default"?r.sectionID:`/${(H=r.sectionData)==null?void 0:H.Code}Orders`}`},null,8,["partition"])])])),r.isInline?C("",!0):(D(),ee(s,{key:1,class:"additional-service__contract-select",title:"Договор",modelValue:a.contractSelect,"onUpdate:modelValue":u[1]||(u[1]=l=>a.contractSelect=l)},null,8,["modelValue"])),a.DependOrderID==="0"&&r.sectionID==="51000"?(D(),v("div",Le,[Me,c("div",Te,[Y(E,{name:"ServiceIP",placeholder:"0.0.0.0",modelValue:a.serviceIP,"onUpdate:modelValue":u[2]||(u[2]=l=>a.serviceIP=l)},null,8,["modelValue"])])])):C("",!0),((Z=a.getDependOrders)==null?void 0:Z.length)>0?(D(),v("div",Ke,[Re,c("div",qe,[Y(m,{class:"multiselect--white",placeholder:"Все заказы",label:"name","track-by":"value",options:a.getDependOrders,modelValue:a.DependOrderID,"onUpdate:modelValue":u[3]||(u[3]=l=>a.DependOrderID=l)},{option:le(({option:l})=>[c("div",We,p(l.name),1)]),_:1},8,["options","modelValue"])])])):C("",!0),((z=a.getInputFields)==null?void 0:z.length)>0?(D(!0),v(K,{key:4},$(a.getInputFields,l=>(D(),v("div",He,[c("div",Ze,[q(p(l==null?void 0:l.Name),1),l!=null&&l.IsDuty?(D(),v("span",ze,"*")):C("",!0)]),c("div",Ge,[De(c("input",{title:l==null?void 0:l.Prompt,name:`ID${l==null?void 0:l.ID}`,"onUpdate:modelValue":g=>a.formData[`ID${l==null?void 0:l.ID}`]=g},null,8,Je),[[fe,a.formData[`ID${l==null?void 0:l.ID}`]]])])]))),256)):C("",!0),((j=r.sectionData)==null?void 0:j.Code)!=="Default"&&((F=a.getAdditionalServicesSchemes)==null?void 0:F.length)>0?(D(),v("div",Qe,[c("div",Xe,[c("div",Ye,[$e,(D(!0),v(K,null,$(a.getAdditionalServicesSchemes,l=>{var g,B;return D(),ee(A,{name:`${(g=r.sectionData)==null?void 0:g.Code}SchemeID`,checkbox:!1,data:l,modelValue:a.formData[`${(B=r.sectionData)==null?void 0:B.Code}SchemeID`],"onUpdate:modelValue":u[4]||(u[4]=T=>{var t;return a.formData[`${(t=r.sectionData)==null?void 0:t.Code}SchemeID`]=T}),disabled:a.isDepend()},null,8,["name","data","modelValue","disabled"])}),256))])])])):C("",!0),((U=a.getSelectFields)==null?void 0:U.length)>0?(D(),v("div",ea,[c("div",aa,[(D(!0),v(K,null,$(a.getSelectFields,l=>(D(),v("div",na,[c("div",ta,[q(p(l==null?void 0:l.Name),1),l!=null&&l.IsDuty?(D(),v("span",oa,"*")):C("",!0)]),(D(!0),v(K,null,$(a.getSelectFieldOptions(l),g=>(D(),ee(A,{name:`ID${l==null?void 0:l.ID}`,checkbox:!1,data:g,modelValue:a.formData[`ID${l==null?void 0:l.ID}`],"onUpdate:modelValue":B=>a.formData[`ID${l==null?void 0:l.ID}`]=B},{default:le(()=>[c("div",la,p(l==null?void 0:l.Prompt),1)]),_:2},1032,["name","data","modelValue","onUpdate:modelValue"]))),256))]))),256))])])):C("",!0),r.isInline?(D(),v("div",ca,p(a.finalPrice()||0)+" ₽",1)):(D(),v("div",da,[c("div",ra,[c("div",ia,[c("div",sa,"Итого за 1 "+p(((G=r.sectionData)==null?void 0:G.ID)==="50000"||((J=r.sectionData)==null?void 0:J.ID)==="51000"||((L=r.sectionData)==null?void 0:L.ID)==="52000"?"месяц":(Q=r.sectionData)==null?void 0:Q.Measure),1),c("div",{class:"total-block__col",onClick:u[5]||(u[5]=l=>console.log(a.contractSelect))},p(a.finalPrice()||0)+" ₽",1)])]),Y(O,{class:"btn--wide",disabled:a.getButtonDisableCondition||!a.formData[`${r.sectionData.Code}SchemeID`]&&((M=r.sectionData)==null?void 0:M.Code)!=="Default",label:parseFloat((w=a.getContracts[a.contractSelect])==null?void 0:w.Balance)>parseFloat(a.finalPrice())?"Оплатить c баланса договора":"Заказать","is-loading":a.isLoading,onClick:u[6]||(u[6]=l=>a.payForOrder())},null,8,["disabled","label","is-loading"])]))],64)}const Da={components:{InputBorderCheckboxRadio:se,Multiselect:be},props:{modelValue:{type:Object,default:()=>{}},sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},emits:["updateList","update:modelValue"],setup(d,{emit:u}){const r=ye(),a=ke();_e();const W=Ie(),h=ve(),P=Se(),s=N({}),E=N(null),m=N(null),A=N(null),O=N(""),x=N(null),y=N(!1);he("emitter");const H=b(()=>r==null?void 0:r.contractsList);b(()=>a.ServicesList),b(()=>W.domainsList);const Z=b(()=>{var t,o;return(o=Object.keys((a==null?void 0:a.additionalServicesScheme[(t=d.sectionData)==null?void 0:t.Code])||{}))==null?void 0:o.map(e=>{var f,V,I,_,S,k,X,te,oe;const n=((V=a==null?void 0:a.additionalServicesScheme[(f=d.sectionData)==null?void 0:f.Code][e])==null?void 0:V.DependOrders)||{},i=Object.keys(n);return{...a==null?void 0:a.additionalServicesScheme[(I=d.sectionData)==null?void 0:I.Code][e],value:(S=a==null?void 0:a.additionalServicesScheme[(_=d.sectionData)==null?void 0:_.Code][e])==null?void 0:S.ID,price:(X=a==null?void 0:a.additionalServicesScheme[(k=d.sectionData)==null?void 0:k.Code][e])==null?void 0:X.CostMonth,name:(oe=a==null?void 0:a.additionalServicesScheme[(te=d.sectionData)==null?void 0:te.Code][e])==null?void 0:oe.Name,dependOrders:i}}).sort((e,n)=>Number(e==null?void 0:e.SortID)<Number(n==null?void 0:n.SortID)?-1:Number(e==null?void 0:e.SortID)>Number(n==null?void 0:n.SortID)?1:0).filter(e=>O.value==="0"?(e==null?void 0:e.IsActive)&&e.dependOrders.length===0:O.value===null||O.value===""?e==null?void 0:e.IsActive:(e==null?void 0:e.IsActive)&&e.dependOrders.includes(O.value))}),z=b(()=>{var o;let t=!1;return(o=F.value)==null||o.forEach(e=>{e!=null&&e.IsDuty&&(s.value[`ID${e==null?void 0:e.ID}`]===null||s.value[`ID${e==null?void 0:e.ID}`]===void 0||s.value[`ID${e==null?void 0:e.ID}`]==="")&&(t=!0)}),t}),j=b(()=>{var t;return(t=d.sectionData)==null?void 0:t.ServicesFields.filter(o=>(o==null?void 0:o.TypeID)==="Select").sort((o,e)=>Number(o==null?void 0:o.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),F=b(()=>{var t;return(t=d.sectionData)==null?void 0:t.ServicesFields.filter(o=>(o==null?void 0:o.TypeID)==="Input").sort((o,e)=>Number(o==null?void 0:o.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),U=b(()=>{var f,V,I;let t=[];const o=a==null?void 0:a.additionalServicesScheme[(f=d.sectionData)==null?void 0:f.Code];if(((V=d.sectionData)==null?void 0:V.Code)==="Default"){const _=(I=Object.keys(a==null?void 0:a.ServicesList))==null?void 0:I.map(S=>{var k;return{...a==null?void 0:a.ServicesList[S],value:(k=a==null?void 0:a.ServicesList[S])==null?void 0:k.ID}}).filter(S=>(S==null?void 0:S.ID)===P.query.ServiceID);if(_.length>0){const S=_[0].DependOrders;S&&(t=Object.entries(S).map(([k,X])=>({name:X,value:k})))}return t}if(!o)return t;const e=Object.values(o).filter(_=>(_==null?void 0:_.IsActive)&&(_==null?void 0:_.DependOrders)).flatMap(_=>Object.entries(_.DependOrders)),n=new Map;e.forEach(([_,S])=>{const k=`${_}:${S}`;n.has(k)||n.set(k,{name:S,value:_})});const i=Array.from(n.values());return d.sectionID==="51000"?t=[{name:"Без заказа",value:"0"},...i]:t=i,t}),G=b(()=>{var e;const t=a==null?void 0:a.additionalServicesScheme[(e=d.sectionData)==null?void 0:e.Code];return t?Object.values(t).filter(n=>(n==null?void 0:n.IsActive)&&(n==null?void 0:n.DependOrders)).flatMap(n=>Object.entries(n.DependOrders)).map(([n,i])=>({name:i,value:n})):[]}),J=b(()=>{var n,i,f;const t=(i=s.value[`${(n=d.sectionData)==null?void 0:n.Code}SchemeID`])==null?void 0:i.ID,o=a==null?void 0:a.additionalServicesScheme[(f=d.sectionData)==null?void 0:f.Code];if(!t)return G.value;const e=o==null?void 0:o[t];return e&&e.DependOrders?Object.entries(e.DependOrders).map(([V,I])=>({name:I,value:V})):[]});R(()=>d.sectionID,()=>{O.value=""});const L=t=>{t.key==="Enter"&&t.ctrlKey&&g()};ae(()=>{document.addEventListener("keyup",L)}),Oe(()=>{document.removeEventListener("keyup",L)});function Q(){h.go(0)}function M(){var o,e;let t=0;return Object.keys(s.value).map(n=>{var i,f;(i=s.value[n])!=null&&i.price&&(t=t+Number((f=s.value[n])==null?void 0:f.price))}),t+Number((o=d.sectionData)==null?void 0:o.Cost)+Number((e=d.sectionData)==null?void 0:e.CostOn)}function w(t){var o,e;return(e=(o=t==null?void 0:t.Options)==null?void 0:o.split(`
`))==null?void 0:e.map(n=>{let i=n.split("=");return{value:i[0],name:i[1],price:i[2]}})}function l(){return d.sectionID==="50000"&&U.value.length<1}function g(){var o;y.value=!0;let t={};(o=Object.keys(s.value))==null||o.forEach(e=>{var n,i;t[e]=(n=s.value[e])!=null&&n.value?(i=s.value[e])==null?void 0:i.value:s.value[e]}),t.ContractID=A.value,t.ServiceID=d.sectionID,t.DependOrderID=O.value,O.value==="0"&&(t.IP=x.value),d.sectionID==="50000"?a.ExtraIPOrder(t).then(({result:e,info:n,error:i})=>{y.value=!1,e==="SUCCESS"?h.push(`/ExtraIPOrderPay/${n.OrderID}`):e==="BASKET"&&h.push("/Basket")}):d.sectionID==="51000"?a.ISPswOrder(t).then(({result:e,info:n})=>{y.value=!1,e==="SUCCESS"?h.push(`/ISPswOrderPay/${n.OrderID}`):e==="BASKET"&&h.push("/Basket")}):d.sectionID==="52000"?a.DNSmanagerOrder(t).then(({result:e,info:n,error:i})=>{y.value=!1,e==="SUCCESS"?h.push(`/DNSmanagerOrderPay/${n.OrderID}`):e==="BASKET"&&h.push("/Basket")}):a.ServiceOrder(t).then(({result:e,info:n,error:i})=>{var f;e==="SUCCESS"?a.ServiceOrderPay((f=d.sectionData)==null?void 0:f.Code,{AmountPay:"1",ServiceOrderID:n==null?void 0:n.ServiceOrderID,IsChange:!0}).then(V=>{let{result:I,error:_}=V;I==="SUCCESS"?h.push(`/AdditionalServices?ServiceID=${d.sectionID}`):I==="BASKET"&&h.push("/Basket"),y.value=!1}):y.value=!1})}function B(){var o;let t={};(o=Object.keys(s.value))==null||o.forEach(e=>{var n,i;t[e]=(n=s.value[e])!=null&&n.value?(i=s.value[e])==null?void 0:i.value:s.value[e]}),t.ServiceID=d.sectionID,t.Price=M(),u("update:modelValue",t)}function T(){var t,o;if(d.modelValue){const e=(t=Object.keys(d.modelValue))==null?void 0:t.find(n=>n.includes("SchemeID"));e&&((o=s.value[e])!=null&&o.ID||(s.value[e]={}),s.value[e].ID=d.modelValue[e])}}return R(P,()=>{var t,o,e;T(),d.updateWithPageTransition&&((t=j.value)==null||t.forEach(n=>{var i;s.value[`ID${n==null?void 0:n.ID}`]&&(s.value[`ID${n==null?void 0:n.ID}`]=(i=w(n))==null?void 0:i.find(f=>f.value===(n==null?void 0:n.Default)))}),((o=d.sectionData)==null?void 0:o.Code)!=="Default"&&a.fetchAdditionalServiceScheme((e=d.sectionData)==null?void 0:e.Code))}),R(s.value,()=>{B()}),R(d,()=>{T()}),ae(async()=>{var t,o,e;(t=j.value)==null||t.forEach(n=>{var i;s.value[`ID${n==null?void 0:n.ID}`]=(i=w(n))==null?void 0:i.find(f=>f.value===(n==null?void 0:n.Default))}),((o=d.sectionData)==null?void 0:o.Code)!=="Default"&&await a.fetchAdditionalServiceScheme((e=d.sectionData)==null?void 0:e.Code),await W.fetchDomains(),T(),B()}),{contractSelect:A,contractsStore:r,getSelectFields:j,getInputFields:F,selectServerModel:E,isLoading:y,getButtonDisableCondition:z,getAdditionalServicesSchemes:Z,getSelectFieldOptions:w,getDependOrders:U,DependOrderID:O,operationSystem:m,formData:s,finalPrice:M,payForOrder:g,filteredDependOrders:J,serviceIP:x,isDepend:l,reloadNow:Q,getContracts:H}}},ba=de(Da,[["render",ua],["__scopeId","data-v-e3ee3669"]]);export{ba as S};
