import{a as st,L as Y,v as nt,r as at,m as lt}from"./bootstrap-vue-next-W16P-SAV.js";import{s as rt}from"./multiselect-DElL0Rlw.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as f,m as U,o as y,c as O,b as l,w as s,a as e,t as d,v as $,h as A,ao as z,x as M,f as T,M as ct,d as J,G as it,C as H,e as L,E as G,F as ut,i as pt}from"./index-Codq73aV.js";import{_ as K}from"./StatusBadge-BmqDrHzy.js";import{u as j}from"./index-BO2gwtUe.js";import{t as Q,f as dt}from"./common-DyknwSqv.js";import{_ as mt}from"./IconDots-BIoh_VC5.js";import{_ as _t}from"./IconCard-C_8uFbeS.js";import{f as ft,s as vt}from"./time-DenPiOX5.js";import{_ as bt}from"./FormInputSearch-B47bjFcn.js";import{_ as gt}from"./ClausesKeeper-iUM0yapS.js";import{_ as Ct}from"./PageTitle-DuPth6-d.js";import{_ as yt}from"./BlueButton.vue_vue_type_script_setup_true_lang-BKdLNEec.js";import{_ as It}from"./FormTabs-VAJ6xXlq.js";import{_ as kt}from"./BlockBalanceAgreement-v_bWuiVT.js";import"./IconPlus-Bm8D3Wgq.js";import"./IconClose-Dia1noy8.js";import"./ButtonDefault-CMw2aBy6.js";const Dt={key:0,class:"table-controls"},$t={class:"multiselect-multiple-label"},Tt={class:"multiselect-option"},St={__name:"PaginationBlock",props:["modelValue","total_rows"],emits:["update:modelValue","updatePage"],setup(I,{emit:_}){const m=I,v=_,g=[10,25,50,100],c=f({current_page:1,per_page:10});return U(c.value,()=>{v("updatePage",c.value)}),(k,u)=>{const p=st;return m.total_rows>0?(y(),O("div",Dt,[l(p,{modelValue:c.value.current_page,"onUpdate:modelValue":u[0]||(u[0]=r=>c.value.current_page=r),"total-rows":m.total_rows,"per-page":c.value.per_page,"first-number":"","last-number":""},{"first-text":s(()=>u[3]||(u[3]=[e("span",{class:"text-success"},"First",-1)])),"last-text":s(()=>u[4]||(u[4]=[e("span",{class:"text-info"},"Last",-1)])),page:s(({page:r,active:C})=>[e("span",null,d((r-1)*c.value.per_page+1)+"-"+d(r*c.value.per_page),1)]),_:1},8,["modelValue","total-rows","per-page"]),l($(rt),{class:"multiselect--white",modelValue:c.value.per_page,"onUpdate:modelValue":u[1]||(u[1]=r=>c.value.per_page=r),options:g,label:"name",openDirection:"top",onInput:u[2]||(u[2]=r=>c.value.current_page=1)},{singlelabel:s(({value:r})=>[e("div",$t,[e("span",null,"Отображать "+d(r.value)+" строк",1)])]),option:s(({option:r})=>[e("div",Tt,"Отображать "+d(r.name)+" строк",1)]),_:1},8,["modelValue"])])):A("",!0)}}},W=F(St,[["__scopeId","data-v-82523ca8"]]),Lt=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"Name",label:"Профиль",variant:"td-blue"},{key:"TemplateID",label:"Тип",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",sortable:!0,variant:"td-gray td-order"},{key:"StatusDate",label:"От статуса",sortable:!0,variant:"td-default td-order"}],Pt={class:"contracts-profile-list"},wt={class:"d-block"},xt={class:"d-block"},Bt={__name:"ContractsProfileList",props:["search"],setup(I){const _=I,m=j(),v=z(),g=M("emitter"),c=f("ID"),k=f(!0),u=f("desc"),p=f(10),r=f(1),C=T(()=>Object?.keys(m?.profileList)?.map(i=>m?.profileList[i])?.reverse()),P=T(()=>v.data.Profiles?.Templates),w=T(()=>C.value.filter(i=>i.Name.toLowerCase().includes(_.search?.toLowerCase()||""))?.length);function B(i={}){p.value=i?.per_page,r.value=i?.current_page}function x(i,n){n.target.closest("button, a, .clickable-element")||g.emit("open-modal",{component:"ProfileInfo",data:{data:i,template:P.value[i.TemplateID]}})}function b(i){const n=Math.floor((Date.now()-i*1e3)/864e5);return n<0?0:n}function V(i){g.emit("open-modal",{component:"StatusHistory",data:{modeID:"Profiles",rowID:i}})}return(i,n)=>{const N=K,h=Y,a=W;return y(),O("div",Pt,[l(h,{class:"basic-table",items:C.value,fields:$(Lt),"show-empty":!0,filterable:[],filter:_.search,"per-page":p.value,"sort-desc":k.value,"onUpdate:sortDesc":n[0]||(n[0]=t=>k.value=t),"sort-by":c.value,"onUpdate:sortBy":n[1]||(n[1]=t=>c.value=t),"sort-direction":u.value,"current-page":r.value,"empty-text":"У вас пока нет профилей.","empty-filtered-text":"Профили не найдены.",onRowClicked:n[2]||(n[2]=(t,E,D)=>x(t,D))},{"cell(ID)":s(t=>[n[3]||(n[3]=e("span",{class:"td-mobile"},"Номер",-1)),e("span",wt,d($(Q)(t.item?.ID)),1)]),"cell(Name)":s(t=>[n[4]||(n[4]=e("span",{class:"td-mobile"},"Номер",-1)),e("span",null,d(t.item?.Name),1)]),"cell(StatusDate)":s(t=>[n[5]||(n[5]=e("span",{class:"td-mobile"},"От статуса",-1)),e("span",xt,d(b(t.item?.StatusDate))+" дн.",1)]),"cell(TemplateID)":s(t=>[n[6]||(n[6]=e("span",{class:"td-mobile"},"Тип",-1)),e("span",null,d(P.value[t.item?.TemplateID]?.Name),1)]),"cell(StatusID)":s(t=>[l(N,{class:"clickable-element tw-cursor-pointer",status:t.value,"status-table":"Profiles",onClick:E=>V(t.item?.ID)},null,8,["status","onClick"])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(a,{total_rows:w.value,onUpdatePage:B},null,8,["total_rows"])])}}},Vt=F(Bt,[["__scopeId","data-v-709c8ed3"]]),Nt={},ht={class:"button-payment"},Et={class:"button-payment__text"};function Ft(I,_){const m=_t;return y(),O("button",ht,[l(m,{class:"button-payment__icon"}),e("span",Et,[ct(I.$slots,"default",{},void 0,!0)])])}const Ot=F(Nt,[["render",Ft],["__scopeId","data-v-32f28506"]]),Ht=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"Customer",label:"Договор"},{key:"TypeID",label:"Тип",variant:"td-gray td-order"},{key:"Orders",label:"Количество подключенных услуг",sortable:!0,variant:"td-gray td-order"},{key:"Balance",label:"Баланс",sortable:!0,variant:"td-gray td-order"},{key:"IsHidden",label:"Скрыт ?",variant:"td-gray td-order"},{key:"Status",label:"Статус",variant:"td-gray td-order"},{key:"controls",label:"",variant:"td-controls"}],Rt={class:"contracts-list"},Ut={class:"td-column-heavy"},At=["onClick"],Mt={class:"d-block"},jt={class:"td-column-heavy"},qt={class:"table-td-blue"},Gt=["onClick"],Yt={class:"btn__group"},zt={class:"dropdown-button"},Jt={class:"btn btn--dots"},Kt={__name:"ContractsList",props:{search:{type:String,default:""}},setup(I){const _=J(),m=I,v=j(),g=z(),c=M("emitter"),k=f("CreateDate"),u=f(!0),p=f("desc"),r=f(10),C=f(1),P=a=>{v.booleanEdit({TableID:"Contracts",ColumnID:"IsHidden",RowID:a.ID}).then(()=>{v.fetchContracts()})},w=T(()=>Object.keys(v?.contractsList)?.map(a=>v?.contractsList[a])?.reverse()),B=T(()=>g.data.Contracts?.Types),x=T(()=>w.value.filter(a=>a.Customer.toLowerCase().includes(m.search?.toLowerCase()||""))?.length);function b(a){c.emit("open-modal",{component:"StatusHistory",data:{modeID:"Contracts",rowID:a}})}function V(a){_.push(`/ContractScheme/${a}`)}function i(a){_.push(`/Balance/${a}`)}function n(a={}){r.value=a?.per_page,C.value=a?.current_page}function N(a){v?.contractDownload({ContractID:a})}function h(a){_.push(`/Orders?contractID=${a}`)}return U(()=>m,()=>{C.value=1}),(a,t)=>{const E=lt,D=K,X=Ot,Z=mt,q=it("router-link"),R=at,tt=nt,et=Y,ot=W;return y(),O("div",Rt,[l(et,{class:"basic-table",items:w.value,fields:$(Ht),"show-empty":!0,filterable:[],filter:m.search,"per-page":r.value,"sort-desc":u.value,"onUpdate:sortDesc":t[0]||(t[0]=o=>u.value=o),"sort-by":k.value,"onUpdate:sortBy":t[1]||(t[1]=o=>k.value=o),"sort-direction":p.value,"current-page":C.value,"empty-text":"У вас пока нет договоров.","empty-filtered-text":"Договора не найдены."},{"cell(ID)":s(o=>[t[2]||(t[2]=e("span",{class:"td-mobile"},"Номер",-1)),e("div",Ut,[e("span",{class:"table-td-gray order-id",onClick:S=>V(o.item?.ID)}," # "+d($(Q)(o.item?.ID)),9,At)])]),"cell(CreateDate)":s(o=>[t[3]||(t[3]=e("span",{class:"td-mobile"},"Дата Создания",-1)),e("span",Mt,d($(ft)($(vt)(o.item?.CreateDate))),1)]),"cell(Customer)":s(o=>[t[4]||(t[4]=e("span",{class:"td-mobile"},"Договор",-1)),e("div",jt,[e("span",qt,d(o.item?.Customer),1)])]),"cell(TypeID)":s(o=>[t[5]||(t[5]=e("span",{class:"td-mobile"},"Тип договора",-1)),e("span",null,d(B.value[o.item?.TypeID]?.Name),1)]),"cell(Balance)":s(o=>[t[6]||(t[6]=e("span",{class:"td-mobile"},"Баланс",-1)),e("span",null,d($(dt)(o.item?.Balance)),1)]),"cell(IsHidden)":s(o=>[t[7]||(t[7]=e("span",{class:"td-mobile"},"Скрыт ?",-1)),l(E,{class:"rule-checkbox",name:"checkbox",checked:o.item?.IsHidden,modelValue:o.item.IsChecked,"onUpdate:modelValue":S=>o.item.IsChecked=S,onChange:S=>P(o.item)},null,8,["checked","modelValue","onUpdate:modelValue","onChange"]),e("span",null,d(o.item?.IsHidden===!0?"Да":"Нет"),1)]),"cell(Status)":s(o=>[l(D,{status:o.item?.StatusID,"status-table":"Contracts",onClick:S=>b(o.item?.ID),class:"tw-cursor-pointer"},null,8,["status","onClick"])]),"cell(Orders)":s(o=>[t[8]||(t[8]=e("span",{class:"td-mobile"},"Количество подключенных услуг",-1)),e("span",{class:"total-orders",onClick:S=>h(o.item?.ID)},d(o.item?.Orders),9,Gt)]),"cell(controls)":s(o=>[e("div",Yt,[o.item?.TypeID!="NaturalPartner"?(y(),H(X,{key:0,onClick:S=>i(o.item?.ID)},{default:s(()=>t[9]||(t[9]=[L(" Пополнить баланс ",-1)])),_:2,__:[9]},1032,["onClick"])):A("",!0),e("div",zt,[l(tt,{right:"",class:"dropdown-dots"},{"button-content":s(()=>[e("span",Jt,[l(Z)])]),default:s(()=>[l(R,null,{default:s(()=>[l(q,{to:`/ContractScheme/${o.item?.ID}`},{default:s(()=>t[10]||(t[10]=[L("Открыть",-1)])),_:2,__:[10]},1032,["to"])]),_:2},1024),l(R,null,{default:s(()=>[l(q,{to:`/ContractSettings/${o.item?.ID}`},{default:s(()=>t[11]||(t[11]=[L("Изменить тип учёта",-1)])),_:2,__:[11]},1032,["to"])]),_:2},1024),l(R,{onClick:S=>N(o.item?.ID)},{default:s(()=>t[12]||(t[12]=[L(" Загрузить договор ",-1)])),_:2,__:[12]},1032,["onClick"])]),_:2},1024)])])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),l(ot,{total_rows:x.value,onUpdatePage:n},null,8,["total_rows"])])}}},Qt=F(Kt,[["__scopeId","data-v-d0e5d1d6"]]),Wt={class:"container"},Xt={class:"list-form"},Zt={class:"contracts__page"},te={__name:"Contracts",async setup(I){let _,m;const v=pt(),g=J(),c=j(),k=M("emitter"),u=[{value:"Contracts",name:"Договора"},{value:"Profiles",name:"Профили"}],p=f("Contracts"),r=f(""),C=T(()=>p.value==="Contracts"?"Договора":"Профили"),P=T(()=>Object.keys(c?.contractsList)?.map(x=>c?.contractsList[x])?.reverse());function w(){p.value==="Contracts"?g.push({path:"/ContractMake"}):g.push({path:"/ProfileMake"})}function B(){k.emit("open-modal",{component:"FundsTransfer"})}return v.query?.section?p.value=v.query?.section:g.replace({query:{section:"Contracts"}}),U(p,()=>{g.replace({query:{section:p.value}})}),[_,m]=G(()=>c.fetchContracts()),await _,m(),[_,m]=G(()=>c.fetchProfiles()),await _,m(),(x,b)=>{const V=kt,i=It,n=yt,N=Ct,h=gt,a=bt,t=Qt,E=Vt;return y(),O(ut,null,[l(V),e("div",Wt,[l(i,{modelValue:p.value,"onUpdate:modelValue":b[0]||(b[0]=D=>p.value=D),tabs:u},null,8,["modelValue"]),l(N,null,{title:s(()=>[L(d(C.value),1)]),buttons:s(()=>[p.value==="Contracts"&&P.value.length>1?(y(),H(n,{key:0,onClick:b[1]||(b[1]=D=>B())},{default:s(()=>b[3]||(b[3]=[L("Перевод средств",-1)])),_:1,__:[3]})):A("",!0),l(n,{onClick:w},{default:s(()=>[L(d(p.value==="Contracts"?"Создать договор":"Создать профиль"),1)]),_:1})]),_:1}),l(h),e("div",Xt,[l(a,{modelValue:r.value,"onUpdate:modelValue":b[2]||(b[2]=D=>r.value=D)},null,8,["modelValue"])]),e("div",Zt,[p.value==="Contracts"?(y(),H(t,{key:0,search:r.value},null,8,["search"])):(y(),H(E,{key:1,search:r.value},null,8,["search"]))])])],64)}}},ye=F(te,[["__scopeId","data-v-aa064b85"]]);export{ye as default};
