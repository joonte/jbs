import{_ as q,r as O,h as W,i as z,o as _,c as D,a as u,t as p,m as Z,k as I,p as G,l as J,j as $,b as K,x as Y,w as ee,F as A,v as R,d as H,Y as ae,af as oe,f as ne,e as te,a7 as le,R as de,g as U}from"./index-eaeb1281.js";import{u as re}from"./contracts-ac470ffa.js";import{u as ie}from"./services-736a125a.js";import{s as se}from"./multiselect-92d0918e.js";import{_ as ce}from"./ButtonDefault-598fef28.js";import{_ as ue}from"./BlockSelectContract-526ebf01.js";import{_ as _e}from"./ClausesKeeper-a152fc61.js";const De={props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:f}){const i=O(null);function o(){f("update:modelValue",l.data)}return W(l,()=>{i.value=l.modelValue}),z(()=>{i.value=l.modelValue,console.log(l)}),{updateValue:o,inputValue:i}}},fe=l=>(G("data-v-6d12ff0a"),l=l(),J(),l),ve={class:"form-input_border"},he=["name","type","checked"],Se={class:"form-input_border-content"},ge=fe(()=>u("span",{class:"form-input_border-mark"},null,-1)),ye={class:"form-input_border-item form-input_border-item--left"},ke={class:"form-input_border-item form-input_border-item--right"};function Ie(l,f,i,o,v,E){var V,r,C;return _(),D("label",ve,[u("input",{name:i.name,type:i.checkbox?"checkbox":"radio",onInput:f[0]||(f[0]=(...y)=>o.updateValue&&o.updateValue(...y)),checked:((V=o.inputValue)==null?void 0:V.value)===((r=i.data)==null?void 0:r.value)},null,40,he),u("span",Se,[ge,u("span",ye,p((C=i.data)==null?void 0:C.name),1),i.data.price?Z(l.$slots,"default",{key:0},()=>{var y;return[u("span",ke,p((y=i.data)==null?void 0:y.price),1)]},!0):I("",!0)])])}const Q=q(De,[["render",Ie],["__scopeId","data-v-6d12ff0a"]]),X=l=>(G("data-v-b5a70153"),l=l(),J(),l),pe={key:0,class:"section"},be={class:"section-header"},Oe={class:"section-title"},Ve={key:2,class:"form-field form-field--basic"},Ce=X(()=>u("div",{class:"form-field__label"},[H("Выбрать заказ"),u("span",null,"*")],-1)),me={class:"form-field-input__wrapper"},Ne={class:"multiselect-option"},xe={class:"form-field form-field--basic"},Be={class:"form-field__label"},Fe={key:0},we={class:"form-field-input__wrapper"},je=["name","onUpdate:modelValue"],Ae={key:4,class:"section"},Ue={class:"list"},Ee={class:"list-col list-col--md"},Pe=X(()=>u("div",{class:"list-item__title"},[H("Тариф"),u("span",null,"*")],-1)),Me={key:5,class:"section"},Le={class:"list"},Te={class:"list-col list-col--md"},Re={class:"list-item__title"},We={key:0},He={key:6,class:"section"},Ke={class:"total-block block--divider"},Ye={class:"total-block__row total-block__row--big"},qe={class:"total-block__col"},ze={class:"total-block__col"},Ge={key:7,class:"additional-service__inline-price"};function Je(l,f,i,o,v,E){var m,b,M,L,N,w,x,j,B,T;const V=_e,r=ue,C=$("Multiselect"),y=Q,P=ce;return _(),D(A,null,[i.isInline?I("",!0):(_(),D("div",pe,[u("div",be,[u("h1",Oe,p((m=i.sectionData)==null?void 0:m.Item),1),K(V,{partition:`Header:${((b=i.sectionData)==null?void 0:b.Code)==="Default"?i.sectionID:`/${(M=i.sectionData)==null?void 0:M.Code}Orders`}`},null,8,["partition"])])])),i.isInline?I("",!0):(_(),Y(r,{key:1,class:"additional-service__contract-select",title:"Договор",modelValue:o.contractSelect,"onUpdate:modelValue":f[0]||(f[0]=t=>o.contractSelect=t)},null,8,["modelValue"])),((L=o.getDependOrders)==null?void 0:L.length)>0?(_(),D("div",Ve,[Ce,u("div",me,[K(C,{class:"multiselect--white",placeholder:"Все заказы",label:"name",disabled:((N=o.getDependOrders)==null?void 0:N.length)<=1,options:o.getDependOrders,modelValue:o.DependOrderID,"onUpdate:modelValue":f[1]||(f[1]=t=>o.DependOrderID=t)},{option:ee(({option:t})=>[u("div",Ne,p(t.name),1)]),_:1},8,["disabled","options","modelValue"])])])):I("",!0),((w=o.getInputFields)==null?void 0:w.length)>0?(_(!0),D(A,{key:3},R(o.getInputFields,t=>(_(),D("div",xe,[u("div",Be,[H(p(t==null?void 0:t.Name),1),t!=null&&t.IsDuty?(_(),D("span",Fe,"*")):I("",!0)]),u("div",we,[ae(u("input",{name:`ID${t==null?void 0:t.ID}`,"onUpdate:modelValue":S=>o.formData[`ID${t==null?void 0:t.ID}`]=S},null,8,je),[[oe,o.formData[`ID${t==null?void 0:t.ID}`]]])])]))),256)):I("",!0),((x=i.sectionData)==null?void 0:x.Code)!=="Default"&&((j=o.getAdditionalServicesSchemes)==null?void 0:j.length)>0?(_(),D("div",Ae,[u("div",Ue,[u("div",Ee,[Pe,(_(!0),D(A,null,R(o.getAdditionalServicesSchemes,t=>{var S,n;return _(),Y(y,{name:`${(S=i.sectionData)==null?void 0:S.Code}SchemeID`,checkbox:!1,data:t,modelValue:o.formData[`${(n=i.sectionData)==null?void 0:n.Code}SchemeID`],"onUpdate:modelValue":f[2]||(f[2]=a=>{var e;return o.formData[`${(e=i.sectionData)==null?void 0:e.Code}SchemeID`]=a})},null,8,["name","data","modelValue"])}),256))])])])):I("",!0),((B=o.getSelectFields)==null?void 0:B.length)>0?(_(),D("div",Me,[u("div",Le,[(_(!0),D(A,null,R(o.getSelectFields,t=>(_(),D("div",Te,[u("div",Re,[H(p(t==null?void 0:t.Name),1),t!=null&&t.IsDuty?(_(),D("span",We,"*")):I("",!0)]),(_(!0),D(A,null,R(o.getSelectFieldOptions(t),S=>(_(),Y(y,{name:`ID${t==null?void 0:t.ID}`,checkbox:!1,data:S,modelValue:o.formData[`ID${t==null?void 0:t.ID}`],"onUpdate:modelValue":n=>o.formData[`ID${t==null?void 0:t.ID}`]=n},null,8,["name","data","modelValue","onUpdate:modelValue"]))),256))]))),256))])])):I("",!0),i.isInline?(_(),D("div",Ge,p(o.finalPrice()||0)+" ₽",1)):(_(),D("div",He,[u("div",Ke,[u("div",Ye,[u("div",qe,"Итого за 1 "+p((T=i.sectionData)==null?void 0:T.Measure),1),u("div",ze,p(o.finalPrice()||0)+" ₽",1)])]),K(P,{class:"btn--wide",disabled:o.getButtonDisableCondition,label:"Заказать","is-loading":o.isLoading,onClick:f[3]||(f[3]=t=>o.payForOrder())},null,8,["disabled","is-loading"])]))],64)}const Qe={components:{InputBorderCheckboxRadio:Q,Multiselect:se},props:{modelValue:{type:Object,default:()=>{}},sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},emits:["updateList","update:modelValue"],setup(l,{emit:f}){const i=re(),o=ie(),v=ne(),E=te(),V=le(),r=O({}),C=O(null),y=O(null),P=O(null),m=O(null),b=O(!1);de("emitter");const M=U(()=>{var n,a;return(a=Object.keys((o==null?void 0:o.additionalServicesScheme[(n=l.sectionData)==null?void 0:n.Code])||{}))==null?void 0:a.map(e=>{var d,s,h,g,c,k,F;return{...o==null?void 0:o.additionalServicesScheme[(d=l.sectionData)==null?void 0:d.Code][e],value:(h=o==null?void 0:o.additionalServicesScheme[(s=l.sectionData)==null?void 0:s.Code][e])==null?void 0:h.ID,price:(c=o==null?void 0:o.additionalServicesScheme[(g=l.sectionData)==null?void 0:g.Code][e])==null?void 0:c.CostMonth,name:(F=o==null?void 0:o.additionalServicesScheme[(k=l.sectionData)==null?void 0:k.Code][e])==null?void 0:F.Name}}).sort((e,d)=>Number(e==null?void 0:e.SortID)<Number(d==null?void 0:d.SortID)?-1:Number(e==null?void 0:e.SortID)>Number(d==null?void 0:d.SortID)?1:0).filter(e=>e==null?void 0:e.IsActive)}),L=U(()=>{var a;let n=!1;return(a=w.value)==null||a.forEach(e=>{e!=null&&e.IsDuty&&(r.value[`ID${e==null?void 0:e.ID}`]===null||r.value[`ID${e==null?void 0:e.ID}`]===void 0||r.value[`ID${e==null?void 0:e.ID}`]==="")&&(n=!0)}),n}),N=U(()=>{var n;return(n=l.sectionData)==null?void 0:n.ServicesFields.filter(a=>(a==null?void 0:a.TypeID)==="Select").sort((a,e)=>Number(a==null?void 0:a.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(a==null?void 0:a.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),w=U(()=>{var n;return(n=l.sectionData)==null?void 0:n.ServicesFields.filter(a=>(a==null?void 0:a.TypeID)==="Input").sort((a,e)=>Number(a==null?void 0:a.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(a==null?void 0:a.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),x=U(()=>{var n;return(n=l.sectionData)==null?void 0:n.DependOrders.map(a=>{var e,d,s,h;return{...v==null?void 0:v.userOrders[a],name:((d=o.ServicesList[(e=v==null?void 0:v.userOrders[a])==null?void 0:e.ServiceID])==null?void 0:d.Code)+": "+((s=v==null?void 0:v.userOrders[a])==null?void 0:s.ID),value:(h=v==null?void 0:v.userOrders[a])==null?void 0:h.ID}})});function j(){var a;let n=0;return Object.keys(r.value).map(e=>{var d,s;(d=r.value[e])!=null&&d.price&&(n=n+Number((s=r.value[e])==null?void 0:s.price))}),n+Number((a=l.sectionData)==null?void 0:a.Cost)}function B(n){var a,e;return(e=(a=n==null?void 0:n.Options)==null?void 0:a.split(`
`))==null?void 0:e.map(d=>{let s=d.split("=");return{value:s[0],name:s[1],price:s[2]}})}function T(){var a;b.value=!0;let n={};(a=Object.keys(r.value))==null||a.forEach(e=>{var d,s;n[e]=(d=r.value[e])!=null&&d.value?(s=r.value[e])==null?void 0:s.value:r.value[e]}),n.ContractID=P.value,n.ServiceID=l.sectionID,o.ServiceOrder(n).then(({result:e,info:d,error:s})=>{var h;e==="SUCCESS"?o.ServiceOrderPay((h=l.sectionData)==null?void 0:h.Code,{AmountPay:"1",ServiceOrderID:d==null?void 0:d.ServiceOrderID,IsChange:!0}).then(g=>{let{result:c,error:k}=g;c==="SUCCESS"?E.push(`/AdditionalServices?ServiceID=${l.sectionID}`):c==="BASKET"&&E.push("/Basket"),b.value=!1}):b.value=!1})}function t(){var a;let n={};(a=Object.keys(r.value))==null||a.forEach(e=>{var d,s;n[e]=(d=r.value[e])!=null&&d.value?(s=r.value[e])==null?void 0:s.value:r.value[e]}),n.ServiceID=l.sectionID,n.Price=j(),f("update:modelValue",n)}function S(){var n,a;if(l.modelValue){const e=(n=Object.keys(l.modelValue))==null?void 0:n.find(d=>d.includes("SchemeID"));e&&((a=r.value[e])!=null&&a.ID||(r.value[e]={}),r.value[e].ID=l.modelValue[e])}}return W(V,()=>{var n,a,e,d,s,h,g;S(),l.updateWithPageTransition&&((n=N.value)==null||n.forEach(c=>{var k;r.value[`ID${c==null?void 0:c.ID}`]&&(r.value[`ID${c==null?void 0:c.ID}`]=(k=B(c))==null?void 0:k.find(F=>F.value===(c==null?void 0:c.Default)))}),((a=l.sectionData)==null?void 0:a.Code)!=="Default"&&o.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code),((s=(d=l.sectionData)==null?void 0:d.DependOrders)==null?void 0:s.length)>0&&(m.value=(g=(h=x.value)==null?void 0:h[0])==null?void 0:g.ID))}),W(r.value,()=>{t()}),W(l,()=>{S()}),z(()=>{var n,a,e,d,s,h,g;(n=N.value)==null||n.forEach(c=>{var k;r.value[`ID${c==null?void 0:c.ID}`]=(k=B(c))==null?void 0:k.find(F=>F.value===(c==null?void 0:c.Default))}),((a=l.sectionData)==null?void 0:a.Code)!=="Default"&&o.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code),((s=(d=l.sectionData)==null?void 0:d.DependOrders)==null?void 0:s.length)>0&&(m.value=(g=(h=x.value)==null?void 0:h[0])==null?void 0:g.ID),S(),t()}),{contractSelect:P,contractsStore:i,getSelectFields:N,getInputFields:w,selectServerModel:C,isLoading:b,getButtonDisableCondition:L,getAdditionalServicesSchemes:M,getSelectFieldOptions:B,getDependOrders:x,DependOrderID:m,operationSystem:y,formData:r,finalPrice:j,payForOrder:T}}},ta=q(Qe,[["render",Je],["__scopeId","data-v-b5a70153"]]);export{ta as S};
