import{j,o as u,c as N,b as c,a as l,n as oe,t as h,Z as R,a9 as T,w as P,d as F,y as x,am as te,F as K,x as ne,_ as se,f as ae,e as re,r as f,S as le,i as ce,g}from"./index-00a0bf0d.js";import{I as ie}from"./IconSearch-ea3f052d.js";import{H as q}from"./HostingItem-4f478b02.js";import{_ as z}from"./ClausesKeeper-ce1dcc35.js";import{s as de}from"./multiselect-9faec1a5.js";import{u as me}from"./hosting-830c652c.js";import{u as ue}from"./contracts-8ab155ab.js";import{B as Z}from"./BlockBalanceAgreement-fb81df3d.js";import{u as _e}from"./testTransforms-eec373ee.js";import{u as fe}from"./globalActions-72d167c2.js";import{_ as ge,B as G}from"./IconButtonBack-330011b5.js";import{E as ve}from"./EmptyStateBlock-ccb3476e.js";import{_ as pe}from"./FormInputSearch-b340fca7.js";import{f as ke}from"./bootstrap-vue-next.es-be8a8de1.js";import{_ as be}from"./ButtonDefault-4233c21f.js";import"./IconDots-6b52141e.js";import"./IconCard-30dada0d.js";import"./StatusBadge-4c2dc228.js";import"./hostStatuses-94d00f20.js";import"./HelperComponent-2a852b86.js";import"./IconArrow-74dc045b.js";import"./useTimeFunction-8602dd60.js";import"./OrderIDBadge-99ffd0aa.js";import"./IconClose-97a82d3d.js";import"./IconPlus-578a30b2.js";const Se={class:"section"},he={class:"container"},Ie={class:"title__icon"},Ce={class:"btn__group"},He={class:"group__several"},Be={class:"list-form"},we={class:"list-form_col list-form_col--sm"},ye={class:"list-form_select"},Oe={class:"multiselect-option"},De={key:0};function Pe(r,s,v,e,I,C){var y,b,O;const p=Z,k=ge,d=be,m=j("router-link"),H=G,B=ke,_=z,V=j("Multiselect"),U=pe,L=q,w=ve;return u(),N(K,null,[c(p),l("div",Se,[l("div",he,[l("div",{class:oe(["section-header",e.isSeveral?"column":""])},[l("div",Ie,[l("h1",{class:"section-title",onClick:s[0]||(s[0]=t=>e.reloadNow())},h(e.isSeveral?"Продление услуг Хостинга":"Хостинг"),1),R(c(k,{onClick:s[1]||(s[1]=t=>e.outSeveralOrders())},null,512),[[T,e.isSeveral]])]),R(l("div",Ce,[c(d,{class:"btn-several",label:"Продлить несколько заказов",onClick:s[2]||(s[2]=t=>e.prolongSeveralOrders())}),c(m,{class:"btn btn--blue btn-default",to:"/HostingSchemes"},{default:P(()=>[F("Заказать")]),_:1})],512),[[T,!e.isSeveral]]),R(l("div",He,[c(H,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":s[3]||(s[3]=t=>e.selectPeriod=t)},null,8,["modelValue"]),c(B,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":s[4]||(s[4]=t=>e.useBalance=t),name:"checkbox-balance"},{default:P(()=>[F("Использовать средства с баланса")]),_:1},8,["modelValue"]),c(d,{label:"Продлить",onClick:s[5]||(s[5]=t=>e.prolongOrders())})],512),[[T,e.isSeveral]])],2),(u(),x(te,null,[c(_)],1024)),l("div",Be,[l("div",we,[l("div",ye,[c(V,{modelValue:e.select,"onUpdate:modelValue":s[6]||(s[6]=t=>e.select=t),options:e.getUsers,disabled:((y=e.getUsers)==null?void 0:y.length)<=1,label:"name"},{singlelabel:P(({value:t})=>[l("span",null,"# "+h(t.value.padStart(5,"0"))+" / "+h(t.name),1)]),option:P(({option:t})=>[l("div",Oe,"# "+h(t.value.padStart(5,"0"))+" / "+h(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),c(U,{modelValue:e.search,"onUpdate:modelValue":s[7]||(s[7]=t=>e.search=t)},null,8,["modelValue"])]),e.getHostingList&&((b=e.getHostingList)==null?void 0:b.length)>0?(u(),N("div",De,[e.filterProducts&&((O=e.filterProducts)==null?void 0:O.length)>0?(u(!0),N(K,{key:0},ne(e.filterProducts,(t,M)=>{var i,S;return u(),x(L,{"item-data":t,"user-name":`${(i=e.getUser)==null?void 0:i.Name} - ${(S=e.getContracts[t==null?void 0:t.ContractID])==null?void 0:S.Customer}`,params:e.getHostingItemParam(t),"info-link":`/HostingOrders/${t==null?void 0:t.OrderID}`,"is-last":M===e.filterProducts.length-1,isSeveral:e.isSeveral,"selected-rows":e.selectedRows,onUpdateSelectedRows:e.handleSelectedRowsUpdate,onDelete:e.deleteItem,onTransfer:e.transferItem,onManage:e.orderManage},null,8,["item-data","user-name","params","info-link","is-last","isSeveral","selected-rows","onUpdateSelectedRows","onDelete","onTransfer","onManage"])}),256)):(u(),x(w,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(u(),x(w,{key:1,class:"no-margin",label:"У Вас нет заказов на хостинг"}))])])],64)}const xe={components:{IconSearch:ie,Multiselect:de,ClausesKeeper:z,HostingItem:q,BlockBalanceAgreement:Z,BlockSelectPeriod:G},async setup(){const r=me(),s=ae(),v=ue(),e=fe(),I=re(),{formDescriptionLine:C}=_e(),p=f("*"),k=f(null),d=f(!1),m=f([]),H=f(null),B=f(!1),_=le("emitter");_.on("updateHostingList",()=>{r.fetchHostingOrders()});const V=n=>{m.value=n};async function U(){console.log(m.value);const n=Object.keys(m.value).filter(a=>m.value[a]),o={ServiceID:"10000",ItemsPay:H.value,OrdersIDs:n,...B.value&&{UseBalance:"yes"}};await e.OrdersPay(o).then(a=>{a==="Basket"?(console.log("Success"),I.push("/Basket")):(a==null?void 0:a.Status)==="Ok"&&(d.value=!1,_.emit("open-modal",{component:"BalanceProlong",data:{Message:a==null?void 0:a.Message,Count:a==null?void 0:a.Count}}))})}function L(){d.value=!0}function w(){d.value=!1}ce(()=>{i.value.length<1&&b()});function y(){I.go(0)}function b(){I.push({path:"/HostingSchemes"})}function O(n){_.emit("open-modal",{component:"DeleteItem",data:{id:n,message:"Вы действительно хотите удалить хостинг?",tableID:"HostingOrders",successEmit:"updateHostingList"}})}function t(n){_.emit("open-modal",{component:"OrdersTransfer",data:n})}function M(n){e.OrderManageHosting(n)}const i=g(()=>{var n;return(n=Object.keys(r==null?void 0:r.hostingList).map(o=>r==null?void 0:r.hostingList[o]))==null?void 0:n.reverse()}),S=g(()=>r==null?void 0:r.hostingSchemes),A=g(()=>v==null?void 0:v.contractsList),J=g(()=>{let n=[{value:"*",name:"Все договора"}];return i.value!==null?(i.value.forEach(o=>{var a;n.find(D=>D.value===o.ContractID)||n.push({value:o.ContractID,name:(a=A.value[o==null?void 0:o.ContractID])==null?void 0:a.Customer})}),n):{value:"*",name:"Все договора"}}),Q=g(()=>s.userInfo),W=g(()=>Y(X(i.value)));function X(n){return p.value!=="*"?n.filter(o=>(o==null?void 0:o.ContractID)===p.value):n}function Y(n){return k.value!==null?n.filter(o=>o==null?void 0:o.Domain.toLowerCase().includes(k.value.toLowerCase())):n}function $(n){var a,D,E;const o=ee(n==null?void 0:n.SchemeID);return[{text:o==null?void 0:o.Name},{text:C((a=o==null?void 0:o.SchemeParams)==null?void 0:a.limit_webdomains)},{text:C((D=o==null?void 0:o.SchemeParams)==null?void 0:D.limit_quota)},{text:C((E=o==null?void 0:o.SchemeParams)==null?void 0:E.limit_emails)},{text:`${o==null?void 0:o.CostMonth} ₽ в месяц`,bold:!0}]}function ee(n){var o;return(o=S.value)==null?void 0:o[n]}return await r.fetchHostingOrders(),await r.fetchHostingSchemes(),await v.fetchContracts(),{getHostingList:i,getHostingSchemes:S,orderManage:M,filterProducts:W,getUsers:J,getUser:Q,select:p,search:k,getContracts:A,deleteItem:O,transferItem:t,getHostingItemParam:$,navigateToHostingSchemes:b,reloadNow:y,prolongSeveralOrders:L,isSeveral:d,selectedRows:m,selectPeriod:H,prolongOrders:U,outSeveralOrders:w,useBalance:B,handleSelectedRowsUpdate:V}}},no=se(xe,[["render",Pe],["__scopeId","data-v-2771a218"]]);export{no as default};
