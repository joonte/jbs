import{j as A,o as f,c as C,a as l,b as r,w as D,d as S,t as y,F as U,v as j,k as Q,Y as W,ae as X,n as Z,_ as z,r as E,R as F,x as V,p as $,l as ee,g as P}from"./index-041dff1e.js";import{u as te}from"./dedicatedServer-c7d161c3.js";import{u as oe}from"./contracts-fabeed86.js";import{I as ae}from"./IconSearch-892c5182.js";import{_ as ne}from"./HelperComponent-38fea301.js";import{S as G}from"./StatusBadge-72e39b02.js";import{I as Y}from"./IconRotate-e853670a.js";import{f as H}from"./useTimeFunction-8602dd60.js";import"./resetServer-bc13c951.js";import{z as se,k as re,d as le}from"./bootstrap-vue-next.es-dd4e7f7d.js";import{_ as ce}from"./IconDots-1bfd3391.js";import{_ as ie}from"./IconCard-2ba2ac7a.js";import{_ as de}from"./OrderIDBadge-a993839e.js";import{S as _e}from"./Select2-899d16be.js";import{s as ue}from"./multiselect-092b153c.js";import{_ as q}from"./FormInputSearch-8ee1e4aa.js";import{B as J}from"./BlockBalanceAgreement-ab137d5a.js";import{u as me}from"./globalActions-56c36e7b.js";import{E as De}from"./EmptyStateBlock-0c3a34a2.js";import{_ as fe}from"./ClausesKeeper-a9c75480.js";import"./ButtonDefault-80267555.js";import"./IconArrow-ce6e1d64.js";import"./IconPlus-15a1e8e7.js";import"./IconClose-4ba86278.js";const ve={class:"hosting-item"},ge={class:"hosting-item__row"},Ie={class:"hosting-item__date"},pe={class:"hosting-item__row"},he={class:"hosting-item__person"},Se={key:0,class:"hosting-item__row"},be={class:"hosting-item__list"},Ce=["innerHTML"],we={class:"hosting-item__controls"},Oe={class:"ico"},ke={class:"btn btn--dots"};function Le(c,a,n,o,p,b){var d,L,t,e,m,B,R,x,M,N;const _=de,v=A("router-link"),h=G,s=A("Helper"),i=Y,u=ie,w=ce,g=se,O=re,k=le;return f(),C("div",ve,[l("div",ge,[r(_,{orderID:(d=n.itemData)==null?void 0:d.OrderID},null,8,["orderID"]),r(v,{class:"hosting-item__name",to:`/DSOrders/${n.itemData.OrderID}`},{default:D(()=>[S(y(n.itemData.IP),1)]),_:1},8,["to"]),r(h,{status:(L=n.itemData)==null?void 0:L.StatusID,DaysRemainded:(t=n.itemData)==null?void 0:t.DaysRemainded,"status-table":"DSOrders"},null,8,["status","DaysRemainded"]),l("div",Ie,"Дата окончания "+y(o.calculateExpirationDate((e=n.itemData)==null?void 0:e.DaysRemainded))+" | "+y(((m=n.itemData)==null?void 0:m.DaysRemainded)||0)+" дн.",1)]),l("div",pe,[l("div",he,y((B=n.itemData)==null?void 0:B.Customer),1),r(s,{"user-notice":(R=n.itemData)==null?void 0:R.UserNotice,id:(x=n.itemData)==null?void 0:x.OrderID,position:n.isLast?"bottom":"top",emit:"updateDSOrdersList"},null,8,["user-notice","id","position"])]),n.params.length?(f(),C("div",Se,[l("ul",be,[(f(!0),C(U,null,j(n.params,I=>(f(),C("li",{innerHTML:I},null,8,Ce))),256))])])):Q("",!0),l("div",we,[W(l("button",{class:Z(["btn btn--md btn--border btn--rotate btn--rotate_green button-large",{"btn--rotate_gray":((M=n.itemData)==null?void 0:M.StatusID)!=="Active"||o.isReloading,"btn--rotate_loading":o.isReloading}]),title:"Перезагрузить выделенный сервер",onClick:a[0]||(a[0]=I=>o.serverReset())},[S("Включен"),l("div",Oe,[r(i)])],2),[[X,((N=n.itemData)==null?void 0:N.StatusID)==="Active"]]),l("div",{class:"btn btn--md btn--bold",onClick:a[1]||(a[1]=I=>{var T;return c.$router.push(`/DSOrderPay/${(T=n.itemData)==null?void 0:T.OrderID}`)})},[r(u),S("Оплатить")]),r(k,{class:"dropdown-dots",right:""},{"button-content":D(()=>[l("div",ke,[r(w)])]),default:D(()=>[r(g,null,{default:D(()=>{var I;return[r(v,{to:`DSOrders/${(I=n.itemData)==null?void 0:I.OrderID}`},{default:D(()=>[S("Дополнительная информация")]),_:1},8,["to"])]}),_:1}),r(g,{onClick:a[2]||(a[2]=I=>o.transferAccount())},{default:D(()=>[S("Передать на другой аккаунт")]),_:1}),r(g,{onClick:a[3]||(a[3]=I=>o.orderManage())},{default:D(()=>[S("Управлять заказом")]),_:1}),r(O),r(g,{class:"color-red",onClick:a[4]||(a[4]=I=>o.deleteItem())},{default:D(()=>[S("Удалить")]),_:1})]),_:1})])])}const ye={components:{StatusBadge:G,IconRotate:Y,Helper:ne},props:{params:{type:Array,default:()=>[]},itemData:{type:Object,default:()=>{}},isLast:{type:Boolean,default:!1}},emits:["delete","transfer","manage"],setup(c,{emit:a}){const n=E(!1),o=F("emitter");function p(s){if(!s)return H(new Date);const i=new Date,u=new Date(i.getTime()+s*24*60*60*1e3);return H(u)}function b(){var i;function s(u){n.value=u}o.emit("open-modal",{component:"ReloadDS",data:{DSOrderID:(i=c.itemData)==null?void 0:i.ID,isReloading:n.value,onReloadStatusChange:s}})}function _(){var s;a("delete",(s=c.itemData)==null?void 0:s.ID)}function v(){var s,i;a("transfer",{ServiceOrderID:(s=c.itemData)==null?void 0:s.ID,ServiceID:(i=c.itemData)==null?void 0:i.ServiceID})}function h(){var s,i,u;a("manage",{ServiceOrderID:(s=c.itemData)==null?void 0:s.ID,ServiceID:(i=c.itemData)==null?void 0:i.ServiceID,OrderID:(u=c.itemData)==null?void 0:u.OrderID})}return{deleteItem:_,serverReset:b,orderManage:h,transferAccount:v,calculateExpirationDate:p,isReloading:n}}},K=z(ye,[["render",Le],["__scopeId","data-v-2b077e44"]]),Be=c=>($("data-v-6476733e"),c=c(),ee(),c),Re={class:"section"},Me={class:"container"},Pe={class:"section-header"},xe={class:"section-title__nowrap"},Ae=Be(()=>l("h1",{class:"section-title"},"Выделенные серверы",-1)),Ve={class:"list-form"},Ue={class:"list-form_col list-form_col--sm"},Ee={class:"list-form_select"},Ne={class:"multiselect-option"},Te={key:0};function He(c,a,n,o,p,b){var g,O,k;const _=J,v=A("router-link"),h=fe,s=A("Multiselect"),i=q,u=K,w=De;return f(),C(U,null,[r(_),l("div",Re,[l("div",Me,[l("div",Pe,[l("div",xe,[Ae,r(v,{class:"btn btn--blue btn-default",to:"DSSchemes"},{default:D(()=>[S("Заказать")]),_:1})])]),r(h,{partition:"Header:/DSOrders"}),l("div",Ve,[l("div",Ue,[l("div",Ee,[r(s,{modelValue:o.select,"onUpdate:modelValue":a[0]||(a[0]=d=>o.select=d),options:o.getUsers,disabled:((g=o.getUsers)==null?void 0:g.length)<=1,label:"name"},{option:D(({option:d})=>[l("div",Ne,"# "+y(d.value.padStart(5,"0"))+" / "+y(d.name),1)]),_:1},8,["modelValue","options","disabled"])])]),r(i,{modelValue:o.search,"onUpdate:modelValue":a[1]||(a[1]=d=>o.search=d)},null,8,["modelValue"])]),o.getDSList&&((O=o.getDSList)==null?void 0:O.length)>0?(f(),C("div",Te,[o.filterProducts&&((k=o.filterProducts)==null?void 0:k.length)>0?(f(!0),C(U,{key:0},j(o.filterProducts,(d,L)=>(f(),V(u,{params:o.getDSItemParam(d),"is-last":L===o.filterProducts.length-1,"item-data":d,onDelete:o.deleteItem,onTransfer:o.transferItem,onManage:o.orderManage},null,8,["params","is-last","item-data","onDelete","onTransfer","onManage"]))),256)):(f(),V(w,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(f(),V(w,{key:1,class:"no-margin",label:"У Вас нет заказов на выделенные серверы"}))])])],64)}const je={components:{FormInputSearch:q,IconSearch:ae,Select2:_e,Multiselect:ue,DSItem:K,BlockBalanceAgreement:J},async setup(){const c=E("*"),a=E(null),n=me(),o=te(),p=oe(),b=F("emitter");b.on("updateDSOrdersList",()=>{o.fetchDSOrders()});const _=P(()=>{var t;return(t=Object.keys(o==null?void 0:o.DSList).map(e=>o==null?void 0:o.DSList[e]))==null?void 0:t.reverse()}),v=P(()=>o==null?void 0:o.DSSchemes),h=P(()=>p==null?void 0:p.contractsList),s=P(()=>u(i(_.value)));function i(t){return c.value!=="*"?t.filter(e=>(e==null?void 0:e.ContractID)===c.value):t}function u(t){return a.value!==null?t.filter(e=>(e==null?void 0:e.Customer.toLowerCase().includes(a.value.toLowerCase()))||(e==null?void 0:e.OrderID.toLowerCase().includes(a.value.toLowerCase()))||(e==null?void 0:e.Scheme.toLowerCase().includes(a.value.toLowerCase()))||(e==null?void 0:e.IP.toLowerCase().includes(a.value.toLowerCase()))||(e==null?void 0:e.disks.toLowerCase().includes(a.value.toLowerCase()))||(e==null?void 0:e.CPU.toLowerCase().includes(a.value.toLowerCase()))||(e==null?void 0:e.ram.toLowerCase().includes(a.value.toLowerCase()))):t}function w(t){n.OrderManage(t)}const g=P(()=>{let t=[{value:"*",name:"Все договора"}];return _.value!==null&&h.value!==null?(Object.keys(_.value).forEach(e=>{var m,B,R;t.find(x=>{var M;return x.value===((M=_.value[e])==null?void 0:M.ContractID)})||t.push({value:(m=_.value[e])==null?void 0:m.ContractID,name:(R=h.value[(B=_.value[e])==null?void 0:B.ContractID])==null?void 0:R.Customer})}),t):{value:"*",name:"Все договора"}});function O(t){let e=k(t==null?void 0:t.SchemeID);e===void 0&&(e=t);let m=[];return t!=null&&t.Scheme&&m.push(t==null?void 0:t.Scheme),t!=null&&t.CPU&&m.push(t==null?void 0:t.CPU),e!=null&&e.ram&&m.push("RAM "+(e==null?void 0:e.ram)+" GB"),e!=null&&e.disks&&m.push(e==null?void 0:e.disks),e!=null&&e.CostMonth&&m.push("<b>"+(e==null?void 0:e.CostMonth)+"/ месяц</b>"),m}function k(t){var e;return(e=v.value)==null?void 0:e[t]}function d(t){b.emit("open-modal",{component:"DeleteItem",data:{id:t,message:"Вы действительно хотите удалить этот сервер?",tableID:"DSOrders",successEmit:"updateDSOrdersList"}})}function L(t){b.emit("open-modal",{component:"OrdersTransfer",data:t})}return await o.fetchDSOrders(),await o.fetchDSSchemes(),await p.fetchContracts(),{getDSList:_,filterProducts:s,select:c,search:a,getUsers:g,getDSSchemes:v,getDSItemParam:O,orderManage:w,deleteItem:d,transferItem:L}}},ut=z(je,[["render",He],["__scopeId","data-v-6476733e"]]);export{ut as default};
