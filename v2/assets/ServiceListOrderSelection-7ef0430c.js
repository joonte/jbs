import{_ as z,r as m,h as W,i as G,o as _,c as D,a as u,t as C,m as $,k as b,p as J,l as Q,j as ee,b as Y,x as q,w as ae,F as U,v as K,d as H,Y as oe,af as ne,f as te,e as le,a7 as de,R as ie,g as j}from"./index-5a4e9ca9.js";import{u as re}from"./contracts-7e364bfa.js";import{u as se}from"./services-b760c29c.js";import{s as ce}from"./multiselect-9d256093.js";import{_ as ue}from"./ButtonDefault-a3087454.js";import{_ as _e}from"./BlockSelectContract-f668654b.js";import{_ as De}from"./ClausesKeeper-b231c2af.js";const fe={props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:f}){const s=m(null);function o(){f("update:modelValue",t.data)}return W(t,()=>{s.value=t.modelValue}),G(()=>{s.value=t.modelValue}),{updateValue:o,inputValue:s}}},ve=t=>(J("data-v-414dbe12"),t=t(),Q(),t),Se={class:"form-input_border"},he=["checked","name","type"],Ie={class:"form-input_border-content"},ge=ve(()=>u("span",{class:"form-input_border-mark"},null,-1)),ke={class:"form-input_border-item form-input_border-item--left"},ye={class:"form-input_border-item form-input_border-item--right"};function Oe(t,f,s,o,v,g){var N,i,x;return _(),D("label",Se,[u("input",{checked:((N=o.inputValue)==null?void 0:N.value)===((i=s.data)==null?void 0:i.value),name:s.name,type:s.checkbox?"checkbox":"radio",onInput:f[0]||(f[0]=(...k)=>o.updateValue&&o.updateValue(...k))},null,40,he),u("span",Ie,[ge,u("span",ke,C((x=s.data)==null?void 0:x.name),1),s.data.price?$(t.$slots,"default",{key:0},()=>{var k;return[u("span",ye,C((k=s.data)==null?void 0:k.price),1)]},!0):b("",!0)])])}const X=z(fe,[["render",Oe],["__scopeId","data-v-414dbe12"]]),Z=t=>(J("data-v-758a6e8b"),t=t(),Q(),t),be={key:0,class:"section"},Ce={class:"section-header"},pe={class:"section-title"},Ve={key:2,class:"form-field form-field--basic"},me=Z(()=>u("div",{class:"form-field__label"},[H("Выбрать заказ"),u("span",null,"*")],-1)),Ne={class:"form-field-input__wrapper"},xe={class:"multiselect-option"},Be={class:"form-field form-field--basic"},Ee={class:"form-field__label"},Ae={key:0},Fe={class:"form-field-input__wrapper"},Pe=["name","onUpdate:modelValue"],we={key:4,class:"section"},Ue={class:"list"},je={class:"list-col list-col--md"},Te=Z(()=>u("div",{class:"list-item__title"},[H("Тариф"),u("span",null,"*")],-1)),Me={key:5,class:"section"},Le={class:"list"},Re={class:"list-col list-col--md"},Ke={class:"list-item__title"},We={key:0},He={key:6,class:"section"},Ye={class:"total-block block--divider"},qe={class:"total-block__row total-block__row--big"},ze={class:"total-block__col"},Ge={class:"total-block__col"},Je={key:7,class:"additional-service__inline-price"};function Qe(t,f,s,o,v,g){var V,h,M,L,R,B,P,E,w,A;const N=De,i=_e,x=ee("Multiselect"),k=X,T=ue;return _(),D(U,null,[s.isInline?b("",!0):(_(),D("div",be,[u("div",Ce,[u("h1",pe,C((V=s.sectionData)==null?void 0:V.Item),1),Y(N,{partition:`Header:${((h=s.sectionData)==null?void 0:h.Code)==="Default"?s.sectionID:`/${(M=s.sectionData)==null?void 0:M.Code}Orders`}`},null,8,["partition"])])])),s.isInline?b("",!0):(_(),q(i,{key:1,class:"additional-service__contract-select",title:"Договор",modelValue:o.contractSelect,"onUpdate:modelValue":f[0]||(f[0]=l=>o.contractSelect=l)},null,8,["modelValue"])),((L=o.getDependOrders)==null?void 0:L.length)>0?(_(),D("div",Ve,[me,u("div",Ne,[Y(x,{class:"multiselect--white",placeholder:"Все заказы",label:"name",disabled:((R=o.getDependOrders)==null?void 0:R.length)<=1,options:o.getDependOrders,modelValue:o.DependOrderID,"onUpdate:modelValue":f[1]||(f[1]=l=>o.DependOrderID=l)},{option:ae(({option:l})=>[u("div",xe,C(l.name),1)]),_:1},8,["disabled","options","modelValue"])])])):b("",!0),((B=o.getInputFields)==null?void 0:B.length)>0?(_(!0),D(U,{key:3},K(o.getInputFields,l=>(_(),D("div",Be,[u("div",Ee,[H(C(l==null?void 0:l.Name),1),l!=null&&l.IsDuty?(_(),D("span",Ae,"*")):b("",!0)]),u("div",Fe,[oe(u("input",{name:`ID${l==null?void 0:l.ID}`,"onUpdate:modelValue":y=>o.formData[`ID${l==null?void 0:l.ID}`]=y},null,8,Pe),[[ne,o.formData[`ID${l==null?void 0:l.ID}`]]])])]))),256)):b("",!0),((P=s.sectionData)==null?void 0:P.Code)!=="Default"&&((E=o.getAdditionalServicesSchemes)==null?void 0:E.length)>0?(_(),D("div",we,[u("div",Ue,[u("div",je,[Te,(_(!0),D(U,null,K(o.getAdditionalServicesSchemes,l=>{var y,p;return _(),q(k,{name:`${(y=s.sectionData)==null?void 0:y.Code}SchemeID`,checkbox:!1,data:l,modelValue:o.formData[`${(p=s.sectionData)==null?void 0:p.Code}SchemeID`],"onUpdate:modelValue":f[2]||(f[2]=n=>{var a;return o.formData[`${(a=s.sectionData)==null?void 0:a.Code}SchemeID`]=n})},null,8,["name","data","modelValue"])}),256))])])])):b("",!0),((w=o.getSelectFields)==null?void 0:w.length)>0?(_(),D("div",Me,[u("div",Le,[(_(!0),D(U,null,K(o.getSelectFields,l=>(_(),D("div",Re,[u("div",Ke,[H(C(l==null?void 0:l.Name),1),l!=null&&l.IsDuty?(_(),D("span",We,"*")):b("",!0)]),(_(!0),D(U,null,K(o.getSelectFieldOptions(l),y=>(_(),q(k,{name:`ID${l==null?void 0:l.ID}`,checkbox:!1,data:y,modelValue:o.formData[`ID${l==null?void 0:l.ID}`],"onUpdate:modelValue":p=>o.formData[`ID${l==null?void 0:l.ID}`]=p},null,8,["name","data","modelValue","onUpdate:modelValue"]))),256))]))),256))])])):b("",!0),s.isInline?(_(),D("div",Je,C(o.finalPrice()||0)+" ₽",1)):(_(),D("div",He,[u("div",Ye,[u("div",qe,[u("div",ze,"Итого за 1 "+C((A=s.sectionData)==null?void 0:A.Measure),1),u("div",Ge,C(o.finalPrice()||0)+" ₽",1)])]),Y(T,{class:"btn--wide",disabled:o.getButtonDisableCondition,label:"Заказать","is-loading":o.isLoading,onClick:f[3]||(f[3]=l=>o.payForOrder())},null,8,["disabled","is-loading"])]))],64)}const Xe={components:{InputBorderCheckboxRadio:X,Multiselect:ce},props:{modelValue:{type:Object,default:()=>{}},sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},emits:["updateList","update:modelValue"],setup(t,{emit:f}){const s=re(),o=se(),v=te(),g=le(),N=de(),i=m({}),x=m(null),k=m(null),T=m(null),V=m(null),h=m(!1),M=ie("emitter"),L=j(()=>{var n,a;return(a=Object.keys((o==null?void 0:o.additionalServicesScheme[(n=t.sectionData)==null?void 0:n.Code])||{}))==null?void 0:a.map(e=>{var d,r,S,I,c,O,F;return{...o==null?void 0:o.additionalServicesScheme[(d=t.sectionData)==null?void 0:d.Code][e],value:(S=o==null?void 0:o.additionalServicesScheme[(r=t.sectionData)==null?void 0:r.Code][e])==null?void 0:S.ID,price:(c=o==null?void 0:o.additionalServicesScheme[(I=t.sectionData)==null?void 0:I.Code][e])==null?void 0:c.CostMonth,name:(F=o==null?void 0:o.additionalServicesScheme[(O=t.sectionData)==null?void 0:O.Code][e])==null?void 0:F.Name}}).sort((e,d)=>Number(e==null?void 0:e.SortID)<Number(d==null?void 0:d.SortID)?-1:Number(e==null?void 0:e.SortID)>Number(d==null?void 0:d.SortID)?1:0).filter(e=>e==null?void 0:e.IsActive)}),R=j(()=>{var a;let n=!1;return(a=P.value)==null||a.forEach(e=>{e!=null&&e.IsDuty&&(i.value[`ID${e==null?void 0:e.ID}`]===null||i.value[`ID${e==null?void 0:e.ID}`]===void 0||i.value[`ID${e==null?void 0:e.ID}`]==="")&&(n=!0)}),n}),B=j(()=>{var n;return(n=t.sectionData)==null?void 0:n.ServicesFields.filter(a=>(a==null?void 0:a.TypeID)==="Select").sort((a,e)=>Number(a==null?void 0:a.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(a==null?void 0:a.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),P=j(()=>{var n;return(n=t.sectionData)==null?void 0:n.ServicesFields.filter(a=>(a==null?void 0:a.TypeID)==="Input").sort((a,e)=>Number(a==null?void 0:a.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(a==null?void 0:a.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),E=j(()=>{var n;return(n=t.sectionData)==null?void 0:n.DependOrders.map(a=>{var e,d,r,S;return{...v==null?void 0:v.userOrders[a],name:((d=o.ServicesList[(e=v==null?void 0:v.userOrders[a])==null?void 0:e.ServiceID])==null?void 0:d.Code)+": "+((r=v==null?void 0:v.userOrders[a])==null?void 0:r.ID),value:(S=v==null?void 0:v.userOrders[a])==null?void 0:S.ID}})});function w(){var a;let n=0;return Object.keys(i.value).map(e=>{var d,r;(d=i.value[e])!=null&&d.price&&(n=n+Number((r=i.value[e])==null?void 0:r.price))}),n+Number((a=t.sectionData)==null?void 0:a.Cost)}function A(n){var a,e;return(e=(a=n==null?void 0:n.Options)==null?void 0:a.split(`
`))==null?void 0:e.map(d=>{let r=d.split("=");return{value:r[0],name:r[1],price:r[2]}})}function l(){var a;h.value=!0;let n={};(a=Object.keys(i.value))==null||a.forEach(e=>{var d,r;n[e]=(d=i.value[e])!=null&&d.value?(r=i.value[e])==null?void 0:r.value:i.value[e]}),n.ContractID=T.value,n.ServiceID=t.sectionID,n.DependOrderID=V.value,console.log(t.sectionID),t.sectionID==="50000"?o.ExtraIPOrder(n).then(({result:e,info:d,error:r})=>{console.log("ExtraIPOrder - ",e),h.value=!1,e==="SUCCESS"?M.emit("open-modal",{component:"ExtraIPOrderPay"}):e==="BASKET"&&g.push("/Basket")}):t.sectionID==="51000"?o.ISPswOrder(n).then(({result:e})=>{h.value=!1,e==="SUCCESS"?g.push(`/AdditionalServices?ServiceID=${t.sectionID}`):e==="BASKET"&&g.push("/Basket")}):t.sectionID==="52000"?o.DNSmanagerOrder(n).then(({result:e,info:d,error:r})=>{console.log("DNSManager - ",e),h.value=!1,e==="SUCCESS"?g.push(`/AdditionalServices?ServiceID=${t.sectionID}`):e==="BASKET"&&g.push("/Basket")}):o.ServiceOrder(n).then(({result:e,info:d,error:r})=>{var S;e==="SUCCESS"?o.ServiceOrderPay((S=t.sectionData)==null?void 0:S.Code,{AmountPay:"1",ServiceOrderID:d==null?void 0:d.ServiceOrderID,IsChange:!0}).then(I=>{let{result:c,error:O}=I;c==="SUCCESS"?g.push(`/AdditionalServices?ServiceID=${t.sectionID}`):c==="BASKET"&&g.push("/Basket"),h.value=!1}):h.value=!1})}function y(){var a;let n={};(a=Object.keys(i.value))==null||a.forEach(e=>{var d,r;n[e]=(d=i.value[e])!=null&&d.value?(r=i.value[e])==null?void 0:r.value:i.value[e]}),n.ServiceID=t.sectionID,n.Price=w(),f("update:modelValue",n)}function p(){var n,a;if(t.modelValue){const e=(n=Object.keys(t.modelValue))==null?void 0:n.find(d=>d.includes("SchemeID"));e&&((a=i.value[e])!=null&&a.ID||(i.value[e]={}),i.value[e].ID=t.modelValue[e])}}return W(N,()=>{var n,a,e,d,r,S,I;p(),t.updateWithPageTransition&&((n=B.value)==null||n.forEach(c=>{var O;i.value[`ID${c==null?void 0:c.ID}`]&&(i.value[`ID${c==null?void 0:c.ID}`]=(O=A(c))==null?void 0:O.find(F=>F.value===(c==null?void 0:c.Default)))}),((a=t.sectionData)==null?void 0:a.Code)!=="Default"&&o.fetchAdditionalServiceScheme((e=t.sectionData)==null?void 0:e.Code),((r=(d=t.sectionData)==null?void 0:d.DependOrders)==null?void 0:r.length)>0&&(V.value=(I=(S=E.value)==null?void 0:S[0])==null?void 0:I.ID))}),W(i.value,()=>{y()}),W(t,()=>{p()}),G(()=>{var n,a,e,d,r,S,I;(n=B.value)==null||n.forEach(c=>{var O;i.value[`ID${c==null?void 0:c.ID}`]=(O=A(c))==null?void 0:O.find(F=>F.value===(c==null?void 0:c.Default))}),((a=t.sectionData)==null?void 0:a.Code)!=="Default"&&o.fetchAdditionalServiceScheme((e=t.sectionData)==null?void 0:e.Code),((r=(d=t.sectionData)==null?void 0:d.DependOrders)==null?void 0:r.length)>0&&(V.value=(I=(S=E.value)==null?void 0:S[0])==null?void 0:I.ID),p(),y()}),{contractSelect:T,contractsStore:s,getSelectFields:B,getInputFields:P,selectServerModel:x,isLoading:h,getButtonDisableCondition:R,getAdditionalServicesSchemes:L,getSelectFieldOptions:A,getDependOrders:E,DependOrderID:V,operationSystem:k,formData:i,finalPrice:w,payForOrder:l}}},la=z(Xe,[["render",Qe],["__scopeId","data-v-758a6e8b"]]);export{la as S};
