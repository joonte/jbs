import{_ as $}from"./ButtonDefault-B1FApUky.js";import{u as O}from"./services-moLhYNFg.js";import{f as y,g as R}from"./BlockBalanceAgreement-DSLTUOoQ.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as A,f as B,c as n,h as S,o as l,a as e,b,t as u,v as p,F as w,i as k,x as C,d as N,w as L,e as P}from"./index-C9dBN6m4.js";import{_ as T}from"./BlueButton.vue_vue_type_script_setup_true_lang-q3k2Q2g8.js";import{_ as V}from"./StatusBadge-DZmmWv0G.js";const H={key:0},U={class:"total-block"},j={class:"total-block__row"},F={class:"total-block__col"},M={class:"total-block__col"},W={class:"total-block__col"},K={class:"total-block__row total-block__row--big"},q={class:"total-block__col"},z={__name:"BlockAdditionalServicesTotalAmount",props:{services:Array,mainOrder:Object},setup(d){const o=d,_=O(),m=A(!1),v=C("emitter"),f=B(()=>{if(!o.services||!Array.isArray(o.services))return 0;let c=0;return o.services.forEach(s=>{s&&typeof s.Price=="number"&&(c+=s.Price)}),c});async function a(){if(!(!o.services||!Array.isArray(o.services)||o.services.length===0))for(const c of o.services){if(!c)continue;let s="SUCCESS",t=_.ServicesList[c.ServiceID]?.Code;const r={Code:t,DependOrderID:o.mainOrder.OrderID,...c,ContractID:o.mainOrder.ContractID};try{const{result:g,info:I,error:ie}=await _.ServiceOrder(r);if(g==="SUCCESS"){let D={};t==="Default"?D.ServiceOrderID=I?.ServiceOrderID:D[`${t}OrderID`]=I?.ServiceOrderID;const x=await _.ServiceOrderPay(t,D);let{result:h,error:ae}=x;h==="SUCCESS"?(v.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),router.push("/AdditionalServices")):h==="BASKET"&&router.push("/Basket")}else s="ERROR",v.emit("open-error-modal",{component:"ExclusionWindow",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(g){console.error("Ошибка при заказе услуги:",g),s="ERROR",v.emit("open-error-modal",{component:"ExclusionWindow",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(s==="ERROR")break}}async function i(){m.value=!0;try{await a()}catch{v.emit("open-error-modal",{component:"ExclusionWindow",data:{message:"Произошла ошибка при заказе услуг"}})}finally{m.value=!1}}return(c,s)=>{const t=$;return d.services?.length?(l(),n("div",H,[e("div",U,[e("div",j,[s[1]||(s[1]=e("div",{class:"total-block__col"},"Дополнительные услуги",-1)),e("div",F,u(p(y)(f.value)),1)]),(l(!0),n(w,null,k(d.services,r=>(l(),n("div",{key:r.ServiceID,class:"total-block__row no-divider"},[e("div",M,u(p(_).ServicesList[r.ServiceID]?.Name),1),e("div",W,u(p(y)(r.Price)),1)]))),128)),e("div",K,[s[2]||(s[2]=e("div",{class:"total-block__col"},"Итого к оплате",-1)),e("div",q,u(p(y)(f.value)),1)])]),b(t,{class:"btn--wide",disabled:!d.services||d.services.length===0||m.value,"is-loading":m.value,label:"Заказать дополнительные услуги",onClick:s[0]||(s[0]=r=>i())},null,8,["disabled","is-loading"])])):S("",!0)}}},ve=E(z,[["__scopeId","data-v-b10613d3"]]),G={key:0},J={class:"tw-grid tw-grid-cols-1 lg:tw-grid-cols-2 xl:tw-grid-cols-3 tw-gap-4 tw-mt-4"},Q={class:"tw-flex tw-items-center tw-justify-between tw-gap-2"},X={class:"tw-text-lg tw-font-medium"},Y={class:"tw-text-gray-500 tw-mt-1"},Z={key:0,class:"tw-mt-1"},ee={class:"tw-space-y-2 tw-mt-4"},te={key:0},se={class:"tw-font-bold"},re=["innerHTML"],oe={class:"tw-mt-4"},pe={__name:"BlockDependentServices",props:{services:Array},setup(d){const o=N(),_=O(),m=C("emitter");function v(a){let i="Orders";a.ServiceID===5e4?i="ExtraIPOrders":a.ServiceID===51e3?i="ISPswOrders":a.ServiceID===52e3&&(i="DNSmanagerOrders"),m.emit("open-modal",{component:"StatusHistory",data:{modeID:i,rowID:a.OrderID}})}function f(a){o.push(R(a.Code,a.OrderID))}return(a,i)=>{const c=V,s=T;return d.services.length?(l(),n("div",G,[i[1]||(i[1]=e("h2",{class:"tw-text-xl tw-font-medium"},"Заказанные услуги",-1)),e("div",J,[(l(!0),n(w,null,k(d.services,t=>(l(),n("div",{key:t.ID,class:"tw-p-4 tw-border tw-border-gray-200 tw-rounded-lg"},[e("div",Q,[e("div",X,u(p(_).ServicesList[t.ServiceID]?.Name||t.ServiceName||`Услуга #${t.ServiceID}`),1),e("div",null,[b(c,{status:t.StatusID,"status-table":"Orders",onClick:r=>v(t),class:"tw-cursor-pointer"},null,8,["status","onClick"])])]),e("div",Y,[e("div",null,"Заказ #"+u(t.ID),1),t.DaysRemainded?(l(),n("div",Z,"Осталось дней: "+u(t.DaysRemainded),1)):S("",!0)]),e("div",ee,[(l(!0),n(w,null,k(t.AdditionalInfo,r=>(l(),n(w,null,[r.Value?(l(),n("div",te,[e("div",se,u(r.Key),1),e("div",{class:"tw-whitespace-pre",innerHTML:r.Value},null,8,re)])):S("",!0)],64))),256))]),e("div",oe,[b(s,{onClick:r=>f(t),type:"small",class:"tw-uppercase tw-font-bold"},{default:L(()=>i[0]||(i[0]=[P("Перейти к заказу",-1)])),_:2,__:[0]},1032,["onClick"])])]))),128))])])):S("",!0)}}};export{pe as _,ve as a};
