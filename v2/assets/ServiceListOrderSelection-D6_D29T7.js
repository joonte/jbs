import{_ as se}from"./ButtonDefault-eJbeaBtE.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as d,o as u,a as l,L as le,i as p,t as S,r as k,m as E,h as K,O as re,f as y,g as ie,s as ue,D as T,b as A,e as $,w as Q,v as de,F as N,j as x,I as ce,P as ve,d as fe}from"./index-XtiBO-PZ.js";import{_ as De}from"./BasicInput-TTn3Hxre.js";import{_ as me}from"./BlockSelectContract-BJLjloC1.js";import{_ as pe}from"./ClausesKeeper-DEgaQ2N3.js";import{u as Se}from"./contracts-BdlSA9YT.js";import{u as Ie}from"./services-izfy4zss.js";import{s as _e}from"./multiselect-eqvbz1NV.js";const he={props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(r,{emit:h}){const v=k(null);function a(){h("update:modelValue",r.data)}return E(r,()=>{v.value=r.modelValue}),K(()=>{v.value=r.modelValue}),{updateValue:a,inputValue:v}}},be={class:"form-input_border"},Oe=["checked","name","type"],ye={class:"form-input_border-content"},ke={class:"form-input_border-item form-input_border-item--left"},Ce={class:"form-input_border-item form-input_border-item--right"};function Ve(r,h,v,a,q,U){return u(),d("label",be,[l("input",{checked:a.inputValue?.value===v.data?.value,name:v.name,type:v.checkbox?"checkbox":"radio",onInput:h[0]||(h[0]=(...i)=>a.updateValue&&a.updateValue(...i))},null,40,Oe),l("span",ye,[h[1]||(h[1]=l("span",{class:"form-input_border-mark"},null,-1)),l("span",ke,S(v.data?.name),1),v.data.price?le(r.$slots,"default",{key:0},()=>[l("span",Ce,S(v.data?.price),1)],!0):p("",!0)])])}const ge=Y(he,[["render",Ve],["__scopeId","data-v-c6ed1d5b"]]),$e={key:0},Ne={class:"section-header"},Ee={key:2,class:"form-field form-field--basic"},Pe={class:"form-field-input__wrapper"},je={key:3,class:"form-field form-field--basic"},Be={class:"form-field-input__wrapper"},we={class:"multiselect-option"},Ae={class:"form-field__label"},xe={key:0},Ue={class:"form-field-input__wrapper"},Le=["title","name","onUpdate:modelValue"],Fe={key:5},Me={class:"list"},Te={class:"list-col list-col--md"},Ke={key:6},qe={class:"list"},Re={class:"list-item__title"},He={key:0},We={class:"list-item__prompt"},Xe={key:7},ze={class:"total-block block--divider"},Ge={class:"total-block__row total-block__row--big"},Je={class:"total-block__col"},Qe={key:8,class:"additional-service__inline-price"},Ye={__name:"ServiceListOrderSelection",props:{modelValue:{type:Object,default:()=>({})},sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},emits:["updateList","update:modelValue"],setup(r,{expose:h,emit:v}){const a=r,q=v,U=Se(),i=Ie(),Z=re(),I=fe(),R=ie(),o=k({}),ee=k(null),te=k(null),C=k(null),D=k(""),P=k(null),b=k(!1),H=y(()=>U?.contractsList),L=y(()=>Object.keys(i?.additionalServicesScheme[a.sectionData?.Code]||{})?.map(e=>{const t=i?.additionalServicesScheme[a.sectionData?.Code][e]?.DependOrders||{},s=Object.keys(t);return{...i?.additionalServicesScheme[a.sectionData?.Code][e],value:i?.additionalServicesScheme[a.sectionData?.Code][e]?.ID,price:i?.additionalServicesScheme[a.sectionData?.Code][e]?.CostMonth,name:i?.additionalServicesScheme[a.sectionData?.Code][e]?.Name,dependOrders:s}}).sort((e,t)=>Number(e?.SortID)<Number(t?.SortID)?-1:Number(e?.SortID)>Number(t?.SortID)?1:0).filter(e=>D.value==="0"?e.IsActive&&e.dependOrders.length===0:D.value===null||D.value===""?e.IsActive:e.IsActive&&e.dependOrders.includes(D.value))),W=y(()=>{let e=!1;return j.value?.forEach(t=>{t?.IsDuty&&(o.value[`ID${t?.ID}`]===null||o.value[`ID${t?.ID}`]===void 0||o.value[`ID${t?.ID}`]==="")&&(e=!0)}),e}),V=y(()=>a.sectionData?.ServicesFields?.filter(e=>e?.TypeID==="Select").sort((e,t)=>Number(e?.SortID)<Number(t?.SortID)?-1:Number(e?.SortID)>Number(t?.SortID)?1:0)||[]),j=y(()=>a.sectionData?.ServicesFields?.filter(e=>e?.TypeID==="Input").sort((e,t)=>Number(e?.SortID)<Number(t?.SortID)?-1:Number(e?.SortID)>Number(t?.SortID)?1:0)||[]),B=y(()=>{let e=[];const t=i?.additionalServicesScheme[a.sectionData?.Code];if(a.sectionData?.Code==="Default"){const c=Object.keys(i?.ServicesList)?.map(f=>({...i?.ServicesList[f],value:i?.ServicesList[f]?.ID})).filter(f=>f?.ID===R.query.ServiceID);if(c.length>0){const f=c[0].DependOrders;f&&(e=Object.entries(f).map(([n,O])=>({name:O,value:n})))}return e}if(!t)return e;const s=Object.values(t).filter(c=>c?.IsActive&&c?.DependOrders).flatMap(c=>Object.entries(c.DependOrders)),m=new Map;s.forEach(([c,f])=>{const n=`${c}:${f}`;m.has(n)||m.set(n,{name:f,value:c})});const _=Array.from(m.values());return a.sectionID==="51000"?e=[{name:"Без заказа",value:"0"},..._]:e=_,e}),ae=y(()=>{const e=i?.additionalServicesScheme[a.sectionData?.Code];return e?Object.values(e).filter(s=>s?.IsActive&&s?.DependOrders).flatMap(s=>Object.entries(s.DependOrders)).map(([s,m])=>({name:m,value:s})):[]}),ne=y(()=>{const e=o.value[`${a.sectionData?.Code}SchemeID`]?.ID,t=i?.additionalServicesScheme[a.sectionData?.Code];if(!e)return ae.value;const s=t?.[e];return s&&s.DependOrders?Object.entries(s.DependOrders).map(([m,_])=>({name:_,value:m})):[]});E(()=>a.sectionID,()=>{D.value=""});const X=e=>{e.key==="Enter"&&e.ctrlKey&&F()};K(()=>{document.addEventListener("keyup",X)}),ue(()=>{document.removeEventListener("keyup",X)});function z(){I.go(0)}function g(){let e=0;return Object.keys(o.value).map(t=>{o.value[t]?.price&&(e=e+Number(o.value[t]?.price))}),e+Number(a.sectionData?.Cost)+Number(a.sectionData?.CostOn)}function w(e){return e?.Options?.split(`
`)?.map(t=>{let s=t.split("=");return{value:s[0],name:s[1],price:s[2]}})}function G(){return a.sectionID==="50000"&&B.value.length<1}function F(){b.value=!0;let e={};Object.keys(o.value)?.forEach(t=>{e[t]=o.value[t]?.value?o.value[t]?.value:o.value[t]}),e.ContractID=C.value,e.ServiceID=a.sectionID,e.DependOrderID=D.value,D.value==="0"&&(e.IP=P.value),a.sectionID==="50000"?i.ExtraIPOrder(e).then(({result:t,info:s})=>{b.value=!1,t==="SUCCESS"?I.push(`/ExtraIPOrderPay/${s.OrderID}`):t==="BASKET"&&I.push("/Basket")}):a.sectionID==="51000"?i.ISPswOrder(e).then(({result:t,info:s})=>{b.value=!1,t==="SUCCESS"?I.push(`/ISPswOrderPay/${s.OrderID}`):t==="BASKET"&&I.push("/Basket")}):a.sectionID==="52000"?i.DNSmanagerOrder(e).then(({result:t,info:s})=>{b.value=!1,t==="SUCCESS"?I.push(`/DNSmanagerOrderPay/${s.OrderID}`):t==="BASKET"&&I.push("/Basket")}):i.ServiceOrder(e).then(({result:t,info:s})=>{t==="SUCCESS"?i.ServiceOrderPay(a.sectionData?.Code,{AmountPay:"1",ServiceOrderID:s?.ServiceOrderID,IsChange:!0},{XMLHttpRequest:"yes"}).then(m=>{let{result:_}=m;_==="SUCCESS"?I.push(`/AdditionalServices?ServiceID=${a.sectionID}`):_==="BASKET"&&I.push("/Basket"),b.value=!1}):b.value=!1})}function J(){let e={};Object.keys(o.value)?.forEach(t=>{e[t]=o.value[t]?.value?o.value[t]?.value:o.value[t]}),e.ServiceID=a.sectionID,e.Price=g(),q("update:modelValue",e)}function M(){if(a.modelValue){const e=Object.keys(a.modelValue)?.find(t=>t.includes("SchemeID"));e&&(o.value[e]?.ID||(o.value[e]={}),o.value[e].ID=a.modelValue[e])}}return E(R,()=>{M(),a.updateWithPageTransition&&(V.value?.forEach(e=>{o.value[`ID${e?.ID}`]&&(o.value[`ID${e?.ID}`]=w(e)?.find(t=>t.value===e?.Default))}),a.sectionData?.Code!=="Default"&&i.fetchAdditionalServiceScheme(a.sectionData?.Code))}),E(o.value,()=>{J()}),E(a,()=>{M()}),K(async()=>{V.value?.forEach(e=>{o.value[`ID${e?.ID}`]=w(e)?.find(t=>t.value===e?.Default)}),a.sectionData?.Code!=="Default"&&await i.fetchAdditionalServiceScheme(a.sectionData?.Code),await Z.fetchDomains(),M(),J()}),h({contractSelect:C,contractsStore:U,getSelectFields:V,getInputFields:j,selectServerModel:ee,isLoading:b,getButtonDisableCondition:W,getAdditionalServicesSchemes:L,getSelectFieldOptions:w,getDependOrders:B,DependOrderID:D,operationSystem:te,formData:o,finalPrice:g,payForOrder:F,filteredDependOrders:ne,serviceIP:P,isDepend:G,reloadNow:z,getContracts:H}),(e,t)=>{const s=pe,m=me,_=De,c=ge,f=se;return u(),d(N,null,[r.isInline?p("",!0):(u(),d("section",$e,[l("div",Ne,[l("h1",{class:"section-title",onClick:t[0]||(t[0]=n=>z())},S(r.sectionData?.Item),1),A(s,{partition:`Header:${r.sectionData?.Code==="Default"?r.sectionID:`/${r.sectionData?.Code}Orders`}`},null,8,["partition"])])])),r.isInline?p("",!0):(u(),T(m,{key:1,class:"additional-service__contract-select",title:"Договор",modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=n=>C.value=n)},null,8,["modelValue"])),D.value==="0"&&r.sectionID==="51000"?(u(),d("div",Ee,[t[7]||(t[7]=l("div",{class:"form-field__label"},[$(" IP адрес лицензии "),l("span",null,"*")],-1)),l("div",Pe,[A(_,{name:"ServiceIP",placeholder:"0.0.0.0",modelValue:P.value,"onUpdate:modelValue":t[2]||(t[2]=n=>P.value=n)},null,8,["modelValue"])])])):p("",!0),B.value?.length>0?(u(),d("div",je,[t[8]||(t[8]=l("div",{class:"form-field__label"},[$(" Выбрать заказ "),l("span",null,"*")],-1)),l("div",Be,[A(de(_e),{placeholder:"Все заказы",class:"multiselect--white",label:"name","track-by":"value",options:B.value,modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=n=>D.value=n)},{option:Q(({option:n})=>[l("div",we,S(n.name),1)]),_:1},8,["options","modelValue"])])])):p("",!0),j.value?.length>0?(u(!0),d(N,{key:4},x(j.value,n=>(u(),d("div",{class:"form-field form-field--basic",key:n?.ID},[l("div",Ae,[$(S(n?.Name)+" ",1),n?.IsDuty?(u(),d("span",xe,"*")):p("",!0)]),l("div",Ue,[ce(l("input",{title:n?.Prompt,name:`ID${n?.ID}`,"onUpdate:modelValue":O=>o.value[`ID${n?.ID}`]=O},null,8,Le),[[ve,o.value[`ID${n?.ID}`]]])])]))),128)):p("",!0),r.sectionData?.Code!=="Default"&&L.value?.length>0?(u(),d("section",Fe,[l("div",Me,[l("div",Te,[t[9]||(t[9]=l("div",{class:"list-item__title"},[$(" Тариф "),l("span",null,"*")],-1)),(u(!0),d(N,null,x(L.value,n=>(u(),T(c,{key:n.value,name:`${r.sectionData?.Code}SchemeID`,checkbox:!1,data:n,modelValue:o.value[`${r.sectionData?.Code}SchemeID`],"onUpdate:modelValue":t[4]||(t[4]=O=>o.value[`${r.sectionData?.Code}SchemeID`]=O),disabled:G()},null,8,["name","data","modelValue","disabled"]))),128))])])])):p("",!0),V.value?.length>0?(u(),d("section",Ke,[l("div",qe,[(u(!0),d(N,null,x(V.value,n=>(u(),d("div",{class:"list-col list-col--md",key:n?.ID},[l("div",Re,[$(S(n?.Name)+" ",1),n?.IsDuty?(u(),d("span",He,"*")):p("",!0)]),(u(!0),d(N,null,x(w(n),O=>(u(),T(c,{key:O.value,name:`ID${n?.ID}`,checkbox:!1,data:O,modelValue:o.value[`ID${n?.ID}`],"onUpdate:modelValue":oe=>o.value[`ID${n?.ID}`]=oe},{default:Q(()=>[l("div",We,S(n?.Prompt),1)]),_:2},1032,["name","data","modelValue","onUpdate:modelValue"]))),128))]))),128))])])):p("",!0),r.isInline?(u(),d("div",Qe,S(g()||0)+" ₽",1)):(u(),d("section",Xe,[l("div",ze,[l("div",Ge,[l("div",Je," Итого за 1 "+S(r.sectionData?.ID==="50000"||r.sectionData?.ID==="51000"||r.sectionData?.ID==="52000"?"месяц":r.sectionData?.Measure),1),l("div",{class:"total-block__col",onClick:t[5]||(t[5]=n=>console.log(C.value))},S(g()||0)+" ₽",1)])]),A(f,{class:"btn--wide",disabled:W.value||!o.value[`${r.sectionData.Code}SchemeID`]&&r.sectionData?.Code!=="Default",label:parseFloat(H.value[C.value]?.Balance)>parseFloat(g())?"Оплатить c баланса договора":"Заказать","is-loading":b.value,onClick:t[6]||(t[6]=n=>F())},null,8,["disabled","label","is-loading"])]))],64)}}},it=Y(Ye,[["__scopeId","data-v-984ba08e"]]);export{it as _};
