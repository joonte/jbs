import{E as ve}from"./EmptyStateBlock-c1b0587e.js";import{_ as me}from"./BlockOrderPayBalance-756afe5c.js";import{_ as pe}from"./ClausesKeeper-3ae27028.js";import{_ as he}from"./ButtonDefault-40efcd87.js";import{_ as be,a7 as ge,e as ye,S as ke,r as p,g as B,i as fe,O as De,ag as S,o as r,c as _,b as d,a as e,t as c,F as I,x as Be,k as Ie,Z as ie,a9 as re,p as we,l as Pe}from"./index-6f846e0d.js";import{u as Se}from"./hosting-aad12620.js";import{u as Ce}from"./contracts-b643bcd5.js";import{_ as Ee}from"./paramsAccordionBlock-a5cc854f.js";import{B as He}from"./BlockBalanceAgreement-4579706c.js";import"./bootstrap-vue-next.es-6bf04585.js";import"./IconHelp-ddbfd315.js";import"./globalActions-d40367d6.js";import"./component-32b750ca.js";import"./IconClose-12869131.js";import"./IconArrow-37547b0b.js";/* empty css                                                                             */const C=g=>(we("data-v-344208ee"),g=g(),Pe(),g),Oe={key:0,class:"hosting-sheme"},xe={class:"section"},Le={class:"container"},Fe={class:"section-header"},Ne={class:"section-header__wrapper"},Re={class:"section-title"},$e={class:"section-container"},Ae={class:"section-label __login"},Ke=C(()=>e("div",{class:"section-label __login"},"/",-1)),Te={class:"section-label __login"},Ue={class:"section"},Ve={class:"container"},je={class:"total-block"},Me={class:"total-block__row divider-bottom"},Ze=C(()=>e("div",{class:"total-block__col"},"Цена тарифа",-1)),qe={class:"total-block__col"},ze={class:"total-block__row no-divider"},Ge={class:"total-block__col"},Je={class:"total-block__col"},Qe={class:"total-block__row total-block__row--big economy-line"},We=C(()=>e("div",{class:"total-block__col red"},"Выгода",-1)),Xe={class:"total-block__col flex-col"},Ye={class:"red"},es={class:"total-block__row total-block__row--big"},ss={class:"total-block__col"},os={class:"total-block__col"},ts={key:1,class:"section"},as={class:"container"},ls={key:1,class:"section"},ns={class:"container"},cs={__name:"HostingProlong",async setup(g){let u,v;const l=Se(),E=Ce(),_e=ge(),H=ye();ke("emitter");const y=p(!1);p(null),p(null),p("");const o=p(null),k=p(!1),n=B(()=>Object.keys(l==null?void 0:l.hostingList).map(s=>l==null?void 0:l.hostingList[s]).find(s=>s.OrderID===_e.params.id)),m=B(()=>{var s,t;return(t=l==null?void 0:l.hostingSchemes)==null?void 0:t[(s=n.value)==null?void 0:s.SchemeID]}),O=B(()=>E.contractsList);function f(s){return Number(s).toFixed(2)||0}function x(){var t,i;let s=0;return(i=(t=o.value)==null?void 0:t.discounts)==null||i.Bonuses.map(h=>{s+=+h.Economy}),s}function w(){var s,t,i;k.value=!0,l.HostingOrderPay({HostingOrderID:(s=n.value)==null?void 0:s.ID,DaysPayFromBallance:((t=o.value)==null?void 0:t.daysFromBalance)||0,DaysPay:(i=o.value)==null?void 0:i.actualDays,IsChange:!0}).then(h=>{var b;let{result:D,error:P}=h;D==="SUCCESS"?H.push(`/HostingOrders/${(b=n.value)==null?void 0:b.OrderID}`):D==="BASKET"&&H.push("/Basket"),k.value=!1})}const L=s=>{s.key==="Enter"&&s.ctrlKey&&!de.value&&w()},de=B(()=>o.value===null);fe(()=>{document.addEventListener("keyup",L),console.log(n,"fixed")}),De(()=>{document.removeEventListener("keyup",L)});function ue(s){o.value=s}return[u,v]=S(()=>l.fetchHostingOrders()),await u,v(),[u,v]=S(()=>l.fetchHostingSchemes()),await u,v(),[u,v]=S(()=>E.fetchContracts()),await u,v(),(s,t)=>{var b,F,N,R,$,A,K,T,U,V,j,M,Z,q,z,G,J,Q,W,X,Y,ee,se,oe,te,ae,le,ne,ce;const i=he,h=pe,D=me,P=ve;return r(),_(I,null,[d(He),n.value?(r(),_("div",Oe,[e("div",xe,[e("div",Le,[e("div",Fe,[e("div",Ne,[e("h1",Re,c((b=n.value)==null?void 0:b.Domain),1),d(i,{class:"btn--wide",label:y.value||((F=O.value[n.value.ContractID])==null?void 0:F.Balance)>((N=o.value)==null?void 0:N.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||((R=o.value)==null?void 0:R.price)===null,"is-loading":k.value,onClick:t[0]||(t[0]=a=>w())},null,8,["label","disabled","is-loading"])]),e("div",$e,[e("div",Ae,"Логин: "+c(($=n.value)==null?void 0:$.Login),1),Ke,e("div",Te,"Тариф: "+c((A=m.value)==null?void 0:A.Name),1)])]),d(h)])]),d(Ee,{"params-list":(K=m.value)==null?void 0:K.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),(T=m.value)!=null&&T.IsPayed&&((U=m.value)!=null&&U.IsProlong)||!((V=m.value)!=null&&V.IsPayed)?(r(),_(I,{key:0},[d(D,{contractID:(j=n.value)==null?void 0:j.ContractID,daysRemainded:(M=n.value)==null?void 0:M.DaysRemainded,scheme:m.value,orderID:(Z=n.value)==null?void 0:Z.OrderID,isOrderID:!0,onSelect:ue,isBalancePay:y.value,"onUpdate:isBalancePay":t[1]||(t[1]=a=>y.value=a)},null,8,["contractID","daysRemainded","scheme","orderID","isBalancePay"]),e("div",Ue,[e("div",Ve,[e("div",je,[((G=(z=(q=o.value)==null?void 0:q.discounts)==null?void 0:z.Bonuses)==null?void 0:G.length)>0?(r(),_(I,{key:0},[e("div",Me,[Ze,e("div",qe,c(f((J=o.value)==null?void 0:J.price))+" ₽",1)]),(r(!0),_(I,null,Be((W=(Q=o.value)==null?void 0:Q.discounts)==null?void 0:W.Bonuses,a=>(r(),_("div",ze,[e("div",Ge,"Скидка "+c(a==null?void 0:a.Discount)+"% на "+c(a==null?void 0:a.Days)+" дней",1),e("div",Je,"-"+c(f(a==null?void 0:a.Economy))+" ₽",1)]))),256))],64)):Ie("",!0),ie(e("div",Qe,[We,e("div",Xe,[e("span",null,[e("s",null,c(f((X=o.value)==null?void 0:X.price))+" ₽",1)]),e("span",Ye,"-"+c(x())+" ₽",1)])],512),[[re,((se=(ee=(Y=o.value)==null?void 0:Y.discounts)==null?void 0:ee.Bonuses)==null?void 0:se.length)>0]]),ie(e("div",es,[e("div",ss,"Итого за "+c((oe=o.value)==null?void 0:oe.label),1),e("div",os,c(f(((te=o.value)==null?void 0:te.price)-x()))+" ₽",1)],512),[[re,(ae=o.value)==null?void 0:ae.price]])]),d(i,{class:"btn--wide",label:y.value||((le=O.value[n.value.ContractID])==null?void 0:le.Balance)>((ne=o.value)==null?void 0:ne.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||((ce=o.value)==null?void 0:ce.price)===null,"is-loading":k.value,onClick:t[2]||(t[2]=a=>w())},null,8,["label","disabled","is-loading"])])])],64)):(r(),_("div",ts,[e("div",as,[d(P,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),_("div",ls,[e("div",ns,[d(P,{label:"не удалось найти заказ хостинга"})])]))],64)}}},Is=be(cs,[["__scopeId","data-v-344208ee"]]);export{Is as default};
