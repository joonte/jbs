import{q as M,r as L,a2 as F,a3 as x,_ as A,o as h,c as u,a as e,j as P,b as D,F as w,x as V,t as _,w as k,k as O,p as T,l as $,S as E,g as S}from"./index-145d9cde.js";import{u as G}from"./contracts-009c925b.js";import{u as q}from"./postings-e3294b77.js";import"./invoices-c06baac9.js";import{S as R}from"./ServerItem-8b8d157d.js";import{B as z}from"./BlockBalanceAgreement-650ad03e.js";import{C as H}from"./bootstrap-vue-next.es-759b1c9f.js";import{_ as J}from"./ClausesKeeper-d3875457.js";import"./IconDots-250f781f.js";import"./IconCard-647fe573.js";import"./StatusBadge-cd3873b5.js";import"./ButtonDefault-6a3a5e1e.js";import"./IconArrow-f2b12a71.js";import"./IconClose-f461656c.js";const K=M("basket",()=>{const n=L(null);async function r(){let o="error";return await F.post(""+x.fetchBasket).then(a=>{n.value=a==null?void 0:a.data}).catch(()=>{o="error"}),o}async function d(o){let a="error";return await F.post(""+x.deleteFromBasket,{...o}).then(f=>{a="success"}).catch(()=>{a="error"}),a}return{basketList:n,fetchBasket:r,deleteFromBasket:d}}),Q={},U={fill:"none",height:"32",viewBox:"0 0 32 32",width:"32",xmlns:"http://www.w3.org/2000/svg"},W=e("rect",{fill:"#F7F9FF",height:"31",rx:"3.5",width:"31",x:".5",y:".5"},null,-1),X=e("path",{d:"M8.5 11h15m-1.665 0v11.667a1.667 1.667 0 0 1-1.667 1.666h-8.333a1.667 1.667 0 0 1-1.667-1.666V11m2.5 0V9.333a1.667 1.667 0 0 1 1.667-1.666h3.333a1.667 1.667 0 0 1 1.667 1.666V11m-5.003 4.167v5m3.336-5v5",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Y=e("rect",{height:"31",rx:"3.5",stroke:"#C7D1ED",width:"31",x:".5",y:".5"},null,-1),Z=[W,X,Y];function j(n,r){return h(),u("svg",U,Z)}const N=A(Q,[["render",j]]),tt=[{key:"ServiceID",label:"Услуга",variant:"td-service"},{key:"OrderID",label:"Номер заказа",variant:"td-service"},{key:"Amount",label:"Период"},{key:"Summ",label:"Сумма"},{key:"controls",label:"Действия",variant:"td-controls"}],p=n=>(T("data-v-ff8172a5"),n=n(),$(),n),et={class:"section"},st={class:"container"},nt=p(()=>e("div",{class:"section-header"},[e("h1",{class:"section-title"},"Корзина")],-1)),ot={key:0,class:"cart-list"},at={key:0,class:"cart-item"},ct=p(()=>e("div",{class:"cart-item__title"},"Заказ",-1)),lt={class:"cart-item__subtitle"},it={class:"cart-item__subtitle-name"},rt=p(()=>e("span",{class:"td-mobile"},"Услуга",-1)),_t={class:"d-block"},dt={class:"d-block table-td-blue"},mt=p(()=>e("span",{class:"td-mobile"},"Номер заказа",-1)),ht=p(()=>e("span",{class:"td-mobile"},"Период",-1)),ut=p(()=>e("span",{class:"td-mobile"},"Сумма",-1)),pt=["onClick"],kt={class:"total-block"},ft={class:"total-block__row"},vt=p(()=>e("div",{class:"total-block__col"},"Итого",-1)),It={class:"total-block__col"},bt=["onClick"],Ct={key:1,class:"notification-field"};function Dt(n,r,d,o,a,f){const v=P("BalanceAgreement"),B=J,g=N,y=H;return h(),u(w,null,[D(v),e("div",et,[e("div",st,[nt,D(B),o.basketContent&&Object.keys(o.basketContent).length>0?(h(),u("div",ot,[(h(!0),u(w,null,V(o.basketContent,(m,I)=>{var b,C;return h(),u(w,null,[m&&m.length>0?(h(),u("div",at,[ct,e("div",lt,[e("div",it,_((C=(b=o.getContracts)==null?void 0:b[I])==null?void 0:C.Customer),1)]),D(y,{class:"basic-table table-cart",items:m,fields:o.basketTableFields},{"cell(ServiceID)":k(t=>{var s,c,l,i;return[rt,e("span",_t,_((l=(c=o.getServices)==null?void 0:c[(s=t.item)==null?void 0:s.ServiceID])==null?void 0:l.Name),1),e("span",dt,_((i=t.item)==null?void 0:i.Comment),1)]}),"cell(OrderID)":k(t=>{var s;return[mt,e("span",null,"№ "+_((s=t.item)==null?void 0:s.OrderID),1)]}),"cell(Amount)":k(t=>{var s,c;return[ht,e("span",null,_((s=t.item)==null?void 0:s.Amount)+" "+_((c=t.item)==null?void 0:c.Measure),1)]}),"cell(Summ)":k(t=>{var s;return[ut,e("span",null,_((s=t.item)==null?void 0:s.Summ)+" ₽",1)]}),"cell(controls)":k(t=>[e("button",{class:"btn-delete btn",onClick:s=>o.deleteFromBasket(t.item)},[D(g)],8,pt)]),_:2},1032,["items","fields"]),e("div",kt,[e("div",ft,[vt,e("div",It,_(o.totalPrice(m))+" ₽",1)]),e("button",{class:"btn btn--blue btn-default btn--wide",onClick:t=>o.choosePaymentSystem(m,I)},"Оплатить заказ",8,bt)])])):O("",!0)],64)}),256))])):(h(),u("div",Ct,"Корзина заказов пуста"))])])],64)}const Bt={components:{IconDelete:N,ServerItem:R,BalanceAgreement:z},async setup(){const n=K(),r=G(),d=q(),o=E("emitter"),a=L(null),f=S(()=>n==null?void 0:n.basketList),v=S(()=>r==null?void 0:r.contractsList),B=S(()=>d==null?void 0:d.servicesList);o.on("form-cart-invoice",t=>{C(t)}),await n.fetchBasket().then(()=>{a.value=f.value}),await r.fetchContracts(),await d.fetchServices();function g(t){var c;let s=0;for(let l=0;l<t.length;l++)s=s+Number((c=t[l])==null?void 0:c.Summ);return Math.round((s+Number.EPSILON)*100)/100}function y(t){n==null||n.deleteFromBasket({RowsIDs:[t==null?void 0:t.ID],TableID:"Basket"}).then(s=>{var c,l;s==="success"&&(((c=n.basketList)==null?void 0:c[t==null?void 0:t.ContractID].filter(i=>(i==null?void 0:i.ID)!==t.ID).length)>0?a.value[t==null?void 0:t.ContractID]=(l=n.basketList)==null?void 0:l[t==null?void 0:t.ContractID].filter(i=>(i==null?void 0:i.ID)!==t.ID):delete a.value[t==null?void 0:t.ContractID])})}function m(){}function I(){}function b(t,s){var c,l;o.emit("open-modal",{component:"InvoiceMakeBasket",data:{ItemID:s,TypeID:(l=(c=v.value)==null?void 0:c[s])==null?void 0:l.TypeID,...t}})}function C(t){delete a.value[t]}return window.FormGet=m.bind(this),window.Mobile=I.bind(this),{getBasket:f,getContracts:v,getServices:B,basketContent:a,totalPrice:g,deleteFromBasket:y,choosePaymentSystem:b,basketTableFields:tt}}},$t=A(Bt,[["render",Dt],["__scopeId","data-v-ff8172a5"]]);export{$t as default};
