import{_ as q,r as C,h as K,i as z,o as _,c as D,a as u,t as O,m as Z,k,p as G,l as J,j as $,b as H,x as Y,w as ee,F as E,v as R,d as W,Y as ae,af as oe,f as ne,e as te,a7 as le,R as de,g as U}from"./index-7c70979b.js";import{u as ie}from"./contracts-6e790117.js";import{u as se}from"./services-66b92f1f.js";import{s as re}from"./multiselect-42ffb1f2.js";import{_ as ce}from"./ButtonDefault-cdd68300.js";import{_ as ue}from"./BlockSelectContract-935b035a.js";import{_ as _e}from"./ClausesKeeper-db215214.js";const De={props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(t,{emit:f}){const s=C(null);function o(){f("update:modelValue",t.data)}return K(t,()=>{s.value=t.modelValue}),z(()=>{s.value=t.modelValue}),{updateValue:o,inputValue:s}}},fe=t=>(G("data-v-414dbe12"),t=t(),J(),t),ve={class:"form-input_border"},he=["checked","name","type"],Se={class:"form-input_border-content"},Ie=fe(()=>u("span",{class:"form-input_border-mark"},null,-1)),ge={class:"form-input_border-item form-input_border-item--left"},ye={class:"form-input_border-item form-input_border-item--right"};function ke(t,f,s,o,v,V){var p,i,m;return _(),D("label",ve,[u("input",{checked:((p=o.inputValue)==null?void 0:p.value)===((i=s.data)==null?void 0:i.value),name:s.name,type:s.checkbox?"checkbox":"radio",onInput:f[0]||(f[0]=(...g)=>o.updateValue&&o.updateValue(...g))},null,40,he),u("span",Se,[Ie,u("span",ge,O((m=s.data)==null?void 0:m.name),1),s.data.price?Z(t.$slots,"default",{key:0},()=>{var g;return[u("span",ye,O((g=s.data)==null?void 0:g.price),1)]},!0):k("",!0)])])}const Q=q(De,[["render",ke],["__scopeId","data-v-414dbe12"]]),X=t=>(G("data-v-9026490a"),t=t(),J(),t),Oe={key:0,class:"section"},be={class:"section-header"},Ce={class:"section-title"},Ve={key:2,class:"form-field form-field--basic"},pe=X(()=>u("div",{class:"form-field__label"},[W("Выбрать заказ"),u("span",null,"*")],-1)),me={class:"form-field-input__wrapper"},Ne={class:"multiselect-option"},xe={class:"form-field form-field--basic"},Be={class:"form-field__label"},Fe={key:0},we={class:"form-field-input__wrapper"},Ae=["name","onUpdate:modelValue"],je={key:4,class:"section"},Ee={class:"list"},Ue={class:"list-col list-col--md"},Pe=X(()=>u("div",{class:"list-item__title"},[W("Тариф"),u("span",null,"*")],-1)),Me={key:5,class:"section"},Te={class:"list"},Le={class:"list-col list-col--md"},Re={class:"list-item__title"},Ke={key:0},We={key:6,class:"section"},He={class:"total-block block--divider"},Ye={class:"total-block__row total-block__row--big"},qe={class:"total-block__col"},ze={class:"total-block__col"},Ge={key:7,class:"additional-service__inline-price"};function Je(t,f,s,o,v,V){var N,b,M,T,x,A,B,j,F,L;const p=_e,i=ue,m=$("Multiselect"),g=Q,P=ce;return _(),D(E,null,[s.isInline?k("",!0):(_(),D("div",Oe,[u("div",be,[u("h1",Ce,O((N=s.sectionData)==null?void 0:N.Item),1),H(p,{partition:`Header:${((b=s.sectionData)==null?void 0:b.Code)==="Default"?s.sectionID:`/${(M=s.sectionData)==null?void 0:M.Code}Orders`}`},null,8,["partition"])])])),s.isInline?k("",!0):(_(),Y(i,{key:1,class:"additional-service__contract-select",title:"Договор",modelValue:o.contractSelect,"onUpdate:modelValue":f[0]||(f[0]=l=>o.contractSelect=l)},null,8,["modelValue"])),((T=o.getDependOrders)==null?void 0:T.length)>0?(_(),D("div",Ve,[pe,u("div",me,[H(m,{class:"multiselect--white",placeholder:"Все заказы",label:"name",disabled:((x=o.getDependOrders)==null?void 0:x.length)<=1,options:o.getDependOrders,modelValue:o.DependOrderID,"onUpdate:modelValue":f[1]||(f[1]=l=>o.DependOrderID=l)},{option:ee(({option:l})=>[u("div",Ne,O(l.name),1)]),_:1},8,["disabled","options","modelValue"])])])):k("",!0),((A=o.getInputFields)==null?void 0:A.length)>0?(_(!0),D(E,{key:3},R(o.getInputFields,l=>(_(),D("div",xe,[u("div",Be,[W(O(l==null?void 0:l.Name),1),l!=null&&l.IsDuty?(_(),D("span",Fe,"*")):k("",!0)]),u("div",we,[ae(u("input",{name:`ID${l==null?void 0:l.ID}`,"onUpdate:modelValue":S=>o.formData[`ID${l==null?void 0:l.ID}`]=S},null,8,Ae),[[oe,o.formData[`ID${l==null?void 0:l.ID}`]]])])]))),256)):k("",!0),((B=s.sectionData)==null?void 0:B.Code)!=="Default"&&((j=o.getAdditionalServicesSchemes)==null?void 0:j.length)>0?(_(),D("div",je,[u("div",Ee,[u("div",Ue,[Pe,(_(!0),D(E,null,R(o.getAdditionalServicesSchemes,l=>{var S,n;return _(),Y(g,{name:`${(S=s.sectionData)==null?void 0:S.Code}SchemeID`,checkbox:!1,data:l,modelValue:o.formData[`${(n=s.sectionData)==null?void 0:n.Code}SchemeID`],"onUpdate:modelValue":f[2]||(f[2]=a=>{var e;return o.formData[`${(e=s.sectionData)==null?void 0:e.Code}SchemeID`]=a})},null,8,["name","data","modelValue"])}),256))])])])):k("",!0),((F=o.getSelectFields)==null?void 0:F.length)>0?(_(),D("div",Me,[u("div",Te,[(_(!0),D(E,null,R(o.getSelectFields,l=>(_(),D("div",Le,[u("div",Re,[W(O(l==null?void 0:l.Name),1),l!=null&&l.IsDuty?(_(),D("span",Ke,"*")):k("",!0)]),(_(!0),D(E,null,R(o.getSelectFieldOptions(l),S=>(_(),Y(g,{name:`ID${l==null?void 0:l.ID}`,checkbox:!1,data:S,modelValue:o.formData[`ID${l==null?void 0:l.ID}`],"onUpdate:modelValue":n=>o.formData[`ID${l==null?void 0:l.ID}`]=n},null,8,["name","data","modelValue","onUpdate:modelValue"]))),256))]))),256))])])):k("",!0),s.isInline?(_(),D("div",Ge,O(o.finalPrice()||0)+" ₽",1)):(_(),D("div",We,[u("div",He,[u("div",Ye,[u("div",qe,"Итого за 1 "+O((L=s.sectionData)==null?void 0:L.Measure),1),u("div",ze,O(o.finalPrice()||0)+" ₽",1)])]),H(P,{class:"btn--wide",disabled:o.getButtonDisableCondition,label:"Заказать","is-loading":o.isLoading,onClick:f[3]||(f[3]=l=>o.payForOrder())},null,8,["disabled","is-loading"])]))],64)}const Qe={components:{InputBorderCheckboxRadio:Q,Multiselect:re},props:{modelValue:{type:Object,default:()=>{}},sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},emits:["updateList","update:modelValue"],setup(t,{emit:f}){const s=ie(),o=se(),v=ne(),V=te(),p=le(),i=C({}),m=C(null),g=C(null),P=C(null),N=C(null),b=C(!1);de("emitter");const M=U(()=>{var n,a;return(a=Object.keys((o==null?void 0:o.additionalServicesScheme[(n=t.sectionData)==null?void 0:n.Code])||{}))==null?void 0:a.map(e=>{var d,r,h,I,c,y,w;return{...o==null?void 0:o.additionalServicesScheme[(d=t.sectionData)==null?void 0:d.Code][e],value:(h=o==null?void 0:o.additionalServicesScheme[(r=t.sectionData)==null?void 0:r.Code][e])==null?void 0:h.ID,price:(c=o==null?void 0:o.additionalServicesScheme[(I=t.sectionData)==null?void 0:I.Code][e])==null?void 0:c.CostMonth,name:(w=o==null?void 0:o.additionalServicesScheme[(y=t.sectionData)==null?void 0:y.Code][e])==null?void 0:w.Name}}).sort((e,d)=>Number(e==null?void 0:e.SortID)<Number(d==null?void 0:d.SortID)?-1:Number(e==null?void 0:e.SortID)>Number(d==null?void 0:d.SortID)?1:0).filter(e=>e==null?void 0:e.IsActive)}),T=U(()=>{var a;let n=!1;return(a=A.value)==null||a.forEach(e=>{e!=null&&e.IsDuty&&(i.value[`ID${e==null?void 0:e.ID}`]===null||i.value[`ID${e==null?void 0:e.ID}`]===void 0||i.value[`ID${e==null?void 0:e.ID}`]==="")&&(n=!0)}),n}),x=U(()=>{var n;return(n=t.sectionData)==null?void 0:n.ServicesFields.filter(a=>(a==null?void 0:a.TypeID)==="Select").sort((a,e)=>Number(a==null?void 0:a.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(a==null?void 0:a.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),A=U(()=>{var n;return(n=t.sectionData)==null?void 0:n.ServicesFields.filter(a=>(a==null?void 0:a.TypeID)==="Input").sort((a,e)=>Number(a==null?void 0:a.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(a==null?void 0:a.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),B=U(()=>{var n;return(n=t.sectionData)==null?void 0:n.DependOrders.map(a=>{var e,d,r,h;return{...v==null?void 0:v.userOrders[a],name:((d=o.ServicesList[(e=v==null?void 0:v.userOrders[a])==null?void 0:e.ServiceID])==null?void 0:d.Code)+": "+((r=v==null?void 0:v.userOrders[a])==null?void 0:r.ID),value:(h=v==null?void 0:v.userOrders[a])==null?void 0:h.ID}})});function j(){var a;let n=0;return Object.keys(i.value).map(e=>{var d,r;(d=i.value[e])!=null&&d.price&&(n=n+Number((r=i.value[e])==null?void 0:r.price))}),n+Number((a=t.sectionData)==null?void 0:a.Cost)}function F(n){var a,e;return(e=(a=n==null?void 0:n.Options)==null?void 0:a.split(`
`))==null?void 0:e.map(d=>{let r=d.split("=");return{value:r[0],name:r[1],price:r[2]}})}function L(){var a;b.value=!0;let n={};(a=Object.keys(i.value))==null||a.forEach(e=>{var d,r;n[e]=(d=i.value[e])!=null&&d.value?(r=i.value[e])==null?void 0:r.value:i.value[e]}),n.ContractID=P.value,n.ServiceID=t.sectionID,console.log(t.sectionID),t.sectionID==="51000"?o.ISPswOrder(n).then(({result:e})=>{b.value=!1,e==="SUCCESS"?V.push(`/AdditionalServices?ServiceID=${t.sectionID}`):e==="BASKET"&&V.push("/Basket")}):t.sectionID==="52000"||o.ServiceOrder(n).then(({result:e,info:d,error:r})=>{var h;e==="SUCCESS"?o.ServiceOrderPay((h=t.sectionData)==null?void 0:h.Code,{AmountPay:"1",ServiceOrderID:d==null?void 0:d.ServiceOrderID,IsChange:!0}).then(I=>{let{result:c,error:y}=I;c==="SUCCESS"?V.push(`/AdditionalServices?ServiceID=${t.sectionID}`):c==="BASKET"&&V.push("/Basket"),b.value=!1}):b.value=!1})}function l(){var a;let n={};(a=Object.keys(i.value))==null||a.forEach(e=>{var d,r;n[e]=(d=i.value[e])!=null&&d.value?(r=i.value[e])==null?void 0:r.value:i.value[e]}),n.ServiceID=t.sectionID,n.Price=j(),f("update:modelValue",n)}function S(){var n,a;if(t.modelValue){const e=(n=Object.keys(t.modelValue))==null?void 0:n.find(d=>d.includes("SchemeID"));e&&((a=i.value[e])!=null&&a.ID||(i.value[e]={}),i.value[e].ID=t.modelValue[e])}}return K(p,()=>{var n,a,e,d,r,h,I;S(),t.updateWithPageTransition&&((n=x.value)==null||n.forEach(c=>{var y;i.value[`ID${c==null?void 0:c.ID}`]&&(i.value[`ID${c==null?void 0:c.ID}`]=(y=F(c))==null?void 0:y.find(w=>w.value===(c==null?void 0:c.Default)))}),((a=t.sectionData)==null?void 0:a.Code)!=="Default"&&o.fetchAdditionalServiceScheme((e=t.sectionData)==null?void 0:e.Code),((r=(d=t.sectionData)==null?void 0:d.DependOrders)==null?void 0:r.length)>0&&(N.value=(I=(h=B.value)==null?void 0:h[0])==null?void 0:I.ID))}),K(i.value,()=>{l()}),K(t,()=>{S()}),z(()=>{var n,a,e,d,r,h,I;(n=x.value)==null||n.forEach(c=>{var y;i.value[`ID${c==null?void 0:c.ID}`]=(y=F(c))==null?void 0:y.find(w=>w.value===(c==null?void 0:c.Default))}),((a=t.sectionData)==null?void 0:a.Code)!=="Default"&&o.fetchAdditionalServiceScheme((e=t.sectionData)==null?void 0:e.Code),((r=(d=t.sectionData)==null?void 0:d.DependOrders)==null?void 0:r.length)>0&&(N.value=(I=(h=B.value)==null?void 0:h[0])==null?void 0:I.ID),S(),l()}),{contractSelect:P,contractsStore:s,getSelectFields:x,getInputFields:A,selectServerModel:m,isLoading:b,getButtonDisableCondition:T,getAdditionalServicesSchemes:M,getSelectFieldOptions:F,getDependOrders:B,DependOrderID:N,operationSystem:g,formData:i,finalPrice:j,payForOrder:L}}},ta=q(Qe,[["render",Je],["__scopeId","data-v-9026490a"]]);export{ta as S};
