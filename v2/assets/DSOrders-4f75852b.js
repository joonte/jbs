import{j as q,o as C,c as V,a as c,Z as N,a9 as H,b as l,w as I,d as R,t as k,F as Z,x as X,n as Y,k as de,_ as $,e as ee,S as te,r as U,h as ie,y as G,g as x,i as ue}from"./index-4466e2da.js";import{u as _e}from"./dedicatedServer-0ac0cc57.js";import{u as me}from"./contracts-44396072.js";import{I as fe}from"./IconSearch-2aa1e8a5.js";import{_ as De}from"./HelperComponent-a9a57158.js";import{S as oe}from"./StatusBadge-b68990e4.js";import{I as ve}from"./IconRotate-a05ea2a2.js";import{f as W}from"./useTimeFunction-8602dd60.js";import"./resetServer-40ee621e.js";import{f as ne,z as Se,k as ge,d as Ie}from"./bootstrap-vue-next.es-61f2820f.js";import{_ as he}from"./IconDots-1c53be05.js";import{_ as pe}from"./IconCard-36c54c16.js";import{_ as we}from"./OrderIDBadge-ec7b5bbd.js";import{S as be}from"./Select2-84f05067.js";import{s as Oe}from"./multiselect-a1f1bb25.js";import{_ as ae}from"./FormInputSearch-671230ef.js";import{B as se}from"./BlockBalanceAgreement-762408e5.js";import{u as Ce}from"./globalActions-a65ed06f.js";import{_ as ke,B as re}from"./IconButtonBack-a6494adb.js";import{E as ye}from"./EmptyStateBlock-1f67284f.js";import{_ as Be}from"./ClausesKeeper-f5a8709e.js";import{_ as Le}from"./ButtonDefault-18fa1414.js";import"./IconArrow-1085f1dc.js";import"./IconPlus-fcf0b45d.js";import"./IconClose-96271d50.js";const Pe={class:"hosting-item"},Me={class:"hosting-item__row"},Ue={class:"hosting-item__row"},Re={class:"hosting-item__person"},Ve={key:0,class:"hosting-item__row"},xe={class:"hosting-item__list"},Ne=["innerHTML"],He={class:"hosting-status__info"},Te={class:"hosting-status__date"},je={class:"hosting-item__controls"},Ae={class:"btn btn--dots"};function Ee(i,o,a,e,h,B){var O,D,S,g,r,M,T,j,A,E,z,F;const p=ne,v=we,w=q("router-link"),y=q("Helper"),b=oe,L=pe,P=he,s=Se,u=ge,d=Ie;return C(),V("div",Pe,[c("div",Me,[N(l(p,{id:"checkbox-"+((O=a.itemData)==null?void 0:O.OrderID),modelValue:e.localSelectedRows[(D=a.itemData)==null?void 0:D.OrderID],"onUpdate:modelValue":o[0]||(o[0]=m=>{var f;return e.localSelectedRows[(f=a.itemData)==null?void 0:f.OrderID]=m}),name:"checkbox-"+((S=a.itemData)==null?void 0:S.OrderID),onChange:e.updateSelectedRows},null,8,["id","modelValue","name","onChange"]),[[H,a.isSeveral]]),l(v,{orderID:(g=a.itemData)==null?void 0:g.OrderID,onClick:o[1]||(o[1]=m=>{var f;return e.toItem((f=a.itemData)==null?void 0:f.OrderID)})},null,8,["orderID"]),l(w,{class:"hosting-item__name",to:`/DSOrders/${a.itemData.OrderID}`},{default:I(()=>[R(k(a.itemData.IP),1)]),_:1},8,["to"])]),c("div",Ue,[c("div",Re,k((r=a.itemData)==null?void 0:r.Customer),1),l(y,{"user-notice":(M=a.itemData)==null?void 0:M.UserNotice,id:(T=a.itemData)==null?void 0:T.OrderID,position:a.isLast?"bottom":"top",emit:"updateDSOrdersList"},null,8,["user-notice","id","position"])]),a.params.length?(C(),V("div",Ve,[c("ul",xe,[(C(!0),V(Z,null,X(a.params,m=>(C(),V("li",{innerHTML:m},null,8,Ne))),256))]),c("div",He,[c("div",{class:Y(["hosting-item__date",{danger:Number((j=a.itemData)==null?void 0:j.DaysRemainded)<14}])},k(e.calculateExpirationDate((A=a.itemData)==null?void 0:A.DaysRemainded))+" • "+k(((E=a.itemData)==null?void 0:E.DaysRemainded)||0)+" дн.",3),l(b,{class:"status-badge",status:(z=a.itemData)==null?void 0:z.StatusID,"status-table":"DSOrders",onClick:o[2]||(o[2]=m=>{var f;return e.openHistoryStatuses((f=a.itemData)==null?void 0:f.ID)})},null,8,["status"]),c("div",Te,k(e.calculateDaysSinceStatusUpdate((F=a.itemData)==null?void 0:F.StatusDate)),1)])])):de("",!0),c("div",je,[c("div",{class:"btn btn--md btn--bold",onClick:o[3]||(o[3]=m=>{var f;return i.$router.push(`/DSOrderPay/${(f=a.itemData)==null?void 0:f.OrderID}`)})},[l(L),R("Оплатить")]),l(d,{class:"dropdown-dots",right:""},{"button-content":I(()=>[c("div",Ae,[l(P)])]),default:I(()=>[l(s,null,{default:I(()=>{var m;return[l(w,{to:`DSOrders/${(m=a.itemData)==null?void 0:m.OrderID}`},{default:I(()=>[R("Дополнительная информация")]),_:1},8,["to"])]}),_:1}),l(s,{onClick:o[4]||(o[4]=m=>e.transferAccount())},{default:I(()=>[R("Передать на другой аккаунт")]),_:1}),l(u),l(s,{class:"color-red",onClick:o[5]||(o[5]=m=>e.deleteItem())},{default:I(()=>[R("Удалить")]),_:1})]),_:1})])])}const ze={components:{StatusBadge:oe,IconRotate:ve,Helper:De},props:{params:{type:Array,default:()=>[]},itemData:{type:Object,default:()=>{}},isLast:{type:Boolean,default:!1},isSeveral:{type:Boolean,default:!1},selectedRows:{type:Object,required:!0}},emits:["delete","transfer","manage"],setup(i,{emit:o}){const a=ee(),e=te("emitter"),h=U({...i.selectedRows}),B=()=>{o("update-selected-rows",h.value)};ie(()=>i.selectedRows,s=>{h.value={...s}},{deep:!0});function p(s){if(!s)return W(new Date);const u=new Date,d=new Date(u.getTime()+s*24*60*60*1e3);return W(d)}function v(s){a.push(`/DSOrders/${s}`)}function w(){var s;o("delete",(s=i.itemData)==null?void 0:s.ID)}function y(){var s,u;o("transfer",{ServiceOrderID:(s=i.itemData)==null?void 0:s.ID,ServiceID:(u=i.itemData)==null?void 0:u.ServiceID})}function b(s){e.emit("open-modal",{component:"StatusHistory",data:{modeID:"DSOrders",rowID:s}})}function L(){var s,u,d;o("manage",{ServiceOrderID:(s=i.itemData)==null?void 0:s.ID,ServiceID:(u=i.itemData)==null?void 0:u.ServiceID,OrderID:(d=i.itemData)==null?void 0:d.OrderID})}function P(s){if(!s)return"";const u=new Date(parseInt(s)*1e3),O=new Date-u,D=Math.floor(O/1e3),S=Math.floor(D/60),g=Math.floor(S/60),r=Math.floor(g/24);return D<60?`${D} сек. от статуса`:S<60?`${S} мин. от статуса`:g<24?`${g} ч. от статуса`:`${r} дн. от статуса`}return{deleteItem:w,orderManage:L,transferAccount:y,calculateExpirationDate:p,openHistoryStatuses:b,toItem:v,calculateDaysSinceStatusUpdate:P,localSelectedRows:h,updateSelectedRows:B}}},le=$(ze,[["render",Ee],["__scopeId","data-v-6b621171"]]),Fe={class:"section"},qe={class:"container"},Ge={class:"title__icon"},Ze={class:"btn__group"},Je={class:"group__several"},Ke={class:"list-form"},Qe={class:"list-form_col list-form_col--sm"},We={class:"list-form_select"},Xe={class:"multiselect-option"},Ye={key:0};function $e(i,o,a,e,h,B){var D,S,g;const p=se,v=ke,w=Le,y=q("router-link"),b=re,L=ne,P=Be,s=q("Multiselect"),u=ae,d=le,O=ye;return C(),V(Z,null,[l(p),c("div",Fe,[c("div",qe,[c("div",{class:Y(["section-header",e.isSeveral?"column":""])},[c("div",Ge,[c("h1",{class:"section-title",onClick:o[0]||(o[0]=r=>e.reloadNow())},k(e.isSeveral?"Продление услуг выделенных серверов":"Выделенные серверы"),1),N(l(v,{onClick:o[1]||(o[1]=r=>e.outSeveralOrders())},null,512),[[H,e.isSeveral]])]),N(c("div",Ze,[N(l(w,{class:"btn-several",label:"Продлить несколько заказов",onClick:o[2]||(o[2]=r=>e.prolongSeveralOrders())},null,512),[[H,e.getDSList.length>1]]),l(y,{class:"btn btn--blue btn-default",to:"DSSchemes"},{default:I(()=>[R("Заказать")]),_:1})],512),[[H,!e.isSeveral]]),N(c("div",Je,[l(b,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":o[3]||(o[3]=r=>e.selectPeriod=r)},null,8,["modelValue"]),l(L,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":o[4]||(o[4]=r=>e.useBalance=r),name:"checkbox-balance"},{default:I(()=>[R("Использовать средства с баланса")]),_:1},8,["modelValue"]),l(w,{label:"Продлить",onClick:o[5]||(o[5]=r=>e.prolongOrders())})],512),[[H,e.isSeveral]])],2),l(P,{partition:"Header:/DSOrders"}),c("div",Ke,[c("div",Qe,[c("div",We,[l(s,{modelValue:e.select,"onUpdate:modelValue":o[6]||(o[6]=r=>e.select=r),options:e.getUsers,disabled:((D=e.getUsers)==null?void 0:D.length)<=1,label:"name"},{singlelabel:I(({value:r})=>[c("span",null,"# "+k(r.value.padStart(5,"0"))+" / "+k(r.name),1)]),option:I(({option:r})=>[c("div",Xe,"# "+k(r.value.padStart(5,"0"))+" / "+k(r.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l(u,{modelValue:e.search,"onUpdate:modelValue":o[7]||(o[7]=r=>e.search=r)},null,8,["modelValue"])]),e.getDSList&&((S=e.getDSList)==null?void 0:S.length)>0?(C(),V("div",Ye,[e.filterProducts&&((g=e.filterProducts)==null?void 0:g.length)>0?(C(!0),V(Z,{key:0},X(e.filterProducts,(r,M)=>(C(),G(d,{params:e.getDSItemParam(r),"is-last":M===e.filterProducts.length-1,"item-data":r,isSeveral:e.isSeveral,"selected-rows":e.selectedRows,onUpdateSelectedRows:e.handleSelectedRowsUpdate,onDelete:e.deleteItem,onTransfer:e.transferItem,onManage:e.orderManage},null,8,["params","is-last","item-data","isSeveral","selected-rows","onUpdateSelectedRows","onDelete","onTransfer","onManage"]))),256)):(C(),G(O,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(C(),G(O,{key:1,class:"no-margin",label:"У Вас нет заказов на выделенные серверы"}))])])],64)}const et={components:{FormInputSearch:ae,IconSearch:fe,Select2:be,Multiselect:Oe,DSItem:le,BlockBalanceAgreement:se,BlockSelectPeriod:re},async setup(){const i=U("*"),o=U(null),a=Ce(),e=_e(),h=me(),B=ee(),p=U(!1),v=U([]),w=U(null),y=U(!1),b=te("emitter");b.on("updateDSOrdersList",()=>{e.fetchDSOrders()});const L=n=>{v.value=n};async function P(){console.log(v.value);const n=Object.keys(v.value).filter(_=>v.value[_]),t={ServiceID:"40000",ItemsPay:w.value,OrdersIDs:n,...y.value&&{UseBalance:"yes"}};await a.OrdersPay(t).then(_=>{_==="Basket"?(console.log("Success"),B.push("/Basket")):_==="SUCCESS"&&(p.value=!1,b.emit("open-modal",{component:"BalanceProlong",data:{Service:"выделенных серверов"}}))})}function s(){p.value=!0}function u(){p.value=!1}const d=x(()=>{var n;return(n=Object.keys(e==null?void 0:e.DSList).map(t=>e==null?void 0:e.DSList[t]))==null?void 0:n.reverse()}),O=x(()=>e==null?void 0:e.DSSchemes),D=x(()=>h==null?void 0:h.contractsList),S=x(()=>e==null?void 0:e.DSOrderIPMI),g=x(()=>j(T(d.value)));ue(()=>{d.value.length<1&&M()});function r(){B.go(0)}function M(){B.push({path:"/DSSchemes"})}function T(n){return i.value!=="*"?n.filter(t=>(t==null?void 0:t.ContractID)===i.value):n}function j(n){return o.value!==null?n.filter(t=>(t==null?void 0:t.Customer.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.OrderID.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.Scheme.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.IP.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.disks.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.CPU.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.ram.toLowerCase().includes(o.value.toLowerCase()))):n}function A(n){a.OrderManage(n)}const E=x(()=>{let n=[{value:"*",name:"Все договора"}];return d.value!==null&&D.value!==null?(Object.keys(d.value).forEach(t=>{var _,J,K;n.find(ce=>{var Q;return ce.value===((Q=d.value[t])==null?void 0:Q.ContractID)})||n.push({value:(_=d.value[t])==null?void 0:_.ContractID,name:(K=D.value[(J=d.value[t])==null?void 0:J.ContractID])==null?void 0:K.Customer})}),n):{value:"*",name:"Все договора"}});function z(n){let t=F(n==null?void 0:n.SchemeID);t===void 0&&(t=n);let _=[];return n!=null&&n.Scheme&&_.push(n==null?void 0:n.Scheme),n!=null&&n.CPU&&_.push(n==null?void 0:n.CPU),t!=null&&t.ram&&_.push("RAM "+(t==null?void 0:t.ram)+" GB"),t!=null&&t.disks&&_.push(t==null?void 0:t.disks),t!=null&&t.CostMonth&&_.push("<b>"+(t==null?void 0:t.CostMonth)+"/ месяц</b>"),_}function F(n){var t;return(t=O.value)==null?void 0:t[n]}function m(n){b.emit("open-modal",{component:"DeleteItem",data:{id:n,message:"Вы действительно хотите удалить этот сервер?",tableID:"DSOrders",successEmit:"updateDSOrdersList"}})}function f(n){b.emit("open-modal",{component:"OrdersTransfer",data:n})}return await e.fetchDSOrders(),await e.fetchDSSchemes(),await e.fetchDSOrderIPMI(),await h.fetchContracts(),{getDSList:d,filterProducts:g,select:i,search:o,getUsers:E,getDSSchemes:O,getDSItemParam:z,getDSOrderIPMI:S,orderManage:A,deleteItem:m,transferItem:f,navigateToDSSchemes:M,reloadNow:r,prolongSeveralOrders:s,isSeveral:p,selectedRows:v,selectPeriod:w,prolongOrders:P,outSeveralOrders:u,useBalance:y,handleSelectedRowsUpdate:L}}},kt=$(et,[["render",$e],["__scopeId","data-v-713d82fc"]]);export{kt as default};
