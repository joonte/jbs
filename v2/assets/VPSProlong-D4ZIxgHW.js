import{_ as A}from"./EmptyStateBlock-DgFyy_gi.js";import{_ as K}from"./ButtonDefault-CgQ13ecW.js";import{_ as T}from"./BlockOrderPayBalance-BulK2jU0.js";import{_ as $}from"./ClausesKeeper-Cjjq7JUL.js";import{_ as H}from"./BlockBalanceAgreement-BNU6bIWW.js";import{H as U,r as k,f as p,g as J,h as M,v as q,E as y,c as a,b as u,a as e,i as z,I as w,F as f,t as n,j as G,J as C,d as Q,o as l}from"./index-DakgQwZZ.js";import{u as W}from"./contracts-C-xJvA56.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-CDL_Y1-V.js";import"./component-BXhtJwv0.js";import"./globalActions-BG7EYttN.js";import"./IconHelp-DQ9vdhmP.js";import"./IconClose-Camrw-uN.js";const Y={key:0,class:"vps-scheme-page"},Z={class:"section"},ee={class:"container"},te={key:0,class:"section"},se={class:"container"},oe={class:"total-block"},ae={class:"total-block__row divider-bottom"},ne={class:"total-block__col"},le={class:"total-block__col"},ce={class:"total-block__col"},re={class:"total-block__row total-block__row--big economy-line"},ie={class:"total-block__col flex-col"},_e={class:"red"},ue={class:"total-block__row total-block__row--big"},de={class:"total-block__col"},ve={class:"total-block__col"},me={key:1,class:"section"},pe={class:"container"},he={key:1,class:"section"},be={class:"container"},ke={__name:"VPSProlong",async setup(ye){let r,i;const c=U(),S=W(),g=Q(),E=J(),s=k(null),d=k(null),b=k(!1),O=p(()=>Object.keys(c.vpsSchemes).map(t=>c.vpsSchemes[t])),_=p(()=>Object.keys(c.vpsList).map(t=>c.vpsList[t]).find(t=>t.OrderID===E.params.id)),x=p(()=>S.contractsList),h=p(()=>O.value.find(t=>t?.ID===_.value?.SchemeID));function v(t){return Number(t).toFixed(2)||0}function D(){let t=0;return s.value?.discounts?.Bonuses.map(o=>{t+=+o.Economy}),t}function L(t){s.value=t}function I(){b.value=!0,c.VPSOrderPay({VPSOrderID:_.value?.ID,DaysPay:s.value?.actualDays,IsChange:!0}).then(t=>{let{result:o,error:V}=t;o==="SUCCESS"?g.push("/VPSOrders"):o==="BASKET"&&g.push("/Basket"),b.value=!0})}const P=t=>{t.key==="Enter"&&t.ctrlKey&&!F.value&&I()},F=p(()=>s.value===null||d.value===null);return M(()=>{document.addEventListener("keyup",P)}),q(()=>{document.removeEventListener("keyup",P)}),[r,i]=y(()=>c.fetchVPSSchemes()),await r,i(),[r,i]=y(()=>S.fetchContracts()),await r,i(),[r,i]=y(()=>c.fetchVPS().then(()=>{d.value=_.value?.ContractID})),await r,i(),(t,o)=>{const V=H,R=$,N=T,j=K,B=A;return l(),a(f,null,[u(V),_.value?(l(),a("div",Y,[e("div",Z,[e("div",ee,[o[1]||(o[1]=e("div",{class:"section-header"},[e("h1",{class:"section-title"},"Оплата заказа VPS/VDS сервера")],-1)),u(R,{partition:"Header:/VPSSchemes"})])]),u(N,{contractID:d.value,scheme:h.value,serviceID:"30000",daysRemainded:_.value?.DaysRemainded,isOrderID:!0,orderID:_.value?.OrderID,onSelect:L},null,8,["contractID","scheme","daysRemainded","orderID"]),h.value?.IsPayed&&h.value?.IsProlong||!h.value?.IsPayed?(l(),a("div",te,[e("div",se,[e("div",oe,[s.value?.discounts?.Bonuses?.length>0?(l(),a(f,{key:0},[e("div",ae,[o[2]||(o[2]=e("div",{class:"total-block__col"},"Цена тарифа",-1)),e("div",ne,n(v(s.value?.price))+" ₽",1)]),(l(!0),a(f,null,G(s.value?.discounts?.Bonuses,m=>(l(),a("div",{class:"total-block__row no-divider",key:m?.Days},[e("div",le,"Скидка "+n(m?.Discount)+"% на "+n(m?.Days)+" дней",1),e("div",ce,"-"+n(v(m?.Economy))+" ₽",1)]))),128))],64)):z("",!0),w(e("div",re,[o[3]||(o[3]=e("div",{class:"total-block__col red"},"Выгода",-1)),e("div",ie,[e("span",null,[e("s",null,n(v(s.value?.price))+" ₽",1)]),e("span",_e,"-"+n(v(D()))+" ₽",1)])],512),[[C,s.value?.discounts?.Bonuses?.length>0]]),w(e("div",ue,[e("div",de,"Итого за "+n(s.value?.label),1),e("div",ve,n(v(s.value?.price-D()))+" ₽",1)],512),[[C,s.value?.price]])]),u(j,{class:"btn--wide",label:x.value[d.value]?.Balance>s.value?.price?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||d.value===null,"is-loading":b.value,onClick:o[0]||(o[0]=m=>I())},null,8,["label","disabled","is-loading"])])])):(l(),a("div",me,[e("div",pe,[u(B,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(l(),a("div",he,[e("div",be,[u(B,{label:"Заказ VPS/VDS сервера не найден"})])]))],64)}}},Le=X(ke,[["__scopeId","data-v-58fc18bb"]]);export{Le as default};
