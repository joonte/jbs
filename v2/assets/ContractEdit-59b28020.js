import{j as $,o as c,c as f,b as p,a as n,w as U,d as x,t as A,F as E,x as H,k as i,y,n as B,p as ee,l as le,_ as oe,u as ae,e as se,a7 as ne,r as h,g as z}from"./index-90eb49f0.js";import{u as re}from"./contracts-0cbe8270.js";import{s as ce}from"./SimpleCheckbox-25982a6e.js";import{_ as G}from"./BasicInput-936f29ee.js";import{P as J,T as K,S as Q}from"./PhoneInput-d020b686.js";import{u as te}from"./files-80cc46df.js";import{I as W}from"./IconFile-abe753fa.js";import{I as X}from"./IconClose-c838a5bc.js";import{B as Y}from"./BlockBalanceAgreement-267acfcf.js";import{E as ue}from"./EmptyStateBlock-2d70ce64.js";import{_ as fe}from"./ButtonDefault-5aebc1f7.js";import{f as de}from"./bootstrap-vue-next.es-788a757a.js";import{_ as pe}from"./IconClip-cb133180.js";import{_ as _e}from"./ClausesKeeper-313482ce.js";/* empty css                                                                       */import"./component-65c692c0.js";import"./multiselect-e18abfd5.js";import"./IconArrow-380053a0.js";const Z=v=>(ee("data-v-f84c4601"),v=v(),le(),v),ie={class:"section"},he={class:"container"},ve={class:"section-header"},ke={class:"breadcrumb"},ge=Z(()=>n("h1",{class:"section-title"},"Редактировать договор",-1)),be={class:"form"},ye={class:"form-row-wrapper"},Ce={class:"special-form-row"},me={key:0,class:"section-header inputs-block"},Ve={class:"section-block_title"},Ie={key:0,class:"form width-limit"},Ee={key:0,class:"form-field form-field--file form-field--basic"},Pe={class:"chat-files"},Te={class:"chat-files__item"},Se={key:1,class:"form-field form-field--file form-field--basic"},Fe={class:"chat-files"},we={class:"chat-files__item"},De=["onClick"],Le={class:"form-field form-field--file form-field--basic"},Ue={class:"form-field-input__file-wrapper"},xe={class:"form-field-input__file"},Ae=Z(()=>n("span",null,"Прикрепить документ подтверждающий личность",-1)),Be=["innerHTML"];function Oe(v,u,M,l,P,C){var L,V,o,r,a;const b=Y,_=$("router-link"),T=_e,g=G,S=J,m=K,F=Q,k=W,w=X,d=pe,D=de,O=fe,N=ue;return c(),f(E,null,[p(b),n("div",ie,[n("div",he,[n("div",ve,[n("div",ke,[p(_,{class:"section-label",to:"/Contracts"},{default:U(()=>[x("Договор /")]),_:1}),p(_,{class:"section-label",to:`/ContractScheme/${v.$route.params.id}`},{default:U(()=>{var e;return[x(A((e=l.getProfile)==null?void 0:e.Name),1)]}),_:1},8,["to"])]),ge]),p(T),l.getProfile?(c(),f(E,{key:0},[n("div",be,[(c(!0),f(E,null,H((a=(r=(o=(V=(L=l.getConfig)==null?void 0:L.Profiles)==null?void 0:V.Templates)==null?void 0:o[l.templateValue])==null?void 0:r.Template)==null?void 0:a.Attribs,(e,s)=>(c(),f("div",ye,[n("div",Ce,[e!=null&&e.Title?(c(),f("div",me,[n("h2",Ve,A(e==null?void 0:e.Title),1)])):i("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)!=="Phone"?(c(),y(g,{key:1,class:B({"special-form-input":!0,"form-field-error":l.form[s].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[s].value,"onUpdate:modelValue":t=>l.form[s].value=t},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):i("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)==="Phone"?(c(),y(S,{key:2,class:B({"special-form-input":!0,"form-field-error":l.form[s].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[s].value,"onUpdate:modelValue":t=>l.form[s].value=t},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):i("",!0),(e==null?void 0:e.Type)==="TextArea"?(c(),y(m,{key:3,class:B({"special-form-input":!0,"form-field-error":l.form[s].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[s].value,"onUpdate:modelValue":t=>l.form[s].value=t},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):(e==null?void 0:e.Type)==="Select"?(c(),y(F,{key:4,class:B({"special-form-input":!0,"form-field-error":l.form[s].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,options:e==null?void 0:e.Options,modelValue:l.form[s].value,"onUpdate:modelValue":t=>l.form[s].value=t},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):i("",!0)])]))),256))]),l.templateValue!==0?(c(),f("div",Ie,[l.fileListOld.length?(c(),f("div",Ee,[n("div",Pe,[(c(!0),f(E,null,H(l.fileListOld,(e,s)=>(c(),f("div",Te,[n("span",null,[p(k,{class:"file-icon"})]),n("span",null,A(e==null?void 0:e.name),1)]))),256))])])):i("",!0),l.fileList.length?(c(),f("div",Se,[n("div",Fe,[(c(!0),f(E,null,H(l.fileList,(e,s)=>(c(),f("div",we,[n("span",null,[p(k,{class:"file-icon"})]),n("span",null,A(e==null?void 0:e.name),1),n("button",{class:"close",onClick:t=>l.removeFile(s)},[p(w)],8,De)]))),256))])])):i("",!0),n("label",Le,[n("div",Ue,[n("input",{ref:"fileInput",type:"file",onChange:u[0]||(u[0]=(...e)=>l.fileUpload&&l.fileUpload(...e))},null,544),n("div",xe,[p(d),Ae])])]),p(D,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agree,"onUpdate:modelValue":u[1]||(u[1]=e=>l.agree=e)},{default:U(()=>[x("Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет")]),_:1},8,["modelValue"]),p(D,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agreeHandle,"onUpdate:modelValue":u[2]||(u[2]=e=>l.agreeHandle=e)},{default:U(()=>[x("Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменто и т.п.)")]),_:1},8,["modelValue"])])):i("",!0),l.createProfileErrorMessage?(c(),f("div",{key:1,class:"error-message width-limit",innerHTML:l.formErrorMessage(l.createProfileErrorMessage)},null,8,Be)):i("",!0),l.templateValue!==0?(c(),y(O,{key:2,class:"width-limit","is-loading":l.createProfileResult==="pending",label:"Сохранить",onClick:u[3]||(u[3]=e=>l.checkForm())},null,8,["is-loading"])):i("",!0)],64)):(c(),y(N,{key:1,label:"Профиль договора не найден"}))])])],64)}const Ne={components:{TextAreaLine:K,simpleCheckbox:ce,basicInput:G,SelectLine:Q,PhoneInput:J,IconFile:W,IconClose:X,BlockBalanceAgreement:Y},async setup(){const v=ae(),u=re(),M=te(),l=se(),P=ne(),C=h(!1),b=h(!1),_=h({}),T=h(null),g=h([]),S=h([]),m=h(null),F=h(null),k=h(0),w=z(()=>v.ConfigList),d=z(()=>{var o;return(o=u.profileList)==null?void 0:o[P.params.id]});function D(){if(C.value&&b.value){let o={};Object.keys(_.value).forEach(a=>{o[a]=_.value[a].value});let r=new FormData;Object.keys(_.value).forEach(a=>{var e;r.append(a,(e=_.value[a])==null?void 0:e.value)}),r.append("TemplateID",k.value),r.append("Agree",C.value),r.append("AgreeHandle",b.value),r.append("ProfileID",P.params.id),g.value.forEach((a,e)=>{r.append("Document[]",a==null?void 0:a.value)}),m.value="pending",u.createNewContract({ProfileID:P.params.id,TemplateID:k.value,Agree:C.value,AgreeHandle:b.value,...o}).then(a=>{var e;a.status==="success"?l.push("/Contracts?section=Profiles"):(m.value="error",F.value=(e=a.data)==null?void 0:e.Exception)})}}function O(o){g.value=g.value.filter((r,a)=>a!==o)}function N(o){return""+V(o)}function L(o){var a;let r=((a=o.target.files)==null?void 0:a[0])||null;r&&(T.value.value="",M.sendFile(r).then(e=>{g.value.push({name:r==null?void 0:r.name,value:e.slice(e.lastIndexOf("^")+1,e.length)})}))}function V(o){return o?"<div>"+(o==null?void 0:o.String)+"</div>"+V(o==null?void 0:o.Parent):""}return await u.fetchContracts().then(()=>{u.fetchProfiles().then(()=>{var o,r,a,e;k.value=(o=d.value)==null?void 0:o.TemplateID,(r=d.value)!=null&&r.Files&&(S.value=(e=Object.keys((a=d.value)==null?void 0:a.Files))==null?void 0:e.map(s=>{var t,I;return{name:(t=d.value)==null?void 0:t.Files[s].Name,value:(I=d.value)==null?void 0:I.Files[s].Name}})),Object.keys(d.value.Attribs).forEach(s=>{var t,I,j,R,q;_.value[s]={value:d.value.Attribs[s],required:((q=(R=(j=(I=(t=w.value)==null?void 0:t.Profiles)==null?void 0:I.Templates)==null?void 0:j[k.value])==null?void 0:R.Template)==null?void 0:q.Attribs[s].IsDuty)==="1",error:!1}})})}),await v.fetchConfig(),{getConfig:w,getProfile:d,templateValue:k,agreeHandle:b,fileInput:T,fileList:g,fileListOld:S,agree:C,createProfileResult:m,createProfileErrorMessage:F,checkForm:D,fileUpload:L,removeFile:O,formErrorMessage:N,form:_}}},al=oe(Ne,[["render",Oe],["__scopeId","data-v-f84c4601"]]);export{al as default};
