import{o as F,c as B,b as C,a as t,t as y,F as D,p as w,l as x,_ as V,a7 as N,e as E,f as L,r as k,g as _,i as q,a2 as M}from"./index-19d4a9c5.js";import{u as R}from"./postings-f8eb169d.js";import{u as U}from"./services-7baf87ff.js";import"./contracts-9a2dcfb1.js";import"./bootstrap-vue-next.es-4c1a1806.js";import{_ as J}from"./ButtonDefault-6be40158.js";import{B as K}from"./BlockBalanceAgreement-46812f15.js";import{_ as T}from"./ClausesKeeper-5a7e7f30.js";import"./IconArrow-093f2a46.js";import"./IconClose-ab9f78d6.js";const h=d=>(w("data-v-8e61fb86"),d=d(),x(),d),$={class:"additional-service-prolong"},z={class:"section"},G={class:"container"},H={class:"section-header"},Q=h(()=>t("h1",{class:"section-title"},"Оплата заказа дополнительной услуги",-1)),W={class:"section-label"},X={class:"section"},Y={class:"container"},Z={class:"service-prolong__data"},j={class:"form-field"},ee=h(()=>t("div",{class:"form-field__label"},"Стоимость заказа",-1)),se=["value"],te={class:"form-field"},oe={class:"form-field__label"},re=h(()=>t("input",{type:"text",placeholder:"0 руб",value:"1",disabled:""},null,-1)),ae={class:"form-field"},ie=h(()=>t("div",{class:"form-field__label"},"Всего к оплате",-1)),ce=["value"],ne={class:"section"},le={class:"container"},de={class:"service-prolong__data"},_e={class:"total-block"},ue={class:"total-block__row total-block__row--big"},ve=h(()=>t("div",{class:"total-block__col"},"Итого",-1)),pe={class:"total-block__col"};function fe(d,u,v,r,I,g){var S,f,m;const n=K,p=T,b=J;return F(),B(D,null,[C(n),t("div",$,[t("div",z,[t("div",G,[t("div",H,[Q,t("div",W,y((S=r.getService)==null?void 0:S.Name)+" # "+y((f=r.getOrder)==null?void 0:f.ID),1)]),C(p)])]),t("div",X,[t("div",Y,[t("div",Z,[t("label",j,[ee,t("input",{type:"text",placeholder:"0 руб",value:r.orderCost+" руб",disabled:""},null,8,se)]),t("label",te,[t("div",oe,"Количество ("+y((m=r.getService)==null?void 0:m.Measure)+")",1),re]),t("label",ae,[ie,t("input",{type:"text",placeholder:"0 руб",value:r.getServicePrice()+" руб",disabled:""},null,8,ce)])])])]),t("div",ne,[t("div",le,[t("div",de,[t("div",_e,[t("div",ue,[ve,t("div",pe,y(r.getServicePrice()||"0")+" ₽",1)])]),C(b,{class:"btn--wide",label:"Оплатить",onClick:u[0]||(u[0]=P=>r.orderPay()),"is-loading":r.isLoading},null,8,["is-loading"])])])])])],64)}const me={async setup(){const d=N(),u=E(),v=R(),r=L(),I=U(),g=k(!1),n=_(()=>Object.keys(r==null?void 0:r.userOrders).map(e=>r==null?void 0:r.userOrders[e]).find(e=>e.ID===d.params.id));_(()=>{var e,s;return(s=(e=b.value)==null?void 0:e.find(o=>{var a,i,c;return o.value===((c=(i=(a=n.value)==null?void 0:a.OrdersFields)==null?void 0:i[0])==null?void 0:c.Value)}))==null?void 0:s.price}),_(()=>{var e,s;return(s=(e=S.value)==null?void 0:e.find(o=>{var a,i,c;return o.value===((c=(i=(a=n.value)==null?void 0:a.OrdersFields)==null?void 0:i[1])==null?void 0:c.Value)}))==null?void 0:s.price});const p=k(0),b=_(()=>{var e,s,o,a,i;return(i=(a=(o=(s=(e=O.value)==null?void 0:e.ServicesFields)==null?void 0:s[0])==null?void 0:o.Options)==null?void 0:a.split(`
`))==null?void 0:i.map(c=>{let l=c.split("=");return{value:l[0],name:l[1],price:l[2]}})}),S=_(()=>{var e,s,o,a,i;return(i=(a=(o=(s=(e=O.value)==null?void 0:e.ServicesFields)==null?void 0:s[1])==null?void 0:o.Options)==null?void 0:a.split(`
`))==null?void 0:i.map(c=>{let l=c.split("=");return{value:l[0],name:l[1],price:l[2]}})});async function f(e){try{const o=(await M.get(`/ServiceOrderPay?OrderID=${e}&JSON=1`)).data,a=m(o);let i=1;return o.AmountPay&&(i=parseInt(o.AmountPay)||1),console.log(i),a}catch(s){return console.error("Ошибка при получении данных о стоимости заказа",s),null}}function m(e){let s=0;for(const o in e)e.hasOwnProperty(o)&&(typeof e[o]=="object"?s+=m(e[o]):o==="Cost"&&!isNaN(e[o])&&(s+=parseFloat(e[o])));return s}function P(){return((parseFloat(p.value)||0)*1).toFixed(2)}function A(){var e,s;g.value=!0,I.ServiceOrderPay((e=n.value)==null?void 0:e.Code,{AmountPay:"1",ServiceOrderID:(s=n.value)==null?void 0:s.ID,IsChange:!0}).then(o=>{var c;let{result:a,error:i}=o;a==="SUCCESS"?u.push(`/AdditionalServices/${(c=n.value)==null?void 0:c.ID}`):a==="BASKET"&&u.push("/Basket"),g.value=!1})}q(async()=>{if(n.value){const e=n.value.ID,s=await f(e);s!==null&&(p.value=s)}});const O=_(()=>{var e;return v==null?void 0:v.servicesList[(e=n.value)==null?void 0:e.ServiceID]});return await r.fetchUserOrders(),await v.fetchServices(),{getOrder:n,getService:O,getServicePrice:P,isLoading:g,orderPay:A,fetchOrderCost:f,orderCost:p}}},Ae=V(me,[["render",fe],["__scopeId","data-v-8e61fb86"]]);export{Ae as default};
