import{j as w,o as k,c as N,b as l,a as s,w as i,t as r,F as q,k as J,d as V,y as $,p as ee,l as te,_ as oe,u as ne,a7 as se,S as ae,r as b,g as C,h as ie}from"./index-5e313302.js";import{u as ce}from"./postings-03760ecf.js";import{u as le}from"./contracts-3351d68f.js";import{s as re}from"./multiselect-bfc29db8.js";import{S as K}from"./StatusBadge-98696de1.js";import{I as Q}from"./IconDownload-9dae4fb1.js";import{I as W}from"./IconFile-44cc57ed.js";import{B as X}from"./BlockBalanceAgreement-bb87adc1.js";import{a as de,f as me}from"./useTimeFunction-8602dd60.js";import{E as _e}from"./EmptyStateBlock-9f752916.js";import{z as ue,d as pe,C as ve,F as fe}from"./bootstrap-vue-next.es-a19a8b41.js";import{_ as Ie}from"./IconDots-f060bcd6.js";import{_ as be}from"./IconCard-67ad5f17.js";import{_ as De}from"./FormInputSearch-4c769092.js";import{_ as ye}from"./ClausesKeeper-eb954229.js";import{_ as Ce}from"./ButtonDefault-7c216fc6.js";import"./IconArrow-555f9d45.js";import"./IconPlus-856cd9b9.js";import"./IconSearch-5f35739d.js";import"./IconClose-1f889a2e.js";const he=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Files",variant:"td-controls",label:""}],p=v=>(ee("data-v-7809a024"),v=v(),te(),v),ge={class:"section"},ke={class:"container"},Se={class:"section-header"},Pe=p(()=>s("h1",{class:"section-title"},"Счета на оплату",-1)),Fe={class:"list-form"},Le={class:"list-form_col list-form_col--sm"},Be={class:"list-form_select"},Ne={class:"multiselect-option"},Ve=p(()=>s("span",{class:"td-mobile"},"Платежная система",-1)),xe={class:"d-block"},Te=p(()=>s("span",{class:"td-mobile"},"Дата Создания",-1)),Me={class:"d-block"},Oe=p(()=>s("span",{class:"td-mobile"},"Номер счета",-1)),Ue={class:"d-block"},je=p(()=>s("span",{class:"td-mobile"},"Договор",-1)),Ee={class:"d-block"},Re=p(()=>s("span",{class:"td-mobile"},"Статус",-1)),Ae=p(()=>s("span",{class:"td-mobile"},"Сумма",-1)),He={class:"d-block"},ze={class:"invoices__controls-wrapper"},Ge=["href"],Ze={class:"invoices__download-button-wrapper"},qe={class:"invoices__download-text"},Je={class:"btn__group"},Ke=["onClick"],Qe={class:"dropdown-button"},We={class:"btn btn--dots"},Xe=["href"],Ye={key:0,class:"table-controls"},we=p(()=>s("span",{class:"text-success"},"First",-1)),$e=p(()=>s("span",{class:"text-info"},"Last",-1)),et={class:"multiselect-multiple-label"},tt={class:"multiselect-option"};function ot(v,n,z,o,f,G){var P,F;const x=X,T=Ce,h=ye,I=w("Multiselect"),S=De,M=K,O=W,D=Q,U=be,j=Ie,u=ue,E=pe,R=ve,A=fe,H=_e;return k(),N(q,null,[l(x),s("div",ge,[s("div",ke,[s("div",Se,[Pe,l(T,{onClick:n[0]||(n[0]=e=>o.createNewIncoice()),label:"Выписать новый счёт"})]),l(h),s("div",Fe,[s("div",Le,[s("div",Be,[l(I,{modelValue:o.select,"onUpdate:modelValue":n[1]||(n[1]=e=>o.select=e),options:o.getUsers,disabled:((P=o.getUsers)==null?void 0:P.length)<=1,label:"name"},{singlelabel:i(({value:e})=>[s("span",null,"# "+r(e.value.padStart(5,"0"))+" / "+r(e.name),1)]),option:i(({option:e})=>[s("div",Ne,"# "+r(e.value.padStart(5,"0"))+" / "+r(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l(S,{modelValue:o.search,"onUpdate:modelValue":n[2]||(n[2]=e=>o.search=e)},null,8,["modelValue"])]),((F=o.getFilteredOrders)==null?void 0:F.length)>0?(k(),N(q,{key:0},[l(R,{class:"basic-table",items:o.getFilteredOrders,fields:o.worksCompleteFields,"show-empty":!0,filter:o.search,"per-page":o.perPage,"current-page":o.currentPage,responsive:"","sort-by":o.sortBy,"onUpdate:sortBy":n[3]||(n[3]=e=>o.sortBy=e),"sort-desc":o.sortDesc,"onUpdate:sortDesc":n[4]||(n[4]=e=>o.sortDesc=e),"sort-direction":o.sortDirection,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:o.setPageToZero},{"cell(PaymentSystemName)":i(e=>[Ve,s("span",xe,r(e.value),1)]),"cell(CreateDate)":i(e=>{var d;return[Te,s("span",Me,r(o.formNormalDate(o.secondToDate((d=e.item)==null?void 0:d.CreateDate))),1)]}),"cell(ID)":i(e=>[Oe,s("span",Ue,r(e.value),1)]),"cell(ContractID)":i(e=>{var d,_;return[je,s("span",Ee,"#"+r((d=e.item)==null?void 0:d.ContractID)+" / "+r((_=e.item)==null?void 0:_.Customer),1)]}),"cell(StatusID)":i(e=>[Re,l(M,{status:e.value,"status-table":"Invoices",onClick:d=>{var _;return o.openHistoryStatuses((_=e.item)==null?void 0:_.ID)}},null,8,["status","onClick"])]),"cell(Summ)":i(e=>{var d;return[Ae,s("span",He,r((d=e.item)==null?void 0:d.Summ)+" ₽",1)]}),"cell(Files)":i(e=>{var d,_,L,B;return[s("div",ze,[e!=null&&e.value?(k(),N("a",{key:0,class:"invoices__download-button",href:o.getInvoicesPDFLink(e)},[s("div",Ze,[l(O,{class:"invoices__download-icon"}),s("div",qe,"Счет №"+r((L=(_=e==null?void 0:e.value)==null?void 0:_[(d=Object.keys(e==null?void 0:e.value))==null?void 0:d[0]])==null?void 0:L.RowID),1),l(D,{class:"invoices__download-icon"})])],8,Ge)):J("",!0),s("div",Je,[s("button",{class:"btn btn-default btn--border",onClick:y=>o.invoicePayment(e)},[l(U),s("p",null,r((B=e.item)!=null&&B.IsPosted?"ПОСМОТРЕТЬ":"ОПЛАТИТЬ"),1)],8,Ke),s("div",Qe,[l(E,{class:"dropdown-dots",right:""},{"button-content":i(()=>[s("div",We,[l(j)])]),default:i(()=>[l(u,null,{default:i(()=>[s("a",{href:o.getInvoicesTTFLink(e)},"Скачать в формате tiff",8,Xe)]),_:2},1024),l(u,{onClick:y=>o.switchPaymentSystem(e)},{default:i(()=>[V("Изменить счёт")]),_:2},1032,["onClick"]),l(u,{onClick:y=>o.invoicePayment(e)},{default:i(()=>[V("Оплатить")]),_:2},1032,["onClick"]),l(u,{onClick:y=>o.invoicesReject(e)},{default:i(()=>[V("Отменить")]),_:2},1032,["onClick"]),l(u,{onClick:y=>o.invoiceSetConditionally(e)},{default:i(()=>[V("Провести условно")]),_:2},1032,["onClick"])]),_:2},1024)])])])]}),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction","onFiltered"]),o.filteredContractsLength>0?(k(),N("div",Ye,[l(A,{modelValue:o.currentPage,"onUpdate:modelValue":n[5]||(n[5]=e=>o.currentPage=e),"total-rows":o.filteredContractsLength,"per-page":o.perPage,"first-number":"","last-number":""},{"first-text":i(()=>[we]),"last-text":i(()=>[$e]),page:i(({page:e,active:d})=>[s("span",null,r((e-1)*o.perPage+1)+"-"+r(e*o.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),l(I,{class:"multiselect--white",modelValue:o.perPage,"onUpdate:modelValue":n[6]||(n[6]=e=>o.perPage=e),options:o.pageOptions,label:"name",openDirection:"top",onInput:n[7]||(n[7]=e=>o.currentPage=1)},{singlelabel:i(({value:e})=>[s("div",et,[s("span",null,"Отображать "+r(e.value)+" строк",1)])]),option:i(({option:e})=>[s("div",tt,"Отображать "+r(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):J("",!0)],64)):(k(),$(H,{key:1,label:"Заказов не найдено"}))])])],64)}const nt={components:{Multiselect:re,StatusBadge:K,IconDownload:Q,IconFile:W,BlockBalanceAgreement:X},async setup(){const v=le(),n=ce(),z=ne(),o=se(),f=ae("emitter");f.on("updateInvoicesTable",()=>{n.fetchInvoices()});const G=b("CreateDate"),x=b(!0),T=b("desc"),h=b(""),I=b("*"),S=b(1),M=b(10),O=b([10,25,50,100]),D=C(()=>Object.keys(n==null?void 0:n.invoicesList).map(t=>{var a,c,m;return{...n==null?void 0:n.invoicesList[t],Customer:(c=(a=u.value)==null?void 0:a[n==null?void 0:n.invoicesList[t].ContractID])==null?void 0:c.Customer,Summ:Number((m=n==null?void 0:n.invoicesList[t])==null?void 0:m.Summ)}}).reverse()),U=C(()=>D.value.filter(a=>I.value!=="*"?Number(a.ContractID)===Number(I.value):!0)),j=C(()=>n==null?void 0:n.servicesList),u=C(()=>v.contractsList),E=C(()=>{let t=[];return D.value.map(a=>{if(!t.find(c=>c===a.Customer))return t.push(a.Customer),{value:a.ContractID,name:a.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),R=C(()=>D.value.filter(t=>{var a,c;return(t==null?void 0:t.PaymentSystemName.toLowerCase().includes((a=h.value)==null?void 0:a.toLowerCase()))||String(t==null?void 0:t.Summ).toLowerCase().includes((c=h.value)==null?void 0:c.toLowerCase())}).filter(t=>t.ContractID.includes(I.value!=="*"?I.value:"")).length);function A(){S.value=1}function H(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsStamp=yes`}function P(t){var a;return`/InvoiceDownload?InvoiceID=${(a=t==null?void 0:t.item)==null?void 0:a.ID}&IsTIFF=yes&IsStamp=yes`}function F(t){var a,c,m;f.emit("open-modal",{component:"AcceptConditionally",data:{ContractID:(a=t==null?void 0:t.item)==null?void 0:a.ContractID,RowsIDs:(c=t==null?void 0:t.item)==null?void 0:c.ID,AllowConditionallyMessage:(m=t==null?void 0:t.item)==null?void 0:m.AllowConditionallyMessage}})}function e(t){f.emit("open-modal",{component:"StatusHistory",data:{modeID:"Invoices",rowID:t}})}function d(t){var a,c,m,g,Z;f.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:(a=t==null?void 0:t.item)==null?void 0:a.ID,TypeID:(g=(m=u.value)==null?void 0:m[(c=t==null?void 0:t.item)==null?void 0:c.ContractID])==null?void 0:g.TypeID,Summ:(Z=t==null?void 0:t.item)==null?void 0:Z.Summ}})}function _(t){var a;n.InvoiceDocument({InvoiceID:(a=t.item)==null?void 0:a.ID}).then(c=>{var m;f.emit("open-modal",{component:"InvoiceDocument",data:{html:c,ID:(m=t.item)==null?void 0:m.ID}})})}function L(){f.emit("open-modal",{component:"NewInvoice"})}function B(){}function y(){}ie(()=>{console.log(o)});function Y(t){var c;let a=new FormData;a.append("ContractID","Default"),a.append("RowsIDs[]",(c=t.item)==null?void 0:c.ID),n.InvoicesReject(a).then(m=>{m==="SUCCESS"&&n.fetchInvoices()})}return window.FormGet=B.bind(this),window.Mobile=y.bind(this),await v.fetchContracts(),await v.fetchProfiles(),await z.fetchConfig(),await n.fetchInvoices().then(()=>{var t,a;(t=o.params)!=null&&t.id&&((a=D.value)!=null&&a.find(m=>{var g;return m.ID===((g=o.params)==null?void 0:g.id)}))&&_({item:{ID:o.params.id}}),o.query.Error==="yes"&&f.emit("open-modal",{component:"InvoiceError"})}),await n.fetchServices(),{search:h,select:I,getContracts:u,getUsers:E,getOrders:D,getServices:j,currentPage:S,perPage:M,sortBy:G,sortDesc:x,sortDirection:T,pageOptions:O,filteredContractsLength:R,worksCompleteFields:he,getFilteredOrders:U,invoicePayment:_,invoicesReject:Y,switchPaymentSystem:d,setPageToZero:A,secondToDate:de,formNormalDate:me,getInvoicesTTFLink:P,getInvoicesPDFLink:H,createNewIncoice:L,invoiceSetConditionally:F,openHistoryStatuses:e}}},kt=oe(nt,[["render",ot],["__scopeId","data-v-7809a024"]]);export{kt as default};
