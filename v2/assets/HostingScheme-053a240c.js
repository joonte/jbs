import{E as De}from"./EmptyStateBlock-2d70ce64.js";import{_ as ke}from"./ButtonDefault-5aebc1f7.js";import{_ as ye}from"./BlockOrderPayBalance-510763c2.js";import{_ as ie,a7 as ue,e as _e,r as B,i as de,o as k,c as y,a as e,n as ae,t as n,b as v,Z as j,a9 as G,m as ce,F as A,S as fe,g as x,O as ge,ag as W,w as ne,x as re,k as Ie,p as Ce,l as Be}from"./index-90eb49f0.js";import{u as Ee}from"./hosting-606725d4.js";import{u as Oe}from"./contracts-0cbe8270.js";import{u as we}from"./domain-589159b1.js";import{u as Pe}from"./services-ecabd454.js";import{_ as Ve}from"./paramsAccordionBlock-ac76aa5f.js";import{D as $e}from"./DomainCheckBlock-d4d732a5.js";import{_ as Ne}from"./BlockSelectContract-5c8bdad1.js";import{_ as He}from"./ClausesKeeper-313482ce.js";import xe from"./BlockAdditionalServices-8e8d249f.js";import{B as Ae}from"./BlockBalanceAgreement-267acfcf.js";import"./bootstrap-vue-next.es-788a757a.js";import"./IconHelp-3a9b4523.js";import"./globalActions-a5ec5102.js";import"./BasicInput-936f29ee.js";import"./component-65c692c0.js";import"./IconArrow-380053a0.js";/* empty css                                                                             */import"./multiselect-e18abfd5.js";import"./IconClose-c838a5bc.js";import"./ServiceListOrderSelection-171e49ee.js";const Re={class:"section"},Ue={class:"container"},Fe={class:"section-nav"},Le={__name:"BlockOrderServiceWrapper",props:{basic_title:{type:String,default:"basic_title"},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup($,{emit:u}){const _=$,m=ue(),E=_e(),a=B("");function p(){return m.fullPath.includes("?section=Services")}function T(d=null){d?(a.value="Services",E.replace({query:{section:"Services"}})):(a.value="",E.replace({query:{}})),u("update:modelValue",d||"")}return de(()=>{m.query.section==="Services"&&(a.value="Services")}),(d,f)=>{const l=He;return k(),y(A,null,[e("div",Re,[e("div",Ue,[e("div",Fe,[e("div",{class:ae(["section-nav__item",[p()?"":"active"]]),onClick:f[0]||(f[0]=O=>T())},n(_.basic_title),3),e("div",{class:ae(["section-nav__item",[p()?"active":""]]),onClick:f[1]||(f[1]=O=>T("Services"))},"Услуги",2)])])]),v(l),e("div",null,[j(e("div",null,[ce(d.$slots,"page",{},void 0,!0)],512),[[G,a.value===""]]),j(e("div",null,[ce(d.$slots,"services",{},void 0,!0)],512),[[G,a.value!==""]])])],64)}}},Te=ie(Le,[["__scopeId","data-v-e8bb070c"]]);const z=$=>(Ce("data-v-446694a7"),$=$(),Be(),$),Ke={class:"hosting-sheme"},qe={class:"section"},We={class:"container"},je={class:"section-header"},Ge={class:"section-title"},ze=z(()=>e("div",{class:"section-label"},"Хостинг",-1)),Me={class:"section"},Ze={class:"container"},Je={class:"total-block"},Qe={class:"total-block__row divider-bottom"},Xe=z(()=>e("div",{class:"total-block__col"},"Цена тарифа",-1)),Ye={class:"total-block__col"},et={class:"total-block__row no-divider"},tt={class:"total-block__col"},st={class:"total-block__col"},ot={class:"total-block__row"},lt=z(()=>e("div",{class:"total-block__col"},"Дополнительные услуги",-1)),at={class:"total-block__col"},ct={class:"total-block__row no-divider"},nt={class:"total-block__col"},rt={class:"total-block__col"},it={class:"total-block__row total-block__row--big economy-line"},ut=z(()=>e("div",{class:"total-block__col red"},"Выгода",-1)),_t={class:"total-block__col flex-col"},dt={class:"red"},vt={class:"total-block__row total-block__row--big"},mt={class:"total-block__col"},pt={class:"total-block__col"},St={key:1,class:"section"},ht={class:"container"},bt={__name:"HostingScheme",async setup($){let u,_;const m=Ee(),E=Oe(),a=we(),p=Pe();fe("emitter");const T=ue(),d=_e(),f=B(!1),l=B(null),O=B([]),K=B(!1),g=B(null),i=B(null),J=B(""),Q=t=>{t.key==="Enter"&&t.ctrlKey&&!ve.value&&te()},ve=x(()=>l.value===null||g.value===null),N=x(()=>{var t;return(t=m==null?void 0:m.hostingSchemes)==null?void 0:t[T.params.id]}),me=x(()=>E==null?void 0:E.contractsList),X=x(()=>p==null?void 0:p.ServicesList),pe=x(()=>{var t;return(t=Object.keys(a==null?void 0:a.domainSchemes))==null?void 0:t.map(s=>{var c;return{...a==null?void 0:a.domainSchemes[s],value:(c=a==null?void 0:a.domainSchemes[s])==null?void 0:c.ID}})}),Y=x(()=>{let t=0;return O.value.forEach(s=>{t+=s==null?void 0:s.Price}),w(t)||0});de(()=>{document.addEventListener("keyup",Q)}),ge(()=>{document.removeEventListener("keyup",Q)});function ee(){var s,c;let t=0;return(c=(s=l.value)==null?void 0:s.discounts)==null||c.Bonuses.map(S=>{t+=+S.Economy}),t}function w(t){return Number(t).toFixed(2)||0}function Se(t){i.value=t}function he(t){l.value=t}async function be(t){var s;for(const c of O.value){let S="SUCCESS",h=(s=X.value[c.ServiceID])==null?void 0:s.Code;if(await p.ServiceOrder({Code:h,DependOrderID:t,...c,ContractID:g.value}).then(({result:P,info:r,error:H})=>{if(P==="SUCCESS"){let b={};h==="Default"?b.ServiceOrderID=r==null?void 0:r.ServiceOrderID:b[`${h}OrderID`]=r==null?void 0:r.ServiceOrderID,p.ServiceOrderPay(h,b).then(V=>{let{result:I,error:R}=V;I==="SUCCESS"?d.push("/AdditionalServices}"):I==="BASKET"&&d.push("/Basket")})}else S="ERROR"}),S==="ERROR")break}}function te(){var t,s,c,S,h,P,r,H,b,V,I;K.value=!0,m.HostingOrder({ContractID:g.value,Domain:`${((t=i.value)==null?void 0:t.line)||""}${(s=i.value)!=null&&s.line&&((c=i.value)!=null&&c.Name)?"."+(((S=i.value)==null?void 0:S.Name)||""):""}`,DomainName:(h=i.value)==null?void 0:h.line,HostingSchemeID:(P=N.value)==null?void 0:P.ID,DomainSchemeID:(r=i.value)!=null&&r.line&&((H=i.value)!=null&&H.ID)?(b=i.value)==null?void 0:b.ID:null,DomainTypeID:(V=i.value)!=null&&V.line?(I=i.value)!=null&&I.Name?"Order":"Nothing":"None"}).then(({result:R,info:D,error:M})=>{var U,F;R==="SUCCESS"?(be(D==null?void 0:D.OrderID),m.HostingOrderPay({HostingOrderID:D==null?void 0:D.HostingOrderID,DaysPayFromBallance:((U=l.value)==null?void 0:U.daysFromBalance)||0,DaysPay:(F=l.value)==null?void 0:F.actualDays}).then(q=>{let{result:L,error:Z}=q;L==="SUCCESS"?d.push("/HostingOrders"):L==="BASKET"&&d.push("/Basket"),K.value=!1})):K.value=!1})}return[u,_]=W(()=>a.fetchDomainSchemes()),await u,_(),[u,_]=W(()=>m.fetchHostingSchemes()),await u,_(),[u,_]=W(()=>E.fetchContracts()),await u,_(),[u,_]=W(()=>p.fetchServices()),await u,_(),(t,s)=>{var P,r,H,b,V,I,R,D,M,U,F,q,L,Z,se,oe,le;const c=ye,S=ke,h=De;return k(),y(A,null,[v(Ae),e("div",Ke,[(P=N.value)!=null&&P.ID?(k(),y(A,{key:0},[e("div",qe,[e("div",We,[e("div",je,[e("h1",Ge,n((r=N.value)==null?void 0:r.Name),1),ze])])]),v(Te,{basic_title:"Хостинг",modelValue:J.value,"onUpdate:modelValue":s[3]||(s[3]=o=>J.value=o)},{page:ne(()=>{var o;return[v(Ve,{"params-list":(o=N.value)==null?void 0:o.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),v(Ne,{title:"Договор",modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=C=>g.value=C)},null,8,["modelValue"]),v(c,{contractID:g.value,scheme:N.value,serviceID:"10000",isOrderID:!1,onSelect:he,isBalancePay:f.value,"onUpdate:isBalancePay":s[1]||(s[1]=C=>f.value=C)},null,8,["contractID","scheme","isBalancePay"]),v($e,{"domain-list":pe.value,onSelect:Se},null,8,["domain-list"])]}),services:ne(()=>{var o;return[v(xe,{modelValue:O.value,"onUpdate:modelValue":s[2]||(s[2]=C=>O.value=C),serviceSearchParams:{ServiceID:"10000",ServersGroupID:(o=N.value)==null?void 0:o.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]}),_:1},8,["modelValue"]),e("div",Me,[e("div",Ze,[j(e("div",Je,[((V=(b=(H=l.value)==null?void 0:H.discounts)==null?void 0:b.Bonuses)==null?void 0:V.length)>0?(k(),y(A,{key:0},[e("div",Qe,[Xe,e("div",Ye,n(w((I=l.value)==null?void 0:I.price))+" ₽",1)]),(k(!0),y(A,null,re((D=(R=l.value)==null?void 0:R.discounts)==null?void 0:D.Bonuses,o=>(k(),y("div",et,[e("div",tt,"Скидка "+n(o==null?void 0:o.Discount)+"% на "+n(o==null?void 0:o.Days)+" дней",1),e("div",st,"-"+n(w(o==null?void 0:o.Economy))+" ₽",1)]))),256))],64)):Ie("",!0),e("div",ot,[lt,e("div",at,n(Y.value)+" ₽",1)]),(k(!0),y(A,null,re(O.value,o=>{var C;return k(),y("div",ct,[e("div",nt,n((C=X.value[o==null?void 0:o.ServiceID])==null?void 0:C.Name),1),e("div",rt,n(w(o==null?void 0:o.Price))+" ₽",1)])}),256)),j(e("div",it,[ut,e("div",_t,[e("span",null,[e("s",null,n(w((M=l.value)==null?void 0:M.price))+" ₽",1)]),e("span",dt,"-"+n(w(ee()))+" ₽",1)])],512),[[G,((q=(F=(U=l.value)==null?void 0:U.discounts)==null?void 0:F.Bonuses)==null?void 0:q.length)>0]]),e("div",vt,[e("div",mt,"Итого за "+n((L=l.value)==null?void 0:L.label),1),e("div",pt,n(w(((Z=l.value)==null?void 0:Z.price)-ee()+ +Y.value))+" ₽",1)])],512),[[G,(se=l.value)==null?void 0:se.price]]),v(S,{class:"btn--wide",label:f.value||((oe=me.value[g.value])==null?void 0:oe.Balance)>((le=l.value)==null?void 0:le.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:l.value===null||g.value===null,"is-loading":K.value,onClick:s[4]||(s[4]=o=>te())},null,8,["label","disabled","is-loading"])])])],64)):(k(),y("div",St,[e("div",ht,[v(h,{label:"Тариф не найден"})])]))])],64)}}},qt=ie(bt,[["__scopeId","data-v-446694a7"]]);export{qt as default};
