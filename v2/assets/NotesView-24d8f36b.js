import{o as _,c as D,a as m,b as C,_ as A,k as q,z as $,w as F,F as M,y as K,a9 as Y,p as z,m as G,r as J,g as Q,h as b,e as X,U as Z,a4 as ee,P as te,i as ne,a3 as oe}from"./index-918fd9be.js";import{_ as se,u as ce,n as ie}from"./networkController-be1ef6e2.js";import{u as re}from"./postings-4ae265b3.js";import{u as ae}from"./contracts-580f94dc.js";import{I as O}from"./IconClose-6ceae682.js";import{E as B}from"./EmptyStateBlock-531c1077.js";import{B as L}from"./BlockBalanceAgreement-e7f96bc6.js";import{_ as de}from"./ClausesKeeper-a5c1abc1.js";import"./bootstrap-vue-next.es-1529a2a7.js";import"./ButtonDefault-2f55d117.js";import"./IconArrow-f2d41a4e.js";const le={class:"notes__note-container new-class"},me={class:"notes__content"},pe=["innerHTML"];function he(o,d,h,a,p,S){const w=O;return _(),D("div",le,[m("div",me,[m("div",{innerHTML:h.item},null,8,pe),m("div",{class:"notes__close-button",onClick:d[0]||(d[0]=v=>a.closeNote(h.index))},[C(w,{class:"notes__close-button-cross"})])])])}const ue={components:{IconClose:O},props:{item:{type:String,default:""},index:{type:[String,Number],default:""}},emits:["delete"],setup(o,{emit:d}){function h(a){let p=new Date;p.setDate(30+p.getDate()),document.cookie=`${a}=hidden; path=/; expires=${p}`,d("delete",a)}return{closeNote:h}}},fe=A(ue,[["render",he],["__scopeId","data-v-dc1d8cc5"]]),_e=o=>(z("data-v-c6ed7633"),o=o(),G(),o),Se={class:"section"},we={class:"container"},Ie=_e(()=>m("div",{class:"section-header"},[m("h1",{class:"section-title"},"Уведомления")],-1)),ve={class:"notes"},ge={class:"notes-delete"},De=["onClick"];function Ce(o,d,h,a,p,S){const w=L,v=de,i=O,c=q("note"),k=B;return _(),D(M,null,[C(w),m("div",Se,[m("div",we,[Ie,C(v),m("div",ve,[a.notes&&Object.keys(a.notes).length>0?(_(),$(Y,{key:0,class:"notes__transition-container",tag:"div",name:"list"},{default:F(()=>[(_(!0),D(M,null,K(a.notes,(I,u)=>(_(),D("div",ge,[m("div",{class:"notes__close-button",onClick:x=>a.deleteItem(u)},[C(i,{class:"notes__close-button-cross"})],8,De),(_(),$(c,{innerHTML:I,item:I,index:u,key:u},null,8,["innerHTML","item","index"]))]))),256))]),_:1})):(_(),$(k,{key:1,label:"Все уведомления прочитаны или они еще не пришли"}))])])])],64)}const Oe={components:{IconCross:se,IconClose:O,Note:fe,EmptyStateBlock:B,BlockBalanceAgreement:L},async setup(){const o=ce(),d=J(null),h=re(),a=ae(),p=Q(),S=b(()=>p.userInfo),w=b(()=>{var e,t;return(t=Object.keys((e=S.value)==null?void 0:e.Contacts))==null?void 0:t.map(n=>{var s,r,f,l,g;if(!((f=(r=(s=S.value)==null?void 0:s.Contacts)==null?void 0:r[n])!=null&&f.IsHidden))return(g=(l=S.value)==null?void 0:l.Contacts)==null?void 0:g[n]})}),v=e=>w.value.find(t=>t.ID===e),i=X(),c=Z("emitter"),k=[{old:"/v2/DNSmanagerSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=52000"},{old:"/v2/ExtraIPSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=50000"},{old:"/v2/ISPswSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=51000"}],I=b(()=>{let e={};return Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t]}),Object.keys(e).length>0?e:null});function u(){let e={};Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;x(t)&&(e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t])}),d.value=e}function x(e){return document.cookie.match(RegExp(`(?:^|;\\s*)${e}=([^;]*)`))===null}function P(e){return Object.values(e).map((t,n)=>{let s=t;const r=/<NOBODY>/gi;return s=s.replace(r,"<div>"),s=s.replace(/<\/NOBODY>/gi,"</div>"),k.forEach(({old:f,new:l})=>{const g=new RegExp(`<a[^>]*href="${f}"[^>]*>`,"gi");s=s.replace(g,U=>U.replace(`href="${f}"`,`href="${l}"`))}),s})}function j(e){i.push(e)}function T(e){let t=new Date;t.setDate(30+t.getDate()),delete d.value[e],document.cookie=`${e}=hidden; path=/; expires=${t}`,c.emit("notes-reduce"),console.log(document.cookie,2),console.log(e,2)}const E=async(e,t)=>{try{return(await oe.post(e,t)).data}catch(n){throw new Error(`Error sending confirm request: ${n.message}`)}};async function y(e,t){if((e.includes("ISPswSchemes")||e.includes("ExtraIPSchemes")||e.includes("DNSmanagerSchemes"))&&(e.includes("ISPswSchemes")&&i.push("/AdditionalServicesOrder?ServiceID=51000"),e.includes("ExtraIPSchemes")&&i.push("/AdditionalServicesOrder?ServiceID=50000"),e.includes("DNSmanagerSchemes")&&i.push("/AdditionalServicesOrder?ServiceID=52000")),e.includes("OrderPay")){let n=t[Object.keys(t).find(s=>s.includes("OrderID"))];e!=="/ExtraIPOrderPay"&&e!=="/ISPswOrderPay"&&e!=="/DNSmanagerOrderPay"?i.push(`${e}/${n}`):e==="/ExtraIPOrderPay"||e==="/ISPswOrderPay"||e==="/DNSmanagerOrderPay"?i.push(`${e}/${n}`):i.push(`/ServiceOrderPay/${n}`)}else if(e==="/InvoiceDocument")h.InvoiceDocument({InvoiceID:t.InvoiceID}).then(n=>{c.emit("open-modal",{component:"InvoiceDocument",data:{html:n,ID:t.InvoiceID}})});else if(e==="/API/OrdersTransfer")c.emit("open-modal",{component:"TakeOrder",data:{OrdersTransferID:t}});else if(e==="/ContractMake")i.push("ContractMake");else if(e==="/HostingOrderSchemeChange")i.push(`/HostingOrders/${t.OrderID}/SchemeChange`);else if(e==="/VPSOrderSchemeChange")i.push(`/VPSOrders/${t.OrderID}/SchemeChange`);else if(e==="/DomainSelectOwner")c.emit("open-modal",{component:"DomainSelectOwner",data:t});else if(e==="/ISPswOrders")i.push("AdditionalServices");else if(e==="/ContactEdit?MethodID=VKontakte")c.emit("open-modal",{component:"CreateVK"});else if(e==="/ContactEdit?MethodID=Telegram")c.emit("open-modal",{component:"CreateTelegram"});else if(e==="/ContactEdit?MethodID=Viber")c.emit("open-modal",{component:"CreateViber"});else if(e==="/ContactEdit?MethodID=SMS")c.emit("open-modal",{component:"CreatePhone"});else if(e.includes("/ContactEdit")){(t==null?void 0:t.MethodID)==="SMS"&&c.emit("open-modal",{component:"CreatePhone"});const n=e.match(/ContactID=(\d+)/),s=n?n[1]:null;if(s){const r=v(s);if(r){const f={Method:r.MethodID,Value:r.Address,ContactID:r.ID};try{const l=await E("/API/Confirm",f);l.Status==="Ok"?c.emit("open-modal",{component:"AcceptContact",data:{contactId:s,sendConfirmRequest:E}}):console.error(`Error confirming code. Status: ${l.Status}, Message: ${l.Message}`)}catch(l){console.error("Error accepting contact:",l.message)}}}else console.error("ContactID is not present in the URL params.",e)}else e==="/ProfileEdit"?i.push(`/ContractEdit/${t.ProfileID}`):c.emit("open-modal",{component:e.replace("/",""),data:t})}function V(){}function H(e,t,n,s){ie.post(e,t).then(r=>{r.data.Status==="Exception"?c.emit("open-modal",{component:"ExclusionWindow",data:r.data}):o.fetchNotes().then(()=>{u()})}).catch(r=>{console.error("Ошибка при выполнении запроса:",r)})}function R(e,t){c.emit("open-modal",{component:"DeleteItem",data:{id:null,callback:t,message:e,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function W(){}function N(){window.ShowWindow=y.bind(this)}return ee(()=>{N()}),te(()=>{window.ShowWindow=null}),ne(()=>{console.log(d,"view");const e=I.value;e&&(d.value=P(e),console.log(P(e)),u())}),c.on("close-modal",()=>{N()}),window.ShowProgress=W.bind(this),window.ShowWindow=y.bind(this),window.PromptShow=V.bind(this),window.AjaxCall=H.bind(this),window.ShowConfirm=R.bind(this),await o.fetchNotes().then(()=>{u()}),await a.fetchContracts(),await a.fetchProfiles(),await p.fetchUserData(),{getNotesList:I,notes:d,ShowWindow:y,deleteItem:T,processNotes:P,redirectToNewPage:j}}},Le=A(Oe,[["render",Ce],["__scopeId","data-v-c6ed7633"]]);export{Le as default};
