import{j as E,o as n,c as l,b as g,a as s,t as D,F as y,x as w,k as A,y as F,n as M,p as R,l as z,_ as K,u as O,S as T,a7 as U,e as q,r as b,g as B}from"./index-83b4b7ba.js";import{I as G}from"./IconSearch-30270af1.js";import{_ as x}from"./ClausesKeeper-55c14b7f.js";import{c as H}from"./component-abb1f5a9.js";import{u as J}from"./postings-05f51b78.js";import{u as Q}from"./contracts-623ec7a8.js";import{u as W}from"./invoices-7828d146.js";import{B as L}from"./BlockBalanceAgreement-c5fad736.js";import{E as X}from"./EmptyStateBlock-68a1c33e.js";import{_ as Y}from"./ButtonDefault-dc248ec6.js";import"./IconClose-86aafc4e.js";import"./bootstrap-vue-next.es-8f3ae81a.js";import"./IconArrow-80c72216.js";const S=a=>(R("data-v-d6481b42"),a=a(),z(),a),Z={class:"section"},$={class:"container"},tt={class:"section-header"},st=S(()=>s("h1",{class:"section-title"},"Пополнить баланс",-1)),et={class:"section-label"},ot={key:0,class:"list-form"},nt={class:"list-part"},at=S(()=>s("div",{class:"list-item__title"},"Платежные системы",-1)),ct={key:0,class:"list-row grid-net"},lt=["onClick"],it=["src"],rt={class:"list-item__image-title"},_t={class:"list-part"},dt=S(()=>s("div",{class:"list-item__title"},"Сумма пополнения",-1)),mt={class:"list-row"},ut=S(()=>s("div",{class:"list-form_col list-form_col--sm"},"Пополнить на сумму",-1)),pt={class:"list-form_col list-form_col--xl"},vt={class:"search-field form-field"},ft={class:"list-row"},yt=S(()=>s("div",{class:"list-form_col list-form_col--sm"},null,-1)),St={class:"btn-container"};function It(a,m,V,e,P,k){const C=L,u=x,p=E("imask-input"),v=Y,f=X;return n(),l(y,null,[g(C),s("div",Z,[s("div",$,[s("div",tt,[st,s("div",et,"Договор # "+D(a.$route.params.id)+" / "+D(e.getContract.Customer),1)]),g(u),e.getContract?(n(),l("div",ot,[s("div",nt,[at,e.filterActiveSystems?(n(),l("div",ct,[(n(!0),l(y,null,w(e.filterActiveSystems,i=>(n(),l(y,null,[(n(!0),l(y,null,w(i,t=>{var I;return n(),l(y,null,[t!=null&&t.IsActive?(n(),l("div",{key:0,class:M(["list-item",{"list-item_active":((I=e.paymentSystem)==null?void 0:I.id)===(t==null?void 0:t.ID)}]),onClick:o=>e.paymentSystem={id:t==null?void 0:t.ID,type:t==null?void 0:t.Source}},[s("img",{class:"list-item__image",src:t==null?void 0:t.Image},null,8,it),s("div",rt,D(t==null?void 0:t.Description),1)],10,lt)):A("",!0)],64)}),256))],64))),256))])):A("",!0)]),s("div",_t,[dt,s("div",mt,[ut,s("div",pt,[s("div",vt,[g(p,{type:"text",mask:Number,placeholder:"100 ₽",modelValue:e.inputValue,"onUpdate:modelValue":m[0]||(m[0]=i=>e.inputValue=i)},null,8,["modelValue"])])])]),s("div",ft,[yt,s("div",St,[g(v,{"is-loading":e.isLoading,label:"Пополнить баланс",onClick:m[1]||(m[1]=i=>e.sendInvoice())},null,8,["is-loading"])])])])])):(n(),F(f,{key:1,label:"Договор не найден"}))])])],64)}const ht={components:{IconSearch:G,BlockBalanceAgreement:L,ClausesKeeper:x,"imask-input":H},async setup(){const a=Q(),m=O(),V=W(),e=J(),P=T("emitter"),k=U(),C=q(),u=b(null),p=b(null),v=b(!1),f=B(()=>{var o;return(o=a.contractsList)==null?void 0:o[k.params.id]}),i=B(()=>m.ConfigList),t=B(()=>{const o=i.value,r=f.value;if(o!=null&&o.PaymentSystems&&(r!=null&&r.PaymentSystems)){const _=new Set(r.PaymentSystems);return Object.keys(o.PaymentSystems).filter(c=>_.has(c)).map(c=>{var h;const d=o.PaymentSystems[c];return String(d==null?void 0:d.IsActive)==="1"?(h=d.Collations)==null?void 0:h.slice().sort((N,j)=>(console.log(_),parseInt(N.SortID)-parseInt(j.SortID))):null}).filter(c=>c!==null)}else return null});function I(){var o,r;p.value>0&&(v.value=!0,V.InvoiceMake({ContractID:(o=f.value)==null?void 0:o.ID,PaymentSystemID:(r=u.value)==null?void 0:r.type,Summ:p.value}).then(_=>{var c;if(v.value=!1,_.status==="success"&&_.data&&_.data.InvoiceID){const d=_.data.InvoiceID;e.InvoiceDocument({InvoiceID:d}).then(h=>{P.emit("open-modal",{component:"InvoiceDocument",data:{html:h,ID:d}})})}else C.push(`/ProfileMake?Contract=${k.params.id}&TemplateID=${(c=u.value)==null?void 0:c.type}`)}))}return await a.fetchContracts(),{inputValue:p,getConfig:i,filterActiveSystems:t,paymentSystem:u,isLoading:v,getContract:f,sendInvoice:I}}},Et=K(ht,[["render",It],["__scopeId","data-v-d6481b42"]]);export{Et as default};
