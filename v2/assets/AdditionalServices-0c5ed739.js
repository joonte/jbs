import{j as E,o as k,c as A,a as r,t as h,b as f,x as N,w as m,d as U,F as V,p as X,l as Y,_ as R,e as F,f as M,r as T,g as L,i as z,h as Z,v as $,n as H,k as ee,a7 as te,R as oe}from"./index-58c913f0.js";import{u as q}from"./services-644396f4.js";import{u as K}from"./contracts-5c545170.js";import"./postings-52df0d29.js";import{u as se}from"./globalActions-45df61a2.js";import{f as P}from"./useTimeFunction-8602dd60.js";import{_ as W}from"./IconCard-94a8b1b0.js";import{E as j}from"./EmptyStateBlock-e5319013.js";import{S as G}from"./StatusBadge-cd8ad979.js";import{s as ne}from"./servicesStatuses-6293b6ac.js";import{_ as re}from"./HelperComponent-8d748301.js";import{z as ce,k as ae,d as ie,C as le}from"./bootstrap-vue-next.es-9015192b.js";import{_ as de}from"./IconDots-1997c758.js";import{_ as _e}from"./ClausesKeeper-7b7ef561.js";import{_ as ue}from"./ButtonDefault-7a589010.js";import{s as me}from"./multiselect-1db9a63f.js";import{B as J}from"./BlockBalanceAgreement-59500b1f.js";import{_ as ve}from"./IconArrow-bff54646.js";import"./IconClose-3552080e.js";const De=[{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],w=c=>(X("data-v-f5da6a39"),c=c(),Y(),c),fe={class:"section-header"},pe={class:"section-title__nowrap"},Ie={class:"section-title"},Se={class:"btn__group"},ge=w(()=>r("span",{class:"td-mobile"},"Заказ",-1)),ye=w(()=>r("span",{class:"td-mobile"},"Договор",-1)),be=w(()=>r("span",{class:"td-mobile"},"Ключевые поля",-1)),ke=["title"],he=w(()=>r("span",{class:"td-mobile"},"Статус",-1)),Oe=w(()=>r("span",{class:"td-mobile"},"Дата окончания",-1)),Ce=w(()=>r("span",{class:"td-mobile"},"Комментарий",-1)),we={class:"service__controls-wrapper"},Be=["onClick"],xe={class:"btn btn--dots"};function Ne(c,u,_,e,B,O){var s,t,b;const I=ue,S=_e,v=G,p=E("Helper"),C=W,g=de,i=E("router-link"),o=ce,a=ae,y=ie,l=le,d=j;return k(),A(V,null,[r("div",fe,[r("div",pe,[r("h1",Ie,h((s=_.sectionData)==null?void 0:s.Item),1),r("div",Se,[f(I,{label:"Заказать",onClick:u[0]||(u[0]=n=>e.navigateToOrder())})])]),f(S,{class:"additional-clauses",partition:`Header:${((t=_.sectionData)==null?void 0:t.Code)==="Default"?_.sectionID:`/${(b=_.sectionData)==null?void 0:b.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(k(),N(l,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":u[1]||(u[1]=n=>e.sortBy=n),"sort-desc":e.sortDesc,"onUpdate:sortDesc":u[2]||(u[2]=n=>e.sortDesc=n),"sort-direction":e.sortDirection},{"cell(ID)":m(n=>[ge,r("span",null,h(n.value),1)]),"cell(ContractID)":m(n=>{var D;return[ye,r("span",null,h((D=e.getContracts[n.value])==null?void 0:D.Customer),1)]}),"cell(Keys)":m(n=>{var D,x;return[be,r("span",{title:e.getTitleText((D=n.item)==null?void 0:D.ID)},h(e.findDomainByOrderID((x=n.item)==null?void 0:x.ID)),9,ke)]}),"cell(StatusID)":m(n=>[he,f(v,{status:n.value,"status-table":"Orders"},null,8,["status"])]),"cell(ExpirationDate)":m(n=>{var D,x;return[Oe,r("span",null,h(e.calculateExpirationDate((D=n.item)==null?void 0:D.DaysRemainded))+" | "+h(((x=n.item)==null?void 0:x.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":m(n=>{var D;return[Ce,f(p,{"user-notice":n.value,id:(D=n.item)==null?void 0:D.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":m(n=>[r("div",we,[r("div",{class:"btn btn--md btn--bold",onClick:D=>c.$router.push(`/ServiceOrderPay/${n.item.ID}`)},[f(C),U("Оплатить")],8,Be),f(y,{class:"dropdown-dots",right:""},{"button-content":m(()=>[r("div",xe,[f(g)])]),default:m(()=>[f(o,null,{default:m(()=>[f(i,{to:`/AdditionalServices/${n.item.ID}`},{default:m(()=>[U("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),f(a),f(o,{class:"color-red",onClick:D=>c.$emit("deleteItem",n.item)},{default:m(()=>[U("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","sort-direction"])):(k(),N(d,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const Te={components:{EmptyStateBlock:j,StatusBadge:G,IconCard:W,Helper:re},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList"],setup(c){const u=F(),_=M(),e=T("ID"),B=T(!0),O=T("desc"),I=K(),S=q(),v=L(()=>S==null?void 0:S.DNSmanagerOrdersList),p=L(()=>I==null?void 0:I.contractsList),C=l=>{const d=g(l);if(d){const s=d.split(","),t=s.length,b=s.join(`
`);return`Всего: ${t}
${b}`}return"Нет данных"},g=l=>{console.log(l);const d=Object.entries(v.value).reduce((s,[t,b])=>(s[t]=b,s),{});for(const s in d)if(Object.hasOwnProperty.call(d,s)){const t=d[s];if(String(t.OrderID)===String(l))return t.Parked}return null},i=l=>{console.log(l);const d=Object.entries(v.value).reduce((s,[t,b])=>(s[t]=b,s),{});for(const s in d)if(Object.hasOwnProperty.call(d,s)){const t=d[s];if(String(t.OrderID)===String(l))return t.Domain}return null};z(()=>{console.log(v),console.log(p)});const o=L(()=>{var l,d;return(d=(l=Object.keys(_==null?void 0:_.userOrders).map(s=>{var t;return{..._==null?void 0:_.userOrders[s],ID:Number((t=_==null?void 0:_.userOrders[s])==null?void 0:t.ID)}}))==null?void 0:l.reverse())==null?void 0:d.filter(s=>s.ServiceID===(c==null?void 0:c.sectionID))});function a(){u.push(`/AdditionalServicesOrder?ServiceID=${c==null?void 0:c.sectionID}`)}function y(l){if(!l)return P(new Date);const d=new Date,s=new Date(d.getTime()+l*24*60*60*1e3);return P(s)}return Z(v,l=>{console.log(l)}),{authStore:_,getOrders:o,getContracts:p,sortBy:e,sortDesc:B,sortDirection:O,navigateToOrder:a,servicesStatuses:ne,oneTimeWorksFields:De,calculateExpirationDate:y,getDNSmanagerOrders:v,findDomainByOrderID:i,findParkedByOrderID:g,getTitleText:C}}},Q=R(Te,[["render",Ne],["__scopeId","data-v-f5da6a39"]]),Ae={class:"section"},Le={class:"container"},je={class:"section-header"},Ue={class:"section-nav"},Ee=["onClick"],Ve={class:"multiselect-option"},He={class:"section-body"};function Pe(c,u,_,e,B,O){var g,i,o,a,y,l,d,s;const I=J,S=ve,v=E("Multiselect"),p=Q,C=j;return k(),A(V,null,[f(I),r("div",Ae,[r("div",Le,[r("div",je,[r("div",Ue,[(k(!0),A(V,null,$((g=e.getServices)==null?void 0:g.slice(0,3),t=>(k(),A("div",{class:H(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(t==null?void 0:t.ID)}]),onClick:b=>e.switchToSection(t==null?void 0:t.ID)},h(t==null?void 0:t.Item),11,Ee))),256)),((i=e.getServices)==null?void 0:i.length)>3?(k(),N(v,{key:0,modelValue:e.section,"onUpdate:modelValue":u[0]||(u[0]=t=>e.section=t),class:H({"multiselect--white additional-service__select":!0,"additional-service__select_active":(a=e.getServices)==null?void 0:a.slice(3,(o=e.getServices)==null?void 0:o.length).find(t=>(t==null?void 0:t.ID)===e.section)}),options:(l=e.getServices)==null?void 0:l.slice(3,(y=e.getServices)==null?void 0:y.length),label:"ID",onSelect:u[1]||(u[1]=t=>e.switchToSection(t))},{option:m(({option:t})=>[r("div",Ve,h(t==null?void 0:t.Item),1)]),caret:m(()=>[f(S,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):ee("",!0)])]),r("div",He,[(d=e.getServices)!=null&&d.find(t=>t.ID===e.section)?(k(),N(p,{key:0,sectionID:e.section,sectionData:(s=e.getServices)==null?void 0:s.find(t=>t.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(k(),N(C,{key:1,label:"Услуга не найдена"}))])])])],64)}const Re={components:{ServiceListSection:Q,emptyStateBlock:j,Multiselect:me,BlockBalanceAgreement:J},async setup(){const c=te(),u=F(),_=oe("emitter"),e=q(),B=se(),O=M(),I=K(),S=T(null),v=L(()=>{var i;return(i=Object.keys(e==null?void 0:e.ServicesList))==null?void 0:i.map(o=>{var a;return{...e==null?void 0:e.ServicesList[o],value:(a=e==null?void 0:e.ServicesList[o])==null?void 0:a.ID}}).filter(o=>(o==null?void 0:o.ServicesGroupID)!=="1000"&&(o==null?void 0:o.IsActive)&&!(o!=null&&o.IsHidden)).sort((o,a)=>Number(o==null?void 0:o.SortID)<Number(a==null?void 0:a.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(a==null?void 0:a.SortID)?1:0)}),p=T(null);_.on("updateServicesList",()=>{O.fetchUserOrders()});function C(i){u.replace(`/AdditionalServices?ServiceID=${i}`),p.value=i}function g(i){B.deleteItem({TableID:"Orders",RowsIDs:i.ID}).then(({result:o,error:a})=>{o==="SUCCESS"&&O.fetchUserOrders()})}return z(()=>{var i,o;(i=v.value)!=null&&i.find(a=>{var y;return(a==null?void 0:a.ID)===((y=c==null?void 0:c.query)==null?void 0:y.ServiceID)})?p.value=(o=c==null?void 0:c.query)==null?void 0:o.ServiceID:u.replace(`/AdditionalServices?ServiceID=${p.value}`)}),await e.fetchServices().then(()=>{var i,o;p.value=(o=(i=v.value)==null?void 0:i[0])==null?void 0:o.ID}),await I.fetchContracts(),await O.fetchUserOrders(),await e.fetchDNSmanagerOrders(),{section:p,deleteItem:g,getServices:v,additionalServicesValue:S,switchToSection:C}}},ct=R(Re,[["render",Pe],["__scopeId","data-v-0df30ee7"]]);export{ct as default};
