import{j as N,o as g,c as y,a as l,b as d,w as I,d as P,t as h,F as H,x as R,n as X,k as Y,_ as z,e as F,S as G,y as V,r as E,g as M,i as Z}from"./index-b5b5ce3d.js";import{u as $}from"./dedicatedServer-ac37dd46.js";import{u as tt}from"./contracts-74f05bb7.js";import{I as et}from"./IconSearch-1e5f2e1f.js";import{_ as ot}from"./HelperComponent-fa301290.js";import{S as q}from"./StatusBadge-0649a996.js";import{I as nt}from"./IconRotate-965813ef.js";import{f as j}from"./useTimeFunction-8602dd60.js";import"./resetServer-841751d7.js";import{z as st,k as at,d as rt}from"./bootstrap-vue-next.es-37aa63ea.js";import{_ as lt}from"./IconDots-5eb3cb0a.js";import{_ as ct}from"./IconCard-cef3f371.js";import{_ as it}from"./OrderIDBadge-a6480cec.js";import{S as dt}from"./Select2-37752b33.js";import{s as ut}from"./multiselect-4f7d14de.js";import{_ as J}from"./FormInputSearch-23b3b5c7.js";import{B as K}from"./BlockBalanceAgreement-a016b94f.js";import{u as _t}from"./globalActions-6936f67f.js";import{E as mt}from"./EmptyStateBlock-cd0c2748.js";import{_ as ft}from"./ClausesKeeper-3a1c11ba.js";import"./ButtonDefault-0006f72a.js";import"./IconArrow-fddabae2.js";import"./IconPlus-4ce40522.js";import"./IconClose-cd6d3917.js";const Dt={class:"hosting-item"},vt={class:"hosting-item__row"},It={class:"hosting-item__row"},gt={class:"hosting-item__person"},pt={key:0,class:"hosting-item__row"},ht={class:"hosting-item__list"},St=["innerHTML"],Ct={class:"hosting-status__info"},bt={class:"hosting-status__date"},wt={class:"hosting-item__controls"},Ot={class:"btn btn--dots"};function yt(_,n,a,e,S,k){var f,r,v,L,B,x,U,o,t;const p=it,u=N("router-link"),C=N("Helper"),b=q,O=ct,s=lt,i=st,m=at,w=rt;return g(),y("div",Dt,[l("div",vt,[d(p,{orderID:(f=a.itemData)==null?void 0:f.OrderID,onClick:n[0]||(n[0]=c=>{var D;return e.toItem((D=a.itemData)==null?void 0:D.OrderID)})},null,8,["orderID"]),d(u,{class:"hosting-item__name",to:`/DSOrders/${a.itemData.OrderID}`},{default:I(()=>[P(h(a.itemData.IP),1)]),_:1},8,["to"])]),l("div",It,[l("div",gt,h((r=a.itemData)==null?void 0:r.Customer),1),d(C,{"user-notice":(v=a.itemData)==null?void 0:v.UserNotice,id:(L=a.itemData)==null?void 0:L.OrderID,position:a.isLast?"bottom":"top",emit:"updateDSOrdersList"},null,8,["user-notice","id","position"])]),a.params.length?(g(),y("div",pt,[l("ul",ht,[(g(!0),y(H,null,R(a.params,c=>(g(),y("li",{innerHTML:c},null,8,St))),256))]),l("div",Ct,[l("div",{class:X(["hosting-item__date",{danger:Number((B=a.itemData)==null?void 0:B.DaysRemainded)<14}])},h(e.calculateExpirationDate((x=a.itemData)==null?void 0:x.DaysRemainded))+" • "+h(((U=a.itemData)==null?void 0:U.DaysRemainded)||0)+" дн.",3),d(b,{class:"status-badge",status:(o=a.itemData)==null?void 0:o.StatusID,"status-table":"DSOrders",onClick:n[1]||(n[1]=c=>{var D;return e.openHistoryStatuses((D=a.itemData)==null?void 0:D.ID)})},null,8,["status"]),l("div",bt,h(e.calculateDaysSinceStatusUpdate((t=a.itemData)==null?void 0:t.StatusDate)),1)])])):Y("",!0),l("div",wt,[l("div",{class:"btn btn--md btn--bold",onClick:n[2]||(n[2]=c=>{var D;return _.$router.push(`/DSOrderPay/${(D=a.itemData)==null?void 0:D.OrderID}`)})},[d(O),P("Оплатить")]),d(w,{class:"dropdown-dots",right:""},{"button-content":I(()=>[l("div",Ot,[d(s)])]),default:I(()=>[d(i,null,{default:I(()=>{var c;return[d(u,{to:`DSOrders/${(c=a.itemData)==null?void 0:c.OrderID}`},{default:I(()=>[P("Дополнительная информация")]),_:1},8,["to"])]}),_:1}),d(i,{onClick:n[3]||(n[3]=c=>e.transferAccount())},{default:I(()=>[P("Передать на другой аккаунт")]),_:1}),d(m),d(i,{class:"color-red",onClick:n[4]||(n[4]=c=>e.deleteItem())},{default:I(()=>[P("Удалить")]),_:1})]),_:1})])])}const kt={components:{StatusBadge:q,IconRotate:nt,Helper:ot},props:{params:{type:Array,default:()=>[]},itemData:{type:Object,default:()=>{}},isLast:{type:Boolean,default:!1}},emits:["delete","transfer","manage"],setup(_,{emit:n}){const a=F(),e=G("emitter");function S(s){if(!s)return j(new Date);const i=new Date,m=new Date(i.getTime()+s*24*60*60*1e3);return j(m)}function k(s){a.push(`/DSOrders/${s}`)}function p(){var s;n("delete",(s=_.itemData)==null?void 0:s.ID)}function u(){var s,i;n("transfer",{ServiceOrderID:(s=_.itemData)==null?void 0:s.ID,ServiceID:(i=_.itemData)==null?void 0:i.ServiceID})}function C(s){e.emit("open-modal",{component:"StatusHistory",data:{modeID:"DSOrders",rowID:s}})}function b(){var s,i,m;n("manage",{ServiceOrderID:(s=_.itemData)==null?void 0:s.ID,ServiceID:(i=_.itemData)==null?void 0:i.ServiceID,OrderID:(m=_.itemData)==null?void 0:m.OrderID})}function O(s){if(!s)return"";const i=new Date(parseInt(s)*1e3),w=new Date-i,f=Math.floor(w/1e3),r=Math.floor(f/60),v=Math.floor(r/60),L=Math.floor(v/24);return f<60?`${f} сек. от статуса`:r<60?`${r} мин. от статуса`:v<24?`${v} ч. от статуса`:`${L} дн. от статуса`}return{deleteItem:p,orderManage:b,transferAccount:u,calculateExpirationDate:S,openHistoryStatuses:C,toItem:k,calculateDaysSinceStatusUpdate:O}}},Q=z(kt,[["render",yt],["__scopeId","data-v-7a034b14"]]),Lt={class:"section"},Mt={class:"container"},Pt={class:"section-header"},Bt={class:"section-title__nowrap"},xt={class:"list-form"},Ut={class:"list-form_col list-form_col--sm"},Nt={class:"list-form_select"},Vt={class:"multiselect-option"},Ht={key:0};function Tt(_,n,a,e,S,k){var m,w,f;const p=K,u=N("router-link"),C=ft,b=N("Multiselect"),O=J,s=Q,i=mt;return g(),y(H,null,[d(p),l("div",Lt,[l("div",Mt,[l("div",Pt,[l("div",Bt,[l("h1",{class:"section-title",onClick:n[0]||(n[0]=r=>e.reloadNow())},"Выделенные серверы"),d(u,{class:"btn btn--blue btn-default",to:"DSSchemes"},{default:I(()=>[P("Заказать")]),_:1})])]),d(C,{partition:"Header:/DSOrders"}),l("div",xt,[l("div",Ut,[l("div",Nt,[d(b,{modelValue:e.select,"onUpdate:modelValue":n[1]||(n[1]=r=>e.select=r),options:e.getUsers,disabled:((m=e.getUsers)==null?void 0:m.length)<=1,label:"name"},{singlelabel:I(({value:r})=>[l("span",null,"# "+h(r.value.padStart(5,"0"))+" / "+h(r.name),1)]),option:I(({option:r})=>[l("div",Vt,"# "+h(r.value.padStart(5,"0"))+" / "+h(r.name),1)]),_:1},8,["modelValue","options","disabled"])])]),d(O,{modelValue:e.search,"onUpdate:modelValue":n[2]||(n[2]=r=>e.search=r)},null,8,["modelValue"])]),e.getDSList&&((w=e.getDSList)==null?void 0:w.length)>0?(g(),y("div",Ht,[e.filterProducts&&((f=e.filterProducts)==null?void 0:f.length)>0?(g(!0),y(H,{key:0},R(e.filterProducts,(r,v)=>(g(),V(s,{params:e.getDSItemParam(r),"is-last":v===e.filterProducts.length-1,"item-data":r,onDelete:e.deleteItem,onTransfer:e.transferItem,onManage:e.orderManage},null,8,["params","is-last","item-data","onDelete","onTransfer","onManage"]))),256)):(g(),V(i,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(g(),V(i,{key:1,class:"no-margin",label:"У Вас нет заказов на выделенные серверы"}))])])],64)}const At={components:{FormInputSearch:J,IconSearch:et,Select2:dt,Multiselect:ut,DSItem:Q,BlockBalanceAgreement:K},async setup(){const _=E("*"),n=E(null),a=_t(),e=$(),S=tt(),k=F(),p=G("emitter");p.on("updateDSOrdersList",()=>{e.fetchDSOrders()});const u=M(()=>{var o;return(o=Object.keys(e==null?void 0:e.DSList).map(t=>e==null?void 0:e.DSList[t]))==null?void 0:o.reverse()}),C=M(()=>e==null?void 0:e.DSSchemes),b=M(()=>S==null?void 0:S.contractsList),O=M(()=>e==null?void 0:e.DSOrderIPMI),s=M(()=>f(w(u.value)));Z(()=>{u.value.length<1&&m()});function i(){k.go(0)}function m(){k.push({path:"/DSSchemes"})}function w(o){return _.value!=="*"?o.filter(t=>(t==null?void 0:t.ContractID)===_.value):o}function f(o){return n.value!==null?o.filter(t=>(t==null?void 0:t.Customer.toLowerCase().includes(n.value.toLowerCase()))||(t==null?void 0:t.OrderID.toLowerCase().includes(n.value.toLowerCase()))||(t==null?void 0:t.Scheme.toLowerCase().includes(n.value.toLowerCase()))||(t==null?void 0:t.IP.toLowerCase().includes(n.value.toLowerCase()))||(t==null?void 0:t.disks.toLowerCase().includes(n.value.toLowerCase()))||(t==null?void 0:t.CPU.toLowerCase().includes(n.value.toLowerCase()))||(t==null?void 0:t.ram.toLowerCase().includes(n.value.toLowerCase()))):o}function r(o){a.OrderManage(o)}const v=M(()=>{let o=[{value:"*",name:"Все договора"}];return u.value!==null&&b.value!==null?(Object.keys(u.value).forEach(t=>{var c,D,T;o.find(W=>{var A;return W.value===((A=u.value[t])==null?void 0:A.ContractID)})||o.push({value:(c=u.value[t])==null?void 0:c.ContractID,name:(T=b.value[(D=u.value[t])==null?void 0:D.ContractID])==null?void 0:T.Customer})}),o):{value:"*",name:"Все договора"}});function L(o){let t=B(o==null?void 0:o.SchemeID);t===void 0&&(t=o);let c=[];return o!=null&&o.Scheme&&c.push(o==null?void 0:o.Scheme),o!=null&&o.CPU&&c.push(o==null?void 0:o.CPU),t!=null&&t.ram&&c.push("RAM "+(t==null?void 0:t.ram)+" GB"),t!=null&&t.disks&&c.push(t==null?void 0:t.disks),t!=null&&t.CostMonth&&c.push("<b>"+(t==null?void 0:t.CostMonth)+"/ месяц</b>"),c}function B(o){var t;return(t=C.value)==null?void 0:t[o]}function x(o){p.emit("open-modal",{component:"DeleteItem",data:{id:o,message:"Вы действительно хотите удалить этот сервер?",tableID:"DSOrders",successEmit:"updateDSOrdersList"}})}function U(o){p.emit("open-modal",{component:"OrdersTransfer",data:o})}return await e.fetchDSOrders(),await e.fetchDSSchemes(),await e.fetchDSOrderIPMI(),await S.fetchContracts(),{getDSList:u,filterProducts:s,select:_,search:n,getUsers:v,getDSSchemes:C,getDSItemParam:L,getDSOrderIPMI:O,orderManage:r,deleteItem:x,transferItem:U,navigateToDSSchemes:m,reloadNow:i}}},ie=z(At,[["render",Tt],["__scopeId","data-v-2e56b719"]]);export{ie as default};
