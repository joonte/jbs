import{_ as D}from"./ButtonDefault-eJbeaBtE.js";import{_ as w}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as B}from"./BlockBalanceAgreement-DjWMZ940.js";import{c as h,b as p,a as t,i as V,t as u,F as b,u as x,r as C,f as l,g as N,h as O,ak as E,W as L,d as R,o as k}from"./index-XtiBO-PZ.js";import{u as q}from"./postings-D5DA40Zz.js";import{u as M}from"./services-izfy4zss.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconClose-s_NQ_Q4c.js";import"./contracts-BdlSA9YT.js";const T={async setup(){const f=N(),o=R(),_=q(),r=x(),m=M(),d=C(!1),a=l(()=>Object.keys(r?.userOrders).map(e=>r?.userOrders[e]).find(e=>e.ID===f.params.id));l(()=>v.value?.find(e=>e.value===a.value?.OrdersFields?.[0]?.Value)?.price),l(()=>g.value?.find(e=>e.value===a.value?.OrdersFields?.[1]?.Value)?.price);const i=C(0),v=l(()=>c.value?.ServicesFields?.[0]?.Options?.split(`
`)?.map(e=>{let s=e.split("=");return{value:s[0],name:s[1],price:s[2]}})),g=l(()=>c.value?.ServicesFields?.[1]?.Options?.split(`
`)?.map(e=>{let s=e.split("=");return{value:s[0],name:s[1],price:s[2]}}));async function S(e){try{const n=(await E.get(`${L}/ServiceOrderPay?OrderID=${e}&JSON=1`)).data,I=y(n);let A=1;return n.AmountPay&&(A=parseInt(n.AmountPay)||1),I}catch(s){return console.error("Ошибка при получении данных о стоимости заказа",s),null}}function y(e){let s=0;for(const n in e)e.hasOwnProperty(n)&&(typeof e[n]=="object"?s+=y(e[n]):n==="Cost"&&!isNaN(e[n])&&(s+=parseFloat(e[n])));return s}function P(){return((parseFloat(c.value?.Cost)||parseFloat(i.value)||0)*1).toFixed(2)}function F(){d.value=!0,m.ServiceOrderPay(a.value?.Code,{AmountPay:"1",ServiceOrderID:a.value?.ID,IsChange:!0},{XMLHttpRequest:"yes"}).then(e=>{let{result:s,error:n}=e;s==="SUCCESS"?o.push(`/AdditionalServices/${a.value?.ID}`):s==="BASKET"&&o.push("/Basket"),d.value=!1})}O(async()=>{if(a.value){const e=a.value.ID,s=await S(e);s!==null&&(i.value=s)}}),O(()=>{console.log(c,"service get")});const c=l(()=>_?.servicesList[a.value?.ServiceID]);return await r.fetchUserOrders(),await _.fetchServices(),{getOrder:a,getService:c,getServicePrice:P,isLoading:d,orderPay:F,fetchOrderCost:S,orderCost:i}}},W={class:"additional-service-prolong"},H={class:"container"},J={class:"section-header"},K={class:"section-label"},X={class:"container"},$={class:"service-prolong__data"},z={class:"form-field"},G=["value"],Q={class:"form-field"},Y={class:"form-field__label"},Z={class:"form-field"},j=["value"],ee={class:"container"},te={class:"service-prolong__data"},se={class:"total-block"},oe={class:"total-block__row total-block__row--big"},re={class:"total-block__col"};function ae(f,o,_,r,m,d){const a=B,i=w,v=D;return k(),h(b,null,[p(a),t("div",W,[t("section",null,[t("div",H,[t("div",J,[o[1]||(o[1]=t("h1",{class:"section-title"},"Оплата заказа дополнительной услуги",-1)),t("div",K,u(r.getService?.Name)+" # "+u(r.getOrder?.ID),1)]),p(i)])]),r.getOrder?(k(),h(b,{key:0},[t("section",null,[t("div",X,[t("div",$,[t("label",z,[o[2]||(o[2]=t("span",{class:"form-field__label"},"Стоимость заказа",-1)),t("input",{type:"text",placeholder:"0 руб",value:r.getService?.Cost+" руб",disabled:""},null,8,G)]),t("label",Q,[t("span",Y,"Количество ("+u(r.getService?.Measure)+")",1),o[3]||(o[3]=t("input",{type:"text",placeholder:"0 руб",value:"1",disabled:""},null,-1))]),t("label",Z,[o[4]||(o[4]=t("span",{class:"form-field__label"},"Всего к оплате",-1)),t("input",{type:"text",placeholder:"0 руб",value:r.getServicePrice()+" руб",disabled:""},null,8,j)])])])]),t("section",null,[t("div",ee,[t("div",te,[t("div",se,[t("div",oe,[o[5]||(o[5]=t("div",{class:"total-block__col"},"Итого",-1)),t("div",re,u(r.getServicePrice()||"0")+" ₽",1)])]),p(v,{class:"btn--wide",label:"Оплатить",onClick:o[0]||(o[0]=g=>r.orderPay()),"is-loading":r.isLoading},null,8,["is-loading"])])])])],64)):V("",!0)])],64)}const me=U(T,[["render",ae],["__scopeId","data-v-4af29bf7"]]);export{me as default};
