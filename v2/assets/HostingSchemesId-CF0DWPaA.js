import{_ as te}from"./EmptyStateBlock-D6U_EDq6.js";import{_ as oe}from"./ButtonDefault-CghIUDY0.js";import{_ as ne}from"./TotalAmount.vue_vue_type_script_setup_true_lang-GfTe3s0M.js";import{_ as le}from"./BlockOrderServiceWrapper-PUSiskkx.js";import{_ as se}from"./BlockAdditionalServices-CY_Vrm6d.js";import{_ as re}from"./BasicInput-BYe5b9L8.js";import{m as ie}from"./bootstrap-vue-next-3DpAa4tb.js";import{_ as ue}from"./DomainCheckBlock-eqjY_ebZ.js";import{_ as ce}from"./BlockOrderPayBalance-C1k6h3Ad.js";import{_ as me}from"./BlockSelectContract-3ekz5W0S.js";import{_ as de}from"./ParamsAccordionBlock-CgeOPqzt.js";import{_ as ve}from"./BlockBalanceAgreement-2iQbaweR.js";import{Q as pe,r as u,f as S,g as _e,H as fe,s as Se,D as E,c as L,b as c,a as h,C as P,F as K,t as De,w as $,h as G,d as ge,o as B,e as Ie}from"./index-CipWZKo_.js";import{u as ye}from"./hosting-Fz3P7c2t.js";import{u as he}from"./contracts-CILh9uSu.js";import{u as Ce}from"./services-Dmz4Qt8q.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ClausesKeeper-DVJgfLR3.js";import"./IconClose-ChC2G6HM.js";import"./ServiceListOrderSelection-CxiE4waM.js";import"./multiselect-DWCHRlfT.js";import"./component-DWBAga-C.js";import"./global-Fil99La8.js";import"./IconCross-C6IvNpdZ.js";const Be={class:"tw-px-4 md:tw-px-8 tw-mb-6"},Oe={class:"section-header"},be={class:"section-title"},we={class:"tw-mt-6 tw-w-full"},Ve={class:"tw-my-6"},Ee={__name:"HostingSchemesId",async setup(He){let m,d;const D=ye(),U=he(),O=pe(),b=Ce(),j=_e(),g=ge(),p=u(!1),H=u(""),C=u([]),n=u(null),k=u([]),I=u(!1),v=u(null),w=u(null),x=u(""),A=a=>{a.key==="Enter"&&a.ctrlKey&&!M.value&&F()},M=S(()=>n.value===null||v.value===null),_=S(()=>D?.hostingSchemes?.[j.params.id]),N=S(()=>U.contractsList[v.value]),Q=S(()=>b?.ServicesList),W=S(()=>Object.keys(O?.domainSchemes)?.map(a=>({...O?.domainSchemes[a],value:O?.domainSchemes[a]?.ID}))),q=S(()=>{let a=0;return k.value.forEach(e=>{a+=Number(e.Price)}),a}),z=S(()=>{if(n.value?.daysFromBalance)return"Оплатить c баланса договора";const a=n.value?.CostPay+q.value;return(N.value?.Balance||0)>=a?"Оплатить c баланса договора":"Добавить в корзину"});fe(()=>{document.addEventListener("keyup",A)}),Se(()=>{document.removeEventListener("keyup",A)});function J(a){C.value=a}function X(){p.value=!1}function Y(){p.value=!0}async function T(a){for(const e of k.value){let f="SUCCESS",s=Q.value[e.ServiceID]?.Code;if(await b.ServiceOrder({Code:s,DependOrderID:a,...e,ContractID:v.value}).then(({result:t,info:l,error:V})=>{if(t==="SUCCESS"){let r={};s==="Default"?r.ServiceOrderID=l?.ServiceOrderID:r[`${s}OrderID`]=l?.ServiceOrderID,b.ServiceOrderPay(s,r).then(i=>{let{result:y,error:R}=i;y==="SUCCESS"?g.push("/AdditionalServices}"):y==="BASKET"&&g.push("/Basket")})}else f="ERROR"}),f==="ERROR")break}}function F(){I.value=!0;let a=0,e,f,s;C.value.length>0&&(e=C.value[a],f=C.value.map(t=>`${t.line}${t.line&&t.Name?"."+t.Name:""}`),s=C.value.map(t=>`${t.ID}`)),p.value===!1?D.HostingOrder({ContractID:v.value,Domain:f||null,DomainName:e?.line||null,HostingSchemeID:_.value?.ID,DomainSchemeID:s||null,DomainTypeID:e?.line?e?.Name?"Order":"Nothing":"None"}).then(({result:t,info:l,error:V})=>{t==="SUCCESS"?(a++,T(l?.OrderID),D.HostingOrderPay({HostingOrderID:l?.HostingOrderID,DaysPayFromBallance:n.value?.daysFromBalance||0,DaysPay:n.value?.actualDays}).then(r=>{let{result:i,error:y}=r;i==="SUCCESS"?g.push("/HostingOrders"):i==="BASKET"&&g.push("/Basket"),I.value=!1})):I.value=!1}):D.HostingOrder({ContractID:v.value,Domain:H.value,DomainName:w.value?.line,HostingSchemeID:_.value?.ID,DomainSchemeID:w.value?.line&&w.value?.ID?w.value?.ID:null,DomainTypeID:"Nothing"}).then(({result:t,info:l,error:V})=>{t==="SUCCESS"?(T(l?.OrderID),D.HostingOrderPay({HostingOrderID:l?.HostingOrderID,DaysPayFromBallance:n.value?.daysFromBalance||0,DaysPay:n.value?.actualDays}).then(r=>{let{result:i,error:y}=r;i==="SUCCESS"?g.push("/HostingOrders"):i==="BASKET"&&g.push("/Basket"),I.value=!1})):I.value=!1})}return[m,d]=E(()=>O.fetchDomainSchemes()),await m,d(),[m,d]=E(()=>D.fetchHostingSchemes()),await m,d(),[m,d]=E(()=>U.fetchContracts()),await m,d(),[m,d]=E(()=>b.fetchServices()),await m,d(),(a,e)=>{const f=ve,s=de,t=me,l=ce,V=ue,r=ie,i=re,y=se,R=le,Z=ne,ee=oe,ae=te;return B(),L(K,null,[c(f),h("div",Be,[_.value?.ID?(B(),L(K,{key:0},[h("div",Oe,[h("h1",be,De(_.value?.Name),1),e[9]||(e[9]=h("div",{class:"section-label"},"Хостинг",-1))]),c(R,{basic_title:"Хостинг",modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=o=>x.value=o)},{page:$(()=>[c(s,{"params-list":_.value?.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),c(t,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=o=>v.value=o),title:"Договор",class:"tw-mt-6"},null,8,["modelValue"]),N.value?(B(),P(l,{key:0,modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value=o),contract:N.value,scheme:_.value,serviceID:1e4},null,8,["modelValue","contract","scheme"])):G("",!0),c(V,{disabled:p.value,"domain-list":W.value,onClick:e[2]||(e[2]=o=>X()),onSelect:J},null,8,["disabled","domain-list"]),h("div",we,[c(r,{id:"check-1",modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o),name:"checkbox-1"},{default:$(()=>e[10]||(e[10]=[Ie(" Использовать свой домен ",-1)])),_:1,__:[10]},8,["modelValue"]),c(i,{label:"Домен",name:"own-domain",onClick:e[4]||(e[4]=o=>Y()),disabled:!p.value,modelValue:H.value,"onUpdate:modelValue":e[5]||(e[5]=o=>H.value=o)},null,8,["disabled","modelValue"])])]),services:$(()=>[c(y,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=o=>k.value=o),serviceSearchParams:{ServiceID:1e4,ServersGroupID:_.value?.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]),_:1},8,["modelValue"]),h("div",Ve,[n.value?(B(),P(Z,{key:0,tariff:n.value,"additional-services":k.value},null,8,["tariff","additional-services"])):G("",!0),c(ee,{class:"btn--wide",label:z.value,disabled:n.value===null||v.value===null,"is-loading":I.value,onClick:e[8]||(e[8]=o=>F())},null,8,["label","disabled","is-loading"])])],64)):(B(),P(ae,{key:1,label:"Тариф не найден"}))])],64)}}},ta=ke(Ee,[["__scopeId","data-v-6321fa71"]]);export{ta as default};
