import{a1 as q,r as i,a2 as h,a3 as B,j as w,o as g,c as f,b,w as _,a as l,t as v,k as S,F as x,x as y,_ as k,g as P,Y as Z,ae as z,p as C,l as L,n as U,e as Y,a6 as G,i as H}from"./index-ed1f28f8.js";import{s as O}from"./multiselect-198a8c51.js";import{a as E,f as M}from"./useTimeFunction-8602dd60.js";import{E as V}from"./EmptyStateBlock-dbc11827.js";import{C as N,F as A}from"./bootstrap-vue-next.es-79226723.js";import{_ as J}from"./ButtonDefault-a8aacc82.js";import{_ as K}from"./ClausesKeeper-9aa8ead7.js";import"./IconClose-a1e58263.js";const D=q("bonuses",()=>{const o=i(null),e=i(null);async function m(c){await h.post(""+B.fetchBonuses,c).then(n=>{n!=null&&n.data&&(o.value=n.data)})}async function t(c){await h.post(""+B.fetchPromos,c).then(n=>{n!=null&&n.data&&(e.value=n.data)})}async function r(c){let n="ERROR",d=null;return await h.post(""+B.PromoCodesActivate,c).then(p=>{var u;((u=p==null?void 0:p.data)==null?void 0:u.Status)==="Ok"&&(n="SUCCESS")}),{result:n,error:d}}return{bonusesList:o,promosList:e,fetchBonuses:m,fetchPromos:t,PromoCodesActivate:r}}),Q=[{key:"CreateDate",label:"Дата создания",variant:"td-gray",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray",sortable:!0},{key:"Display",label:"Тариф/Группа",variant:"td-blue"},{key:"DaysRemainded",label:"Дней осталось",sortable:!0},{key:"Discont",variant:"td-controls",label:"Скидка"},{key:"Comment",label:"Комментарий",variant:"td-gray"}],W=l("span",null,null,-1),X=l("span",null,null,-1),$={key:0,class:"table-controls"},tt=l("span",{class:"text-success"},"First",-1),et=l("span",{class:"text-info"},"Last",-1),ot={class:"multiselect-multiple-label"},st={class:"multiselect-option"};function nt(o,e,m,t,r,c){const n=N,d=A,p=w("Multiselect"),u=V;return t.getBonuses?(g(),f(x,{key:0},[W,X,b(n,{class:"basic-table",items:t.getBonuses,fields:t.bonusesTable,"show-empty":!0,"per-page":t.perPage,"current-page":t.currentPage,"empty-text":"Бонусов пока нет.","empty-filtered-text":"Бонусов не найдены.","sort-desc":t.sortDesc,"onUpdate:sortDesc":e[0]||(e[0]=s=>t.sortDesc=s),"sort-by":t.sortBy,"onUpdate:sortBy":e[1]||(e[1]=s=>t.sortBy=s),"sort-direction":t.sortDirection},{"cell(CreateDate)":_(s=>[l("span",null,v(t.formNormalDate(t.secondToDate(s==null?void 0:s.value))),1)]),"cell(ExpirationDate)":_(s=>[l("span",null,v(t.formNormalDate(t.secondToDate(s==null?void 0:s.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),t.getBonusesLength>0?(g(),f("div",$,[b(d,{modelValue:t.currentPage,"onUpdate:modelValue":e[2]||(e[2]=s=>t.currentPage=s),"total-rows":t.getBonusesLength,"per-page":t.perPage,"first-number":"","last-number":""},{"first-text":_(()=>[tt]),"last-text":_(()=>[et]),page:_(({page:s,active:a})=>[l("span",null,v((s-1)*t.perPage+1)+"-"+v(s*t.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),b(p,{class:"multiselect--white",modelValue:t.perPage,"onUpdate:modelValue":e[3]||(e[3]=s=>t.perPage=s),options:t.pageOptions,label:"name",openDirection:"top",onInput:e[4]||(e[4]=s=>t.currentPage=1)},{singlelabel:_(({value:s})=>[l("div",ot,[l("span",null,"Отображать "+v(s.value)+" строк",1)])]),option:_(({option:s})=>[l("div",st,"Отображать "+v(s.name)+" строк",1)]),_:1},8,["modelValue","options"])])):S("",!0)],64)):(g(),y(u,{key:1,label:"Бонусов не найдено"}))}const at={components:{Multiselect:O},setup(){const o=D(),e=i("CreateDate"),m=i(!0),t=i("desc"),r=i(1),c=i(10),n=i([10,25,50,100]),d=P(()=>{var s;return(s=Object.keys(o==null?void 0:o.bonusesList))==null?void 0:s.map(a=>o==null?void 0:o.bonusesList[a])}),p=P(()=>{var s;return(s=Object.keys(o==null?void 0:o.bonusesList))==null?void 0:s.length});function u(){r.value=1}return{bonusesTable:Q,sortBy:e,sortDesc:m,sortDirection:t,currentPage:r,perPage:c,pageOptions:n,setPageToZero:u,getBonuses:d,getBonusesLength:p,secondToDate:E,formNormalDate:M}}},F=k(at,[["render",nt]]),lt=[{key:"CreateDate",label:"Дата активации",variant:"td-gray",sortable:!0},{key:"ApplyTo",label:"Тариф/Группа",variant:"td-blue"},{key:"PromoCode",label:"Промокод"}],ct=o=>(C("data-v-b9a5421c"),o=o(),L(),o),rt={class:"promo-field"},it=ct(()=>l("div",{class:"promo-field-text"},"Промокод",-1)),dt={class:"promo-field-input form-field"};function mt(o,e,m,t,r,c){const n=J;return g(),f("div",rt,[it,l("div",dt,[Z(l("input",{type:"text",name:"promo-code","onUpdate:modelValue":e[0]||(e[0]=d=>t.promoInput=d)},null,512),[[z,t.promoInput]])]),b(n,{"is-loading":t.isLoading,label:"Применить",onClick:e[1]||(e[1]=d=>t.activatePromo())},null,8,["is-loading"])])}const pt={emits:["update"],setup(o,{emit:e}){const m=D(),t=i(!1),r=i("");function c(){r.value.length>0&&(t.value=!0,m.PromoCodesActivate({Code:r.value}).then(n=>{const{result:d}=n;d==="SUCCESS"&&e("update"),t.value=!1}))}return{isLoading:t,promoInput:r,activatePromo:c}}},R=k(pt,[["render",mt],["__scopeId","data-v-b9a5421c"]]),T=o=>(C("data-v-ed0ee183"),o=o(),L(),o),_t={class:"promo-block block--wrapper"},ut=T(()=>l("div",{class:"promo-text"},"Активировать промокод",-1)),gt={key:0,class:"table-controls"},vt=T(()=>l("span",{class:"text-success"},"First",-1)),bt=T(()=>l("span",{class:"text-info"},"Last",-1)),ft={class:"multiselect-multiple-label"},yt={class:"multiselect-option"};function Pt(o,e,m,t,r,c){const n=R,d=N,p=A,u=w("Multiselect"),s=V;return g(),f(x,null,[l("div",_t,[ut,b(n,{onUpdate:e[0]||(e[0]=a=>t.updatePromos())})]),t.getPromos?(g(),f(x,{key:0},[b(d,{class:"basic-table",items:t.getPromos,fields:t.promosTable,"show-empty":!0,"per-page":t.perPage,"current-page":t.currentPage,"empty-text":"Промокодов пока нет.","empty-filtered-text":"Промокоды не найдены.","sort-desc":t.sortDesc,"onUpdate:sortDesc":e[1]||(e[1]=a=>t.sortDesc=a),"sort-by":t.sortBy,"onUpdate:sortBy":e[2]||(e[2]=a=>t.sortBy=a),"sort-direction":t.sortDirection},{"cell(CreateDate)":_(a=>[l("span",null,v(t.formNormalDate(t.secondToDate(a==null?void 0:a.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),t.getPromosLength>0?(g(),f("div",gt,[b(p,{modelValue:t.currentPage,"onUpdate:modelValue":e[3]||(e[3]=a=>t.currentPage=a),"total-rows":t.getPromosLength,"per-page":t.perPage,"first-number":"","last-number":""},{"first-text":_(()=>[vt]),"last-text":_(()=>[bt]),page:_(({page:a,active:I})=>[l("span",null,v((a-1)*t.perPage+1)+"-"+v(a*t.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),b(u,{class:"multiselect--white",modelValue:t.perPage,"onUpdate:modelValue":e[4]||(e[4]=a=>t.perPage=a),options:t.pageOptions,label:"name",openDirection:"top",onInput:e[5]||(e[5]=a=>t.currentPage=1)},{singlelabel:_(({value:a})=>[l("div",ft,[l("span",null,"Отображать "+v(a.value)+" строк",1)])]),option:_(({option:a})=>[l("div",yt,"Отображать "+v(a.name)+" строк",1)]),_:1},8,["modelValue","options"])])):S("",!0)],64)):(g(),y(s,{key:1,label:"Промокоды не найдены"}))],64)}const kt={components:{ActivatePromo:R,Multiselect:O},setup(){const o=D(),e=i("CreateDate"),m=i(!0),t=i("desc"),r=i(1),c=i(10),n=i([10,25,50,100]),d=P(()=>{var a;return(a=Object.keys(o==null?void 0:o.promosList))==null?void 0:a.map(I=>o==null?void 0:o.promosList[I])}),p=P(()=>{var a;return(a=Object.keys(o==null?void 0:o.promosList))==null?void 0:a.length});function u(){r.value=1}function s(){o.fetchBonuses(),o.fetchPromos()}return{promosTable:lt,sortBy:e,sortDesc:m,sortDirection:t,currentPage:r,perPage:c,pageOptions:n,setPageToZero:u,getPromos:d,getPromosLength:p,secondToDate:E,formNormalDate:M,updatePromos:s}}},j=k(kt,[["render",Pt],["__scopeId","data-v-ed0ee183"]]),Dt=o=>(C("data-v-36963d5b"),o=o(),L(),o),ht={class:"section"},Bt={class:"container"},xt=Dt(()=>l("div",{class:"section-header"},[l("h1",{class:"section-title"},"Бонусы и промокоды")],-1)),Ct={class:"section-header"},Lt={class:"section-nav"};function Vt(o,e,m,t,r,c){const n=K,d=F,p=j,u=V;return g(),f("div",ht,[l("div",Bt,[xt,b(n),l("div",Ct,[l("div",Lt,[l("div",{class:U(["section-nav__item",{"section-link":!0,"section-link-active":t.section==="bonuses"}]),onClick:e[0]||(e[0]=s=>t.switchToSection("bonuses"))},"Бонусы",2),l("div",{class:U(["section-nav__item",{"section-link":!0,"section-link-active":t.section==="promos"}]),onClick:e[1]||(e[1]=s=>t.switchToSection("promos"))},"Промокоды",2)])]),t.section==="bonuses"?(g(),y(d,{key:0})):t.section==="promos"?(g(),y(p,{key:1})):(g(),y(u,{key:2,label:"Секция не найдена"}))])])}const Tt={components:{BonusesBlock:F,PromosBlock:j},async setup(){const o=D(),e=i("bonuses"),m=Y(),t=G();function r(c){m.replace(`/Bonuses?section=${c}`),e.value=c}return H(()=>{var c,n;(c=t==null?void 0:t.query)!=null&&c.section?e.value=(n=t==null?void 0:t.query)==null?void 0:n.section:m.replace("/Bonuses?section=bonuses")}),await o.fetchBonuses(),await o.fetchPromos(),{section:e,switchToSection:r}}},At=k(Tt,[["render",Vt],["__scopeId","data-v-36963d5b"]]);export{At as default};
