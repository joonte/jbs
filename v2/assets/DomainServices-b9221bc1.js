import{k as Y,o as l,c,b as f,a as s,t as m,l as w,w as M,d as j,F as T,y as H,z as q,p as Z,m as $,_ as ee,f as te,e as oe,g as se,U as ae,r as U,h as E,i as re}from"./index-aeb1df1e.js";import{u as ne}from"./domain-0f1019af.js";import{u as de}from"./services-bb78f548.js";import{B as z}from"./BlockBalanceAgreement-906c1168.js";import{B as K}from"./BlockAdditionalServices-3f8c8032.js";import{E as X}from"./EmptyStateBlock-b0a120e4.js";import{_ as G}from"./ButtonDefault-11c4541b.js";import{S as J}from"./StatusBadge-ca078fa4.js";import{_ as le}from"./ClausesKeeper-90c650cc.js";import"./IconArrow-a6c91ada.js";import"./bootstrap-vue-next.es-c6bcf011.js";import"./ServiceListOrderSelection-8635e3a9.js";import"./multiselect-3fbc9d28.js";import"./BasicInput-67b26a5e.js";import"./component-60ac2998.js";import"./BlockSelectContract-9de95b8e.js";import"./IconClose-c7c36336.js";const N=p=>(Z("data-v-88eda630"),p=p(),$(),p),ie={class:"section"},ce={class:"container"},_e={class:"section-header"},me=N(()=>s("h1",{class:"section-title"},"Дополнительные услуги",-1)),ue={key:0,class:"section-label"},Se={class:"section-nav"},De={key:0,class:"section-body"},fe=N(()=>s("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),pe={class:"ordered-services-list"},ve={class:"ordered-service-header"},he={class:"ordered-service-name"},Ie={class:"ordered-service-status"},ge={class:"ordered-service-details"},ke={class:"ordered-service-info"},ye={key:0},Oe={class:"ordered-service-actions"},be={class:"section-body"},Ce={key:2,class:"loading"},Ee={key:0,class:"section"},Re={class:"container"},Ae={class:"total-block"},Be={class:"total-block__row"},we=N(()=>s("div",{class:"total-block__col"},"Дополнительные услуги",-1)),Ne={class:"total-block__col"},Pe={class:"total-block__row no-divider"},Le={class:"total-block__col"},xe={class:"total-block__col"},Ve={class:"total-block__row total-block__row--big"},Te=N(()=>s("div",{class:"total-block__col"},"Итого к оплате",-1)),Ue={class:"total-block__col"};function Fe(p,i,u,t,S,v){var A,B,b;const d=z,y=Y("router-link"),O=le,_=J,R=G,h=K,P=X;return l(),c(T,null,[f(d),s("div",ie,[s("div",ce,[s("div",_e,[me,t.getDomainData?(l(),c("div",ue,"Домен # "+m((A=t.getDomainData)==null?void 0:A.OrderID),1)):w("",!0),s("div",Se,[f(y,{class:"section-nav__item",to:`/DomainOrders/${(B=t.getDomainData)==null?void 0:B.OrderID}`},{default:M(()=>[j("Домен")]),_:1},8,["to"]),f(y,{class:"section-nav__item active",to:`/DomainServices/${(b=t.getDomainData)==null?void 0:b.OrderID}`},{default:M(()=>[j("Услуги")]),_:1},8,["to"])])]),f(O),t.orderedServices&&t.orderedServices.length>0?(l(),c("div",De,[fe,s("div",pe,[(l(!0),c(T,null,H(t.orderedServices,e=>{var D;return l(),c("div",{class:"ordered-service-item",key:e.ID},[s("div",ve,[s("div",he,m(((D=t.getServices[e==null?void 0:e.ServiceID])==null?void 0:D.Name)||(e==null?void 0:e.ServiceName)||`Услуга #${e==null?void 0:e.ServiceID}`),1),s("div",Ie,[f(_,{status:e==null?void 0:e.StatusID,"status-table":"Orders",onClick:L=>t.openHistoryStatuses(e==null?void 0:e.ID,e==null?void 0:e.ServiceID)},null,8,["status","onClick"])])]),s("div",ge,[s("div",ke,[s("span",null,"Заказ # "+m(e==null?void 0:e.ID),1),e!=null&&e.DaysRemainded?(l(),c("span",ye,"| Осталось дней: "+m(e==null?void 0:e.DaysRemainded),1)):w("",!0)])]),s("div",Oe,[f(R,{class:"btn--sm",label:"Перейти к заказу",onClick:L=>t.navigateToService(e==null?void 0:e.ID)},null,8,["onClick"])])])}),128))])])):w("",!0),s("div",be,[t.getDomainData&&t.serviceSearchParams?(l(),q(h,{key:0,modelValue:t.selectedServices,"onUpdate:modelValue":[i[0]||(i[0]=e=>t.selectedServices=e),t.handleServicesUpdate],"service-search-params":t.serviceSearchParams},null,8,["modelValue","service-search-params","onUpdate:modelValue"])):t.isLoading?(l(),c("div",Ce,"Загрузка...")):(l(),q(P,{key:1,label:"Заказ не найден"}))])])]),t.selectedServices&&t.selectedServices.length>0?(l(),c("div",Ee,[s("div",Re,[s("div",Ae,[s("div",Be,[we,s("div",Ne,m(t.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(l(!0),c(T,null,H(t.selectedServices,e=>{var D;return l(),c("div",Pe,[s("div",Le,m((D=t.getServices[e==null?void 0:e.ServiceID])==null?void 0:D.Name),1),s("div",xe,m(t.setToFixedService(e==null?void 0:e.Price))+" ₽",1)])}),256)),s("div",Ve,[Te,s("div",Ue,m(t.ADDITIONAL_SERVICES_PRICE)+" ₽",1)])]),f(R,{class:"btn--wide",disabled:!t.selectedServices||t.selectedServices.length===0||t.isOrderLoading,"is-loading":t.isOrderLoading,label:"Заказать дополнительные услуги",onClick:i[1]||(i[1]=e=>t.orderServices())},null,8,["disabled","is-loading"])])])):w("",!0)],64)}const Me={components:{BlockBalanceAgreement:z,BlockAdditionalServices:K,emptyStateBlock:X,ButtonDefault:G,StatusBadge:J},async setup(){const p=te(),i=oe(),u=ne(),t=de(),S=se(),v=ae("emitter"),d=U([]),y=U(!0),O=U(!1),_=E(()=>u!=null&&u.domainsList?Object.keys(u.domainsList).map(o=>u.domainsList[o]).find(o=>o&&String(o.OrderID)===String(p.params.id)):null),R=E(()=>_.value?{ServiceID:_.value.ServiceID}:null),h=E(()=>(t==null?void 0:t.ServicesList)||{}),P=E(()=>{var g;if(!((g=_.value)!=null&&g.OrderID)||!(S!=null&&S.userOrders))return[];const o=_.value.OrderID;return Object.keys(S.userOrders).map(a=>S.userOrders[a]).filter(a=>String(a==null?void 0:a.DependOrderID)===String(o)&&(a==null?void 0:a.ServiceID)&&h.value[a.ServiceID]).sort((a,C)=>Number(a==null?void 0:a.ID)-Number(C==null?void 0:C.ID))}),A=E(()=>{if(!d.value||!Array.isArray(d.value))return 0;let o=0;return d.value.forEach(r=>{r&&typeof r.Price=="number"&&(o+=r.Price)}),b(o)});function B(o){d.value=o||[]}function b(o){return o==null?"0.00":Number(o).toFixed(2)||"0.00"}async function e(){var o,r,n;if(!(!d.value||!Array.isArray(d.value)||d.value.length===0))for(const I of d.value){if(!I)continue;let g="SUCCESS",a=(o=h.value[I.ServiceID])==null?void 0:o.Code;const C={Code:a,DependOrderID:(r=_.value)==null?void 0:r.OrderID,...I,ContractID:(n=_.value)==null?void 0:n.ContractID};try{const{result:x,info:k,error:je}=await t.ServiceOrder(C);if(x==="SUCCESS"){let V={};a==="Default"?V.ServiceOrderID=k==null?void 0:k.ServiceOrderID:V[`${a}OrderID`]=k==null?void 0:k.ServiceOrderID;const W=await t.ServiceOrderPay(a,V,{XMLHttpRequest:"yes"});let{result:F,error:He}=W;F==="SUCCESS"?(v.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),d.value=[],i.push("/AdditionalServices")):F==="BASKET"&&i.push("/Basket")}else g="ERROR",v.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(x){console.error("Ошибка при заказе услуги:",x),g="ERROR",v.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(g==="ERROR")break}}async function D(){O.value=!0;try{await e()}catch(o){console.error("Ошибка при заказе услуг:",o),v.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{O.value=!1}}function L(o){const r=Object.values(h.value).find(I=>I.ID===o);if(!r){i.push(`/AdditionalServices/${o}`);return}const n=r.Code;n==="Default"||n==="DNSmanager"||n==="ISPsw"||n==="ExtraIP"?i.push(`/AdditionalServices/${o}`):i.push(`/${n}Orders/${o}`)}function Q(o,r){let n="Orders";r==="50000"?n="ExtraIPOrders":r==="51000"?n="ISPswOrders":r==="52000"&&(n="DNSmanagerOrders"),v.emit("open-modal",{component:"StatusHistory",data:{modeID:n,rowID:o}})}return re(async()=>{try{await u.fetchDomains(),await t.fetchServices(),await S.fetchUserOrders()}catch(o){console.error("Ошибка загрузки данных:",o)}finally{y.value=!1}}),{getDomainData:_,serviceSearchParams:R,selectedServices:d,getServices:h,orderedServices:P,ADDITIONAL_SERVICES_PRICE:A,handleServicesUpdate:B,setToFixedService:b,orderServices:D,isLoading:y,isOrderLoading:O,navigateToService:L,openHistoryStatuses:Q}}},nt=ee(Me,[["render",Fe],["__scopeId","data-v-88eda630"]]);export{nt as default};
