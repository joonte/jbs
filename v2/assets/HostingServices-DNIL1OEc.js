import{_ as q}from"./EmptyStateBlock-CV1Zaaf7.js";import{_ as K}from"./BlockAdditionalServices-DPr--p0K.js";import{_ as X}from"./ButtonDefault-eJbeaBtE.js";import{_ as z}from"./StatusBadge-DoJSzeeo.js";import{_ as J}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as Q}from"./BlockBalanceAgreement-DjWMZ940.js";import{c as u,b as m,a as s,i as b,t as v,w as L,G as W,F as R,j as x,D as B,u as Y,r as A,f as D,g as Z,h as $,x as ee,d as te,o as c,e as V}from"./index-XtiBO-PZ.js";import{u as se}from"./hosting-B5Wk2kbD.js";import{u as re}from"./services-izfy4zss.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-CxxkTytZ.js";import"./ServiceListOrderSelection-D6_D29T7.js";import"./BasicInput-TTn3Hxre.js";import"./component-YfTGPdLe.js";import"./BlockSelectContract-BJLjloC1.js";import"./contracts-BdlSA9YT.js";import"./multiselect-eqvbz1NV.js";import"./IconClose-s_NQ_Q4c.js";const ne={async setup(){const w=Z(),r=te(),_=se(),e=re(),p=Y(),S=ee("emitter"),i=A([]),I=A(!0),h=A(!1),l=D(()=>_?.hostingList?Object.keys(_.hostingList).map(o=>_.hostingList[o]).find(o=>o&&String(o.OrderID)===String(w.params.id)):null),O=D(()=>!l.value?.SchemeID||!_?.hostingSchemes?null:_.hostingSchemes[l.value.SchemeID]),C=D(()=>!l.value||!O.value?null:{ServiceID:l.value.ServiceID,ServersGroupID:O.value.ServersGroupID}),f=D(()=>e?.ServicesList||{}),n=D(()=>{if(!l.value?.OrderID||!p?.userOrders)return[];const t=l.value.OrderID;return Object.keys(p.userOrders).map(d=>p.userOrders[d]).filter(d=>{const g=String(d?.DependOrderID)===String(t),N=d?.ServiceID,k=f.value[d.ServiceID];return g&&N&&k}).sort((d,g)=>Number(d?.ID)-Number(g?.ID))}),E=D(()=>{if(!i.value||!Array.isArray(i.value))return 0;let t=0;return i.value.forEach(a=>{a&&typeof a.Price=="number"&&(t+=a.Price)}),H(t)});function T(t){i.value=t||[]}function H(t){return t==null?"0.00":Number(t).toFixed(2)||"0.00"}async function U(){if(!(!i.value||!Array.isArray(i.value)||i.value.length===0))for(const t of i.value){if(!t)continue;let a="SUCCESS",o=f.value[t.ServiceID]?.Code;const y={Code:o,DependOrderID:l.value?.OrderID,...t,ContractID:l.value?.ContractID};try{const{result:d,info:g,error:N}=await e.ServiceOrder(y);if(d==="SUCCESS"){let k={};o==="Default"?k.ServiceOrderID=g?.ServiceOrderID:k[`${o}OrderID`]=g?.ServiceOrderID;const G=await e.ServiceOrderPay(o,k,{XMLHttpRequest:"yes"});let{result:P,error:He}=G;P==="SUCCESS"?(S.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),i.value=[],r.push("/AdditionalServices")):P==="BASKET"&&r.push("/Basket")}else a="ERROR",S.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(d){console.error("Ошибка при заказе услуги:",d),a="ERROR",S.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(a==="ERROR")break}}async function F(){h.value=!0;try{await U()}catch(t){console.error("Ошибка при заказе услуг:",t),S.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{h.value=!1}}function M(t){const a=Object.values(f.value).find(y=>y.ID===t);if(!a){r.push(`/AdditionalServices/${t}`);return}const o=a.Code;o==="Default"||o==="DNSmanager"||o==="ISPsw"||o==="ExtraIP"?r.push(`/AdditionalServices/${t}`):r.push(`/${o}Orders/${t}`)}function j(t,a){let o="Orders";a==="50000"?o="ExtraIPOrders":a==="51000"?o="ISPswOrders":a==="52000"&&(o="DNSmanagerOrders"),S.emit("open-modal",{component:"StatusHistory",data:{modeID:o,rowID:t}})}return $(async()=>{try{await _.fetchHostingOrders(),await _.fetchHostingSchemes(),await e.fetchServices(),await p.fetchUserOrders()}catch(t){console.error("Ошибка загрузки данных:",t)}finally{I.value=!1}}),{getHostingData:l,serviceSearchParams:C,selectedServices:i,getServices:f,orderedServices:n,ADDITIONAL_SERVICES_PRICE:E,handleServicesUpdate:T,setToFixedService:H,orderServices:F,isLoading:I,isOrderLoading:h,navigateToService:M,openHistoryStatuses:j}}},ae={class:"container"},ie={class:"section-header"},ce={key:0,class:"section-label"},le={class:"section-nav"},de={key:0,class:"section-body"},ue={class:"ordered-services-list"},_e={class:"ordered-service-header"},ve={class:"ordered-service-name"},me={class:"ordered-service-status"},Se={class:"ordered-service-details"},fe={class:"ordered-service-info"},ge={key:0},De={class:"ordered-service-actions"},pe={class:"section-body"},Ie={key:2,class:"loading"},he={key:0},Oe={class:"container"},ke={class:"total-block"},ye={class:"total-block__row"},be={class:"total-block__col"},Ce={class:"total-block__col"},Ee={class:"total-block__col"},Re={class:"total-block__row total-block__row--big"},Ae={class:"total-block__col"};function we(w,r,_,e,p,S){const i=Q,I=W("router-link"),h=J,l=z,O=X,C=K,f=q;return c(),u(R,null,[m(i),s("section",null,[s("div",ae,[s("div",ie,[r[4]||(r[4]=s("h1",{class:"section-title"},"Дополнительные услуги",-1)),e.getHostingData?(c(),u("div",ce,"Хостинг # "+v(e.getHostingData?.OrderID),1)):b("",!0),s("div",le,[m(I,{class:"section-nav__item",to:`/HostingOrders/${e.getHostingData?.OrderID}`},{default:L(()=>r[2]||(r[2]=[V(" Хостинг ",-1)])),_:1,__:[2]},8,["to"]),m(I,{class:"section-nav__item active",to:`/HostingServices/${e.getHostingData?.OrderID}`},{default:L(()=>r[3]||(r[3]=[V(" Услуги ",-1)])),_:1,__:[3]},8,["to"])])]),m(h),e.orderedServices&&e.orderedServices.length>0?(c(),u("div",de,[r[5]||(r[5]=s("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),s("div",ue,[(c(!0),u(R,null,x(e.orderedServices,n=>(c(),u("div",{class:"ordered-service-item",key:n.ID},[s("div",_e,[s("div",ve,v(e.getServices[n?.ServiceID]?.Name||n?.ServiceName||`Услуга #${n?.ServiceID}`),1),s("div",me,[m(l,{status:n?.StatusID,"status-table":"Orders",onClick:E=>e.openHistoryStatuses(n?.ID,n?.ServiceID)},null,8,["status","onClick"])])]),s("div",Se,[s("div",fe,[s("span",null,"Заказ # "+v(n?.ID),1),n?.DaysRemainded?(c(),u("span",ge," Осталось дней: "+v(n?.DaysRemainded),1)):b("",!0)])]),s("div",De,[m(O,{class:"btn--sm",label:"Перейти к заказу",onClick:E=>e.navigateToService(n?.ID)},null,8,["onClick"])])]))),128))])])):b("",!0),s("div",pe,[e.getHostingData&&e.serviceSearchParams?(c(),B(C,{key:0,modelValue:e.selectedServices,"onUpdate:modelValue":[r[0]||(r[0]=n=>e.selectedServices=n),e.handleServicesUpdate],"service-search-params":e.serviceSearchParams},null,8,["modelValue","service-search-params","onUpdate:modelValue"])):e.isLoading?(c(),u("div",Ie,"Загрузка...")):(c(),B(f,{key:1,label:"Заказ не найден"}))])])]),e.selectedServices&&e.selectedServices.length>0?(c(),u("section",he,[s("div",Oe,[s("div",ke,[s("div",ye,[r[6]||(r[6]=s("div",{class:"total-block__col"},"Дополнительные услуги",-1)),s("div",be,v(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(c(!0),u(R,null,x(e.selectedServices,n=>(c(),u("div",{class:"total-block__row no-divider",key:n.ServiceID},[s("div",Ce,v(e.getServices[n?.ServiceID]?.Name),1),s("div",Ee,v(e.setToFixedService(n?.Price))+" ₽",1)]))),128)),s("div",Re,[r[7]||(r[7]=s("div",{class:"total-block__col"},"Итого к оплате",-1)),s("div",Ae,v(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)])]),m(O,{class:"btn--wide",disabled:!e.selectedServices||e.selectedServices.length===0||e.isOrderLoading,"is-loading":e.isOrderLoading,label:"Заказать дополнительные услуги",onClick:r[1]||(r[1]=n=>e.orderServices())},null,8,["disabled","is-loading"])])])):b("",!0)],64)}const We=oe(ne,[["render",we],["__scopeId","data-v-fdd80b31"]]);export{We as default};
