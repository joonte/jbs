import{_ as re}from"./EmptyStateBlock-Dks67PsT.js";import{_ as ie}from"./ButtonDefault-tVMF5ozh.js";import{_ as ce}from"./BlockOrderServiceWrapper-Ccoi2Fl1.js";import{_ as ue}from"./BlockAdditionalServices-BLZFm89Z.js";import{_ as me}from"./BasicInput-DI25CRuk.js";import{m as de}from"./bootstrap-vue-next-9iQSFcL_.js";import{_ as _e}from"./DomainCheckBlock-B4KM3Ctv.js";import{_ as ve}from"./BlockOrderPayBalance-DhEnZ_L6.js";import{_ as pe}from"./BlockSelectContract-Cef_Umis.js";import{_ as Se}from"./ParamsAccordionBlock-Bkhx51Zg.js";import{_ as De}from"./BlockBalanceAgreement-ckI0MbGb.js";import{O as fe,r as i,f as B,g as be,h as ke,s as ge,E as x,c as k,b as c,a as t,D as ye,F as E,I as W,t as n,w as R,J as X,i as Ie,j as z,d as he,o as S,e as Ce}from"./index-DxPA2ffO.js";import{u as Be}from"./hosting-BRwESFSW.js";import{u as Oe}from"./contracts-DD2O0C6m.js";import{u as we}from"./services-DjjrPMAb.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ClausesKeeper-DtaNhp0a.js";import"./IconClose-Br7S99e8.js";import"./ServiceListOrderSelection-DjdcJR5t.js";import"./multiselect-DxJoM0Ze.js";import"./component-BeTqOa0q.js";import"./globalActions-DUlmxNCV.js";import"./IconHelp-D_mPG6iA.js";const Ne={class:"tw-px-4 md:tw-px-8"},Pe={class:"section-header"},Ve={class:"section-title"},He={class:"container"},xe={class:"total-block"},Ue={class:"total-block__row divider-bottom"},$e={class:"total-block__col"},Ae={class:"total-block__col"},Fe={class:"total-block__col"},Re={class:"total-block__row"},Te={class:"total-block__col"},Le={class:"total-block__col"},Ke={class:"total-block__col"},je={class:"total-block__row total-block__row--big economy-line"},Ge={class:"total-block__col flex-col"},Me={class:"red"},qe={class:"total-block__row total-block__row--big"},Je={class:"total-block__col"},We={class:"total-block__col"},Xe={__name:"HostingSchemesId",async setup(ze){let v,p;const g=Be(),T=Oe(),N=fe(),P=we(),Q=be(),y=he(),D=i(!1),U=i(""),O=i([]),$=i(!1),a=i(null),w=i([]),I=i(!1),u=i(null),V=i(null),L=i(""),K=o=>{o.key==="Enter"&&o.ctrlKey&&!Y.value&&q()},Y=B(()=>a.value===null||u.value===null),f=B(()=>g?.hostingSchemes?.[Q.params.id]),Z=B(()=>T?.contractsList),j=B(()=>P?.ServicesList),ee=B(()=>Object.keys(N?.domainSchemes)?.map(o=>({...N?.domainSchemes[o],value:N?.domainSchemes[o]?.ID}))),A=B(()=>{let o=0;return w.value.forEach(e=>{o+=e?.Price}),G(o)||0});ke(()=>{document.addEventListener("keyup",K)}),ge(()=>{document.removeEventListener("keyup",K)});function F(){let o=0;return a.value?.discounts?.Bonuses.map(e=>{o+=+e.Economy}),o}function h(o){return Number(o).toFixed(2)||0}function G(o){return Number(o).toFixed(2)||0}function oe(o){O.value=o}function te(){D.value=!1,console.log("Not")}function le(){D.value=!0,console.log("Own")}function ae(o){a.value=o}async function M(o){for(const e of w.value){let b="SUCCESS",m=j.value[e.ServiceID]?.Code;if(await P.ServiceOrder({Code:m,DependOrderID:o,...e,ContractID:u.value}).then(({result:s,info:r,error:H})=>{if(s==="SUCCESS"){let d={};m==="Default"?d.ServiceOrderID=r?.ServiceOrderID:d[`${m}OrderID`]=r?.ServiceOrderID,P.ServiceOrderPay(m,d,{XMLHttpRequest:"yes"}).then(_=>{let{result:C,error:J}=_;C==="SUCCESS"?y.push("/AdditionalServices}"):C==="BASKET"&&y.push("/Basket")})}else b="ERROR"}),b==="ERROR")break}}function q(){I.value=!0;let o=0,e,b,m;O.value.length>0&&(e=O.value[o],b=O.value.map(s=>`${s.line}${s.line&&s.Name?"."+s.Name:""}`),m=O.value.map(s=>`${s.ID}`)),D.value===!1?g.HostingOrder({ContractID:u.value,Domain:b||null,DomainName:e?.line||null,HostingSchemeID:f.value?.ID,DomainSchemeID:m||null,DomainTypeID:e?.line?e?.Name?"Order":"Nothing":"None"}).then(({result:s,info:r,error:H})=>{s==="SUCCESS"?(o++,M(r?.OrderID),g.HostingOrderPay({HostingOrderID:r?.HostingOrderID,DaysPayFromBallance:a.value?.daysFromBalance||0,DaysPay:a.value?.actualDays}).then(d=>{let{result:_,error:C}=d;_==="SUCCESS"?y.push("/HostingOrders"):_==="BASKET"&&y.push("/Basket"),I.value=!1})):I.value=!1}):(console.log(!0),g.HostingOrder({ContractID:u.value,Domain:U.value,DomainName:V.value?.line,HostingSchemeID:f.value?.ID,DomainSchemeID:V.value?.line&&V.value?.ID?V.value?.ID:null,DomainTypeID:"Nothing"}).then(({result:s,info:r,error:H})=>{s==="SUCCESS"?(M(r?.OrderID),g.HostingOrderPay({HostingOrderID:r?.HostingOrderID,DaysPayFromBallance:a.value?.daysFromBalance||0,DaysPay:a.value?.actualDays}).then(d=>{let{result:_,error:C}=d;_==="SUCCESS"?y.push("/HostingOrders"):_==="BASKET"&&y.push("/Basket"),I.value=!1})):I.value=!1}))}return[v,p]=x(()=>N.fetchDomainSchemes()),await v,p(),[v,p]=x(()=>g.fetchHostingSchemes()),await v,p(),[v,p]=x(()=>T.fetchContracts()),await v,p(),[v,p]=x(()=>P.fetchServices()),await v,p(),(o,e)=>{const b=De,m=Se,s=pe,r=ve,H=_e,d=de,_=me,C=ue,J=ce,se=ie,ne=re;return S(),k(E,null,[c(b),t("div",Ne,[f.value?.ID?(S(),k(E,{key:0},[t("div",Pe,[t("h1",Ve,n(f.value?.Name),1),e[9]||(e[9]=t("div",{class:"section-label"},"Хостинг",-1))]),c(J,{basic_title:"Хостинг",modelValue:L.value,"onUpdate:modelValue":e[7]||(e[7]=l=>L.value=l)},{page:R(()=>[c(m,{"params-list":f.value?.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),c(s,{title:"Договор",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=l=>u.value=l),class:"tw-mt-6"},null,8,["modelValue"]),c(r,{contractID:u.value,scheme:f.value,serviceID:"10000",isOrderID:!1,onSelect:ae,isBalancePay:$.value,"onUpdate:isBalancePay":e[1]||(e[1]=l=>$.value=l)},null,8,["contractID","scheme","isBalancePay"]),c(H,{disabled:D.value,"domain-list":ee.value,onClick:e[2]||(e[2]=l=>te()),onSelect:oe},null,8,["disabled","domain-list"]),t("div",He,[c(d,{id:"check-1",modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=l=>D.value=l),name:"checkbox-1"},{default:R(()=>e[10]||(e[10]=[Ce(" Использовать свой домен ",-1)])),_:1,__:[10]},8,["modelValue"]),c(_,{label:"Домен",name:"own-domain",onClick:e[4]||(e[4]=l=>le()),disabled:!D.value,modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=l=>U.value=l)},null,8,["disabled","modelValue"])])]),services:R(()=>[c(C,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=l=>w.value=l),serviceSearchParams:{ServiceID:"10000",ServersGroupID:f.value?.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]),_:1},8,["modelValue"]),W(t("div",xe,[a.value?.discounts?.Bonuses?.length>0?(S(),k(E,{key:0},[t("div",Ue,[e[11]||(e[11]=t("div",{class:"total-block__col"},"Цена тарифа",-1)),t("div",$e,n(h(a.value?.price))+" ₽",1)]),(S(!0),k(E,null,z(a.value?.discounts?.Bonuses,l=>(S(),k("div",{class:"total-block__row no-divider",key:l?.Days},[t("div",Ae,"Скидка "+n(l?.Discount)+"% на "+n(l?.Days)+" дней",1),t("div",Fe,"-"+n(h(l?.Economy))+" ₽",1)]))),128))],64)):Ie("",!0),t("div",Re,[e[12]||(e[12]=t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),t("div",Te,n(A.value)+" ₽",1)]),(S(!0),k(E,null,z(w.value,l=>(S(),k("div",{class:"total-block__row no-divider",key:l?.ServiceID},[t("div",Le,n(j.value[l?.ServiceID]?.Name),1),t("div",Ke,n(G(l?.Price))+" ₽",1)]))),128)),W(t("div",je,[e[13]||(e[13]=t("div",{class:"total-block__col red"},"Выгода",-1)),t("div",Ge,[t("span",null,[t("s",null,n(h(a.value?.price))+" ₽",1)]),t("span",Me,"-"+n(h(F()))+" ₽",1)])],512),[[X,a.value?.discounts?.Bonuses?.length>0]]),t("div",qe,[t("div",Je,"Итого за "+n(a.value?.label),1),t("div",We,n(h(a.value?.price-F()+ +A.value))+" ₽ ",1)])],512),[[X,a.value?.price]]),c(se,{class:"btn--wide",label:$.value||Z.value[u.value]?.Balance>h(a.value?.price-F()+ +A.value)?"Оплатить c баланса договора":"Добавить в корзину",disabled:a.value===null||u.value===null,"is-loading":I.value,onClick:e[8]||(e[8]=l=>q())},null,8,["label","disabled","is-loading"])],64)):(S(),ye(ne,{key:1,label:"Тариф не найден"}))])],64)}}},go=Ee(Xe,[["__scopeId","data-v-77b701a1"]]);export{go as default};
