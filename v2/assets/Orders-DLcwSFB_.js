import{L as Z,a as ee}from"./bootstrap-vue-next-BglOzul_.js";import{_ as te}from"./IconCard-CjQefsRP.js";import{_ as se}from"./UserNote-Cq01thJ0.js";import{_ as ae}from"./StatusBadge-DZmmWv0G.js";import{_ as le}from"./OrderIDBadge-Cc01CaG4.js";import{_ as oe}from"./ServerStatusBadge.vue_vue_type_script_setup_true_lang-DbXnhqPA.js";import{_ as ne}from"./FormInputSearch-B6VLZUqq.js";import{_ as re}from"./ClausesKeeper-gPyacQ05.js";import{_ as ie,g as ue}from"./BlockBalanceAgreement-DSLTUOoQ.js";import{an as ce,x as me,r as m,f as _,H as de,g as pe,D as ve,c as $,b as r,a,h as _e,w as l,v as u,F as fe,d as Se,o as U,t as o,j as A,n as ge}from"./index-C9dBN6m4.js";import{u as De}from"./orders-D_JLVTov.js";import{u as be}from"./contracts-BEc0DZS2.js";import{u as Ie}from"./services-moLhYNFg.js";import{f as B}from"./time-DenPiOX5.js";import{s as b}from"./multiselect-B6DlyfA6.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-aXPVPivX.js";import"./IconClose-CgjzG0Yf.js";import"./ButtonDefault-B1FApUky.js";import"./index-D0iqQ1zq.js";const Ce=[{key:"ID",label:"Заказ",variant:"td-blue",sortable:!0},{key:"ServiceID",label:"Услуга",variant:"td-gray td-order bold"},{key:"SchemeName",label:"Тариф",variant:"td-gray td-order"},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"td-gray td-order"},{key:"ContractID",label:"Договор",sortable:!0,variant:"td-blue"},{key:"UserNotice",label:"Примечание",variant:"td-gray td-limited"},{key:"controls",label:"",variant:"td-controls"}],xe={class:"tw-px-4 md:tw-px-8"},Le={class:"list-form"},Ve={class:"list-form_col list-form_col--sm"},ke={class:"list-form_select"},Oe={class:"multiselect-option"},he={class:"list-form_col list-form_col--sm"},we={class:"list-form_select"},Ne={class:"multiselect-option"},$e={class:"list-form_col list-form_col--sm"},Ue={class:"list-form_select"},Ae={class:"multiselect-option"},Be={class:"tw-flex tw-gap-2 tw-items-center"},Re={class:"btn__group"},Fe=["onClick"],Pe={key:0,class:"table-controls"},Ee={class:"multiselect-multiple-label"},Te={class:"multiselect-option"},He={__name:"Orders",async setup(je){let x,L;const f=Se(),V=pe(),i=De(),S=be(),c=Ie(),R=ce(),k=me("emitter");k.on("updateOrdersList",()=>{i.fetchAllOrders()});const I=m(""),d=m(10),p=m(1),F=m([10,25,50,100]),v=m("*"),g=m("*"),D=m("*"),y=_(()=>{let s=i.ordersList.filter(e=>String(e.ID).includes(I.value));return g.value!=="*"&&s!==null&&(s=s.filter(e=>String(e.ServiceID).includes(g.value))),v.value!=="*"&&s!==null&&(s=s.filter(e=>String(e.ContractID).includes(v.value))),D.value!=="*"&&s!==null&&(s=s.filter(e=>String(e.StatusID).includes(D.value))),p.value=1,s});function P(){f.go(0)}function E(s){if(!s)return B(new Date);const e=new Date,n=new Date(e.getTime()+s*24*60*60*1e3);return B(n)}function T(s,e){let n="";e==="Default"?n="Orders":n=e+"Orders",k.emit("open-modal",{component:"StatusHistory",data:{modeID:n,rowID:s}})}const O=_(()=>{let s=[{value:"*",name:"Все договора"}];return i.ordersList!==null?(i.ordersList.map(e=>{s.find(n=>n.value===e?.ContractID)||s.push({value:e?.ContractID,name:S.contractsList[e?.ContractID]?.Customer})}),s):{value:"*",name:"Все договора"}}),h=_(()=>{let s=[{value:"*",name:"Все услуги"}];return i.ordersList!==null?(i.ordersList.map(e=>{s.find(n=>n.value===e?.ServiceID)||s.push({value:e?.ServiceID,name:c.ServicesList[e?.ServiceID]?.NameShort})}),s):{value:"*",name:"Все услуги"}}),H=_(()=>R.data.Statuses?.Orders),w=_(()=>{let s=[{value:"*",name:"Все статусы"}];return i.ordersList!==null?(i.ordersList.map(e=>{s.find(n=>n.value===e?.StatusID)||s.push({value:e?.StatusID,name:H.value?.[e?.StatusID]?.Name||e?.StatusID})}),s):{value:"*",name:"Все статусы"}});function j(s){return c.ServicesList[s]?.Code!=="Default"?c.ServicesList[s]?.Code+"Orders":"Orders"}function q(s,e,n){let C=c.ServicesList[s.ServiceID]?.Code;f.push(ue(C,s.ID))}function M(s){let e=c.ServicesList[s.ServiceID]?.Code;e==="Default"?f.push(`/ServiceOrderPay/${s.ID}`):f.push(`/${e}OrderPay/${s.ID}`)}return de(()=>{V.query?.contractID&&(v.value=V.query?.contractID)}),[x,L]=ve(()=>Promise.all([i.fetchAllOrders(),S.fetchContracts(),c.fetchServices()])),await x,L(),(s,e)=>{const n=ie,C=re,z=ne,G=oe,J=le,K=ae,Q=se,W=te,X=Z,Y=ee;return U(),$(fe,null,[r(n),a("div",xe,[a("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer tw-mb-4",onClick:e[0]||(e[0]=t=>P())},"Мои заказы"),r(C),a("div",Le,[r(z,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=t=>I.value=t)},null,8,["modelValue"]),a("div",Ve,[a("div",ke,[r(u(b),{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),options:O.value,disabled:O.value?.length<=1,label:"name"},{singlelabel:l(({value:t})=>[a("span",null,"# "+o(String(t.value).padStart(5,"0"))+" / "+o(t.name),1)]),option:l(({option:t})=>[a("div",Oe,"# "+o(String(t.value).padStart(5,"0"))+" / "+o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",he,[a("div",we,[r(u(b),{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=t=>D.value=t),options:w.value,disabled:w.value?.length<=1,label:"name"},{option:l(({option:t})=>[a("div",Ne,o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",$e,[a("div",Ue,[r(u(b),{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=t=>g.value=t),options:h.value,disabled:h.value?.length<=1,label:"name"},{option:l(({option:t})=>[a("div",Ae,o(t.name),1)]),_:1},8,["modelValue","options","disabled"])])])]),r(X,{class:"basic-table",fields:u(Ce),items:y.value,"show-empty":!0,"per-page":d.value,responsive:"","current-page":p.value,"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onRowClicked:q},{"cell(ID)":l(t=>[a("div",Be,[r(G,{indicators:t.item.Stat?.Last},null,8,["indicators"]),r(J,{orderId:t.value},null,8,["orderId"])])]),"cell(ServiceID)":l(t=>[e[8]||(e[8]=a("span",{class:"td-mobile"},"Услуга",-1)),a("span",null,o(u(c).ServicesList[t.value]?.NameShort),1)]),"cell(SchemeName)":l(t=>[e[9]||(e[9]=a("span",{class:"td-mobile"},"Тариф",-1)),a("span",null,o(t.item?.SchemeName),1)]),"cell(ExpirationDate)":l(t=>[e[10]||(e[10]=a("span",{class:"td-mobile"},"Дата окончания",-1)),a("span",{class:ge({danger:Number(t.item?.DaysRemainded)<14})},o(E(t.item?.DaysRemainded))+" | "+o(t.item?.DaysRemainded||0)+" дн. ",3)]),"cell(StatusID)":l(t=>[r(K,{class:"clickable-element tw-cursor-pointer",status:t.value,"status-table":j(t.item?.ServiceID),onClick:A(N=>T(t.item?.ServiceOrderID,t.item?.Code),["stop"])},null,8,["status","status-table","onClick"])]),"cell(ContractID)":l(t=>[e[11]||(e[11]=a("span",{class:"td-mobile"},"Договор",-1)),a("span",null,"#"+o(u(S).contractsList[t.value]?.ID)+" / "+o(u(S).contractsList[t.value]?.Customer),1)]),"cell(UserNotice)":l(t=>[r(Q,{text:t.value,"order-id":t.item?.ID,emit:"updateOrdersList"},null,8,["text","order-id"])]),"cell(controls)":l(t=>[a("div",Re,[a("button",{class:"btn btn-default btn--border",onClick:A(N=>M(t.item),["stop"])},[r(W),e[12]||(e[12]=a("p",null,"ОПЛАТИТЬ",-1))],8,Fe)])]),_:1},8,["fields","items","per-page","current-page"]),y.value?.length>0?(U(),$("div",Pe,[r(Y,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value=t),"total-rows":y.value?.length,"per-page":d.value,"first-number":"","last-number":""},{"first-text":l(()=>e[13]||(e[13]=[a("span",{class:"text-success"},"First",-1)])),"last-text":l(()=>e[14]||(e[14]=[a("span",{class:"text-info"},"Last",-1)])),page:l(({page:t,active:N})=>[a("span",null,o((t-1)*d.value+1)+"-"+o(t*d.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),r(u(b),{class:"multiselect--white",modelValue:d.value,"onUpdate:modelValue":e[6]||(e[6]=t=>d.value=t),options:F.value,label:"name",openDirection:"top",onInput:e[7]||(e[7]=t=>p.value=1)},{singlelabel:l(({value:t})=>[a("div",Ee,[a("span",null,"Отображать "+o(t.value)+" строк",1)])]),option:l(({option:t})=>[a("div",Te,"Отображать "+o(t.name)+" строк",1)]),_:1},8,["modelValue","options"])])):_e("",!0)])],64)}}},ut=ye(He,[["__scopeId","data-v-fe79ea1f"]]);export{ut as default};
