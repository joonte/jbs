import{E as te}from"./EmptyStateBlock-0c3a34a2.js";import{_ as oe}from"./ButtonDefault-80267555.js";import{_ as se}from"./BlockOrderPayBalance-96cfcb69.js";import{_ as ae}from"./ClausesKeeper-a9c75480.js";import{_ as ce,e as le,a7 as ne,r as f,g as k,ag as y,o as c,c as l,b as p,a as t,F as P,t as n,v as re,k as _e,Y as M,ae as Q,p as ie,l as de}from"./index-041dff1e.js";import{u as ue}from"./vps-e86cbfbc.js";import{u as pe}from"./contracts-fabeed86.js";import{B as ve}from"./BlockBalanceAgreement-ab137d5a.js";import"./bootstrap-vue-next.es-dd4e7f7d.js";import"./IconHelp-769535c8.js";import"./globalActions-56c36e7b.js";import"./BasicInput-2e680f2d.js";import"./component-09da209a.js";import"./IconClose-4ba86278.js";import"./IconArrow-ce6e1d64.js";const V=m=>(ie("data-v-fd370404"),m=m(),de(),m),me={key:0,class:"vps-scheme-page"},he={class:"section"},Se={class:"container"},be=V(()=>t("div",{class:"section-header"},[t("h1",{class:"section-title"},"Оплата заказа VPS/VDS сервера")],-1)),ke={key:0,class:"section"},ge={class:"container"},fe={class:"total-block"},ye={class:"total-block__row divider-bottom"},Pe=V(()=>t("div",{class:"total-block__col"},"Цена тарифа",-1)),Ve={class:"total-block__col"},De={class:"total-block__row no-divider"},Ie={class:"total-block__col"},Be={class:"total-block__col"},we={class:"total-block__row total-block__row--big economy-line"},Ce=V(()=>t("div",{class:"total-block__col red"},"Выгода",-1)),Ee={class:"total-block__col flex-col"},xe={class:"red"},Oe={class:"total-block__row total-block__row--big"},Fe={class:"total-block__col"},Le={class:"total-block__col"},Ne={key:1,class:"section"},Ae={class:"container"},Te={key:1,class:"section"},$e={class:"container"},je={__name:"VPSProlong",async setup(m){let _,i;const r=ue(),D=pe(),I=le(),W=ne(),o=f(null),h=f(null),g=f(!1),X=k(()=>Object.keys(r.vpsSchemes).map(e=>r.vpsSchemes[e])),S=k(()=>Object.keys(r.vpsList).map(e=>r.vpsList[e]).find(e=>e.OrderID===W.params.id)),B=k(()=>D.contractsList);console.log("getContracts",B);const v=k(()=>X.value.find(e=>{var s;return(e==null?void 0:e.ID)===((s=S.value)==null?void 0:s.SchemeID)}));console.log("getSelectedPackage",v);function b(e){return Number(e).toFixed(2)||0}function w(){var s,d;let e=0;return(d=(s=o.value)==null?void 0:s.discounts)==null||d.Bonuses.map(u=>{e+=+u.Economy}),e}function Z(e){o.value=e}function ee(){var e,s;g.value=!0,r.VPSOrderPay({VPSOrderID:(e=S.value)==null?void 0:e.ID,DaysPay:(s=o.value)==null?void 0:s.actualDays,IsChange:!0}).then(d=>{let{result:u,error:C}=d;u==="SUCCESS"?I.push("/VPSOrders"):u==="BASKET"&&I.push("/Basket"),g.value=!0})}return[_,i]=y(()=>r.fetchVPSSchemes()),await _,i(),[_,i]=y(()=>D.fetchContracts()),await _,i(),[_,i]=y(()=>r.fetchVPS().then(()=>{var e;h.value=(e=S.value)==null?void 0:e.ContractID})),await _,i(),(e,s)=>{var x,O,F,L,N,A,T,$,j,R,H,K,U,Y,q,z,G,J;const d=ae,u=se,C=oe,E=te;return c(),l(P,null,[p(ve),S.value?(c(),l("div",me,[t("div",he,[t("div",Se,[be,p(d,{partition:"Header:/VPSSchemes"})])]),p(u,{contractID:h.value,scheme:v.value,serviceID:"30000",isOrderID:!1,onSelect:Z},null,8,["contractID","scheme"]),(x=v.value)!=null&&x.IsPayed&&((O=v.value)!=null&&O.IsProlong)||!((F=v.value)!=null&&F.IsPayed)?(c(),l("div",ke,[t("div",ge,[t("div",fe,[((A=(N=(L=o.value)==null?void 0:L.discounts)==null?void 0:N.Bonuses)==null?void 0:A.length)>0?(c(),l(P,{key:0},[t("div",ye,[Pe,t("div",Ve,n(b((T=o.value)==null?void 0:T.price))+" ₽",1)]),(c(!0),l(P,null,re((j=($=o.value)==null?void 0:$.discounts)==null?void 0:j.Bonuses,a=>(c(),l("div",De,[t("div",Ie,"Скидка "+n(a==null?void 0:a.Discount)+"% на "+n(a==null?void 0:a.Days)+" дней",1),t("div",Be,"-"+n(b(a==null?void 0:a.Economy))+" ₽",1)]))),256))],64)):_e("",!0),M(t("div",we,[Ce,t("div",Ee,[t("span",null,[t("s",null,n(b((R=o.value)==null?void 0:R.price))+" ₽",1)]),t("span",xe,"-"+n(w())+" ₽",1)])],512),[[Q,((U=(K=(H=o.value)==null?void 0:H.discounts)==null?void 0:K.Bonuses)==null?void 0:U.length)>0]]),M(t("div",Oe,[t("div",Fe,"Итого за "+n((Y=o.value)==null?void 0:Y.label),1),t("div",Le,n(b(((q=o.value)==null?void 0:q.price)-w()))+" ₽",1)],512),[[Q,(z=o.value)==null?void 0:z.price]])]),p(C,{class:"btn--wide",label:((G=B.value[h.value])==null?void 0:G.Balance)>((J=o.value)==null?void 0:J.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||h.value===null,"is-loading":g.value,onClick:s[0]||(s[0]=a=>ee())},null,8,["label","disabled","is-loading"])])])):(c(),l("div",Ne,[t("div",Ae,[p(E,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(c(),l("div",Te,[t("div",$e,[p(E,{label:"Заказ VPS/VDS сервера не найден"})])]))],64)}}},tt=ce(je,[["__scopeId","data-v-fd370404"]]);export{tt as default};
