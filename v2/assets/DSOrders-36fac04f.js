import{j as V,o as h,c as k,a as c,b as d,w as I,d as P,t as S,F as T,x as j,n as W,k as X,_ as R,e as z,S as F,y as H,p as Y,l as Z,r as N,g as M,h as $}from"./index-5e313302.js";import{u as tt}from"./dedicatedServer-a434bad7.js";import{u as et}from"./contracts-3351d68f.js";import{I as ot}from"./IconSearch-5f35739d.js";import{_ as st}from"./HelperComponent-21d9fd2e.js";import{S as G}from"./StatusBadge-98696de1.js";import{I as at}from"./IconRotate-3e508a67.js";import{f as E}from"./useTimeFunction-8602dd60.js";import"./resetServer-2f6a71c3.js";import{z as nt,k as rt,d as ct}from"./bootstrap-vue-next.es-a19a8b41.js";import{_ as lt}from"./IconDots-f060bcd6.js";import{_ as it}from"./IconCard-67ad5f17.js";import{_ as dt}from"./OrderIDBadge-9697206f.js";import{S as ut}from"./Select2-59fcaca7.js";import{s as _t}from"./multiselect-bfc29db8.js";import{_ as q}from"./FormInputSearch-4c769092.js";import{B as J}from"./BlockBalanceAgreement-bb87adc1.js";import{u as mt}from"./globalActions-a7429ad5.js";import{E as ft}from"./EmptyStateBlock-9f752916.js";import{_ as Dt}from"./ClausesKeeper-eb954229.js";import"./ButtonDefault-7c216fc6.js";import"./IconArrow-555f9d45.js";import"./IconPlus-856cd9b9.js";import"./IconClose-1f889a2e.js";const pt={class:"hosting-item"},vt={class:"hosting-item__row"},It={class:"hosting-item__row"},ht={class:"hosting-item__person"},gt={key:0,class:"hosting-item__row"},St={class:"hosting-item__list"},Ct=["innerHTML"],bt={class:"hosting-status__info"},Ot={class:"hosting-status__date"},wt={class:"hosting-item__controls"},yt={class:"btn btn--dots"};function kt(i,s,n,e,C,B){var D,r,v,L,x,U,o,t,m;const g=dt,u=V("router-link"),b=V("Helper"),O=G,y=it,a=lt,l=nt,_=rt,w=ct;return h(),k("div",pt,[c("div",vt,[d(g,{orderID:(D=n.itemData)==null?void 0:D.OrderID,onClick:s[0]||(s[0]=f=>{var p;return e.toItem((p=n.itemData)==null?void 0:p.OrderID)})},null,8,["orderID"]),d(u,{class:"hosting-item__name",to:`/DSOrders/${n.itemData.OrderID}`},{default:I(()=>[P(S(n.itemData.IP),1)]),_:1},8,["to"])]),c("div",It,[c("div",ht,S((r=n.itemData)==null?void 0:r.Customer),1),d(b,{"user-notice":(v=n.itemData)==null?void 0:v.UserNotice,id:(L=n.itemData)==null?void 0:L.OrderID,position:n.isLast?"bottom":"top",emit:"updateDSOrdersList"},null,8,["user-notice","id","position"])]),n.params.length?(h(),k("div",gt,[c("ul",St,[(h(!0),k(T,null,j(n.params,f=>(h(),k("li",{innerHTML:f},null,8,Ct))),256))]),c("div",bt,[c("div",{class:W(["hosting-item__date",{danger:Number((x=n.itemData)==null?void 0:x.DaysRemainded)<14}])},S(e.calculateExpirationDate((U=n.itemData)==null?void 0:U.DaysRemainded))+" • "+S(((o=n.itemData)==null?void 0:o.DaysRemainded)||0)+" дн.",3),d(O,{class:"status-badge",status:(t=n.itemData)==null?void 0:t.StatusID,"status-table":"DSOrders",onClick:s[1]||(s[1]=f=>{var p;return e.openHistoryStatuses((p=n.itemData)==null?void 0:p.ID)})},null,8,["status"]),c("div",Ot,S(e.calculateDaysSinceStatusUpdate((m=n.itemData)==null?void 0:m.StatusDate)),1)])])):X("",!0),c("div",wt,[c("div",{class:"btn btn--md btn--bold",onClick:s[2]||(s[2]=f=>{var p;return i.$router.push(`/DSOrderPay/${(p=n.itemData)==null?void 0:p.OrderID}`)})},[d(y),P("Оплатить")]),d(w,{class:"dropdown-dots",right:""},{"button-content":I(()=>[c("div",yt,[d(a)])]),default:I(()=>[d(l,null,{default:I(()=>{var f;return[d(u,{to:`DSOrders/${(f=n.itemData)==null?void 0:f.OrderID}`},{default:I(()=>[P("Дополнительная информация")]),_:1},8,["to"])]}),_:1}),d(l,{onClick:s[3]||(s[3]=f=>e.transferAccount())},{default:I(()=>[P("Передать на другой аккаунт")]),_:1}),d(_),d(l,{class:"color-red",onClick:s[4]||(s[4]=f=>e.deleteItem())},{default:I(()=>[P("Удалить")]),_:1})]),_:1})])])}const Lt={components:{StatusBadge:G,IconRotate:at,Helper:st},props:{params:{type:Array,default:()=>[]},itemData:{type:Object,default:()=>{}},isLast:{type:Boolean,default:!1}},emits:["delete","transfer","manage"],setup(i,{emit:s}){const n=z(),e=F("emitter");function C(a){if(!a)return E(new Date);const l=new Date,_=new Date(l.getTime()+a*24*60*60*1e3);return E(_)}function B(a){n.push(`/DSOrders/${a}`)}function g(){var a;s("delete",(a=i.itemData)==null?void 0:a.ID)}function u(){var a,l;s("transfer",{ServiceOrderID:(a=i.itemData)==null?void 0:a.ID,ServiceID:(l=i.itemData)==null?void 0:l.ServiceID})}function b(a){e.emit("open-modal",{component:"StatusHistory",data:{modeID:"DSOrders",rowID:a}})}function O(){var a,l,_;s("manage",{ServiceOrderID:(a=i.itemData)==null?void 0:a.ID,ServiceID:(l=i.itemData)==null?void 0:l.ServiceID,OrderID:(_=i.itemData)==null?void 0:_.OrderID})}function y(a){if(!a)return"";const l=new Date(parseInt(a)*1e3),w=new Date-l,D=Math.floor(w/1e3),r=Math.floor(D/60),v=Math.floor(r/60),L=Math.floor(v/24);return D<60?`${D} сек. от статуса`:r<60?`${r} мин. от статуса`:v<24?`${v} ч. от статуса`:`${L} дн. от статуса`}return{deleteItem:g,orderManage:O,transferAccount:u,calculateExpirationDate:C,openHistoryStatuses:b,toItem:B,calculateDaysSinceStatusUpdate:y}}},K=R(Lt,[["render",kt],["__scopeId","data-v-7a034b14"]]),Mt=i=>(Y("data-v-ca75e9f2"),i=i(),Z(),i),Pt={class:"section"},Bt={class:"container"},xt={class:"section-header"},Ut={class:"section-title__nowrap"},Vt=Mt(()=>c("h1",{class:"section-title"},"Выделенные серверы",-1)),Ht={class:"list-form"},Tt={class:"list-form_col list-form_col--sm"},At={class:"list-form_select"},Nt={class:"multiselect-option"},Et={key:0};function jt(i,s,n,e,C,B){var _,w,D;const g=J,u=V("router-link"),b=Dt,O=V("Multiselect"),y=q,a=K,l=ft;return h(),k(T,null,[d(g),c("div",Pt,[c("div",Bt,[c("div",xt,[c("div",Ut,[Vt,d(u,{class:"btn btn--blue btn-default",to:"DSSchemes"},{default:I(()=>[P("Заказать")]),_:1})])]),d(b,{partition:"Header:/DSOrders"}),c("div",Ht,[c("div",Tt,[c("div",At,[d(O,{modelValue:e.select,"onUpdate:modelValue":s[0]||(s[0]=r=>e.select=r),options:e.getUsers,disabled:((_=e.getUsers)==null?void 0:_.length)<=1,label:"name"},{singlelabel:I(({value:r})=>[c("span",null,"# "+S(r.value.padStart(5,"0"))+" / "+S(r.name),1)]),option:I(({option:r})=>[c("div",Nt,"# "+S(r.value.padStart(5,"0"))+" / "+S(r.name),1)]),_:1},8,["modelValue","options","disabled"])])]),d(y,{modelValue:e.search,"onUpdate:modelValue":s[1]||(s[1]=r=>e.search=r)},null,8,["modelValue"])]),e.getDSList&&((w=e.getDSList)==null?void 0:w.length)>0?(h(),k("div",Et,[e.filterProducts&&((D=e.filterProducts)==null?void 0:D.length)>0?(h(!0),k(T,{key:0},j(e.filterProducts,(r,v)=>(h(),H(a,{params:e.getDSItemParam(r),"is-last":v===e.filterProducts.length-1,"item-data":r,onDelete:e.deleteItem,onTransfer:e.transferItem,onManage:e.orderManage},null,8,["params","is-last","item-data","onDelete","onTransfer","onManage"]))),256)):(h(),H(l,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(h(),H(l,{key:1,class:"no-margin",label:"У Вас нет заказов на выделенные серверы"}))])])],64)}const Rt={components:{FormInputSearch:q,IconSearch:ot,Select2:ut,Multiselect:_t,DSItem:K,BlockBalanceAgreement:J},async setup(){const i=N("*"),s=N(null),n=mt(),e=tt(),C=et(),B=z(),g=F("emitter");g.on("updateDSOrdersList",()=>{e.fetchDSOrders()});const u=M(()=>{var o;return(o=Object.keys(e==null?void 0:e.DSList).map(t=>e==null?void 0:e.DSList[t]))==null?void 0:o.reverse()}),b=M(()=>e==null?void 0:e.DSSchemes),O=M(()=>C==null?void 0:C.contractsList),y=M(()=>e==null?void 0:e.DSOrderIPMI),a=M(()=>w(_(u.value)));$(()=>{u.value.length<1&&l()});function l(){B.push({path:"/DSSchemes"})}function _(o){return i.value!=="*"?o.filter(t=>(t==null?void 0:t.ContractID)===i.value):o}function w(o){return s.value!==null?o.filter(t=>(t==null?void 0:t.Customer.toLowerCase().includes(s.value.toLowerCase()))||(t==null?void 0:t.OrderID.toLowerCase().includes(s.value.toLowerCase()))||(t==null?void 0:t.Scheme.toLowerCase().includes(s.value.toLowerCase()))||(t==null?void 0:t.IP.toLowerCase().includes(s.value.toLowerCase()))||(t==null?void 0:t.disks.toLowerCase().includes(s.value.toLowerCase()))||(t==null?void 0:t.CPU.toLowerCase().includes(s.value.toLowerCase()))||(t==null?void 0:t.ram.toLowerCase().includes(s.value.toLowerCase()))):o}function D(o){n.OrderManage(o)}const r=M(()=>{let o=[{value:"*",name:"Все договора"}];return u.value!==null&&O.value!==null?(Object.keys(u.value).forEach(t=>{var m,f,p;o.find(Q=>{var A;return Q.value===((A=u.value[t])==null?void 0:A.ContractID)})||o.push({value:(m=u.value[t])==null?void 0:m.ContractID,name:(p=O.value[(f=u.value[t])==null?void 0:f.ContractID])==null?void 0:p.Customer})}),o):{value:"*",name:"Все договора"}});function v(o){let t=L(o==null?void 0:o.SchemeID);t===void 0&&(t=o);let m=[];return o!=null&&o.Scheme&&m.push(o==null?void 0:o.Scheme),o!=null&&o.CPU&&m.push(o==null?void 0:o.CPU),t!=null&&t.ram&&m.push("RAM "+(t==null?void 0:t.ram)+" GB"),t!=null&&t.disks&&m.push(t==null?void 0:t.disks),t!=null&&t.CostMonth&&m.push("<b>"+(t==null?void 0:t.CostMonth)+"/ месяц</b>"),m}function L(o){var t;return(t=b.value)==null?void 0:t[o]}function x(o){g.emit("open-modal",{component:"DeleteItem",data:{id:o,message:"Вы действительно хотите удалить этот сервер?",tableID:"DSOrders",successEmit:"updateDSOrdersList"}})}function U(o){g.emit("open-modal",{component:"OrdersTransfer",data:o})}return await e.fetchDSOrders(),await e.fetchDSSchemes(),await e.fetchDSOrderIPMI(),await C.fetchContracts(),{getDSList:u,filterProducts:a,select:i,search:s,getUsers:r,getDSSchemes:b,getDSItemParam:v,getDSOrderIPMI:y,orderManage:D,deleteItem:x,transferItem:U,navigateToDSSchemes:l}}},_e=R(Rt,[["render",jt],["__scopeId","data-v-ca75e9f2"]]);export{_e as default};
