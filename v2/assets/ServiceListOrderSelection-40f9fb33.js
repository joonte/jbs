import{_ as te,r as A,i as T,h as $,o as u,c as f,a as c,t as V,m as re,k as b,p as oe,l as le,j as ie,b as J,y as Y,w as se,F as M,x as Q,d as K,Z as ce,af as ue,f as _e,e as De,a7 as fe,S as ve,g,O as Se}from"./index-5e313302.js";import{u as he}from"./contracts-3351d68f.js";import{u as Ie}from"./domain-ae28df08.js";import{u as Oe}from"./services-21abfb71.js";import{s as ye}from"./multiselect-bfc29db8.js";import{_ as ke}from"./ButtonDefault-7c216fc6.js";import{_ as be}from"./BasicInput-be1c88a0.js";import{_ as pe}from"./BlockSelectContract-65c747e2.js";import{_ as Ce}from"./ClausesKeeper-eb954229.js";const ge={props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:D}){const s=A(null);function a(){D("update:modelValue",l.data)}return T(l,()=>{s.value=l.modelValue}),$(()=>{s.value=l.modelValue}),{updateValue:a,inputValue:s}}},Ve=l=>(oe("data-v-414dbe12"),l=l(),le(),l),me={class:"form-input_border"},Ae=["checked","name","type"],Ee={class:"form-input_border-content"},Ne=Ve(()=>c("span",{class:"form-input_border-mark"},null,-1)),Be={class:"form-input_border-item form-input_border-item--left"},je={class:"form-input_border-item form-input_border-item--right"};function xe(l,D,s,a,R,h){var E,i,N;return u(),f("label",me,[c("input",{checked:((E=a.inputValue)==null?void 0:E.value)===((i=s.data)==null?void 0:i.value),name:s.name,type:s.checkbox?"checkbox":"radio",onInput:D[0]||(D[0]=(...m)=>a.updateValue&&a.updateValue(...m))},null,40,Ae),c("span",Ee,[Ne,c("span",Be,V((N=s.data)==null?void 0:N.name),1),s.data.price?re(l.$slots,"default",{key:0},()=>{var m;return[c("span",je,V((m=s.data)==null?void 0:m.price),1)]},!0):b("",!0)])])}const de=te(ge,[["render",xe],["__scopeId","data-v-414dbe12"]]),ee=l=>(oe("data-v-43c79838"),l=l(),le(),l),Pe={key:0,class:"section"},we={class:"section-header"},Ue={class:"section-title"},Fe={key:2,class:"form-field form-field--basic"},Le=ee(()=>c("div",{class:"form-field__label"},[K("IP адрес лицензии"),c("span",null,"*")],-1)),Me={class:"form-field-input__wrapper"},Te={key:3,class:"form-field form-field--basic"},Ke=ee(()=>c("div",{class:"form-field__label"},[K("Выбрать заказ"),c("span",null,"*")],-1)),Re={class:"form-field-input__wrapper"},qe={class:"multiselect-option"},We={class:"form-field form-field--basic"},He={class:"form-field__label"},Ze={key:0},ze={class:"form-field-input__wrapper"},Ge=["name","onUpdate:modelValue"],Je={key:5,class:"section"},Qe={class:"list"},Xe={class:"list-col list-col--md"},Ye=ee(()=>c("div",{class:"list-item__title"},[K("Тариф"),c("span",null,"*")],-1)),$e={key:6,class:"section"},ea={class:"list"},aa={class:"list-col list-col--md"},na={class:"list-item__title"},ta={key:0},oa={key:7,class:"section"},la={class:"total-block block--divider"},da={class:"total-block__row total-block__row--big"},ra={class:"total-block__col"},ia={class:"total-block__col"},sa={key:8,class:"additional-service__inline-price"};function ca(l,D,s,a,R,h){var w,I,q,W,B,U,j,H,Z,F;const E=Ce,i=pe,N=be,m=ie("Multiselect"),P=de,p=ke;return u(),f(M,null,[s.isInline?b("",!0):(u(),f("div",Pe,[c("div",we,[c("h1",Ue,V((w=s.sectionData)==null?void 0:w.Item),1),J(E,{partition:`Header:${((I=s.sectionData)==null?void 0:I.Code)==="Default"?s.sectionID:`/${(q=s.sectionData)==null?void 0:q.Code}Orders`}`},null,8,["partition"])])])),s.isInline?b("",!0):(u(),Y(i,{key:1,class:"additional-service__contract-select",title:"Договор",modelValue:a.contractSelect,"onUpdate:modelValue":D[0]||(D[0]=d=>a.contractSelect=d)},null,8,["modelValue"])),a.DependOrderID==="0"&&s.sectionID==="51000"?(u(),f("div",Fe,[Le,c("div",Me,[J(N,{name:"ServiceIP",placeholder:"0.0.0.0",modelValue:a.serviceIP,"onUpdate:modelValue":D[1]||(D[1]=d=>a.serviceIP=d)},null,8,["modelValue"])])])):b("",!0),((W=a.getDependOrders)==null?void 0:W.length)>0?(u(),f("div",Te,[Ke,c("div",Re,[J(m,{class:"multiselect--white",placeholder:"Все заказы",label:"name","track-by":"value",options:a.getDependOrders,modelValue:a.DependOrderID,"onUpdate:modelValue":D[2]||(D[2]=d=>a.DependOrderID=d)},{option:se(({option:d})=>[c("div",qe,V(d.name),1)]),_:1},8,["options","modelValue"])])])):b("",!0),((B=a.getInputFields)==null?void 0:B.length)>0?(u(!0),f(M,{key:4},Q(a.getInputFields,d=>(u(),f("div",We,[c("div",He,[K(V(d==null?void 0:d.Name),1),d!=null&&d.IsDuty?(u(),f("span",Ze,"*")):b("",!0)]),c("div",ze,[ce(c("input",{name:`ID${d==null?void 0:d.ID}`,"onUpdate:modelValue":O=>a.formData[`ID${d==null?void 0:d.ID}`]=O},null,8,Ge),[[ue,a.formData[`ID${d==null?void 0:d.ID}`]]])])]))),256)):b("",!0),((U=s.sectionData)==null?void 0:U.Code)!=="Default"&&((j=a.getAdditionalServicesSchemes)==null?void 0:j.length)>0?(u(),f("div",Je,[c("div",Qe,[c("div",Xe,[Ye,(u(!0),f(M,null,Q(a.getAdditionalServicesSchemes,d=>{var O,x;return u(),Y(P,{name:`${(O=s.sectionData)==null?void 0:O.Code}SchemeID`,checkbox:!1,data:d,modelValue:a.formData[`${(x=s.sectionData)==null?void 0:x.Code}SchemeID`],"onUpdate:modelValue":D[3]||(D[3]=z=>{var L;return a.formData[`${(L=s.sectionData)==null?void 0:L.Code}SchemeID`]=z}),disabled:a.isDepend()},null,8,["name","data","modelValue","disabled"])}),256))])])])):b("",!0),((H=a.getSelectFields)==null?void 0:H.length)>0?(u(),f("div",$e,[c("div",ea,[(u(!0),f(M,null,Q(a.getSelectFields,d=>(u(),f("div",aa,[c("div",na,[K(V(d==null?void 0:d.Name),1),d!=null&&d.IsDuty?(u(),f("span",ta,"*")):b("",!0)]),(u(!0),f(M,null,Q(a.getSelectFieldOptions(d),O=>(u(),Y(P,{name:`ID${d==null?void 0:d.ID}`,checkbox:!1,data:O,modelValue:a.formData[`ID${d==null?void 0:d.ID}`],"onUpdate:modelValue":x=>a.formData[`ID${d==null?void 0:d.ID}`]=x},null,8,["name","data","modelValue","onUpdate:modelValue"]))),256))]))),256))])])):b("",!0),s.isInline?(u(),f("div",sa,V(a.finalPrice()||0)+" ₽",1)):(u(),f("div",oa,[c("div",la,[c("div",da,[c("div",ra,"Итого за 1 "+V((Z=s.sectionData)==null?void 0:Z.Measure),1),c("div",ia,V(a.finalPrice()||0)+" ₽",1)])]),J(p,{class:"btn--wide",disabled:a.getButtonDisableCondition||!a.formData[`${s.sectionData.Code}SchemeID`]&&((F=s.sectionData)==null?void 0:F.Code)!=="Default",label:"Заказать","is-loading":a.isLoading,onClick:D[4]||(D[4]=d=>a.payForOrder())},null,8,["disabled","is-loading"])]))],64)}const ua={components:{InputBorderCheckboxRadio:de,Multiselect:ye},props:{modelValue:{type:Object,default:()=>{}},sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},emits:["updateList","update:modelValue"],setup(l,{emit:D}){const s=he(),a=Oe();_e();const R=Ie(),h=De(),E=fe(),i=A({}),N=A(null),m=A(null),P=A(null),p=A(""),w=A(null),I=A(!1);ve("emitter"),g(()=>a.ServicesList),g(()=>R.domainsList);const q=g(()=>{var n,o;return(o=Object.keys((a==null?void 0:a.additionalServicesScheme[(n=l.sectionData)==null?void 0:n.Code])||{}))==null?void 0:o.map(e=>{var v,C,y,_,S,k,G,ae,ne;const t=((C=a==null?void 0:a.additionalServicesScheme[(v=l.sectionData)==null?void 0:v.Code][e])==null?void 0:C.DependOrders)||{},r=Object.keys(t);return{...a==null?void 0:a.additionalServicesScheme[(y=l.sectionData)==null?void 0:y.Code][e],value:(S=a==null?void 0:a.additionalServicesScheme[(_=l.sectionData)==null?void 0:_.Code][e])==null?void 0:S.ID,price:(G=a==null?void 0:a.additionalServicesScheme[(k=l.sectionData)==null?void 0:k.Code][e])==null?void 0:G.CostMonth,name:(ne=a==null?void 0:a.additionalServicesScheme[(ae=l.sectionData)==null?void 0:ae.Code][e])==null?void 0:ne.Name,dependOrders:r}}).sort((e,t)=>Number(e==null?void 0:e.SortID)<Number(t==null?void 0:t.SortID)?-1:Number(e==null?void 0:e.SortID)>Number(t==null?void 0:t.SortID)?1:0).filter(e=>p.value==="0"?(e==null?void 0:e.IsActive)&&e.dependOrders.length===0:p.value===null||p.value===""?e==null?void 0:e.IsActive:(e==null?void 0:e.IsActive)&&e.dependOrders.includes(p.value))}),W=g(()=>{var o;let n=!1;return(o=U.value)==null||o.forEach(e=>{e!=null&&e.IsDuty&&(i.value[`ID${e==null?void 0:e.ID}`]===null||i.value[`ID${e==null?void 0:e.ID}`]===void 0||i.value[`ID${e==null?void 0:e.ID}`]==="")&&(n=!0)}),n}),B=g(()=>{var n;return(n=l.sectionData)==null?void 0:n.ServicesFields.filter(o=>(o==null?void 0:o.TypeID)==="Select").sort((o,e)=>Number(o==null?void 0:o.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),U=g(()=>{var n;return(n=l.sectionData)==null?void 0:n.ServicesFields.filter(o=>(o==null?void 0:o.TypeID)==="Input").sort((o,e)=>Number(o==null?void 0:o.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(o==null?void 0:o.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),j=g(()=>{var v,C,y;let n=[];const o=a==null?void 0:a.additionalServicesScheme[(v=l.sectionData)==null?void 0:v.Code];if(((C=l.sectionData)==null?void 0:C.Code)==="Default"){const _=(y=Object.keys(a==null?void 0:a.ServicesList))==null?void 0:y.map(S=>{var k;return{...a==null?void 0:a.ServicesList[S],value:(k=a==null?void 0:a.ServicesList[S])==null?void 0:k.ID}}).filter(S=>(S==null?void 0:S.ID)===E.query.ServiceID);if(_.length>0){const S=_[0].DependOrders;S&&(n=Object.entries(S).map(([k,G])=>({name:G,value:k})))}return console.log(n),n}if(!o)return n;const e=Object.values(o).filter(_=>(_==null?void 0:_.IsActive)&&(_==null?void 0:_.DependOrders)).flatMap(_=>Object.entries(_.DependOrders)),t=new Map;e.forEach(([_,S])=>{const k=`${_}:${S}`;t.has(k)||t.set(k,{name:S,value:_})});const r=Array.from(t.values());return l.sectionID==="51000"?n=[{name:"Без заказа",value:"0"},...r]:n=r,n}),H=g(()=>{var e;const n=a==null?void 0:a.additionalServicesScheme[(e=l.sectionData)==null?void 0:e.Code];return n?Object.values(n).filter(t=>(t==null?void 0:t.IsActive)&&(t==null?void 0:t.DependOrders)).flatMap(t=>Object.entries(t.DependOrders)).map(([t,r])=>({name:r,value:t})):[]}),Z=g(()=>{var t,r,v;const n=(r=i.value[`${(t=l.sectionData)==null?void 0:t.Code}SchemeID`])==null?void 0:r.ID,o=a==null?void 0:a.additionalServicesScheme[(v=l.sectionData)==null?void 0:v.Code];if(!n)return H.value;const e=o==null?void 0:o[n];return e&&e.DependOrders?Object.entries(e.DependOrders).map(([C,y])=>({name:y,value:C})):[]}),F=n=>{n.key==="Enter"&&n.ctrlKey&&z()};$(()=>{document.addEventListener("keyup",F)}),Se(()=>{document.removeEventListener("keyup",F)});function d(){var o;let n=0;return Object.keys(i.value).map(e=>{var t,r;(t=i.value[e])!=null&&t.price&&(n=n+Number((r=i.value[e])==null?void 0:r.price))}),n+Number((o=l.sectionData)==null?void 0:o.Cost)}function O(n){var o,e;return(e=(o=n==null?void 0:n.Options)==null?void 0:o.split(`
`))==null?void 0:e.map(t=>{let r=t.split("=");return{value:r[0],name:r[1],price:r[2]}})}function x(){return l.sectionID==="50000"&&j.value.length<1}function z(){var o;I.value=!0;let n={};(o=Object.keys(i.value))==null||o.forEach(e=>{var t,r;n[e]=(t=i.value[e])!=null&&t.value?(r=i.value[e])==null?void 0:r.value:i.value[e]}),n.ContractID=P.value,n.ServiceID=l.sectionID,n.DependOrderID=p.value,p.value==="0"&&(n.IP=w.value),l.sectionID==="50000"?a.ExtraIPOrder(n).then(({result:e,info:t,error:r})=>{I.value=!1,e==="SUCCESS"?h.push(`/AdditionalServices?ServiceID=${l.sectionID}`):e==="BASKET"&&h.push("/Basket")}):l.sectionID==="51000"?a.ISPswOrder(n).then(({result:e})=>{I.value=!1,e==="SUCCESS"?h.push(`/AdditionalServices?ServiceID=${l.sectionID}`):e==="BASKET"&&h.push("/Basket")}):l.sectionID==="52000"?a.DNSmanagerOrder(n).then(({result:e,info:t,error:r})=>{I.value=!1,e==="SUCCESS"?h.push(`/AdditionalServices?ServiceID=${l.sectionID}`):e==="BASKET"&&h.push("/Basket")}):a.ServiceOrder(n).then(({result:e,info:t,error:r})=>{var v;e==="SUCCESS"?a.ServiceOrderPay((v=l.sectionData)==null?void 0:v.Code,{AmountPay:"1",ServiceOrderID:t==null?void 0:t.ServiceOrderID,IsChange:!0}).then(C=>{let{result:y,error:_}=C;y==="SUCCESS"?h.push(`/AdditionalServices?ServiceID=${l.sectionID}`):y==="BASKET"&&h.push("/Basket"),I.value=!1}):I.value=!1})}function L(){var o;let n={};(o=Object.keys(i.value))==null||o.forEach(e=>{var t,r;n[e]=(t=i.value[e])!=null&&t.value?(r=i.value[e])==null?void 0:r.value:i.value[e]}),n.ServiceID=l.sectionID,n.Price=d(),D("update:modelValue",n)}function X(){var n,o;if(l.modelValue){const e=(n=Object.keys(l.modelValue))==null?void 0:n.find(t=>t.includes("SchemeID"));e&&((o=i.value[e])!=null&&o.ID||(i.value[e]={}),i.value[e].ID=l.modelValue[e])}}return T(()=>{var n;return i.value[`${(n=l.sectionData)==null?void 0:n.Code}SchemeID`]},n=>{n&&n.ID?console.log(`Выбран новый тариф с ID: ${n.ID}`):console.log("Тариф не выбран")}),T(E,()=>{var n,o,e;X(),l.updateWithPageTransition&&((n=B.value)==null||n.forEach(t=>{var r;i.value[`ID${t==null?void 0:t.ID}`]&&(i.value[`ID${t==null?void 0:t.ID}`]=(r=O(t))==null?void 0:r.find(v=>v.value===(t==null?void 0:t.Default)))}),((o=l.sectionData)==null?void 0:o.Code)!=="Default"&&a.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code))}),T(i.value,()=>{L()}),T(l,()=>{X()}),$(async()=>{var n,o,e;(n=B.value)==null||n.forEach(t=>{var r;i.value[`ID${t==null?void 0:t.ID}`]=(r=O(t))==null?void 0:r.find(v=>v.value===(t==null?void 0:t.Default))}),((o=l.sectionData)==null?void 0:o.Code)!=="Default"&&await a.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code),await R.fetchDomains(),X(),L(),console.log("DEPEND - ",j)}),{contractSelect:P,contractsStore:s,getSelectFields:B,getInputFields:U,selectServerModel:N,isLoading:I,getButtonDisableCondition:W,getAdditionalServicesSchemes:q,getSelectFieldOptions:O,getDependOrders:j,DependOrderID:p,operationSystem:m,formData:i,finalPrice:d,payForOrder:z,filteredDependOrders:Z,serviceIP:w,isDepend:x}}},ka=te(ua,[["render",ca],["__scopeId","data-v-43c79838"]]);export{ka as S};
