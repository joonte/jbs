import{_ as q,r as O,h as W,i as z,o as _,c as D,a as u,t as p,m as Z,k,p as G,l as J,j as $,b as K,x as Y,w as ee,F as A,v as R,d as H,Y as ae,af as oe,f as te,e as ne,a7 as le,R as de,g as U}from"./index-c7c24b76.js";import{u as re}from"./contracts-397b53fe.js";import{u as ie}from"./services-78d5ede3.js";import{s as se}from"./multiselect-fa331d45.js";import{_ as ce}from"./ButtonDefault-626291b9.js";import{_ as ue}from"./BlockSelectContract-3401e3df.js";import{_ as _e}from"./ClausesKeeper-e7acf2fb.js";const De={props:{modelValue:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},name:{type:String,default:""},checkbox:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(l,{emit:f}){const i=O(null);function o(){f("update:modelValue",l.data)}return W(l,()=>{i.value=l.modelValue}),z(()=>{i.value=l.modelValue}),{updateValue:o,inputValue:i}}},fe=l=>(G("data-v-414dbe12"),l=l(),J(),l),ve={class:"form-input_border"},he=["checked","name","type"],Se={class:"form-input_border-content"},ye=fe(()=>u("span",{class:"form-input_border-mark"},null,-1)),ge={class:"form-input_border-item form-input_border-item--left"},be={class:"form-input_border-item form-input_border-item--right"};function ke(l,f,i,o,v,E){var V,r,C;return _(),D("label",ve,[u("input",{checked:((V=o.inputValue)==null?void 0:V.value)===((r=i.data)==null?void 0:r.value),name:i.name,type:i.checkbox?"checkbox":"radio",onInput:f[0]||(f[0]=(...g)=>o.updateValue&&o.updateValue(...g))},null,40,he),u("span",Se,[ye,u("span",ge,p((C=i.data)==null?void 0:C.name),1),i.data.price?Z(l.$slots,"default",{key:0},()=>{var g;return[u("span",be,p((g=i.data)==null?void 0:g.price),1)]},!0):k("",!0)])])}const Q=q(De,[["render",ke],["__scopeId","data-v-414dbe12"]]),X=l=>(G("data-v-b5a70153"),l=l(),J(),l),pe={key:0,class:"section"},Ie={class:"section-header"},Oe={class:"section-title"},Ve={key:2,class:"form-field form-field--basic"},Ce=X(()=>u("div",{class:"form-field__label"},[H("Выбрать заказ"),u("span",null,"*")],-1)),me={class:"form-field-input__wrapper"},Ne={class:"multiselect-option"},xe={class:"form-field form-field--basic"},Be={class:"form-field__label"},Fe={key:0},we={class:"form-field-input__wrapper"},je=["name","onUpdate:modelValue"],Ae={key:4,class:"section"},Ue={class:"list"},Ee={class:"list-col list-col--md"},Pe=X(()=>u("div",{class:"list-item__title"},[H("Тариф"),u("span",null,"*")],-1)),Me={key:5,class:"section"},Le={class:"list"},Te={class:"list-col list-col--md"},Re={class:"list-item__title"},We={key:0},He={key:6,class:"section"},Ke={class:"total-block block--divider"},Ye={class:"total-block__row total-block__row--big"},qe={class:"total-block__col"},ze={class:"total-block__col"},Ge={key:7,class:"additional-service__inline-price"};function Je(l,f,i,o,v,E){var m,I,M,L,N,w,x,j,B,T;const V=_e,r=ue,C=$("Multiselect"),g=Q,P=ce;return _(),D(A,null,[i.isInline?k("",!0):(_(),D("div",pe,[u("div",Ie,[u("h1",Oe,p((m=i.sectionData)==null?void 0:m.Item),1),K(V,{partition:`Header:${((I=i.sectionData)==null?void 0:I.Code)==="Default"?i.sectionID:`/${(M=i.sectionData)==null?void 0:M.Code}Orders`}`},null,8,["partition"])])])),i.isInline?k("",!0):(_(),Y(r,{key:1,class:"additional-service__contract-select",title:"Договор",modelValue:o.contractSelect,"onUpdate:modelValue":f[0]||(f[0]=n=>o.contractSelect=n)},null,8,["modelValue"])),((L=o.getDependOrders)==null?void 0:L.length)>0?(_(),D("div",Ve,[Ce,u("div",me,[K(C,{class:"multiselect--white",placeholder:"Все заказы",label:"name",disabled:((N=o.getDependOrders)==null?void 0:N.length)<=1,options:o.getDependOrders,modelValue:o.DependOrderID,"onUpdate:modelValue":f[1]||(f[1]=n=>o.DependOrderID=n)},{option:ee(({option:n})=>[u("div",Ne,p(n.name),1)]),_:1},8,["disabled","options","modelValue"])])])):k("",!0),((w=o.getInputFields)==null?void 0:w.length)>0?(_(!0),D(A,{key:3},R(o.getInputFields,n=>(_(),D("div",xe,[u("div",Be,[H(p(n==null?void 0:n.Name),1),n!=null&&n.IsDuty?(_(),D("span",Fe,"*")):k("",!0)]),u("div",we,[ae(u("input",{name:`ID${n==null?void 0:n.ID}`,"onUpdate:modelValue":S=>o.formData[`ID${n==null?void 0:n.ID}`]=S},null,8,je),[[oe,o.formData[`ID${n==null?void 0:n.ID}`]]])])]))),256)):k("",!0),((x=i.sectionData)==null?void 0:x.Code)!=="Default"&&((j=o.getAdditionalServicesSchemes)==null?void 0:j.length)>0?(_(),D("div",Ae,[u("div",Ue,[u("div",Ee,[Pe,(_(!0),D(A,null,R(o.getAdditionalServicesSchemes,n=>{var S,t;return _(),Y(g,{name:`${(S=i.sectionData)==null?void 0:S.Code}SchemeID`,checkbox:!1,data:n,modelValue:o.formData[`${(t=i.sectionData)==null?void 0:t.Code}SchemeID`],"onUpdate:modelValue":f[2]||(f[2]=a=>{var e;return o.formData[`${(e=i.sectionData)==null?void 0:e.Code}SchemeID`]=a})},null,8,["name","data","modelValue"])}),256))])])])):k("",!0),((B=o.getSelectFields)==null?void 0:B.length)>0?(_(),D("div",Me,[u("div",Le,[(_(!0),D(A,null,R(o.getSelectFields,n=>(_(),D("div",Te,[u("div",Re,[H(p(n==null?void 0:n.Name),1),n!=null&&n.IsDuty?(_(),D("span",We,"*")):k("",!0)]),(_(!0),D(A,null,R(o.getSelectFieldOptions(n),S=>(_(),Y(g,{name:`ID${n==null?void 0:n.ID}`,checkbox:!1,data:S,modelValue:o.formData[`ID${n==null?void 0:n.ID}`],"onUpdate:modelValue":t=>o.formData[`ID${n==null?void 0:n.ID}`]=t},null,8,["name","data","modelValue","onUpdate:modelValue"]))),256))]))),256))])])):k("",!0),i.isInline?(_(),D("div",Ge,p(o.finalPrice()||0)+" ₽",1)):(_(),D("div",He,[u("div",Ke,[u("div",Ye,[u("div",qe,"Итого за 1 "+p((T=i.sectionData)==null?void 0:T.Measure),1),u("div",ze,p(o.finalPrice()||0)+" ₽",1)])]),K(P,{class:"btn--wide",disabled:o.getButtonDisableCondition,label:"Заказать","is-loading":o.isLoading,onClick:f[3]||(f[3]=n=>o.payForOrder())},null,8,["disabled","is-loading"])]))],64)}const Qe={components:{InputBorderCheckboxRadio:Q,Multiselect:se},props:{modelValue:{type:Object,default:()=>{}},sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})},isInline:{type:Boolean,default:!1},updateWithPageTransition:{type:Boolean,default:!0}},emits:["updateList","update:modelValue"],setup(l,{emit:f}){const i=re(),o=ie(),v=te(),E=ne(),V=le(),r=O({}),C=O(null),g=O(null),P=O(null),m=O(null),I=O(!1);de("emitter");const M=U(()=>{var t,a;return(a=Object.keys((o==null?void 0:o.additionalServicesScheme[(t=l.sectionData)==null?void 0:t.Code])||{}))==null?void 0:a.map(e=>{var d,s,h,y,c,b,F;return{...o==null?void 0:o.additionalServicesScheme[(d=l.sectionData)==null?void 0:d.Code][e],value:(h=o==null?void 0:o.additionalServicesScheme[(s=l.sectionData)==null?void 0:s.Code][e])==null?void 0:h.ID,price:(c=o==null?void 0:o.additionalServicesScheme[(y=l.sectionData)==null?void 0:y.Code][e])==null?void 0:c.CostMonth,name:(F=o==null?void 0:o.additionalServicesScheme[(b=l.sectionData)==null?void 0:b.Code][e])==null?void 0:F.Name}}).sort((e,d)=>Number(e==null?void 0:e.SortID)<Number(d==null?void 0:d.SortID)?-1:Number(e==null?void 0:e.SortID)>Number(d==null?void 0:d.SortID)?1:0).filter(e=>e==null?void 0:e.IsActive)}),L=U(()=>{var a;let t=!1;return(a=w.value)==null||a.forEach(e=>{e!=null&&e.IsDuty&&(r.value[`ID${e==null?void 0:e.ID}`]===null||r.value[`ID${e==null?void 0:e.ID}`]===void 0||r.value[`ID${e==null?void 0:e.ID}`]==="")&&(t=!0)}),t}),N=U(()=>{var t;return(t=l.sectionData)==null?void 0:t.ServicesFields.filter(a=>(a==null?void 0:a.TypeID)==="Select").sort((a,e)=>Number(a==null?void 0:a.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(a==null?void 0:a.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),w=U(()=>{var t;return(t=l.sectionData)==null?void 0:t.ServicesFields.filter(a=>(a==null?void 0:a.TypeID)==="Input").sort((a,e)=>Number(a==null?void 0:a.SortID)<Number(e==null?void 0:e.SortID)?-1:Number(a==null?void 0:a.SortID)>Number(e==null?void 0:e.SortID)?1:0)}),x=U(()=>{var t;return(t=l.sectionData)==null?void 0:t.DependOrders.map(a=>{var e,d,s,h;return{...v==null?void 0:v.userOrders[a],name:((d=o.ServicesList[(e=v==null?void 0:v.userOrders[a])==null?void 0:e.ServiceID])==null?void 0:d.Code)+": "+((s=v==null?void 0:v.userOrders[a])==null?void 0:s.ID),value:(h=v==null?void 0:v.userOrders[a])==null?void 0:h.ID}})});function j(){var a;let t=0;return Object.keys(r.value).map(e=>{var d,s;(d=r.value[e])!=null&&d.price&&(t=t+Number((s=r.value[e])==null?void 0:s.price))}),t+Number((a=l.sectionData)==null?void 0:a.Cost)}function B(t){var a,e;return(e=(a=t==null?void 0:t.Options)==null?void 0:a.split(`
`))==null?void 0:e.map(d=>{let s=d.split("=");return{value:s[0],name:s[1],price:s[2]}})}function T(){var a;I.value=!0;let t={};(a=Object.keys(r.value))==null||a.forEach(e=>{var d,s;t[e]=(d=r.value[e])!=null&&d.value?(s=r.value[e])==null?void 0:s.value:r.value[e]}),t.ContractID=P.value,t.ServiceID=l.sectionID,o.ServiceOrder(t).then(({result:e,info:d,error:s})=>{var h;e==="SUCCESS"?o.ServiceOrderPay((h=l.sectionData)==null?void 0:h.Code,{AmountPay:"1",ServiceOrderID:d==null?void 0:d.ServiceOrderID,IsChange:!0}).then(y=>{let{result:c,error:b}=y;c==="SUCCESS"?E.push(`/AdditionalServices?ServiceID=${l.sectionID}`):c==="BASKET"&&E.push("/Basket"),I.value=!1}):I.value=!1})}function n(){var a;let t={};(a=Object.keys(r.value))==null||a.forEach(e=>{var d,s;t[e]=(d=r.value[e])!=null&&d.value?(s=r.value[e])==null?void 0:s.value:r.value[e]}),t.ServiceID=l.sectionID,t.Price=j(),f("update:modelValue",t)}function S(){var t,a;if(l.modelValue){const e=(t=Object.keys(l.modelValue))==null?void 0:t.find(d=>d.includes("SchemeID"));e&&((a=r.value[e])!=null&&a.ID||(r.value[e]={}),r.value[e].ID=l.modelValue[e])}}return W(V,()=>{var t,a,e,d,s,h,y;S(),l.updateWithPageTransition&&((t=N.value)==null||t.forEach(c=>{var b;r.value[`ID${c==null?void 0:c.ID}`]&&(r.value[`ID${c==null?void 0:c.ID}`]=(b=B(c))==null?void 0:b.find(F=>F.value===(c==null?void 0:c.Default)))}),((a=l.sectionData)==null?void 0:a.Code)!=="Default"&&o.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code),((s=(d=l.sectionData)==null?void 0:d.DependOrders)==null?void 0:s.length)>0&&(m.value=(y=(h=x.value)==null?void 0:h[0])==null?void 0:y.ID))}),W(r.value,()=>{n()}),W(l,()=>{S()}),z(()=>{var t,a,e,d,s,h,y;(t=N.value)==null||t.forEach(c=>{var b;r.value[`ID${c==null?void 0:c.ID}`]=(b=B(c))==null?void 0:b.find(F=>F.value===(c==null?void 0:c.Default))}),((a=l.sectionData)==null?void 0:a.Code)!=="Default"&&o.fetchAdditionalServiceScheme((e=l.sectionData)==null?void 0:e.Code),((s=(d=l.sectionData)==null?void 0:d.DependOrders)==null?void 0:s.length)>0&&(m.value=(y=(h=x.value)==null?void 0:h[0])==null?void 0:y.ID),S(),n()}),{contractSelect:P,contractsStore:i,getSelectFields:N,getInputFields:w,selectServerModel:C,isLoading:I,getButtonDisableCondition:L,getAdditionalServicesSchemes:M,getSelectFieldOptions:B,getDependOrders:x,DependOrderID:m,operationSystem:g,formData:r,finalPrice:j,payForOrder:T}}},na=q(Qe,[["render",Je],["__scopeId","data-v-b5a70153"]]);export{na as S};
