import{j as q,o as C,c as V,a as d,Z as N,a9 as H,b as l,w as I,d as U,t as k,F as Z,x as X,n as Y,k as de,_ as $,e as ee,S as te,r as R,h as ie,y as G,g as x,i as ue}from"./index-3af25d4c.js";import{u as _e}from"./dedicatedServer-3923330e.js";import{u as me}from"./contracts-4f21f7b6.js";import{I as fe}from"./IconSearch-94ee6723.js";import{_ as De}from"./HelperComponent-4ce50874.js";import{S as oe}from"./StatusBadge-b26344fd.js";import{I as ve}from"./IconRotate-5ee56c82.js";import{f as W}from"./useTimeFunction-8602dd60.js";import"./resetServer-70a43a67.js";import{f as ae,z as Se,k as ge,d as Ie}from"./bootstrap-vue-next.es-79941670.js";import{_ as he}from"./IconDots-9d28e553.js";import{_ as pe}from"./IconCard-816972fe.js";import{_ as we}from"./OrderIDBadge-7e4423f3.js";import{S as be}from"./Select2-d425d9a5.js";import{s as Oe}from"./multiselect-eb4b0170.js";import{_ as ne}from"./FormInputSearch-07638d27.js";import{B as se}from"./BlockBalanceAgreement-4b67da5f.js";import{u as Ce}from"./globalActions-83829f94.js";import{_ as ke,B as re}from"./IconButtonBack-13767f97.js";import{E as ye}from"./EmptyStateBlock-25904ff1.js";import{_ as Be}from"./ClausesKeeper-1519f453.js";import{_ as Le}from"./ButtonDefault-b95c906d.js";import"./IconArrow-7b47b2f8.js";import"./IconPlus-e0a4f3e2.js";import"./IconClose-f49a70b0.js";const Pe={class:"hosting-item"},Me={class:"hosting-item__row"},Re={class:"hosting-item__row"},Ue={class:"hosting-item__person"},Ve={key:0,class:"hosting-item__row"},xe={class:"hosting-item__list"},Ne=["innerHTML"],He={class:"hosting-status__info"},Te={class:"hosting-status__date"},je={class:"hosting-item__controls"},Ae={class:"btn btn--dots"};function Ee(u,o,n,e,h,B){var O,D,S,g,r,M,T,j,A,E,z,F;const p=ae,v=we,w=q("router-link"),y=q("Helper"),b=oe,L=pe,P=he,s=Se,_=ge,i=Ie;return C(),V("div",Pe,[d("div",Me,[N(l(p,{id:"checkbox-"+((O=n.itemData)==null?void 0:O.OrderID),modelValue:e.localSelectedRows[(D=n.itemData)==null?void 0:D.OrderID],"onUpdate:modelValue":o[0]||(o[0]=m=>{var f;return e.localSelectedRows[(f=n.itemData)==null?void 0:f.OrderID]=m}),name:"checkbox-"+((S=n.itemData)==null?void 0:S.OrderID),onChange:e.updateSelectedRows},null,8,["id","modelValue","name","onChange"]),[[H,n.isSeveral]]),l(v,{orderID:(g=n.itemData)==null?void 0:g.OrderID,onClick:o[1]||(o[1]=m=>{var f;return e.toItem((f=n.itemData)==null?void 0:f.OrderID)})},null,8,["orderID"]),l(w,{class:"hosting-item__name",to:`/DSOrders/${n.itemData.OrderID}`},{default:I(()=>[U(k(n.itemData.IP),1)]),_:1},8,["to"])]),d("div",Re,[d("div",Ue,k((r=n.itemData)==null?void 0:r.Customer),1),l(y,{"user-notice":(M=n.itemData)==null?void 0:M.UserNotice,id:(T=n.itemData)==null?void 0:T.OrderID,position:n.isLast?"bottom":"top",emit:"updateDSOrdersList"},null,8,["user-notice","id","position"])]),n.params.length?(C(),V("div",Ve,[d("ul",xe,[(C(!0),V(Z,null,X(n.params,m=>(C(),V("li",{innerHTML:m},null,8,Ne))),256))]),d("div",He,[d("div",{class:Y(["hosting-item__date",{danger:Number((j=n.itemData)==null?void 0:j.DaysRemainded)<14}])},k(e.calculateExpirationDate((A=n.itemData)==null?void 0:A.DaysRemainded))+" • "+k(((E=n.itemData)==null?void 0:E.DaysRemainded)||0)+" дн.",3),l(b,{class:"status-badge",status:(z=n.itemData)==null?void 0:z.StatusID,"status-table":"DSOrders",onClick:o[2]||(o[2]=m=>{var f;return e.openHistoryStatuses((f=n.itemData)==null?void 0:f.ID)})},null,8,["status"]),d("div",Te,k(e.calculateDaysSinceStatusUpdate((F=n.itemData)==null?void 0:F.StatusDate)),1)])])):de("",!0),d("div",je,[d("div",{class:"btn btn--md btn--bold",onClick:o[3]||(o[3]=m=>{var f;return u.$router.push(`/DSOrderPay/${(f=n.itemData)==null?void 0:f.OrderID}`)})},[l(L),U("Оплатить")]),l(i,{class:"dropdown-dots",right:""},{"button-content":I(()=>[d("div",Ae,[l(P)])]),default:I(()=>[l(s,null,{default:I(()=>{var m;return[l(w,{to:`DSOrders/${(m=n.itemData)==null?void 0:m.OrderID}`},{default:I(()=>[U("Дополнительная информация")]),_:1},8,["to"])]}),_:1}),l(s,{onClick:o[4]||(o[4]=m=>e.transferAccount())},{default:I(()=>[U("Передать на другой аккаунт")]),_:1}),l(_),l(s,{class:"color-red",onClick:o[5]||(o[5]=m=>e.deleteItem())},{default:I(()=>[U("Удалить")]),_:1})]),_:1})])])}const ze={components:{StatusBadge:oe,IconRotate:ve,Helper:De},props:{params:{type:Array,default:()=>[]},itemData:{type:Object,default:()=>{}},isLast:{type:Boolean,default:!1},isSeveral:{type:Boolean,default:!1},selectedRows:{type:Object,required:!0}},emits:["delete","transfer","manage"],setup(u,{emit:o}){const n=ee(),e=te("emitter"),h=R({...u.selectedRows}),B=()=>{o("update-selected-rows",h.value)};ie(()=>u.selectedRows,s=>{h.value={...s}},{deep:!0});function p(s){if(!s)return W(new Date);const _=new Date,i=new Date(_.getTime()+s*24*60*60*1e3);return W(i)}function v(s){n.push(`/DSOrders/${s}`)}function w(){var s;o("delete",(s=u.itemData)==null?void 0:s.ID)}function y(){var s,_;o("transfer",{ServiceOrderID:(s=u.itemData)==null?void 0:s.ID,ServiceID:(_=u.itemData)==null?void 0:_.ServiceID})}function b(s){e.emit("open-modal",{component:"StatusHistory",data:{modeID:"DSOrders",rowID:s}})}function L(){var s,_,i;o("manage",{ServiceOrderID:(s=u.itemData)==null?void 0:s.ID,ServiceID:(_=u.itemData)==null?void 0:_.ServiceID,OrderID:(i=u.itemData)==null?void 0:i.OrderID})}function P(s){if(!s)return"";const _=new Date(parseInt(s)*1e3),O=new Date-_,D=Math.floor(O/1e3),S=Math.floor(D/60),g=Math.floor(S/60),r=Math.floor(g/24);return D<60?`${D} сек. от статуса`:S<60?`${S} мин. от статуса`:g<24?`${g} ч. от статуса`:`${r} дн. от статуса`}return{deleteItem:w,orderManage:L,transferAccount:y,calculateExpirationDate:p,openHistoryStatuses:b,toItem:v,calculateDaysSinceStatusUpdate:P,localSelectedRows:h,updateSelectedRows:B}}},le=$(ze,[["render",Ee],["__scopeId","data-v-6b621171"]]),Fe={class:"section"},qe={class:"container"},Ge={class:"title__icon"},Ze={class:"btn__group"},Je={class:"group__several"},Ke={class:"list-form"},Qe={class:"list-form_col list-form_col--sm"},We={class:"list-form_select"},Xe={class:"multiselect-option"},Ye={key:0};function $e(u,o,n,e,h,B){var D,S,g;const p=se,v=ke,w=Le,y=q("router-link"),b=re,L=ae,P=Be,s=q("Multiselect"),_=ne,i=le,O=ye;return C(),V(Z,null,[l(p),d("div",Fe,[d("div",qe,[d("div",{class:Y(["section-header",e.isSeveral?"column":""])},[d("div",Ge,[d("h1",{class:"section-title",onClick:o[0]||(o[0]=r=>e.reloadNow())},k(e.isSeveral?"Продление услуг выделенных серверов":"Выделенные серверы"),1),N(l(v,{onClick:o[1]||(o[1]=r=>e.outSeveralOrders())},null,512),[[H,e.isSeveral]])]),N(d("div",Ze,[N(l(w,{class:"btn-several",label:"Продлить несколько заказов",onClick:o[2]||(o[2]=r=>e.prolongSeveralOrders())},null,512),[[H,e.getDSList.length>1]]),l(y,{class:"btn btn--blue btn-default",to:"DSSchemes"},{default:I(()=>[U("Заказать")]),_:1})],512),[[H,!e.isSeveral]]),N(d("div",Je,[l(b,{class:"contr period",modelValue:e.selectPeriod,"onUpdate:modelValue":o[3]||(o[3]=r=>e.selectPeriod=r)},null,8,["modelValue"]),l(L,{id:"checkbox-balance",modelValue:e.useBalance,"onUpdate:modelValue":o[4]||(o[4]=r=>e.useBalance=r),name:"checkbox-balance"},{default:I(()=>[U("Использовать средства с баланса")]),_:1},8,["modelValue"]),l(w,{label:"Продлить",onClick:o[5]||(o[5]=r=>e.prolongOrders())})],512),[[H,e.isSeveral]])],2),l(P,{partition:"Header:/DSOrders"}),d("div",Ke,[d("div",Qe,[d("div",We,[l(s,{modelValue:e.select,"onUpdate:modelValue":o[6]||(o[6]=r=>e.select=r),options:e.getUsers,disabled:((D=e.getUsers)==null?void 0:D.length)<=1,label:"name"},{singlelabel:I(({value:r})=>[d("span",null,"# "+k(r.value.padStart(5,"0"))+" / "+k(r.name),1)]),option:I(({option:r})=>[d("div",Xe,"# "+k(r.value.padStart(5,"0"))+" / "+k(r.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l(_,{modelValue:e.search,"onUpdate:modelValue":o[7]||(o[7]=r=>e.search=r)},null,8,["modelValue"])]),e.getDSList&&((S=e.getDSList)==null?void 0:S.length)>0?(C(),V("div",Ye,[e.filterProducts&&((g=e.filterProducts)==null?void 0:g.length)>0?(C(!0),V(Z,{key:0},X(e.filterProducts,(r,M)=>(C(),G(i,{params:e.getDSItemParam(r),"is-last":M===e.filterProducts.length-1,"item-data":r,isSeveral:e.isSeveral,"selected-rows":e.selectedRows,onUpdateSelectedRows:e.handleSelectedRowsUpdate,onDelete:e.deleteItem,onTransfer:e.transferItem,onManage:e.orderManage},null,8,["params","is-last","item-data","isSeveral","selected-rows","onUpdateSelectedRows","onDelete","onTransfer","onManage"]))),256)):(C(),G(O,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(C(),G(O,{key:1,class:"no-margin",label:"У Вас нет заказов на выделенные серверы"}))])])],64)}const et={components:{FormInputSearch:ne,IconSearch:fe,Select2:be,Multiselect:Oe,DSItem:le,BlockBalanceAgreement:se,BlockSelectPeriod:re},async setup(){const u=R("*"),o=R(null),n=Ce(),e=_e(),h=me(),B=ee(),p=R(!1),v=R([]),w=R(null),y=R(!1),b=te("emitter");b.on("updateDSOrdersList",()=>{e.fetchDSOrders()});const L=a=>{v.value=a};async function P(){console.log(v.value);const a=Object.keys(v.value).filter(c=>v.value[c]),t={ServiceID:"40000",ItemsPay:w.value,OrdersIDs:a,...y.value&&{UseBalance:"yes"}};await n.OrdersPay(t).then(c=>{c==="Basket"?(console.log("Success"),B.push("/Basket")):(c==null?void 0:c.Status)==="Ok"&&(p.value=!1,b.emit("open-modal",{component:"BalanceProlong",data:{Message:c==null?void 0:c.Message,Count:c==null?void 0:c.Count}}))})}function s(){p.value=!0}function _(){p.value=!1}const i=x(()=>{var a;return(a=Object.keys(e==null?void 0:e.DSList).map(t=>e==null?void 0:e.DSList[t]))==null?void 0:a.reverse()}),O=x(()=>e==null?void 0:e.DSSchemes),D=x(()=>h==null?void 0:h.contractsList),S=x(()=>e==null?void 0:e.DSOrderIPMI),g=x(()=>j(T(i.value)));ue(()=>{i.value.length<1&&M()});function r(){B.go(0)}function M(){B.push({path:"/DSSchemes"})}function T(a){return u.value!=="*"?a.filter(t=>(t==null?void 0:t.ContractID)===u.value):a}function j(a){return o.value!==null?a.filter(t=>(t==null?void 0:t.Customer.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.OrderID.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.Scheme.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.IP.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.disks.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.CPU.toLowerCase().includes(o.value.toLowerCase()))||(t==null?void 0:t.ram.toLowerCase().includes(o.value.toLowerCase()))):a}function A(a){n.OrderManage(a)}const E=x(()=>{let a=[{value:"*",name:"Все договора"}];return i.value!==null&&D.value!==null?(Object.keys(i.value).forEach(t=>{var c,J,K;a.find(ce=>{var Q;return ce.value===((Q=i.value[t])==null?void 0:Q.ContractID)})||a.push({value:(c=i.value[t])==null?void 0:c.ContractID,name:(K=D.value[(J=i.value[t])==null?void 0:J.ContractID])==null?void 0:K.Customer})}),a):{value:"*",name:"Все договора"}});function z(a){let t=F(a==null?void 0:a.SchemeID);t===void 0&&(t=a);let c=[];return a!=null&&a.Scheme&&c.push(a==null?void 0:a.Scheme),a!=null&&a.CPU&&c.push(a==null?void 0:a.CPU),t!=null&&t.ram&&c.push("RAM "+(t==null?void 0:t.ram)+" GB"),t!=null&&t.disks&&c.push(t==null?void 0:t.disks),t!=null&&t.CostMonth&&c.push("<b>"+(t==null?void 0:t.CostMonth)+"/ месяц</b>"),c}function F(a){var t;return(t=O.value)==null?void 0:t[a]}function m(a){b.emit("open-modal",{component:"DeleteItem",data:{id:a,message:"Вы действительно хотите удалить этот сервер?",tableID:"DSOrders",successEmit:"updateDSOrdersList"}})}function f(a){b.emit("open-modal",{component:"OrdersTransfer",data:a})}return await e.fetchDSOrders(),await e.fetchDSSchemes(),await e.fetchDSOrderIPMI(),await h.fetchContracts(),{getDSList:i,filterProducts:g,select:u,search:o,getUsers:E,getDSSchemes:O,getDSItemParam:z,getDSOrderIPMI:S,orderManage:A,deleteItem:m,transferItem:f,navigateToDSSchemes:M,reloadNow:r,prolongSeveralOrders:s,isSeveral:p,selectedRows:v,selectPeriod:w,prolongOrders:P,outSeveralOrders:_,useBalance:y,handleSelectedRowsUpdate:L}}},kt=$(et,[["render",$e],["__scopeId","data-v-0d8ea502"]]);export{kt as default};
