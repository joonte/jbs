import{C as se,F as ae}from"./bootstrap-vue-next.es-3f66213d.js";import{_ as le}from"./IconCard-57c0e3d6.js";import{S as ne}from"./StatusBadge-8575efce.js";import{_ as oe}from"./FormInputSearch-4bfb9224.js";import{_ as ue}from"./ClausesKeeper-e7acf2fb.js";import{_ as ce,e as ie,f as re,u as pe,R as ve,r as m,g as v,ag as T,o as G,c as H,b as c,a,w as o,t as u,L as g,k as de,F as me,p as _e,l as fe}from"./index-c7c24b76.js";import{u as be}from"./contracts-397b53fe.js";import{u as De}from"./services-78d5ede3.js";import{f as J}from"./useTimeFunction-8602dd60.js";import{_ as Se}from"./HelperComponent-71bfb594.js";import{s as k}from"./multiselect-fa331d45.js";import{B as ge}from"./BlockBalanceAgreement-f11c65ba.js";import"./IconPlus-64792f9f.js";import"./IconSearch-5d51b912.js";import"./IconClose-447d7f82.js";import"./ButtonDefault-626291b9.js";import"./IconArrow-dfacb3d4.js";const Ie=[{key:"ID",label:"Заказ",variant:"td-blue",sortable:!0},{key:"ServiceID",label:"Услуга",variant:"td-gray td-order bold"},{key:"ContractID",label:"Договор",sortable:!0,variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order"},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:"td-gray td-limited"},{key:"controls",label:"",variant:"td-controls"}];const i=I=>(_e("data-v-9994e8f0"),I=I(),fe(),I),he={class:"section"},Ce={class:"container"},ye=i(()=>a("div",{class:"section-header"},[a("h1",{class:"section-title"},"Мои заказы")],-1)),Ve={class:"list-form"},Oe={class:"list-form_col list-form_col--sm"},ke={class:"list-form_select"},xe={class:"multiselect-option"},we={class:"list-form_col list-form_col--sm"},Le={class:"list-form_select"},Re={class:"multiselect-option"},Te={class:"list-form_col list-form_col--sm"},Ue={class:"list-form_select"},Ee={class:"multiselect-option"},Ne=i(()=>a("span",{class:"td-mobile"},"Заказ",-1)),Ae=i(()=>a("span",{class:"td-mobile"},"Услуга",-1)),Be=i(()=>a("span",{class:"td-mobile"},"Договор",-1)),Fe=i(()=>a("span",{class:"td-mobile"},"Комментарий",-1)),$e=i(()=>a("span",{class:"td-mobile"},"Статус",-1)),Pe=i(()=>a("span",{class:"td-mobile"},"Дата окончания",-1)),je={class:"btn__group"},qe=["onClick"],ze=i(()=>a("p",null,"ОПЛАТИТЬ",-1)),Ge={key:0,class:"table-controls"},He=i(()=>a("span",{class:"text-success"},"First",-1)),Je=i(()=>a("span",{class:"text-info"},"Last",-1)),Ke={class:"multiselect-multiple-label"},Me={class:"multiselect-option"},Qe={__name:"Orders",async setup(I){let _,f;const h=ie(),r=re(),C=be(),U=De(),x=pe();ve("emitter").on("updateOrdersList",()=>{r.fetchUserOrders()});const w=m(""),b=m(10),S=m(1),K=m([10,25,50,100]),y=m("*"),V=m("*"),O=m("*"),d=v(()=>Object.keys(r==null?void 0:r.userOrders).map(s=>r==null?void 0:r.userOrders[s])),L=v(()=>{let s=d.value.filter(e=>e==null?void 0:e.ID.includes(w.value));return V.value!=="*"&&s!==null&&(s=s.filter(e=>e.ServiceID.includes(V.value))),y.value!=="*"&&s!==null&&(s=s.filter(e=>e.ContractID.includes(y.value))),O.value!=="*"&&s!==null&&(s=s.filter(e=>e.StatusID.includes(O.value))),S.value=1,s}),E=v(()=>C==null?void 0:C.contractsList);function M(s){if(!s)return J(new Date);const e=new Date,l=new Date(e.getTime()+s*24*60*60*1e3);return J(l)}const D=v(()=>U.ServicesList),N=v(()=>{let s=[{value:"*",name:"Все договора"}];return d.value!==null?(d.value.map(e=>{var l;s.find(p=>p.value===(e==null?void 0:e.ContractID))||s.push({value:e==null?void 0:e.ContractID,name:(l=E.value[e==null?void 0:e.ContractID])==null?void 0:l.Customer})}),s):{value:"*",name:"Все договора"}}),A=v(()=>{let s=[{value:"*",name:"Все услуги"}];return d.value!==null?(d.value.map(e=>{var l;s.find(p=>p.value===(e==null?void 0:e.ServiceID))||s.push({value:e==null?void 0:e.ServiceID,name:(l=D.value[e==null?void 0:e.ServiceID])==null?void 0:l.NameShort})}),s):{value:"*",name:"Все услуги"}}),Q=v(()=>{var s,e;return(e=(s=x==null?void 0:x.ConfigList)==null?void 0:s.Statuses)==null?void 0:e.Orders}),B=v(()=>{let s=[{value:"*",name:"Все статусы"}];return d.value!==null?(d.value.map(e=>{var l,p;s.find(R=>R.value===(e==null?void 0:e.StatusID))||s.push({value:e==null?void 0:e.StatusID,name:((p=(l=Q.value)==null?void 0:l[e==null?void 0:e.StatusID])==null?void 0:p.Name)||(e==null?void 0:e.StatusID)})}),s):{value:"*",name:"Все статусы"}});function W(s){var e,l;return((e=D.value[s])==null?void 0:e.Code)!=="Default"?((l=D.value[s])==null?void 0:l.Code)+"Orders":"Orders"}function X(s){var l;let e=(l=D.value[s.ServiceID])==null?void 0:l.Code;e==="Default"?h.push(`/AdditionalServices/${s.ID}`):h.push(`/${e}Orders/${s.ID}`)}function Y(s){var l;let e=(l=D.value[s.ServiceID])==null?void 0:l.Code;e==="Default"?h.push(`/ServiceOrderPay/${s.ID}`):h.push(`/${e}OrderPay/${s.ID}`)}return[_,f]=T(()=>r.fetchUserOrders()),await _,f(),[_,f]=T(()=>C.fetchContracts()),await _,f(),[_,f]=T(()=>U.fetchServices()),await _,f(),(s,e)=>{var F,$,P,j,q;const l=ue,p=oe,R=ne,Z=le,ee=se,te=ae;return G(),H(me,null,[c(ge),a("div",he,[a("div",Ce,[ye,c(l),a("div",Ve,[c(p,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t)},null,8,["modelValue"]),a("div",Oe,[a("div",ke,[c(g(k),{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),options:N.value,disabled:((F=N.value)==null?void 0:F.length)<=1,label:"name"},{option:o(({option:t})=>[a("div",xe,"# "+u(t.value.padStart(5,"0"))+" / "+u(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",we,[a("div",Le,[c(g(k),{modelValue:O.value,"onUpdate:modelValue":e[2]||(e[2]=t=>O.value=t),options:B.value,disabled:(($=B.value)==null?void 0:$.length)<=1,label:"name"},{option:o(({option:t})=>[a("div",Re,u(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",Te,[a("div",Ue,[c(g(k),{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=t=>V.value=t),options:A.value,disabled:((P=A.value)==null?void 0:P.length)<=1,label:"name"},{option:o(({option:t})=>[a("div",Ee,u(t.name),1)]),_:1},8,["modelValue","options","disabled"])])])]),c(ee,{class:"basic-table",fields:g(Ie),items:L.value,"show-empty":!0,"per-page":b.value,responsive:"","current-page":S.value,"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onRowClicked:X},{"cell(ID)":o(t=>[Ne,a("span",null,u(t.value),1)]),"cell(ServiceID)":o(t=>{var n;return[Ae,a("span",null,u((n=D.value[t.value])==null?void 0:n.NameShort),1)]}),"cell(ContractID)":o(t=>{var n;return[Be,a("span",null,u((n=E.value[t.value])==null?void 0:n.Customer),1)]}),"cell(UserNotice)":o(t=>{var n;return[Fe,c(Se,{"user-notice":t.value,id:(n=t.item)==null?void 0:n.ID,emit:"updateOrdersList"},null,8,["user-notice","id"])]}),"cell(StatusID)":o(t=>{var n;return[$e,c(R,{status:t.value,"status-table":W((n=t.item)==null?void 0:n.ServiceID)},null,8,["status","status-table"])]}),"cell(ExpirationDate)":o(t=>{var n,z;return[Pe,a("span",null,u(M((n=t.item)==null?void 0:n.DaysRemainded))+" | "+u(((z=t.item)==null?void 0:z.DaysRemainded)||0)+" дн.",1)]}),"cell(controls)":o(t=>[a("div",je,[a("button",{class:"btn btn-default btn--border",onClick:n=>Y(t.item)},[c(Z),ze],8,qe)])]),_:1},8,["fields","items","per-page","current-page"]),((j=L.value)==null?void 0:j.length)>0?(G(),H("div",Ge,[c(te,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=t=>S.value=t),"total-rows":(q=L.value)==null?void 0:q.length,"per-page":b.value,"first-number":"","last-number":""},{"first-text":o(()=>[He]),"last-text":o(()=>[Je]),page:o(({page:t,active:n})=>[a("span",null,u((t-1)*b.value+1)+"-"+u(t*b.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),c(g(k),{class:"multiselect--white",modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=t=>b.value=t),options:K.value,label:"name",openDirection:"top",onInput:e[6]||(e[6]=t=>S.value=1)},{singlelabel:o(({value:t})=>[a("div",Ke,[a("span",null,"Отображать "+u(t.value)+" строк",1)])]),option:o(({option:t})=>[a("div",Me,"Отображать "+u(t.name)+" строк",1)]),_:1},8,["modelValue","options"])])):de("",!0)])])],64)}}},mt=ce(Qe,[["__scopeId","data-v-9994e8f0"]]);export{mt as default};
