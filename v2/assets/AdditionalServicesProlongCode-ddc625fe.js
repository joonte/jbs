import{E as ne}from"./EmptyStateBlock-9f752916.js";import{_ as ie}from"./BlockOrderPayBalance-e0feb4e8.js";import{_ as re}from"./ClausesKeeper-eb954229.js";import{_ as de}from"./ButtonDefault-7c216fc6.js";import{_ as _e,a7 as ue,e as ve,r as ee,g as B,h as oe,O as pe,ag as P,o as r,c as d,b as _,a as o,t as i,F as C,x as me,Z as se,ae as te,k as he,p as be,l as ke}from"./index-5e313302.js";import{u as ye}from"./contracts-3351d68f.js";import{u as Se}from"./services-21abfb71.js";/* empty css                                                                             */import{B as fe}from"./BlockBalanceAgreement-bb87adc1.js";import"./bootstrap-vue-next.es-a19a8b41.js";import"./IconHelp-37cb81ff.js";import"./globalActions-a7429ad5.js";import"./BasicInput-be1c88a0.js";import"./component-6a5a025c.js";import"./IconClose-1f889a2e.js";import"./IconArrow-555f9d45.js";const ae=S=>(be("data-v-2b6f4937"),S=S(),ke(),S),Ie={key:0,class:"hosting-sheme"},ge={class:"section"},we={class:"container"},De={class:"section-header"},Be={class:"section-header__wrapper"},Pe={class:"section-title"},Ce={class:"section-label"},Oe={key:0,class:"section"},Ee={class:"container"},xe={class:"total-block"},Ne={class:"total-block__row divider-bottom"},Ae=ae(()=>o("div",{class:"total-block__col"},"Цена тарифа",-1)),Le={class:"total-block__col"},Fe={class:"total-block__row no-divider"},Re={class:"total-block__col"},Ue={class:"total-block__col"},Me={class:"total-block__row total-block__row--big economy-line"},Ve=ae(()=>o("div",{class:"total-block__col red"},"Выгода",-1)),$e={class:"total-block__col flex-col"},je={class:"red"},Ke={class:"total-block__row total-block__row--big"},Te={class:"total-block__col"},qe={class:"total-block__col"},Ze={key:1,class:"section"},ze={class:"container"},Ge={key:1,class:"section"},He={class:"container"},Je={__name:"AdditionalServicesProlongCode",async setup(S){let u,v;const O=ye(),a=Se(),le=ue(),E=ve(),s=ee(null),f=ee(!1),c=B(()=>Object.keys(a==null?void 0:a.ISPswOrdersList).map(t=>a==null?void 0:a.ISPswOrdersList[t]).find(t=>t.OrderID===le.params.id)),x=t=>{t.key==="Enter"&&t.ctrlKey&&D()};oe(()=>{document.addEventListener("keyup",x)}),pe(()=>{document.removeEventListener("keyup",x)});const m=B(()=>{var t;return(t=a==null?void 0:a.additionalServicesScheme)!=null&&t.ISPsw?Object.keys(a.additionalServicesScheme.ISPsw).map(l=>{const e=a.additionalServicesScheme.ISPsw[l];return{...e,value:e==null?void 0:e.ID,name:e==null?void 0:e.Name,cost:e==null?void 0:e.CostDay,month:e==null?void 0:e.CostMonth}}).filter(l=>{var e;return(l==null?void 0:l.ID)==((e=c.value)==null?void 0:e.SchemeID)}):[]}),w=B(()=>O.contractsList);function D(){var p,g,h,b,k;f.value=!0;const t=((p=w.value[c.ContractID])==null?void 0:p.Balance)>((g=s==null?void 0:s.value)==null?void 0:g.price)||((h=m.value[0])==null?void 0:h.cost)==="0.00"&&((b=m.value[0])==null?void 0:b.month)==="0.00",l=!t,e={ISPswOrderID:c.value.ID,DaysPay:(k=s.value)==null?void 0:k.actualDays,IsNoBasket:t,IsUseBasket:l,PayMessage:""};a.ISPswOrderPay(e).then(y=>{y==="UseBasket"?E.push("/Basket"):y==="NoBasket"?E.push("/AdditionalServices"):console.error("Ошибка оплаты заказа"),f.value=!0})}function I(t){return Number(t).toFixed(2)||0}function N(){var l,e;let t=0;return(e=(l=s.value)==null?void 0:l.discounts)==null||e.Bonuses.map(p=>{t+=+p.Economy}),t}function ce(t){s.value=t}return oe(()=>{a.fetchAdditionalServiceScheme("ISPsw"),console.log("Orders ",c),console.log("Scheme ",m[0])}),[u,v]=P(()=>a.fetchISPswOrders()),await u,v(),[u,v]=P(()=>a.fetchAdditionalServiceScheme("ISPsw")),await u,v(),[u,v]=P(()=>O.fetchContracts()),await u,v(),(t,l)=>{var b,k,y,A,L,F,R,U,M,V,$,j,K,T,q,Z,z,G,H,J,Q,W,X,Y;const e=de,p=re,g=ie,h=ne;return r(),d(C,null,[_(fe),c.value?(r(),d("div",Ie,[o("div",ge,[o("div",we,[o("div",De,[o("div",Be,[o("h1",Pe,"Оплата заказа ПО ISPsystem, "+i(((b=c.value)==null?void 0:b.IP)||""),1),_(e,{class:"btn--wide",label:((k=w.value[c.value.ContractID])==null?void 0:k.Balance)>((y=s.value)==null?void 0:y.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||((A=s.value)==null?void 0:A.price)===null,"is-loading":f.value,onClick:l[0]||(l[0]=n=>D())},null,8,["label","disabled","is-loading"])]),o("div",Ce,i((L=m.value[0])==null?void 0:L.Name),1)])]),_(p)]),_(g,{contractID:(F=c.value)==null?void 0:F.ContractID,daysRemainded:(R=c.value)==null?void 0:R.DaysRemainded,serviceID:"51000",scheme:m.value[0],orderID:(U=c.value)==null?void 0:U.OrderID,isOrderID:!0,onSelect:ce},null,8,["contractID","daysRemainded","scheme","orderID"]),c.value?(r(),d("div",Oe,[o("div",Ee,[o("div",xe,[(($=(V=(M=s.value)==null?void 0:M.discounts)==null?void 0:V.Bonuses)==null?void 0:$.length)>0?(r(),d(C,{key:0},[o("div",Ne,[Ae,o("div",Le,i(I((j=s.value)==null?void 0:j.price))+" ₽",1)]),(r(!0),d(C,null,me((T=(K=s.value)==null?void 0:K.discounts)==null?void 0:T.Bonuses,n=>(r(),d("div",Fe,[o("div",Re,"Скидка "+i(n==null?void 0:n.Discount)+"% на "+i(n==null?void 0:n.Days)+" дней",1),o("div",Ue,"-"+i(I(n==null?void 0:n.Economy))+" ₽",1)]))),256)),se(o("div",Me,[Ve,o("div",$e,[o("span",null,[o("s",null,i(I((q=s.value)==null?void 0:q.price))+" ₽",1)]),o("span",je,"-"+i(N())+" ₽",1)])],512),[[te,((G=(z=(Z=s.value)==null?void 0:Z.discounts)==null?void 0:z.Bonuses)==null?void 0:G.length)>0]]),se(o("div",Ke,[o("div",Te,"Итого за "+i((H=s.value)==null?void 0:H.label),1),o("div",qe,i(I(((J=s.value)==null?void 0:J.price)-N()))+" ₽",1)],512),[[te,(Q=s.value)==null?void 0:Q.price]])],64)):he("",!0)]),_(e,{class:"btn--wide",label:((W=w.value[c.value.ContractID])==null?void 0:W.Balance)>((X=s.value)==null?void 0:X.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||((Y=s.value)==null?void 0:Y.price)===null,"is-loading":f.value,onClick:l[1]||(l[1]=n=>D())},null,8,["label","disabled","is-loading"])])])):(r(),d("div",Ze,[o("div",ze,[_(h,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),d("div",Ge,[o("div",He,[_(h,{label:"не удалось найти заказ хостинга"})])]))],64)}}},vo=_e(Je,[["__scopeId","data-v-2b6f4937"]]);export{vo as default};
