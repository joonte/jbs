import{C as ie,F as ce}from"./bootstrap-vue-next.es-c6bcf011.js";import{_ as re}from"./IconCard-47752060.js";import{S as de}from"./StatusBadge-ca078fa4.js";import{_ as pe}from"./FormInputSearch-9fb2a00d.js";import{_ as ve}from"./ClausesKeeper-90c650cc.js";import{_ as me,e as _e,f as fe,g as De,u as be,U as Se,r as _,h as m,i as Ie,ah as $,o as K,c as Q,b as c,a,w as o,t as u,N as k,n as ge,l as he,F as ye,p as Ce,m as Oe}from"./index-aeb1df1e.js";import{u as ke}from"./IconArrow-a6c91ada.js";import{u as Ve}from"./services-bb78f548.js";import{f as W}from"./useTimeFunction-8602dd60.js";import{_ as xe}from"./HelperComponent-470cfccf.js";import{s as U}from"./multiselect-3fbc9d28.js";import{B as Ne}from"./BlockBalanceAgreement-906c1168.js";import"./IconPlus-3baf194c.js";import"./IconSearch-4ea59048.js";import"./IconClose-c7c36336.js";import"./ButtonDefault-11c4541b.js";const Re=[{key:"ID",label:"Заказ",variant:"td-blue",sortable:!0},{key:"ServiceID",label:"Услуга",variant:"td-gray td-order bold"},{key:"SchemeName",label:"Тариф",variant:"td-gray td-order"},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"td-gray td-order"},{key:"ContractID",label:"Договор",sortable:!0,variant:"td-blue"},{key:"UserNotice",label:"Примечание",variant:"td-gray td-limited"},{key:"controls",label:"",variant:"td-controls"}];const r=V=>(Ce("data-v-4a3dd343"),V=V(),Oe(),V),Ue={class:"section"},we={class:"container"},Ee={class:"section-header"},Le={class:"list-form"},Te={class:"list-form_col list-form_col--sm"},$e={class:"list-form_select"},Ae={class:"multiselect-option"},Be={class:"list-form_col list-form_col--sm"},Fe={class:"list-form_select"},Pe={class:"multiselect-option"},qe={class:"list-form_col list-form_col--sm"},je={class:"list-form_select"},He={class:"multiselect-option"},ze=r(()=>a("span",{class:"td-mobile"},"Заказ",-1)),Me=r(()=>a("span",{class:"td-mobile"},"Услуга",-1)),Ge=r(()=>a("span",{class:"td-mobile"},"Тариф",-1)),Je=r(()=>a("span",{class:"td-mobile"},"Дата окончания",-1)),Ke=r(()=>a("span",{class:"td-mobile"},"Статус",-1)),Qe=r(()=>a("span",{class:"td-mobile"},"Договор",-1)),We=r(()=>a("span",{class:"td-mobile"},"Комментарий",-1)),Xe={class:"btn__group"},Ye=["onClick"],Ze=r(()=>a("p",null,"ОПЛАТИТЬ",-1)),et={key:0,class:"table-controls"},tt=r(()=>a("span",{class:"text-success"},"First",-1)),st=r(()=>a("span",{class:"text-info"},"Last",-1)),at={class:"multiselect-multiple-label"},lt={class:"multiselect-option"},nt={__name:"Orders",async setup(V){let f,D;const g=_e(),h=fe(),p=De(),x=ke(),A=Ve(),w=be(),B=Se("emitter");B.on("updateOrdersList",()=>{p.fetchUserOrders()});const E=_(""),b=_(10),y=_(1),X=_([10,25,50,100]),C=_("*"),N=_("*"),R=_("*"),v=m(()=>Object.keys(p==null?void 0:p.userOrders).map(s=>p==null?void 0:p.userOrders[s])),L=m(()=>{let s=v.value.filter(e=>e==null?void 0:e.ID.includes(E.value));return N.value!=="*"&&s!==null&&(s=s.filter(e=>e.ServiceID.includes(N.value))),C.value!=="*"&&s!==null&&(s=s.filter(e=>e.ContractID.includes(C.value))),R.value!=="*"&&s!==null&&(s=s.filter(e=>e.StatusID.includes(R.value))),y.value=1,s}),T=m(()=>x==null?void 0:x.contractsList);function Y(){g.go(0)}function Z(s){if(!s)return W(new Date);const e=new Date,l=new Date(e.getTime()+s*24*60*60*1e3);return W(l)}const S=m(()=>A.ServicesList);function ee(s,e){let l="";e==="Default"?l="Orders":l=e+"Orders",B.emit("open-modal",{component:"StatusHistory",data:{modeID:l,rowID:s}})}const F=m(()=>{let s=[{value:"*",name:"Все договора"}];return v.value!==null?(v.value.map(e=>{var l;s.find(i=>i.value===(e==null?void 0:e.ContractID))||s.push({value:e==null?void 0:e.ContractID,name:(l=T.value[e==null?void 0:e.ContractID])==null?void 0:l.Customer})}),s):{value:"*",name:"Все договора"}}),P=m(()=>{let s=[{value:"*",name:"Все услуги"}];return v.value!==null?(v.value.map(e=>{var l;s.find(i=>i.value===(e==null?void 0:e.ServiceID))||s.push({value:e==null?void 0:e.ServiceID,name:(l=S.value[e==null?void 0:e.ServiceID])==null?void 0:l.NameShort})}),s):{value:"*",name:"Все услуги"}}),te=m(()=>{var s,e;return(e=(s=w==null?void 0:w.ConfigList)==null?void 0:s.Statuses)==null?void 0:e.Orders}),q=m(()=>{let s=[{value:"*",name:"Все статусы"}];return v.value!==null?(v.value.map(e=>{var l,i;s.find(d=>d.value===(e==null?void 0:e.StatusID))||s.push({value:e==null?void 0:e.StatusID,name:((i=(l=te.value)==null?void 0:l[e==null?void 0:e.StatusID])==null?void 0:i.Name)||(e==null?void 0:e.StatusID)})}),s):{value:"*",name:"Все статусы"}});function se(s){var e,l;return((e=S.value[s])==null?void 0:e.Code)!=="Default"?((l=S.value[s])==null?void 0:l.Code)+"Orders":"Orders"}function ae(s,e,l){var i;if(!l.target.closest("button, a, .clickable-element")){let d=(i=S.value[s.ServiceID])==null?void 0:i.Code;d==="Default"||d==="ExtraIP"||d==="ISPsw"||d==="DNSmanager"?g.push(`/AdditionalServices/${s.ID}`):g.push(`/${d}Orders/${s.ID}`)}}function le(s){var l;let e=(l=S.value[s.ServiceID])==null?void 0:l.Code;e==="Default"?g.push(`/ServiceOrderPay/${s.ID}`):g.push(`/${e}OrderPay/${s.ID}`)}return Ie(()=>{var s,e,l;(s=h.query)!=null&&s.contractID&&(C.value=(e=h.query)==null?void 0:e.contractID),console.log((l=h.query)==null?void 0:l.contractID)}),[f,D]=$(()=>p.fetchUserOrders().then(()=>{var s,e;(s=h.params)!=null&&s.id&&((e=v.value)==null||e.find(l=>{var i;return l.ID===((i=h.params)==null?void 0:i.id)}))})),await f,D(),[f,D]=$(()=>x.fetchContracts()),await f,D(),[f,D]=$(()=>A.fetchServices()),await f,D(),(s,e)=>{var j,H,z,M,G;const l=ve,i=pe,d=de,ne=re,oe=ie,ue=ce;return K(),Q(ye,null,[c(Ne),a("div",Ue,[a("div",we,[a("div",Ee,[a("h1",{class:"section-title",onClick:e[0]||(e[0]=t=>Y())},"Мои заказы")]),c(l),a("div",Le,[c(i,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=t=>E.value=t)},null,8,["modelValue"]),a("div",Te,[a("div",$e,[c(k(U),{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),options:F.value,disabled:((j=F.value)==null?void 0:j.length)<=1,label:"name"},{singlelabel:o(({value:t})=>[a("span",null,"# "+u(t.value.padStart(5,"0"))+" / "+u(t.name),1)]),option:o(({option:t})=>[a("div",Ae,"# "+u(t.value.padStart(5,"0"))+" / "+u(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",Be,[a("div",Fe,[c(k(U),{modelValue:R.value,"onUpdate:modelValue":e[3]||(e[3]=t=>R.value=t),options:q.value,disabled:((H=q.value)==null?void 0:H.length)<=1,label:"name"},{option:o(({option:t})=>[a("div",Pe,u(t.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a("div",qe,[a("div",je,[c(k(U),{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=t=>N.value=t),options:P.value,disabled:((z=P.value)==null?void 0:z.length)<=1,label:"name"},{option:o(({option:t})=>[a("div",He,u(t.name),1)]),_:1},8,["modelValue","options","disabled"])])])]),c(oe,{class:"basic-table",fields:k(Re),items:L.value,"show-empty":!0,"per-page":b.value,responsive:"","current-page":y.value,"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onRowClicked:ae},{"cell(ID)":o(t=>[ze,a("span",null,u(t.value),1)]),"cell(ServiceID)":o(t=>{var n;return[Me,a("span",null,u((n=S.value[t.value])==null?void 0:n.NameShort),1)]}),"cell(SchemeName)":o(t=>{var n;return[Ge,a("span",null,u((n=t.item)==null?void 0:n.SchemeName),1)]}),"cell(ExpirationDate)":o(t=>{var n,I,O;return[Je,a("span",{class:ge({danger:Number((n=t.item)==null?void 0:n.DaysRemainded)<14})},u(Z((I=t.item)==null?void 0:I.DaysRemainded))+" | "+u(((O=t.item)==null?void 0:O.DaysRemainded)||0)+" дн.",3)]}),"cell(StatusID)":o(t=>{var n;return[Ke,c(d,{class:"clickable-element",status:t.value,"status-table":se((n=t.item)==null?void 0:n.ServiceID),onClick:I=>{var O,J;return ee((O=t.item)==null?void 0:O.ServiceOrderID,(J=t.item)==null?void 0:J.Code)}},null,8,["status","status-table","onClick"])]}),"cell(ContractID)":o(t=>{var n,I;return[Qe,a("span",null,"#"+u((n=T.value[t.value])==null?void 0:n.ID)+" / "+u((I=T.value[t.value])==null?void 0:I.Customer),1)]}),"cell(UserNotice)":o(t=>{var n;return[We,c(xe,{"user-notice":t.value,id:(n=t.item)==null?void 0:n.ID,emit:"updateOrdersList"},null,8,["user-notice","id"])]}),"cell(controls)":o(t=>[a("div",Xe,[a("button",{class:"btn btn-default btn--border",onClick:n=>le(t.item)},[c(ne),Ze],8,Ye)])]),_:1},8,["fields","items","per-page","current-page"]),((M=L.value)==null?void 0:M.length)>0?(K(),Q("div",et,[c(ue,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=t=>y.value=t),"total-rows":(G=L.value)==null?void 0:G.length,"per-page":b.value,"first-number":"","last-number":""},{"first-text":o(()=>[tt]),"last-text":o(()=>[st]),page:o(({page:t,active:n})=>[a("span",null,u((t-1)*b.value+1)+"-"+u(t*b.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),c(k(U),{class:"multiselect--white",modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=t=>b.value=t),options:X.value,label:"name",openDirection:"top",onInput:e[7]||(e[7]=t=>y.value=1)},{singlelabel:o(({value:t})=>[a("div",at,[a("span",null,"Отображать "+u(t.value)+" строк",1)])]),option:o(({option:t})=>[a("div",lt,"Отображать "+u(t.name)+" строк",1)]),_:1},8,["modelValue","options"])])):he("",!0)])])],64)}}},ht=me(nt,[["__scopeId","data-v-4a3dd343"]]);export{ht as default};
