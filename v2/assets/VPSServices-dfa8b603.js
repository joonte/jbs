import{k as Z,o as c,c as u,b as v,a as s,t as S,l as A,w as M,d as j,F as T,y as H,z as G,p as $,m as ee,_ as te,f as oe,e as se,g as re,U as ae,r as U,h as y,i as ne}from"./index-aeb1df1e.js";import{u as de}from"./vps-31dc9173.js";import{u as le}from"./services-bb78f548.js";import{u as ce}from"./resetServer-1c71747e.js";import{B as q}from"./BlockBalanceAgreement-906c1168.js";import{B as z}from"./BlockAdditionalServices-3f8c8032.js";import{E as K}from"./EmptyStateBlock-b0a120e4.js";import{_ as X}from"./ButtonDefault-11c4541b.js";import{S as J}from"./StatusBadge-ca078fa4.js";import{_ as ie}from"./ClausesKeeper-90c650cc.js";import"./IconArrow-a6c91ada.js";import"./bootstrap-vue-next.es-c6bcf011.js";import"./ServiceListOrderSelection-8635e3a9.js";import"./domain-0f1019af.js";import"./multiselect-3fbc9d28.js";import"./BasicInput-67b26a5e.js";import"./component-60ac2998.js";import"./BlockSelectContract-9de95b8e.js";import"./IconClose-c7c36336.js";const w=p=>($("data-v-2ee3ff2d"),p=p(),ee(),p),_e={class:"section"},ue={class:"container"},Se={class:"section-header"},me=w(()=>s("h1",{class:"section-title"},"Дополнительные услуги",-1)),fe={key:0,class:"section-label"},ve={class:"section-nav"},pe={key:0,class:"section-body"},he=w(()=>s("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),De={class:"ordered-services-list"},Ie={class:"ordered-service-header"},ge={class:"ordered-service-name"},ke={class:"ordered-service-status"},ye={class:"ordered-service-details"},Oe={class:"ordered-service-info"},be={key:0},Pe={class:"ordered-service-actions"},Ce={class:"section-body"},Ve={key:2,class:"loading"},Ee={key:0,class:"section"},Re={class:"container"},Ae={class:"total-block"},we={class:"total-block__row"},Be=w(()=>s("div",{class:"total-block__col"},"Дополнительные услуги",-1)),Ne={class:"total-block__col"},Le={class:"total-block__row no-divider"},xe={class:"total-block__col"},Te={class:"total-block__col"},Ue={class:"total-block__row total-block__row--big"},Fe=w(()=>s("div",{class:"total-block__col"},"Итого к оплате",-1)),Me={class:"total-block__col"};function je(p,_,d,t,m,h){var V,E,R;const l=q,O=Z("router-link"),b=ie,i=J,P=X,B=z,D=K;return c(),u(T,null,[v(l),s("div",_e,[s("div",ue,[s("div",Se,[me,t.getVPSData?(c(),u("div",fe,"VPS/VDS сервер # "+S((V=t.getVPSData)==null?void 0:V.OrderID),1)):A("",!0),s("div",ve,[v(O,{class:"section-nav__item",to:`/VPSOrders/${(E=t.getVPSData)==null?void 0:E.OrderID}`},{default:M(()=>[j("Сервер")]),_:1},8,["to"]),v(O,{class:"section-nav__item active",to:`/VPSServices/${(R=t.getVPSData)==null?void 0:R.OrderID}`},{default:M(()=>[j("Услуги")]),_:1},8,["to"])])]),v(b),t.orderedServices&&t.orderedServices.length>0?(c(),u("div",pe,[he,s("div",De,[(c(!0),u(T,null,H(t.orderedServices,e=>{var f;return c(),u("div",{class:"ordered-service-item",key:e.ID},[s("div",Ie,[s("div",ge,S(((f=t.getServices[e==null?void 0:e.ServiceID])==null?void 0:f.Name)||(e==null?void 0:e.ServiceName)||`Услуга #${e==null?void 0:e.ServiceID}`),1),s("div",ke,[v(i,{status:e==null?void 0:e.StatusID,"status-table":"Orders",onClick:N=>t.openHistoryStatuses(e==null?void 0:e.ID,e==null?void 0:e.ServiceID)},null,8,["status","onClick"])])]),s("div",ye,[s("div",Oe,[s("span",null,"Заказ # "+S(e==null?void 0:e.ID),1),e!=null&&e.DaysRemainded?(c(),u("span",be,"| Осталось дней: "+S(e==null?void 0:e.DaysRemainded),1)):A("",!0)])]),s("div",Pe,[v(P,{class:"btn--sm",label:"Перейти к заказу",onClick:N=>t.navigateToService(e==null?void 0:e.ID)},null,8,["onClick"])])])}),128))])])):A("",!0),s("div",Ce,[t.getVPSData&&t.serviceSearchParams?(c(),G(B,{key:0,modelValue:t.selectedServices,"onUpdate:modelValue":[_[0]||(_[0]=e=>t.selectedServices=e),t.handleServicesUpdate],"service-search-params":t.serviceSearchParams},null,8,["modelValue","service-search-params","onUpdate:modelValue"])):t.isLoading?(c(),u("div",Ve,"Загрузка...")):(c(),G(D,{key:1,label:"Заказ не найден"}))])])]),t.selectedServices&&t.selectedServices.length>0?(c(),u("div",Ee,[s("div",Re,[s("div",Ae,[s("div",we,[Be,s("div",Ne,S(t.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(c(!0),u(T,null,H(t.selectedServices,e=>{var f;return c(),u("div",Le,[s("div",xe,S((f=t.getServices[e==null?void 0:e.ServiceID])==null?void 0:f.Name),1),s("div",Te,S(t.setToFixedService(e==null?void 0:e.Price))+" ₽",1)])}),256)),s("div",Ue,[Fe,s("div",Me,S(t.ADDITIONAL_SERVICES_PRICE)+" ₽",1)])]),v(P,{class:"btn--wide",disabled:!t.selectedServices||t.selectedServices.length===0||t.isOrderLoading,"is-loading":t.isOrderLoading,label:"Заказать дополнительные услуги",onClick:_[1]||(_[1]=e=>t.orderServices())},null,8,["disabled","is-loading"])])])):A("",!0)],64)}const He={components:{BlockBalanceAgreement:q,BlockAdditionalServices:z,emptyStateBlock:K,ButtonDefault:X,StatusBadge:J},async setup(){const p=oe(),_=se(),d=de(),t=le(),m=re();ce();const h=ae("emitter"),l=U([]),O=U(!0),b=U(!1),i=y(()=>d!=null&&d.vpsList?Object.keys(d.vpsList).map(o=>d.vpsList[o]).find(o=>o&&String(o.OrderID)===String(p.params.id)):null),P=y(()=>{var o;return!((o=i.value)!=null&&o.SchemeID)||!(d!=null&&d.vpsSchemes)?null:d.vpsSchemes[i.value.SchemeID]}),B=y(()=>!i.value||!P.value?null:{ServiceID:i.value.ServiceID,ServersGroupID:P.value.ServersGroupID}),D=y(()=>(t==null?void 0:t.ServicesList)||{}),V=y(()=>{var g;if(!((g=i.value)!=null&&g.OrderID)||!(m!=null&&m.userOrders))return[];const o=i.value.OrderID;return Object.keys(m.userOrders).map(r=>m.userOrders[r]).filter(r=>String(r==null?void 0:r.DependOrderID)===String(o)&&(r==null?void 0:r.ServiceID)&&D.value[r.ServiceID]).sort((r,C)=>Number(r==null?void 0:r.ID)-Number(C==null?void 0:C.ID))}),E=y(()=>{if(!l.value||!Array.isArray(l.value))return 0;let o=0;return l.value.forEach(a=>{a&&typeof a.Price=="number"&&(o+=a.Price)}),e(o)});function R(o){l.value=o||[]}function e(o){return o==null?"0.00":Number(o).toFixed(2)||"0.00"}async function f(){var o,a,n;if(!(!l.value||!Array.isArray(l.value)||l.value.length===0))for(const I of l.value){if(!I)continue;let g="SUCCESS",r=(o=D.value[I.ServiceID])==null?void 0:o.Code;const C={Code:r,DependOrderID:(a=i.value)==null?void 0:a.OrderID,...I,ContractID:(n=i.value)==null?void 0:n.ContractID};try{const{result:L,info:k,error:Ge}=await t.ServiceOrder(C);if(L==="SUCCESS"){let x={};r==="Default"?x.ServiceOrderID=k==null?void 0:k.ServiceOrderID:x[`${r}OrderID`]=k==null?void 0:k.ServiceOrderID;const Y=await t.ServiceOrderPay(r,x,{XMLHttpRequest:"yes"});let{result:F,error:qe}=Y;F==="SUCCESS"?(h.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),l.value=[],_.push("/AdditionalServices")):F==="BASKET"&&_.push("/Basket")}else g="ERROR",h.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(L){console.error("Ошибка при заказе услуги:",L),g="ERROR",h.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(g==="ERROR")break}}async function N(){b.value=!0;try{await f()}catch(o){console.error("Ошибка при заказе услуг:",o),h.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{b.value=!1}}function Q(o){const a=Object.values(D.value).find(I=>I.ID===o);if(!a){_.push(`/AdditionalServices/${o}`);return}const n=a.Code;n==="Default"||n==="DNSmanager"||n==="ISPsw"||n==="ExtraIP"?_.push(`/AdditionalServices/${o}`):_.push(`/${n}Orders/${o}`)}function W(o,a){let n="Orders";a==="50000"?n="ExtraIPOrders":a==="51000"?n="ISPswOrders":a==="52000"&&(n="DNSmanagerOrders"),h.emit("open-modal",{component:"StatusHistory",data:{modeID:n,rowID:o}})}return ne(async()=>{try{await d.fetchVPS(),await d.fetchVPSSchemes(),await t.fetchServices(),await m.fetchUserOrders()}catch(o){console.error("Ошибка загрузки данных:",o)}finally{O.value=!1}}),{getVPSData:i,serviceSearchParams:B,selectedServices:l,getServices:D,orderedServices:V,ADDITIONAL_SERVICES_PRICE:E,handleServicesUpdate:R,setToFixedService:e,orderServices:N,isLoading:O,isOrderLoading:b,navigateToService:Q,openHistoryStatuses:W}}},it=te(He,[["render",je],["__scopeId","data-v-2ee3ff2d"]]);export{it as default};
