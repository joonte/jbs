import{E as de}from"./EmptyStateBlock-9f752916.js";import{_ as ue}from"./BlockOrderPayBalance-e0feb4e8.js";import{_ as me}from"./ClausesKeeper-eb954229.js";import{_ as ve}from"./ButtonDefault-7c216fc6.js";import{_ as pe,a7 as he,e as be,S as ge,r as b,g as D,h as ye,O as ke,ag as S,o as r,c as _,b as d,a as e,t as c,F as I,x as fe,k as De,Z as le,ae as ne,p as Ie,l as Be}from"./index-5e313302.js";import{u as we}from"./hosting-da227957.js";import{u as Se}from"./contracts-3351d68f.js";import{_ as Ce}from"./paramsAccordionBlock-6851eaec.js";import{B as He}from"./BlockBalanceAgreement-bb87adc1.js";import"./bootstrap-vue-next.es-a19a8b41.js";import"./IconHelp-37cb81ff.js";import"./globalActions-a7429ad5.js";import"./BasicInput-be1c88a0.js";import"./component-6a5a025c.js";import"./IconClose-1f889a2e.js";import"./IconArrow-555f9d45.js";/* empty css                                                                             */const ce=g=>(Ie("data-v-bd3844d9"),g=g(),Be(),g),Ee={key:0,class:"hosting-sheme"},Oe={class:"section"},Pe={class:"container"},xe={class:"section-header"},Fe={class:"section-header__wrapper"},Le={class:"section-title"},Ne={class:"section-label"},Re={class:"section"},$e={class:"container"},Ae={class:"total-block"},Ke={class:"total-block__row divider-bottom"},Te=ce(()=>e("div",{class:"total-block__col"},"Цена тарифа",-1)),Ve={class:"total-block__col"},je={class:"total-block__row no-divider"},Ue={class:"total-block__col"},Me={class:"total-block__col"},Ze={class:"total-block__row total-block__row--big economy-line"},qe=ce(()=>e("div",{class:"total-block__col red"},"Выгода",-1)),ze={class:"total-block__col flex-col"},Ge={class:"red"},Je={class:"total-block__row total-block__row--big"},Qe={class:"total-block__col"},We={class:"total-block__col"},Xe={key:1,class:"section"},Ye={class:"container"},et={key:1,class:"section"},tt={class:"container"},ot={__name:"HostingProlong",async setup(g){let m,v;const a=we(),C=Se(),ie=he(),H=be();ge("emitter"),b(null),b(null),b("");const o=b(null),y=b(!1),l=D(()=>Object.keys(a==null?void 0:a.hostingList).map(t=>a==null?void 0:a.hostingList[t]).find(t=>t.OrderID===ie.params.id));console.log("getHostingOrderData",l);const u=D(()=>{var t,s;return(s=a==null?void 0:a.hostingSchemes)==null?void 0:s[(t=l.value)==null?void 0:t.SchemeID]});console.log("getHostingScheme",u);const E=D(()=>C.contractsList);function k(t){return Number(t).toFixed(2)||0}function O(){var s,i;let t=0;return(i=(s=o.value)==null?void 0:s.discounts)==null||i.Bonuses.map(p=>{t+=+p.Economy}),t}function B(){var t,s,i;y.value=!0,a.HostingOrderPay({HostingOrderID:(t=l.value)==null?void 0:t.ID,DaysPayFromBallance:((s=o.value)==null?void 0:s.daysFromBalance)||0,DaysPay:(i=o.value)==null?void 0:i.actualDays,IsChange:!0}).then(p=>{var h;let{result:f,error:w}=p;f==="SUCCESS"?H.push(`/HostingOrders/${(h=l.value)==null?void 0:h.ID}`):f==="BASKET"&&H.push("/Basket"),y.value=!1})}const P=t=>{t.key==="Enter"&&t.ctrlKey&&!re.value&&B()},re=D(()=>o.value===null);ye(()=>{document.addEventListener("keyup",P)}),ke(()=>{document.removeEventListener("keyup",P)});function _e(t){o.value=t}return[m,v]=S(()=>a.fetchHostingOrders()),await m,v(),[m,v]=S(()=>a.fetchHostingSchemes()),await m,v(),[m,v]=S(()=>C.fetchContracts()),await m,v(),(t,s)=>{var h,x,F,L,N,R,$,A,K,T,V,j,U,M,Z,q,z,G,J,Q,W,X,Y,ee,te,oe,se,ae;const i=ve,p=me,f=ue,w=de;return r(),_(I,null,[d(He),l.value?(r(),_("div",Ee,[e("div",Oe,[e("div",Pe,[e("div",xe,[e("div",Fe,[e("h1",Le,c((h=l.value)==null?void 0:h.Domain),1),d(i,{class:"btn--wide",label:((x=E.value[l.value.ContractID])==null?void 0:x.Balance)>((F=o.value)==null?void 0:F.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||((L=o.value)==null?void 0:L.price)===null,"is-loading":y.value,onClick:s[0]||(s[0]=n=>B())},null,8,["label","disabled","is-loading"])]),e("div",Ne,c((N=u.value)==null?void 0:N.Name),1)]),d(p)])]),d(Ce,{"params-list":(R=u.value)==null?void 0:R.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),($=u.value)!=null&&$.IsPayed&&((A=u.value)!=null&&A.IsProlong)||!((K=u.value)!=null&&K.IsPayed)?(r(),_(I,{key:0},[d(f,{contractID:(T=l.value)==null?void 0:T.ContractID,daysRemainded:(V=l.value)==null?void 0:V.DaysRemainded,scheme:u.value,orderID:(j=l.value)==null?void 0:j.OrderID,isOrderID:!0,onSelect:_e},null,8,["contractID","daysRemainded","scheme","orderID"]),e("div",Re,[e("div",$e,[e("div",Ae,[((Z=(M=(U=o.value)==null?void 0:U.discounts)==null?void 0:M.Bonuses)==null?void 0:Z.length)>0?(r(),_(I,{key:0},[e("div",Ke,[Te,e("div",Ve,c(k((q=o.value)==null?void 0:q.price))+" ₽",1)]),(r(!0),_(I,null,fe((G=(z=o.value)==null?void 0:z.discounts)==null?void 0:G.Bonuses,n=>(r(),_("div",je,[e("div",Ue,"Скидка "+c(n==null?void 0:n.Discount)+"% на "+c(n==null?void 0:n.Days)+" дней",1),e("div",Me,"-"+c(k(n==null?void 0:n.Economy))+" ₽",1)]))),256))],64)):De("",!0),le(e("div",Ze,[qe,e("div",ze,[e("span",null,[e("s",null,c(k((J=o.value)==null?void 0:J.price))+" ₽",1)]),e("span",Ge,"-"+c(O())+" ₽",1)])],512),[[ne,((X=(W=(Q=o.value)==null?void 0:Q.discounts)==null?void 0:W.Bonuses)==null?void 0:X.length)>0]]),le(e("div",Je,[e("div",Qe,"Итого за "+c((Y=o.value)==null?void 0:Y.label),1),e("div",We,c(k(((ee=o.value)==null?void 0:ee.price)-O()))+" ₽",1)],512),[[ne,(te=o.value)==null?void 0:te.price]])]),d(i,{class:"btn--wide",label:((oe=E.value[l.value.ContractID])==null?void 0:oe.Balance)>((se=o.value)==null?void 0:se.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||((ae=o.value)==null?void 0:ae.price)===null,"is-loading":y.value,onClick:s[1]||(s[1]=n=>B())},null,8,["label","disabled","is-loading"])])])],64)):(r(),_("div",Xe,[e("div",Ye,[d(w,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),_("div",et,[e("div",tt,[d(w,{label:"не удалось найти заказ хостинга"})])]))],64)}}},kt=pe(ot,[["__scopeId","data-v-bd3844d9"]]);export{kt as default};
