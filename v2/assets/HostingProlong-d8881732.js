import{E as ue}from"./EmptyStateBlock-2d70ce64.js";import{_ as ve}from"./BlockOrderPayBalance-510763c2.js";import{_ as me}from"./ClausesKeeper-313482ce.js";import{_ as pe}from"./ButtonDefault-5aebc1f7.js";import{_ as he,a7 as be,e as ye,S as ge,r as p,g as B,i as ke,O as fe,ag as S,o as r,c as _,b as d,a as e,t as c,F as I,x as De,k as Be,Z as ne,a9 as ce,p as Ie,l as we}from"./index-90eb49f0.js";import{u as Pe}from"./hosting-606725d4.js";import{u as Se}from"./contracts-0cbe8270.js";import{_ as Ce}from"./paramsAccordionBlock-ac76aa5f.js";import{B as Ee}from"./BlockBalanceAgreement-267acfcf.js";import"./bootstrap-vue-next.es-788a757a.js";import"./IconHelp-3a9b4523.js";import"./globalActions-a5ec5102.js";import"./BasicInput-936f29ee.js";import"./component-65c692c0.js";import"./IconClose-c838a5bc.js";import"./IconArrow-380053a0.js";/* empty css                                                                             */const ie=y=>(Ie("data-v-3cf41c82"),y=y(),we(),y),He={key:0,class:"hosting-sheme"},Oe={class:"section"},xe={class:"container"},Fe={class:"section-header"},Le={class:"section-header__wrapper"},Ne={class:"section-title"},Re={class:"section-label"},$e={class:"section"},Ae={class:"container"},Ke={class:"total-block"},Te={class:"total-block__row divider-bottom"},Ue=ie(()=>e("div",{class:"total-block__col"},"Цена тарифа",-1)),Ve={class:"total-block__col"},je={class:"total-block__row no-divider"},Me={class:"total-block__col"},Ze={class:"total-block__col"},qe={class:"total-block__row total-block__row--big economy-line"},ze=ie(()=>e("div",{class:"total-block__col red"},"Выгода",-1)),Ge={class:"total-block__col flex-col"},Je={class:"red"},Qe={class:"total-block__row total-block__row--big"},We={class:"total-block__col"},Xe={class:"total-block__col"},Ye={key:1,class:"section"},es={class:"container"},ss={key:1,class:"section"},ts={class:"container"},os={__name:"HostingProlong",async setup(y){let u,v;const l=Pe(),C=Se(),re=be(),E=ye();ge("emitter");const g=p(!1);p(null),p(null),p("");const t=p(null),k=p(!1),n=B(()=>Object.keys(l==null?void 0:l.hostingList).map(s=>l==null?void 0:l.hostingList[s]).find(s=>s.OrderID===re.params.id)),m=B(()=>{var s,o;return(o=l==null?void 0:l.hostingSchemes)==null?void 0:o[(s=n.value)==null?void 0:s.SchemeID]}),H=B(()=>C.contractsList);function f(s){return Number(s).toFixed(2)||0}function O(){var o,i;let s=0;return(i=(o=t.value)==null?void 0:o.discounts)==null||i.Bonuses.map(h=>{s+=+h.Economy}),s}function w(){var s,o,i;k.value=!0,l.HostingOrderPay({HostingOrderID:(s=n.value)==null?void 0:s.ID,DaysPayFromBallance:((o=t.value)==null?void 0:o.daysFromBalance)||0,DaysPay:(i=t.value)==null?void 0:i.actualDays,IsChange:!0}).then(h=>{var b;let{result:D,error:P}=h;D==="SUCCESS"?E.push(`/HostingOrders/${(b=n.value)==null?void 0:b.ID}`):D==="BASKET"&&E.push("/Basket"),k.value=!1})}const x=s=>{s.key==="Enter"&&s.ctrlKey&&!_e.value&&w()},_e=B(()=>t.value===null);ke(()=>{document.addEventListener("keyup",x)}),fe(()=>{document.removeEventListener("keyup",x)});function de(s){t.value=s}return[u,v]=S(()=>l.fetchHostingOrders()),await u,v(),[u,v]=S(()=>l.fetchHostingSchemes()),await u,v(),[u,v]=S(()=>C.fetchContracts()),await u,v(),(s,o)=>{var b,F,L,N,R,$,A,K,T,U,V,j,M,Z,q,z,G,J,Q,W,X,Y,ee,se,te,oe,ae,le;const i=pe,h=me,D=ve,P=ue;return r(),_(I,null,[d(Ee),n.value?(r(),_("div",He,[e("div",Oe,[e("div",xe,[e("div",Fe,[e("div",Le,[e("h1",Ne,c((b=n.value)==null?void 0:b.Domain),1),d(i,{class:"btn--wide",label:g.value||((F=H.value[n.value.ContractID])==null?void 0:F.Balance)>((L=t.value)==null?void 0:L.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||((N=t.value)==null?void 0:N.price)===null,"is-loading":k.value,onClick:o[0]||(o[0]=a=>w())},null,8,["label","disabled","is-loading"])]),e("div",Re,c((R=m.value)==null?void 0:R.Name),1)]),d(h)])]),d(Ce,{"params-list":($=m.value)==null?void 0:$.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),(A=m.value)!=null&&A.IsPayed&&((K=m.value)!=null&&K.IsProlong)||!((T=m.value)!=null&&T.IsPayed)?(r(),_(I,{key:0},[d(D,{contractID:(U=n.value)==null?void 0:U.ContractID,daysRemainded:(V=n.value)==null?void 0:V.DaysRemainded,scheme:m.value,orderID:(j=n.value)==null?void 0:j.OrderID,isOrderID:!0,onSelect:de,isBalancePay:g.value,"onUpdate:isBalancePay":o[1]||(o[1]=a=>g.value=a)},null,8,["contractID","daysRemainded","scheme","orderID","isBalancePay"]),e("div",$e,[e("div",Ae,[e("div",Ke,[((q=(Z=(M=t.value)==null?void 0:M.discounts)==null?void 0:Z.Bonuses)==null?void 0:q.length)>0?(r(),_(I,{key:0},[e("div",Te,[Ue,e("div",Ve,c(f((z=t.value)==null?void 0:z.price))+" ₽",1)]),(r(!0),_(I,null,De((J=(G=t.value)==null?void 0:G.discounts)==null?void 0:J.Bonuses,a=>(r(),_("div",je,[e("div",Me,"Скидка "+c(a==null?void 0:a.Discount)+"% на "+c(a==null?void 0:a.Days)+" дней",1),e("div",Ze,"-"+c(f(a==null?void 0:a.Economy))+" ₽",1)]))),256))],64)):Be("",!0),ne(e("div",qe,[ze,e("div",Ge,[e("span",null,[e("s",null,c(f((Q=t.value)==null?void 0:Q.price))+" ₽",1)]),e("span",Je,"-"+c(O())+" ₽",1)])],512),[[ce,((Y=(X=(W=t.value)==null?void 0:W.discounts)==null?void 0:X.Bonuses)==null?void 0:Y.length)>0]]),ne(e("div",Qe,[e("div",We,"Итого за "+c((ee=t.value)==null?void 0:ee.label),1),e("div",Xe,c(f(((se=t.value)==null?void 0:se.price)-O()))+" ₽",1)],512),[[ce,(te=t.value)==null?void 0:te.price]])]),d(i,{class:"btn--wide",label:g.value||((oe=H.value[n.value.ContractID])==null?void 0:oe.Balance)>((ae=t.value)==null?void 0:ae.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:t.value===null||((le=t.value)==null?void 0:le.price)===null,"is-loading":k.value,onClick:o[2]||(o[2]=a=>w())},null,8,["label","disabled","is-loading"])])])],64)):(r(),_("div",Ye,[e("div",es,[d(P,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),_("div",ss,[e("div",ts,[d(P,{label:"не удалось найти заказ хостинга"})])]))],64)}}},fs=he(os,[["__scopeId","data-v-3cf41c82"]]);export{fs as default};
