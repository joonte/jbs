import{_ as ae}from"./EmptyStateBlock-DA3-0YDi.js";import{_ as re}from"./HostingCard-BBV3qEVv.js";import{_ as le}from"./FormInputSearch-B47bjFcn.js";import{_ as ie}from"./ClausesKeeper-iUM0yapS.js";import{_ as ue}from"./ButtonDefault-CMw2aBy6.js";import{m as me}from"./bootstrap-vue-next-W16P-SAV.js";import{_ as ce,a as de}from"./IconButtonBack-CTMQ7Okc.js";import{_ as pe}from"./BlueButton.vue_vue_type_script_setup_true_lang-BKdLNEec.js";import{_ as _e}from"./BlockBalanceAgreement-v_bWuiVT.js";import{u as fe,r as u,E as ve,f as C,I as ge,o as s,c as d,b as l,a,C as m,h,t as p,w as _,R as we,v as I,F as M,g as Se,x as he,d as ke,e as O}from"./index-Codq73aV.js";import{s as be}from"./multiselect-DElL0Rlw.js";import{u as xe}from"./hosting-BhryHInW.js";import{u as ye}from"./index-BO2gwtUe.js";import{u as Ce}from"./orders-wJq_IMsK.js";import{u as Ie}from"./global-CdY51QQZ.js";import{b as B,f as Oe}from"./common-DyknwSqv.js";import{_ as Be}from"./WhiteButton.vue_vue_type_script_setup_true_lang-CdZRVTJ5.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./StatusBadge-BmqDrHzy.js";import"./IconLink-D5X10WIs.js";import"./OrderIDBadge-DCIAfa63.js";import"./ServerStatusBadge.vue_vue_type_script_setup_true_lang-CNB3-WyC.js";import"./IconDots-BIoh_VC5.js";import"./UserNote-9g0f9gxP.js";import"./IconCard-C_8uFbeS.js";import"./CardButton-DT2I8_xv.js";import"./time-DenPiOX5.js";import"./IconPlus-Bm8D3Wgq.js";import"./IconClose-Dia1noy8.js";const He={class:"tw-px-4 md:tw-px-8"},Ve={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},$e={class:"tw-flex tw-items-center tw-gap-2"},Pe={key:0,class:"tw-flex tw-items-center tw-gap-2"},Le={key:1,class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-4 tw-my-4"},Ne={class:"list-form"},Me={class:"list-form_col list-form_col--sm"},Ue={class:"list-form_select"},Ae={class:"multiselect-option"},Re={key:0,class:"tw-my-6 tw-space-y-4"},je={__name:"HostingOrders",async setup(Ee){let D,H;const c=xe(),U=fe(),k=ye(),V=Ie(),$=Ce(),b=ke(),f=u("*"),v=u(null),r=u(!1),g=u([]),x=u(null),y=u(!1),w=he("emitter");[D,H]=ve(()=>Promise.all([c.fetchHostingSchemes(),$.fetchAllOrders(),c.fetchHostingOrders(),k.fetchContracts()])),await D,H(),w.on("updateHostingList",()=>{c.fetchHostingOrders()});const i=C(()=>Object.values(c.hostingList).reverse().map(t=>({...t,Stat:$.orders[t.OrderID]?.Stat||[]}))),P=C(()=>{let t=[{value:"*",name:"Все договора"}];return i.value!==null?(i.value.forEach(e=>{t.find(n=>n.value===e.ContractID)||t.push({value:e.ContractID,name:k.contractsList?.[e?.ContractID]?.Customer})}),t):{value:"*",name:"Все договора"}}),S=C(()=>z(K(i.value))),A=t=>{g.value=t};async function R(){const t=Object.keys(g.value).filter(n=>g.value[n]),e={ServiceID:1e4,ItemsPay:x.value,OrdersIDs:t,...y.value&&{UseBalance:"yes"}};await V.OrdersPay(e).then(n=>{n==="Basket"?b.push("/Basket"):n?.Status==="Ok"&&(r.value=!1,w.emit("open-modal",{component:"BalanceProlong",data:{Message:n?.Message,Count:n?.Count}}))})}function j(){r.value=!0}function E(){r.value=!1}function T(){b.go(0)}function L(){b.push("/HostingSchemes")}function F(t,e){w.emit("open-modal",{component:"DeleteItem",data:{id:t,message:`Вы действительно хотите удалить хостинг #${e}?`,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function q(t){w.emit("open-modal",{component:"OrdersTransfer",data:t})}function G(t){V.OrderManageHosting(t)}function K(t){return f.value!=="*"?t.filter(e=>e?.ContractID===f.value):t}function z(t){return v.value!==null?t.filter(e=>e?.Domain.toLowerCase().includes(v.value.toLowerCase())):t}function J(t){const e=Q(t?.SchemeID);return[{text:e?.Name},{text:B(e?.SchemeParams?.limit_webdomains)},{text:B(e?.SchemeParams?.limit_quota)},{text:B(e?.SchemeParams?.limit_emails)},{text:`${Oe(e?.CostMonth)} в месяц`,bold:!0}]}function Q(t){return c.hostingSchemes?.[t]}return ge(()=>{i.value.length<1&&L()}),(t,e)=>{const n=_e,W=ce,X=pe,Y=de,Z=me,ee=ue,te=ie,oe=le,se=re,N=ae;return s(),d(M,null,[l(n),a("div",He,[a("div",Ve,[a("div",$e,[r.value?(s(),m(W,{key:0,onClick:e[0]||(e[0]=o=>E()),class:"tw-cursor-pointer"})):h("",!0),a("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:e[1]||(e[1]=o=>T())},p(r.value?"Продление услуг Хостинга":"Хостинг"),1)]),r.value?h("",!0):(s(),d("div",Pe,[i.value.length?(s(),m(Be,{key:0,onClick:e[2]||(e[2]=o=>j())},{default:_(()=>e[9]||(e[9]=[O("Продлить несколько заказов ",-1)])),_:1,__:[9]})):h("",!0),l(X,{onClick:e[3]||(e[3]=o=>L())},{default:_(()=>e[10]||(e[10]=[O("Заказать",-1)])),_:1,__:[10]})])),r.value?(s(),d("div",Le,[l(Y,{class:"contr period",modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=o=>x.value=o)},null,8,["modelValue"]),l(Z,{id:"checkbox-balance",modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=o=>y.value=o),name:"checkbox-balance"},{default:_(()=>e[11]||(e[11]=[O(" Использовать средства с баланса ",-1)])),_:1,__:[11]},8,["modelValue"]),l(ee,{label:"Продлить",onClick:e[6]||(e[6]=o=>R())})])):h("",!0)]),(s(),m(we,null,[l(te)],1024)),a("div",Ne,[a("div",Me,[a("div",Ue,[l(I(be),{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=o=>f.value=o),options:P.value,disabled:P.value?.length<=1,label:"name"},{singlelabel:_(({value:o})=>[a("span",null,"# "+p(String(o.value).padStart(5,"0"))+" / "+p(o.name),1)]),option:_(({option:o})=>[a("span",Ae,"# "+p(String(o.value).padStart(5,"0"))+" / "+p(o.name),1)]),_:1},8,["modelValue","options","disabled"])])]),l(oe,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=o=>v.value=o)},null,8,["modelValue"])]),i.value&&i.value.length>0?(s(),d("div",Re,[S.value&&S.value?.length>0?(s(!0),d(M,{key:0},Se(S.value,(o,ne)=>(s(),m(se,{key:o.OrderID,hosting:o,"user-name":`${I(U).userInfo?.Name} - ${I(k).contractsList?.[o?.ContractID]?.Customer}`,params:J(o),"info-link":`/HostingOrders/${o?.OrderID}`,"is-last":ne===S.value.length-1,"is-several":r.value,"selected-rows":g.value,onUpdateSelectedRows:A,onDelete:F,onTransfer:q,onManage:G},null,8,["hosting","user-name","params","info-link","is-last","is-several","selected-rows"]))),128)):(s(),m(N,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(s(),m(N,{key:1,class:"no-margin",label:"У Вас нет заказов на хостинг"}))])],64)}}},gt=De(je,[["__scopeId","data-v-b0b38d79"]]);export{gt as default};
