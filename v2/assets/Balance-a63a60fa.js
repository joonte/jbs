import{j as K,o as c,c as d,b as I,a as e,t as b,F as B,x as M,k as x,y as F,n as O,p as R,l as U,_ as z,u as T,S as q,a7 as G,e as H,r as y,g as V,i as J,O as Q}from"./index-6f846e0d.js";import{I as W}from"./IconSearch-5988db85.js";import{_ as E}from"./ClausesKeeper-3ae27028.js";import{c as X}from"./component-32b750ca.js";import{u as Y}from"./postings-24d27e64.js";import{u as Z}from"./contracts-b643bcd5.js";import{u as $}from"./invoices-41375e35.js";import{B as j}from"./BlockBalanceAgreement-4579706c.js";import{E as tt}from"./EmptyStateBlock-c1b0587e.js";import{_ as et}from"./ButtonDefault-40efcd87.js";import"./IconClose-12869131.js";import"./bootstrap-vue-next.es-6bf04585.js";import"./IconArrow-37547b0b.js";const f=i=>(R("data-v-118bb3f6"),i=i(),U(),i),ot={class:"section"},nt={class:"container"},st={class:"section-header"},it=f(()=>e("h1",{class:"section-title"},"Пополнить баланс",-1)),at={class:"section-label"},ct={key:0,class:"list-form"},lt={class:"list-part"},rt=f(()=>e("div",{class:"list-item__title"},"Платежные системы",-1)),_t={key:0,class:"list-row grid-net"},dt=["onClick"],mt=["src"],ut={class:"list-item__image-title"},pt={class:"list-part"},vt=f(()=>e("div",{class:"list-item__title"},"Сумма пополнения",-1)),ft={class:"list-row"},St=f(()=>e("div",{class:"list-form_col list-form_col--sm"},"Пополнить на сумму",-1)),It={class:"list-form_col list-form_col--xl"},ht={class:"search-field form-field"},gt={class:"list-row"},kt=f(()=>e("div",{class:"list-form_col list-form_col--sm"},null,-1)),Ct={class:"btn-container"};function Dt(i,l,A,n,N,h){const g=j,m=E,u=K("imask-input"),p=et,v=tt;return c(),d(B,null,[I(g),e("div",ot,[e("div",nt,[e("div",st,[it,e("div",at,"Договор # "+b(i.$route.params.id)+" / "+b(n.getContract.Customer),1)]),I(m),n.getContract?(c(),d("div",ct,[e("div",lt,[rt,n.filterActiveSystems?(c(),d("div",_t,[(c(!0),d(B,null,M(n.filterActiveSystems,t=>{var S;return c(),d(B,null,[t!=null&&t.IsActive?(c(),d("div",{key:0,class:O(["list-item",{"list-item_active":((S=n.paymentSystem)==null?void 0:S.id)===(t==null?void 0:t.ID)}]),onClick:k=>n.paymentSystem={id:t==null?void 0:t.ID,type:t==null?void 0:t.Source}},[e("img",{class:"list-item__image",src:t==null?void 0:t.Image},null,8,mt),e("div",ut,b(t==null?void 0:t.Description),1)],10,dt)):x("",!0)],64)}),256))])):x("",!0)]),e("div",pt,[vt,e("div",ft,[St,e("div",It,[e("div",ht,[I(u,{type:"text",mask:Number,placeholder:"100 ₽",modelValue:n.inputValue,"onUpdate:modelValue":l[0]||(l[0]=t=>n.inputValue=t)},null,8,["modelValue"])])])]),e("div",gt,[kt,e("div",Ct,[I(p,{"is-loading":n.isLoading,label:"Пополнить баланс",onClick:l[1]||(l[1]=t=>n.sendInvoice())},null,8,["is-loading"])])])])])):(c(),F(v,{key:1,label:"Договор не найден"}))])])],64)}const bt={components:{IconSearch:W,BlockBalanceAgreement:j,ClausesKeeper:E,"imask-input":X},async setup(){const i=Z(),l=T(),A=$(),n=Y(),N=q("emitter"),h=G(),g=H(),m=y(null),u=y(null),p=y(!1),v=V(()=>{var o;return(o=i.contractsList)==null?void 0:o[h.params.id]}),t=V(()=>l.ConfigList),S=V(()=>{const o=t.value,a=v.value;if(o!=null&&o.PaymentSystems&&(a!=null&&a.PaymentSystems)){const r=new Set(a.PaymentSystems);return Object.keys(o.PaymentSystems).filter(s=>r.has(s)).map(s=>{const _=o.PaymentSystems[s];return String(_==null?void 0:_.IsActive)==="1"?_.Collations:null}).filter(s=>s!==null).flat().slice().sort((s,_)=>{const w=parseInt(s.SortID,10),L=parseInt(_.SortID,10);return isNaN(w)?1:isNaN(L)?-1:w-L})}else return null}),k=o=>{o.key==="Enter"&&o.ctrlKey&&P()};J(()=>{document.addEventListener("keyup",k)}),Q(()=>{document.removeEventListener("keyup",k)});function P(){var o,a;u.value>0&&(p.value=!0,A.InvoiceMake({ContractID:(o=v.value)==null?void 0:o.ID,PaymentSystemID:(a=m.value)==null?void 0:a.type,Summ:u.value}).then(r=>{var C;if(p.value=!1,r.status==="success"&&r.data&&r.data.InvoiceID){const D=r.data.InvoiceID;n.InvoiceDocument({InvoiceID:D}).then(s=>{N.emit("open-modal",{component:"InvoiceDocument",data:{html:s,ID:D}})})}else g.push(`/ProfileMake?Contract=${h.params.id}&TemplateID=${(C=m.value)==null?void 0:C.type}`)}))}return await i.fetchContracts(),{inputValue:u,getConfig:t,filterActiveSystems:S,paymentSystem:m,isLoading:p,getContract:v,sendInvoice:P}}},Ft=z(bt,[["render",Dt],["__scopeId","data-v-118bb3f6"]]);export{Ft as default};
