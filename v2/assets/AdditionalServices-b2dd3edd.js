import{j as V,o as p,c as A,a as r,t as h,b as d,x as C,w as _,d as U,F as x,p as K,l as P,_ as E,e as F,f as M,r as O,g as j,v as J,n as H,k as Q,a7 as X,R as Y,i as Z}from"./index-19d4a9c5.js";import{u as $}from"./services-7baf87ff.js";import{u as R}from"./contracts-9a2dcfb1.js";import"./postings-f8eb169d.js";import{u as ee}from"./globalActions-1c9ec915.js";import{_ as z}from"./IconCard-44c1ca60.js";import{E as N}from"./EmptyStateBlock-a070e35c.js";import{S as q}from"./StatusBadge-5146d4b6.js";import{s as te}from"./servicesStatuses-6293b6ac.js";import{_ as se}from"./HelperComponent-c08ea397.js";import{z as oe,k as ne,d as ce,C as re}from"./bootstrap-vue-next.es-4c1a1806.js";import{_ as ie}from"./IconDots-7c3707cd.js";import{_ as ae}from"./ClausesKeeper-5a7e7f30.js";import{_ as le}from"./ButtonDefault-6be40158.js";import{s as de}from"./multiselect-6b76b6bf.js";import{B as W}from"./BlockBalanceAgreement-46812f15.js";import{_ as _e}from"./IconArrow-093f2a46.js";import"./IconClose-ab9f78d6.js";const ue=[{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],L=n=>(K("data-v-f2c37688"),n=n(),P(),n),ve={class:"section-header"},me={class:"section-title__nowrap"},Ie={class:"section-title"},pe={class:"btn__group"},De=L(()=>r("span",{class:"td-mobile"},"Заказ",-1)),fe=L(()=>r("span",{class:"td-mobile"},"Договор",-1)),Se=L(()=>r("span",{class:"td-mobile"},"Статус",-1)),be=L(()=>r("span",{class:"td-mobile"},"Комментарий",-1)),ge={class:"service__controls-wrapper"},ke=["onClick"],ye={class:"btn btn--dots"};function he(n,l,i,e,k,f){var y,s,T;const v=le,S=ae,m=q,u=V("Helper"),D=z,I=ie,o=V("router-link"),t=oe,c=ne,b=ce,B=re,w=N;return p(),A(x,null,[r("div",ve,[r("div",me,[r("h1",Ie,h((y=i.sectionData)==null?void 0:y.Item),1),r("div",pe,[d(v,{label:"Заказать",onClick:l[0]||(l[0]=a=>e.navigateToOrder())})])]),d(S,{class:"additional-clauses",partition:`Header:${((s=i.sectionData)==null?void 0:s.Code)==="Default"?i.sectionID:`/${(T=i.sectionData)==null?void 0:T.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(p(),C(B,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":l[1]||(l[1]=a=>e.sortBy=a),"sort-desc":e.sortDesc,"onUpdate:sortDesc":l[2]||(l[2]=a=>e.sortDesc=a),"sort-direction":e.sortDirection},{"cell(ID)":_(a=>[De,r("span",null,h(a.value),1)]),"cell(ContractID)":_(a=>{var g;return[fe,r("span",null,h((g=e.getContracts[a.value])==null?void 0:g.Customer),1)]}),"cell(StatusID)":_(a=>[Se,d(m,{status:a.value,"status-table":"Orders"},null,8,["status"])]),"cell(UserNotice)":_(a=>{var g;return[be,d(u,{"user-notice":a.value,id:(g=a.item)==null?void 0:g.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":_(a=>[r("div",ge,[r("div",{class:"btn btn--md btn--bold",onClick:g=>n.$router.push(`/ServiceOrderPay/${a.item.ID}`)},[d(D),U("Оплатить")],8,ke),d(b,{class:"dropdown-dots",right:""},{"button-content":_(()=>[r("div",ye,[d(I)])]),default:_(()=>[d(t,null,{default:_(()=>[d(o,{to:`/AdditionalServices/${a.item.ID}`},{default:_(()=>[U("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),d(c),d(t,{class:"color-red",onClick:g=>n.$emit("deleteItem",a.item)},{default:_(()=>[U("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","sort-direction"])):(p(),C(w,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const Ce={components:{EmptyStateBlock:N,StatusBadge:q,IconCard:z,Helper:se},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList"],setup(n){const l=F(),i=M(),e=O("ID"),k=O(!0),f=O("desc"),v=R(),S=j(()=>v==null?void 0:v.contractsList),m=j(()=>{var D,I;return(I=(D=Object.keys(i==null?void 0:i.userOrders).map(o=>{var t;return{...i==null?void 0:i.userOrders[o],ID:Number((t=i==null?void 0:i.userOrders[o])==null?void 0:t.ID)}}))==null?void 0:D.reverse())==null?void 0:I.filter(o=>o.ServiceID===(n==null?void 0:n.sectionID))});function u(){l.push(`/AdditionalServicesOrder?ServiceID=${n==null?void 0:n.sectionID}`)}return{authStore:i,getOrders:m,getContracts:S,sortBy:e,sortDesc:k,sortDirection:f,navigateToOrder:u,servicesStatuses:te,oneTimeWorksFields:ue}}},G=E(Ce,[["render",he],["__scopeId","data-v-f2c37688"]]),Oe={class:"section"},Be={class:"container"},we={class:"section-header"},Ae={class:"section-nav"},Ne=["onClick"],Le={class:"multiselect-option"},Te={class:"section-body"};function Ue(n,l,i,e,k,f){var I,o,t,c,b,B,w,y;const v=W,S=_e,m=V("Multiselect"),u=G,D=N;return p(),A(x,null,[d(v),r("div",Oe,[r("div",Be,[r("div",we,[r("div",Ae,[(p(!0),A(x,null,J((I=e.getServices)==null?void 0:I.slice(0,3),s=>(p(),A("div",{class:H(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(s==null?void 0:s.ID)}]),onClick:T=>e.switchToSection(s==null?void 0:s.ID)},h(s==null?void 0:s.Item),11,Ne))),256)),((o=e.getServices)==null?void 0:o.length)>3?(p(),C(m,{key:0,modelValue:e.section,"onUpdate:modelValue":l[0]||(l[0]=s=>e.section=s),class:H({"multiselect--white additional-service__select":!0,"additional-service__select_active":(c=e.getServices)==null?void 0:c.slice(3,(t=e.getServices)==null?void 0:t.length).find(s=>(s==null?void 0:s.ID)===e.section)}),options:(B=e.getServices)==null?void 0:B.slice(3,(b=e.getServices)==null?void 0:b.length),label:"ID",onSelect:l[1]||(l[1]=s=>e.switchToSection(s))},{option:_(({option:s})=>[r("div",Le,h(s==null?void 0:s.Item),1)]),caret:_(()=>[d(S,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):Q("",!0)])]),r("div",Te,[(w=e.getServices)!=null&&w.find(s=>s.ID===e.section)?(p(),C(u,{key:0,sectionID:e.section,sectionData:(y=e.getServices)==null?void 0:y.find(s=>s.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(p(),C(D,{key:1,label:"Услуга не найдена"}))])])])],64)}const Ve={components:{ServiceListSection:G,emptyStateBlock:N,Multiselect:de,BlockBalanceAgreement:W},async setup(){const n=X(),l=F(),i=Y("emitter"),e=$(),k=ee(),f=M(),v=R(),S=O(null),m=j(()=>{var o;return(o=Object.keys(e==null?void 0:e.ServicesList))==null?void 0:o.map(t=>{var c;return{...e==null?void 0:e.ServicesList[t],value:(c=e==null?void 0:e.ServicesList[t])==null?void 0:c.ID}}).filter(t=>(t==null?void 0:t.ServicesGroupID)!=="1000"&&(t==null?void 0:t.IsActive)&&!(t!=null&&t.IsHidden)).sort((t,c)=>Number(t==null?void 0:t.SortID)<Number(c==null?void 0:c.SortID)?-1:Number(t==null?void 0:t.SortID)>Number(c==null?void 0:c.SortID)?1:0)}),u=O(null);i.on("updateServicesList",()=>{f.fetchUserOrders()});function D(o){l.replace(`/AdditionalServices?ServiceID=${o}`),u.value=o}function I(o){k.deleteItem({TableID:"Orders",RowsIDs:o.ID}).then(({result:t,error:c})=>{t==="SUCCESS"&&f.fetchUserOrders()})}return Z(()=>{var o,t;(o=m.value)!=null&&o.find(c=>{var b;return(c==null?void 0:c.ID)===((b=n==null?void 0:n.query)==null?void 0:b.ServiceID)})?u.value=(t=n==null?void 0:n.query)==null?void 0:t.ServiceID:l.replace(`/AdditionalServices?ServiceID=${u.value}`)}),await e.fetchServices().then(()=>{var o,t;u.value=(t=(o=m.value)==null?void 0:o[0])==null?void 0:t.ID}),await v.fetchContracts(),await f.fetchUserOrders(),{section:u,deleteItem:I,getServices:m,additionalServicesValue:S,switchToSection:D}}},$e=E(Ve,[["render",Ue],["__scopeId","data-v-5443aad9"]]);export{$e as default};
