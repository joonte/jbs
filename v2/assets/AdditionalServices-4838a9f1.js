import{j as q,o as h,c as R,a as l,t as N,b as S,y as E,w as g,d as U,k as X,F as z,p as ie,l as le,_ as J,e as Q,f as Y,S as Z,r as M,g as A,h as $,i as de,x as _e,n as K,a7 as ue}from"./index-83b4b7ba.js";import{u as ee}from"./services-c044aff2.js";import{u as te}from"./contracts-623ec7a8.js";import"./postings-05f51b78.js";import{u as ne}from"./globalActions-633eb799.js";import{u as me}from"./resetServer-94c466e3.js";import{f as W}from"./useTimeFunction-8602dd60.js";import{_ as oe}from"./IconCard-2cc17a6b.js";import{E as G}from"./EmptyStateBlock-68a1c33e.js";import{S as se}from"./StatusBadge-0d170ac0.js";import{s as fe}from"./servicesStatuses-6293b6ac.js";import{_ as ve}from"./HelperComponent-df0c894c.js";import{z as De,k as Ie,d as ge,C as pe}from"./bootstrap-vue-next.es-8f3ae81a.js";import{_ as Se}from"./IconDots-a66f045d.js";import{_ as ke}from"./ClausesKeeper-55c14b7f.js";import{_ as ye}from"./ButtonDefault-dc248ec6.js";import{s as Oe}from"./multiselect-f2568231.js";import{B as re}from"./BlockBalanceAgreement-c5fad736.js";import{_ as be}from"./IconArrow-80c72216.js";import"./IconClose-86aafc4e.js";const he=[{key:"ID",label:"Заказ",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"Keys",label:"Ключевые поля",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",variant:"",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray td-order"},{key:"UserNotice",label:"Примечание",variant:""},{key:"controls",label:"",variant:"td-controls"}],L=u=>(ie("data-v-ef87a8ef"),u=u(),le(),u),Ce={class:"section-header"},we={class:"section-title__nowrap"},Pe={class:"section-title"},xe={class:"btn__group"},Be=L(()=>l("span",{class:"td-mobile"},"Заказ",-1)),Ne=L(()=>l("span",{class:"td-mobile"},"Договор",-1)),Te=L(()=>l("span",{class:"td-mobile"},"Ключевые поля",-1)),je=["title"],Ae=L(()=>l("span",{class:"td-mobile"},"Статус",-1)),Ee=L(()=>l("span",{class:"td-mobile"},"Дата окончания",-1)),Le=L(()=>l("span",{class:"td-mobile"},"Комментарий",-1)),He={class:"service__controls-wrapper"},Ue=["onClick"],Me={class:"btn btn--dots"};function Ve(u,_,m,e,T,H){var B,r,j;const C=ye,w=ke,f=se,O=q("Helper"),I=oe,P=Se,x=q("router-link"),k=De,d=Ie,n=ge,a=pe,b=G;return h(),R(z,null,[l("div",Ce,[l("div",we,[l("h1",Pe,N((B=m.sectionData)==null?void 0:B.Item),1),l("div",xe,[S(C,{label:"Заказать",onClick:_[0]||(_[0]=o=>e.navigateToOrder())})])]),S(w,{class:"additional-clauses",partition:`Header:${((r=m.sectionData)==null?void 0:r.Code)==="Default"?m.sectionID:`/${(j=m.sectionData)==null?void 0:j.Code}Orders`}`},null,8,["partition"])]),e.getOrders&&e.getOrders.length?(h(),E(a,{key:0,class:"basic-table",items:e.getOrders,fields:e.oneTimeWorksFields,"sort-by":e.sortBy,"onUpdate:sortBy":_[1]||(_[1]=o=>e.sortBy=o),"sort-desc":e.sortDesc,"onUpdate:sortDesc":_[2]||(_[2]=o=>e.sortDesc=o),onRowClicked:e.navigateToOrderPage,"sort-direction":e.sortDirection},{"cell(ID)":g(o=>[Be,l("span",null,N(o.value),1)]),"cell(ContractID)":g(o=>{var v;return[Ne,l("span",null,N((v=e.getContracts[o.value])==null?void 0:v.Customer),1)]}),"cell(Keys)":g(o=>{var v,y;return[Te,l("span",{title:e.getTitleText((v=o.item)==null?void 0:v.ID)},N(e.findDomainByOrderID((y=o.item)==null?void 0:y.ID)),9,je)]}),"cell(StatusID)":g(o=>[Ae,S(f,{class:"clickable-element",status:o.value,"status-table":"Orders",onClick:v=>{var y,V;return e.openHistoryStatuses((y=o.item)==null?void 0:y.ID,(V=o.item)==null?void 0:V.ServiceID)}},null,8,["status","onClick"])]),"cell(ExpirationDate)":g(o=>{var v,y;return[Ee,l("span",null,N(e.calculateExpirationDate((v=o.item)==null?void 0:v.DaysRemainded))+" | "+N(((y=o.item)==null?void 0:y.DaysRemainded)||0)+" дн.",1)]}),"cell(UserNotice)":g(o=>{var v;return[Le,S(O,{class:"clickable-element","user-notice":o.value,id:(v=o.item)==null?void 0:v.ID,emit:"updateServicesList"},null,8,["user-notice","id"])]}),"cell(controls)":g(o=>[l("div",He,[l("div",{class:"btn btn--md btn--bold clickable-element",onClick:v=>e.handlePayment(o.item.ID,o.item.ServiceID,o.item.ContractID)},[S(I),U("Оплатить")],8,Ue),S(n,{class:"dropdown-dots",right:""},{"button-content":g(()=>[l("div",Me,[S(P)])]),default:g(()=>[S(k,null,{default:g(()=>[S(x,{to:`/AdditionalServices/${o.item.ID}`},{default:g(()=>[U("Дополнительная информация")]),_:2},1032,["to"])]),_:2},1024),S(k,{onClick:v=>e.transferItem(o.item.ID,o.item.ServiceID)},{default:g(()=>[U("Передать на другой аккаунт")]),_:2},1032,["onClick"]),m.sectionID==="51000"||m.sectionID==="52000"?(h(),E(k,{key:0,onClick:v=>e.orderManage(o.item.ID,o.item.ServiceID)},{default:g(()=>[U("Управлять заказом")]),_:2},1032,["onClick"])):X("",!0),S(d),S(k,{class:"color-red",onClick:v=>u.$emit("deleteItem",o.item)},{default:g(()=>[U("Удалить")]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["items","fields","sort-by","sort-desc","onRowClicked","sort-direction"])):(h(),E(b,{key:1,class:"no-margin",label:"Вы еще не пользовались этой услугой"}))],64)}const Re={components:{EmptyStateBlock:G,StatusBadge:se,IconCard:oe,Helper:ve},props:{sectionID:{type:String,default:""},sectionData:{type:Object,default:()=>({})}},emits:["deleteItem","updateServicesList","transfer"],async setup(u){const _=Q(),m=Y(),e=Z("emitter"),T=M("ID"),H=M(!0),C=M("desc"),w=te(),f=ee(),O=ne(),I=A(()=>f==null?void 0:f.DNSmanagerOrdersList),P=A(()=>f==null?void 0:f.ISPswOrdersList),x=A(()=>f==null?void 0:f.ExtraIPOrdersList),k=A(()=>w==null?void 0:w.contractsList);function d(c,s,t){console.log("serviceID - ",s),s==="50000"||s==="51000"||s==="52000"?B(c,s):_.push(`/ServiceOrderPay/${c}`)}function n(c,s){console.log("getExtraIPOrders - ",x.value),console.log("ID - ",c);let t=null,i="";switch(s){case"50000":t=Object.entries(x.value).find(([D,p])=>p),i="ExtraIPOrders",console.log(t);break;case"51000":t=Object.entries(P.value).find(([D,p])=>p),i="ISPswOrders";break;case"52000":t=Object.entries(I.value).find(([D,p])=>p),i="DNSmanagerOrders",console.log(t);break;default:t=Object.entries(y.value).find(([D,p])=>p),i="Orders",console.log(t)}t&&e.emit("open-modal",{component:"StatusHistory",data:{modeID:i,rowID:t[1].ID}})}const a=c=>{const s=b(c);if(s){const t=s.split(","),i=t.length,D=t.join(`
`);return`Всего: ${i}
${D}`}return"Нет данных"},b=c=>{console.log(c);const s=Object.entries(I.value).reduce((t,[i,D])=>(t[i]=D,t),{});for(const t in s)if(Object.hasOwnProperty.call(s,t)){const i=s[t];if(String(i.OrderID)===String(c))return i.Parked}return null};function B(c,s,t){s==="51000"?_.push(`/ISPswOrderPay/${c}`):s==="52000"?_.push(`/DNSmanagerOrderPay/${c}`):s==="50000"&&_.push(`/ExtraIPOrderPay/${c}`)}function r(c,s,t){t.target.closest("button, a, .clickable-element")||_.push(`/AdditionalServices/${c.ID}`)}function j(c,s){e.emit("open-modal",{component:"OrdersTransfer",data:{ServiceOrderID:c,ServiceID:s}})}function o(c,s){let t;s==="51000"?t=Object.entries(P.value).reduce((D,[p,F])=>(D[p]=F,D),{}):s==="52000"&&(t=Object.entries(I.value).reduce((D,[p,F])=>(D[p]=F,D),{}));let i;for(const D in t)if(Object.hasOwnProperty.call(t,D)){const p=t[D];if(String(p.OrderID)===String(c)){i=p;break}}i&&O.OrderManageHosting({ServiceOrderID:i.ID,OrderID:c,ServiceID:s,XMLHttpRequest:"yes"})}const v=c=>{console.log(c);const s=Object.entries(I.value).reduce((t,[i,D])=>(t[i]=D,t),{});for(const t in s)if(Object.hasOwnProperty.call(s,t)){const i=s[t];if(String(i.OrderID)===String(c))return i.Domain}return null};$(()=>{console.log(I),console.log(k)});const y=A(()=>{var c,s;return(s=(c=Object.keys(m==null?void 0:m.userOrders).map(t=>{var i;return{...m==null?void 0:m.userOrders[t],ID:Number((i=m==null?void 0:m.userOrders[t])==null?void 0:i.ID)}}))==null?void 0:c.reverse())==null?void 0:s.filter(t=>t.ServiceID===(u==null?void 0:u.sectionID))});function V(){_.push(`/AdditionalServicesOrder?ServiceID=${u==null?void 0:u.sectionID}`)}function ae(c){if(!c)return W(new Date);const s=new Date,t=new Date(s.getTime()+c*24*60*60*1e3);return W(t)}return de(I,c=>{console.log(c)}),await f.fetchDNSmanagerOrders(),await f.fetchISPswOrders(),await f.fetchExtraIPOrders(),{authStore:m,getOrders:y,getContracts:k,sortBy:T,sortDesc:H,sortDirection:C,navigateToOrder:V,servicesStatuses:fe,oneTimeWorksFields:he,calculateExpirationDate:ae,getDNSmanagerOrders:I,findDomainByOrderID:v,findParkedByOrderID:b,getTitleText:a,transferItem:j,orderManage:o,servicePay:B,handlePayment:d,navigateToOrderPage:r,openHistoryStatuses:n}}},ce=J(Re,[["render",Ve],["__scopeId","data-v-ef87a8ef"]]),Ge={class:"section"},Fe={class:"container"},qe={class:"section-header"},ze={class:"section-nav"},Ke=["title","onClick"],We={class:"multiselect-option"},Xe={class:"section-body"};function Je(u,_,m,e,T,H){var P,x,k,d,n,a,b,B;const C=re,w=be,f=q("Multiselect"),O=ce,I=G;return h(),R(z,null,[S(C),l("div",Ge,[l("div",Fe,[l("div",qe,[l("div",ze,[(h(!0),R(z,null,_e((P=e.getServices)==null?void 0:P.slice(0,3),r=>{var j;return h(),R("div",{class:K(["section-nav__item",{"section-link":!0,"section-link-active":e.section===(r==null?void 0:r.ID)}]),title:(j=e.getServerGroup(r==null?void 0:r.ServersGroupID))==null?void 0:j.Comment,onClick:o=>e.switchToSection(r==null?void 0:r.ID)},N(r==null?void 0:r.Item),11,Ke)}),256)),((x=e.getServices)==null?void 0:x.length)>3?(h(),E(f,{key:0,modelValue:e.section,"onUpdate:modelValue":_[0]||(_[0]=r=>e.section=r),class:K({"multiselect--white additional-service__select":!0,"additional-service__select_active":(d=e.getServices)==null?void 0:d.slice(3,(k=e.getServices)==null?void 0:k.length).find(r=>(r==null?void 0:r.ID)===e.section)}),options:(a=e.getServices)==null?void 0:a.slice(3,(n=e.getServices)==null?void 0:n.length),label:"ID",onSelect:_[1]||(_[1]=r=>e.switchToSection(r))},{option:g(({option:r})=>[l("div",We,N(r==null?void 0:r.Item),1)]),caret:g(()=>[S(w,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):X("",!0)])]),l("div",Xe,[(b=e.getServices)!=null&&b.find(r=>r.ID===e.section)?(h(),E(O,{key:0,sectionID:e.section,sectionData:(B=e.getServices)==null?void 0:B.find(r=>r.ID===e.section),onDeleteItem:e.deleteItem},null,8,["sectionID","sectionData","onDeleteItem"])):(h(),E(I,{key:1,label:"Услуга не найдена"}))])])])],64)}const Qe={components:{ServiceListSection:ce,emptyStateBlock:G,Multiselect:Oe,BlockBalanceAgreement:re},async setup(){const u=ue(),_=Q(),m=Z("emitter"),e=ee(),T=me(),H=ne(),C=Y(),w=te(),f=M(null),O=A(()=>{var d;return(d=Object.keys(e==null?void 0:e.ServicesList))==null?void 0:d.map(n=>{var a;return{...e==null?void 0:e.ServicesList[n],value:(a=e==null?void 0:e.ServicesList[n])==null?void 0:a.ID}}).filter(n=>(n==null?void 0:n.ServicesGroupID)!=="1000"&&(n==null?void 0:n.IsActive)&&!(n!=null&&n.IsHidden)).sort((n,a)=>Number(n==null?void 0:n.SortID)<Number(a==null?void 0:a.SortID)?-1:Number(n==null?void 0:n.SortID)>Number(a==null?void 0:a.SortID)?1:0)}),I=M(null);m.on("updateServicesList",()=>{C.fetchUserOrders()});function P(d){_.replace(`/AdditionalServices?ServiceID=${d}`),I.value=d}function x(d){var n,a;return(a=(n=T==null?void 0:T.serverGroupsList)==null?void 0:n.ServersGroups)==null?void 0:a[d]}function k(d){H.deleteItem({TableID:"Orders",RowsIDs:d.ID}).then(({result:n,error:a})=>{n==="SUCCESS"&&C.fetchUserOrders()})}return $(()=>{var d,n;console.log(O.value),(d=O.value)!=null&&d.find(a=>{var b;return(a==null?void 0:a.ID)===((b=u==null?void 0:u.query)==null?void 0:b.ServiceID)})?I.value=(n=u==null?void 0:u.query)==null?void 0:n.ServiceID:_.replace(`/AdditionalServices?ServiceID=${I.value}`)}),await e.fetchServices().then(()=>{var d,n;I.value=(n=(d=O.value)==null?void 0:d[0])==null?void 0:n.ID}),await w.fetchContracts(),await C.fetchUserOrders(),await e.fetchDNSmanagerOrders(),await e.fetchISPswOrders(),await e.fetchExtraIPOrders(),{section:I,deleteItem:k,getServices:O,additionalServicesValue:f,switchToSection:P,getServerGroup:x}}},It=J(Qe,[["render",Je],["__scopeId","data-v-bcf4ce6d"]]);export{It as default};
