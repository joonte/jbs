import{j as Z,o as r,c as u,a as n,b as _,w as L,d as U,t as x,F as A,v as M,k as i,x as y,n as O,p as $,l as ee,_ as le,u as oe,e as ae,a6 as se,r as v,g as z}from"./index-1c309346.js";import{u as re}from"./contracts-7b919c67.js";import{s as ne}from"./SimpleCheckbox-5ed39d0e.js";import{_ as G}from"./BasicInput-33bf464f.js";import{P as J,T as K,S as Q}from"./PhoneInput-6d09e8c6.js";import{u as ce}from"./files-9e0f878c.js";import{I as W}from"./IconFile-079fb40d.js";import{I as X}from"./IconClose-7cf50ca7.js";import{E as te}from"./EmptyStateBlock-5a6a4cd4.js";import{_ as ue}from"./ButtonDefault-cd183bf8.js";import{f as fe}from"./bootstrap-vue-next.es-b799f76d.js";import{_ as de}from"./IconClip-fc8c1c22.js";import{_ as pe}from"./ClausesKeeper-b9906182.js";import"./component2-139d1cad.js";import"./component-a2c8255f.js";import"./multiselect-b7ad6876.js";const Y=h=>($("data-v-4fbb744c"),h=h(),ee(),h),_e={class:"section"},ie={class:"container"},ve={class:"section-header"},he={class:"breadcrumb"},be=Y(()=>n("h1",{class:"section-title"},"Редактировать договор",-1)),ke={class:"form"},ge={class:"form-row-wrapper"},ye={class:"special-form-row"},Ce={key:0,class:"section-header inputs-block"},Ve={class:"section-block_title"},Ie={key:0,class:"form width-limit"},me={key:0,class:"form-field form-field--file form-field--basic"},Ee={class:"chat-files"},Pe={class:"chat-files__item"},Te={key:1,class:"form-field form-field--file form-field--basic"},Se={class:"chat-files"},Fe={class:"chat-files__item"},we=["onClick"],De={class:"form-field form-field--file form-field--basic"},Le={class:"form-field-input__file-wrapper"},Ue={class:"form-field-input__file"},xe=Y(()=>n("span",null,"Прикрепить документ подтверждающий личность",-1)),Ae=["innerHTML"];function Oe(h,t,j,l,P,C){var w,D,m,a,c;const b=Z("router-link"),d=pe,T=G,k=J,S=K,V=Q,I=W,g=X,F=de,p=fe,N=ue,H=te;return r(),u("div",_e,[n("div",ie,[n("div",ve,[n("div",he,[_(b,{class:"section-label",to:"/Contracts"},{default:L(()=>[U("Договор /")]),_:1}),_(b,{class:"section-label",to:`/ContractScheme/${h.$route.params.id}`},{default:L(()=>{var e;return[U(x((e=l.getProfile)==null?void 0:e.Name),1)]}),_:1},8,["to"])]),be]),_(d),l.getProfile?(r(),u(A,{key:0},[n("div",ke,[(r(!0),u(A,null,M((c=(a=(m=(D=(w=l.getConfig)==null?void 0:w.Profiles)==null?void 0:D.Templates)==null?void 0:m[l.templateValue])==null?void 0:a.Template)==null?void 0:c.Attribs,(e,o)=>(r(),u("div",ge,[n("div",ye,[e!=null&&e.Title?(r(),u("div",Ce,[n("h2",Ve,x(e==null?void 0:e.Title),1)])):i("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)!=="Phone"?(r(),y(T,{key:1,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":s=>l.form[o].value=s},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):i("",!0),(e==null?void 0:e.Type)==="Input"&&(e==null?void 0:e.Check)==="Phone"?(r(),y(k,{key:2,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":s=>l.form[o].value=s},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):i("",!0),(e==null?void 0:e.Type)==="TextArea"?(r(),y(S,{key:3,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,modelValue:l.form[o].value,"onUpdate:modelValue":s=>l.form[o].value=s},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):(e==null?void 0:e.Type)==="Select"?(r(),y(V,{key:4,class:O({"special-form-input":!0,"form-field-error":l.form[o].error}),label:e==null?void 0:e.Comment,placeholder:e==null?void 0:e.Example,necessarily:(e==null?void 0:e.IsDuty)==="1",name:e==null?void 0:e.Check,options:e==null?void 0:e.Options,modelValue:l.form[o].value,"onUpdate:modelValue":s=>l.form[o].value=s},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):i("",!0)])]))),256))]),l.templateValue!==0?(r(),u("div",Ie,[l.fileListOld.length?(r(),u("div",me,[n("div",Ee,[(r(!0),u(A,null,M(l.fileListOld,(e,o)=>(r(),u("div",Pe,[n("span",null,[_(I,{class:"file-icon"})]),n("span",null,x(e==null?void 0:e.name),1)]))),256))])])):i("",!0),l.fileList.length?(r(),u("div",Te,[n("div",Se,[(r(!0),u(A,null,M(l.fileList,(e,o)=>(r(),u("div",Fe,[n("span",null,[_(I,{class:"file-icon"})]),n("span",null,x(e==null?void 0:e.name),1),n("button",{class:"close",onClick:s=>l.removeFile(o)},[_(g)],8,we)]))),256))])])):i("",!0),n("label",De,[n("div",Le,[n("input",{ref:"fileInput",type:"file",onChange:t[0]||(t[0]=(...e)=>l.fileUpload&&l.fileUpload(...e))},null,544),n("div",Ue,[_(F),xe])])]),_(p,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agree,"onUpdate:modelValue":t[1]||(t[1]=e=>l.agree=e)},{default:L(()=>[U("Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет")]),_:1},8,["modelValue"]),_(p,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:l.agreeHandle,"onUpdate:modelValue":t[2]||(t[2]=e=>l.agreeHandle=e)},{default:L(()=>[U("Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменто и т.п.)")]),_:1},8,["modelValue"])])):i("",!0),l.createProfileErrorMessage?(r(),u("div",{key:1,class:"error-message width-limit",innerHTML:l.formErrorMessage(l.createProfileErrorMessage)},null,8,Ae)):i("",!0),l.templateValue!==0?(r(),y(N,{key:2,class:"width-limit","is-loading":l.createProfileResult==="pending",label:"Сохранить",onClick:t[3]||(t[3]=e=>l.checkForm())},null,8,["is-loading"])):i("",!0)],64)):(r(),y(H,{key:1,label:"Профиль договора не найден"}))])])}const Ne={components:{TextAreaLine:K,simpleCheckbox:ne,basicInput:G,SelectLine:Q,PhoneInput:J,IconFile:W,IconClose:X},async setup(){const h=oe(),t=re(),j=ce(),l=ae(),P=se(),C=v(!1),b=v(!1),d=v({}),T=v(null),k=v([]),S=v([]),V=v(null),I=v(null),g=v(0),F=z(()=>h.ConfigList),p=z(()=>{var a;return(a=t.profileList)==null?void 0:a[P.params.id]});function N(){var c;let a=!1;if(Object.keys(d.value).forEach(e=>{d.value[e].value===null&&d.value[e].required?(d.value[e].error=!0,a=!0,console.log(a,"1")):d.value[e].error=!1}),!a&&C.value&&b.value){let e={},o=new FormData;Object.keys(d.value).forEach(s=>{var f;o.append(s,(f=d.value[s])==null?void 0:f.value)}),o.append("TemplateID",g.value),o.append("Agree",C.value),o.append("AgreeHandle",b.value),o.append("ProfileID",P.params.id),k.value.forEach((s,f)=>{o.append("Document[]",s==null?void 0:s.value)}),V.value="pending",t.createNewContract({ProfileID:(c=getContract.value)==null?void 0:c.ProfileID,TemplateID:g.value,Agree:C.value,AgreeHandle:b.value,...e}).then(s=>{var f;s.status==="success"?l.push(`/ContractScheme/${P.params.id}`):(V.value="error",I.value=(f=s.data)==null?void 0:f.Exception)})}}function H(a){k.value=k.value.filter((c,e)=>e!==a)}function w(a){return""+m(a)}function D(a){var e;let c=((e=a.target.files)==null?void 0:e[0])||null;c&&(T.value.value="",j.sendFile(c).then(o=>{k.value.push({name:c==null?void 0:c.name,value:o.slice(o.lastIndexOf("^")+1,o.length)})}))}function m(a){return a?"<div>"+(a==null?void 0:a.String)+"</div>"+m(a==null?void 0:a.Parent):""}return await t.fetchContracts().then(()=>{t.fetchProfiles().then(()=>{var a,c,e,o;g.value=(a=p.value)==null?void 0:a.TemplateID,(c=p.value)!=null&&c.Files&&(S.value=(o=Object.keys((e=p.value)==null?void 0:e.Files))==null?void 0:o.map(s=>{var f,E;return{name:(f=p.value)==null?void 0:f.Files[s].Name,value:(E=p.value)==null?void 0:E.Files[s].Name}})),Object.keys(p.value.Attribs).forEach(s=>{var f,E,B,R,q;d.value[s]={value:p.value.Attribs[s],required:((q=(R=(B=(E=(f=F.value)==null?void 0:f.Profiles)==null?void 0:E.Templates)==null?void 0:B[g.value])==null?void 0:R.Template)==null?void 0:q.Attribs[s].IsDuty)==="1",error:!1}})})}),await h.fetchConfig(),{getConfig:F,getProfile:p,templateValue:g,agreeHandle:b,fileInput:T,fileList:k,fileListOld:S,agree:C,createProfileResult:V,createProfileErrorMessage:I,checkForm:N,fileUpload:D,removeFile:H,formErrorMessage:w,form:d}}},el=le(Ne,[["render",Oe],["__scopeId","data-v-4fbb744c"]]);export{el as default};
