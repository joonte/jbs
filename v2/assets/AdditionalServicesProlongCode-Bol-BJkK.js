import{_ as R}from"./EmptyStateBlock-Dks67PsT.js";import{_ as $}from"./BlockOrderPayBalance-DhEnZ_L6.js";import{_ as M}from"./ClausesKeeper-DtaNhp0a.js";import{_ as j}from"./ButtonDefault-tVMF5ozh.js";import{_ as V}from"./BlockBalanceAgreement-ckI0MbGb.js";import{r as x,f as w,g as K,h as E,s as q,E as C,c as m,b as g,a as e,D as I,F as b,i as B,t as n,I as N,j as z,J as T,d as J,o as c}from"./index-DxPA2ffO.js";import{u as G}from"./contracts-DD2O0C6m.js";import{u as H}from"./services-DjjrPMAb.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-9iQSFcL_.js";import"./component-BeTqOa0q.js";import"./globalActions-DUlmxNCV.js";import"./IconHelp-D_mPG6iA.js";import"./IconClose-Br7S99e8.js";const W={class:"tw-px-4 md:tw-px-8"},X={class:"section"},Y={class:"section-header"},Z={class:"section-header__wrapper"},ee={class:"section-title"},te={class:"section-label"},oe={key:1,class:"section"},se={class:"total-block"},ae={class:"total-block__row divider-bottom"},le={class:"total-block__col"},ne={class:"total-block__col"},ce={class:"total-block__col"},re={class:"total-block__row total-block__row--big economy-line"},ie={class:"total-block__col flex-col"},de={class:"red"},ue={class:"total-block__row total-block__row--big"},_e={class:"total-block__col"},ve={class:"total-block__col"},me={__name:"AdditionalServicesProlongCode",async setup(pe){let d,u;const P=G(),r=H(),A=K(),O=J(),o=x(null),p=x(!1),a=w(()=>Object.keys(r?.ISPswOrdersList).map(t=>r?.ISPswOrdersList[t]).find(t=>t.OrderID===A.params.id)),F=t=>{t.key==="Enter"&&t.ctrlKey&&D()};E(()=>{document.addEventListener("keyup",F)}),q(()=>{document.removeEventListener("keyup",F)});const l=w(()=>r?.additionalServicesScheme?.ISPsw?Object.keys(r.additionalServicesScheme.ISPsw).map(t=>{const s=r.additionalServicesScheme.ISPsw[t];return{...s,value:s?.ID,name:s?.Name,cost:s?.CostDay,month:s?.CostMonth}}).filter(t=>t?.ID==a.value?.SchemeID):[]),S=w(()=>P.contractsList);function D(){p.value=!0;const t=parseFloat(S.value[a.value.ContractID]?.Balance)>=parseFloat(_(o.value?.price-k())??0),s=l.value[0]?.cost==="0.00"&&l.value[0]?.month==="0.00",h=t||s,y=!h,f={ISPswOrderID:a.value.ID,DaysPay:o.value?.actualDays,IsNoBasket:h,IsUseBasket:y,PayMessage:""};r.ISPswOrderPay(f).then(v=>{v==="UseBasket"?O.push("/Basket"):v==="NoBasket"&&O.push("/AdditionalServices?ServiceID=51000"),p.value=!1}).catch(v=>{console.error("ISPswOrderPay error:",v),p.value=!1})}function _(t){return Number(t).toFixed(2)||0}function k(){let t=0;return o.value?.discounts?.Bonuses.map(s=>{t+=+s.Economy}),t}function L(t){o.value=t}return E(()=>{r.fetchAdditionalServiceScheme("ISPsw")}),[d,u]=C(()=>r.fetchISPswOrders()),await d,u(),[d,u]=C(()=>r.fetchAdditionalServiceScheme("ISPsw")),await d,u(),[d,u]=C(()=>P.fetchContracts()),await d,u(),(t,s)=>{const h=V,y=j,f=M,v=$,U=R;return c(),m(b,null,[g(h),e("div",W,[a.value?(c(),m(b,{key:0},[e("section",X,[e("div",Y,[e("div",Z,[e("h1",ee,"Оплата заказа ПО ISPsystem, "+n(a.value?.IP||""),1),l.value[0]?.ConsiderTypeID!=="Upon"?(c(),I(y,{key:0,class:"btn--wide",label:parseFloat(S.value[a.value.ContractID]?.Balance)>=parseFloat(o.value?.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||o.value?.price===null,"is-loading":p.value,onClick:s[0]||(s[0]=i=>D())},null,8,["label","disabled","is-loading"])):B("",!0)]),e("div",te,n(l.value[0]?.Name),1)]),g(f)]),l.value[0]?.ConsiderTypeID!=="Upon"?(c(),I(v,{key:0,contractID:a.value?.ContractID,daysRemainded:a.value?.DaysRemainded,serviceID:"51000",scheme:l.value[0],orderID:a.value?.OrderID,isOrderID:!0,onSelect:L},null,8,["contractID","daysRemainded","scheme","orderID"])):B("",!0),a.value?(c(),m("section",oe,[e("div",se,[o.value?.discounts?.Bonuses?.length>0?(c(),m(b,{key:0},[e("div",ae,[s[2]||(s[2]=e("div",{class:"total-block__col"},"Цена тарифа",-1)),e("div",le,n(_(o.value?.price))+" ₽",1)]),(c(!0),m(b,null,z(o.value?.discounts?.Bonuses,i=>(c(),m("div",{class:"total-block__row no-divider",key:i?.Discount+"-"+i?.Days},[e("div",ne,"Скидка "+n(i?.Discount)+"% на "+n(i?.Days)+" дней",1),e("div",ce,"-"+n(_(i?.Economy))+" ₽",1)]))),128)),N(e("div",re,[s[3]||(s[3]=e("div",{class:"total-block__col red"},"Выгода",-1)),e("div",ie,[e("span",null,[e("s",null,n(_(o.value?.price))+" ₽",1)]),e("span",de,"-"+n(k())+" ₽",1)])],512),[[T,o.value?.discounts?.Bonuses?.length>0]])],64)):B("",!0),N(e("div",ue,[e("div",_e,n(l.value[0]?.ConsiderTypeID==="Upon"?"Итого":`Итого за ${o.value?.label}`),1),e("div",ve,n(l.value[0]?.ConsiderTypeID==="Upon"?l.value[0]?.CostMonth:_(o.value?.price-k()))+" ₽ ",1)],512),[[T,o.value?.price||l.value[0]?.ConsiderTypeID==="Upon"]])]),g(y,{class:"btn--wide",label:parseFloat(S.value[a.value.ContractID]?.Balance)>=(_(o.value?.price-k())??0)?"Оплатить c баланса договора":"Добавить в корзину",disabled:(o.value===null||o.value?.price===null)&&l.value[0]?.ConsiderTypeID!=="Upon","is-loading":p.value,onClick:s[1]||(s[1]=i=>D())},null,8,["label","disabled","is-loading"])])):(c(),I(U,{key:2,class:"no-margin",label:"Заказ нельзя продлить"}))],64)):(c(),I(U,{key:1,label:"не удалось найти заказ хостинга"}))])],64)}}},Fe=Q(me,[["__scopeId","data-v-2605ed4a"]]);export{Fe as default};
