import{_ as H}from"./ButtonDefault-CMw2aBy6.js";import{_ as q}from"./TotalAmount.vue_vue_type_script_setup_true_lang-Dg-09YER.js";import{_ as F}from"./InputServiceSelect-Dvi-CxI4.js";import{_ as M}from"./BlockSelectContract-CsqQBTZj.js";import{_ as R}from"./ClausesKeeper-iUM0yapS.js";import{u as j,_ as G}from"./index-BO2gwtUe.js";import{_ as X}from"./BlockBalanceAgreement-v_bWuiVT.js";import{r as f,u as Z,S as J,f as p,I as Q,Z as Y,E as ee,o as _,c as D,b as v,a as m,F as N,g as te,C as se,w as E,n as $,v as re,h as ae,t as C,i as oe,d as ne}from"./index-Codq73aV.js";import{u as le}from"./services-DyPBvbVy.js";import{s as ie}from"./multiselect-DElL0Rlw.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./common-DyknwSqv.js";import"./InputSelect.vue_vue_type_script_setup_true_lang-D7E9_BoS.js";import"./IconChevronDown-DOsbTpSQ.js";import"./BasicInput-DeQAeyXe.js";import"./component-DqcwA9JN.js";import"./IconClose-Dia1noy8.js";const ce={class:"tw-px-4 md:tw-px-8"},de={class:"section-nav"},ve=["onClick"],me={class:"multiselect-option"},pe={class:"section-header"},fe={class:"section-title"},_e={__name:"AdditionalServicesOrder",async setup(Se){let O,b;const a=f(3),k=oe(),o=ne(),P=Z(),n=le(),y=j(),V=J(),l=f(null),i=f({}),d=f(!1),S=f(null),g=p(()=>y.contractsList[S.value]),u=p(()=>Object.keys(n?.ServicesList)?.map(t=>({...n?.ServicesList[t],value:n?.ServicesList[t]?.ID})).filter(t=>t?.ServicesGroupID!=1e3&&t?.IsActive&&!t?.IsHidden).sort((t,e)=>Number(t?.SortID)<Number(e?.SortID)?-1:Number(t?.SortID)>Number(e?.SortID)?1:0)),s=p(()=>u.value?.find(t=>t.ID==l.value)),B=p(()=>Number(i.value.Price||0)+Number(s.value.Cost)+Number(s.value.CostOn)),L=p(()=>Number(g.value?.Balance)>B.value?"Оплатить c баланса договора":"Заказать"),U=p(()=>"1 "+s.value.ID===5e4||s.value.ID===51e3||s.value.ID===52e3?"месяц":s.value.Measure);function A(t){l.value=t,i.value={},o.push(`/AdditionalServicesOrder?ServiceID=${t}`)}Q(()=>{window.addEventListener("resize",w),w()}),Y(()=>{window.removeEventListener("resize",w)});function w(){window.innerWidth>=1920?a.value=9:window.innerWidth>=1600?a.value=7:window.innerWidth>=1440?a.value=6:window.innerWidth>=1200?a.value=5:window.innerWidth>=992?a.value=4:a.value=3}async function x(){d.value=!0;const t={};for(const e of Object.keys(i.value))e.startsWith("ID")&&(t[e]=i.value[e]),e.endsWith("SchemeID")&&(t[e]=i.value[e]),e==="IP"&&(t[e]=i.value[e]);if(t.DependOrderID=i.value.DependOrderID,t.ContractID=S.value,t.ServiceID=s.value.ID,s.value.ID===5e4){const{result:e,info:c}=await n.ExtraIPOrder(t);d.value=!1,e==="SUCCESS"?o.push(`/ExtraIPOrderPay/${c.OrderID}`):e==="BASKET"&&o.push("/Basket")}else if(s.value.ID===51e3){const{result:e,info:c}=await n.ISPswOrder(t);d.value=!1,e==="SUCCESS"?o.push(`/ISPswOrderPay/${c.OrderID}`):e==="BASKET"&&o.push("/Basket")}else if(s.value.ID===52e3){const{result:e,info:c}=await n.DNSmanagerOrder(t);d.value=!1,e==="SUCCESS"?o.push(`/DNSmanagerOrderPay/${c.OrderID}`):e==="BASKET"&&o.push("/Basket")}else{const{result:e,info:c}=await n.ServiceOrder(t);if(e==="SUCCESS"){const h=await n.ServiceOrderPay(s.value.Code,{AmountPay:"1",ServiceOrderID:c?.ServiceOrderID,IsChange:!0},{XMLHttpRequest:"yes"});let{result:I}=h;I==="SUCCESS"?o.push(`/AdditionalServices?ServiceID=${s.value.ID}`):I==="BASKET"&&o.push("/Basket"),d.value=!1}else d.value=!1}}return[O,b]=ee(()=>Promise.all([y.fetchContracts(),P.fetchUserOrders(),n.fetchDNSmanagerOrders(),n.fetchServices(),V.fetchDomainOrders()])),await O,b(),u.value?.find(t=>t.ID===Number(k.query?.ServiceID))?l.value=Number(k.query?.ServiceID):(l.value=u.value?.[0]?.ID,o.replace(`/AdditionalServicesOrder?ServiceID=${l.value}`)),(t,e)=>{const c=X,h=G,I=R,W=M,T=F,K=q,z=H;return _(),D(N,null,[v(c,{"contract-id":g.value?.ID},null,8,["contract-id"]),m("div",ce,[m("div",de,[(_(!0),D(N,null,te(u.value?.slice(0,a.value),r=>(_(),D("div",{key:r?.ID,class:$([{"section-link":!0,"section-link-active":l.value===r?.ID},"section-nav__item"]),onClick:Ie=>A(r?.ID)},C(r?.Item),11,ve))),128)),u.value?.length>a.value?(_(),se(re(ie),{key:0,modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value=r),class:$(["multiselect-special",{"multiselect--white additional-service__select":!0,"additional-service__select_active":u.value?.slice(a.value,u.value?.length).find(r=>r?.ID===l.value)}]),options:u.value?.slice(a.value,u.value?.length),label:"ID",onSelect:e[1]||(e[1]=r=>A(r))},{option:E(({option:r})=>[m("div",me,C(r?.Item),1)]),caret:E(()=>[v(h,{class:"icon-arrow_caret"})]),_:1},8,["modelValue","class","options"])):ae("",!0)]),(_(),D("div",{key:l.value,class:"section-body tw-mt-4 tw-mb-6"},[m("section",null,[m("div",pe,[m("h1",fe,C(s.value?.Item),1),v(I,{partition:`Header:${s.value?.Code==="Default"?s.value.ID:`/${s.value?.Code}Orders`}`},null,8,["partition"])])]),v(W,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=r=>S.value=r),class:"additional-service__contract-select"},null,8,["modelValue"]),v(T,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=r=>i.value=r),"section-data":s.value},null,8,["modelValue","section-data"]),m("section",null,[v(K,{tariff:{label:U.value,price:B.value}},null,8,["tariff"]),v(z,{class:"btn--wide",label:L.value,"is-loading":d.value,onClick:e[4]||(e[4]=r=>x())},null,8,["label","is-loading"])])]))])],64)}}},Ue=ue(_e,[["__scopeId","data-v-236df6f4"]]);export{Ue as default};
