import{_ as z}from"./EmptyStateBlock-DA3-0YDi.js";import{L as Z,a as G}from"./bootstrap-vue-next-W16P-SAV.js";import{_ as H}from"./FormInputSearch-B47bjFcn.js";import{_ as J}from"./ClausesKeeper-iUM0yapS.js";import{_ as K}from"./BlockBalanceAgreement-v_bWuiVT.js";import{D as Q,r as i,I as W,f as g,E as D,o as _,c as S,b as c,a as s,w as l,v as r,F as V,h as X,C as Y,i as ee,d as te,t as a,n as se}from"./index-Codq73aV.js";import{u as oe}from"./index-BO2gwtUe.js";import{f as C}from"./common-DyknwSqv.js";import{s as B}from"./multiselect-DElL0Rlw.js";import{f as ae,s as le}from"./time-DenPiOX5.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-Bm8D3Wgq.js";import"./IconClose-Dia1noy8.js";import"./ButtonDefault-CMw2aBy6.js";const re=[{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"ServiceID",label:"Операция"},{key:"Comment",label:"Примечание"},{key:"Before",variant:"td-gray td-order",label:"До"},{key:"After",variant:"td-gray td-order",label:"После"},{key:"Change",variant:"td-gray td-order",label:"Сумма",sortable:!0}],ie={class:"tw-px-4 md:tw-px-8"},ue={class:"list-form"},ce={class:"list-form_col list-form_col--sm"},me={class:"list-form_select"},pe={class:"multiselect-option"},de={class:"d-block"},ve={class:"d-block"},fe={class:"d-block"},be={key:0,class:"table-controls"},ge={class:"multiselect-multiple-label"},_e={class:"multiselect-option"},Ce={__name:"Postings",async setup(ye){let m,p;const y=oe(),n=Q(),N=ee(),P=te(),v=i(""),u=i("*"),f=i(1),d=i(10),U=i([10,25,50,100]),w=i("CreateDate"),x=i(!0),A=i("desc");W(async()=>{await y.fetchContracts(),await n.fetchPostings(),await n.fetchServices();const o=N.query.ContractID;o&&(u.value=o||"*")});const b=g(()=>Object.keys(n?.postingsList).map(o=>({...n?.postingsList[o],Customer:h.value?.[n?.postingsList[o].ContractID]?.Customer,Change:E(n?.postingsList[o]?.Before,n?.postingsList[o]?.After)}))),F=g(()=>n?.servicesList),h=g(()=>y.contractsList),I=g(()=>{let o=[];return b.value.map(t=>{if(!o.find(k=>k===t.Customer))return o.push(t.Customer),{value:t.ContractID,name:t.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),L=g(()=>b.value.filter(o=>o.Comment.toLowerCase().includes(v.value?.toLowerCase())||o.Customer.toLowerCase().includes(v.value?.toLowerCase())).filter(o=>String(o.ContractID).includes(u.value!=="*"?u.value:"")).length);function E(o,t){return t-o>0,Number(Math.round((t-o+Number.EPSILON)*100)/100)}function $(){P.go(0)}function O(){f.value=1}return[m,p]=D(()=>y.fetchContracts()),await m,p(),[m,p]=D(()=>n.fetchPostings()),await m,p(),[m,p]=D(()=>n.fetchServices()),await m,p(),(o,t)=>{const k=K,R=J,M=H,T=Z,j=G,q=z;return _(),S(V,null,[c(k),s("div",ie,[s("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer tw-mb-4",onClick:t[0]||(t[0]=e=>$())}," История операций "),c(R),s("div",ue,[s("div",ce,[s("div",me,[c(r(B),{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),options:I.value,disabled:I.value?.length<=1,label:"name","track-by":"value"},{singlelabel:l(({value:e})=>[s("span",null,"# "+a(String(e.value).padStart(5,"0"))+" / "+a(e.name),1)]),option:l(({option:e})=>[s("span",pe,"# "+a(String(e.value).padStart(5,"0"))+" / "+a(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),c(M,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e)},null,8,["modelValue"])]),b.value&&b.value?.length>0?(_(),S(V,{key:0},[c(T,{class:"basic-table",items:b.value.filter(e=>String(e.ContractID).includes(u.value!=="*"?u.value:"")),fields:r(re),"show-empty":!0,filter:v.value,"per-page":d.value,"current-page":f.value,filterable:["Customer","Comment"],"sort-by":w.value,"onUpdate:sortBy":t[3]||(t[3]=e=>w.value=e),"sort-desc":x.value,"onUpdate:sortDesc":t[4]||(t[4]=e=>x.value=e),"sort-direction":A.value,"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Операций пока нет.","empty-filtered-text":"Операции не найдены.",onFiltered:O},{"cell(CreateDate)":l(e=>[t[8]||(t[8]=s("span",{class:"td-mobile"},"Дата Создания",-1)),s("span",de,a(r(ae)(r(le)(e.item?.CreateDate))),1)]),"cell(ContractID)":l(e=>[t[9]||(t[9]=s("span",{class:"td-mobile"},"Договор",-1)),s("span",null,"#"+a(e.item?.ContractID)+" / "+a(e.item?.Customer),1)]),"cell(Before)":l(e=>[t[10]||(t[10]=s("span",{class:"td-mobile"},"До",-1)),s("span",ve,a(r(C)(e.value)),1)]),"cell(After)":l(e=>[t[11]||(t[11]=s("span",{class:"td-mobile"},"После",-1)),s("span",fe,a(r(C)(e.value)),1)]),"cell(ServiceID)":l(e=>[t[12]||(t[12]=s("span",{class:"td-mobile"},"Операция",-1)),s("span",null,a(F.value?.[e.item?.ServiceID]?.Name),1)]),"cell(Change)":l(e=>[t[13]||(t[13]=s("span",{class:"td-mobile"},"Сумма",-1)),s("span",{class:se(["d-block",{positive:e.value>0,negative:e.value<0}])},a(e.value>0?`+${r(C)(e.value)}`:r(C)(e.value)),3)]),_:1},8,["items","fields","filter","per-page","current-page","sort-by","sort-desc","sort-direction"]),L.value>0?(_(),S("div",be,[c(j,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=e=>f.value=e),"total-rows":L.value,"per-page":d.value,"first-number":"","last-number":""},{"first-text":l(()=>t[14]||(t[14]=[s("span",{class:"text-success"},"First",-1)])),"last-text":l(()=>t[15]||(t[15]=[s("span",{class:"text-info"},"Last",-1)])),page:l(({page:e,active:ke})=>[s("span",null,a((e-1)*d.value+1)+"-"+a(e*d.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),c(r(B),{class:"multiselect--white",modelValue:d.value,"onUpdate:modelValue":t[6]||(t[6]=e=>d.value=e),options:U.value,label:"name",openDirection:"top",onInput:t[7]||(t[7]=e=>f.value=1)},{singlelabel:l(({value:e})=>[s("span",ge," Отображать "+a(e.value)+" строк ",1)]),option:l(({option:e})=>[s("span",_e," Отображать "+a(e.name)+" строк ",1)]),_:1},8,["modelValue","options"])])):X("",!0)],64)):(_(),Y(q,{key:1,label:"Ваша история операций пуста"}))])],64)}}},Ee=ne(Ce,[["__scopeId","data-v-bb5c6b72"]]);export{Ee as default};
