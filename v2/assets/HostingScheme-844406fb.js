import{E as Be}from"./EmptyStateBlock-153c9c6f.js";import{_ as Oe}from"./ButtonDefault-458eab69.js";import{_ as we}from"./BasicInput-4035fd95.js";import{f as Ee}from"./bootstrap-vue-next.es-a97602fc.js";import{_ as Ve}from"./BlockOrderPayBalance-cdc8f4d7.js";import{_ as pe,a7 as Se,e as he,r as S,i as De,o as I,c as C,a as t,n as _e,t as u,b as v,Z as M,a9 as Z,m as ve,F as T,S as $e,g as R,O as Pe,ag as z,w as ee,d as Ne,x as me,k as He,p as xe,l as Ue}from"./index-5f8fd0e9.js";import{u as Ae}from"./hosting-988d22d7.js";import{u as Fe}from"./contracts-00b6c53b.js";import{u as Re}from"./domain-afe1e9d6.js";import{u as Te}from"./services-0121b428.js";import{_ as Le}from"./paramsAccordionBlock-0292e6b4.js";import{D as Ke}from"./DomainCheckBlock-c5a32b75.js";import{_ as qe}from"./BlockSelectContract-adea085a.js";import{_ as We}from"./ClausesKeeper-8218189c.js";import je from"./BlockAdditionalServices-6d65502b.js";import{B as Ge}from"./BlockBalanceAgreement-cf03db60.js";import"./component-62d13c49.js";import"./IconHelp-9923896d.js";import"./globalActions-2cf5b597.js";import"./IconArrow-c9744352.js";/* empty css                                                                             */import"./multiselect-482845f2.js";import"./IconClose-2e1ba86d.js";import"./ServiceListOrderSelection-581762f7.js";const ze={class:"section"},Me={class:"container"},Ze={class:"section-nav"},Je={__name:"BlockOrderServiceWrapper",props:{basic_title:{type:String,default:"basic_title"},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(H,{emit:h}){const D=H,m=Se(),V=he(),n=S("");function b(){return m.fullPath.includes("?section=Services")}function q(d=null){d?(n.value="Services",V.replace({query:{section:"Services"}})):(n.value="",V.replace({query:{}})),h("update:modelValue",d||"")}return De(()=>{m.query.section==="Services"&&(n.value="Services")}),(d,_)=>{const L=We;return I(),C(T,null,[t("div",ze,[t("div",Me,[t("div",Ze,[t("div",{class:_e(["section-nav__item",[b()?"":"active"]]),onClick:_[0]||(_[0]=$=>q())},u(D.basic_title),3),t("div",{class:_e(["section-nav__item",[b()?"active":""]]),onClick:_[1]||(_[1]=$=>q("Services"))},"Услуги",2)])])]),v(L),t("div",null,[M(t("div",null,[ve(d.$slots,"page",{},void 0,!0)],512),[[Z,n.value===""]]),M(t("div",null,[ve(d.$slots,"services",{},void 0,!0)],512),[[Z,n.value!==""]])])],64)}}},Qe=pe(Je,[["__scopeId","data-v-e8bb070c"]]);const J=H=>(xe("data-v-ffd832c0"),H=H(),Ue(),H),Xe={class:"hosting-sheme"},Ye={class:"section"},et={class:"container"},tt={class:"section-header"},lt={class:"section-title"},st=J(()=>t("div",{class:"section-label"},"Хостинг",-1)),ot={class:"container"},at={class:"section"},nt={class:"container"},ct={class:"total-block"},rt={class:"total-block__row divider-bottom"},it=J(()=>t("div",{class:"total-block__col"},"Цена тарифа",-1)),ut={class:"total-block__col"},dt={class:"total-block__row no-divider"},_t={class:"total-block__col"},vt={class:"total-block__col"},mt={class:"total-block__row"},pt=J(()=>t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),St={class:"total-block__col"},ht={class:"total-block__row no-divider"},Dt={class:"total-block__col"},bt={class:"total-block__col"},ft={class:"total-block__row total-block__row--big economy-line"},kt=J(()=>t("div",{class:"total-block__col red"},"Выгода",-1)),yt={class:"total-block__col flex-col"},gt={class:"red"},It={class:"total-block__row total-block__row--big"},Ct={class:"total-block__col"},Bt={class:"total-block__col"},Ot={key:1,class:"section"},wt={class:"container"},Et={__name:"HostingScheme",async setup(H){let h,D;const m=Ae(),V=Fe(),n=Re(),b=Te();$e("emitter");const q=Se(),d=he(),_=S(!1),L=S(""),$=S([]),Q=S(!1),o=S(null),K=S([]),x=S(!1),f=S(null),W=S(null),te=S(""),le=l=>{l.key==="Enter"&&l.ctrlKey&&!be.value&&ae()},be=R(()=>o.value===null||f.value===null),P=R(()=>{var l;return(l=m==null?void 0:m.hostingSchemes)==null?void 0:l[q.params.id]}),fe=R(()=>V==null?void 0:V.contractsList),se=R(()=>b==null?void 0:b.ServicesList),ke=R(()=>{var l;return(l=Object.keys(n==null?void 0:n.domainSchemes))==null?void 0:l.map(e=>{var i;return{...n==null?void 0:n.domainSchemes[e],value:(i=n==null?void 0:n.domainSchemes[e])==null?void 0:i.ID}})}),X=R(()=>{let l=0;return K.value.forEach(e=>{l+=e==null?void 0:e.Price}),B(l)||0});De(()=>{document.addEventListener("keyup",le)}),Pe(()=>{document.removeEventListener("keyup",le)});function Y(){var e,i;let l=0;return(i=(e=o.value)==null?void 0:e.discounts)==null||i.Bonuses.map(k=>{l+=+k.Economy}),l}function B(l){return Number(l).toFixed(2)||0}function ye(l){$.value=l}function ge(){_.value=!1,console.log("Not")}function Ie(){_.value=!0,console.log("Own")}function Ce(l){o.value=l}async function oe(l){var e;for(const i of K.value){let k="SUCCESS",y=(e=se.value[i.ServiceID])==null?void 0:e.Code;if(await b.ServiceOrder({Code:y,DependOrderID:l,...i,ContractID:f.value}).then(({result:U,info:p,error:A})=>{if(U==="SUCCESS"){let g={};y==="Default"?g.ServiceOrderID=p==null?void 0:p.ServiceOrderID:g[`${y}OrderID`]=p==null?void 0:p.ServiceOrderID,b.ServiceOrderPay(y,g).then(N=>{let{result:c,error:a}=N;c==="SUCCESS"?d.push("/AdditionalServices}"):c==="BASKET"&&d.push("/Basket")})}else k="ERROR"}),k==="ERROR")break}}function ae(){var y,U,p,A,g,N;x.value=!0;let l=0,e,i,k;$.value.length>0&&(e=$.value[l],i=$.value.map(c=>`${c.line}${c.line&&c.Name?"."+c.Name:""}`),k=$.value.map(c=>`${c.ID}`)),_.value===!1?m.HostingOrder({ContractID:f.value,Domain:i||null,DomainName:(e==null?void 0:e.line)||null,HostingSchemeID:(y=P.value)==null?void 0:y.ID,DomainSchemeID:k||null,DomainTypeID:e!=null&&e.line?e!=null&&e.Name?"Order":"Nothing":"None"}).then(({result:c,info:a,error:j})=>{var O,w;c==="SUCCESS"?(l++,oe(a==null?void 0:a.OrderID),m.HostingOrderPay({HostingOrderID:a==null?void 0:a.HostingOrderID,DaysPayFromBallance:((O=o.value)==null?void 0:O.daysFromBalance)||0,DaysPay:(w=o.value)==null?void 0:w.actualDays}).then(F=>{let{result:E,error:G}=F;E==="SUCCESS"?d.push("/HostingOrders"):E==="BASKET"&&d.push("/Basket"),x.value=!1})):x.value=!1}):(console.log(!0),m.HostingOrder({ContractID:f.value,Domain:L.value,DomainName:(U=W.value)==null?void 0:U.line,HostingSchemeID:(p=P.value)==null?void 0:p.ID,DomainSchemeID:(A=W.value)!=null&&A.line&&((g=W.value)!=null&&g.ID)?(N=W.value)==null?void 0:N.ID:null,DomainTypeID:"Nothing"}).then(({result:c,info:a,error:j})=>{var O,w;c==="SUCCESS"?(oe(a==null?void 0:a.OrderID),m.HostingOrderPay({HostingOrderID:a==null?void 0:a.HostingOrderID,DaysPayFromBallance:((O=o.value)==null?void 0:O.daysFromBalance)||0,DaysPay:(w=o.value)==null?void 0:w.actualDays}).then(F=>{let{result:E,error:G}=F;E==="SUCCESS"?d.push("/HostingOrders"):E==="BASKET"&&d.push("/Basket"),x.value=!1})):x.value=!1}))}return[h,D]=z(()=>n.fetchDomainSchemes()),await h,D(),[h,D]=z(()=>m.fetchHostingSchemes()),await h,D(),[h,D]=z(()=>V.fetchContracts()),await h,D(),[h,D]=z(()=>b.fetchServices()),await h,D(),(l,e)=>{var A,g,N,c,a,j,O,w,F,E,G,ne,ce,re,ie,ue,de;const i=Ve,k=Ee,y=we,U=Oe,p=Be;return I(),C(T,null,[v(Ge),t("div",Xe,[(A=P.value)!=null&&A.ID?(I(),C(T,{key:0},[t("div",Ye,[t("div",et,[t("div",tt,[t("h1",lt,u((g=P.value)==null?void 0:g.Name),1),st])])]),v(Qe,{basic_title:"Хостинг",modelValue:te.value,"onUpdate:modelValue":e[7]||(e[7]=s=>te.value=s)},{page:ee(()=>{var s;return[v(Le,{"params-list":(s=P.value)==null?void 0:s.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),v(qe,{title:"Договор",modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=r=>f.value=r)},null,8,["modelValue"]),v(i,{contractID:f.value,scheme:P.value,serviceID:"10000",isOrderID:!1,onSelect:Ce,isBalancePay:Q.value,"onUpdate:isBalancePay":e[1]||(e[1]=r=>Q.value=r)},null,8,["contractID","scheme","isBalancePay"]),v(Ke,{disabled:_.value,"domain-list":ke.value,onClick:e[2]||(e[2]=r=>ge()),onSelect:ye},null,8,["disabled","domain-list"]),t("div",ot,[v(k,{id:"check-1",modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=r=>_.value=r),name:"checkbox-1"},{default:ee(()=>[Ne("Использовать свой домен")]),_:1},8,["modelValue"]),v(y,{label:"Домен",name:"own-domain",onClick:e[4]||(e[4]=r=>Ie()),disabled:!_.value,modelValue:L.value,"onUpdate:modelValue":e[5]||(e[5]=r=>L.value=r)},null,8,["disabled","modelValue"])])]}),services:ee(()=>{var s;return[v(je,{modelValue:K.value,"onUpdate:modelValue":e[6]||(e[6]=r=>K.value=r),serviceSearchParams:{ServiceID:"10000",ServersGroupID:(s=P.value)==null?void 0:s.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]}),_:1},8,["modelValue"]),t("div",at,[t("div",nt,[M(t("div",ct,[((a=(c=(N=o.value)==null?void 0:N.discounts)==null?void 0:c.Bonuses)==null?void 0:a.length)>0?(I(),C(T,{key:0},[t("div",rt,[it,t("div",ut,u(B((j=o.value)==null?void 0:j.price))+" ₽",1)]),(I(!0),C(T,null,me((w=(O=o.value)==null?void 0:O.discounts)==null?void 0:w.Bonuses,s=>(I(),C("div",dt,[t("div",_t,"Скидка "+u(s==null?void 0:s.Discount)+"% на "+u(s==null?void 0:s.Days)+" дней",1),t("div",vt,"-"+u(B(s==null?void 0:s.Economy))+" ₽",1)]))),256))],64)):He("",!0),t("div",mt,[pt,t("div",St,u(X.value)+" ₽",1)]),(I(!0),C(T,null,me(K.value,s=>{var r;return I(),C("div",ht,[t("div",Dt,u((r=se.value[s==null?void 0:s.ServiceID])==null?void 0:r.Name),1),t("div",bt,u(B(s==null?void 0:s.Price))+" ₽",1)])}),256)),M(t("div",ft,[kt,t("div",yt,[t("span",null,[t("s",null,u(B((F=o.value)==null?void 0:F.price))+" ₽",1)]),t("span",gt,"-"+u(B(Y()))+" ₽",1)])],512),[[Z,((ne=(G=(E=o.value)==null?void 0:E.discounts)==null?void 0:G.Bonuses)==null?void 0:ne.length)>0]]),t("div",It,[t("div",Ct,"Итого за "+u((ce=o.value)==null?void 0:ce.label),1),t("div",Bt,u(B(((re=o.value)==null?void 0:re.price)-Y()+ +X.value))+" ₽",1)])],512),[[Z,(ie=o.value)==null?void 0:ie.price]]),v(U,{class:"btn--wide",label:Q.value||((ue=fe.value[f.value])==null?void 0:ue.Balance)>B(((de=o.value)==null?void 0:de.price)-Y()+ +X.value)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||f.value===null,"is-loading":x.value,onClick:e[8]||(e[8]=s=>ae())},null,8,["label","disabled","is-loading"])])])],64)):(I(),C("div",Ot,[t("div",wt,[v(p,{label:"Тариф не найден"})])]))])],64)}}},el=pe(Et,[["__scopeId","data-v-ffd832c0"]]);export{el as default};
