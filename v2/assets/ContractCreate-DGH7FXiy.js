import{_ as z}from"./ButtonDefault-CghIUDY0.js";import{m as G}from"./bootstrap-vue-next-3DpAa4tb.js";import{_ as J}from"./IconClip-Du848aq1.js";import{_ as Q}from"./IconClose-ChC2G6HM.js";import{_ as W}from"./IconFile-F4S-E8U9.js";import{_ as X,a as Y,b as Z}from"./PhoneInput-Cc-Mwvf_.js";import{_ as $}from"./BasicInput-BYe5b9L8.js";import{_ as ee}from"./SimpleCheckbox-D8m7Qqoe.js";import{_ as oe}from"./ClausesKeeper-DVJgfLR3.js";import{_ as le}from"./BlockBalanceAgreement-2iQbaweR.js";import{c as m,b as _,a as r,h as d,C,w as S,E as ae,F as P,i as F,ao as te,u as re,r as v,f as L,H as N,s as ne,m as se,g as ce,x as ue,d as ie,o as n,e as M,t as H,n as R}from"./index-CipWZKo_.js";import{u as me}from"./contracts-CILh9uSu.js";import{u as fe}from"./files-CtBs4iPb.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./multiselect-DWCHRlfT.js";import"./component-DWBAga-C.js";const de={setup(){const q=te(),a=me(),x=re(),o=fe(),g=ie(),u=ce(),U=ue("emitter"),b=v(!1),V=v(!1),h=v({}),D=v(null),k=v([]),y=v(null),E=v(null),c=v(0),f=L(()=>q.data),w=L(()=>x?.userInfo?.Email),T=f.value,I={};for(const l in T.Regulars)I[l]=T.Regulars[l];const e=l=>I[l]||null,t=()=>{const l=f.value;return l&&l.Regulars&&l.Regulars.Phone?new RegExp(l.Regulars.Phone):/^[0-9]{10}$/},i=l=>{l.key==="Enter"&&l.ctrlKey&&A()};N(()=>{document.addEventListener("keyup",i)}),ne(()=>{document.removeEventListener("keyup",i)});function O(l){k.value=k.value.filter((s,p)=>p!==l)}function A(){if(b.value&&V.value){let l=new FormData;Object.keys(h.value).forEach(s=>{l.append(s,h.value[s]?.value)}),l.append("TemplateID",c.value),l.append("Agree",b.value),l.append("AgreeHandle",V.value),k.value.forEach((s,p)=>{l.append("Document[]",s?.value)}),y.value="pending",a.createNewContractFormData(l).then(s=>{s.status==="success"?(y.value="success",u.query.ProfileEmpty?a.contractMake({ProfileID:s.data?.ProfileID,TypeID:c.value}).then(p=>{p.data.Status==="Ok"&&(U.emit("open-modal",{component:"SuccessContract",data:"Профиль и договор успешно созданы!"}),u.query.Redirect?g.push(`${u.query.Redirect}`):g.push("/Contracts"))}):u.query.ContractNew?a.contractMake({ProfileID:s.data?.ProfileID,TypeID:c.value}).then(p=>{p.data.Status==="Ok"&&g.push("/Basket")}):u.query.Contract?g.push(`/Balance/${u.query.Contract}`):!u.query.Contract&&u.query.TemplateID?g.push("/Basket"):g.push("/Contracts")):(y.value="error",E.value=s.data?.Exception)})}}function j(l){return""+B(l)}function B(l){return l?"<div>"+l?.String+"</div>"+B(l?.Parent):""}function K(l){let s=l.target.files?.[0]||null;s&&(D.value.value="",o.sendFile(s).then(p=>{k.value.push({name:s?.name,value:p.slice(p.lastIndexOf("^")+1,p.length)})}))}return se(c,()=>{h.value={},Object.keys(f.value?.Profiles?.Templates?.[c.value]?.Template?.Attribs).forEach(l=>{h.value[l]={error:!1,value:(f.value?.Profiles?.Templates?.[c.value]?.Template?.Attribs[l]?.Value==="%Email%"?w.value:f.value?.Profiles?.Templates?.[c.value]?.Template?.Attribs[l]?.Value)||null,required:f.value?.Profiles?.Templates?.[c.value]?.Template?.Attribs[l]?.IsDuty==="1"}})}),N(()=>{f.value?.Contracts?.Types&&u.query.TemplateID&&(c.value=u.query.TemplateID)}),{getConfig:f,templateValue:c,agreeHandle:V,agree:b,createProfileResult:y,createProfileErrorMessage:E,checkForm:A,formErrorMessage:j,form:h,fileInput:D,fileList:k,removeFile:O,fileUpload:K,getPhoneRegex:t,getFieldRegex:e,fieldRegexMap:I}}},_e={class:"section"},ve={class:"container"},ge={class:"tw-mb-4"},he={class:"form"},ke={class:"form"},ye={class:"special-form-row"},Ce={key:0,class:"section-header inputs-block"},be={class:"section-block_title"},Ve={key:0,class:"form width-limit"},Te={key:0,class:"form-field form-field--file form-field--basic"},Ie={class:"chat-files"},Pe=["onClick"],De={class:"form-field form-field--file form-field--basic"},Ee={class:"form-field-input__file-wrapper"},Re={class:"form-field-input__file"},Ue=["innerHTML"];function we(q,a,x,o,g,u){const U=le,b=ae("router-link"),V=oe,h=ee,D=$,k=X,y=Y,E=Z,c=W,f=Q,w=J,T=G,I=z;return n(),m(P,null,[_(U),r("section",_e,[r("div",ve,[r("div",ge,[_(b,{to:"/Contracts",class:"section-label"},{default:S(()=>a[5]||(a[5]=[M("Мои договора",-1)])),_:1,__:[5]}),a[6]||(a[6]=r("h1",{class:"section-title"},"Создать профиль",-1))]),_(V),a[10]||(a[10]=r("div",{class:"section-header"},[r("h2",{class:"section-block_title"},"Шаблон")],-1)),r("form",he,[(n(!0),m(P,null,F(o.getConfig?.Contracts?.Types,e=>(n(),m(P,{key:e?.ProfileTemplateID},[e?.ProfileTemplateID!==""?(n(),C(h,{key:0,label:e?.Name,value:e?.ProfileTemplateID,modelValue:o.templateValue,"onUpdate:modelValue":a[0]||(a[0]=t=>o.templateValue=t)},null,8,["label","value","modelValue"])):d("",!0)],64))),128))]),r("form",ke,[(n(!0),m(P,null,F(o.getConfig?.Profiles?.Templates?.[o.templateValue]?.Template?.Attribs,(e,t)=>(n(),m("div",{class:"form-row-wrapper",key:t},[r("div",ye,[e?.Title?(n(),m("div",Ce,[r("h2",be,H(e?.Title),1)])):d("",!0),e?.Type==="Input"&&e?.Check!=="Phone"?(n(),C(D,{key:1,class:R({"special-form-input":!0,"form-field-error":o.form[t].error,"form-error":!o.form[t].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:o.form[t].value,"onUpdate:modelValue":i=>o.form[t].value=i,pattern:o.getFieldRegex(e?.Check)},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue","pattern"])):d("",!0),e?.Type==="Input"&&e?.Check==="Phone"?(n(),C(k,{key:2,class:R({"special-form-input":!0,"form-field-error":o.form[t].error,"form-error":!o.form[t].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:o.form[t].value,"onUpdate:modelValue":i=>o.form[t].value=i,pattern:o.getPhoneRegex()},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue","pattern"])):d("",!0),e?.Type==="TextArea"?(n(),C(y,{key:3,class:R({"special-form-input":!0,"form-field-error":o.form[t].error,"form-error":!o.form[t].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,modelValue:o.form[t].value,"onUpdate:modelValue":i=>o.form[t].value=i},null,8,["class","label","placeholder","necessarily","name","modelValue","onUpdate:modelValue"])):e?.Type==="Select"?(n(),C(E,{key:4,class:R({"special-form-input":!0,"form-field-error":o.form[t].error,"form-error":!o.form[t].value}),label:e?.Comment,placeholder:e?.Example,necessarily:e?.IsDuty==="1",name:e?.Check,options:e?.Options,modelValue:o.form[t].value,"onUpdate:modelValue":i=>o.form[t].value=i},null,8,["class","label","placeholder","necessarily","name","options","modelValue","onUpdate:modelValue"])):d("",!0)])]))),128))]),o.templateValue!==0?(n(),m("div",Ve,[o.fileList.length?(n(),m("div",Te,[r("div",Ie,[(n(!0),m(P,null,F(o.fileList,(e,t)=>(n(),m("div",{class:"chat-files__item",key:t},[r("span",null,[_(c,{class:"file-icon"})]),r("span",null,H(e?.name),1),r("button",{class:"close",onClick:i=>o.removeFile(t)},[_(f)],8,Pe)]))),128))])])):d("",!0),r("label",De,[r("div",Ee,[r("input",{ref:"fileInput",type:"file",onChange:a[1]||(a[1]=(...e)=>o.fileUpload&&o.fileUpload(...e))},null,544),r("div",Re,[_(w),a[7]||(a[7]=r("span",null,"Прикрепить документ подтверждающий личность",-1))])])]),_(T,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:o.agree,"onUpdate:modelValue":a[2]||(a[2]=e=>o.agree=e)},{default:S(()=>a[8]||(a[8]=[M(" Подтверждаю свое согласие на передачу информации в электроной форме (в том числе персональных данных) по открытым каналам связи сети Интернет ",-1)])),_:1,__:[8]},8,["modelValue"]),_(T,{class:"rule-checkbox",name:"checkbox",checked:"",modelValue:o.agreeHandle,"onUpdate:modelValue":a[3]||(a[3]=e=>o.agreeHandle=e)},{default:S(()=>a[9]||(a[9]=[M(" Я разрешаю передачу своих персональных данных третьим лицам, для выполнения заказанных мною услуг (регистрация доменов и т.п.) ",-1)])),_:1,__:[9]},8,["modelValue"])])):d("",!0),o.createProfileErrorMessage?(n(),m("div",{key:1,class:"error-message width-limit",innerHTML:o.formErrorMessage(o.createProfileErrorMessage)},null,8,Ue)):d("",!0),o.templateValue!==0?(n(),C(I,{key:2,class:"width-limit","is-loading":o.createProfileResult==="pending",label:"Зарегистрировать",onClick:a[4]||(a[4]=e=>o.checkForm())},null,8,["is-loading"])):d("",!0)])])],64)}const Qe=pe(de,[["render",we],["__scopeId","data-v-19a2421d"]]);export{Qe as default};
