import{E as de}from"./EmptyStateBlock-cd0c2748.js";import{_ as ue}from"./BlockOrderPayBalance-c29bc7b2.js";import{_ as me}from"./ClausesKeeper-3a1c11ba.js";import{_ as ve}from"./ButtonDefault-0006f72a.js";import{_ as pe,a7 as he,e as be,S as ye,r as b,g as D,i as ge,O as ke,ag as S,o as r,c as _,b as d,a as e,t as c,F as I,x as fe,k as De,Z as le,ae as ne,p as Ie,l as Be}from"./index-b5b5ce3d.js";import{u as we}from"./hosting-552a9dd1.js";import{u as Se}from"./contracts-74f05bb7.js";import{_ as Ce}from"./paramsAccordionBlock-8a0da5ad.js";import{B as Ee}from"./BlockBalanceAgreement-a016b94f.js";import"./bootstrap-vue-next.es-37aa63ea.js";import"./IconHelp-12aa8ba1.js";import"./globalActions-6936f67f.js";import"./BasicInput-a3395017.js";import"./component-2368399e.js";import"./IconClose-cd6d3917.js";import"./IconArrow-fddabae2.js";/* empty css                                                                             */const ce=y=>(Ie("data-v-640668c5"),y=y(),Be(),y),He={key:0,class:"hosting-sheme"},Pe={class:"section"},Oe={class:"container"},xe={class:"section-header"},Fe={class:"section-header__wrapper"},Le={class:"section-title"},Ne={class:"section-label"},Re={class:"section"},$e={class:"container"},Ae={class:"total-block"},Ke={class:"total-block__row divider-bottom"},Te=ce(()=>e("div",{class:"total-block__col"},"Цена тарифа",-1)),Ve={class:"total-block__col"},je={class:"total-block__row no-divider"},Ue={class:"total-block__col"},Me={class:"total-block__col"},Ze={class:"total-block__row total-block__row--big economy-line"},qe=ce(()=>e("div",{class:"total-block__col red"},"Выгода",-1)),ze={class:"total-block__col flex-col"},Ge={class:"red"},Je={class:"total-block__row total-block__row--big"},Qe={class:"total-block__col"},We={class:"total-block__col"},Xe={key:1,class:"section"},Ye={class:"container"},et={key:1,class:"section"},tt={class:"container"},st={__name:"HostingProlong",async setup(y){let u,m;const a=we(),C=Se(),ie=he(),E=be();ye("emitter"),b(null),b(null),b("");const s=b(null),g=b(!1),n=D(()=>Object.keys(a==null?void 0:a.hostingList).map(t=>a==null?void 0:a.hostingList[t]).find(t=>t.OrderID===ie.params.id)),v=D(()=>{var t,o;return(o=a==null?void 0:a.hostingSchemes)==null?void 0:o[(t=n.value)==null?void 0:t.SchemeID]}),H=D(()=>C.contractsList);function k(t){return Number(t).toFixed(2)||0}function P(){var o,i;let t=0;return(i=(o=s.value)==null?void 0:o.discounts)==null||i.Bonuses.map(p=>{t+=+p.Economy}),t}function B(){var t,o,i;g.value=!0,a.HostingOrderPay({HostingOrderID:(t=n.value)==null?void 0:t.ID,DaysPayFromBallance:((o=s.value)==null?void 0:o.daysFromBalance)||0,DaysPay:(i=s.value)==null?void 0:i.actualDays,IsChange:!0}).then(p=>{var h;let{result:f,error:w}=p;f==="SUCCESS"?E.push(`/HostingOrders/${(h=n.value)==null?void 0:h.ID}`):f==="BASKET"&&E.push("/Basket"),g.value=!1})}const O=t=>{t.key==="Enter"&&t.ctrlKey&&!re.value&&B()},re=D(()=>s.value===null);ge(()=>{document.addEventListener("keyup",O)}),ke(()=>{document.removeEventListener("keyup",O)});function _e(t){s.value=t}return[u,m]=S(()=>a.fetchHostingOrders()),await u,m(),[u,m]=S(()=>a.fetchHostingSchemes()),await u,m(),[u,m]=S(()=>C.fetchContracts()),await u,m(),(t,o)=>{var h,x,F,L,N,R,$,A,K,T,V,j,U,M,Z,q,z,G,J,Q,W,X,Y,ee,te,se,oe,ae;const i=ve,p=me,f=ue,w=de;return r(),_(I,null,[d(Ee),n.value?(r(),_("div",He,[e("div",Pe,[e("div",Oe,[e("div",xe,[e("div",Fe,[e("h1",Le,c((h=n.value)==null?void 0:h.Domain),1),d(i,{class:"btn--wide",label:((x=H.value[n.value.ContractID])==null?void 0:x.Balance)>((F=s.value)==null?void 0:F.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||((L=s.value)==null?void 0:L.price)===null,"is-loading":g.value,onClick:o[0]||(o[0]=l=>B())},null,8,["label","disabled","is-loading"])]),e("div",Ne,c((N=v.value)==null?void 0:N.Name),1)]),d(p)])]),d(Ce,{"params-list":(R=v.value)==null?void 0:R.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),($=v.value)!=null&&$.IsPayed&&((A=v.value)!=null&&A.IsProlong)||!((K=v.value)!=null&&K.IsPayed)?(r(),_(I,{key:0},[d(f,{contractID:(T=n.value)==null?void 0:T.ContractID,daysRemainded:(V=n.value)==null?void 0:V.DaysRemainded,scheme:v.value,orderID:(j=n.value)==null?void 0:j.OrderID,isOrderID:!0,onSelect:_e},null,8,["contractID","daysRemainded","scheme","orderID"]),e("div",Re,[e("div",$e,[e("div",Ae,[((Z=(M=(U=s.value)==null?void 0:U.discounts)==null?void 0:M.Bonuses)==null?void 0:Z.length)>0?(r(),_(I,{key:0},[e("div",Ke,[Te,e("div",Ve,c(k((q=s.value)==null?void 0:q.price))+" ₽",1)]),(r(!0),_(I,null,fe((G=(z=s.value)==null?void 0:z.discounts)==null?void 0:G.Bonuses,l=>(r(),_("div",je,[e("div",Ue,"Скидка "+c(l==null?void 0:l.Discount)+"% на "+c(l==null?void 0:l.Days)+" дней",1),e("div",Me,"-"+c(k(l==null?void 0:l.Economy))+" ₽",1)]))),256))],64)):De("",!0),le(e("div",Ze,[qe,e("div",ze,[e("span",null,[e("s",null,c(k((J=s.value)==null?void 0:J.price))+" ₽",1)]),e("span",Ge,"-"+c(P())+" ₽",1)])],512),[[ne,((X=(W=(Q=s.value)==null?void 0:Q.discounts)==null?void 0:W.Bonuses)==null?void 0:X.length)>0]]),le(e("div",Je,[e("div",Qe,"Итого за "+c((Y=s.value)==null?void 0:Y.label),1),e("div",We,c(k(((ee=s.value)==null?void 0:ee.price)-P()))+" ₽",1)],512),[[ne,(te=s.value)==null?void 0:te.price]])]),d(i,{class:"btn--wide",label:((se=H.value[n.value.ContractID])==null?void 0:se.Balance)>((oe=s.value)==null?void 0:oe.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||((ae=s.value)==null?void 0:ae.price)===null,"is-loading":g.value,onClick:o[1]||(o[1]=l=>B())},null,8,["label","disabled","is-loading"])])])],64)):(r(),_("div",Xe,[e("div",Ye,[d(w,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(r(),_("div",et,[e("div",tt,[d(w,{label:"не удалось найти заказ хостинга"})])]))],64)}}},kt=pe(st,[["__scopeId","data-v-640668c5"]]);export{kt as default};
