import{_ as te}from"./EmptyStateBlock-DA3-0YDi.js";import{_ as se}from"./DSCard-CAvKx_6Q.js";import{_ as oe}from"./FormInputSearch-B47bjFcn.js";import{_ as re}from"./ClausesKeeper-iUM0yapS.js";import{m as ae}from"./bootstrap-vue-next-W16P-SAV.js";import{_ as ne,a as le}from"./IconButtonBack-CTMQ7Okc.js";import{_ as ce}from"./ButtonDefault-CMw2aBy6.js";import{_ as ue}from"./BlockBalanceAgreement-v_bWuiVT.js";import{r as i,P as ie,E as me,f as b,o as r,c as m,b as a,a as n,C as w,h as k,t as d,K as de,Q as pe,w as g,v as _e,F as U,g as fe,x as ve,G as Se,d as we,e as M}from"./index-Codq73aV.js";import{u as ge}from"./index-BO2gwtUe.js";import{u as he}from"./global-CdY51QQZ.js";import{u as Ce}from"./orders-wJq_IMsK.js";import{s as De}from"./multiselect-DElL0Rlw.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./StatusBadge-BmqDrHzy.js";import"./OrderIDBadge-DCIAfa63.js";import"./ServerStatusBadge.vue_vue_type_script_setup_true_lang-CNB3-WyC.js";import"./IconDots-BIoh_VC5.js";import"./UserNote-9g0f9gxP.js";import"./CardButton-DT2I8_xv.js";import"./IconCard-C_8uFbeS.js";import"./time-DenPiOX5.js";import"./common-DyknwSqv.js";import"./IconPlus-Bm8D3Wgq.js";import"./IconClose-Dia1noy8.js";const ke={class:"tw-px-4 md:tw-px-8"},Oe={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},ye={class:"tw-flex tw-items-center tw-gap-2"},xe={key:0,class:"tw-flex tw-items-center tw-gap-2"},Ie={key:1,class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-4 tw-my-4"},Be={class:"list-form"},Pe={class:"list-form_col list-form_col--sm"},Ve={class:"list-form_select"},Le={class:"multiselect-option"},Ue={key:0,class:"tw-space-y-4 tw-mb-6"},Me={__name:"DSOrders",async setup($e){let O,y;const p=i("*"),_=i(""),x=he(),u=ie(),h=ge(),I=Ce(),B=we(),l=i(!1),f=i([]),C=i(null),D=i(!1);[O,y]=me(()=>Promise.all([u.fetchDSOrders(),u.fetchDSSchemes(),u.fetchDSOrderIPMI(),h.fetchContracts(),I.fetchAllOrders()])),await O,y();const v=ve("emitter");v.on("updateDSOrdersList",()=>{u.fetchDSOrders()});const $=t=>{f.value=t};async function j(){const t=Object.keys(f.value).filter(s=>f.value[s]),e={ServiceID:"40000",ItemsPay:C.value,OrdersIDs:t,...D.value&&{UseBalance:"yes"}};await x.OrdersPay(e).then(s=>{s==="Basket"?B.push("/Basket"):s?.Status==="Ok"&&(l.value=!1,v.emit("open-modal",{component:"BalanceProlong",data:{Message:s?.Message,Count:s?.Count}}))})}function N(){l.value=!0}function A(){l.value=!1}const c=b(()=>Object.values(u.dsOrders).reverse().map(t=>({...t,Stat:I.orders[t.OrderID]?.Stat||[]}))),S=b(()=>R(E(c.value)));function E(t){return p.value!=="*"?t.filter(e=>e?.ContractID===p.value):t}function R(t){if(_.value){const e=_.value.toLowerCase();t.filter(s=>s?.Customer.toLowerCase().includes(e)||String(s?.OrderID).includes(e)||s?.Scheme.toLowerCase().includes(e)||s?.IP.toLowerCase().includes(e)||s?.disks.toLowerCase().includes(e)||s?.CPU.toLowerCase().includes(e)||s?.ram.toLowerCase().includes(e))}else return t}function G(t){x.OrderManage(t)}const P=b(()=>{let t=[{value:"*",name:"Все договора"}];return c.value!==null&&h.contractsList!==null?(Object.keys(c.value).forEach(e=>{t.find(s=>s.value===c.value[e]?.ContractID)||t.push({value:c.value[e]?.ContractID,name:h.contractsList[c.value[e]?.ContractID]?.Customer})}),t):{value:"*",name:"Все договора"}});function T(t){let e=F(t?.SchemeID);e===void 0&&(e=t);let s=[];return t?.Scheme&&s.push(t?.Scheme),t?.CPU&&s.push(t?.CPU),e?.ram&&s.push("RAM "+e?.ram+" GB"),e?.disks&&s.push(e?.disks),e?.CostMonth&&s.push(e?.CostMonth+" / месяц"),s}function F(t){return u.DSSchemes?.[t]}function H(t,e){v.emit("open-modal",{component:"DeleteItem",data:{id:t,message:`Вы действительно хотите удалить выделенный сервер #${e}?`,tableID:"DSOrders",successEmit:"updateDSOrdersList"}})}function K(t){v.emit("open-modal",{component:"OrdersTransfer",data:t})}function Q(){B.go(0)}return(t,e)=>{const s=ue,q=ne,V=ce,z=Se("router-link"),J=le,W=ae,X=re,Y=oe,Z=se,L=te;return r(),m(U,null,[a(s),n("div",ke,[n("div",Oe,[n("div",ye,[l.value?(r(),w(q,{key:0,onClick:e[0]||(e[0]=o=>A()),class:"tw-cursor-pointer"})):k("",!0),n("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:e[1]||(e[1]=o=>Q())},d(l.value?"Продление услуг выделенных серверов":"Выделенные серверы"),1)]),l.value?k("",!0):(r(),m("div",xe,[de(a(V,{class:"btn-several",label:"Продлить несколько заказов",onClick:e[2]||(e[2]=o=>N())},null,512),[[pe,c.value.length>1]]),a(z,{class:"btn btn--blue btn-default",to:"DSSchemes"},{default:g(()=>e[8]||(e[8]=[M("Заказать",-1)])),_:1,__:[8]})])),l.value?(r(),m("div",Ie,[a(J,{class:"contr period",modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=o=>C.value=o)},null,8,["modelValue"]),a(W,{id:"checkbox-balance",modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=o=>D.value=o),name:"checkbox-balance"},{default:g(()=>e[9]||(e[9]=[M(" Использовать средства с баланса ",-1)])),_:1,__:[9]},8,["modelValue"]),a(V,{label:"Продлить",onClick:e[5]||(e[5]=o=>j())})])):k("",!0)]),a(X,{partition:"Header:/DSOrders"}),n("div",Be,[n("div",Pe,[n("div",Ve,[a(_e(De),{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=o=>p.value=o),options:P.value,disabled:P.value?.length<=1,label:"name"},{singlelabel:g(({value:o})=>[n("span",null," # "+d(String(o.value).padStart(5,"0"))+" / "+d(o.name),1)]),option:g(({option:o})=>[n("div",Le," # "+d(String(o.value).padStart(5,"0"))+" / "+d(o.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a(Y,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=o=>_.value=o)},null,8,["modelValue"])]),c.value?.length?(r(),m("div",Ue,[S.value&&S.value?.length>0?(r(!0),m(U,{key:0},fe(S.value,(o,ee)=>(r(),w(Z,{key:o.OrderID,params:T(o),"is-last":ee===S.value.length-1,server:o,isSeveral:l.value,"selected-rows":f.value,onUpdateSelectedRows:$,onDelete:H,onTransfer:K,onManage:G},null,8,["params","is-last","server","isSeveral","selected-rows"]))),128)):(r(),w(L,{key:1,class:"no-margin",label:"Заказы не найдены"}))])):(r(),w(L,{key:1,class:"no-margin",label:"У Вас нет заказов на выделенные серверы"}))])],64)}}},lt=be(Me,[["__scopeId","data-v-6e4313f0"]]);export{lt as default};
