import{E as le}from"./EmptyStateBlock-93bdfa1a.js";import{_ as ce}from"./ButtonDefault-e9d3cb95.js";import{_ as ne}from"./BlockOrderPayBalance-ba78b17e.js";import{_ as re}from"./ClausesKeeper-72a28c3f.js";import{_ as _e,e as ie,f as de,r as f,h,i as ue,P as ve,ag as g,o as l,c,b as p,a as t,F as D,t as n,y as pe,l as me,$ as Y,a9 as Z,p as he,m as be}from"./index-5b1b768e.js";import{u as ye}from"./vps-ad5d494d.js";import{u as Se}from"./contracts-3305d585.js";import{B as ke}from"./BlockBalanceAgreement-9ab306ba.js";import"./bootstrap-vue-next.es-7a3ca2aa.js";import"./IconHelp-41bf186d.js";import"./globalActions-8af915e4.js";import"./component-21d2217e.js";import"./IconClose-de7ea846.js";import"./IconArrow-5d350999.js";const P=b=>(he("data-v-3e9de59b"),b=b(),be(),b),fe={key:0,class:"vps-scheme-page"},ge={class:"section"},De={class:"container"},Pe=P(()=>t("div",{class:"section-header"},[t("h1",{class:"section-title"},"Оплата заказа VPS/VDS сервера")],-1)),Ie={key:0,class:"section"},Ve={class:"container"},Be={class:"total-block"},we={class:"total-block__row divider-bottom"},Ee=P(()=>t("div",{class:"total-block__col"},"Цена тарифа",-1)),Ce={class:"total-block__col"},Oe={class:"total-block__row no-divider"},xe={class:"total-block__col"},Le={class:"total-block__col"},Fe={class:"total-block__row total-block__row--big economy-line"},Re=P(()=>t("div",{class:"total-block__col red"},"Выгода",-1)),Ne={class:"total-block__col flex-col"},Ae={class:"red"},Ke={class:"total-block__row total-block__row--big"},Te={class:"total-block__col"},$e={class:"total-block__col"},je={key:1,class:"section"},Ue={class:"container"},He={key:1,class:"section"},Me={class:"container"},qe={__name:"VPSProlong",async setup(b){let _,i;const r=ye(),I=Se(),V=ie(),ee=de(),s=f(null),m=f(null),k=f(!1),te=h(()=>Object.keys(r.vpsSchemes).map(e=>r.vpsSchemes[e])),d=h(()=>Object.keys(r.vpsList).map(e=>r.vpsList[e]).find(e=>e.OrderID===ee.params.id)),se=h(()=>I.contractsList),y=h(()=>te.value.find(e=>{var o;return(e==null?void 0:e.ID)===((o=d.value)==null?void 0:o.SchemeID)}));function S(e){return Number(e).toFixed(2)||0}function B(){var o,u;let e=0;return(u=(o=s.value)==null?void 0:o.discounts)==null||u.Bonuses.map(v=>{e+=+v.Economy}),e}function oe(e){s.value=e}function w(){var e,o;k.value=!0,r.VPSOrderPay({VPSOrderID:(e=d.value)==null?void 0:e.ID,DaysPay:(o=s.value)==null?void 0:o.actualDays,IsChange:!0}).then(u=>{let{result:v,error:C}=u;v==="SUCCESS"?V.push("/VPSOrders"):v==="BASKET"&&V.push("/Basket"),k.value=!0})}const E=e=>{e.key==="Enter"&&e.ctrlKey&&!ae.value&&w()},ae=h(()=>s.value===null||m.value===null);return ue(()=>{document.addEventListener("keyup",E)}),ve(()=>{document.removeEventListener("keyup",E)}),[_,i]=g(()=>r.fetchVPSSchemes()),await _,i(),[_,i]=g(()=>I.fetchContracts()),await _,i(),[_,i]=g(()=>r.fetchVPS().then(()=>{var e;m.value=(e=d.value)==null?void 0:e.ContractID})),await _,i(),(e,o)=>{var x,L,F,R,N,A,K,T,$,j,U,H,M,q,z,G,J,Q,W,X;const u=re,v=ne,C=ce,O=le;return l(),c(D,null,[p(ke),d.value?(l(),c("div",fe,[t("div",ge,[t("div",De,[Pe,p(u,{partition:"Header:/VPSSchemes"})])]),p(v,{contractID:m.value,scheme:y.value,serviceID:"30000",daysRemainded:(x=d.value)==null?void 0:x.DaysRemainded,isOrderID:!0,orderID:(L=d.value)==null?void 0:L.OrderID,onSelect:oe},null,8,["contractID","scheme","daysRemainded","orderID"]),(F=y.value)!=null&&F.IsPayed&&((R=y.value)!=null&&R.IsProlong)||!((N=y.value)!=null&&N.IsPayed)?(l(),c("div",Ie,[t("div",Ve,[t("div",Be,[((T=(K=(A=s.value)==null?void 0:A.discounts)==null?void 0:K.Bonuses)==null?void 0:T.length)>0?(l(),c(D,{key:0},[t("div",we,[Ee,t("div",Ce,n(S(($=s.value)==null?void 0:$.price))+" ₽",1)]),(l(!0),c(D,null,pe((U=(j=s.value)==null?void 0:j.discounts)==null?void 0:U.Bonuses,a=>(l(),c("div",Oe,[t("div",xe,"Скидка "+n(a==null?void 0:a.Discount)+"% на "+n(a==null?void 0:a.Days)+" дней",1),t("div",Le,"-"+n(S(a==null?void 0:a.Economy))+" ₽",1)]))),256))],64)):me("",!0),Y(t("div",Fe,[Re,t("div",Ne,[t("span",null,[t("s",null,n(S((H=s.value)==null?void 0:H.price))+" ₽",1)]),t("span",Ae,"-"+n(B())+" ₽",1)])],512),[[Z,((z=(q=(M=s.value)==null?void 0:M.discounts)==null?void 0:q.Bonuses)==null?void 0:z.length)>0]]),Y(t("div",Ke,[t("div",Te,"Итого за "+n((G=s.value)==null?void 0:G.label),1),t("div",$e,n(S(((J=s.value)==null?void 0:J.price)-B()))+" ₽",1)],512),[[Z,(Q=s.value)==null?void 0:Q.price]])]),p(C,{class:"btn--wide",label:((W=se.value[m.value])==null?void 0:W.Balance)>((X=s.value)==null?void 0:X.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||m.value===null,"is-loading":k.value,onClick:o[0]||(o[0]=a=>w())},null,8,["label","disabled","is-loading"])])])):(l(),c("div",je,[t("div",Ue,[p(O,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(l(),c("div",He,[t("div",Me,[p(O,{label:"Заказ VPS/VDS сервера не найден"})])]))],64)}}},ct=_e(qe,[["__scopeId","data-v-3e9de59b"]]);export{ct as default};
