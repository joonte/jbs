import{_ as M}from"./ButtonDefault-B1FApUky.js";import{_ as oe}from"./TotalAmount.vue_vue_type_script_setup_true_lang-BJFSjxtt.js";import{_ as le}from"./BlockOrderServiceWrapper-DLqrKci2.js";import{_ as ae}from"./BlockAdditionalServices-C2o0wt_v.js";import{_ as ne}from"./DomainCheckBlock-B2ETJ6uf.js";import{_ as ie}from"./BlockSelectContract-Dn4S5pYG.js";import{_ as re}from"./ClausesKeeper-gPyacQ05.js";import{_ as me}from"./BlockBalanceAgreement-DSLTUOoQ.js";import{R as de,x as ue,g as ce,r as h,f,H as W,s as fe,m as ve,D as w,c as k,b as u,a as s,w as V,F as pe,d as _e,o as C,v as D,h as L,t as b,J as R,X as U}from"./index-C9dBN6m4.js";import{u as Se}from"./contracts-BEc0DZS2.js";import{u as Ne}from"./hosting-C49ZUiO9.js";import{u as he}from"./services-moLhYNFg.js";import{s as De}from"./multiselect-B6DlyfA6.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./EmptyStateBlock-Ad1AmtSS.js";import"./bootstrap-vue-next-BglOzul_.js";import"./ServiceListOrderSelection-DnnRkveR.js";import"./BasicInput-VlbY6GiE.js";import"./component-D8Pmx5O0.js";import"./IconClose-CgjzG0Yf.js";import"./index-D0iqQ1zq.js";const ge={class:"tw-px-4 md:tw-px-8"},ye={class:"tw-flex tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},Ie={class:"tw-mt-8"},we={class:"section"},ke={class:"form multy"},Ce={class:"multi-top"},Oe={key:0,class:"server"},xe={key:1,class:"domain"},Ee={class:"multiselect-option"},Be={key:0,class:"server"},Ve={key:1,class:"domain"},Le={class:"section"},Re={class:"form form-grid-columns"},Ue={class:"form-col"},Pe={class:"form-field"},Ae={class:"form-col"},$e={class:"form-field"},Te={class:"form-col"},He={class:"form-field"},je={class:"form-col"},Fe={class:"form-field"},Ke={class:"tw-my-6"},Me={__name:"DomainSchemes",async setup(We){let r,m;const v=de(),O=Se(),c=Ne(),x=he(),E=_e(),q=ce(),$=ue("emitter");$.on("updateDomainsList",()=>{v.fetchDomainOrders()});const J=q.query.DomainName||"",N=h(null),_=h([]),g=h(null),y=h([]),P=h(!1),a=h({Ns1Name:"dns0.host-food.ru",Ns2Name:"dns1.host-food.ru",Ns3Name:null,Ns4Name:null}),X=f(()=>x?.ServicesList),Z=f(()=>{let t=0;return y.value.forEach(e=>{t+=Number(e.Price)}),t}),T=f(()=>_.value.reduce((t,e)=>t+e.CostOrder,0)),z=f(()=>O.contractsList[N]?.Balance>=T.value+Z.value?"Оплатить c баланса договора":"Добавить в корзину"),H=t=>{t.key==="Enter"&&t.ctrlKey&&!G.value&&F()},G=f(()=>_.value.length===0);W(()=>{document.addEventListener("keyup",H)}),fe(()=>{document.removeEventListener("keyup",H)});const Q=f(()=>Object.keys(v.domainSchemes).filter(t=>v.domainSchemes[t].IsActive).map(t=>({...v.domainSchemes[t],value:v.domainSchemes[t]?.ID}))),Y=f(()=>Object.keys(c?.hostingList).map(t=>c?.hostingList[t])),A=f(()=>c?.hostingList),j=f(()=>{const t=Object.keys(A.value).map(e=>{const n=A.value[e];return{value:n.ID,login:n.Login,customer:n.Customer,domain:n.Domain,schemeID:n.SchemeID}});return t.unshift({value:0,login:"Без хостинга",customer:"",domain:""}),t});ve(()=>g.value,t=>{const e=Y.value.find(n=>n.ID===t);e?(a.value.Ns1Name=e.Ns1Name,a.value.Ns2Name=e.Ns2Name,a.value.Ns3Name=e.Ns3Name,a.value.Ns4Name=e.Ns4Name):(a.value.Ns1Name="dns0.host-food.ru",a.value.Ns2Name="dns1.host-food.ru",a.value.Ns3Name=null,a.value.Ns4Name=null)});async function ee(t){for(const e of y.value){let n="SUCCESS",p=X.value[e.ServiceID]?.Code;if(await x.ServiceOrder({Code:p,DependOrderID:t,...e,ContractID:N.value}).then(({result:I,info:l,error:i})=>{if(I==="SUCCESS"){let d={};p==="Default"?d.ServiceOrderID=l?.ServiceOrderID:d[`${p}OrderID`]=l?.ServiceOrderID,x.ServiceOrderPay(p,d).then(S=>{let{result:B,error:K}=S;B==="SUCCESS"?E.push("/AdditionalServices"):B==="BASKET"&&E.push("/Basket")})}else n="ERROR"}),n==="ERROR")break}}async function F(){P.value=!0;let t=0;const e=[],n=()=>{if(t<_.value.length){const l=_.value[t];v.DomainOrder({ContractID:N.value,Domain:`${l.line}${l.line&&l.Name?"."+l.Name:""}`,DomainName:l.line,DomainSchemeID:l.value,DomainZone:l.Name,IsPrivateWhoIs:"yes",HostingOrderID:g.value,...a.value}).then(({result:i,info:d,error:S})=>{if(i==="SUCCESS")return t===0&&ee(d?.OrderID),v.DomainOrderPay({DomainOrderID:d?.DomainOrderID});throw new Error(S)}).then(i=>{let{result:d,error:S}=i;e.push({result:d,error:S})}).catch(i=>{console.error("An error occurred:",i),e.push({result:"ERROR",error:i})}).finally(()=>{t++,setTimeout(n,1e3)})}else P.value=!1};n(),await new Promise(l=>{const i=()=>{t===_.value.length?l():setTimeout(i,100)};i()});const p=e.some(l=>l.result==="BASKET"),I=e.every(l=>l.result==="SUCCESS");p?E.push("/Basket"):I&&E.push("/DomainOrders")}function se(t){_.value=t}function te(){$.emit("open-modal",{component:"DomainTransfer",data:{}})}return W(()=>{A.value&&(g.value=j.value[0].value)}),[r,m]=w(()=>v.fetchDomainSchemes()),await r,m(),[r,m]=w(()=>O.fetchContracts().then(()=>{O.contractsList&&(N.value=Object.keys(O.contractsList)?.[0])})),await r,m(),[r,m]=w(()=>c.fetchHostingOrders()),await r,m(),[r,m]=w(()=>c.fetchHostingSchemes()),await r,m(),[r,m]=w(()=>x.fetchServices()),await r,m(),(t,e)=>{const n=me,p=M,I=re,l=ie,i=ne,d=ae,S=le,B=oe,K=M;return C(),k(pe,null,[u(n),s("div",ge,[s("div",ye,[e[9]||(e[9]=s("h1",{class:"tw-text-xl sm:tw-text-4xl"},"Заказ доменного имени",-1)),u(p,{label:"Перенести домен",onClick:e[0]||(e[0]=o=>te())})]),u(I),u(S,{basic_title:"Домен"},{page:V(()=>[s("div",Ie,[u(l,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=o=>N.value=o),title:"Договор"},null,8,["modelValue"]),u(i,{"domain-list":Q.value,search:D(J),onSelect:se},null,8,["domain-list","search"]),s("div",we,[e[10]||(e[10]=s("div",{class:"section-header"},[s("h2",{class:"section-block_title"},"Заказ хостинга"),s("div",{class:"section-label"}," Если домен будет использоваться совместно с заказом хостинга, выберите нужный из существующего списка ")],-1)),s("form",ke,[u(D(De),{class:"hosting-select multiselect--white",modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=o=>g.value=o),options:j.value,label:"login",placeholder:"Выберите хостинг","track-by":"value"},{singlelabel:V(({value:o})=>[s("div",Ce,b(o.login),1),D(c).hostingSchemes[o.schemeID]?.Name?(C(),k("span",Oe," / "+b(D(c).hostingSchemes[o.schemeID]?.Name),1)):L("",!0),o.domain?(C(),k("span",xe," / "+b(o.domain),1)):L("",!0)]),option:V(({option:o})=>[s("div",Ee,b(o.login),1),D(c).hostingSchemes[o.schemeID]?.Name?(C(),k("span",Be," / "+b(D(c).hostingSchemes[o.schemeID]?.Name),1)):L("",!0),o.domain?(C(),k("span",Ve," / "+b(o.domain),1)):L("",!0)]),_:1},8,["modelValue","options"])])]),s("div",Le,[e[23]||(e[23]=s("div",{class:"section-header"},[s("div",{class:"section-label"}," Для успешной регистрации, домен должен быть настроен на используемых именных серверах. Для этого в панели управления хостингом необходимо добавить домен, как дополнительный или паркованный. ")],-1)),s("form",Re,[s("div",Ue,[e[12]||(e[12]=s("div",{class:"form-col__title"},"Первичный сервер имен",-1)),s("label",Pe,[e[11]||(e[11]=s("div",{class:"form-field__label"},"Доменный адрес",-1)),R(s("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":e[3]||(e[3]=o=>a.value.Ns1Name=o)},null,512),[[U,a.value.Ns1Name]])]),e[13]||(e[13]=s("label",{class:"form-field"},[s("div",{class:"form-field__label"},"IP адрес"),s("input",{type:"text",disabled:""})],-1))]),s("div",Ae,[e[15]||(e[15]=s("div",{class:"form-col__title"},"Вторичный сервер имен",-1)),s("label",$e,[e[14]||(e[14]=s("div",{class:"form-field__label"},"Доменный адрес",-1)),R(s("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":e[4]||(e[4]=o=>a.value.Ns2Name=o)},null,512),[[U,a.value.Ns2Name]])]),e[16]||(e[16]=s("label",{class:"form-field"},[s("div",{class:"form-field__label"},"IP адрес"),s("input",{type:"text",disabled:""})],-1))]),s("div",Te,[e[18]||(e[18]=s("div",{class:"form-col__title"},"Дополнительный сервер имен",-1)),s("label",He,[e[17]||(e[17]=s("div",{class:"form-field__label"},"Доменный адрес",-1)),R(s("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=o=>a.value.Ns3Name=o)},null,512),[[U,a.value.Ns3Name]])]),e[19]||(e[19]=s("label",{class:"form-field"},[s("div",{class:"form-field__label"},"IP адрес"),s("input",{type:"text",disabled:""})],-1))]),s("div",je,[e[21]||(e[21]=s("div",{class:"form-col__title"},"Расширенный сервер имен",-1)),s("label",Fe,[e[20]||(e[20]=s("div",{class:"form-field__label"},"Доменный адрес",-1)),R(s("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=o=>a.value.Ns4Name=o)},null,512),[[U,a.value.Ns4Name]])]),e[22]||(e[22]=s("label",{class:"form-field"},[s("div",{class:"form-field__label"},"IP адрес"),s("input",{type:"text",disabled:""})],-1))])])])])]),services:V(()=>[u(d,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=o=>y.value=o),serviceSearchParams:{ServiceID:"20000"}},null,8,["modelValue"])]),_:1}),s("div",Ke,[u(B,{tariff:{label:"12 месяцев",price:T.value},"additional-services":y.value},null,8,["tariff","additional-services"]),u(K,{class:"btn--wide",label:z.value,onClick:e[8]||(e[8]=o=>F()),"is-loading":P.value,disabled:_.value.length===0},null,8,["label","is-loading","disabled"])])])],64)}}},fs=be(Me,[["__scopeId","data-v-237ef219"]]);export{fs as default};
