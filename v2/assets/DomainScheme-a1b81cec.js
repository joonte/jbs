import{k as z,o as J,c as Q,b as N,a as e,w as V,t as D,$ as v,a9 as x,af as C,d as X,F as Y,p as $,m as ee,_ as se,e as oe,f as te,U as ae,r as y,h as p,i as U,P as le,j as ne}from"./index-5b1b768e.js";import{u as ce}from"./domain-bf3cfe51.js";import{u as ie}from"./contracts-3305d585.js";import{u as re}from"./hosting-0a5bfe10.js";import{u as de}from"./resetServer-d5ad51a7.js";import{D as P}from"./DomainCheckBlock-d910b5ab.js";import{_ as M}from"./BlockSelectContract-e82f00b8.js";import{B as j}from"./BlockBalanceAgreement-9ab306ba.js";import{s as me}from"./multiselect-0eb7c5c1.js";import{_ as _e}from"./ClausesKeeper-72a28c3f.js";import{_ as ue}from"./ButtonDefault-e9d3cb95.js";import"./EmptyStateBlock-93bdfa1a.js";import"./bootstrap-vue-next.es-7a3ca2aa.js";import"./IconClose-de7ea846.js";import"./IconArrow-5d350999.js";const n=l=>($("data-v-fbd2c23f"),l=l(),ee(),l),fe={class:"domain-scheme"},he={class:"section"},ve={class:"container"},pe={class:"section-header __sb"},Ne=n(()=>e("h1",{class:"section-title"},"Заказ доменного имени",-1)),De={class:"section"},be={class:"container"},ge=n(()=>e("div",{class:"section-header"},[e("h2",{class:"section-block_title"},"Заказ хостинга"),e("div",{class:"section-label"},"Если домен будет использоваться совместно с заказом хостинга, выберите нужный из существующего списка")],-1)),Se={class:"form multy"},ke={class:"multi-top"},ye={class:"multiselect-option"},Ie={class:"section"},we={class:"container"},xe=n(()=>e("div",{class:"section-header"},[e("div",{class:"section-label"},"Для успешной регистрации, домен должен быть настроен на используемых именных серверах. Для этого в панели управления хостингом необходимо добавить домен, как дополнительный или паркованный.")],-1)),Ce={class:"form form-grid-columns"},Oe={class:"form-col"},Be=n(()=>e("div",{class:"form-col__title"},"Первичный сервер имен",-1)),Ee={class:"form-field"},Le=n(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),Ve=n(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),He={class:"form-col"},Re=n(()=>e("div",{class:"form-col__title"},"Вторичный сервер имен",-1)),Te={class:"form-field"},Ue=n(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),Pe=n(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),Me={class:"form-col"},je=n(()=>e("div",{class:"form-col__title"},"Дополнительный сервер имен",-1)),Fe={class:"form-field"},Ae=n(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),Ge=n(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),Ke={class:"form-col"},qe=n(()=>e("div",{class:"form-col__title"},"Расширенный сервер имен",-1)),We={class:"form-field"},Ze=n(()=>e("div",{class:"form-field__label"},"Доменный адрес",-1)),ze=n(()=>e("label",{class:"form-field"},[e("div",{class:"form-field__label"},"IP адрес"),e("input",{type:"text",disabled:""})],-1)),Je={class:"section"},Qe={class:"container"},Xe={class:"total-block"},Ye={class:"total-block__row total-block__row--big"},$e=n(()=>e("div",{class:"total-block__col"},"Итого за 12 месяцев",-1)),es={class:"total-block__col"};function ss(l,a,c,s,O,H){var r;const I=j,w=ue,g=_e,f=M,b=P,S=z("Multiselect");return J(),Q(Y,null,[N(I),e("div",fe,[e("div",he,[e("div",ve,[e("div",pe,[Ne,N(w,{label:"Перенести домен",onClick:a[0]||(a[0]=o=>s.openTransferModal())})]),N(g)])]),N(f,{title:"Договор",modelValue:s.contractSelect,"onUpdate:modelValue":a[1]||(a[1]=o=>s.contractSelect=o)},null,8,["modelValue"]),N(b,{"domain-list":s.getDomains,search:s.search,onSelect:s.selectDomain},null,8,["domain-list","search","onSelect"]),e("div",De,[e("div",be,[ge,e("div",Se,[N(S,{class:"hosting-select multiselect--white",modelValue:s.hostingSelect,"onUpdate:modelValue":a[2]||(a[2]=o=>s.hostingSelect=o),options:s.FILTERED_ORDERS,label:"login",placeholder:"Выберите хостинг","track-by":"value"},{singlelabel:V(({value:o})=>{var _,h;return[e("div",ke,D(o.login),1),v(e("span",{class:"server"},"/ "+D((_=s.getHostingSchemes[o.schemeID])==null?void 0:_.Name),513),[[x,(h=s.getHostingSchemes[o.schemeID])==null?void 0:h.Name]]),v(e("span",{class:"domain"},"/ "+D(o.domain),513),[[x,o.domain]])]}),option:V(({option:o})=>{var _,h;return[e("div",ye,D(o.login),1),v(e("span",{class:"server"},"/ "+D((_=s.getHostingSchemes[o.schemeID])==null?void 0:_.Name),513),[[x,(h=s.getHostingSchemes[o.schemeID])==null?void 0:h.Name]]),v(e("span",{class:"domain"},"/ "+D(o.domain),513),[[x,o.domain]])]}),_:1},8,["modelValue","options"])])])]),e("div",Ie,[e("div",we,[xe,e("div",Ce,[e("div",Oe,[Be,e("label",Ee,[Le,v(e("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":a[3]||(a[3]=o=>s.formData.Ns1Name=o)},null,512),[[C,s.formData.Ns1Name]])]),Ve]),e("div",He,[Re,e("label",Te,[Ue,v(e("input",{type:"text",placeholder:"dns0.host-food.ru","onUpdate:modelValue":a[4]||(a[4]=o=>s.formData.Ns2Name=o)},null,512),[[C,s.formData.Ns2Name]])]),Pe]),e("div",Me,[je,e("label",Fe,[Ae,v(e("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=o=>s.formData.Ns3Name=o)},null,512),[[C,s.formData.Ns3Name]])]),Ge]),e("div",Ke,[qe,e("label",We,[Ze,v(e("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=o=>s.formData.Ns4Name=o)},null,512),[[C,s.formData.Ns4Name]])]),ze])])])]),e("div",Je,[e("div",Qe,[e("div",Xe,[e("div",Ye,[$e,e("div",es,D(s.domains.length?s.domains.reduce((o,_)=>o+parseFloat(_.CostOrder),0):"0")+" ₽",1)])]),N(w,{class:"btn--wide",label:((r=s.getContracts[s.contractSelect])==null?void 0:r.Balance)>(s.domains.length?s.domains.reduce((o,_)=>o+parseFloat(_.CostOrder),0):0)?"Оплатить c баланса договора":"Добавить в корзину",onClick:a[7]||(a[7]=o=>s.createDomain()),"is-loading":s.isLoading,disabled:s.domains.length===0},{default:V(()=>[X("Добавить в корзину")]),_:1},8,["label","is-loading","disabled"])])])])],64)}const os={components:{BlockSelectContract:M,DomainCheckBlock:P,BlockBalanceAgreement:j,Multiselect:me},async setup(){const l=ce(),a=ie(),c=re(),s=de(),O=oe(),H=te(),I=ae("emitter");I.on("updateDomainsList",()=>{l.fetchDomains()});const w=H.query.DomainName||"",g=y(null),f=y([]),b=y(null),S=y(!1),r=y({Ns1Name:"dns0.host-food.ru",Ns2Name:"dns1.host-food.ru",Ns3Name:null,Ns4Name:null}),o=p(()=>a.contractsList),_=t=>{t.key==="Enter"&&t.ctrlKey&&!h.value&&T()},h=p(()=>f.value.length===0);U(()=>{document.addEventListener("keyup",_),console.log(E)}),le(()=>{document.removeEventListener("keyup",_)});const F=p(()=>{var t;return(t=Object.keys(l==null?void 0:l.domainSchemes))==null?void 0:t.map(i=>{var d;return{...l==null?void 0:l.domainSchemes[i],value:(d=l==null?void 0:l.domainSchemes[i])==null?void 0:d.ID}})}),A=p(()=>c==null?void 0:c.hostingSchemes),R=p(()=>Object.keys(c==null?void 0:c.hostingList).map(t=>c==null?void 0:c.hostingList[t])),B=p(()=>c==null?void 0:c.hostingList),E=p(()=>{const t=Object.keys(B.value).map(i=>{const d=B.value[i];return{value:d.ID,login:d.Login,customer:d.Customer,domain:d.Domain,schemeID:d.SchemeID}});return t.unshift({value:0,login:"Без хостинга",customer:"",domain:""}),t}),G=p(()=>{var t;return(t=s==null?void 0:s.serverGroupsList)==null?void 0:t.Servers});ne(()=>b.value,t=>{const i=R.value.find(d=>d.ID===t);i?(r.value.Ns1Name=i.Ns1Name,r.value.Ns2Name=i.Ns2Name,r.value.Ns3Name=i.Ns3Name,r.value.Ns4Name=i.Ns4Name):(r.value.Ns1Name="dns0.host-food.ru",r.value.Ns2Name="dns1.host-food.ru",r.value.Ns3Name=null,r.value.Ns4Name=null)});async function T(){S.value=!0;let t=0;const i=[],d=()=>{if(t<f.value.length){const m=f.value[t];l.DomainOrder({ContractID:g.value,Domain:`${m.line}${m.line&&m.Name?"."+m.Name:""}`,DomainName:m.line,DomainSchemeID:m.value,DomainZone:m.Name,IsPrivateWhoIs:"yes",HostingOrderID:b.value,...r.value}).then(({result:u,info:k,error:L})=>{if(u==="SUCCESS")return l.DomainOrderPay({DomainOrderID:k==null?void 0:k.DomainOrderID});throw new Error(L)}).then(u=>{let{result:k,error:L}=u;i.push({result:k,error:L})}).catch(u=>{console.error("An error occurred:",u),i.push({result:"ERROR",error:u})}).finally(()=>{t++,setTimeout(d,1e3)})}else S.value=!1};d(),await new Promise(m=>{const u=()=>{t===f.value.length?m():setTimeout(u,100)};u()});const W=i.some(m=>m.result==="BASKET"),Z=i.every(m=>m.result==="SUCCESS");W?O.push("/Basket"):Z&&O.push("/DomainOrders")}function K(t){f.value=t}function q(){I.emit("open-modal",{component:"DomainTransfer",data:{}})}return U(()=>{B.value&&(b.value=E.value[0].value)}),await l.fetchDomainSchemes(),await a.fetchContracts().then(()=>{var t;o.value&&(g.value=(t=Object.keys(o==null?void 0:o.value))==null?void 0:t[0])}),await c.fetchHostingOrders(),await c.fetchHostingSchemes(),await s.fetchServerGroups(),{contractSelect:g,selectDomain:K,domains:f,hostingSelect:b,getDomains:F,getContracts:o,getHostingOrders:R,getServerGroup:G,formData:r,isLoading:S,createDomain:T,buttonDisabled:h,FILTERED_ORDERS:E,getHostingSchemes:A,search:w,openTransferModal:q}}},Ns=se(os,[["render",ss],["__scopeId","data-v-fbd2c23f"]]);export{Ns as default};
