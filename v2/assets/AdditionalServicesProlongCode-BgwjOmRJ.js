import{_ as R}from"./EmptyStateBlock-CV1Zaaf7.js";import{_ as $}from"./BlockOrderPayBalance-CwLP8dIN.js";import{_ as M}from"./ClausesKeeper-DEgaQ2N3.js";import{_ as j}from"./ButtonDefault-eJbeaBtE.js";import{_ as V}from"./BlockBalanceAgreement-DjWMZ940.js";import{r as U,f,g as K,h as E,s as q,E as w,c as r,b as h,a as e,D as N,i as C,t as l,I as T,F as g,j as z,J as x,d as J,o as c}from"./index-XtiBO-PZ.js";import{u as G}from"./contracts-BdlSA9YT.js";import{u as H}from"./services-izfy4zss.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-CxxkTytZ.js";import"./component-YfTGPdLe.js";import"./globalActions-Tf2FwXht.js";import"./IconHelp-C9M5tavY.js";import"./IconClose-s_NQ_Q4c.js";const W={key:0,class:"hosting-sheme"},X={class:"section"},Y={class:"container"},Z={class:"section-header"},ee={class:"section-header__wrapper"},se={class:"section-title"},oe={class:"section-label"},te={key:1,class:"section"},ae={class:"container"},ne={class:"total-block"},le={class:"total-block__row divider-bottom"},ce={class:"total-block__col"},ie={class:"total-block__col"},re={class:"total-block__col"},de={class:"total-block__row total-block__row--big economy-line"},_e={class:"total-block__col flex-col"},ue={class:"red"},ve={class:"total-block__row total-block__row--big"},me={class:"total-block__col"},pe={class:"total-block__col"},he={key:2},ke={class:"container"},ye={key:1},Ie={class:"container"},be={__name:"AdditionalServicesProlongCode",async setup(Se){let _,u;const B=G(),i=H(),A=K(),P=J(),o=U(null),p=U(!1),a=f(()=>Object.keys(i?.ISPswOrdersList).map(s=>i?.ISPswOrdersList[s]).find(s=>s.OrderID===A.params.id)),O=s=>{s.key==="Enter"&&s.ctrlKey&&S()};E(()=>{document.addEventListener("keyup",O)}),q(()=>{document.removeEventListener("keyup",O)});const n=f(()=>i?.additionalServicesScheme?.ISPsw?Object.keys(i.additionalServicesScheme.ISPsw).map(s=>{const t=i.additionalServicesScheme.ISPsw[s];return{...t,value:t?.ID,name:t?.Name,cost:t?.CostDay,month:t?.CostMonth}}).filter(s=>s?.ID==a.value?.SchemeID):[]),b=f(()=>B.contractsList);function S(){p.value=!0;const s=parseFloat(b.value[a.value.ContractID]?.Balance)>=parseFloat(v(o.value?.price-k())??0),t=n.value[0]?.cost==="0.00"&&n.value[0]?.month==="0.00",y=s||t,I=!y,D={ISPswOrderID:a.value.ID,DaysPay:o.value?.actualDays,IsNoBasket:y,IsUseBasket:I,PayMessage:""};i.ISPswOrderPay(D).then(m=>{m==="UseBasket"?P.push("/Basket"):m==="NoBasket"&&P.push("/AdditionalServices?ServiceID=51000"),p.value=!1}).catch(m=>{console.error("ISPswOrderPay error:",m),p.value=!1})}function v(s){return Number(s).toFixed(2)||0}function k(){let s=0;return o.value?.discounts?.Bonuses.map(t=>{s+=+t.Economy}),s}function L(s){o.value=s}return E(()=>{i.fetchAdditionalServiceScheme("ISPsw")}),[_,u]=w(()=>i.fetchISPswOrders()),await _,u(),[_,u]=w(()=>i.fetchAdditionalServiceScheme("ISPsw")),await _,u(),[_,u]=w(()=>B.fetchContracts()),await _,u(),(s,t)=>{const y=V,I=j,D=M,m=$,F=R;return c(),r(g,null,[h(y),a.value?(c(),r("div",W,[e("section",X,[e("div",Y,[e("div",Z,[e("div",ee,[e("h1",se,"Оплата заказа ПО ISPsystem, "+l(a.value?.IP||""),1),n.value[0]?.ConsiderTypeID!=="Upon"?(c(),N(I,{key:0,class:"btn--wide",label:parseFloat(b.value[a.value.ContractID]?.Balance)>=parseFloat(o.value?.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:o.value===null||o.value?.price===null,"is-loading":p.value,onClick:t[0]||(t[0]=d=>S())},null,8,["label","disabled","is-loading"])):C("",!0)]),e("div",oe,l(n.value[0]?.Name),1)]),h(D)])]),n.value[0]?.ConsiderTypeID!=="Upon"?(c(),N(m,{key:0,contractID:a.value?.ContractID,daysRemainded:a.value?.DaysRemainded,serviceID:"51000",scheme:n.value[0],orderID:a.value?.OrderID,isOrderID:!0,onSelect:L},null,8,["contractID","daysRemainded","scheme","orderID"])):C("",!0),a.value?(c(),r("section",te,[e("div",ae,[e("div",ne,[o.value?.discounts?.Bonuses?.length>0?(c(),r(g,{key:0},[e("div",le,[t[2]||(t[2]=e("div",{class:"total-block__col"},"Цена тарифа",-1)),e("div",ce,l(v(o.value?.price))+" ₽",1)]),(c(!0),r(g,null,z(o.value?.discounts?.Bonuses,d=>(c(),r("div",{class:"total-block__row no-divider",key:d?.Discount+"-"+d?.Days},[e("div",ie,"Скидка "+l(d?.Discount)+"% на "+l(d?.Days)+" дней",1),e("div",re,"-"+l(v(d?.Economy))+" ₽",1)]))),128)),T(e("div",de,[t[3]||(t[3]=e("div",{class:"total-block__col red"},"Выгода",-1)),e("div",_e,[e("span",null,[e("s",null,l(v(o.value?.price))+" ₽",1)]),e("span",ue,"-"+l(k())+" ₽",1)])],512),[[x,o.value?.discounts?.Bonuses?.length>0]])],64)):C("",!0),T(e("div",ve,[e("div",me,l(n.value[0]?.ConsiderTypeID==="Upon"?"Итого":`Итого за ${o.value?.label}`),1),e("div",pe,l(n.value[0]?.ConsiderTypeID==="Upon"?n.value[0]?.CostMonth:v(o.value?.price-k()))+" ₽ ",1)],512),[[x,o.value?.price||n.value[0]?.ConsiderTypeID==="Upon"]])]),h(I,{class:"btn--wide",label:parseFloat(b.value[a.value.ContractID]?.Balance)>=(v(o.value?.price-k())??0)?"Оплатить c баланса договора":"Добавить в корзину",disabled:(o.value===null||o.value?.price===null)&&n.value[0]?.ConsiderTypeID!=="Upon","is-loading":p.value,onClick:t[1]||(t[1]=d=>S())},null,8,["label","disabled","is-loading"])])])):(c(),r("section",he,[e("div",ke,[h(F,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(c(),r("section",ye,[e("div",Ie,[h(F,{label:"не удалось найти заказ хостинга"})])]))],64)}}},Ae=Q(be,[["__scopeId","data-v-37c773a2"]]);export{Ae as default};
