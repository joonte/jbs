import{E as pe}from"./EmptyStateBlock-b36abca5.js";import{_ as he}from"./ButtonDefault-28022e42.js";import{_ as Se}from"./BlockOrderPayBalance-29672652.js";import{_ as ce,a7 as ne,e as re,r as w,i as be,o as k,c as g,a as e,n as se,t as n,b as v,Y as j,ae as G,m as oe,F as R,R as De,g as T,ag as W,w as le,v as ae,k as ke,p as ge,l as fe}from"./index-e8e4a28d.js";import{u as ye}from"./hosting-d8902982.js";import{u as Ie}from"./contracts-f70de43e.js";import{u as Ce}from"./domain-124d4d36.js";import{u as Be}from"./services-80f38975.js";import{_ as Oe}from"./paramsAccordionBlock-2c845396.js";import{D as we}from"./DomainCheckBlock-8a36c0a1.js";import{_ as Ee}from"./BlockSelectContract-ce407fe3.js";import{_ as $e}from"./ClausesKeeper-cfc0f758.js";import Ve from"./BlockAdditionalServices-faf7d4fb.js";import{B as Ne}from"./BlockBalanceAgreement-00019440.js";import"./bootstrap-vue-next.es-6aab83a5.js";import"./IconHelp-5d2ceeda.js";import"./globalActions-78d58809.js";import"./BasicInput-fc01a75b.js";import"./component-2fc43b10.js";import"./IconArrow-0cda8946.js";import"./multiselect-762d23c8.js";import"./IconClose-c1bee414.js";import"./ServiceListOrderSelection-4acbc4f3.js";const Pe={class:"section"},He={class:"container"},Re={class:"section-nav"},Ae={__name:"BlockOrderServiceWrapper",props:{basic_title:{type:String,default:"basic_title"},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(E,{emit:_}){const u=E,m=ne(),y=re(),a=w("");function p(){return m.fullPath.includes("?section=Services")}function L(d=null){d?(a.value="Services",y.replace({query:{section:"Services"}})):(a.value="",y.replace({query:{}})),_("update:modelValue",d||"")}return be(()=>{m.query.section==="Services"&&(a.value="Services")}),(d,l)=>{const I=$e;return k(),g(R,null,[e("div",Pe,[e("div",He,[e("div",Re,[e("div",{class:se(["section-nav__item",[p()?"":"active"]]),onClick:l[0]||(l[0]=$=>L())},n(u.basic_title),3),e("div",{class:se(["section-nav__item",[p()?"active":""]]),onClick:l[1]||(l[1]=$=>L("Services"))},"Услуги",2)])])]),v(I),e("div",null,[j(e("div",null,[oe(d.$slots,"page",{},void 0,!0)],512),[[G,a.value===""]]),j(e("div",null,[oe(d.$slots,"services",{},void 0,!0)],512),[[G,a.value!==""]])])],64)}}},xe=ce(Ae,[["__scopeId","data-v-e8bb070c"]]);const K=E=>(ge("data-v-51ea9d2c"),E=E(),fe(),E),Fe={class:"hosting-sheme"},Ue={class:"section"},Te={class:"container"},Le={class:"section-header"},qe={class:"section-title"},We=K(()=>e("div",{class:"section-label"},"Хостинг",-1)),je={class:"section"},Ge={class:"container"},Ke={class:"total-block"},ze={class:"total-block__row divider-bottom"},Me=K(()=>e("div",{class:"total-block__col"},"Цена тарифа",-1)),Ye={class:"total-block__col"},Je={class:"total-block__row no-divider"},Qe={class:"total-block__col"},Xe={class:"total-block__col"},Ze={class:"total-block__row"},et=K(()=>e("div",{class:"total-block__col"},"Дополнительные услуги",-1)),tt={class:"total-block__col"},st={class:"total-block__row no-divider"},ot={class:"total-block__col"},lt={class:"total-block__col"},at={class:"total-block__row total-block__row--big economy-line"},ct=K(()=>e("div",{class:"total-block__col red"},"Выгода",-1)),nt={class:"total-block__col flex-col"},rt={class:"red"},it={class:"total-block__row total-block__row--big"},_t={class:"total-block__col"},ut={class:"total-block__col"},dt={key:1,class:"section"},vt={class:"container"},mt={__name:"HostingScheme",async setup(E){let _,u;const m=ye(),y=Ie(),a=Ce(),p=Be();De("emitter");const L=ne(),d=re(),l=w(null),I=w([]),$=w(!1),C=w(null),i=w(null),Y=w(""),V=T(()=>{var o;return(o=m==null?void 0:m.hostingSchemes)==null?void 0:o[L.params.id]}),ie=T(()=>y==null?void 0:y.contractsList),J=T(()=>p==null?void 0:p.ServicesList),_e=T(()=>{var o;return(o=Object.keys(a==null?void 0:a.domainSchemes))==null?void 0:o.map(s=>{var c;return{...a==null?void 0:a.domainSchemes[s],value:(c=a==null?void 0:a.domainSchemes[s])==null?void 0:c.ID}})}),Q=T(()=>{let o=0;return I.value.forEach(s=>{o+=s==null?void 0:s.Price}),N(o)||0});function X(){var s,c;let o=0;return(c=(s=l.value)==null?void 0:s.discounts)==null||c.Bonuses.map(h=>{o+=+h.Economy}),o}function N(o){return Number(o).toFixed(2)||0}function ue(o){i.value=o}function de(o){l.value=o}async function ve(o){var s;for(const c of I.value){console.log(c);let h="SUCCESS",S=(s=J.value[c.ServiceID])==null?void 0:s.Code;if(await p.ServiceOrder({Code:S,DependOrderID:o,...c,ContractID:C.value}).then(({result:B,info:r,error:P})=>{if(B==="SUCCESS"){let b={};S==="Default"?b.ServiceOrderID=r==null?void 0:r.ServiceOrderID:b[`${S}OrderID`]=r==null?void 0:r.ServiceOrderID,p.ServiceOrderPay(S,b).then(O=>{let{result:f,error:A}=O;f==="SUCCESS"?d.push("/AdditionalServices}"):f==="BASKET"&&d.push("/Basket")})}else h="ERROR"}),h==="ERROR")break}}function me(){var o,s,c,h,S,B,r,P,b,O,f;$.value=!0,m.HostingOrder({ContractID:C.value,Domain:`${((o=i.value)==null?void 0:o.line)||""}${(s=i.value)!=null&&s.line&&((c=i.value)!=null&&c.Name)?"."+(((h=i.value)==null?void 0:h.Name)||""):""}`,DomainName:(S=i.value)==null?void 0:S.line,HostingSchemeID:(B=V.value)==null?void 0:B.ID,DomainSchemeID:(r=i.value)!=null&&r.line&&((P=i.value)!=null&&P.ID)?(b=i.value)==null?void 0:b.ID:null,DomainTypeID:(O=i.value)!=null&&O.line?(f=i.value)!=null&&f.Name?"Order":"Nothing":"None"}).then(({result:A,info:D,error:z})=>{var x,F;A==="SUCCESS"?(ve(D==null?void 0:D.OrderID),m.HostingOrderPay({HostingOrderID:D==null?void 0:D.HostingOrderID,DaysPayFromBallance:((x=l.value)==null?void 0:x.daysFromBalance)||0,DaysPay:(F=l.value)==null?void 0:F.actualDays}).then(q=>{let{result:U,error:M}=q;U==="SUCCESS"?d.push("/HostingOrders"):U==="BASKET"&&d.push("/Basket"),$.value=!1})):$.value=!1})}return[_,u]=W(()=>a.fetchDomainSchemes()),await _,u(),[_,u]=W(()=>m.fetchHostingSchemes()),await _,u(),[_,u]=W(()=>y.fetchContracts()),await _,u(),[_,u]=W(()=>p.fetchServices()),await _,u(),(o,s)=>{var B,r,P,b,O,f,A,D,z,x,F,q,U,M,Z,ee,te;const c=Se,h=he,S=pe;return k(),g(R,null,[v(Ne),e("div",Fe,[(B=V.value)!=null&&B.ID?(k(),g(R,{key:0},[e("div",Ue,[e("div",Te,[e("div",Le,[e("h1",qe,n((r=V.value)==null?void 0:r.Name),1),We])])]),v(xe,{basic_title:"Хостинг",modelValue:Y.value,"onUpdate:modelValue":s[2]||(s[2]=t=>Y.value=t)},{page:le(()=>{var t;return[v(Oe,{"params-list":(t=V.value)==null?void 0:t.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),v(Ee,{title:"Договор",modelValue:C.value,"onUpdate:modelValue":s[0]||(s[0]=H=>C.value=H)},null,8,["modelValue"]),v(c,{contractID:C.value,scheme:V.value,isOrderID:!1,onSelect:de},null,8,["contractID","scheme"]),v(we,{"domain-list":_e.value,onSelect:ue},null,8,["domain-list"])]}),services:le(()=>{var t;return[v(Ve,{modelValue:I.value,"onUpdate:modelValue":s[1]||(s[1]=H=>I.value=H),serviceSearchParams:{ServiceID:"10000",ServersGroupID:(t=V.value)==null?void 0:t.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]}),_:1},8,["modelValue"]),e("div",je,[e("div",Ge,[j(e("div",Ke,[((O=(b=(P=l.value)==null?void 0:P.discounts)==null?void 0:b.Bonuses)==null?void 0:O.length)>0?(k(),g(R,{key:0},[e("div",ze,[Me,e("div",Ye,n(N((f=l.value)==null?void 0:f.price))+" ₽",1)]),(k(!0),g(R,null,ae((D=(A=l.value)==null?void 0:A.discounts)==null?void 0:D.Bonuses,t=>(k(),g("div",Je,[e("div",Qe,"Скидка "+n(t==null?void 0:t.Discount)+"% на "+n(t==null?void 0:t.Days)+" дней",1),e("div",Xe,"-"+n(N(t==null?void 0:t.Economy))+" ₽",1)]))),256))],64)):ke("",!0),e("div",Ze,[et,e("div",tt,n(Q.value)+" ₽",1)]),(k(!0),g(R,null,ae(I.value,t=>{var H;return k(),g("div",st,[e("div",ot,n((H=J.value[t==null?void 0:t.ServiceID])==null?void 0:H.Name),1),e("div",lt,n(N(t==null?void 0:t.Price))+" ₽",1)])}),256)),j(e("div",at,[ct,e("div",nt,[e("span",null,[e("s",null,n(N((z=l.value)==null?void 0:z.price))+" ₽",1)]),e("span",rt,"-"+n(X())+" ₽",1)])],512),[[G,((q=(F=(x=l.value)==null?void 0:x.discounts)==null?void 0:F.Bonuses)==null?void 0:q.length)>0]]),e("div",it,[e("div",_t,"Итого за "+n((U=l.value)==null?void 0:U.label),1),e("div",ut,n(N(((M=l.value)==null?void 0:M.price)-X()+ +Q.value))+" ₽",1)])],512),[[G,(Z=l.value)==null?void 0:Z.price]]),v(h,{class:"btn--wide",label:((ee=ie.value[C.value])==null?void 0:ee.Balance)>((te=l.value)==null?void 0:te.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:l.value===null||C.value===null,"is-loading":$.value,onClick:s[3]||(s[3]=t=>me())},null,8,["label","disabled","is-loading"])])])],64)):(k(),g("div",dt,[e("div",vt,[v(S,{label:"Тариф не найден"})])]))])],64)}}},Ft=ce(mt,[["__scopeId","data-v-51ea9d2c"]]);export{Ft as default};
