import{_ as G}from"./EmptyStateBlock-D6U_EDq6.js";import{_ as K}from"./BlockAdditionalServices-CY_Vrm6d.js";import{_ as q}from"./ButtonDefault-CghIUDY0.js";import{_ as z}from"./StatusBadge-B65ys1I-.js";import{_ as J}from"./ClausesKeeper-DVJgfLR3.js";import{_ as Q}from"./BlockBalanceAgreement-2iQbaweR.js";import{c as S,b as D,a as t,h as w,t as u,w as N,E as W,F as E,i as L,C as V,O as X,u as Y,x as Z,r as R,f as p,g as $,H as ee,d as re,o as c,e as B}from"./index-CipWZKo_.js";import{u as te}from"./services-Dmz4Qt8q.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-3DpAa4tb.js";import"./ServiceListOrderSelection-CxiE4waM.js";import"./TotalAmount.vue_vue_type_script_setup_true_lang-GfTe3s0M.js";import"./BasicInput-BYe5b9L8.js";import"./component-DWBAga-C.js";import"./BlockSelectContract-3ekz5W0S.js";import"./contracts-CILh9uSu.js";import"./multiselect-DWCHRlfT.js";import"./IconClose-ChC2G6HM.js";const oe={async setup(){const x=$(),s=re(),v=X(),e=te(),_=Y(),m=Z("emitter");m.on("updateDSIDPage",()=>{_.fetchUserOrders()});const n=R([]),I=R(!0),b=R(!1),d=p(()=>v?.dsOrders?Object.keys(v.dsOrders).map(r=>v.dsOrders[r]).find(r=>r&&String(r.OrderID)===String(x.params.id)):null),g=p(()=>!d.value?.SchemeID||!v?.DSSchemes?null:v.DSSchemes[d.value.SchemeID]),y=p(()=>!d.value||!g.value?null:{ServiceID:d.value.ServiceID,ServersGroupID:g.value.ServersGroupID}),f=p(()=>e?.ServicesList||{}),o=p(()=>{if(!d.value?.OrderID||!_?.userOrders)return[];const r=d.value.OrderID;return Object.keys(_.userOrders).map(l=>_.userOrders[l]).filter(l=>l?.DependOrderID==r&&l?.ServiceID&&f.value[l.ServiceID]).sort((l,h)=>Number(l?.ID)-Number(h?.ID))}),k=p(()=>{if(!n.value||!Array.isArray(n.value))return 0;let r=0;return n.value.forEach(i=>{i&&typeof i.Price=="number"&&(r+=i.Price)}),A(r)});function U(r){n.value=r||[]}function A(r){return r==null?"0.00":Number(r).toFixed(2)||"0.00"}function T(r,i){let a="Orders";i==5e4?a="ExtraIPOrders":i==51e3?a="ISPswOrders":i==52e3&&(a="DNSmanagerOrders"),m.emit("open-modal",{component:"StatusHistory",data:{modeID:a,rowID:r}})}function F(r){const i=Object.values(f.value).find(O=>O.ID===r);if(!i){s.push(`/AdditionalServices/${r}`);return}const a=i.Code;a==="Default"||a==="DNSmanager"||a==="ISPsw"||a==="ExtraIP"?s.push(`/AdditionalServices/${r}`):s.push(`/${a}Orders/${r}`)}async function M(){if(!(!n.value||!Array.isArray(n.value)||n.value.length===0))for(const r of n.value){if(!r)continue;let i="SUCCESS",a=f.value[r.ServiceID]?.Code;const O={Code:a,DependOrderID:d.value?.OrderID,...r,ContractID:d.value?.ContractID};try{const{result:l,info:h}=await e.ServiceOrder(O);if(l==="SUCCESS"){let C={};a==="Default"?C.ServiceOrderID=h?.ServiceOrderID:C[`${a}OrderID`]=h?.ServiceOrderID;const H=await e.ServiceOrderPay(a,C);let{result:P}=H;P==="SUCCESS"?(m.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),n.value=[],await _.fetchUserOrders(),s.push("/AdditionalServices")):P==="BASKET"&&s.push("/Basket")}else i="ERROR",m.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(l){console.error("Ошибка при заказе услуги:",l),i="ERROR",m.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(i==="ERROR")break}}async function j(){b.value=!0;try{await M()}catch(r){console.error("Ошибка при заказе услуг:",r),m.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{b.value=!1}}return ee(async()=>{try{await v.fetchDSOrders(),await v.fetchDSSchemes(),await e.fetchServices(),await _.fetchUserOrders()}catch(r){console.error("Ошибка загрузки данных:",r)}finally{I.value=!1}}),{getDSServerData:d,serviceSearchParams:y,selectedServices:n,getServices:f,orderedServices:o,ADDITIONAL_SERVICES_PRICE:k,handleServicesUpdate:U,setToFixedService:A,orderServices:j,isLoading:I,isOrderLoading:b,openHistoryStatuses:T,navigateToService:F}}},ae={class:"tw-px-4 md:tw-px-8"},ie={key:0,class:"section-label"},ne={class:"tw-flex tw-items-center tw-gap-8 tw-border-b tw-border-gray-200 tw-mt-4 tw-whitespace-nowrap tw-mb-6"},ce={key:0,class:"section-body"},de={class:"ordered-services-list"},le={class:"ordered-service-header"},Se={class:"ordered-service-name"},ve={class:"ordered-service-status"},ue={class:"ordered-service-details"},_e={class:"ordered-service-info"},me={key:0},De={class:"ordered-service-actions"},fe={class:"section-body"},pe={key:2,class:"loading"},Ie={key:0,class:"tw-px-4 md:tw-px-8 tw-mb-6"},be={class:"total-block"},ge={class:"total-block__row"},Oe={class:"total-block__col"},he={class:"total-block__col"},we={class:"total-block__col"},ye={class:"total-block__row total-block__row--big"},ke={class:"total-block__col"};function Ce(x,s,v,e,_,m){const n=Q,I=W("RouterLink"),b=J,d=z,g=q,y=K,f=G;return c(),S(E,null,[D(n),t("div",ae,[t("div",null,[s[4]||(s[4]=t("h1",{class:"section-title"},"Дополнительные услуги",-1)),e.getDSServerData?(c(),S("div",ie,"Выделенный сервер # "+u(e.getDSServerData?.OrderID),1)):w("",!0),t("div",ne,[D(I,{class:"tw-py-2 tw-cursor-pointer -tw-mb-[1px]","active-class":"tw-text-sky-400 tw-border-b-2 tw-border-sky-400",to:`/DSOrders/${e.getDSServerData?.OrderID}`},{default:N(()=>s[2]||(s[2]=[B(" Сервер ",-1)])),_:1,__:[2]},8,["to"]),D(I,{class:"tw-py-2 tw-cursor-pointer -tw-mb-[1px]","active-class":"tw-text-sky-400 tw-border-b-2 tw-border-sky-400",to:`/Services/${e.getDSServerData?.OrderID}`},{default:N(()=>s[3]||(s[3]=[B(" Услуги ",-1)])),_:1,__:[3]},8,["to"])])]),D(b),e.orderedServices&&e.orderedServices.length>0?(c(),S("div",ce,[s[5]||(s[5]=t("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),t("div",de,[(c(!0),S(E,null,L(e.orderedServices,o=>(c(),S("div",{class:"ordered-service-item",key:o.ID},[t("div",le,[t("div",Se,u(e.getServices[o?.ServiceID]?.Name||o?.ServiceName||`Услуга #${o?.ServiceID}`),1),t("div",ve,[D(d,{status:o?.StatusID,"status-table":"Orders",onClick:k=>e.openHistoryStatuses(o?.ID,o?.ServiceID)},null,8,["status","onClick"])])]),t("div",ue,[t("div",_e,[t("span",null,"Заказ # "+u(o?.ID),1),o?.DaysRemainded?(c(),S("span",me," Осталось дней: "+u(o?.DaysRemainded),1)):w("",!0)])]),t("div",De,[D(g,{class:"btn--sm",label:"Перейти к заказу",onClick:k=>e.navigateToService(o?.ID)},null,8,["onClick"])])]))),128))])])):w("",!0),t("div",fe,[e.getDSServerData&&e.serviceSearchParams?(c(),V(y,{key:0,modelValue:e.selectedServices,"onUpdate:modelValue":[s[0]||(s[0]=o=>e.selectedServices=o),e.handleServicesUpdate],"service-search-params":e.serviceSearchParams},null,8,["modelValue","service-search-params","onUpdate:modelValue"])):e.isLoading?(c(),S("div",pe,"Загрузка...")):(c(),V(f,{key:1,label:"Заказ не найден"}))])]),e.selectedServices&&e.selectedServices.length>0?(c(),S("div",Ie,[t("div",be,[t("div",ge,[s[6]||(s[6]=t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),t("div",Oe,u(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)]),(c(!0),S(E,null,L(e.selectedServices,o=>(c(),S("div",{class:"total-block__row no-divider",key:o.ServiceID},[t("div",he,u(e.getServices[o?.ServiceID]?.Name),1),t("div",we,u(e.setToFixedService(o?.Price))+" ₽",1)]))),128)),t("div",ye,[s[7]||(s[7]=t("div",{class:"total-block__col"},"Итого к оплате",-1)),t("div",ke,u(e.ADDITIONAL_SERVICES_PRICE)+" ₽",1)])]),D(g,{class:"btn--wide",disabled:!e.selectedServices||e.selectedServices.length===0||e.isOrderLoading,"is-loading":e.isOrderLoading,label:"Заказать дополнительные услуги",onClick:s[1]||(s[1]=o=>e.orderServices())},null,8,["disabled","is-loading"])])):w("",!0)],64)}const ze=se(oe,[["render",Ce],["__scopeId","data-v-9881b6a8"]]);export{ze as default};
