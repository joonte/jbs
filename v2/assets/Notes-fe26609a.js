import{o as u,c as P,a as h,b as y,_ as N,y as C,w as q,F as $,x as U,a8 as F,p as K,l as G,r as z,f as J,g as O,e as Q,S as X,a0 as Y,O as Z,i as ee,a2 as te}from"./index-5f8fd0e9.js";import{_ as ne,u as oe,n as se}from"./networkController-1cf6a65b.js";import{u as ce}from"./postings-2abc5e3f.js";import{u as ie}from"./contracts-00b6c53b.js";import{I as re}from"./IconClose-2e1ba86d.js";import{E as M}from"./EmptyStateBlock-153c9c6f.js";import{B as A}from"./BlockBalanceAgreement-cf03db60.js";import{_ as ae}from"./ClausesKeeper-8218189c.js";import"./bootstrap-vue-next.es-a97602fc.js";import"./ButtonDefault-458eab69.js";import"./IconArrow-c9744352.js";const de={class:"notes__note-container"},le=["innerHTML"];function me(o,d,p,r,m,_){const S=re;return u(),P("div",de,[h("div",{class:"notes__content",innerHTML:p.item},null,8,le),h("div",{class:"notes__close-button",onClick:d[0]||(d[0]=w=>r.closeNote(p.index))},[y(S,{class:"notes__close-button-cross"})])])}const pe={props:{item:{type:String,default:""},index:{type:[String,Number],default:""}},emits:["delete"],setup(o,{emit:d}){function p(r){let m=new Date;m.setDate(30+m.getDate()),document.cookie=`${r}=hidden; path=/; expires=${m}`,d("delete",r)}return{closeNote:p}}},B=N(pe,[["render",me],["__scopeId","data-v-8295fda7"]]),he=o=>(K("data-v-8dbac79b"),o=o(),G(),o),fe={class:"section"},ue={class:"container"},_e=he(()=>h("div",{class:"section-header"},[h("h1",{class:"section-title"},"Уведомления")],-1)),Se={class:"notes"};function Ie(o,d,p,r,m,_){const S=A,w=ae,c=B,s=M;return u(),P($,null,[y(S),h("div",fe,[h("div",ue,[_e,y(w),h("div",Se,[r.notes&&Object.keys(r.notes).length>0?(u(),C(F,{key:0,class:"notes__transition-container",tag:"div",name:"list"},{default:q(()=>[(u(!0),P($,null,U(r.notes,(v,I)=>(u(),C(c,{innerHTML:v,item:v,index:I,key:I,onDelete:r.deleteItem},null,8,["innerHTML","item","index","onDelete"]))),128))]),_:1})):(u(),C(s,{key:1,label:"Все уведомления прочитаны или они еще не пришли"}))])])])],64)}const we={components:{IconCross:ne,Note:B,EmptyStateBlock:M,BlockBalanceAgreement:A},async setup(){const o=oe(),d=z(null),p=ce(),r=ie(),m=J(),_=O(()=>m.userInfo),S=O(()=>{var e,t;return(t=Object.keys((e=_.value)==null?void 0:e.Contacts))==null?void 0:t.map(n=>{var a,i,f,l,x;if(!((f=(i=(a=_.value)==null?void 0:a.Contacts)==null?void 0:i[n])!=null&&f.IsHidden))return(x=(l=_.value)==null?void 0:l.Contacts)==null?void 0:x[n]})}),w=e=>S.value.find(t=>t.ID===e),c=Q(),s=X("emitter"),v=[{old:"/v2/DNSmanagerSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=52000"},{old:"/v2/ExtraIPSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=50000"},{old:"/v2/ISPswSchemes",new:"/v2/AdditionalServicesOrder?ServiceID=51000"}],I=O(()=>{let e={};return Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t]}),Object.keys(e).length>0?e:null});function b(){let e={};Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;L(t)&&(e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t])}),d.value=e}function L(e){return document.cookie.match(RegExp(`(?:^|;\\s*)${e}=([^;]*)`))===null}function g(e){return Object.values(e).map(t=>{let n=t;return v.forEach(({old:a,new:i})=>{const f=new RegExp(`<a[^>]*href="${a}"[^>]*>`,"gi");n=n.replace(f,l=>l.replace(`href="${a}"`,`href="${i}"`))}),n})}function j(e){c.push(e)}function T(e){delete d.value[e],s.emit("notes-reduce")}const k=async(e,t)=>{try{return(await te.post(e,t)).data}catch(n){throw new Error(`Error sending confirm request: ${n.message}`)}};async function D(e,t){if((e.includes("ISPswSchemes")||e.includes("ExtraIPSchemes")||e.includes("DNSmanagerSchemes"))&&(e.includes("ISPswSchemes")&&c.push("/AdditionalServicesOrder?ServiceID=51000"),e.includes("ExtraIPSchemes")&&c.push("/AdditionalServicesOrder?ServiceID=50000"),e.includes("DNSmanagerSchemes")&&c.push("/AdditionalServicesOrder?ServiceID=52000")),e.includes("OrderPay")){let n=t[Object.keys(t).find(a=>a.includes("OrderID"))];e!=="/ExtraIPOrderPay"&&e!=="/ISPswOrderPay"&&e!=="/DNSmanagerOrderPay"?c.push(`${e}/${n}`):e==="/ExtraIPOrderPay"||e==="/ISPswOrderPay"||e==="/DNSmanagerOrderPay"?c.push(`${e}/${n}`):c.push(`/ServiceOrderPay/${n}`)}else if(e==="/InvoiceDocument")p.InvoiceDocument({InvoiceID:t.InvoiceID}).then(n=>{s.emit("open-modal",{component:"InvoiceDocument",data:{html:n,ID:t.InvoiceID}})});else if(e==="/API/OrdersTransfer")s.emit("open-modal",{component:"TakeOrder",data:{OrdersTransferID:t}});else if(e==="/ContractMake")c.push("ContractMake");else if(e==="/HostingOrderSchemeChange")c.push(`/HostingOrders/${t.OrderID}/SchemeChange`);else if(e==="/VPSOrderSchemeChange")c.push(`/VPSOrders/${t.OrderID}/SchemeChange`);else if(e==="/DomainSelectOwner")s.emit("open-modal",{component:"DomainSelectOwner",data:t});else if(e==="/ISPswOrders")c.push("AdditionalServices");else if(e==="/ContactEdit?MethodID=VKontakte")s.emit("open-modal",{component:"CreateVK"});else if(e==="/ContactEdit?MethodID=Telegram")s.emit("open-modal",{component:"CreateTelegram"});else if(e==="/ContactEdit?MethodID=Viber")s.emit("open-modal",{component:"CreateViber"});else if(e==="/ContactEdit?MethodID=SMS")s.emit("open-modal",{component:"CreatePhone"});else if(e.includes("/ContactEdit")){(t==null?void 0:t.MethodID)==="SMS"&&s.emit("open-modal",{component:"CreatePhone"});const n=e.match(/ContactID=(\d+)/),a=n?n[1]:null;if(a){const i=w(a);if(i){const f={Method:i.MethodID,Value:i.Address,ContactID:i.ID};try{const l=await k("/API/Confirm",f);l.Status==="Ok"?s.emit("open-modal",{component:"AcceptContact",data:{contactId:a,sendConfirmRequest:k}}):console.error(`Error confirming code. Status: ${l.Status}, Message: ${l.Message}`)}catch(l){console.error("Error accepting contact:",l.message)}}}else console.error("ContactID is not present in the URL params.",e)}else e==="/ProfileEdit"?c.push(`/ContractEdit/${t.ProfileID}`):s.emit("open-modal",{component:e.replace("/",""),data:t})}function H(){}function V(e,t,n,a){se.post(e,t).then(i=>{i.data.Status==="Exception"?s.emit("open-modal",{component:"ExclusionWindow",data:i.data}):o.fetchNotes().then(()=>{b()})}).catch(i=>{console.error("Ошибка при выполнении запроса:",i)})}function R(e,t){s.emit("open-modal",{component:"DeleteItem",data:{id:null,callback:t,message:e,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function W(){}function E(){window.ShowWindow=D.bind(this)}return Y(()=>{E()}),Z(()=>{window.ShowWindow=null}),ee(()=>{const e=I.value;e&&(d.value=g(e),console.log(g(e)))}),s.on("close-modal",()=>{E()}),window.ShowProgress=W.bind(this),window.ShowWindow=D.bind(this),window.PromptShow=H.bind(this),window.AjaxCall=V.bind(this),window.ShowConfirm=R.bind(this),await o.fetchNotes().then(()=>{b()}),await r.fetchContracts(),await r.fetchProfiles(),await m.fetchUserData(),{getNotesList:I,notes:d,ShowWindow:D,deleteItem:T,processNotes:g,redirectToNewPage:j}}},$e=N(we,[["render",Ie],["__scopeId","data-v-8dbac79b"]]);export{$e as default};
