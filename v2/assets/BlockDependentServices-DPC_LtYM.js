import{_ as R}from"./ButtonDefault-CMw2aBy6.js";import{d as O,r as A,x as $,f as B,o as i,c,a as t,t as l,v as f,F as w,g as k,b as h,h as S,w as E,e as L}from"./index-Codq73aV.js";import{u as x}from"./services-DyPBvbVy.js";import{f as D,g as N}from"./common-DyknwSqv.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as T}from"./BlueButton.vue_vue_type_script_setup_true_lang-BKdLNEec.js";import{_ as V}from"./StatusBadge-BmqDrHzy.js";const H={key:0},U={class:"total-block"},j={class:"total-block__row"},F={class:"total-block__col"},M={class:"total-block__col"},K={class:"total-block__col"},W={class:"total-block__row total-block__row--big"},q={class:"total-block__col"},z={__name:"BlockAdditionalServicesTotalAmount",props:{services:Array,mainOrder:Object},setup(n){const o=n,d=x(),p=O(),u=A(!1),m=$("emitter"),a=B(()=>{if(!o.services||!Array.isArray(o.services))return 0;let r=0;return o.services.forEach(e=>{e&&typeof e.Price=="number"&&(r+=e.Price)}),r});async function _(){if(!(!o.services||!Array.isArray(o.services)||o.services.length===0))for(const r of o.services){if(!r)continue;let e="SUCCESS",s=d.ServicesList[r.ServiceID]?.Code;const v={...r,Code:s,DependOrderID:o.mainOrder.OrderID,ContractID:o.mainOrder.ContractID};try{const{result:y,info:I}=await d.ServiceOrder(v);if(y==="SUCCESS"){let b={};s==="Default"?b.ServiceOrderID=I?.ServiceOrderID:b[`${s}OrderID`]=I?.ServiceOrderID;const C=await d.ServiceOrderPay(s,b);C.result==="SUCCESS"?(m.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),p.push("/AdditionalServices")):C.result==="BASKET"&&p.push("/Basket")}else e="ERROR"}catch(y){console.error("Ошибка при заказе услуги:",y),e="ERROR",m.emit("open-error-modal",{component:"ExclusionWindow",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(e==="ERROR")break}}async function g(){u.value=!0;try{await _()}catch(r){console.error(r),m.emit("open-error-modal",{component:"ExclusionWindow",data:{message:"Произошла ошибка при заказе услуг"}})}finally{u.value=!1}}return(r,e)=>{const s=R;return n.services?.length?(i(),c("div",H,[t("div",U,[t("div",j,[e[1]||(e[1]=t("div",{class:"total-block__col"},"Дополнительные услуги",-1)),t("div",F,l(f(D)(a.value)),1)]),(i(!0),c(w,null,k(n.services,v=>(i(),c("div",{key:v.ServiceID,class:"total-block__row no-divider"},[t("div",M,l(f(d).ServicesList[v.ServiceID]?.Name),1),t("div",K,l(f(D)(v.Price)),1)]))),128)),t("div",W,[e[2]||(e[2]=t("div",{class:"total-block__col"},"Итого к оплате",-1)),t("div",q,l(f(D)(a.value)),1)])]),h(s,{class:"btn--wide",disabled:!n.services||n.services.length===0||u.value,"is-loading":u.value,label:"Заказать дополнительные услуги",onClick:e[0]||(e[0]=v=>g())},null,8,["disabled","is-loading"])])):S("",!0)}}},_e=P(z,[["__scopeId","data-v-c11f468b"]]),G={key:0},J={class:"tw-grid tw-grid-cols-1 lg:tw-grid-cols-2 xl:tw-grid-cols-3 tw-gap-4 tw-mt-4"},Q={class:"tw-flex tw-items-center tw-justify-between tw-gap-2"},X={class:"tw-text-lg tw-font-medium"},Y={class:"tw-text-gray-500 tw-mt-1"},Z={key:0,class:"tw-mt-1"},ee={class:"tw-space-y-2 tw-mt-4"},te={key:0},se={class:"tw-font-bold"},oe=["innerHTML"],re={class:"tw-mt-4"},ve={__name:"BlockDependentServices",props:{services:Array},setup(n){const o=O(),d=x(),p=$("emitter");function u(a){p.emit("open-modal",{component:"StatusHistory",data:{modeID:a.Code+"Orders",orderID:a.OrderID}})}function m(a){o.push(N(a.Code,a.OrderID))}return(a,_)=>{const g=V,r=T;return n.services.length?(i(),c("div",G,[_[1]||(_[1]=t("h2",{class:"tw-text-xl tw-font-medium"},"Заказанные услуги",-1)),t("div",J,[(i(!0),c(w,null,k(n.services,e=>(i(),c("div",{key:e.ID,class:"tw-p-4 tw-border tw-border-gray-200 tw-rounded-lg"},[t("div",Q,[t("div",X,l(f(d).ServicesList[e.ServiceID]?.Name||e.ServiceName||`Услуга #${e.ServiceID}`),1),t("div",null,[h(g,{status:e.StatusID,"status-table":"Orders",class:"tw-cursor-pointer",onClick:s=>u(e)},null,8,["status","onClick"])])]),t("div",Y,[t("div",null,"Заказ #"+l(e.ID),1),e.DaysRemainded?(i(),c("div",Z," Осталось дней: "+l(e.DaysRemainded),1)):S("",!0)]),t("div",ee,[(i(!0),c(w,null,k(e.AdditionalInfo,s=>(i(),c(w,null,[s.Value?(i(),c("div",te,[t("div",se,l(s.Key),1),t("div",{class:"tw-whitespace-pre",innerHTML:s.Value},null,8,oe)])):S("",!0)],64))),256))]),t("div",re,[h(r,{onClick:s=>m(e),type:"small",class:"tw-uppercase tw-font-bold"},{default:E(()=>_[0]||(_[0]=[L("Перейти к заказу",-1)])),_:2,__:[0]},1032,["onClick"])])]))),128))])])):S("",!0)}}};export{ve as _,_e as a};
