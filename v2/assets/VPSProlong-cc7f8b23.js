import{E as le}from"./EmptyStateBlock-b0a120e4.js";import{_ as ce}from"./ButtonDefault-11c4541b.js";import{_ as ne}from"./BlockOrderPayBalance-39bb297a.js";import{_ as re}from"./ClausesKeeper-90c650cc.js";import{_ as _e,e as ie,f as de,r as f,h,i as ue,P as ve,ah as g,o as l,c,b as p,a as t,F as D,t as n,y as pe,l as me,Z as X,ab as Y,p as he,m as be}from"./index-aeb1df1e.js";import{u as ye}from"./vps-31dc9173.js";import{u as Se}from"./IconArrow-a6c91ada.js";import{B as ke}from"./BlockBalanceAgreement-906c1168.js";import"./bootstrap-vue-next.es-c6bcf011.js";import"./IconHelp-66378dff.js";import"./globalActions-3944bebb.js";import"./component-60ac2998.js";import"./IconClose-c7c36336.js";const P=b=>(he("data-v-3e9de59b"),b=b(),be(),b),fe={key:0,class:"vps-scheme-page"},ge={class:"section"},De={class:"container"},Pe=P(()=>t("div",{class:"section-header"},[t("h1",{class:"section-title"},"Оплата заказа VPS/VDS сервера")],-1)),Ie={key:0,class:"section"},Ve={class:"container"},Be={class:"total-block"},we={class:"total-block__row divider-bottom"},Ee=P(()=>t("div",{class:"total-block__col"},"Цена тарифа",-1)),Ce={class:"total-block__col"},Oe={class:"total-block__row no-divider"},xe={class:"total-block__col"},Le={class:"total-block__col"},Fe={class:"total-block__row total-block__row--big economy-line"},Re=P(()=>t("div",{class:"total-block__col red"},"Выгода",-1)),Ne={class:"total-block__col flex-col"},Ae={class:"red"},Ke={class:"total-block__row total-block__row--big"},Te={class:"total-block__col"},je={class:"total-block__col"},Ue={key:1,class:"section"},$e={class:"container"},He={key:1,class:"section"},Me={class:"container"},Ze={__name:"VPSProlong",async setup(b){let _,i;const r=ye(),I=Se(),V=ie(),ee=de(),s=f(null),m=f(null),k=f(!1),te=h(()=>Object.keys(r.vpsSchemes).map(e=>r.vpsSchemes[e])),d=h(()=>Object.keys(r.vpsList).map(e=>r.vpsList[e]).find(e=>e.OrderID===ee.params.id)),se=h(()=>I.contractsList),y=h(()=>te.value.find(e=>{var o;return(e==null?void 0:e.ID)===((o=d.value)==null?void 0:o.SchemeID)}));function S(e){return Number(e).toFixed(2)||0}function B(){var o,u;let e=0;return(u=(o=s.value)==null?void 0:o.discounts)==null||u.Bonuses.map(v=>{e+=+v.Economy}),e}function oe(e){s.value=e}function w(){var e,o;k.value=!0,r.VPSOrderPay({VPSOrderID:(e=d.value)==null?void 0:e.ID,DaysPay:(o=s.value)==null?void 0:o.actualDays,IsChange:!0}).then(u=>{let{result:v,error:C}=u;v==="SUCCESS"?V.push("/VPSOrders"):v==="BASKET"&&V.push("/Basket"),k.value=!0})}const E=e=>{e.key==="Enter"&&e.ctrlKey&&!ae.value&&w()},ae=h(()=>s.value===null||m.value===null);return ue(()=>{document.addEventListener("keyup",E)}),ve(()=>{document.removeEventListener("keyup",E)}),[_,i]=g(()=>r.fetchVPSSchemes()),await _,i(),[_,i]=g(()=>I.fetchContracts()),await _,i(),[_,i]=g(()=>r.fetchVPS().then(()=>{var e;m.value=(e=d.value)==null?void 0:e.ContractID})),await _,i(),(e,o)=>{var x,L,F,R,N,A,K,T,j,U,$,H,M,Z,q,z,G,J,Q,W;const u=re,v=ne,C=ce,O=le;return l(),c(D,null,[p(ke),d.value?(l(),c("div",fe,[t("div",ge,[t("div",De,[Pe,p(u,{partition:"Header:/VPSSchemes"})])]),p(v,{contractID:m.value,scheme:y.value,serviceID:"30000",daysRemainded:(x=d.value)==null?void 0:x.DaysRemainded,isOrderID:!0,orderID:(L=d.value)==null?void 0:L.OrderID,onSelect:oe},null,8,["contractID","scheme","daysRemainded","orderID"]),(F=y.value)!=null&&F.IsPayed&&((R=y.value)!=null&&R.IsProlong)||!((N=y.value)!=null&&N.IsPayed)?(l(),c("div",Ie,[t("div",Ve,[t("div",Be,[((T=(K=(A=s.value)==null?void 0:A.discounts)==null?void 0:K.Bonuses)==null?void 0:T.length)>0?(l(),c(D,{key:0},[t("div",we,[Ee,t("div",Ce,n(S((j=s.value)==null?void 0:j.price))+" ₽",1)]),(l(!0),c(D,null,pe(($=(U=s.value)==null?void 0:U.discounts)==null?void 0:$.Bonuses,a=>(l(),c("div",Oe,[t("div",xe,"Скидка "+n(a==null?void 0:a.Discount)+"% на "+n(a==null?void 0:a.Days)+" дней",1),t("div",Le,"-"+n(S(a==null?void 0:a.Economy))+" ₽",1)]))),256))],64)):me("",!0),X(t("div",Fe,[Re,t("div",Ne,[t("span",null,[t("s",null,n(S((H=s.value)==null?void 0:H.price))+" ₽",1)]),t("span",Ae,"-"+n(B())+" ₽",1)])],512),[[Y,((q=(Z=(M=s.value)==null?void 0:M.discounts)==null?void 0:Z.Bonuses)==null?void 0:q.length)>0]]),X(t("div",Ke,[t("div",Te,"Итого за "+n((z=s.value)==null?void 0:z.label),1),t("div",je,n(S(((G=s.value)==null?void 0:G.price)-B()))+" ₽",1)],512),[[Y,(J=s.value)==null?void 0:J.price]])]),p(C,{class:"btn--wide",label:((Q=se.value[m.value])==null?void 0:Q.Balance)>((W=s.value)==null?void 0:W.price)?"Оплатить c баланса договора":"Добавить в корзину",disabled:s.value===null||m.value===null,"is-loading":k.value,onClick:o[0]||(o[0]=a=>w())},null,8,["label","disabled","is-loading"])])])):(l(),c("div",Ue,[t("div",$e,[p(O,{class:"no-margin",label:"Заказ нельзя продлить"})])]))])):(l(),c("div",He,[t("div",Me,[p(O,{label:"Заказ VPS/VDS сервера не найден"})])]))],64)}}},lt=_e(Ze,[["__scopeId","data-v-3e9de59b"]]);export{lt as default};
