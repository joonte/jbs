import{o as f,c as k,a as p,b as y,_ as P,x as D,w as V,F as E,v as W,a8 as H,p as U,l as q,r as F,f as K,g as S,e as G,R as z,$ as J,N as Q,a2 as X}from"./index-1d7f6848.js";import{_ as Y,u as Z,n as ee}from"./networkController-9ba967a2.js";import{u as te}from"./postings-087ece1a.js";import{u as oe}from"./contracts-97246549.js";import{I as ne}from"./IconClose-b09002f7.js";import{E as $}from"./EmptyStateBlock-6e78acb3.js";import{B as M}from"./BlockBalanceAgreement-fc8b62a5.js";import{_ as se}from"./ClausesKeeper-9fc4bc59.js";import"./bootstrap-vue-next.es-ee787e70.js";import"./ButtonDefault-ceb0a858.js";import"./IconArrow-6ea40b14.js";const ce={class:"notes__note-container"},ae=["innerHTML"];function ie(o,r,m,a,d,_){const h=ne;return f(),k("div",ce,[p("div",{class:"notes__content",innerHTML:m.item},null,8,ae),p("div",{class:"notes__close-button",onClick:r[0]||(r[0]=w=>a.closeNote(m.index))},[y(h,{class:"notes__close-button-cross"})])])}const re={props:{item:{type:String,default:""},index:{type:[String,Number],default:""}},emits:["delete"],setup(o,{emit:r}){function m(a){let d=new Date;d.setDate(30+d.getDate()),document.cookie=`${a}=hidden; path=/; expires=${d}`,r("delete",a)}return{closeNote:m}}},N=P(re,[["render",ie],["__scopeId","data-v-8295fda7"]]),le=o=>(U("data-v-4594e915"),o=o(),q(),o),de={class:"section"},me={class:"container"},pe=le(()=>p("div",{class:"section-header"},[p("h1",{class:"section-title"},"Уведомления")],-1)),ue={class:"notes"};function fe(o,r,m,a,d,_){const h=M,w=se,u=N,s=$;return f(),k(E,null,[y(h),p("div",de,[p("div",me,[pe,y(w),p("div",ue,[a.notes&&Object.keys(a.notes).length>0?(f(),D(H,{key:0,class:"notes__transition-container",tag:"div",name:"list"},{default:V(()=>[(f(!0),k(E,null,W(a.notes,(C,I)=>(f(),D(u,{item:C,index:I,key:I,onDelete:a.deleteItem},null,8,["item","index","onDelete"]))),128))]),_:1})):(f(),D(s,{key:1,label:"Все уведомления прочитаны или они еще не пришли"}))])])])],64)}const _e={components:{IconCross:Y,Note:N,EmptyStateBlock:$,BlockBalanceAgreement:M},async setup(){const o=Z(),r=F(null),m=te(),a=oe(),d=K(),_=S(()=>d.userInfo),h=S(()=>{var e,t;return(t=Object.keys((e=_.value)==null?void 0:e.Contacts))==null?void 0:t.map(n=>{var i,c,g,l,x;if(!((g=(c=(i=_.value)==null?void 0:i.Contacts)==null?void 0:c[n])!=null&&g.IsHidden))return(x=(l=_.value)==null?void 0:l.Contacts)==null?void 0:x[n]})}),w=e=>h.value.find(t=>t.ID===e),u=G(),s=z("emitter"),C=S(()=>{let e={};return Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t]}),Object.keys(e).length>0?e:null});function I(){let e={};Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;B(t)&&(e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t])}),r.value=e}function B(e){return document.cookie.match(RegExp(`(?:^|;\\s*)${e}=([^;]*)`))===null}function j(e){delete r.value[e],s.emit("notes-reduce")}const b=async(e,t)=>{try{return(await X.post(e,t)).data}catch(n){throw new Error(`Error sending confirm request: ${n.message}`)}};async function v(e,t){if(console.log("Route: ",e,"Data: ",t),e.includes("OrderPay")){let n=t[Object.keys(t).find(i=>i.includes("OrderID"))];e!=="/ExtraIPOrderPay"&&e!=="/ISPswOrderPay"&&e!=="/DNSmanagerOrderPay"?u.push(`${e}/${n}`):u.push(`ServiceOrderPay/${n}`)}else if(e==="/InvoiceDocument")m.InvoiceDocument({InvoiceID:t.InvoiceID}).then(n=>{s.emit("open-modal",{component:"InvoiceDocument",data:{html:n,ID:t.InvoiceID}})});else if(e==="/API/OrdersTransfer")console.log(t),s.emit("open-modal",{component:"TakeOrder",data:{OrdersTransferID:t}});else if(e==="/ContractMake")u.push("ContractMake");else if(e==="/ISPswOrders")u.push("AdditionalServices");else if(e==="/ContactEdit?MethodID=VKontakte")s.emit("open-modal",{component:"CreateVK"});else if(e==="/ContactEdit?MethodID=Telegram")s.emit("open-modal",{component:"CreateTelegram"});else if(e==="/ContactEdit?MethodID=Viber")s.emit("open-modal",{component:"CreateViber"});else if(e==="/ContactEdit?MethodID=SMS")s.emit("open-modal",{component:"CreatePhone"});else if(e.includes("/ContactEdit")){(t==null?void 0:t.MethodID)==="SMS"&&s.emit("open-modal",{component:"CreatePhone"});const n=e.match(/ContactID=(\d+)/),i=n?n[1]:null;if(console.log("contactId:",i),i){const c=w(i);if(c){const g={Method:c.MethodID,Value:c.Address,ContactID:c.ID};try{const l=await b("/API/Confirm",g);console.log("Response from server:",l),l.Status==="Ok"?s.emit("open-modal",{component:"AcceptContact",data:{contactId:i,sendConfirmRequest:b}}):console.error(`Error confirming code. Status: ${l.Status}, Message: ${l.Message}`)}catch(l){console.error("Error accepting contact:",l.message)}}}else console.error("ContactID is not present in the URL params.",e)}else console.log(e,t),s.emit("open-modal",{component:e.replace("/",""),data:t})}function L(){}function A(e,t,n,i){console.log(e,t,n,i),ee.post(e,t).then(c=>{console.log(c.data),c.data.Status==="Exception"?s.emit("open-modal",{component:"ExclusionWindow",data:c.data}):o.fetchNotes().then(()=>{I()})}).catch(c=>{console.error("Ошибка при выполнении запроса:",c)})}function R(e,t){s.emit("open-modal",{component:"DeleteItem",data:{id:null,callback:t,message:e,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function T(){}function O(){window.ShowWindow=v.bind(this)}return J(()=>{O()}),Q(()=>{window.ShowWindow=null}),s.on("close-modal",()=>{O()}),window.ShowProgress=T.bind(this),window.ShowWindow=v.bind(this),window.PromptShow=L.bind(this),window.AjaxCall=A.bind(this),window.ShowConfirm=R.bind(this),await o.fetchNotes().then(()=>{I()}),await a.fetchContracts(),await a.fetchProfiles(),await d.fetchUserData(),{getNotesList:C,notes:r,ShowWindow:v,deleteItem:j}}},Oe=P(_e,[["render",fe],["__scopeId","data-v-4594e915"]]);export{Oe as default};
