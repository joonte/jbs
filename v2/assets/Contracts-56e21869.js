import{_ as ce}from"./FormInputSearch-2b54abc4.js";import{_ as ie}from"./ClausesKeeper-5fae717f.js";import{_ as _e}from"./ButtonDefault-dafa6215.js";import{_ as H,o as S,c as R,b as c,a as e,q as ue,r as I,j as M,w as n,t as g,N as w,l as X,p as z,m as G,e as Y,u as Z,U as J,h as L,k as de,ao as ee,z as q,d as U,f as pe,ah as W,$ as me,aa as ve,F as fe}from"./index-c781268b.js";import{u as K}from"./contracts-7e377877.js";import{S as be}from"./SlotPageTitle-17369af5.js";import{F as ge}from"./FormTabs-731aa8f6.js";import{F as ye,f as Ce,z as he,d as Ie,C as te}from"./bootstrap-vue-next.es-c86262f3.js";import{_ as ke}from"./IconDots-4f78eb4a.js";import{S as se}from"./StatusBadge-499d8e7d.js";import{f as De,a as Te}from"./useTimeFunction-8602dd60.js";/* empty css                                                                       */import{_ as $e}from"./IconCard-07d73f70.js";import{s as Se}from"./multiselect-9a74535b.js";import{B as Le}from"./BlockBalanceAgreement-1d554184.js";import"./IconPlus-97ddfd30.js";import"./IconSearch-afa9efad.js";import"./IconClose-3fa8ed32.js";import"./IconArrow-8731a209.js";const Pe=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"CreateDate",label:"Дата Создания",variant:"td-gray td-order",sortable:!0},{key:"Customer",label:"Договор"},{key:"TypeID",label:"Тип",variant:"td-gray td-order"},{key:"Orders",label:"Количество подключенных услуг",sortable:!0,variant:"td-gray td-order"},{key:"Balance",label:"Баланс",sortable:!0,variant:"td-gray td-order"},{key:"IsHidden",label:"Скрыт ?",variant:"td-gray td-order"},{key:"Status",label:"Статус",variant:"td-gray td-order"},{key:"controls",label:"",variant:"td-controls"}];const xe={class:"button-payment"},we={class:"button-payment__text"},Be={__name:"FormButtonPayment",setup(d){return(y,p)=>(S(),R("button",xe,[c($e,{class:"button-payment__icon"}),e("span",we,[ue(y.$slots,"default",{},void 0,!0)])]))}},Ve=H(Be,[["__scopeId","data-v-fcb8fa3c"]]);const oe=d=>(z("data-v-64d83888"),d=d(),G(),d),Ne={key:0,class:"table-controls"},Fe=oe(()=>e("span",{class:"text-success"},"First",-1)),Ee=oe(()=>e("span",{class:"text-info"},"Last",-1)),Oe={class:"multiselect-multiple-label"},Ue={class:"multiselect-option"},He={__name:"PaginationBlock",props:["modelValue","total_rows"],emits:["update:modelValue","updatePage"],setup(d,{emit:y}){const p=d,i=[10,25,50,100],_=I({current_page:1,per_page:10});return M(_.value,()=>{y("updatePage",_.value)}),(C,h)=>{const $=ye;return p.total_rows>0?(S(),R("div",Ne,[c($,{modelValue:_.value.current_page,"onUpdate:modelValue":h[0]||(h[0]=m=>_.value.current_page=m),"total-rows":p.total_rows,"per-page":_.value.per_page,"first-number":"","last-number":""},{"first-text":n(()=>[Fe]),"last-text":n(()=>[Ee]),page:n(({page:m,active:v})=>[e("span",null,g((m-1)*_.value.per_page+1)+"-"+g(m*_.value.per_page),1)]),_:1},8,["modelValue","total-rows","per-page"]),c(w(Se),{class:"multiselect--white",modelValue:_.value.per_page,"onUpdate:modelValue":h[1]||(h[1]=m=>_.value.per_page=m),options:i,label:"name",openDirection:"top",onInput:h[2]||(h[2]=m=>_.value.current_page=1)},{singlelabel:n(({value:m})=>[e("div",Oe,[e("span",null,"Отображать "+g(m.value)+" строк",1)])]),option:n(({option:m})=>[e("div",Ue,"Отображать "+g(m.name)+" строк",1)]),_:1},8,["modelValue"])])):X("",!0)}}},ae=H(He,[["__scopeId","data-v-64d83888"]]);const P=d=>(z("data-v-c9cb3f71"),d=d(),G(),d),Re={class:"contracts-list"},Ae=P(()=>e("span",{class:"td-mobile"},"Номер",-1)),je={class:"td-column-heavy"},qe=["onClick"],Me=P(()=>e("span",{class:"td-mobile"},"Дата Создания",-1)),ze={class:"d-block"},Ge=P(()=>e("span",{class:"td-mobile"},"Договор",-1)),Ye={class:"td-column-heavy"},Je={class:"table-td-blue"},Ke=P(()=>e("span",{class:"td-mobile"},"Тип договора",-1)),Qe=P(()=>e("span",{class:"td-mobile"},"Баланс",-1)),We=P(()=>e("span",{class:"td-mobile"},"Скрыт ?",-1)),Xe=P(()=>e("span",{class:"td-mobile"},"Статус",-1)),Ze=P(()=>e("span",{class:"td-mobile"},"Количество подключенных услуг",-1)),et=["onClick"],tt={class:"btn__group"},st={class:"dropdown-button"},ot={class:"btn btn--dots"},at={__name:"ContractsList",props:{search:{type:String,default:""}},setup(d){const y=d,p=Y(),i=K(),_=Z(),C=J("emitter"),h=I("CreateDate"),$=I(!0),m=I("desc"),v=I(10),k=I(1);I(!1);const B=s=>{i.booleanEdit({TableID:"Contracts",ColumnID:"IsHidden",RowID:s.ID}).then(()=>{i.fetchContracts()})},V=L(()=>{var s,a;return(a=(s=Object.keys(i==null?void 0:i.contractsList))==null?void 0:s.map(u=>i==null?void 0:i.contractsList[u]))==null?void 0:a.reverse()}),E=L(()=>{var s,a;return(a=(s=_.ConfigList)==null?void 0:s.Contracts)==null?void 0:a.Types}),N=L(()=>{var s;return(s=V.value.filter(a=>{var u;return a.Customer.toLowerCase().includes(((u=y.search)==null?void 0:u.toLowerCase())||"")}))==null?void 0:s.length});function F(s){C.emit("open-modal",{component:"StatusHistory",data:{modeID:"Contracts",rowID:s}})}function x(s){p.push(`/ContractScheme/${s}`)}function t(s){p.push(`/Balance/${s}`)}function l(s={}){v.value=s==null?void 0:s.per_page,k.value=s==null?void 0:s.current_page}function D(s){i==null||i.contractDownload({ContractID:s})}function O(s){p.push(`/Orders?contractID=${s}`)}return M(()=>y,()=>{k.value=1}),(s,a)=>{const u=Ce,T=se,ne=ke,Q=de("router-link"),j=he,le=Ie,re=te;return S(),R("div",Re,[c(re,{class:"basic-table",items:V.value,fields:w(Pe),"show-empty":!0,filterable:[],filter:y.search,"per-page":v.value,"sort-desc":$.value,"onUpdate:sortDesc":a[0]||(a[0]=o=>$.value=o),"sort-by":h.value,"onUpdate:sortBy":a[1]||(a[1]=o=>h.value=o),"sort-direction":m.value,"current-page":k.value,"empty-text":"У вас пока нет договоров.","empty-filtered-text":"Договора не найдены."},{"cell(ID)":n(o=>{var r;return[Ae,e("div",je,[e("div",{class:"table-td-gray order-id",onClick:b=>{var f;return x((f=o.item)==null?void 0:f.ID)}},"# "+g(w(ee).transformContractNumber((r=o.item)==null?void 0:r.ID)),9,qe)])]}),"cell(CreateDate)":n(o=>{var r;return[Me,e("span",ze,g(w(De)(w(Te)((r=o.item)==null?void 0:r.CreateDate))),1)]}),"cell(Customer)":n(o=>{var r;return[Ge,e("div",Ye,[e("div",Je,g((r=o.item)==null?void 0:r.Customer),1)])]}),"cell(TypeID)":n(o=>{var r,b;return[Ke,e("span",null,g((b=E.value[(r=o.item)==null?void 0:r.TypeID])==null?void 0:b.Name),1)]}),"cell(Balance)":n(o=>{var r;return[Qe,e("span",null,g((r=o.item)==null?void 0:r.Balance)+" ₽",1)]}),"cell(IsHidden)":n(o=>{var r,b;return[We,c(u,{class:"rule-checkbox",name:"checkbox",checked:(r=o.item)==null?void 0:r.IsHidden,modelValue:o.item.IsChecked,"onUpdate:modelValue":f=>o.item.IsChecked=f,onChange:f=>B(o.item)},null,8,["checked","modelValue","onUpdate:modelValue","onChange"]),e("span",null,g(((b=o.item)==null?void 0:b.IsHidden)===!0?"Да":"Нет"),1)]}),"cell(Status)":n(o=>{var r;return[Xe,c(T,{status:(r=o.item)==null?void 0:r.StatusID,"status-table":"Contracts",onClick:b=>{var f;return F((f=o.item)==null?void 0:f.ID)}},null,8,["status","onClick"])]}),"cell(Orders)":n(o=>{var r;return[Ze,e("span",{class:"total-orders",onClick:b=>{var f;return O((f=o.item)==null?void 0:f.ID)}},g((r=o.item)==null?void 0:r.Orders),9,et)]}),"cell(controls)":n(o=>{var r;return[e("div",tt,[((r=o.item)==null?void 0:r.TypeID)!="NaturalPartner"?(S(),q(Ve,{key:0,onClick:b=>{var f;return t((f=o.item)==null?void 0:f.ID)}},{default:n(()=>[U("Пополнить баланс")]),_:2},1032,["onClick"])):X("",!0),e("div",st,[c(le,{class:"dropdown-dots",right:""},{"button-content":n(()=>[e("div",ot,[c(ne)])]),default:n(()=>[c(j,null,{default:n(()=>{var b;return[c(Q,{to:`/ContractScheme/${(b=o.item)==null?void 0:b.ID}`},{default:n(()=>[U("Открыть")]),_:2},1032,["to"])]}),_:2},1024),c(j,null,{default:n(()=>{var b;return[c(Q,{to:`/ContractSettings/${(b=o.item)==null?void 0:b.ID}`},{default:n(()=>[U("Изменить тип учёта")]),_:2},1032,["to"])]}),_:2},1024),c(j,{onClick:b=>{var f;return D((f=o.item)==null?void 0:f.ID)}},{default:n(()=>[U("Загрузить договор")]),_:2},1032,["onClick"])]),_:2},1024)])])]}),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),c(ae,{total_rows:N.value,onUpdatePage:l},null,8,["total_rows"])])}}},nt=H(at,[["__scopeId","data-v-c9cb3f71"]]),lt=[{key:"ID",label:"Номер",variant:"td-gray td-order",sortable:!0},{key:"Name",label:"Профиль",variant:"td-blue"},{key:"TemplateID",label:"Тип",variant:"td-gray td-order"},{key:"StatusID",label:"Статус",sortable:!0,variant:"td-gray td-order"},{key:"StatusDate",label:"От статуса",sortable:!0,variant:"td-default td-order"}];const A=d=>(z("data-v-49ad5252"),d=d(),G(),d),rt={class:"contracts-profile-list"},ct=A(()=>e("span",{class:"td-mobile"},"Номер",-1)),it={class:"d-block"},_t=A(()=>e("span",{class:"td-mobile"},"Номер",-1)),ut=A(()=>e("span",{class:"td-mobile"},"От статуса",-1)),dt={class:"d-block"},pt=A(()=>e("span",{class:"td-mobile"},"Тип",-1)),mt=A(()=>e("span",{class:"td-mobile"},"Статус",-1)),vt={__name:"ContractsProfileList",props:["search"],setup(d){const y=d;Y();const p=K(),i=Z(),_=J("emitter"),C=I("ID"),h=I(!0),$=I("desc"),m=I(10),v=I(1),k=L(()=>{var t,l;return(l=(t=Object==null?void 0:Object.keys(p==null?void 0:p.profileList))==null?void 0:t.map(D=>p==null?void 0:p.profileList[D]))==null?void 0:l.reverse()}),B=L(()=>{var t,l;return(l=(t=i.ConfigList)==null?void 0:t.Profiles)==null?void 0:l.Templates}),V=L(()=>{var t;return(t=k.value.filter(l=>{var D;return l.Name.toLowerCase().includes(((D=y.search)==null?void 0:D.toLowerCase())||"")}))==null?void 0:t.length});function E(t={}){m.value=t==null?void 0:t.per_page,v.value=t==null?void 0:t.current_page}function N(t,l){l.target.closest("button, a, .clickable-element")||_.emit("open-modal",{component:"ProfileInfo",data:{data:t,template:B.value[t.TemplateID]}})}function F(t){const l=Math.floor((new Date().getTime()-t*1e3)/864e5);return l<0?0:l}function x(t){_.emit("open-modal",{component:"StatusHistory",data:{modeID:"Profiles",rowID:t}})}return(t,l)=>{const D=se,O=te,s=ae;return S(),R("div",rt,[c(O,{class:"basic-table",items:k.value,fields:w(lt),"show-empty":!0,filterable:[],filter:y.search,"per-page":m.value,"sort-desc":h.value,"onUpdate:sortDesc":l[0]||(l[0]=a=>h.value=a),"sort-by":C.value,"onUpdate:sortBy":l[1]||(l[1]=a=>C.value=a),"sort-direction":$.value,"current-page":v.value,"empty-text":"У вас пока нет профилей.","empty-filtered-text":"Профили не найдены.",onRowClicked:l[2]||(l[2]=(a,u,T)=>N(a,T))},{"cell(ID)":n(a=>{var u;return[ct,e("span",it,g(w(ee).transformContractNumber((u=a.item)==null?void 0:u.ID)),1)]}),"cell(Name)":n(a=>{var u;return[_t,e("span",null,g((u=a.item)==null?void 0:u.Name),1)]}),"cell(StatusDate)":n(a=>{var u;return[ut,e("span",dt,g(F((u=a.item)==null?void 0:u.StatusDate))+" дн.",1)]}),"cell(TemplateID)":n(a=>{var u,T;return[pt,e("span",null,g((T=B.value[(u=a.item)==null?void 0:u.TemplateID])==null?void 0:T.Name),1)]}),"cell(StatusID)":n(a=>[mt,c(D,{class:"clickable-element",status:a.value,"status-table":"Profiles",onClick:u=>{var T;return x((T=a.item)==null?void 0:T.ID)}},null,8,["status","onClick"])]),_:1},8,["items","fields","filter","per-page","sort-desc","sort-by","sort-direction","current-page"]),c(s,{total_rows:V.value,onUpdatePage:E},null,8,["total_rows"])])}}},ft=H(vt,[["__scopeId","data-v-49ad5252"]]);const bt={class:"section"},gt={class:"container"},yt={class:"list-form"},Ct={class:"contracts__page"},ht={__name:"Contracts",async setup(d){var N,F;let y,p;const i=pe(),_=Y(),C=K(),h=J("emitter"),$=[{value:"Contracts",name:"Договора"},{value:"Profiles",name:"Профили"}],m=L(()=>v.value==="Contracts"?"Договора":"Профили"),v=I("Contracts"),k=I(""),B=L(()=>{var x,t;return(t=(x=Object.keys(C==null?void 0:C.contractsList))==null?void 0:x.map(l=>C==null?void 0:C.contractsList[l]))==null?void 0:t.reverse()});function V(){v.value==="Contracts"?_.push({path:"/ContractMake"}):_.push({path:"/ProfileMake"})}function E(){h.emit("open-modal",{component:"FundsTransfer"})}return(N=i==null?void 0:i.query)!=null&&N.section?v.value=(F=i.query)==null?void 0:F.section:_.replace({query:{section:"Contracts"}}),M(v,()=>{_.replace({query:{section:v.value}})}),[y,p]=W(()=>C.fetchContracts()),await y,p(),[y,p]=W(()=>C.fetchProfiles()),await y,p(),(x,t)=>{const l=_e,D=ie,O=ce;return S(),R(fe,null,[c(Le),e("div",bt,[e("div",gt,[c(ge,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),tabs:$},null,8,["modelValue"]),c(be,null,{title:n(()=>[U(g(m.value),1)]),buttons:n(()=>[me(c(l,{label:"Перевод средств",onClick:t[1]||(t[1]=s=>E())},null,512),[[ve,v.value==="Contracts"&&B.value.length>1]]),c(l,{label:v.value==="Contracts"?"Создать договор":"Создать профиль",onClick:V},null,8,["label"])]),_:1}),c(D),e("div",yt,[c(O,{modelValue:k.value,"onUpdate:modelValue":t[2]||(t[2]=s=>k.value=s)},null,8,["modelValue"])]),e("div",Ct,[v.value==="Contracts"?(S(),q(nt,{key:0,search:k.value},null,8,["search"])):(S(),q(ft,{key:1,search:k.value},null,8,["search"]))])])])],64)}}},At=H(ht,[["__scopeId","data-v-463d4c40"]]);export{At as default};
