import{_ as I}from"./ButtonDefault-7c216fc6.js";import{_ as E}from"./BasicInput-be1c88a0.js";import{f as k,e as b,S as D,r as M,g as f,h as S,O as w,o as A,c as B,b as g,a as C,a2 as T}from"./index-5e313302.js";import"./component-6a5a025c.js";const U={class:"modal__body"},R=C("div",{class:"list-item__title"},"Добавление Telegram",-1),V=C("div",{class:"modal__input-row"},null,-1),j={__name:"ModalWindowCreateTelegram",emits:["modalClose","buttonClicked"],setup($,{emit:v}){const c=k(),u=b(),h=D("emitter"),l=M(""),i=f(()=>c.userInfo),y=f(()=>{var n;return Object.keys((n=i.value)==null?void 0:n.Contacts).map(e=>{var t,o,a,r,s;if(!((a=(o=(t=i.value)==null?void 0:t.Contacts)==null?void 0:o[e])!=null&&a.IsHidden))return(s=(r=i.value)==null?void 0:r.Contacts)==null?void 0:s[e]}).filter(Boolean)}),d=async(n,e)=>{try{return(await T.post(n,e)).data}catch(t){throw new Error(`Error sending confirm request: ${t.message}`)}};function m(){const n={MethodID:"Telegram",Address:l.value,TimeBegin:"00",TimeEnd:"00",IsActive:"yes",ContactID:"0"};c.userEditContact(n).then(e=>{e.response==="SUCCESS"&&(c.fetchUserData().then(async()=>{var a;((a=u.currentRoute.value)==null?void 0:a.fullPath)!=="/profile/UserProfile"&&u.push("profile/UserProfile");const t=y.value,o=t[t.length-1];if(o){const r={Method:o.MethodID,Value:o.Address,ContactID:o.ID};try{const s=await d("/API/Confirm",r);console.log("Response from server:",s),s.Status==="Ok"?h.emit("open-modal",{component:"AcceptContact",data:{contactId:o.ID,sendConfirmRequest:d}}):console.error(`Error confirming code. Status: ${s.Status}, Message: ${s.Message}`)}catch(s){console.error("Error accepting contact:",s.message)}}}),_())})}function _(){v("modalClose")}const p=n=>{n.key==="Enter"&&m()};return S(()=>{document.addEventListener("keyup",p)}),w(()=>{document.removeEventListener("keyup",p)}),(n,e)=>{const t=E,o=I;return A(),B("div",U,[R,V,g(t,{label:"Telegram сообщения",name:"name",placeholder:"Ссылка или id",vertical:"",modelValue:l.value,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a)},null,8,["modelValue"]),g(o,{class:"profile-info__add-button",label:"Добавить контакт",onClick:m,onButtonClicked:e[1]||(e[1]=a=>_())})])}}};export{j as default};
