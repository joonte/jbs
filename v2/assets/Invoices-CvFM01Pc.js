import{_ as dt}from"./EmptyStateBlock-DA3-0YDi.js";import{L as pt,a as vt,v as _t,r as ft}from"./bootstrap-vue-next-W16P-SAV.js";import{_ as It}from"./IconDots-BIoh_VC5.js";import{_ as yt}from"./IconCard-C_8uFbeS.js";import{U as Dt,o as p,c as x,n as bt,M as Ct,D as wt,r as u,f as D,E as k,b as a,a as n,w as s,v as b,F as R,h as gt,C as V,x as kt,d as St,i as xt,t as l,e as S,W as A}from"./index-Codq73aV.js";import{_ as Bt}from"./IconDownload-2-f4SkXV.js";import{_ as $t}from"./StatusBadge-BmqDrHzy.js";import{_ as Vt}from"./FormInputSearch-B47bjFcn.js";import{_ as Nt}from"./ClausesKeeper-iUM0yapS.js";import{_ as Lt}from"./ButtonDefault-CMw2aBy6.js";import{_ as Pt}from"./BlockBalanceAgreement-v_bWuiVT.js";import{u as Ft}from"./index-BO2gwtUe.js";import{f as Tt}from"./common-DyknwSqv.js";import{s as O}from"./multiselect-DElL0Rlw.js";import{f as Et,s as Ut}from"./time-DenPiOX5.js";import{_ as Rt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./IconPlus-Bm8D3Wgq.js";import"./IconClose-Dia1noy8.js";const At=Dt({__name:"SimpleButton",props:{type:{}},setup(j){return(i,m)=>(p(),x("button",{class:bt(["tw-h-8 tw-px-2 tw-flex tw-items-center tw-gap-2 tw-text-2xs tw-font-bold tw-uppercase tw-border tw-rounded hover:tw-text-sky-400",i.type==="cancel"?"tw-text-red-500":"tw-text-gray-800"])},[Ct(i.$slots,"default")],2))}}),Ot={class:"tw-px-4 md:tw-px-8"},jt={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},Mt={class:"list-form"},ht={class:"list-form_col list-form_col--sm"},zt={class:"list-form_select"},Ht={class:"multiselect-option"},Wt={class:"d-block"},qt={class:"d-block"},Zt={class:"d-block"},Gt={class:"d-block"},Jt={class:"d-block"},Kt=["href"],Qt={key:0,class:"table-controls"},Xt={class:"multiselect-multiple-label"},Yt={class:"multiselect-option"},te={__name:"Invoices",async setup(j){let i,m;const B=Ft(),r=wt(),M=St(),C=xt(),c=kt("emitter"),h=[{key:"ID",label:"Номер счета",variant:"td-blue"},{key:"PaymentSystemName",label:"Платежная система",variant:"td-gray td-order"},{key:"CreateDate",label:"Дата и время",variant:"td-gray td-order",sortable:!0},{key:"ContractID",label:"Договор",variant:"td-blue"},{key:"StatusID",label:"Статус",variant:"td-gray td-order",sortable:!0},{key:"Summ",label:"Сумма",variant:"td-gray td-order",sortable:!0},{key:"Button1",variant:"td-controls",label:""},{key:"Button2",variant:"td-controls",label:""},{key:"Button3",variant:"td-controls",label:""},{key:"Button4",variant:"td-controls",label:""}];c.on("updateInvoicesTable",()=>{r.fetchInvoices()});const N=u("CreateDate"),L=u(!0),z=u("desc"),I=u(""),v=u("*"),y=u(1),_=u(10),H=u([10,25,50,100]),w=D(()=>Object.keys(r?.invoicesList).map(o=>({...r?.invoicesList[o],Customer:F.value?.[r?.invoicesList[o].ContractID]?.Customer,Summ:Number(r?.invoicesList[o]?.Summ)})).reverse()),P=D(()=>w.value.filter(t=>v.value!=="*"?Number(t.ContractID)===Number(v.value):!0)),F=D(()=>B.contractsList),T=D(()=>{let o=[];return w.value.map(t=>{if(!o.find(f=>f===t.Customer))return o.push(t.Customer),{value:t.ContractID,name:t.Customer}}).filter(Boolean).concat([{value:"*",name:"Все договора"}]).reverse()}),E=D(()=>w.value.filter(o=>o?.PaymentSystemName.toLowerCase().includes(I.value?.toLowerCase())||String(o?.Summ).toLowerCase().includes(I.value?.toLowerCase())).filter(o=>String(o.ContractID).includes(v.value!=="*"?v.value:"")).length);function W(){M.go(0)}function q(){y.value=1}function Z(o){window.location=`${A}/InvoiceDownload?InvoiceID=${o?.item?.ID}&IsStamp=yes`}function G(o){return`${A}/InvoiceDownload?InvoiceID=${o?.item?.ID}&IsTIFF=yes&IsStamp=yes`}function J(o){c.emit("open-modal",{component:"AcceptConditionally",data:{ContractID:o?.item?.ContractID,RowsIDs:o?.item?.ID,AllowConditionallyMessage:o?.item?.AllowConditionallyMessage}})}function K(o){c.emit("open-modal",{component:"StatusHistory",data:{modeID:"Invoices",rowID:o}})}function Q(o){c.emit("open-modal",{component:"InvoiceEdit",data:{ItemID:o?.item?.ID,TypeID:F.value?.[o?.item?.ContractID]?.TypeID,Summ:o?.item?.Summ,PaymentSystemID:o.item.PaymentSystemID}})}async function U(o){const t=await r.InvoiceDocument({InvoiceID:o.item?.ID});c.emit("open-modal",{component:"InvoiceDocument",data:{html:t,ID:o.item?.ID}})}async function X(o){const t=await r.InvoiceDocument({InvoiceID:o.item?.ID});c.emit("open-modal",{component:"InvoiceDocumentView",data:{html:t}})}function Y(){c.emit("open-modal",{component:"NewInvoice"})}function tt(o){let t=new FormData;t.append("ContractID","Default"),t.append("RowsIDs[]",o.item?.ID),r.InvoicesReject(t).then(f=>{f==="SUCCESS"&&r.fetchInvoices()})}return[i,m]=k(()=>B.fetchContracts()),await i,m(),[i,m]=k(()=>B.fetchProfiles()),await i,m(),[i,m]=k(()=>r.fetchInvoices().then(()=>{C.params?.id&&w.value?.find(t=>t.ID===Number(C.params?.id))&&U({item:{ID:C.params.id}}),C.query.Error==="yes"&&c.emit("open-modal",{component:"InvoiceError"})})),await i,m(),[i,m]=k(()=>r.fetchServices()),await i,m(),(o,t)=>{const f=Pt,et=Lt,ot=Nt,nt=Vt,st=$t,at=Bt,g=At,lt=yt,it=It,$=ft,rt=_t,mt=pt,ct=vt,ut=dt;return p(),x(R,null,[a(f),n("div",Ot,[n("div",jt,[n("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:t[0]||(t[0]=e=>W())}," Счета на оплату "),a(et,{onClick:t[1]||(t[1]=e=>Y()),label:"Выписать новый счёт"})]),a(ot),n("div",Mt,[n("div",ht,[n("div",zt,[a(b(O),{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e),options:T.value,disabled:T.value?.length<=1,label:"name"},{singlelabel:s(({value:e})=>[n("span",null,"# "+l(String(e.value).padStart(5,"0"))+" / "+l(e.name),1)]),option:s(({option:e})=>[n("span",Ht,"# "+l(String(e.value).padStart(5,"0"))+" / "+l(e.name),1)]),_:1},8,["modelValue","options","disabled"])])]),a(nt,{modelValue:I.value,"onUpdate:modelValue":t[3]||(t[3]=e=>I.value=e)},null,8,["modelValue"])]),P.value?.length>0?(p(),x(R,{key:0},[a(mt,{class:"basic-table",items:P.value,fields:h,"show-empty":!0,filter:I.value,"per-page":_.value,"current-page":y.value,responsive:"","sort-by":N.value,"onUpdate:sortBy":t[4]||(t[4]=e=>N.value=e),"sort-desc":L.value,"onUpdate:sortDesc":t[5]||(t[5]=e=>L.value=e),"sort-direction":z.value,filterable:["PaymentSystemName","Summ","ContractID"],"sort-compare-options":{numeric:!0,sensitivity:"base"},"empty-text":"Заказов пока нет.","empty-filtered-text":"Заказы не найдены.",onFiltered:q},{"cell(PaymentSystemName)":s(e=>[t[9]||(t[9]=n("span",{class:"td-mobile"},"Платежная система",-1)),n("span",Wt,l(e.value),1)]),"cell(CreateDate)":s(e=>[t[10]||(t[10]=n("span",{class:"td-mobile"},"Дата Создания",-1)),n("span",qt,l(b(Et)(b(Ut)(e.item?.CreateDate))),1)]),"cell(ID)":s(e=>[t[11]||(t[11]=n("span",{class:"td-mobile"},"Номер счета",-1)),n("span",Zt,l(e.value),1)]),"cell(ContractID)":s(e=>[t[12]||(t[12]=n("span",{class:"td-mobile"},"Договор",-1)),n("span",Gt,"#"+l(e.item?.ContractID)+" / "+l(e.item?.Customer),1)]),"cell(StatusID)":s(e=>[a(st,{status:e.value,"status-table":"Invoices",onClick:d=>K(e.item?.ID),class:"tw-cursor-pointer"},null,8,["status","onClick"])]),"cell(Summ)":s(e=>[t[13]||(t[13]=n("span",{class:"td-mobile"},"Сумма",-1)),n("span",Jt,l(b(Tt)(e.item?.Summ)),1)]),"cell(Button1)":s(e=>[a(g,{onClick:d=>Z(e)},{default:s(()=>[a(at,{class:"tw-size-5"}),t[14]||(t[14]=n("div",null,"Скачать",-1))]),_:2,__:[14]},1032,["onClick"])]),"cell(Button2)":s(e=>[e.item?.IsPosted?(p(),V(g,{key:0,onClick:d=>X(e)},{default:s(()=>t[15]||(t[15]=[S(" Посмотреть ",-1)])),_:2,__:[15]},1032,["onClick"])):(p(),V(g,{key:1,onClick:d=>U(e)},{default:s(()=>[a(lt,{class:"tw-size-5"}),t[16]||(t[16]=n("div",null,"Оплатить",-1))]),_:2,__:[16]},1032,["onClick"]))]),"cell(Button3)":s(e=>[a(g,{type:"cancel",onClick:d=>tt(e)},{default:s(()=>t[17]||(t[17]=[S("Отменить",-1)])),_:2,__:[17]},1032,["onClick"])]),"cell(Button4)":s(e=>[a(rt,{class:"dropdown-dots tw-m-0",right:""},{"button-content":s(()=>[a(it)]),default:s(()=>[a($,null,{default:s(()=>[n("a",{href:G(e)},"Скачать в формате tiff",8,Kt)]),_:2},1024),a($,{onClick:d=>Q(e)},{default:s(()=>t[18]||(t[18]=[S("Изменить счёт",-1)])),_:2,__:[18]},1032,["onClick"]),a($,{onClick:d=>J(e)},{default:s(()=>t[19]||(t[19]=[S("Провести условно",-1)])),_:2,__:[19]},1032,["onClick"])]),_:2},1024)]),_:1},8,["items","filter","per-page","current-page","sort-by","sort-desc","sort-direction"]),E.value>0?(p(),x("div",Qt,[a(ct,{modelValue:y.value,"onUpdate:modelValue":t[6]||(t[6]=e=>y.value=e),"total-rows":E.value,"per-page":_.value,"first-number":"","last-number":""},{"first-text":s(()=>t[20]||(t[20]=[n("span",{class:"text-success"},"First",-1)])),"last-text":s(()=>t[21]||(t[21]=[n("span",{class:"text-info"},"Last",-1)])),page:s(({page:e,active:d})=>[n("span",null,l((e-1)*_.value+1)+"-"+l(e*_.value),1)]),_:1},8,["modelValue","total-rows","per-page"]),a(b(O),{class:"multiselect--white",modelValue:_.value,"onUpdate:modelValue":t[7]||(t[7]=e=>_.value=e),options:H.value,label:"name",openDirection:"top",onInput:t[8]||(t[8]=e=>y.value=1)},{singlelabel:s(({value:e})=>[n("span",Xt," Отображать "+l(e.value)+" строк ",1)]),option:s(({option:e})=>[n("span",Yt,"Отображать "+l(e.name)+" строк",1)]),_:1},8,["modelValue","options"])])):gt("",!0)],64)):(p(),V(ut,{key:1,label:"Заказов не найдено"}))])],64)}}},De=Rt(te,[["__scopeId","data-v-d3bedd1d"]]);export{De as default};
