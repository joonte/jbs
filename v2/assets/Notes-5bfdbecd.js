import{o as _,c as D,a as p,b as S,_ as N,x as y,w as H,F as $,v as W,a8 as q,p as U,l as F,r as V,f as G,g as C,e as z,R as J,$ as K,N as Q,a2 as X}from"./index-33bd9cf4.js";import{_ as Y,u as Z,n as ee}from"./networkController-a607a371.js";import{u as te}from"./postings-9b1c8c68.js";import{u as oe}from"./contracts-141debab.js";import{I as ne}from"./IconClose-d9fbf580.js";import{E as P}from"./EmptyStateBlock-98549fc8.js";import{B}from"./BlockBalanceAgreement-5028e9bc.js";import{_ as se}from"./ClausesKeeper-69d31679.js";import"./bootstrap-vue-next.es-6bb0e5cd.js";import"./ButtonDefault-34d9e627.js";import"./IconArrow-dadffb08.js";const ce={class:"notes__note-container"},ae=["innerHTML"];function re(o,a,d,s,l,f){const h=ne;return _(),D("div",ce,[p("div",{class:"notes__content",innerHTML:d.item},null,8,ae),p("div",{class:"notes__close-button",onClick:a[0]||(a[0]=I=>s.closeNote(d.index))},[S(h,{class:"notes__close-button-cross"})])])}const ie={props:{item:{type:String,default:""},index:{type:[String,Number],default:""}},emits:["delete"],setup(o,{emit:a}){function d(s){let l=new Date;l.setDate(30+l.getDate()),document.cookie=`${s}=hidden; path=/; expires=${l}`,a("delete",s)}return{closeNote:d}}},E=N(ie,[["render",re],["__scopeId","data-v-8295fda7"]]),le=o=>(U("data-v-e3917fa4"),o=o(),F(),o),de={class:"section"},me={class:"container"},pe=le(()=>p("div",{class:"section-header"},[p("h1",{class:"section-title"},"Уведомления")],-1)),ue={class:"notes"};function _e(o,a,d,s,l,f){const h=B,I=se,u=E,r=P;return _(),D($,null,[S(h),p("div",de,[p("div",me,[pe,S(I),p("div",ue,[s.notes&&Object.keys(s.notes).length>0?(_(),y(q,{key:0,class:"notes__transition-container",tag:"div",name:"list"},{default:H(()=>[(_(!0),D($,null,W(s.notes,(v,w)=>(_(),y(u,{item:v,index:w,key:w,onDelete:s.deleteItem},null,8,["item","index","onDelete"]))),128))]),_:1})):(_(),y(r,{key:1,label:"Все уведомления прочитаны или они еще не пришли"}))])])])],64)}const fe={components:{IconCross:Y,Note:E,EmptyStateBlock:P,BlockBalanceAgreement:B},async setup(){const o=Z(),a=V(null),d=te(),s=oe(),l=G(),f=C(()=>l.userInfo),h=C(()=>{var e,t;return(t=Object.keys((e=f.value)==null?void 0:e.Contacts))==null?void 0:t.map(n=>{var c,m,g,i,x;if(!((g=(m=(c=f.value)==null?void 0:c.Contacts)==null?void 0:m[n])!=null&&g.IsHidden))return(x=(i=f.value)==null?void 0:i.Contacts)==null?void 0:x[n]})}),I=e=>h.value.find(t=>t.ID===e),u=z(),r=J("emitter"),v=C(()=>{let e={};return Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t]}),Object.keys(e).length>0?e:null});function w(){let e={};Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;j(t)&&(e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t])}),a.value=e}function j(e){return document.cookie.match(RegExp(`(?:^|;\\s*)${e}=([^;]*)`))===null}function A(e){delete a.value[e],r.emit("notes-reduce")}const b=async(e,t)=>{try{return(await X.post(e,t)).data}catch(n){throw new Error(`Error sending confirm request: ${n.message}`)}};async function k(e,t){if(console.log("Route: ",e,"Data: ",t),e.includes("OrderPay")){let n=t[Object.keys(t).find(c=>c.includes("OrderID"))];e!=="/ExtraIPOrderPay"&&e!=="/ISPswOrderPay"&&e!=="/DNSmanagerOrderPay"?u.push(`${e}/${n}`):u.push(`ServiceOrderPay/${n}`)}else if(e==="/InvoiceDocument")d.InvoiceDocument({InvoiceID:t.InvoiceID}).then(n=>{r.emit("open-modal",{component:"InvoiceDocument",data:{html:n,ID:t.InvoiceID}})});else if(e==="/API/OrdersTransfer")console.log(t),r.emit("open-modal",{component:"TakeOrder",data:{OrdersTransferID:t}});else if(e==="/ContractMake")u.push("ContractMake");else if(e==="/ISPswOrders")u.push("AdditionalServices");else if(e.includes("/ContactEdit")){const n=e.match(/ContactID=(\d+)/),c=n?n[1]:null;if(console.log("contactId:",c),c){const m=I(c);if(m){const g={Method:m.MethodID,Value:m.Address,ContactID:m.ID};try{const i=await b("/API/Confirm",g);console.log("Response from server:",i),i.Status==="Ok"?r.emit("open-modal",{component:"AcceptContact",data:{contactId:c,sendConfirmRequest:b}}):console.error(`Error confirming code. Status: ${i.Status}, Message: ${i.Message}`)}catch(i){console.error("Error accepting contact:",i.message)}}}else console.error("ContactID is not present in the URL params.",e)}else console.log(e,t),r.emit("open-modal",{component:e.replace("/",""),data:t})}function L(){}function M(e,t,n,c){ee.post(e,t).then(()=>{o.fetchNotes().then(()=>{w()})})}function R(e,t){r.emit("open-modal",{component:"DeleteItem",data:{id:null,callback:t,message:e,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function T(){}function O(){window.ShowWindow=k.bind(this)}return K(()=>{O()}),Q(()=>{window.ShowWindow=null}),r.on("close-modal",()=>{O()}),window.ShowProgress=T.bind(this),window.ShowWindow=k.bind(this),window.PromptShow=L.bind(this),window.AjaxCall=M.bind(this),window.ShowConfirm=R.bind(this),await o.fetchNotes().then(()=>{w()}),await s.fetchContracts(),await l.fetchUserData(),{getNotesList:v,notes:a,ShowWindow:k,deleteItem:A}}},Oe=N(fe,[["render",_e],["__scopeId","data-v-e3917fa4"]]);export{Oe as default};
