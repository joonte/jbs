import{j as $,o as ee,c as te,a as o,t as E,n as f,Z as R,an as q,b as M,p as ae,l as le,_ as oe,e as ne,r as p,g as S,i as H,h as se}from"./index-145d9cde.js";import{u as re}from"./services-42f7a1d0.js";import{u as ie}from"./contracts-009c925b.js";import{s as de}from"./multiselect-a2d623ca.js";import{_ as ce}from"./ButtonDefault-6a3a5e1e.js";const x=d=>(ae("data-v-14805983"),d=d(),le(),d),ue={class:"modal__body"},pe={class:"list-item__title"},ve={class:"form"},me=x(()=>o("span",{class:"form-input_border-content"},[o("span",{class:"form-input_border-mark"}),o("span",{class:"form-input_border-info"},[o("span",{class:"form-input_border-address"},"Выбор периода оплаты")])],-1)),be=x(()=>o("span",{class:"form-input_border-content"},[o("span",{class:"form-input_border-mark"}),o("span",{class:"form-input_border-info"},[o("span",{class:"form-input_border-address"},"Выбор даты окончания")])],-1)),_e={class:"modal__input-row select-date"},fe=["disabled"],Se={class:"form-input_border-content"},De=x(()=>o("span",{class:"form-input_border-mark"},null,-1)),he={class:"form-input_border-info"},ye=x(()=>o("span",{class:"form-input_border-address"},"Выбор даты окончания",-1)),Oe={class:"modal__input-title"},ge={class:"modal__buttons-wrap"};function Me(d,n,B,t,I,w){var v;const b=$("Multiselect"),y=ce;return ee(),te("div",ue,[o("div",pe,"Оплата заказа вторичного DNS, dns"+E((v=B.data)==null?void 0:v.ServiceOrderID),1),o("div",ve,[o("label",{class:f(["form-input_border",{"disabled-label":t.selectedOption!=="month"}])},[R(o("input",{type:"radio",name:"Command",value:"month","onUpdate:modelValue":n[0]||(n[0]=r=>t.selectedOption=r)},null,512),[[q,t.selectedOption]]),me],2),M(b,{class:f(["multiselect--white",{"multiselect--disabled":t.selectedOption!=="month"}]),type:"text",modelValue:t.selectedMonth,"onUpdate:modelValue":n[1]||(n[1]=r=>t.selectedMonth=r),options:t.monthsOptions,placeholder:"Период оплаты",label:"label","track-by":"value",disabled:t.selectedOption!=="month"},null,8,["class","modelValue","options","disabled"]),o("label",{class:f(["form-input_border",{"disabled-label":t.selectedOption!=="period"}])},[R(o("input",{type:"radio",name:"Command",value:"period","onUpdate:modelValue":n[2]||(n[2]=r=>t.selectedOption=r)},null,512),[[q,t.selectedOption]]),be],2),o("div",_e,[M(b,{class:f(["multiselect--white",{"multiselect--disabled":t.selectedOption!=="period"}]),options:t.yearsOptions,type:"text",modelValue:t.selectedYear,"onUpdate:modelValue":n[3]||(n[3]=r=>t.selectedYear=r),placeholder:"Год",disabled:t.selectedOption!=="period"},null,8,["options","class","modelValue","disabled"]),M(b,{class:f(["multiselect--white",{"multiselect--disabled":t.selectedOption!=="period"}]),options:t.monthOptions,type:"text",modelValue:t.selectedMonthS,"onUpdate:modelValue":n[4]||(n[4]=r=>t.selectedMonthS=r),placeholder:"Месяц",disabled:t.selectedOption!=="period"},null,8,["options","class","modelValue","disabled"]),M(b,{class:f(["multiselect--white",{"multiselect--disabled":t.selectedOption!=="period"}]),options:t.daysOptions,type:"text",modelValue:t.selectedDay,"onUpdate:modelValue":n[5]||(n[5]=r=>t.selectedDay=r),placeholder:"День",disabled:t.selectedOption!=="period"},null,8,["options","class","modelValue","disabled"])]),o("label",{class:f(["form-input_border",{"disabled-label":t.selectedOption!=="balance"}])},[R(o("input",{type:"radio",name:"Command",value:"balance",disabled:t.daysBalanceLasts===0,"onUpdate:modelValue":n[6]||(n[6]=r=>t.selectedOption=r)},null,8,fe),[[q,t.selectedOption]]),o("span",Se,[De,o("span",he,[ye,o("div",Oe,"Остаток денег на балансе ("+E(t.getContract.balance)+"), хватит на "+E(t.daysBalanceLasts)+" дней",1)])])],2)]),o("div",ge,[M(y,{class:"select-contract__button modal__button",label:t.buttonText,onClick:n[7]||(n[7]=r=>t.payService())},null,8,["label"])])])}const Ie={components:{Multiselect:de},props:{data:{type:Object,default:()=>{}}},emits:["modalClose"],setup(d,{emit:n}){var G;const B=ne(),t=(G=d.data)==null?void 0:G.ExpirationDate.split("."),I=parseInt(t[2],10),w=parseInt(t[1],10)-1,b=parseInt(t[0],10),y=new Date,v=y.getFullYear(),r=y.getMonth();y.getDate();const i=re(),U=ie(),O=p("month"),c=p(null),N=p(null),u=p(null),D=p(null);let C=I,V=w+1,A=b;C<v&&(C=v),I===v&&w<=r&&(V=r+2,A=1),V>12&&(V=1,C+=1),D.value=A.toString().padStart(2,"0");const W=p([]);for(let e=v;e<=v+3;e++)W.value.push({label:e.toString(),value:e});const P=p([{label:"Январь",value:"01"},{label:"Февраль",value:"02"},{label:"Март",value:"03"},{label:"Апрель",value:"04"},{label:"Май",value:"05"},{label:"Июнь",value:"06"},{label:"Июль",value:"07"},{label:"Август",value:"08"},{label:"Сентябрь",value:"09"},{label:"Октябрь",value:"10"},{label:"Ноябрь",value:"11"},{label:"Декабрь",value:"12"}]),z=e=>{const l=new Date().getFullYear(),a=new Date().getMonth()+1;P.value=[];for(let s=1;s<=12;s++)(e>l||s>=a)&&P.value.push({label:s.toString().padStart(2,"0"),value:s.toString().padStart(2,"0")});e==l?c.value=(a%12+1).toString().padStart(2,"0"):c.value="01"},Y=p([]),j=(e,l)=>{const a=new Date(l,e,0).getDate();Y.value=[];for(let _=1;_<=a;_++)Y.value.push({label:_.toString().padStart(2,"0"),value:_.toString().padStart(2,"0")});const s=new Date,m=s.getFullYear(),h=s.getMonth()+1,T=s.getDate();l==m&&e==h?D.value=T.toString().padStart(2,"0"):D.value="01"},J=S(()=>i==null?void 0:i.DNSmanagerOrdersList),L=S(()=>{const e=J.value;if(!(!e||typeof e!="object"))return Object.keys(e).map(l=>e[l]).find(l=>{var a;return l.ID===((a=d.data)==null?void 0:a.ServiceOrderID)})}),k=S(()=>{var e;return(e=i==null?void 0:i.additionalServicesScheme)!=null&&e.DNSmanager?Object.keys(i.additionalServicesScheme.DNSmanager).map(l=>{const a=i.additionalServicesScheme.DNSmanager[l];return{...a,value:a==null?void 0:a.ID,name:a==null?void 0:a.Name,cost:a==null?void 0:a.CostDay}}).filter(l=>{var a;return(l==null?void 0:l.ID)==((a=L.value)==null?void 0:a.SchemeID)}):[]}),K=S(()=>U==null?void 0:U.contractsList),F=S(()=>{const e=Object.values(K.value).find(l=>{var a;return l&&l.ID===((a=d.data)==null?void 0:a.contractID)});return e?{value:e.ID,name:e.Customer,balance:e.Balance}:null}),g=S(()=>{var e;if(F.value&&k.value.length>0){const l=F.value.balance,a=(e=k.value[0])==null?void 0:e.cost,s=parseFloat(l),m=parseFloat(a);if(!isNaN(s)&&!isNaN(m)&&m>0)return Math.floor(s/m)}return 0}),Z=p([{label:"1 мес.",value:1},{label:"2 мес.",value:2},{label:"3 мес.",value:3},{label:"6 мес.",value:6},{label:"9 мес.",value:9},{label:"12 мес.",value:12},{label:"24 мес.",value:24},{label:"36 мес.",value:36}]);function Q(){var m;let e;if(O.value==="balance")e=g.value;else if(O.value==="period"){const h=new Date(u.value,parseInt(c.value)-1,D.value),T=new Date(I,w,b),_=h-T;e=_>0?Math.ceil(_/(1e3*60*60*24)):0}else e=N.value*30;const l=e<g.value,a=!l,s={DNSmanagerOrderID:(m=d.data)==null?void 0:m.ServiceOrderID,DaysPay:e,IsNoBasket:l,IsUseBasket:a,PayMessage:""};console.log(`requestData - ${s}`),i.DNSOrderPay(s).then(h=>{h.Status==="UseBasket"?(n("modalClose"),B.push("/Basket")):h.Status==="NoBasket"?n("modalClose"):console.error("Ошибка оплаты заказа")}),console.log(`Количество дней: ${e}`)}const X=S(()=>{let e;if(O.value==="period"){const l=new Date(u.value,parseInt(c.value)-1,D.value),a=new Date,s=l-a;e=s>0?Math.ceil(s/(1e3*60*60*24)):0}else O.value==="balance"?e=g.value:e=N.value*30;return e>g.value?"Добавить в корзину":"Оплатить с баланса договора"});return H(u,e=>{z(e),j(c.value,e)}),H(c,e=>{e&&u.value&&j(e,u.value)}),se(()=>{i.fetchAdditionalServiceScheme("DNSmanager"),u.value=C.toString(),c.value=V.toString().padStart(2,"0"),N.value=Z.value[0].value,z(u.value),j(c.value,u.value),console.log(k),console.log(L)}),{selectedMonth:N,selectedYear:u,selectedDay:D,monthsOptions:Z,payService:Q,getContract:F,getISPswOrder:L,getISPswScheme:k,daysBalanceLasts:g,selectedOption:O,selectedMonthS:c,yearsOptions:W,monthOptions:P,daysOptions:Y,buttonText:X}}},xe=oe(Ie,[["render",Me],["__scopeId","data-v-14805983"]]);export{xe as default};
