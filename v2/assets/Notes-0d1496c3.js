import{o as u,c as D,a as p,b as x,_ as $,x as y,w as B,F as T,v as H,a7 as W,p as q,l as U,r as F,f as V,g as C,e as G,R as z,$ as J,N as K,a2 as Q}from"./index-ed1f28f8.js";import{_ as X,u as Y,n as Z}from"./networkController-819a3d02.js";import{u as ee}from"./postings-71aa09ae.js";import{u as te}from"./contracts-cedf6a91.js";import{I as oe}from"./IconClose-a1e58263.js";import{E as N}from"./EmptyStateBlock-dbc11827.js";import{_ as ne}from"./ClausesKeeper-9aa8ead7.js";const se={class:"notes__note-container"},ce=["innerHTML"];function ae(o,a,d,s,l,_){const f=oe;return u(),D("div",se,[p("div",{class:"notes__content",innerHTML:d.item},null,8,ce),p("div",{class:"notes__close-button",onClick:a[0]||(a[0]=w=>s.closeNote(d.index))},[x(f,{class:"notes__close-button-cross"})])])}const re={props:{item:{type:String,default:""},index:{type:[String,Number],default:""}},emits:["delete"],setup(o,{emit:a}){function d(s){let l=new Date;l.setDate(30+l.getDate()),document.cookie=`${s}=hidden; path=/; expires=${l}`,a("delete",s)}return{closeNote:d}}},P=$(re,[["render",ae],["__scopeId","data-v-8295fda7"]]),ie=o=>(q("data-v-055ff236"),o=o(),U(),o),le={class:"section"},de={class:"container"},me=ie(()=>p("div",{class:"section-header"},[p("h1",{class:"section-title"},"Уведомления")],-1)),ue={class:"notes"};function pe(o,a,d,s,l,_){const f=ne,w=P,h=N;return u(),D("div",le,[p("div",de,[me,x(f),p("div",ue,[s.notes&&Object.keys(s.notes).length>0?(u(),y(W,{key:0,class:"notes__transition-container",tag:"div",name:"list"},{default:B(()=>[(u(!0),D(T,null,H(s.notes,(r,I)=>(u(),y(w,{item:r,index:I,key:I,onDelete:s.deleteItem},null,8,["item","index","onDelete"]))),128))]),_:1})):(u(),y(h,{key:1,label:"Все уведомления прочитаны или они еще не пришли"}))])])])}const _e={components:{IconCross:X,Note:P,EmptyStateBlock:N},async setup(){const o=Y(),a=F(null),d=ee(),s=te(),l=V(),_=C(()=>l.userInfo),f=C(()=>{var e,t;return(t=Object.keys((e=_.value)==null?void 0:e.Contacts))==null?void 0:t.map(n=>{var c,m,g,i,O;if(!((g=(m=(c=_.value)==null?void 0:c.Contacts)==null?void 0:m[n])!=null&&g.IsHidden))return(O=(i=_.value)==null?void 0:i.Contacts)==null?void 0:O[n]})}),w=e=>f.value.find(t=>t.ID===e),h=G(),r=z("emitter"),I=C(()=>{let e={};return Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t]}),Object.keys(e).length>0?e:null});function k(){let e={};Object.keys(o==null?void 0:o.notesList).reverse().forEach(t=>{var n;E(t)&&(e[t]=(n=o==null?void 0:o.notesList)==null?void 0:n[t])}),a.value=e}function E(e){return document.cookie.match(RegExp(`(?:^|;\\s*)${e}=([^;]*)`))===null}function j(e){delete a.value[e],r.emit("notes-reduce")}const S=async(e,t)=>{try{return(await Q.post(e,t)).data}catch(n){throw new Error(`Error sending confirm request: ${n.message}`)}};async function v(e,t){if(console.log("Route: ",e,"Data: ",t),e.includes("OrderPay")){let n=t[Object.keys(t).find(c=>c.includes("OrderID"))];e!=="/ExtraIPOrderPay"&&e!=="/ISPswOrderPay"&&e!=="/DNSmanagerOrderPay"?h.push(`${e}/${n}`):h.push(`ServiceOrderPay/${n}`)}else if(e==="/InvoiceDocument")d.InvoiceDocument({InvoiceID:t.InvoiceID}).then(n=>{r.emit("open-modal",{component:"InvoiceDocument",data:{html:n,ID:t.InvoiceID}})});else if(e==="/API/OrdersTransfer")console.log(t),r.emit("open-modal",{component:"TakeOrder",data:{OrdersTransferID:t}});else if(e==="/ContractMake")h.push("ContractMake");else if(e.includes("/ContactEdit")){const n=e.match(/ContactID=(\d+)/),c=n?n[1]:null;if(console.log("contactId:",c),c){const m=w(c);if(m){const g={Method:m.MethodID,Value:m.Address,ContactID:m.ID};try{const i=await S("/API/Confirm",g);console.log("Response from server:",i),i.Status==="Ok"?r.emit("open-modal",{component:"AcceptContact",data:{contactId:c,sendConfirmRequest:S}}):console.error(`Error confirming code. Status: ${i.Status}, Message: ${i.Message}`)}catch(i){console.error("Error accepting contact:",i.message)}}}else console.error("ContactID is not present in the URL params.",e)}else console.log(e,t),r.emit("open-modal",{component:e.replace("/",""),data:t})}function L(){}function M(e,t,n,c){Z.post(e,t).then(()=>{o.fetchNotes().then(()=>{k()})})}function R(e,t){r.emit("open-modal",{component:"DeleteItem",data:{id:null,callback:t,message:e,tableID:"HostingOrders",successEmit:"updateHostingList"}})}function A(){}function b(){window.ShowWindow=v.bind(this)}return J(()=>{b()}),K(()=>{window.ShowWindow=null}),r.on("close-modal",()=>{b()}),window.ShowProgress=A.bind(this),window.ShowWindow=v.bind(this),window.PromptShow=L.bind(this),window.AjaxCall=M.bind(this),window.ShowConfirm=R.bind(this),await o.fetchNotes().then(()=>{k()}),await s.fetchContracts(),await l.fetchUserData(),{getNotesList:I,notes:a,ShowWindow:v,deleteItem:j}}},Ce=$(_e,[["render",pe],["__scopeId","data-v-055ff236"]]);export{Ce as default};
