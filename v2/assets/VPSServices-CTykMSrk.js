import{_ as K}from"./EmptyStateBlock-BaR9js3E.js";import{_ as q}from"./BlockAdditionalServices-BALrMbkE.js";import{_ as z}from"./ButtonDefault-BIBStZbJ.js";import{_ as J}from"./StatusBadge-CjHHKSUG.js";import{_ as Q}from"./ClausesKeeper-CTja-fCz.js";import{_ as W}from"./BlockBalanceAgreement-qtspRQ_B.js";import{G as X,u as Y,r as C,f as p,g as Z,H as ee,c,b as m,a as r,h,t as d,w as N,E as te,F as x,i as B,C as L,x as re,d as se,o as i,e as U}from"./index-CmCGXBst.js";import{u as oe}from"./services-C54cnl9l.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./bootstrap-vue-next-DwS3lKQb.js";import"./ServiceListOrderSelection-DUe6fwsE.js";import"./TotalAmount.vue_vue_type_script_setup_true_lang-CXrtmBc-.js";import"./BasicInput-KlObNzdO.js";import"./component-0WedTVCo.js";import"./BlockSelectContract-uyQ-oMQe.js";import"./contracts-P7YPBhEI.js";import"./multiselect-DhoC9bwZ.js";import"./IconClose-B_k4TzXM.js";const le={class:"tw-px-4 md:tw-px-8"},ne={key:0,class:"section-label"},ie={class:"tw-flex tw-items-center tw-gap-8 tw-border-b tw-border-gray-200 tw-mt-4 tw-whitespace-nowrap tw-mb-6"},ce={key:1,class:"section-body"},de={class:"ordered-services-list"},ue={class:"ordered-service-header"},ve={class:"ordered-service-name"},me={class:"ordered-service-status"},_e={class:"ordered-service-details"},pe={class:"ordered-service-info"},Se={key:0},fe={class:"ordered-service-actions"},De={class:"section-body tw-my-6"},we={key:2,class:"loading"},be={key:0,class:"tw-px-4 md:tw-px-8 tw-mb-6"},Ie={class:"total-block"},ye={class:"total-block__row"},he={class:"total-block__col"},ke={class:"total-block__col"},ge={class:"total-block__col"},Oe={class:"total-block__row total-block__row--big"},Ce={class:"total-block__col"},xe={__name:"VPSServices",setup(Ee){const F=Z(),S=se(),u=X(),b=oe(),I=Y(),f=re("emitter"),a=C([]),E=C(!0),y=C(!1),l=p(()=>u?.vpsList?Object.keys(u.vpsList).map(t=>u.vpsList[t]).find(t=>t&&String(t.OrderID)===String(F.params.id)):null),P=p(()=>!l.value?.SchemeID||!u?.vpsSchemes?null:u.vpsSchemes[l.value.SchemeID]),V=p(()=>!l.value||!P.value?null:{ServiceID:l.value.ServiceID,ServersGroupID:P.value.ServersGroupID}),D=p(()=>b?.ServicesList||{}),k=p(()=>{if(!l.value?.OrderID||!I?.userOrders)return[];const t=l.value.OrderID;return Object.keys(I.userOrders).map(n=>I.userOrders[n]).filter(n=>String(n?.DependOrderID)===String(t)&&n?.ServiceID&&D.value[n.ServiceID]).sort((n,_)=>Number(n?.ID)-Number(_?.ID))}),R=p(()=>{if(!a.value||!Array.isArray(a.value))return 0;let t=0;return a.value.forEach(e=>{e&&typeof e.Price=="number"&&(t+=e.Price)}),$(t)});function M(t){a.value=t||[]}function $(t){return t==null?"0.00":Number(t).toFixed(2)||"0.00"}async function T(){if(!(!a.value||!Array.isArray(a.value)||a.value.length===0))for(const t of a.value){if(!t)continue;let e="SUCCESS",o=D.value[t.ServiceID]?.Code;const v={Code:o,DependOrderID:l.value?.OrderID,...t,ContractID:l.value?.ContractID};try{const{result:n,info:_,error:g}=await b.ServiceOrder(v);if(n==="SUCCESS"){let w={};o==="Default"?w.ServiceOrderID=_?.ServiceOrderID:w[`${o}OrderID`]=_?.ServiceOrderID;const O=await b.ServiceOrderPay(o,w);let{result:s,error:A}=O;s==="SUCCESS"?(f.emit("open-modal",{component:"SuccessMessage",data:{message:"Дополнительные услуги успешно заказаны!"}}),a.value=[],S.push("/AdditionalServices")):s==="BASKET"&&S.push("/Basket")}else e="ERROR",f.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}catch(n){console.error("Ошибка при заказе услуги:",n),e="ERROR",f.emit("open-modal",{component:"ErrorMessage",data:{message:"Ошибка при заказе дополнительных услуг"}})}if(e==="ERROR")break}}async function j(){y.value=!0;try{await T()}catch(t){console.error("Ошибка при заказе услуг:",t),f.emit("open-modal",{component:"ErrorMessage",data:{message:"Произошла ошибка при заказе услуг"}})}finally{y.value=!1}}function G(t){const e=Object.values(D.value).find(v=>v.ID===t);if(!e){S.push(`/AdditionalServices/${t}`);return}const o=e.Code;o==="Default"||o==="DNSmanager"||o==="ISPsw"||o==="ExtraIP"?S.push(`/AdditionalServices/${t}`):S.push(`/${o}Orders/${t}`)}function H(t,e){let o="Orders";e==5e4?o="ExtraIPOrders":e==51e3?o="ISPswOrders":e==52e3&&(o="DNSmanagerOrders"),f.emit("open-modal",{component:"StatusHistory",data:{modeID:o,rowID:t}})}return ee(async()=>{try{await u.fetchVPS(),await u.fetchVPSSchemes(),await b.fetchServices(),await I.fetchUserOrders()}catch(t){console.error("Ошибка загрузки данных:",t)}finally{E.value=!1}}),(t,e)=>{const o=W,v=te("RouterLink"),n=Q,_=J,g=z,w=q,O=K;return i(),c(x,null,[m(o),r("div",le,[e[5]||(e[5]=r("h1",{class:"tw-text-xl sm:tw-text-4xl"},"Дополнительные услуги",-1)),l.value?(i(),c("div",ne,"VPS/VDS сервер #"+d(l.value?.OrderID),1)):h("",!0),r("div",ie,[m(v,{class:"tw-py-2 tw-cursor-pointer -tw-mb-[1px]","active-class":"tw-text-sky-400 tw-border-b-2 tw-border-sky-400",to:`/VPSOrders/${l.value?.OrderID}`},{default:N(()=>e[2]||(e[2]=[U(" Сервер ",-1)])),_:1,__:[2]},8,["to"]),m(v,{class:"tw-py-2 tw-cursor-pointer -tw-mb-[1px]","active-class":"tw-text-sky-400 tw-border-b-2 tw-border-sky-400",to:`/VPSServices/${l.value?.OrderID}`},{default:N(()=>e[3]||(e[3]=[U(" Услуги ",-1)])),_:1,__:[3]},8,["to"])]),m(n),k.value&&k.value.length>0?(i(),c("div",ce,[e[4]||(e[4]=r("h3",{class:"section-subtitle"},"Заказанные услуги",-1)),r("div",de,[(i(!0),c(x,null,B(k.value,s=>(i(),c("div",{class:"ordered-service-item",key:s.ID},[r("div",ue,[r("div",ve,d(D.value[s?.ServiceID]?.Name||s?.ServiceName||`Услуга #${s?.ServiceID}`),1),r("div",me,[m(_,{status:s?.StatusID,"status-table":"Orders",onClick:A=>H(s?.ID,s?.ServiceID),class:"tw-cursor-pointer"},null,8,["status","onClick"])])]),r("div",_e,[r("div",pe,[r("span",null,"Заказ # "+d(s?.ID),1),s?.DaysRemainded?(i(),c("span",Se," Осталось дней: "+d(s?.DaysRemainded),1)):h("",!0)])]),r("div",fe,[m(g,{class:"btn--sm",label:"Перейти к заказу",onClick:A=>G(s?.ID)},null,8,["onClick"])])]))),128))])])):h("",!0),r("div",De,[l.value&&V.value?(i(),L(w,{key:0,modelValue:a.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>a.value=s),M],"service-search-params":V.value},null,8,["modelValue","service-search-params"])):E.value?(i(),c("div",we,"Загрузка...")):(i(),L(O,{key:1,label:"Заказ не найден"}))])]),a.value&&a.value.length>0?(i(),c("div",be,[r("div",Ie,[r("div",ye,[e[6]||(e[6]=r("div",{class:"total-block__col"},"Дополнительные услуги",-1)),r("div",he,d(R.value)+" ₽",1)]),(i(!0),c(x,null,B(a.value,s=>(i(),c("div",{class:"total-block__row no-divider",key:s.ServiceID},[r("div",ke,d(D.value[s?.ServiceID]?.Name),1),r("div",ge,d($(s?.Price))+" ₽",1)]))),128)),r("div",Oe,[e[7]||(e[7]=r("div",{class:"total-block__col"},"Итого к оплате",-1)),r("div",Ce,d(R.value)+" ₽",1)])]),m(g,{class:"btn--wide",disabled:!a.value||a.value.length===0||y.value,"is-loading":y.value,label:"Заказать дополнительные услуги",onClick:e[1]||(e[1]=s=>j())},null,8,["disabled","is-loading"])])):h("",!0)],64)}}},Je=ae(xe,[["__scopeId","data-v-32ac0d2f"]]);export{Je as default};
