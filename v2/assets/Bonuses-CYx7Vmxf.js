import{_ as S}from"./EmptyStateBlock-D6U_EDq6.js";import{L as T,a as O}from"./bootstrap-vue-next-3DpAa4tb.js";import{_ as z}from"./ButtonDefault-CghIUDY0.js";import{al as H,r as i,am as D,an as x,c as y,o as g,a as n,b as f,I as G,S as J,d as h,H as L,C as P,F as B,h as I,w as _,t as b,E as A,f as k,s as Q,g as W,D as E,n as U,v as X}from"./index-CipWZKo_.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as M}from"./multiselect-DWCHRlfT.js";import{f as N,s as R}from"./time-DenPiOX5.js";import{_ as Y}from"./ClausesKeeper-DVJgfLR3.js";import{_ as $}from"./BlockBalanceAgreement-2iQbaweR.js";import{u as ee}from"./promoStore-Ce5toj5N.js";import"./IconClose-ChC2G6HM.js";import"./contracts-CILh9uSu.js";const w=H("bonuses",()=>{const l=i(null),t=i(null);async function c(r){await D.post(x.bonuses,r).then(a=>{a?.data&&(l.value=a.data)})}async function e(r){await D.post(x.promoCodes,r).then(a=>{a?.data&&(t.value=a.data)})}async function m(r){let a="ERROR",p=null;return await D.post(x.PromoCodesActivate,r).then(u=>{u?.data?.Status==="Ok"&&(a="SUCCESS")}),{result:a,error:p}}return{bonusesList:l,promosList:t,fetchBonuses:c,fetchPromos:e,PromoCodesActivate:m}}),te={props:{promoCode:{type:String,default:""}},emits:["update"],setup(l,{emit:t}){const c=w(),e=h(),m=i(!1),r=i("");function a(){r.value.length>0&&(m.value=!0,c.PromoCodesActivate({Code:r.value}).then(p=>{const{result:u}=p;u==="SUCCESS"&&t("update"),m.value=!1}))}return L(()=>{e.currentRoute.value.query.PromoCode?(r.value=e.currentRoute.value.query.PromoCode,a()):l.promoCode&&(r.value=l.promoCode)}),{isLoading:m,promoInput:r,activatePromo:a,router:e}}},oe={class:"promo-field"},se={class:"promo-field-input form-field"};function ne(l,t,c,e,m,r){const a=z;return g(),y("div",oe,[t[1]||(t[1]=n("div",{class:"promo-field-text"},"Промокод",-1)),n("div",se,[G(n("input",{type:"text",name:"promo-code","onUpdate:modelValue":t[0]||(t[0]=p=>e.promoInput=p)},null,512),[[J,e.promoInput]])]),f(a,{"is-loading":e.isLoading,label:"Применить",onClick:e.activatePromo},null,8,["is-loading","onClick"])])}const re=C(te,[["render",ne],["__scopeId","data-v-4e2d9b1e"]]),ae=[{key:"CreateDate",label:"Дата активации",variant:"td-gray",sortable:!0},{key:"ApplyTo",label:"Тариф/Группа",variant:"td-blue"},{key:"PromoCode",label:"Промокод"}],le={components:{Multiselect:M},props:{promoCode:{type:String,default:""}},setup(){const l=w(),t=i("CreateDate"),c=i(!0),e=i("desc"),m=i(1),r=i(10),a=i([10,25,50,100]),p=k(()=>Object.keys(l?.promosList)?.map(d=>l?.promosList[d])),u=k(()=>Object.keys(l?.promosList)?.length);function v(){m.value=1}function o(){l.fetchBonuses(),l.fetchPromos()}const s=d=>{d.key==="Enter"&&d.ctrlKey&&o()};return L(()=>{document.addEventListener("keyup",s)}),Q(()=>{document.removeEventListener("keyup",s)}),{promosTable:ae,sortBy:t,sortDesc:c,sortDirection:e,currentPage:m,perPage:r,pageOptions:a,setPageToZero:v,getPromos:p,getPromosLength:u,secondToDate:R,formNormalDate:N,updatePromos:o}}},ie={class:"promo-block block--wrapper"},ce={key:0,class:"table-controls"},me={class:"multiselect-multiple-label"},pe={class:"multiselect-option"};function ue(l,t,c,e,m,r){const a=re,p=T,u=O,v=A("Multiselect"),o=S;return g(),y(B,null,[n("div",ie,[t[6]||(t[6]=n("div",{class:"promo-text"},"Активировать промокод",-1)),f(a,{onUpdate:t[0]||(t[0]=s=>e.updatePromos()),promoCode:c.promoCode},null,8,["promoCode"])]),e.getPromos?(g(),y(B,{key:0},[f(p,{class:"basic-table",items:e.getPromos,fields:e.promosTable,"show-empty":!0,"per-page":e.perPage,"current-page":e.currentPage,"empty-text":"Промокодов пока нет.","empty-filtered-text":"Промокоды не найдены.","sort-desc":e.sortDesc,"onUpdate:sortDesc":t[1]||(t[1]=s=>e.sortDesc=s),"sort-by":e.sortBy,"onUpdate:sortBy":t[2]||(t[2]=s=>e.sortBy=s),"sort-direction":e.sortDirection},{"cell(CreateDate)":_(s=>[n("span",null,b(e.formNormalDate(e.secondToDate(s?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),e.getPromosLength>0?(g(),y("div",ce,[f(u,{modelValue:e.currentPage,"onUpdate:modelValue":t[3]||(t[3]=s=>e.currentPage=s),"total-rows":e.getPromosLength,"per-page":e.perPage,"first-number":"","last-number":""},{"first-text":_(()=>t[7]||(t[7]=[n("span",{class:"text-success"},"First",-1)])),"last-text":_(()=>t[8]||(t[8]=[n("span",{class:"text-info"},"Last",-1)])),page:_(({page:s,active:d})=>[n("span",null,b((s-1)*e.perPage+1)+"-"+b(s*e.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),f(v,{class:"multiselect--white",modelValue:e.perPage,"onUpdate:modelValue":t[4]||(t[4]=s=>e.perPage=s),options:e.pageOptions,label:"name",openDirection:"top",onInput:t[5]||(t[5]=s=>e.currentPage=1)},{singlelabel:_(({value:s})=>[n("div",me,[n("span",null,"Отображать "+b(s.value)+" строк",1)])]),option:_(({option:s})=>[n("div",pe,"Отображать "+b(s.name)+" строк",1)]),_:1},8,["modelValue","options"])])):I("",!0)],64)):(g(),P(o,{key:1,label:"Промокоды не найдены"}))],64)}const de=C(le,[["render",ue],["__scopeId","data-v-19ae75c0"]]),_e=[{key:"CreateDate",label:"Дата создания",variant:"td-gray",sortable:!0},{key:"ExpirationDate",label:"Дата окончания",variant:"td-gray",sortable:!0},{key:"Display",label:"Тариф/Группа",variant:"td-blue"},{key:"DaysRemainded",label:"Дней осталось",sortable:!0},{key:"Discont",variant:"td-controls",label:"Скидка"},{key:"Comment",label:"Комментарий",variant:"td-gray"}],ge={components:{Multiselect:M},setup(){const l=w(),t=i("CreateDate"),c=i(!0),e=i("desc"),m=i(1),r=i(10),a=i([10,25,50,100]),p=k(()=>Object.keys(l?.bonusesList)?.map(o=>l?.bonusesList[o])),u=k(()=>Object.keys(l?.bonusesList)?.length);function v(){m.value=1}return{bonusesTable:_e,sortBy:t,sortDesc:c,sortDirection:e,currentPage:m,perPage:r,pageOptions:a,setPageToZero:v,getBonuses:p,getBonusesLength:u,secondToDate:R,formNormalDate:N}}},be={key:0},fe={key:0,class:"table-controls"},ve={class:"multiselect-multiple-label"},ye={class:"multiselect-option"};function Pe(l,t,c,e,m,r){const a=T,p=O,u=A("Multiselect"),v=S;return e.getBonuses?(g(),y("div",be,[f(a,{class:"basic-table",items:e.getBonuses,fields:e.bonusesTable,"show-empty":!0,"per-page":e.perPage,"current-page":e.currentPage,"empty-text":"Бонусов пока нет.","empty-filtered-text":"Бонусов не найдены.","sort-desc":e.sortDesc,"onUpdate:sortDesc":t[0]||(t[0]=o=>e.sortDesc=o),"sort-by":e.sortBy,"onUpdate:sortBy":t[1]||(t[1]=o=>e.sortBy=o),"sort-direction":e.sortDirection},{"cell(CreateDate)":_(o=>[n("span",null,b(e.formNormalDate(e.secondToDate(o?.value))),1)]),"cell(ExpirationDate)":_(o=>[n("span",null,b(e.formNormalDate(e.secondToDate(o?.value))),1)]),_:1},8,["items","fields","per-page","current-page","sort-desc","sort-by","sort-direction"]),e.getBonusesLength>0?(g(),y("div",fe,[f(p,{modelValue:e.currentPage,"onUpdate:modelValue":t[2]||(t[2]=o=>e.currentPage=o),"total-rows":e.getBonusesLength,"per-page":e.perPage,"first-number":"","last-number":""},{"first-text":_(()=>t[5]||(t[5]=[n("span",{class:"text-success"},"First",-1)])),"last-text":_(()=>t[6]||(t[6]=[n("span",{class:"text-info"},"Last",-1)])),page:_(({page:o,active:s})=>[n("span",null,b((o-1)*e.perPage+1)+"-"+b(o*e.perPage),1)]),_:1},8,["modelValue","total-rows","per-page"]),f(u,{class:"multiselect--white",modelValue:e.perPage,"onUpdate:modelValue":t[3]||(t[3]=o=>e.perPage=o),options:e.pageOptions,label:"name",openDirection:"top",onInput:t[4]||(t[4]=o=>e.currentPage=1)},{singlelabel:_(({value:o})=>[n("div",ve,[n("span",null,"Отображать "+b(o.value)+" строк",1)])]),option:_(({option:o})=>[n("div",ye,"Отображать "+b(o.name)+" строк",1)]),_:1},8,["modelValue","options"])])):I("",!0)])):(g(),P(v,{key:1,label:"Бонусов не найдено"}))}const ke=C(ge,[["render",Pe]]),Ce={class:"tw-px-4 md:tw-px-8"},we={class:"tw-flex tw-flex-wrap tw-items-center tw-justify-between tw-gap-2 tw-mb-4"},De={class:"tw-mb-6"},xe={class:"tw-flex tw-items-center tw-border-b tw-border-gray-200 tw-mt-4 tw-whitespace-nowrap"},Be={__name:"Bonuses",async setup(l){let t,c;const e=w(),m=ee(),r=i("bonuses"),a=h(),p=W(),u=m.promoCode;function v(){a.go(0)}function o(s){a.replace(`/Bonuses?section=${s}`),r.value=s}return L(()=>{u&&e.PromoCodesActivate({Code:u}).then(s=>{const{result:d}=s;d==="SUCCESS"&&emit("update"),a.replace("/Bonuses?section=promos"),r.value="promos"}),p?.query?.section?r.value=p?.query?.section:a.replace("/Bonuses?section=bonuses")}),[t,c]=E(()=>e.fetchBonuses()),await t,c(),[t,c]=E(()=>e.fetchPromos()),await t,c(),(s,d)=>{const j=$,q=Y,F=ke,K=de,Z=S;return g(),y(B,null,[f(j),n("div",Ce,[n("div",we,[n("h1",{class:"tw-text-xl sm:tw-text-4xl tw-cursor-pointer",onClick:d[0]||(d[0]=V=>v())},"Бонусы и промокоды")]),f(q),n("div",De,[n("div",xe,[n("div",{class:U(["section-nav__item",{"section-link":!0,"section-link-active":r.value==="bonuses"}]),onClick:d[1]||(d[1]=V=>o("bonuses"))}," Бонусы ",2),n("div",{class:U(["section-nav__item",{"section-link":!0,"section-link-active":r.value==="promos"}]),onClick:d[2]||(d[2]=V=>o("promos"))}," Промокоды ",2)])]),r.value==="bonuses"?(g(),P(F,{key:0})):r.value==="promos"?(g(),P(K,{key:1,promoCode:X(u)},null,8,["promoCode"])):(g(),P(Z,{key:2,label:"Секция не найдена"}))])],64)}}},Re=C(Be,[["__scopeId","data-v-e27bb065"]]);export{Re as default};
