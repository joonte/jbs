import{_ as ie}from"./EmptyStateBlock-CV1Zaaf7.js";import{_ as re}from"./ButtonDefault-eJbeaBtE.js";import{_ as ce}from"./BlockOrderServiceWrapper-Las2JEDB.js";import{_ as ue}from"./BlockAdditionalServices-DPr--p0K.js";import{_ as de}from"./BasicInput-TTn3Hxre.js";import{m as me}from"./bootstrap-vue-next-CxxkTytZ.js";import{_ as _e}from"./DomainCheckBlock-CXkY5k_O.js";import{_ as ve}from"./BlockOrderPayBalance-CwLP8dIN.js";import{_ as pe}from"./BlockSelectContract-BJLjloC1.js";import{_ as Se}from"./ParamsAccordionBlock-cjEabFcr.js";import{_ as De}from"./BlockBalanceAgreement-DjWMZ940.js";import{O as fe,r as c,f as B,g as be,h as he,s as ke,E as x,c as S,b as i,a as o,F as E,t as n,w as R,I as W,J as X,i as ge,j as z,d as ye,o as D,e as Ie}from"./index-XtiBO-PZ.js";import{u as Ce}from"./hosting-B5Wk2kbD.js";import{u as Be}from"./contracts-BdlSA9YT.js";import{u as Oe}from"./services-izfy4zss.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ClausesKeeper-DEgaQ2N3.js";import"./IconClose-s_NQ_Q4c.js";import"./ServiceListOrderSelection-D6_D29T7.js";import"./multiselect-eqvbz1NV.js";import"./component-YfTGPdLe.js";import"./globalActions-Tf2FwXht.js";import"./IconHelp-C9M5tavY.js";const Ee={class:"hosting-sheme"},Ne={class:"section"},Pe={class:"container"},Ve={class:"section-header"},He={class:"section-title"},xe={class:"container"},Ue={class:"section"},$e={class:"container"},Ae={class:"total-block"},Fe={class:"total-block__row divider-bottom"},Re={class:"total-block__col"},Te={class:"total-block__col"},Le={class:"total-block__col"},Ke={class:"total-block__row"},je={class:"total-block__col"},Ge={class:"total-block__col"},Me={class:"total-block__col"},qe={class:"total-block__row total-block__row--big economy-line"},Je={class:"total-block__col flex-col"},We={class:"red"},Xe={class:"total-block__row total-block__row--big"},ze={class:"total-block__col"},Qe={class:"total-block__col"},Ye={key:1,class:"section"},Ze={class:"container"},eo={__name:"HostingSchemesId",async setup(oo){let v,p;const k=Ce(),T=Be(),N=fe(),P=Oe(),Q=be(),g=ye(),f=c(!1),U=c(""),O=c([]),$=c(!1),l=c(null),w=c([]),y=c(!1),u=c(null),V=c(null),L=c(""),K=t=>{t.key==="Enter"&&t.ctrlKey&&!Y.value&&q()},Y=B(()=>l.value===null||u.value===null),b=B(()=>k?.hostingSchemes?.[Q.params.id]),Z=B(()=>T?.contractsList),j=B(()=>P?.ServicesList),ee=B(()=>Object.keys(N?.domainSchemes)?.map(t=>({...N?.domainSchemes[t],value:N?.domainSchemes[t]?.ID}))),A=B(()=>{let t=0;return w.value.forEach(e=>{t+=e?.Price}),G(t)||0});he(()=>{document.addEventListener("keyup",K)}),ke(()=>{document.removeEventListener("keyup",K)});function F(){let t=0;return l.value?.discounts?.Bonuses.map(e=>{t+=+e.Economy}),t}function I(t){return Number(t).toFixed(2)||0}function G(t){return Number(t).toFixed(2)||0}function oe(t){O.value=t}function te(){f.value=!1,console.log("Not")}function se(){f.value=!0,console.log("Own")}function le(t){l.value=t}async function M(t){for(const e of w.value){let h="SUCCESS",d=j.value[e.ServiceID]?.Code;if(await P.ServiceOrder({Code:d,DependOrderID:t,...e,ContractID:u.value}).then(({result:a,info:r,error:H})=>{if(a==="SUCCESS"){let m={};d==="Default"?m.ServiceOrderID=r?.ServiceOrderID:m[`${d}OrderID`]=r?.ServiceOrderID,P.ServiceOrderPay(d,m,{XMLHttpRequest:"yes"}).then(_=>{let{result:C,error:J}=_;C==="SUCCESS"?g.push("/AdditionalServices}"):C==="BASKET"&&g.push("/Basket")})}else h="ERROR"}),h==="ERROR")break}}function q(){y.value=!0;let t=0,e,h,d;O.value.length>0&&(e=O.value[t],h=O.value.map(a=>`${a.line}${a.line&&a.Name?"."+a.Name:""}`),d=O.value.map(a=>`${a.ID}`)),f.value===!1?k.HostingOrder({ContractID:u.value,Domain:h||null,DomainName:e?.line||null,HostingSchemeID:b.value?.ID,DomainSchemeID:d||null,DomainTypeID:e?.line?e?.Name?"Order":"Nothing":"None"}).then(({result:a,info:r,error:H})=>{a==="SUCCESS"?(t++,M(r?.OrderID),k.HostingOrderPay({HostingOrderID:r?.HostingOrderID,DaysPayFromBallance:l.value?.daysFromBalance||0,DaysPay:l.value?.actualDays}).then(m=>{let{result:_,error:C}=m;_==="SUCCESS"?g.push("/HostingOrders"):_==="BASKET"&&g.push("/Basket"),y.value=!1})):y.value=!1}):(console.log(!0),k.HostingOrder({ContractID:u.value,Domain:U.value,DomainName:V.value?.line,HostingSchemeID:b.value?.ID,DomainSchemeID:V.value?.line&&V.value?.ID?V.value?.ID:null,DomainTypeID:"Nothing"}).then(({result:a,info:r,error:H})=>{a==="SUCCESS"?(M(r?.OrderID),k.HostingOrderPay({HostingOrderID:r?.HostingOrderID,DaysPayFromBallance:l.value?.daysFromBalance||0,DaysPay:l.value?.actualDays}).then(m=>{let{result:_,error:C}=m;_==="SUCCESS"?g.push("/HostingOrders"):_==="BASKET"&&g.push("/Basket"),y.value=!1})):y.value=!1}))}return[v,p]=x(()=>N.fetchDomainSchemes()),await v,p(),[v,p]=x(()=>k.fetchHostingSchemes()),await v,p(),[v,p]=x(()=>T.fetchContracts()),await v,p(),[v,p]=x(()=>P.fetchServices()),await v,p(),(t,e)=>{const h=De,d=Se,a=pe,r=ve,H=_e,m=me,_=de,C=ue,J=ce,ae=re,ne=ie;return D(),S(E,null,[i(h),o("div",Ee,[b.value?.ID?(D(),S(E,{key:0},[o("div",Ne,[o("div",Pe,[o("div",Ve,[o("h1",He,n(b.value?.Name),1),e[9]||(e[9]=o("div",{class:"section-label"},"Хостинг",-1))])])]),i(J,{basic_title:"Хостинг",modelValue:L.value,"onUpdate:modelValue":e[7]||(e[7]=s=>L.value=s)},{page:R(()=>[i(d,{"params-list":b.value?.SchemeParams,label:"Общая информация","main-param":"InternalName"},null,8,["params-list"]),i(a,{title:"Договор",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),class:"tw-mt-6"},null,8,["modelValue"]),i(r,{contractID:u.value,scheme:b.value,serviceID:"10000",isOrderID:!1,onSelect:le,isBalancePay:$.value,"onUpdate:isBalancePay":e[1]||(e[1]=s=>$.value=s)},null,8,["contractID","scheme","isBalancePay"]),i(H,{disabled:f.value,"domain-list":ee.value,onClick:e[2]||(e[2]=s=>te()),onSelect:oe},null,8,["disabled","domain-list"]),o("div",xe,[i(m,{id:"check-1",modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=s=>f.value=s),name:"checkbox-1"},{default:R(()=>e[10]||(e[10]=[Ie(" Использовать свой домен ",-1)])),_:1,__:[10]},8,["modelValue"]),i(_,{label:"Домен",name:"own-domain",onClick:e[4]||(e[4]=s=>se()),disabled:!f.value,modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=s=>U.value=s)},null,8,["disabled","modelValue"])])]),services:R(()=>[i(C,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=s=>w.value=s),serviceSearchParams:{ServiceID:"10000",ServersGroupID:b.value?.ServersGroupID}},null,8,["modelValue","serviceSearchParams"])]),_:1},8,["modelValue"]),o("div",Ue,[o("div",$e,[W(o("div",Ae,[l.value?.discounts?.Bonuses?.length>0?(D(),S(E,{key:0},[o("div",Fe,[e[11]||(e[11]=o("div",{class:"total-block__col"},"Цена тарифа",-1)),o("div",Re,n(I(l.value?.price))+" ₽",1)]),(D(!0),S(E,null,z(l.value?.discounts?.Bonuses,s=>(D(),S("div",{class:"total-block__row no-divider",key:s?.Days},[o("div",Te,"Скидка "+n(s?.Discount)+"% на "+n(s?.Days)+" дней",1),o("div",Le,"-"+n(I(s?.Economy))+" ₽",1)]))),128))],64)):ge("",!0),o("div",Ke,[e[12]||(e[12]=o("div",{class:"total-block__col"},"Дополнительные услуги",-1)),o("div",je,n(A.value)+" ₽",1)]),(D(!0),S(E,null,z(w.value,s=>(D(),S("div",{class:"total-block__row no-divider",key:s?.ServiceID},[o("div",Ge,n(j.value[s?.ServiceID]?.Name),1),o("div",Me,n(G(s?.Price))+" ₽",1)]))),128)),W(o("div",qe,[e[13]||(e[13]=o("div",{class:"total-block__col red"},"Выгода",-1)),o("div",Je,[o("span",null,[o("s",null,n(I(l.value?.price))+" ₽",1)]),o("span",We,"-"+n(I(F()))+" ₽",1)])],512),[[X,l.value?.discounts?.Bonuses?.length>0]]),o("div",Xe,[o("div",ze,"Итого за "+n(l.value?.label),1),o("div",Qe,n(I(l.value?.price-F()+ +A.value))+" ₽ ",1)])],512),[[X,l.value?.price]]),i(ae,{class:"btn--wide",label:$.value||Z.value[u.value]?.Balance>I(l.value?.price-F()+ +A.value)?"Оплатить c баланса договора":"Добавить в корзину",disabled:l.value===null||u.value===null,"is-loading":y.value,onClick:e[8]||(e[8]=s=>q())},null,8,["label","disabled","is-loading"])])])],64)):(D(),S("div",Ye,[o("div",Ze,[i(ne,{label:"Тариф не найден"})])]))])],64)}}},Bo=we(eo,[["__scopeId","data-v-1cbd75aa"]]);export{Bo as default};
