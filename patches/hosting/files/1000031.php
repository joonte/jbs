<?php                   
                        
#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$Tmp = System_Element('tmp');
if(Is_Error($Tmp))
	return ERROR | @Trigger_Error('[files/1000031.php]: не удалось найти временную папку');
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
// импортируем сбербанк
$SberBankFileDB = SPrintF('%s/SberBank.txt',$Tmp);
#-------------------------------------------------------------------------------
if(File_Exists($SberBankFileDB)){
	#-------------------------------------------------------------------------------
	$IsRead = IO_Read($SberBankFileDB);
	if(Is_Error($IsRead))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Lines = Explode("\n", Trim($IsRead));
	#-------------------------------------------------------------------------------
	foreach($Lines as $Line){
		#-------------------------------------------------------------------------------
		List($InvoiceID, $URL) = Preg_Split("/[\s]+/",$Line);
		#-------------------------------------------------------------------------------
		$ClauseID = DB_Insert('TmpData',Array('AppID'=>'SberBank','Col1'=>$InvoiceID,'Col4'=>$URL));
		if(Is_Error($ClauseID))
			return ERROR | @Trigger_Error(500);
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	if(!UnLink($SberBankFileDB))
		return new gException('CANNOT_DELETE_FILE',SPrintF('Не удалось удалить файл: %s',$SberBankFileDB));
	#-------------------------------------------------------------------------------
}

#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------


