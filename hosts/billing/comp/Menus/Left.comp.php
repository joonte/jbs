<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('MenuPath');
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
if(!$MenuPath)
  return FALSE;
#-------------------------------------------------------------------------------
$XML = Styles_Menu($MenuPath);
if(Is_Error($XML))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$Table = new Tag('TABLE',Array('border'=>0,'cellspacing'=>0,'cellpadding'=>0,'width'=>'100%'));
#-------------------------------------------------------------------------------
$Items = $XML['Items'];
#-------------------------------------------------------------------------------
if(!Count($Items))
  return FALSE;
#-------------------------------------------------------------------------------
foreach(Array_Keys($Items) as $ItemID){
  #-----------------------------------------------------------------------------
  $Item = $Items[$ItemID];
  #-----------------------------------------------------------------------------
  $Tr = new Tag('TR');
  #-----------------------------------------------------------------------------
  $Prefix = ($Item['IsActive']?'Active':'UnActive');
  #-----------------------------------------------------------------------------
  $IsPick = (!$Item['IsActive'] && IsSet($Item['Pick']));
#-------------------------------------------------------------------------------
$Parse = <<<EOD
<TABLE border="0" width="100%%" height="100%%" cellspacing="0" cellpadding="0">
  <TR>
   <TD height="5" width="10" style="background-image:url(SRC:{Images/MenuLeftLeft%s.png});" />
   <TD rowspan="2" id="MenuLeftCenter" style="padding-top:5px;padding-bottom:5px;background-image:url(SRC:{Images/MenuLeftCenter%s.png});" />
  </TR>
  <TR>
   <TD height="5" style="background-image:url(SRC:{Images/MenuLeftLeft%s.png});background-position:left bottom;" />
  </TR>
</TABLE>
EOD;
#-------------------------------------------------------------------------------
  $LeftPrefix = ($IsPick?SPrintF('%sPick',$Prefix):$Prefix);
  #-----------------------------------------------------------------------------
  $DOM = new DOM(SPrintF($Parse,$LeftPrefix,$Prefix,$LeftPrefix));
  #-----------------------------------------------------------------------------
  $Text = $Item['Text'];
  #-----------------------------------------------------------------------------
  $A = new Tag('A',Array('class'=>'MenuLeft','href'=>$Item['Href']),$Text);
  #-----------------------------------------------------------------------------
  if(IsSet($Item['Prompt'])){
    #---------------------------------------------------------------------------
    $LinkID = UniqID('ID');
    #---------------------------------------------------------------------------
    $Links = &Links();
    #---------------------------------------------------------------------------
    $Links[$LinkID] = &$A;
    #---------------------------------------------------------------------------
    $Comp = Comp_Load('Form/Prompt',$LinkID,$Item['Prompt']);
    if(Is_Error($Comp))
      return ERROR | @Trigger_Error(500);
    #---------------------------------------------------------------------------
    UnSet($Links[$LinkID]);
  }
  #-----------------------------------------------------------------------------
  if(IsSet($Item['Attribs']))
    Array_Union($A->Attribs,$Item['Attribs']);
  #-----------------------------------------------------------------------------
  $Inner = ($Item['Href']?$A:new Tag('SPAN',Array('class'=>'MenuLeft'),$Text));
  #-----------------------------------------------------------------------------
  $DOM->AddChild('MenuLeftCenter',$Inner);
  #-----------------------------------------------------------------------------
  $Level = $Item['Level'];
  #-----------------------------------------------------------------------------
  $Adding = new Tag('TR');
  #-----------------------------------------------------------------------------
  if($Level > 1){
    #---------------------------------------------------------------------------
    for($i=1;$i<$Level;$i++)
     $Adding->AddChild(new Tag('TD',Array('width'=>10)));
  }
  #-----------------------------------------------------------------------------
  $Adding->AddChild(new Tag('TD',$DOM->Object));
  #-----------------------------------------------------------------------------
  $Tr->AddChild(new Tag('TD',new Tag('TABLE',Array('border'=>0,'height'=>'100%','width'=>'100%','cellspacing'=>0,'cellpadding'=>0),$Adding)));
  #-----------------------------------------------------------------------------
  $Table->AddChild($Tr);
}
#-------------------------------------------------------------------------------
$Table = new Tag('TABLE',Array('class'=>'MenuLeft','cellspacing'=>0,'cellpadding'=>0,'width'=>'100%'),new Tag('TR',new Tag('TD',$Table),new Tag('TD',Array('width'=>2,'style'=>'background-image:url(SRC:{Images/MenuLeftLine.png});')))); 
#-------------------------------------------------------------------------------
return new Tag('TD',Array('align'=>'right','valign'=>'top','width'=>180),$Table);
#-------------------------------------------------------------------------------


?>
