<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Args');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = IsSet($Args)?$Args:Args();
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Out = Array();
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Config = Config();
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$ConfigNames = Array();
#-------------------------------------------------------------------------------
$HostsIDs = $GLOBALS['HOST_CONF']['HostsIDs'];
#-------------------------------------------------------------------------------
foreach(Array_Reverse($HostsIDs) as $HostID){
	#-------------------------------------------------------------------------------
	$Path = SPrintF('%s/hosts/%s/config/Config.ini',SYSTEM_PATH,$HostID);
	#-------------------------------------------------------------------------------
	if(File_Exists($Path)){
		#-------------------------------------------------------------------------------
		$Adding = Parse_Ini_File($Path);
		if(!$Adding)
			return ERROR | Trigger_Error(500);
		#-------------------------------------------------------------------------------
		Array_Union($ConfigNames,$Adding);
		#-------------------------------------------------------------------------------
	}       
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
// варианты внешней авторизации
$OAuth = $Config['Interface']['User']['OAuth'];
#-------------------------------------------------------------------------------
foreach(Array_Keys($OAuth) as $Key){
	#-------------------------------------------------------------------------------
	if(!$OAuth[$Key]['IsActive'])
		continue;
	#-------------------------------------------------------------------------------
	// могут жеж включить и настроек не внести
	if(!$OAuth[$Key]['ClientID'] || !$OAuth[$Key]['ClientSecret'])
		continue;
	#-------------------------------------------------------------------------------
	$Out[$Key] = Array();
	#-------------------------------------------------------------------------------
	// подсказка
	$Out[$Key]['Prompt'] = $OAuth[$Key]['Prompt'];
	#-------------------------------------------------------------------------------
	// Имя
	if(IsSet($ConfigNames[$Key]))
		$Out[$Key]['Name'] = $ConfigNames[$Key];
	#-------------------------------------------------------------------------------
	$RedirectURI = SPrintF('%s://%s/OAuth/%s',URL_SCHEME,HOST_ID,$Key);
	#-------------------------------------------------------------------------------
	$Out[$Key]['OauthURL'] = SPrintF($OAuth[$Key]['OauthURL'],$OAuth[$Key]['ClientID'],$RedirectURI);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Out;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
?>
