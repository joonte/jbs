<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
if(Is_Error(System_Load('modules/Authorisation.mod','classes/Session.class.php')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Session = new Session((string)@$_COOKIE['SessionID']);
#-------------------------------------------------------------------------------
if(Is_Error($Session->Delete()))
	return ERROR | @Trigger_Error(400);
#-------------------------------------------------------------------------------
if(!SetCookie('SessionID','closed',Time(),'/',SPrintF('.%s',HOST_ID)))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Event = Array('UserID'=>$GLOBALS['__USER']['ID'],'Text'=>'Пользователь вышел из системы');
#-------------------------------------------------------------------------------
$Event = Comp_Load('Events/EventInsert',$Event);
if(!$Event)
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
CacheManager::add(Md5(SPrintF('LastLogon_%s',$GLOBALS['__USER']['Email'])),FALSE,1);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return Array('Status'=>'Ok');
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
