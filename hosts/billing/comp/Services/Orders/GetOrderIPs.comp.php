<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('OrderTypeCode','ID');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Out = Array();
#-------------------------------------------------------------------------------
// если код не подходит - возвращаем пустой массив
if(!In_Array($OrderTypeCode,Array('VPS','DS','ExtraIP','ISPsw')))
	return $Out;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
// колонки с IP адресами
//VPS,DS,ISPsw = IP
//DS = ExtraIP
//ExtraIP = Login

// общее
$Columns = Array('IP');
#-------------------------------------------------------------------------------
// перезадаём для ExtraIP
if($OrderTypeCode == 'ExtraIP')
	$Columns = Array('`Login` AS `IP`');
#-------------------------------------------------------------------------------
// добавляем для DS
if($OrderTypeCode == 'DS')
	$Columns[] = 'ExtraIP';
#-------------------------------------------------------------------------------
// достаём адреса
$IPs = DB_Select(SPrintF('%sOrdersOwners',$OrderTypeCode),$Columns,Array('UNIQ','Where'=>SPrintF('`OrderID` = %u',$ID)));
switch(ValueOf($IPs)){
case 'error':
	return ERROR | @Trigger_Error(500);
case 'exception':
	return ERROR | @Trigger_Error(400);
case 'array':
	break;
default:
	return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
// сразу закидываем в выхлоп один адрес
$Out[] = $IPs['IP'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
// если есть ExtraIP - перебираем и добавляем его
if(IsSet($IPs['ExtraIP']) && $IPs['ExtraIP']){
	#-------------------------------------------------------------------------------
	foreach(Explode("\n",$IPs['ExtraIP']) as $Line)
		if(!In_Array(Trim($Line),$Out))
			$Out[] = Trim($Line);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
//foreach($Parked as $Domain)
//	$Out[] = SPrintF('<a href="https://%s/" target="_blank">%s</a>',$Domain,$Domain);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Out;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
