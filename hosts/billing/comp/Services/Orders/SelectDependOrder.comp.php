<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('UserID','OrderID','DependOrderID','IsShow');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
// выхлоп
$Options = Array('0'=>'Не задано');
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Config = Config();
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
// выбираем все услуги юзера
$Orders = DB_Select('OrdersOwners',Array('*','(SELECT `NameShort` FROM `Services` WHERE `ID` = `OrdersOwners`.`ServiceID`) AS `NameShort`','(SELECT `Code` FROM `Services` WHERE `ID` = `OrdersOwners`.`ServiceID`) AS `Code`'),Array('Where'=>Array(SPrintF('`UserID` = %u',$UserID),SPrintF('`ID` != %u',$OrderID)),'SortOn'=>'ServiceID'));
#-------------------------------------------------------------------------------
switch(ValueOf($Orders)){
case 'error':
	return ERROR | @Trigger_Error(500);
case 'exception':
	#-------------------------------------------------------------------------------
	$Orders = Array();
	#-------------------------------------------------------------------------------
	break;
	#-------------------------------------------------------------------------------
case 'array':
	break;
default:
	return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
foreach($Orders as $Order){
	#-------------------------------------------------------------------------------
	// код для выборки статуса
	$ModeID = SPrintF('%sOrders',($Order['Code'] == 'Default')?'':$Order['Code']);
	#-------------------------------------------------------------------------------
	$Statuses = $Config['Statuses'][$ModeID];
	#-------------------------------------------------------------------------------
	$Options[$Order['ID']] = SPrintF('%s / %s / %s',$Order['NameShort'],$Order['ID'],$Statuses[$Order['StatusID']]['Name']);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
// если это для отображения, то возвращаем только строку с описанием услуги
if($IsShow){
	#-------------------------------------------------------------------------------
	if(IsSet($Options[$DependOrderID])){
		#-------------------------------------------------------------------------------
		// заказ есть в массиве опций
		return $Options[$DependOrderID];
		#-------------------------------------------------------------------------------
	}else{
		#-------------------------------------------------------------------------------
		return $DependOrderID;
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
}else{
	$Comp = Comp_Load('Form/Select',Array('prompt'=>'Выберите заказ к которому относится услуга','name'=>'DependOrderID','style'=>'width: 100%;'),$Options,$DependOrderID);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Comp;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
