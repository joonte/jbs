<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('OrderTypeCode','ID','IsText');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
#-------------------------------------------------------------------------------
if($OrderTypeCode == 'Default'){
	#-------------------------------------------------------------------------------
	$Order = DB_Select('OrdersOwners',Array('ID','(SELECT `Item` FROM `Services` WHERE `OrdersOwners`.`ServiceID`=`Services`.`ID`) AS `SchemeName`'),Array('UNIQ','ID'=>$ID));
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$Columns = Array('ID',SPrintF('(SELECT `Name` FROM `%sSchemes` WHERE `%sOrdersOwners`.`SchemeID` = `%sSchemes`.`ID`) as `SchemeName`',$OrderTypeCode,$OrderTypeCode,$OrderTypeCode));
	#-------------------------------------------------------------------------------
	$Order = DB_Select(SPrintF('%sOrdersOwners',$OrderTypeCode),$Columns,Array('UNIQ','Where'=>SPrintF('`OrderID` = %u',$ID)));
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
switch(ValueOf($Order)){
case 'error':
	return ERROR | @Trigger_Error(500);
case 'exception':
	return ERROR | @Trigger_Error(400);
case 'array':
	break;
default:
	return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
// если тариф не меняется - просто выводим, без ссылки
if(!In_Array($OrderTypeCode,Array('DNSmanager','VPS','ISPsw','Hosting')))
	$OrderTypeCode = FALSE;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(!$IsText){
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load('Formats/SchemeName',$Order['SchemeName'],$OrderTypeCode,$Order['ID']);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	// если не задан код услуги или номер заказа - возвращаем имя тарифа
#	if(!$Code || !$OrderID){
		#-------------------------------------------------------------------------------
		$Comp = $Order['SchemeName'];
		#-------------------------------------------------------------------------------
#	}else{
		#-------------------------------------------------------------------------------
		#-------------------------------------------------------------------------------
#	}
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Comp;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
