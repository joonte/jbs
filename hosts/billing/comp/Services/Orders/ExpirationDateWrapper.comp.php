<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Code','ServiceID','ID');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
if($Code == 'Default'){
	#-------------------------------------------------------------------------------
	$Table = "OrdersOwners";
	#-------------------------------------------------------------------------------
	$Where = SPrintF('`ID` = %u',$ID);
	#-------------------------------------------------------------------------------
	$CompName = "Formats/Order/ExpirationDate";
	#-------------------------------------------------------------------------------
	$ColumnName = 'ExpirationDate';
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$Table = SPrintF('%sOrdersOwners',$Code);
	#-------------------------------------------------------------------------------
	$Where = SPrintF('`OrderID` = %u',$ID);
	#-------------------------------------------------------------------------------
	if($Code == 'Domain'){
		#-------------------------------------------------------------------------------
		$CompName = SPrintF('Formats/%sOrder/ExpirationDate',$Code);
		#-------------------------------------------------------------------------------
	}else{
		#-------------------------------------------------------------------------------
		$CompName = SPrintF('Formats/ExpirationDate');
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	$ColumnName = 'DaysRemainded';
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
if($Code == 'Domain')
	$ColumnName = 'ExpirationDate';
#-------------------------------------------------------------------------------
$Order = DB_Select($Table,Array($ColumnName),Array('UNIQ','Where'=>$Where));
#-------------------------------------------------------------------------------
switch(ValueOf($Order)){
case 'error':
	return ERROR | @Trigger_Error(500);
case 'exception':
	return ERROR | @Trigger_Error(400);
case 'array':
	break;
default:
	return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if($Code == 'Domain'){
	#-------------------------------------------------------------------------------
	$OnClick = ($GLOBALS['__USER']['InterfaceID'] == 'User')?SPrintF('ShowWindow("/DomainOrderPay",{OrderID:"%u"});',$ID):SPrintF('ShowWindow("/DomainOrderInfo",{OrderID:%u});',$ID);
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load($CompName,$Order[$ColumnName],0,$OnClick);
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$OnClick = ($GLOBALS['__USER']['InterfaceID'] == 'User')?SPrintF('ShowWindow("/%sOrderPay",{OrderID:%u});',$Code,$ID):SPrintF('ShowWindow("/OrderConsiderInfo",{OrderID:"%u",ServiceID:"%u"});',$ID,$ServiceID);
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load($CompName,$Order[$ColumnName],$OnClick);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Comp;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
