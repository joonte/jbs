<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('IsSearch');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Config = Config();
#-------------------------------------------------------------------------------
$Statuses = $Config['Statuses']['Invoices'];
#-------------------------------------------------------------------------------
$Filters = Array('Статусы счетов');
#-------------------------------------------------------------------------------
foreach($Statuses as $StatusID=>$Status){
	#-------------------------------------------------------------------------------
	$Filters[$StatusID] = Array('Name'=>$Status['Name'],'UsersIDs'=>Array());
	#-------------------------------------------------------------------------------
	if($IsSearch){
		#-------------------------------------------------------------------------------
		$Invoices = DB_Select('InvoicesOwners','UserID',Array('Where'=>SPrintF("`StatusID` = '%s'",$StatusID)));
		#-------------------------------------------------------------------------------
		switch(ValueOf($Invoices)){
		case 'error':
			return ERROR | @Trigger_Error(500);
		case 'exception':
			# No more...
			break;
		case 'array':
			#-------------------------------------------------------------------------------
			$UsersIDs = Array();
			#-------------------------------------------------------------------------------
			foreach($Invoices as $Invoice)
				$UsersIDs[] = $Invoice['UserID'];
			#-------------------------------------------------------------------------------
			$UsersIDs = Array_Unique($UsersIDs);
			#-------------------------------------------------------------------------------
			$Filters[$StatusID]['UsersIDs'] = $UsersIDs;
			#-------------------------------------------------------------------------------
			break;
			#-------------------------------------------------------------------------------
		default:
			return ERROR | @Trigger_Error(101);
		}
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Filters;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
