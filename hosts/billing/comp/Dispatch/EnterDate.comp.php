<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('IsSearch');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Periods = Array(
		7	=> 'Неделю назад',
		30	=> 'Месяц назад',
		182	=> 'Полгода назад',
		365	=> 'Один год назад',
		730	=> 'Два года назад',
		1095	=> 'Три года назад'
		);
#-------------------------------------------------------------------------------
$Filters = Array('Входившие НЕ более чем');
#-------------------------------------------------------------------------------
foreach(Array_Keys($Periods) as $Key){
	#-------------------------------------------------------------------------------
	$Users = DB_Select('Users',Array('ID'),Array('Where'=>SPrintF('`EnterDate` > %u',(Time() - $Key * 24 * 60 * 60))));
	#-------------------------------------------------------------------------------
	switch(ValueOf($Users)){
	case 'error':
		return ERROR | @Trigger_Error(500);
	case 'exception':
		continue 2;
	case 'array':
		break;
	default:
		return ERROR | @Trigger_Error(101);
	}
	#-------------------------------------------------------------------------------
	$Filter = Array('Name'=>$Periods[$Key],'UsersIDs'=>Array());
	#-------------------------------------------------------------------------------
	if($IsSearch){
			#-------------------------------------------------------------------------------
			$UsersIDs = Array();
			#-------------------------------------------------------------------------------
			foreach($Users as $User)
				$UsersIDs[] = $User['ID'];
			#-------------------------------------------------------------------------------
			$Filter['UsersIDs'] = $UsersIDs;
			#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	$Filters[$Key] = $Filter;
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Filters;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
