<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('IsSearch');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Periods = Array(
		183	=> 'Полгода назад',
		364	=> 'Один год назад',
		729	=> 'Два года назад',
		1094	=> 'Три года назад',
		1460	=> 'Четыре года назад',
		1825	=> 'Пять лет назад'
		);
#-------------------------------------------------------------------------------
$Filters = Array('Входившие БОЛЕЕ чем');
#-------------------------------------------------------------------------------
foreach(Array_Keys($Periods) as $Key){
	#-------------------------------------------------------------------------------
	Debug(SPrintF('[comp/Dispatch/NotEnterDate]: начало, выборка по ключу: %s',$Key));
	#-------------------------------------------------------------------------------
	$Where = Array(
			SPrintF('`EnterDate` < %u',(Time() - $Key * 24 * 60 * 60)),
			'`EnterIP` NOT IN ("-")','`EnterDate` > 10'
			);
	#-------------------------------------------------------------------------------
	$Users = DB_Select('Users',Array('ID'),Array('Where'=>SPrintF('`EnterDate` < %u',(Time() - $Key * 24 * 60 * 60))));
	#-------------------------------------------------------------------------------
	switch(ValueOf($Users)){
	case 'error':
		return ERROR | @Trigger_Error(500);
	case 'exception':
		continue 2;
	case 'array':
		break;
	default:
		return ERROR | @Trigger_Error(101);
	}
	#-------------------------------------------------------------------------------
	$Filter = Array('Name'=>$Periods[$Key],'UsersIDs'=>Array());
	#-------------------------------------------------------------------------------
	if($IsSearch){
			#-------------------------------------------------------------------------------
			$UsersIDs = Array();
			#-------------------------------------------------------------------------------
			foreach($Users as $User)
				$UsersIDs[] = $User['ID'];
			#-------------------------------------------------------------------------------
			$Filter['UsersIDs'] = $UsersIDs;
			#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	$Filters[$Key] = $Filter;
	#-------------------------------------------------------------------------------
	Debug(SPrintF('[comp/Dispatch/NotEnterDate]: конец, выборки по ключу: %s',$Key));
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $Filters;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
