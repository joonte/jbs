<?php

#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Array = Array(
		300	=> '5 минут',
		900	=> '15 минут',
		3600	=> 'час',
		86400	=> 'сутки',
		604800	=> 'неделя',
/*		2592000	=> 'месяц',
		31449600=> 'год',*/
		);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Table  = Array('Сейчас в биллинге, клиентов');
#-------------------------------------------------------------------------------
foreach(Array_Keys($Array) as $Key){
	#-------------------------------------------------------------------------------
	$OnLine = DB_Select('RequestLog',Array('COUNT(DISTINCT(`UserID`)) AS `Count`'),Array('UNIQ','Where'=>Array('UserID NOT IN (SELECT `ID` FROM `Users` WHERE `GroupID` != 2000000)',SPrintF('`CreateDate` > UNIX_TIMESTAMP() - %u',$Key))));
	#-------------------------------------------------------------------------------
	if(Is_Error($OnLine))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	$Table[]= Array($Array[$Key],(integer)$OnLine['Count']);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(!IsSet($Table))
	return FALSE;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Tables/Standard',$Table);
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return Array('Title'=>'Пользователей OnLine','DOM'=>$Comp);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
