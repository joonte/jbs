<?php
#-------------------------------------------------------------------------------
/** @author Бреславский А.В. (Joonte Ltd.) */
#-------------------------------------------------------------------------------
function Wizard_ToString($Amount,$Base = 'RUR'){
  /****************************************************************************/
  $__args_types = Array('double','string','string');
  #-----------------------------------------------------------------------------
  $__args__ = Func_Get_Args(); Eval(FUNCTION_INIT);
  /****************************************************************************/
  $Base = System_XML(SPrintF('config/%s.xml',$Base));
  if(Is_Error($Base))
    return ERROR | @Trigger_Error('[Wizard_ToString]: не удалось загрузить шаблоны');
  #-----------------------------------------------------------------------------
  $Discharges = $Base['Discharges'];
  #-----------------------------------------------------------------------------
  $Result = Array();
  #-----------------------------------------------------------------------------
  $j = 0;
  #-----------------------------------------------------------------------------
  $Integer = (integer)$Amount;
  #-----------------------------------------------------------------------------
  while($Integer > 0){
    #---------------------------------------------------------------------------
    $Section = Array();
    #---------------------------------------------------------------------------
    $Discharge = $Discharges[SPrintF('ID%u',$j++)];
    #---------------------------------------------------------------------------
    $Integer = ($Integer/$Base['Separate']);
    #---------------------------------------------------------------------------
    $String = SPrintF(SPrintF('%%0%uu',StrLen($Base['Separate'])-1),(string)Round(($Integer - (integer)$Integer)*1000));

    #---------------------------------------------------------------------------
    $Char0 = $String{0};
    $Char1 = $String{1};
    $Char2 = $String{2};
    #---------------------------------------------------------------------------
    $Digit = $Char0;
    #---------------------------------------------------------------------------
    if($Digit)
      $Section[] = $Discharge[SPrintF('ID%u',$Digit)]['ID2'];
    #---------------------------------------------------------------------------
    $Digit = SPrintF('%s%s',$Char1,$Char2);
    #---------------------------------------------------------------------------
    $IsSimple = (($Digit < 20) && ($Digit > 10));
    #---------------------------------------------------------------------------
    $Digit = $Char1;
    #---------------------------------------------------------------------------
    if($Digit)
      $Section[] = $Discharge[$IsSimple?SPrintF('ID%u',$Char2):SPrintF('ID%u',$Digit)][$IsSimple?'ID3':'ID1'];
    #---------------------------------------------------------------------------
    if(!$IsSimple){
      #-------------------------------------------------------------------------
      $Digit = $Char2;
      #-------------------------------------------------------------------------
      if($Digit)
        $Section[] = $Discharge[SPrintF('ID%s',$Digit)]['ID0'];
    }
    #---------------------------------------------------------------------------
    $Section[] = $Discharge[SPrintF('ID%u',$String{2})][SPrintF('ID%u',9 - ($IsSimple?-1:2))];
    #---------------------------------------------------------------------------
    Array_UnShift($Result,Implode(' ',$Section));
    #---------------------------------------------------------------------------
    $Integer = (integer)$Integer;
  };
  #-----------------------------------------------------------------------------
  return SPrintF('%s %02u %s',Implode(' ',$Result),Round(($Amount - (integer)$Amount)*100),$Base['Residue']);
}
#-------------------------------------------------------------------------------
?>