<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Value','Length','Url','IsHtmlEncode');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
#Debug(SPrintF('[comp/Formats/String]: Value = %s; Length = %s; Url = %s',$Value,$Length,$Url));
#-------------------------------------------------------------------------------
if($IsHtmlEncode)
	$Value = HtmlSpecialChars($Value,ENT_COMPAT);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(Is_Null($Url)){
	$Action = 'href';
}else{
	$Action = (Preg_Match('#^JavaScript.*#i',$Url)?'OnClick':'href');
}
#-------------------------------------------------------------------------------
#Debug(SPrintF('[comp/Formats/String]: Action = %s',$Action));
#-------------------------------------------------------------------------------
if(Mb_StrLen($Value) > $Length){
	#-------------------------------------------------------------------------------
	# затычка, если передаётся явно строка NULL - то это значение NULL
	if($Url == 'NULL')
		$Url = NULL;
	#-------------------------------------------------------------------------------
	$Text = Mb_SubStr($Value,0,$Length);
	#-------------------------------------------------------------------------------
	$Result = (Is_Null($Url)?new Tag('SPAN',SPrintF('%s...',$Text)):new Tag('A',Array($Action=>$Url,'target'=>'blank'),SPrintF('%s...',$Text)));
	#-------------------------------------------------------------------------------
	$LinkID = UniqID('String');
	#-------------------------------------------------------------------------------
	$Links = &Links();
	#-------------------------------------------------------------------------------
	$Links[$LinkID] = &$Result;
	#-------------------------------------------------------------------------------
	$Comp = Comp_Load('Form/Prompt',$LinkID,$Value);
	if(Is_Error($Comp))
		return ERROR | @Trigger_Error(500);
	#-------------------------------------------------------------------------------
	UnSet($Links[$LinkID]);
	#-------------------------------------------------------------------------------
	return $Result;
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(Is_Null($Url) || $Url == 'NULL')
	return $Value;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return new Tag('A',Array($Action=>$Url,'target'=>'blank'),$Value);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
