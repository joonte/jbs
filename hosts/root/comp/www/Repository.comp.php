<?php


#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
if(Is_Error(System_Load('classes/DOM.class')))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$DOM = new DOM();
#-------------------------------------------------------------------------------
$Links = &Links();
#-------------------------------------------------------------------------------
$Links['DOM'] = &$DOM;
#-------------------------------------------------------------------------------
if(Is_Error($DOM->Load('Standard')))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$DOM->AddText('Title','Репозиторий');
#-------------------------------------------------------------------------------
$JavaScript = <<<EOD
function TreeSwitch(ElementID){
  //----------------------------------------------------------------------------
  var Element = document.getElementById(ElementID);
  if(!Element)
    return;
  //----------------------------------------------------------------------------
  var Style = Element.style;
  //----------------------------------------------------------------------------
  Style.display = (Style.display != 'none'?'none':'');
  //----------------------------------------------------------------------------
  FadeIn(Element);
}
EOD;
#-------------------------------------------------------------------------------
$DOM->AddChild('Head',new Tag('SCRIPT',$JavaScript));
#-------------------------------------------------------------------------------
$Parse = IO_Read('/work/joonte/Repository.xml');
if(Is_Error($Parse))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
$DB = new DOM($Parse);
if(Is_Error($DB))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
function XML_Read($Object,$Level = 1){
  #-----------------------------------------------------------------------------
  static $Index = 1;
  #-----------------------------------------------------------------------------
  $Md5 = Md5($Index++);
  #-----------------------------------------------------------------------------
  $Attribs = $Object->Attribs;
  #-----------------------------------------------------------------------------
  $Name = (IsSet($Attribs['comment'])?$Attribs['comment']:$Object->Name);
  #-----------------------------------------------------------------------------
  $P = new Tag('P',Array('class'=>'NodeName','onclick'=>SPrintF("TreeSwitch('%s');",$Md5)),new Tag('IMG',Array('align'=>'left','src'=>'SRC:{Images/Icons/Node.gif}')),new Tag('SPAN',$Name));
  #-----------------------------------------------------------------------------
  $Node = new Tag('DIV',Array('class'=>'Node'),$P);
  #-----------------------------------------------------------------------------
  if(Count($Attribs)){
    #---------------------------------------------------------------------------
    foreach(Array_Keys($Attribs) as $AttribID)
      $Node->AddChild(new Tag('P',Array('class'=>'NodeParam'),new Tag('SPAN',SPrintF('%s: ',$AttribID)),new Tag('SPAN',Array('class'=>'NodeParam'),$Attribs[$AttribID])));
  }
  #-----------------------------------------------------------------------------
  if(Count($Childs = $Object->Childs)){
    #---------------------------------------------------------------------------
    $Content = new Tag('DIV',Array('style'=>'display:none;'),Array('id'=>$Md5));
    #---------------------------------------------------------------------------
    foreach($Childs as $Child)
      $Content->AddChild(XML_Read($Child,$Level+1));
    #---------------------------------------------------------------------------
    $Node->AddChild($Content);
  }
  #-----------------------------------------------------------------------------
  return $Node;
}
#-------------------------------------------------------------------------------
$Struct = XML_Read($DB->Object);
#-------------------------------------------------------------------------------
$DOM->AddChild('Into',$Struct);
#-------------------------------------------------------------------------------
$Out = $DOM->Build();
#-------------------------------------------------------------------------------
if(Is_Error($Out))
  return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
return $Out;
#-------------------------------------------------------------------------------

?>
