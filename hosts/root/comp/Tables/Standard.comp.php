<?php


#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Rows');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Table = new Tag('TABLE',Array('class'=>'Standard','cellspacing'=>5));
#-------------------------------------------------------------------------------
for($i=1;$i<Count($__args__);$i++){
  #-----------------------------------------------------------------------------
  $__arg__ = $__args__[$i];
  #-----------------------------------------------------------------------------
  if(Is_Array($__arg__))
    $Table->AddAttribs($__arg__);
  else
    $Table->AddChild(new Tag('CAPTION',$__arg__));
}
#-------------------------------------------------------------------------------
$UniqID = UniqID('ID');
#-------------------------------------------------------------------------------
$Group = new Tag('TBODY',Array('id'=>$UniqID));
#-------------------------------------------------------------------------------
foreach($Rows as $Row){
  #-----------------------------------------------------------------------------
  $Tr = new Tag('TR');
  #-----------------------------------------------------------------------------
  switch(ValueOf($Row)){
    case 'array':
      #-------------------------------------------------------------------------
      if(Count($Row) < 2)
        return ERROR | @Trigger_Error('[comp/Tables/Standard]: в массиве строки менее двух элементов');
      #-------------------------------------------------------------------------
      $ColumnsIDs = Array_Keys($Row);
      #-------------------------------------------------------------------------
      $Value = $Row[Current($ColumnsIDs)];
      #-------------------------------------------------------------------------
      $Td = new Tag('TD',Array('class'=>'Comment','valign'=>'bottom'),$Value);
      #-------------------------------------------------------------------------
      $Tr->AddChild($Td);
      #-------------------------------------------------------------------------
      $Value = $Row[Next($ColumnsIDs)];
      #-------------------------------------------------------------------------
      $Td = new Tag('TD',$Value);
      #-------------------------------------------------------------------------
      if(Is_Scalar($Value)){
        #-----------------------------------------------------------------------
        $Td->AddAttribs(Array('class'=>'Standard'));
        #-----------------------------------------------------------------------
        if(!Is_String($Value))
          $Td->AddAttribs(Array('align'=>'right'));
      }else{
        #-----------------------------------------------------------------------
        if($Value->Name == 'TD')
         $Td = $Value;
      }
      #-------------------------------------------------------------------------
      $Tr->AddChild($Td);
      #-------------------------------------------------------------------------
      $Group->AddChild($Tr);
    break;
    case 'object':
      #-------------------------------------------------------------------------
      $Td = new Tag('TD',Array('colspan'=>2),$Row);
      #-------------------------------------------------------------------------
      switch($Row->Name){
        case 'INPUT':
          $Td->AddAttribs(Array('align'=>'right'));
        break;
        case 'TD':
          $Td = $Row;
        break;
        default:
         # No more...
      }
      #-------------------------------------------------------------------------
      if(Count($Group->Childs)){
        #-----------------------------------------------------------------------
        $Table->AddChild($Group);
        #-----------------------------------------------------------------------
        $UniqID = UniqID('ID');
        #-----------------------------------------------------------------------
        $Group = new Tag('TBODY',Array('id'=>$UniqID));
      }
      #-------------------------------------------------------------------------
      $Tr->AddChild($Td);
      #-------------------------------------------------------------------------
      $Table->AddChild($Tr);
    break;
    default:
      #-------------------------------------------------------------------------
      if(Count($Group->Childs)){
        #-----------------------------------------------------------------------
        $Table->AddChild($Group);
        #-----------------------------------------------------------------------
        $UniqID = UniqID('ID');
        #-----------------------------------------------------------------------
        $Group = new Tag('TBODY',Array('id'=>$UniqID));
      }
      #-------------------------------------------------------------------------
      $Td = new Tag('TD',Array('colspan'=>2,'class'=>'Separator'),$Row);
      #-------------------------------------------------------------------------
      if(Preg_Match('/^(\-|\+)/',$Row,$Matches)){
        #-----------------------------------------------------------------------
        $Td->AddAttribs(Array('style'=>'cursor:pointer;','onclick'=>SPrintF("var Style = document.getElementById('%s').style;Style.display = (Style.display != 'none'?'none':'');",$UniqID)));
        #-----------------------------------------------------------------------
        $Td->AddText(SPrintF('+ %s',lTrim($Row,'-+')),TRUE);
        #-----------------------------------------------------------------------
        if(Next($Matches) != '+')
          $Group->AddAttribs(Array('style'=>'display:none;'));
      }
      #-------------------------------------------------------------------------
      $Tr->AddChild($Td);
      #-------------------------------------------------------------------------
      $Table->AddChild($Tr);
  }
}
#-------------------------------------------------------------------------------
if(Count($Group->Childs))
  $Table->AddChild($Group);
#-------------------------------------------------------------------------------
return $Table;
#-------------------------------------------------------------------------------

?>
