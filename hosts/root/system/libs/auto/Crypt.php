<?php
#-------------------------------------------------------------------------------
/** @author Alex Keda, for www.host-food.ru */
#-------------------------------------------------------------------------------
if(!Extension_Loaded('openssl'))
	$GLOBALS['__MESSAGES'][] = 'Модуль openssl не установлен. Функции шифрования могут работать не правильно. Пожалуйста, исправьте ошибку.';

#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
function Crypt_Encode($String, $Key = HOST_ID){
	/******************************************************************************/
	$__args_types = Array('string','string');
	#-------------------------------------------------------------------------------
	$__args__ = Func_Get_Args(); Eval(FUNCTION_INIT);
	/******************************************************************************/
	if(Extension_Loaded('openssl')){
		#-------------------------------------------------------------------------------
		if(StrLen($String) % 8)
			$String = Str_Pad($String,StrLen($String) + 8 - StrLen($String) % 8,"\0");
		#-------------------------------------------------------------------------------
		if(!$String = @OpenSSL_Encrypt($String,'des-ecb', $Key, OPENSSL_RAW_DATA | OPENSSL_NO_PADDING))
			return ERROR | @Trigger_Error('[Crypt_Encode]: не удалось зашифровать данные');
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	return Base64_Encode($String);
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
}

#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
function Crypt_Decode($String,$Key = HOST_ID){
	/******************************************************************************/
	$__args_types = Array('string','string');
	#-------------------------------------------------------------------------------
	$__args__ = Func_Get_Args(); Eval(FUNCTION_INIT);
	/******************************************************************************/
	$String = Base64_Decode($String);
	#-------------------------------------------------------------------------------
	if(Empty($String))
		return $String;
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	if(Extension_Loaded('openssl')){
		#-------------------------------------------------------------------------------
		if(!$String = @OpenSSL_Decrypt($String,'des-ecb',$Key,OPENSSL_RAW_DATA | OPENSSL_NO_PADDING)){
			Debug(print_r($String));
			return ERROR | @Trigger_Error('[Crypt_Decode]: не удалось дешифровать данные');
			}
		#-------------------------------------------------------------------------------
		$String = Trim($String);
		#-------------------------------------------------------------------------------
	}
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
	return $String;
	#-------------------------------------------------------------------------------
	#-------------------------------------------------------------------------------
}

#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
?>
