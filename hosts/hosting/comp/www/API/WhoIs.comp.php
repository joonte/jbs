<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Args');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Args = IsSet($Args)?$Args:Args();
#-------------------------------------------------------------------------------
$DomainName	=  (string) @$Args['DomainName'];
$DomainZone	=  (string) @$Args['DomainZone'];
$IsAvalible	= (boolean) @$Args['IsAvalible'];
#-------------------------------------------------------------------------------
if(Is_Error(System_Load('libs/WhoIs.php')))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(!$DomainName)
	return new gException('DOMAIN_NAME_NOT_SET','Доменное имя не задано');
#-------------------------------------------------------------------------------
if(!$DomainZone)
	return new gException('DOMAIN_ZONE_NOT_SET','Доменная зона не задана');
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$Config = Config();
#-------------------------------------------------------------------------------
$Settings = $Config['Interface']['User']['Orders']['Domain']['DomainWhoIs'];
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
$CacheID = Md5(SPrintF('WhoIs-%s.%s',$DomainName,$DomainZone));
#-------------------------------------------------------------------------------
$IsCheck = CacheManager::get($CacheID);
#-------------------------------------------------------------------------------
if(!$IsCheck){
	#-------------------------------------------------------------------------------
	$IsCheck = WhoIs_Check($DomainName,$DomainZone,$IsAvalible);
	#-------------------------------------------------------------------------------
	CacheManager::add($CacheID,$IsCheck,IntVal($Settings['CacheTime']));
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
switch(ValueOf($IsCheck)){
case 'error':
	return Array('Status'=>'Fail');
case 'exception':
	return $IsCheck;
case 'false':
	return new gException('DOMAIN_ZONE_NOT_SUPPORTED','Доменная зона не поддерживается');
case 'array':
	#-------------------------------------------------------------------------------
	$IsCheck['Status'] = 'Borrowed';
	#-------------------------------------------------------------------------------
	return $IsCheck;
	#-------------------------------------------------------------------------------
case 'true':
	#-------------------------------------------------------------------------------
	return Array('Status'=>'Free');
	#-------------------------------------------------------------------------------
default:
	return ERROR | @Trigger_Error(101);
}
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
