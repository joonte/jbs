<?php

#-------------------------------------------------------------------------------
/** @author Великодный В.В. (Joonte Ltd.) */
/******************************************************************************/
/******************************************************************************/
$__args_list = Array('Domain','Parked','Length','StatusID');
/******************************************************************************/
Eval(COMP_INIT);
/******************************************************************************/
/******************************************************************************/
$Domains = ($Parked?Explode(',',$Parked):Array());
#-------------------------------------------------------------------------------
$Domains[] = $Domain;
#-------------------------------------------------------------------------------
$Domains = Array_Unique($Domains);
#-------------------------------------------------------------------------------
$Count = Count($Domains);
#-------------------------------------------------------------------------------
if($Count > 10)
	$Domains = Array_Slice($Domains,0,9);
#-------------------------------------------------------------------------------
$Domain = $Text = Current($Domains);
#-------------------------------------------------------------------------------
// а бывает что и нет домена-то
if(!$Text)
	$Text = '-';
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
if(Mb_StrLen($Text) > $Length)
	$Text = SPrintF('%s...',Mb_SubStr($Text,0,$Length));
#-------------------------------------------------------------------------------
// ссылку показываем админу, или юзеру, если статус один из перечисленных
if($GLOBALS['__USER']['IsAdmin'] || In_Array($StatusID,Array('Active','SchemeChange','Suspended'))){
	#-------------------------------------------------------------------------------
	$A = new Tag('A',Array('target'=>'blank','href'=>SPrintF('http://%s/',$Domain)),$Text);
	#-------------------------------------------------------------------------------
}else{
	#-------------------------------------------------------------------------------
	$A = new Tag('SPAN',$Text);
	#-------------------------------------------------------------------------------
}
#-------------------------------------------------------------------------------
$LinkID = UniqID('Domains');
#-------------------------------------------------------------------------------
$Links = &Links();
# Коллекция ссылок
$Links[$LinkID] = &$A;
#-------------------------------------------------------------------------------
$Comp = Comp_Load('Form/Prompt',$LinkID,SPrintF('<B>Всего: %u</B><BR />%s',$Count,Implode('<BR />',$Domains)));
if(Is_Error($Comp))
	return ERROR | @Trigger_Error(500);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
UnSet($Links[$LinkID]);
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------
return $A;
#-------------------------------------------------------------------------------
#-------------------------------------------------------------------------------

?>
